<!DOCTYPE html>
<html class="no-js" lang="en">

<head>
<title>Istio &bull; Akka Management</title>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<meta name="description" content="Akka Management is a suite of tools for operating Akka Clusters."/>
<link rel="canonical" href="https://doc.akka.io/docs/akka-management/current/bootstrap/istio.html"/>
<script type="text/javascript" src="../lib/jquery/jquery.min.js"></script>
<script type="text/javascript" src="../lib/foundation/dist/js/foundation.min.js"></script>
<link rel="stylesheet" type="text/css" href="../lib/normalize.css/normalize.css"/>
<link rel="stylesheet" type="text/css" href="../lib/foundation/dist/css/foundation.min.css"/>
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.css" />
<link rel="stylesheet" type="text/css" href="../css/icons.css"/>
<link rel="stylesheet" type="text/css" href="../css/page-8.css"/>
<link rel="stylesheet" type="text/css" href="../css/banner-2.css"/>
<link rel="shortcut icon" href="../images/favicon.ico" />
<link rel="apple-touch-icon" sizes="180x180" href="../images/apple-touch-icon.png"/>
<link rel="icon" type="image/png" sizes="32x32" href="../images/favicon-32x32.png"/>
<link rel="icon" type="image/png" sizes="16x16" href="../images/favicon-16x16.png"/>
<link rel="manifest" href="../images/manifest.json"/>
<meta name="msapplication-TileImage" content="../images/mstile-150x150.png"/>
<meta name="msapplication-TileColor" content="#15a9ce"/>
<meta name="theme-color" content="#15a9ce"/>
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>
<!-- OneTrust Cookies Consent Notice (Production Standard, akka.io, en-GB) start -->
<script src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js"  type="text/javascript" charset="UTF-8" data-domain-script="28b912e7-09e9-43d5-91e4-3d1897044004" ></script>
<script type="text/javascript">
function OptanonWrapper() { }
</script>
<!-- OneTrust Cookies Consent Notice (Production Standard, akka.io, en-GB) end -->
<!--Google Analytics-->
<script type="text/plain" class="optanon-category-2">
var _gaq = _gaq || [];
_gaq.push(['_setAccount', '']);
_gaq.push(['_setDomainName', '']);
_gaq.push(['_trackPageview']);
(function() {
var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})()
</script>
<!-- Google Tag Manager -->
<script type="text/plain" class="optanon-category-2">
(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-KBJGH35');
</script>
<!--Marketo-->
<script type="text/plain" class="optanon-category-3">
(function() {
var didInit = false;
function initMunchkin() {
if(didInit === false) {
didInit = true;
Munchkin.init('558-NCX-702', { 'asyncOnly': true, 'disableClickDelay': true });
}
}
var s = document.createElement('script');
s.type = 'text/javascript';
s.async = true;
s.src = '//munchkin.marketo.net/munchkin.js';
s.onreadystatechange = function() {
if (this.readyState == 'complete' || this.readyState == 'loaded') {
initMunchkin();
}
};
s.onload = initMunchkin;
document.getElementsByTagName('head')[0].appendChild(s);
})();
</script>
</head>

<body id="underlay" data-toggler="nav-open">
<div id="lightbend-banner" class="lightbend-banner akka full-width" data-category="OSS Lightbend Banner Impression" data-label="Akka Banner Impression">
<div class="oss-wrapper">
<div class="oss-brand">
<a class="oss-track-link-label" data-category="OSS Lightbend Banner Clicks" data-label="Lightbend Logo - Akka Banner" href="https://www.lightbend.com">
<img class="lightbend-logo" src="../images/banner-logos/lightbend-reverse.svg" alt="Lightbend" title="Lightbend">
</a>
</div>
<div class="oss-ad no-drop-down">
<nav id="lightbendRotator" class="lightbend-rotator">
<a class="oss-track-link-label" data-category="OSS Lightbend Banner Clicks" data-label="Promo Rotator - Lightbend is Changing its Software Licensing Model for Akka Technology. [License FAQ] - Akka Banner" href="https://www.lightbend.com/akka/license-faq">
<strong>Lightbend</strong> is Changing its Software Licensing Model for Akka Technology. <span class="akka-btn">License FAQ</span>
</a>
</nav>
</div>
</div>
</div>

<header class="site-header hide-for-large">
<div class="sticky-header clearfix">
<a href="https://akka.io"><img class="logo" src="../images/akka-logo-reverse.svg"/></a>

<button class="menu-icon float-right" type="button" data-toggle="underlay overlay"></button>
</div>
<div id="overlay" class="overlay-nav" data-toggler="nav-open">
<header class="nav-header">
<div class="nav-header-title">
<h1><a href="../index.html">Akka Management</a></h1>
</div>
<div class="nav-header-version">
Version 1.2.0
</div>
<div class="nav-header-groups">
<select class="supergroup" name="Language"><option class="group" value="group-java">Java</option><option class="group" value="group-scala">Scala</option></select>
</div>
</header>
<nav class="nav-toc">
<ul>
  <li><a href="../index.html#overview" class="header">Overview</a></li>
  <li><a href="../kubernetes-deployment/index.html" class="page">Deploying Akka Cluster to Kubernetes</a></li>
  <li><a href="../akka-management.html" class="page">Akka Management</a></li>
  <li><a href="../migration.html" class="page">Migration guide</a></li>
  <li><a href="../healthchecks.html" class="page">Health checks</a></li>
  <li><a href="../bootstrap/index.html" class="page">Akka Cluster Bootstrap</a>
  <ul>
    <li><a href="../bootstrap/index.html#prerequisites" class="header">Prerequisites</a></li>
    <li><a href="../bootstrap/index.html#project-info" class="header">Project Info</a></li>
    <li><a href="../bootstrap/index.html#dependency" class="header">Dependency</a></li>
    <li><a href="../bootstrap/index.html#using" class="header">Using</a></li>
    <li><a href="../bootstrap/index.html#how-it-works" class="header">How It Works</a></li>
    <li><a href="../bootstrap/index.html#joining-mechanism-precedence" class="header">Joining Mechanism Precedence</a></li>
    <li><a href="../bootstrap/index.html#deployment-considerations" class="header">Deployment considerations</a></li>
    <li><a href="../bootstrap/index.html#bootstrap-recipes" class="header">Bootstrap Recipes</a></li>
    <li><a href="../bootstrap/recipes.html" class="page">Bootstrap environments</a></li>
    <li><a href="../bootstrap/details.html" class="page">Bootstrap process</a></li>
    <li><a href="../bootstrap/troubleshooting.html" class="page">Troubleshooting</a></li>
    <li><a href="../bootstrap/local-config.html" class="page">Local using config</a></li>
    <li><a href="../bootstrap/kubernetes.html" class="page">Kubernetes via DNS</a></li>
    <li><a href="../bootstrap/kubernetes-api.html" class="page">Kubernetes API</a></li>
    <li><a href="../bootstrap/istio.html#istio" class="active page">Istio</a>
    <ul>
      <li><a href="../bootstrap/istio.html#allowing-outbound-communication" class="header">Allowing outbound communication</a></li>
      <li><a href="../bootstrap/istio.html#allowing-inbound-communication" class="header">Allowing inbound communication</a></li>
      <li><a href="../bootstrap/istio.html#example" class="header">Example</a></li>
    </ul></li>
  </ul></li>
  <li><a href="../discovery/index.html" class="page">Akka Discovery Methods</a></li>
  <li><a href="../cluster-http-management.html" class="page">Cluster HTTP Management</a></li>
  <li><a href="../cluster-jmx-management.html" class="page">Built-in JMX Management</a></li>
  <li><a href="../loglevels/index.html" class="page">Dynamic Log Levels</a></li>
  <li><a href="../kubernetes-lease.html" class="page">Kubernetes Lease</a></li>
</ul>
</nav>
</div>
</header>
<div class="site-content-wrapper">
<aside class="sticky-sidebar show-for-large">
<header class="nav-header sticky-sidebar-header">
<div class="nav-header-title">
<h1><a href="../index.html">Akka Management</a></h1>
</div>
<div class="nav-header-version">
Version 1.2.0
</div>
<div class="nav-header-groups">
<select class="supergroup" name="Language"><option class="group" value="group-java">Java</option><option class="group" value="group-scala">Scala</option></select>
</div>
</header>
<nav class="site-nav sticky-sidebar-contents">
<div class="nav-toc">
<ul>
  <li><a href="../index.html#overview" class="header">Overview</a></li>
  <li><a href="../kubernetes-deployment/index.html" class="page">Deploying Akka Cluster to Kubernetes</a></li>
  <li><a href="../akka-management.html" class="page">Akka Management</a></li>
  <li><a href="../migration.html" class="page">Migration guide</a></li>
  <li><a href="../healthchecks.html" class="page">Health checks</a></li>
  <li><a href="../bootstrap/index.html" class="page">Akka Cluster Bootstrap</a>
  <ul>
    <li><a href="../bootstrap/index.html#prerequisites" class="header">Prerequisites</a></li>
    <li><a href="../bootstrap/index.html#project-info" class="header">Project Info</a></li>
    <li><a href="../bootstrap/index.html#dependency" class="header">Dependency</a></li>
    <li><a href="../bootstrap/index.html#using" class="header">Using</a></li>
    <li><a href="../bootstrap/index.html#how-it-works" class="header">How It Works</a></li>
    <li><a href="../bootstrap/index.html#joining-mechanism-precedence" class="header">Joining Mechanism Precedence</a></li>
    <li><a href="../bootstrap/index.html#deployment-considerations" class="header">Deployment considerations</a></li>
    <li><a href="../bootstrap/index.html#bootstrap-recipes" class="header">Bootstrap Recipes</a></li>
    <li><a href="../bootstrap/recipes.html" class="page">Bootstrap environments</a></li>
    <li><a href="../bootstrap/details.html" class="page">Bootstrap process</a></li>
    <li><a href="../bootstrap/troubleshooting.html" class="page">Troubleshooting</a></li>
    <li><a href="../bootstrap/local-config.html" class="page">Local using config</a></li>
    <li><a href="../bootstrap/kubernetes.html" class="page">Kubernetes via DNS</a></li>
    <li><a href="../bootstrap/kubernetes-api.html" class="page">Kubernetes API</a></li>
    <li><a href="../bootstrap/istio.html#istio" class="active page">Istio</a>
    <ul>
      <li><a href="../bootstrap/istio.html#allowing-outbound-communication" class="header">Allowing outbound communication</a></li>
      <li><a href="../bootstrap/istio.html#allowing-inbound-communication" class="header">Allowing inbound communication</a></li>
      <li><a href="../bootstrap/istio.html#example" class="header">Example</a></li>
    </ul></li>
  </ul></li>
  <li><a href="../discovery/index.html" class="page">Akka Discovery Methods</a></li>
  <li><a href="../cluster-http-management.html" class="page">Cluster HTTP Management</a></li>
  <li><a href="../cluster-jmx-management.html" class="page">Built-in JMX Management</a></li>
  <li><a href="../loglevels/index.html" class="page">Dynamic Log Levels</a></li>
  <li><a href="../kubernetes-lease.html" class="page">Kubernetes Lease</a></li>
</ul>
</div>
</nav>
<footer class="nav-footer sticky-sidebar-footer">
<a href="https://akka.io"><img class="logo" src="../images/akka-logo-reverse.svg"/></a>

</footer>
</aside>
<main class="fixed-shift-for-large expanded row">
<section class="site-content small-12 column">
<article class="page-content row">
<div class="small-12 column" id="docs">
<h1><a href="#istio" name="istio" class="anchor"><span class="anchor-link"></span></a>Istio</h1>
<p><a href="https://istio.io/">Istio</a> is a service mesh that handles many of the concerns of service to service communication for you, such as routing, load balancing, authentication, authorization, and observability. In certain use cases, it can complement an Akka cluster well. Typically, Akka cluster communication is used for multiple nodes of the same service to communicate with each other, to achieve things such as sharding, replication and peer to peer communication, while a service mesh might be used for nodes of different services to communicate with each other, through REST and gRPC APIs.</p>
<p>To bootstrap an Akka cluster in Istio, Istio must be configured to allow Akka cluster communication to bypass the Istio sidecar proxy. Istio&rsquo;s routing design is made such that services don&rsquo;t need to be aware of each others location, they just communicate with the proxy, and the mesh figures out how to route and secure the communication. However, Akka cluster communication is fundamentally location aware, in order to, for example, route messages to sharded actors. Hence a service mesh is not a suitable communication medium for cluster traffic, so it needs to be bypassed.</p>
<p>It is important to be aware that since Istio&rsquo;s proxy is bypassed, the Akka cluster communication will not be secured by Istio using TLS. If you wish to secure your cluster communication, you will need to configure <a href="https://doc.akka.io/docs/akka/current/remoting-artery.html#remote-security">Akka remoting with mTLS</a> yourself.</p>
<p>Booting an Akka cluster in Istio requires a minimum Istio version of 1.2.0, as it requires the outbound port exclusions feature that was added in there. It also requires using the <a href="kubernetes-api.html">Kubernetes API</a> contact point discovery method to be used. The instructions below are for the additional configuration necessary to ensure an Akka cluster can be bootstrapped in Istio.</p>
<h2><a href="#allowing-outbound-communication" name="allowing-outbound-communication" class="anchor"><span class="anchor-link"></span></a>Allowing outbound communication</h2>
<p>By default, Istio redirects all outbound communication to its proxy. To prevent it from doing this for Akka cluster communication, both the remoting and management ports need to be excluded from redirection. This can be done using the <code>traffic.sidecar.istio.io/excludeOutboundPorts</code> annotation in the deployment pod template. If your remoting port is 2552, and management port is 8558, this can be done like so:</p>
<pre class="prettyprint"><code class="language-yaml">annotations:
  traffic.sidecar.istio.io/excludeOutboundPorts: &quot;2552,8558&quot;
</code></pre>
<h2><a href="#allowing-inbound-communication" name="allowing-inbound-communication" class="anchor"><span class="anchor-link"></span></a>Allowing inbound communication</h2>
<p>Inbound connections to Akka management and remoting also need to bypass the sidecar proxy. By default, Istio will redirect all incoming traffic to the ports listed in the containers port specification to the sidecar proxy. Hence, there are two ways to ensure that the Akka management and remoting traffic bypasses the proxy, either explicitly configure the incoming ports to redirect, or don&rsquo;t list the Akka management and remoting ports in the container&rsquo;s ports specification.</p>
<p>The inbound ports to redirect can be configured using the <code>traffic.sidecar.istio.io/includeInboundPorts</code> annotation. If your service offers a REST endpoint on port 8080, then you might configure that like so:</p>
<pre class="prettyprint"><code class="language-yaml">annotations:
  traffic.sidecar.istio.io/includeInboundPorts: &quot;8080&quot;
</code></pre>
<p>If you offer any other services on other ports, they can be added as a comma separated list. The important thing to ensure is that your remoting and management ports are not listed in that list.</p>
<h2><a href="#example" name="example" class="anchor"><span class="anchor-link"></span></a>Example</h2>
<p>Here is an example deployment spec for an Akka cluster deployed to Istio, which uses the explicit include inbound ports annotation to ensure that incoming remoting and management traffic isn&rsquo;t redirected through the proxy:</p>
<pre class="prettyprint"><code class="language-yaml">apiVersion: apps/v1
kind: Deployment
metadata:
  name: my-service
spec:
  replicas: 3
  selector:
    matchLabels:
      app: my-service
  template:
    metadata:
      labels:
        app: my-service
      annotations:
        traffic.sidecar.istio.io/includeInboundPorts: &quot;8080&quot;
        traffic.sidecar.istio.io/excludeOutboundPorts: &quot;2552,8558&quot;
    spec:
      containers:
      - name: my-service
        image: &quot;my-service:latest&quot;

        ports:
        - containerPort: 8080
          name: http
        - containerPort: 2552
          name: remoting
        - containerPort: 8558
          name: management

        readinessProbe:
          httpGet:
            path: &quot;/ready&quot;
            port: management
        livenessProbe:
          httpGet:
            path: &quot;/alive&quot;
            port: management
</code></pre>
</div>
</article>
<div class="row">
<div class="small-12 column">
<section class="nav-prev-next row">
<div class="nav-prev small-6 column">
<a href="../bootstrap/kubernetes-api.html"><i class="icon-prev"></i> <span class="link-prev">Kubernetes API</span></a>
</div>
<div class="nav-next small-6 column clearfix">
<a class="float-right" href="../discovery/index.html">Akka Discovery Methods <i class="icon-next"></i></a>
</div>
</section>
</div>
</div>
<div class="source-github row">
Found an error in this documentation? The source code for this page can be found <a href="https://github.com/akka/akka-management/tree/v1.2.0/docs/src/main/paradox/bootstrap/istio.md">here</a>.
Please feel free to edit and contribute a pull request.
</div>

<footer class="page-footer row clearfix">
<img class="akka-icon float-left show-for-medium" src="../images/akka-icon.svg" />
<section class="copyright">
<div>Akka Management is available under the <a href="https://www.lightbend.com/akka/license" target="_blank">Business Source License 1.1</a>.</div>
<p class="legal">
&copy; 2011-2021 <a href="https://www.lightbend.com" target="_blank">Lightbend, Inc.</a> |
<a href="https://www.lightbend.com/legal/licenses" target="_blank">Licenses</a> |
<a href="https://www.lightbend.com/legal/terms" target="_blank">Terms</a> |
<a href="https://www.lightbend.com/legal/privacy" target="_blank">Privacy Policy</a> |
<a href="https://akka.io/cookie/" target="_blank">Cookie Listing</a> |
<a class="optanon-toggle-display">Cookie Settings</a>
</p>
</section>

</footer>
</section>
</main>
</div>

<script type="text/javascript" src="../js/scrollsneak.js"></script>
<script type="text/javascript">jQuery(document).foundation();</script>
<script type="text/javascript" src="../js/groups.js"></script>
<script type="text/javascript" src="../js/page.js"></script>
<script type="text/javascript" src="../js/snippets.js"></script>
<script type="text/javascript" src="../js/magellan.js"></script>
<script type="text/javascript" src="../js/metadata-toggle.js"></script>
<script type="text/javascript" src="../js/lbHeader.js"></script>

<style type="text/css">@import "../lib/prettify/prettify.css";</style>
<script type="text/javascript" src="../lib/prettify/prettify.js"></script>
<script type="text/javascript" src="../lib/prettify/lang-scala.js"></script>
<script type="text/javascript">//<![CDATA[
jQuery(function(){window.prettyPrint && prettyPrint()});
//]]></script>
<script type="text/javascript" src="../assets/js/warnOldVersion.js"></script>
<script type="text/javascript">//<![CDATA[
jQuery(function(jq){initOldVersionWarnings(jq, '1.2.0', 'https://doc.akka.io/docs/akka-management/current/')});
//]]></script>


</body>
</html>
