<!DOCTYPE html>
<html class="no-js" lang="en">

<head>
<title>Building using SBT &bull; Akka Management</title>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<meta name="description" content="Akka Management is a suite of tools for operating Akka Clusters."/>
<link rel="canonical" href="https://doc.akka.io/docs/akka-management/current/kubernetes-deployment/building-using-sbt.html"/>
<script type="text/javascript" src="../lib/jquery/jquery.min.js"></script>
<script type="text/javascript" src="../lib/foundation/dist/js/foundation.min.js"></script>
<link rel="stylesheet" type="text/css" href="../lib/normalize.css/normalize.css"/>
<link rel="stylesheet" type="text/css" href="../lib/foundation/dist/css/foundation.min.css"/>
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.css" />
<link rel="stylesheet" type="text/css" href="../css/icons.css"/>
<link rel="stylesheet" type="text/css" href="../css/page-8.css"/>
<link rel="stylesheet" type="text/css" href="../css/banner-2.css"/>
<link rel="shortcut icon" href="../images/favicon.ico" />
<link rel="apple-touch-icon" sizes="180x180" href="../images/apple-touch-icon.png"/>
<link rel="icon" type="image/png" sizes="32x32" href="../images/favicon-32x32.png"/>
<link rel="icon" type="image/png" sizes="16x16" href="../images/favicon-16x16.png"/>
<link rel="manifest" href="../images/manifest.json"/>
<meta name="msapplication-TileImage" content="../images/mstile-150x150.png"/>
<meta name="msapplication-TileColor" content="#15a9ce"/>
<meta name="theme-color" content="#15a9ce"/>
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>
<!-- OneTrust Cookies Consent Notice (Production Standard, akka.io, en-GB) start -->
<script src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js"  type="text/javascript" charset="UTF-8" data-domain-script="28b912e7-09e9-43d5-91e4-3d1897044004" ></script>
<script type="text/javascript">
function OptanonWrapper() { }
</script>
<!-- OneTrust Cookies Consent Notice (Production Standard, akka.io, en-GB) end -->
<!--Google Analytics-->
<script type="text/plain" class="optanon-category-2">
var _gaq = _gaq || [];
_gaq.push(['_setAccount', '']);
_gaq.push(['_setDomainName', '']);
_gaq.push(['_trackPageview']);
(function() {
var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})()
</script>
<!-- Google Tag Manager -->
<script type="text/plain" class="optanon-category-2">
(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-KBJGH35');
</script>
<!--Marketo-->
<script type="text/plain" class="optanon-category-3">
(function() {
var didInit = false;
function initMunchkin() {
if(didInit === false) {
didInit = true;
Munchkin.init('558-NCX-702', { 'asyncOnly': true, 'disableClickDelay': true });
}
}
var s = document.createElement('script');
s.type = 'text/javascript';
s.async = true;
s.src = '//munchkin.marketo.net/munchkin.js';
s.onreadystatechange = function() {
if (this.readyState == 'complete' || this.readyState == 'loaded') {
initMunchkin();
}
};
s.onload = initMunchkin;
document.getElementsByTagName('head')[0].appendChild(s);
})();
</script>
</head>

<body id="underlay" data-toggler="nav-open">
<div id="lightbend-banner" class="lightbend-banner akka full-width" data-category="OSS Lightbend Banner Impression" data-label="Akka Banner Impression">
<div class="oss-wrapper">
<div class="oss-brand">
<a class="oss-track-link-label" data-category="OSS Lightbend Banner Clicks" data-label="Lightbend Logo - Akka Banner" href="https://www.lightbend.com">
<img class="lightbend-logo" src="../images/banner-logos/lightbend-reverse.svg" alt="Lightbend" title="Lightbend">
</a>
</div>
<div class="oss-ad no-drop-down">
<nav id="lightbendRotator" class="lightbend-rotator">
<a class="oss-track-link-label" data-category="OSS Lightbend Banner Clicks" data-label="Promo Rotator - Akka Serverless - Keep the data. Lose the database. Try now for free. [Learn More] - Akka Banner" href="https://www.lightbend.com/akka-serverless">
<strong>Akka Serverless</strong> - Keep the data. Lose the database. Try now for free. <span class="akka-btn">Learn More</span>
</a>
<a class="oss-track-link-label" data-category="OSS Lightbend Banner Clicks" data-label="Promo Rotator - Using AWS or GCP? Simplify deployments with Akka Cloud Platform [Learn More] - Akka Banner" href="https://www.lightbend.com/akka-cloud-platform">
<strong>Using AWS or GCP?</strong>&nbsp;&nbsp;Simplify deployments with Akka Cloud Platform. <span class="akka-btn">Learn More</span>
</a>
</nav>
</div>
</div>
</div>

<header class="site-header hide-for-large">
<div class="sticky-header clearfix">
<a href="https://akka.io"><img class="logo" src="../images/akka-logo-reverse.svg"/></a>

<button class="menu-icon float-right" type="button" data-toggle="underlay overlay"></button>
</div>
<div id="overlay" class="overlay-nav" data-toggler="nav-open">
<header class="nav-header">
<div class="nav-header-title">
<h1><a href="../index.html">Akka Management</a></h1>
</div>
<div class="nav-header-version">
Version 1.1.3
</div>
<div class="nav-header-groups">
<select class="supergroup" name="Language"><option class="group" value="group-java">Java</option><option class="group" value="group-scala">Scala</option></select>
</div>
</header>
<nav class="nav-toc">
<ul>
  <li><a href="../index.html#overview" class="header">Overview</a></li>
  <li><a href="../kubernetes-deployment/index.html" class="page">Deploying Akka Cluster to Kubernetes</a>
  <ul>
    <li><a href="../kubernetes-deployment/preparing-for-production.html" class="page">Preparing for production</a></li>
    <li><a href="../kubernetes-deployment/forming-a-cluster.html" class="page">Forming an Akka Cluster</a></li>
    <li><a href="../kubernetes-deployment/building.html" class="page">Building the application</a>
    <ul>
      <li><a href="../kubernetes-deployment/building-using-sbt.html#building-using-sbt" class="active page">Building using SBT</a>
      <ul>
        <li><a href="../kubernetes-deployment/building-using-sbt.html#setup" class="header">Setup</a></li>
        <li><a href="../kubernetes-deployment/building-using-sbt.html#building-the-docker-image" class="header">Building the docker image</a></li>
      </ul></li>
      <li><a href="../kubernetes-deployment/building-using-maven.html" class="page">Building using Maven</a></li>
    </ul></li>
    <li><a href="../kubernetes-deployment/deploying.html" class="page">Deploying</a></li>
  </ul></li>
  <li><a href="../akka-management.html" class="page">Akka Management</a></li>
  <li><a href="../migration.html" class="page">Migration guide</a></li>
  <li><a href="../healthchecks.html" class="page">Health checks</a></li>
  <li><a href="../bootstrap/index.html" class="page">Akka Cluster Bootstrap</a></li>
  <li><a href="../discovery/index.html" class="page">Akka Discovery Methods</a></li>
  <li><a href="../cluster-http-management.html" class="page">Cluster HTTP Management</a></li>
  <li><a href="../cluster-jmx-management.html" class="page">Built-in JMX Management</a></li>
  <li><a href="../loglevels/index.html" class="page">Dynamic Log Levels</a></li>
  <li><a href="../kubernetes-lease.html" class="page">Kubernetes Lease</a></li>
</ul>
</nav>
</div>
</header>
<div class="site-content-wrapper">
<aside class="sticky-sidebar show-for-large">
<header class="nav-header sticky-sidebar-header">
<div class="nav-header-title">
<h1><a href="../index.html">Akka Management</a></h1>
</div>
<div class="nav-header-version">
Version 1.1.3
</div>
<div class="nav-header-groups">
<select class="supergroup" name="Language"><option class="group" value="group-java">Java</option><option class="group" value="group-scala">Scala</option></select>
</div>
</header>
<nav class="site-nav sticky-sidebar-contents">
<div class="nav-toc">
<ul>
  <li><a href="../index.html#overview" class="header">Overview</a></li>
  <li><a href="../kubernetes-deployment/index.html" class="page">Deploying Akka Cluster to Kubernetes</a>
  <ul>
    <li><a href="../kubernetes-deployment/preparing-for-production.html" class="page">Preparing for production</a></li>
    <li><a href="../kubernetes-deployment/forming-a-cluster.html" class="page">Forming an Akka Cluster</a></li>
    <li><a href="../kubernetes-deployment/building.html" class="page">Building the application</a>
    <ul>
      <li><a href="../kubernetes-deployment/building-using-sbt.html#building-using-sbt" class="active page">Building using SBT</a>
      <ul>
        <li><a href="../kubernetes-deployment/building-using-sbt.html#setup" class="header">Setup</a></li>
        <li><a href="../kubernetes-deployment/building-using-sbt.html#building-the-docker-image" class="header">Building the docker image</a></li>
      </ul></li>
      <li><a href="../kubernetes-deployment/building-using-maven.html" class="page">Building using Maven</a></li>
    </ul></li>
    <li><a href="../kubernetes-deployment/deploying.html" class="page">Deploying</a></li>
  </ul></li>
  <li><a href="../akka-management.html" class="page">Akka Management</a></li>
  <li><a href="../migration.html" class="page">Migration guide</a></li>
  <li><a href="../healthchecks.html" class="page">Health checks</a></li>
  <li><a href="../bootstrap/index.html" class="page">Akka Cluster Bootstrap</a></li>
  <li><a href="../discovery/index.html" class="page">Akka Discovery Methods</a></li>
  <li><a href="../cluster-http-management.html" class="page">Cluster HTTP Management</a></li>
  <li><a href="../cluster-jmx-management.html" class="page">Built-in JMX Management</a></li>
  <li><a href="../loglevels/index.html" class="page">Dynamic Log Levels</a></li>
  <li><a href="../kubernetes-lease.html" class="page">Kubernetes Lease</a></li>
</ul>
</div>
</nav>
<footer class="nav-footer sticky-sidebar-footer">
<a href="https://akka.io"><img class="logo" src="../images/akka-logo-reverse.svg"/></a>

</footer>
</aside>
<main class="fixed-shift-for-large expanded row">
<section class="site-content small-12 column">
<article class="page-content row">
<div class="small-12 column" id="docs">
<h1><a href="#building-using-sbt" name="building-using-sbt" class="anchor"><span class="anchor-link"></span></a>Building using SBT</h1>
<p>sbt uses a plugin called <a href="https://www.scala-sbt.org/sbt-native-packager/">sbt-native-packager</a> to allow conveniently packaging Java and Scala applications built using sbt as Docker images.</p>
<h2><a href="#setup" name="setup" class="anchor"><span class="anchor-link"></span></a>Setup</h2>
<p>To use this plugin in your sbt application, add the following to your <code>project/plugins.sbt</code> file:</p>
<pre class="prettyprint"><code class="language-scala">addSbtPlugin(&quot;com.typesafe.sbt&quot; % &quot;sbt-native-packager&quot; % &quot;&lt;latest.version&gt;&quot;)
</code></pre>
<p>Now you can enable the appropriate plugins in your build, by modifying your project in <code>build.sbt</code>:</p>
<pre class="prettyprint"><code class="language-scala">enablePlugins(JavaAppPackaging, DockerPlugin)
</code></pre>
<p>Here we&rsquo;re telling native packager to package our application as a Java application that can be run from the command line. This will package up all the applications dependencies (jar files), and generate a start script to start the application. To generate this start script, native packager needs to know what the applications main class is. When the application only has one main class in its source folder, sbt will detect this automatically, but in case there are multiple, or the main class comes from a dependency, it can be set in <code>build.sbt</code> like so:</p>
<pre class="prettyprint"><code class="language-scala">Compile / mainClass := Some(&quot;akka.sample.cluster.kubernetes.DemoApp&quot;)
</code></pre>
<h3><a href="#selecting-a-jdk" name="selecting-a-jdk" class="anchor"><span class="anchor-link"></span></a>Selecting a JDK</h3>
<p>By default, sbt native packager uses the <code>openjdk</code> latest Docker image from DockerHub. At time of writing, this will give you OpenJDK 11, which is not certified by Lightbend, and it also gives you the Debian OpenJDK build, which is not certified by Lightbend either. For a full list of Lightbend certified JDK builds and versions, see <a href="https://developer.lightbend.com/docs/introduction/getting-help/java-versions.html">here</a>.</p>
<p>We recommend using the AdoptOpenJDK base image:</p>
<pre class="prettyprint"><code class="language-scala">dockerBaseImage := &quot;adoptopenjdk:11-jre-hotspot&quot;
</code></pre>
<h3><a href="#git-hash-based-version-numbers" name="git-hash-based-version-numbers" class="anchor"><span class="anchor-link"></span></a>Git hash based version numbers</h3>
<p>This step is optional, but we recommend basing the version number of your application on the current git hash, since this ensures that you will always be able to map what is deployed to production back to the exact version of your application being used.</p>
<p>There are a number of sbt plugins available for generating a version number from a git hash, we&rsquo;re going to use <a href="https://github.com/dwijnand/sbt-dynver"><code>sbt-dynver</code></a>, which incorporates the most recent git tag as the base version number, appends the git hash to that only if there are any changes since that tag, and also includes a datetime stamp if there are local changes in the repository. To add this plugin to your project, add the following to <code>project/plugins.sbt</code>:</p>
<pre class="prettyprint"><code class="language-scala">addSbtPlugin(&quot;com.dwijnand&quot; % &quot;sbt-dynver&quot; % &quot;$sbt.dynver.version$&quot;)
</code></pre>
<p>For the plugin to work, you need to ensure that you <em>don&rsquo;t</em> specify a <code>version</code> in your sbt build, since this will overwrite the version that <code>sbt-dynver</code> generates. <code>sbt-dynver</code> generates versions with a <code>+</code> character in them (the <code>+</code> is used to indicate how many commits have been added since the last tag, so <code>1.0+4</code> indicates this is the 1.0 tag plus 4 commits) and this is invalid for docker versions. To replace this with a <code>-</code> character, add the following to <code>build.sbt</code>:</p>
<pre class="prettyprint"><code class="language-scala">ThisBuild / dynverSeparator := &quot;-&quot;
</code></pre>
<p>You may also want to configure the sbt native packager to tag your image as the <code>latest</code> image, this will be necessary if you&rsquo;re using the <code>latest</code> tag in your deployment spec. To do this, enable <code>dockerUpdateLatest</code> in <code>build.sbt</code>:</p>
<pre class="prettyprint"><code class="language-scala">dockerUpdateLatest := true
</code></pre>
<h3><a href="#configuring-deployment" name="configuring-deployment" class="anchor"><span class="anchor-link"></span></a>Configuring deployment</h3>
<p>After building the docker image we need to deploy it. The Docker username and repository can be hardcoded in your <code>build.sbt</code> or taken from a property such as: </p>
<pre class="prettyprint"><code class="language-scala">dockerUsername := sys.props.get(&quot;docker.username&quot;)
dockerRepository := sys.props.get(&quot;docker.registry&quot;)
</code></pre>
<p>In this case, we&rsquo;re reading both variables from system properties, which ensures that the build is not tied to any particular docker username or registry. We&rsquo;ll supply these system properties when we invoke sbt. The repository can be <a href="https://hub.docker.com/">DockerHub</a> or your private repository.</p>
<h2><a href="#building-the-docker-image" name="building-the-docker-image" class="anchor"><span class="anchor-link"></span></a>Building the docker image</h2>
<p>Now that we&rsquo;re setup, we can build our docker image. Run the following:</p>
<pre><code>sbt -Ddocker.username=&lt;user-name&gt; -Ddocker.registry=&lt;registry-url&gt; docker:publish
</code></pre>
</div>
</article>
<div class="row">
<div class="small-12 column">
<section class="nav-prev-next row">
<div class="nav-prev small-6 column">
<a href="../kubernetes-deployment/building.html"><i class="icon-prev"></i> <span class="link-prev">Building the application</span></a>
</div>
<div class="nav-next small-6 column clearfix">
<a class="float-right" href="../kubernetes-deployment/building-using-maven.html">Building using Maven <i class="icon-next"></i></a>
</div>
</section>
</div>
</div>
<div class="source-github row">
Found an error in this documentation? The source code for this page can be found <a href="https://github.com/akka/akka-management/tree/v1.1.3/docs/src/main/paradox/kubernetes-deployment/building-using-sbt.md">here</a>.
Please feel free to edit and contribute a pull request.
</div>

<footer class="page-footer row clearfix">
<img class="akka-icon float-left show-for-medium" src="../images/akka-icon.svg" />
<section class="copyright">
<div>Akka Management is Open Source and available under the Apache 2 License.</div>
<p class="legal">
&copy; 2011-2021 <a href="https://www.lightbend.com" target="_blank">Lightbend, Inc.</a> |
<a href="https://www.lightbend.com/legal/licenses" target="_blank">Licenses</a> |
<a href="https://www.lightbend.com/legal/terms" target="_blank">Terms</a> |
<a href="https://www.lightbend.com/legal/privacy" target="_blank">Privacy Policy</a> |
<a href="https://akka.io/cookie/" target="_blank">Cookie Listing</a> |
<a class="optanon-toggle-display">Cookie Settings</a>
</p>
</section>

</footer>
</section>
</main>
</div>

<script type="text/javascript" src="../js/scrollsneak.js"></script>
<script type="text/javascript">jQuery(document).foundation();</script>
<script type="text/javascript" src="../js/groups.js"></script>
<script type="text/javascript" src="../js/page.js"></script>
<script type="text/javascript" src="../js/snippets.js"></script>
<script type="text/javascript" src="../js/magellan.js"></script>
<script type="text/javascript" src="../js/metadata-toggle.js"></script>
<script type="text/javascript" src="../js/lbHeader.js"></script>

<style type="text/css">@import "../lib/prettify/prettify.css";</style>
<script type="text/javascript" src="../lib/prettify/prettify.js"></script>
<script type="text/javascript" src="../lib/prettify/lang-scala.js"></script>
<script type="text/javascript">//<![CDATA[
jQuery(function(){window.prettyPrint && prettyPrint()});
//]]></script>
<script type="text/javascript" src="../assets/js/warnOldVersion.js"></script>
<script type="text/javascript">//<![CDATA[
jQuery(function(jq){initOldVersionWarnings(jq, '1.1.3', 'https://doc.akka.io/docs/akka-management/current/')});
//]]></script>


</body>
</html>
