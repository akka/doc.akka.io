<!DOCTYPE html>
<html class="no-js" lang="en">

<head>
<title>Bootstrap process &bull; Akka Management</title>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<meta name="description" content="Akka Management is a suite of tools for operating Akka Clusters."/>
<link rel="canonical" href="https://doc.akka.io/docs/akka-management/current/bootstrap/details.html"/>
<script type="text/javascript" src="../lib/jquery/jquery.min.js"></script>
<script type="text/javascript" src="../lib/foundation/dist/js/foundation.min.js"></script>
<link rel="stylesheet" type="text/css" href="../lib/normalize.css/normalize.css"/>
<link rel="stylesheet" type="text/css" href="../lib/foundation/dist/css/foundation.min.css"/>
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.css" />
<link rel="stylesheet" type="text/css" href="../css/icons.css"/>
<link rel="stylesheet" type="text/css" href="../css/page-8.css"/>
<link rel="stylesheet" type="text/css" href="../css/banner-2.css"/>
<link rel="shortcut icon" href="../images/favicon.ico" />
<link rel="apple-touch-icon" sizes="180x180" href="../images/apple-touch-icon.png"/>
<link rel="icon" type="image/png" sizes="32x32" href="../images/favicon-32x32.png"/>
<link rel="icon" type="image/png" sizes="16x16" href="../images/favicon-16x16.png"/>
<link rel="manifest" href="../images/manifest.json"/>
<meta name="msapplication-TileImage" content="../images/mstile-150x150.png"/>
<meta name="msapplication-TileColor" content="#15a9ce"/>
<meta name="theme-color" content="#15a9ce"/>
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>
<!-- OneTrust Cookies Consent Notice (Production Standard, akka.io, en-GB) start -->
<script src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js"  type="text/javascript" charset="UTF-8" data-domain-script="28b912e7-09e9-43d5-91e4-3d1897044004" ></script>
<script type="text/javascript">
function OptanonWrapper() { }
</script>
<!-- OneTrust Cookies Consent Notice (Production Standard, akka.io, en-GB) end -->
<!--Google Analytics-->
<script type="text/plain" class="optanon-category-2">
var _gaq = _gaq || [];
_gaq.push(['_setAccount', '']);
_gaq.push(['_setDomainName', '']);
_gaq.push(['_trackPageview']);
(function() {
var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})()
</script>
<!-- Google Tag Manager -->
<script type="text/plain" class="optanon-category-2">
(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-KBJGH35');
</script>
<!--Marketo-->
<script type="text/plain" class="optanon-category-3">
(function() {
var didInit = false;
function initMunchkin() {
if(didInit === false) {
didInit = true;
Munchkin.init('558-NCX-702', { 'asyncOnly': true, 'disableClickDelay': true });
}
}
var s = document.createElement('script');
s.type = 'text/javascript';
s.async = true;
s.src = '//munchkin.marketo.net/munchkin.js';
s.onreadystatechange = function() {
if (this.readyState == 'complete' || this.readyState == 'loaded') {
initMunchkin();
}
};
s.onload = initMunchkin;
document.getElementsByTagName('head')[0].appendChild(s);
})();
</script>
</head>

<body id="underlay" data-toggler="nav-open">
<div id="lightbend-banner" class="lightbend-banner akka full-width" data-category="OSS Lightbend Banner Impression" data-label="Akka Banner Impression">
<div class="oss-wrapper">
<div class="oss-brand">
<a class="oss-track-link-label" data-category="OSS Lightbend Banner Clicks" data-label="Lightbend Logo - Akka Banner" href="https://www.lightbend.com">
<img class="lightbend-logo" src="../images/banner-logos/lightbend-reverse.svg" alt="Lightbend" title="Lightbend">
</a>
</div>
<div class="oss-ad no-drop-down">
<nav id="lightbendRotator" class="lightbend-rotator">
<a class="oss-track-link-label" data-category="OSS Lightbend Banner Clicks" data-label="Promo Rotator - Lightbend Changed its Software Licensing Model for Akka Technology. [License FAQ] - Akka Banner" href="https://www.lightbend.com/akka/license-faq">
<strong>Lightbend</strong> Changed its Software Licensing Model for Akka Technology. <span class="akka-btn">License FAQ</span>
</a>
</nav>
</div>
</div>
</div>

<header class="site-header hide-for-large">
<div class="sticky-header clearfix">
<a href="https://akka.io"><img class="logo" src="../images/akka-logo-reverse.svg"/></a>

<button class="menu-icon float-right" type="button" data-toggle="underlay overlay"></button>
</div>
<div id="overlay" class="overlay-nav" data-toggler="nav-open">
<header class="nav-header">
<div class="nav-header-title">
<h1><a href="../index.html">Akka Management</a></h1>
</div>
<div class="nav-header-version">
Version 1.4.0
</div>
<div class="nav-header-groups">
<select class="supergroup" name="Language"><option class="group" value="group-java">Java</option><option class="group" value="group-scala">Scala</option></select>
</div>
</header>
<nav class="nav-toc">
<ul>
  <li><a href="../index.html#overview" class="header">Overview</a></li>
  <li><a href="../kubernetes-deployment/index.html" class="page">Deploying Akka Cluster to Kubernetes</a></li>
  <li><a href="../akka-management.html" class="page">Akka Management</a></li>
  <li><a href="../migration.html" class="page">Migration guide</a></li>
  <li><a href="../healthchecks.html" class="page">Health checks</a></li>
  <li><a href="../bootstrap/index.html" class="page">Akka Cluster Bootstrap</a>
  <ul>
    <li><a href="../bootstrap/index.html#prerequisites" class="header">Prerequisites</a></li>
    <li><a href="../bootstrap/index.html#project-info" class="header">Project Info</a></li>
    <li><a href="../bootstrap/index.html#dependency" class="header">Dependency</a></li>
    <li><a href="../bootstrap/index.html#using" class="header">Using</a></li>
    <li><a href="../bootstrap/index.html#how-it-works" class="header">How It Works</a></li>
    <li><a href="../bootstrap/index.html#joining-mechanism-precedence" class="header">Joining Mechanism Precedence</a></li>
    <li><a href="../bootstrap/index.html#deployment-considerations" class="header">Deployment considerations</a></li>
    <li><a href="../bootstrap/index.html#bootstrap-recipes" class="header">Bootstrap Recipes</a></li>
    <li><a href="../bootstrap/recipes.html" class="page">Bootstrap environments</a></li>
    <li><a href="../bootstrap/details.html#bootstrap-process" class="active page">Bootstrap process</a>
    <ul>
      <li><a href="../bootstrap/details.html#cluster-formation-in-a-dynamic-environment" class="header">Cluster formation in a dynamic environment</a></li>
      <li><a href="../bootstrap/details.html#customizing-join-behavior" class="header">Customizing Join Behavior</a></li>
    </ul></li>
    <li><a href="../bootstrap/troubleshooting.html" class="page">Troubleshooting</a></li>
    <li><a href="../bootstrap/local-config.html" class="page">Local using config</a></li>
    <li><a href="../bootstrap/kubernetes.html" class="page">Kubernetes via DNS</a></li>
    <li><a href="../bootstrap/kubernetes-api.html" class="page">Kubernetes API</a></li>
    <li><a href="../bootstrap/istio.html" class="page">Istio</a></li>
  </ul></li>
  <li><a href="../discovery/index.html" class="page">Akka Discovery Methods</a></li>
  <li><a href="../rolling-updates.html" class="page">Rolling Updates</a></li>
  <li><a href="../cluster-http-management.html" class="page">Cluster HTTP Management</a></li>
  <li><a href="../cluster-jmx-management.html" class="page">Built-in JMX Management</a></li>
  <li><a href="../loglevels/index.html" class="page">Dynamic Log Levels</a></li>
  <li><a href="../kubernetes-lease.html" class="page">Kubernetes Lease</a></li>
</ul>
</nav>
</div>
</header>
<div class="site-content-wrapper">
<aside class="sticky-sidebar show-for-large">
<header class="nav-header sticky-sidebar-header">
<div class="nav-header-title">
<h1><a href="../index.html">Akka Management</a></h1>
</div>
<div class="nav-header-version">
Version 1.4.0
</div>
<div class="nav-header-groups">
<select class="supergroup" name="Language"><option class="group" value="group-java">Java</option><option class="group" value="group-scala">Scala</option></select>
</div>
</header>
<nav class="site-nav sticky-sidebar-contents">
<div class="nav-toc">
<ul>
  <li><a href="../index.html#overview" class="header">Overview</a></li>
  <li><a href="../kubernetes-deployment/index.html" class="page">Deploying Akka Cluster to Kubernetes</a></li>
  <li><a href="../akka-management.html" class="page">Akka Management</a></li>
  <li><a href="../migration.html" class="page">Migration guide</a></li>
  <li><a href="../healthchecks.html" class="page">Health checks</a></li>
  <li><a href="../bootstrap/index.html" class="page">Akka Cluster Bootstrap</a>
  <ul>
    <li><a href="../bootstrap/index.html#prerequisites" class="header">Prerequisites</a></li>
    <li><a href="../bootstrap/index.html#project-info" class="header">Project Info</a></li>
    <li><a href="../bootstrap/index.html#dependency" class="header">Dependency</a></li>
    <li><a href="../bootstrap/index.html#using" class="header">Using</a></li>
    <li><a href="../bootstrap/index.html#how-it-works" class="header">How It Works</a></li>
    <li><a href="../bootstrap/index.html#joining-mechanism-precedence" class="header">Joining Mechanism Precedence</a></li>
    <li><a href="../bootstrap/index.html#deployment-considerations" class="header">Deployment considerations</a></li>
    <li><a href="../bootstrap/index.html#bootstrap-recipes" class="header">Bootstrap Recipes</a></li>
    <li><a href="../bootstrap/recipes.html" class="page">Bootstrap environments</a></li>
    <li><a href="../bootstrap/details.html#bootstrap-process" class="active page">Bootstrap process</a>
    <ul>
      <li><a href="../bootstrap/details.html#cluster-formation-in-a-dynamic-environment" class="header">Cluster formation in a dynamic environment</a></li>
      <li><a href="../bootstrap/details.html#customizing-join-behavior" class="header">Customizing Join Behavior</a></li>
    </ul></li>
    <li><a href="../bootstrap/troubleshooting.html" class="page">Troubleshooting</a></li>
    <li><a href="../bootstrap/local-config.html" class="page">Local using config</a></li>
    <li><a href="../bootstrap/kubernetes.html" class="page">Kubernetes via DNS</a></li>
    <li><a href="../bootstrap/kubernetes-api.html" class="page">Kubernetes API</a></li>
    <li><a href="../bootstrap/istio.html" class="page">Istio</a></li>
  </ul></li>
  <li><a href="../discovery/index.html" class="page">Akka Discovery Methods</a></li>
  <li><a href="../rolling-updates.html" class="page">Rolling Updates</a></li>
  <li><a href="../cluster-http-management.html" class="page">Cluster HTTP Management</a></li>
  <li><a href="../cluster-jmx-management.html" class="page">Built-in JMX Management</a></li>
  <li><a href="../loglevels/index.html" class="page">Dynamic Log Levels</a></li>
  <li><a href="../kubernetes-lease.html" class="page">Kubernetes Lease</a></li>
</ul>
</div>
</nav>
<footer class="nav-footer sticky-sidebar-footer">
<a href="https://akka.io"><img class="logo" src="../images/akka-logo-reverse.svg"/></a>

</footer>
</aside>
<main class="fixed-shift-for-large expanded row">
<section class="site-content small-12 column">
<article class="page-content row">
<div class="small-12 column" id="docs">
<h1><a href="#bootstrap-process" name="bootstrap-process" class="anchor"><span class="anchor-link"></span></a>Bootstrap process</h1>
<p>Below is a description of the bootstrap process in more detail. All configuration properties references below are in the <code>akka.management.cluster.bootstrap</code> section. </p>
<ul>
  <li>Each node discovers its &ldquo;neighbours&rdquo; using Akka Discovery
    <ul>
      <li>Some initial negotiation between the nodes must take place to safely form a new cluster when there is no  existing cluster.</li>
    </ul>
  </li>
  <li>The node starts to probe the Contact Points of the discovered nodes (which are HTTP endpoints, exposed via  Akka Management by the Bootstrap Management Extension) for known seeds to join.
    <ul>
      <li>When a cluster exists the seed nodes are returned from probing the discovered Contact Points. It can  immediately join such seed nodes and the following steps for the initial bootstrap are not needed.</li>
    </ul>
  </li>
  <li>When no cluster exists yet, none of the contacted nodes return any seed nodes during the probing process. The following  takes place to create a new cluster:
    <ul>
      <li>A service discovery lookup is done every <code>contact-point-discovery.interval</code></li>
      <li>If discovery returns the same Contact Points for the <code>contact-point-discovery.stable-margin</code>. This is to prevent  join decisions being made based on fluctuating Contact Points.</li>
      <li>At least <code>contact-point-discovery.required-contact-point-nr</code> nodes have been discovered.</li>
      <li>Communication with all discovered Contact Points have been confirmed via successful HTTP request-response.</li>
      <li>Each node will discover that no cluster exists by probing each other and getting no <code>seed-nodes</code>,  and a new one should be formed,  they know all their addresses, and decide that the &ldquo;lowest&rdquo; sorted address is to start forming the cluster.</li>
      <li>The lowest address node (e.g. &ldquo;A&rdquo;) notices the same, and makes the decision to <em>join itself</em>.</li>
      <li>Once the lowest addressed node has joined itself, it has formed a new cluster.</li>
      <li>Other nodes notice that A has started returning <em>itself</em> as a seed-node in the Contact Point responses.</li>
      <li>Any node, including X, immediately joins such seed node that it has observed in the Contact Point process.</li>
      <li>Nodes continue probing the other nodes, and eventually will notice any of the existing nodes that are part of the cluster,  and immediately join it.</li>
      <li>Eventually all nodes have joined the same cluster, the process is complete.</li>
    </ul>
  </li>
</ul>
<p>The illustration below may be of help in visualising this process:</p>
<p><img src="../images/bootstrap-forming-cluster.png" alt="project structure" /></p>
<h2><a href="#cluster-formation-in-a-dynamic-environment" name="cluster-formation-in-a-dynamic-environment" class="anchor"><span class="anchor-link"></span></a>Cluster formation in a dynamic environment</h2>
<p>It is important to realise no <em>dynamic and automatic</em> cluster joining solution provides 100% safety, however the process presented here is very close to it. Please note that the often used claim of using a consistent data store for the seed-nodes also is not 100% safe (sic!), since races could occur between the node having discovered a node from the strongly consistent store and attempting the join operation.</p>
<p>Akka bootstrap&rsquo;s solution is prone to very few and rather rare races. Built-in protection against the race cases exists in the form of the stable timeout, which means that if any changes are being observed in discovery, the decision making is delayed until the observation is stable again. This prevents initiating joining while discovery is still inconsistent.</p>
<p>Note also that the bootstrap process does NOT rely on full consistency of the discovery mechanism when adding new nodes to an existing cluster. This is very desirable, since this situation usually occurs when dynamically scaling up due to increased load on your service, and some services may indeed not be fully consistent then. However, the Akka Cluster membership protocol IS strongly consistent, and it is the source of truth with regards what the cluster is consisting of, and no external system can have more reliable information about this (since it could be outdated). This is why the Contact Point probing mechanism exists, and even if discovery would only return <em>partial</em> or even <em>different set of nodes for each lookup</em> the probing would allow the node still to join all the right nodes, thanks to how Akka Cluster&rsquo;s membership and gossip protocols work. Summing up, the bootstrap mechanism works well for adding nodes to the system, even under load, even if the DNS system is not completely consistent. </p>
<p>If however we are talking about an inconsistent DNS lookup response during the Initial Bootstrap, the nodes will be delayed forming the cluster as they expect the lookups to be consistent, this is checked by the stable-margin configuration option.</p><div class="callout note "><div class="callout-title">Note</div>
<p>It <em>is</em> crucial for the nodes to have a consistent view of their neighbours for the Initial Bootstrap. Otherwise  multiple nodes could self-join and start multiple clusters.</p></div>
<h2><a href="#customizing-join-behavior" name="customizing-join-behavior" class="anchor"><span class="anchor-link"></span></a>Customizing Join Behavior</h2>
<p>The above section explains the default <code>JoinDecider</code> implementation. It is possible to replace the implementation with configuration property <code>join-decider.class</code>. See <code>reference.conf</code> and API documentation.</p>
</div>
</article>
<div class="row">
<div class="small-12 column">
<section class="nav-prev-next row">
<div class="nav-prev small-6 column">
<a href="../bootstrap/recipes.html"><i class="icon-prev"></i> <span class="link-prev">Bootstrap environments</span></a>
</div>
<div class="nav-next small-6 column clearfix">
<a class="float-right" href="../bootstrap/troubleshooting.html">Troubleshooting <i class="icon-next"></i></a>
</div>
</section>
</div>
</div>
<div class="source-github row">
Found an error in this documentation? The source code for this page can be found <a href="https://github.com/akka/akka-management/tree/v1.4.0/docs/src/main/paradox/bootstrap/details.md">here</a>.
Please feel free to edit and contribute a pull request.
</div>

<footer class="page-footer row clearfix">
<img class="akka-icon float-left show-for-medium" src="../images/akka-icon.svg" />
<section class="copyright">
<div>Akka Management is available under the <a href="https://www.lightbend.com/akka/license" target="_blank">Business Source License 1.1</a>.</div>
<p class="legal">
&copy; 2011-2023 <a href="https://www.lightbend.com" target="_blank">Lightbend, Inc.</a> |
<a href="https://www.lightbend.com/legal/licenses" target="_blank">Licenses</a> |
<a href="https://www.lightbend.com/legal/terms" target="_blank">Terms</a> |
<a href="https://www.lightbend.com/legal/privacy" target="_blank">Privacy Policy</a> |
<a href="https://akka.io/cookie/" target="_blank">Cookie Listing</a> |
<a class="optanon-toggle-display">Cookie Settings</a>
</p>
</section>

</footer>
</section>
</main>
</div>

<script type="text/javascript" src="../js/scrollsneak.js"></script>
<script type="text/javascript">jQuery(document).foundation();</script>
<script type="text/javascript" src="../js/groups.js"></script>
<script type="text/javascript" src="../js/page.js"></script>
<script type="text/javascript" src="../js/snippets.js"></script>
<script type="text/javascript" src="../js/magellan.js"></script>
<script type="text/javascript" src="../js/metadata-toggle.js"></script>
<script type="text/javascript" src="../js/lbHeader.js"></script>

<style type="text/css">@import "../lib/prettify/prettify.css";</style>
<script type="text/javascript" src="../lib/prettify/prettify.js"></script>
<script type="text/javascript" src="../lib/prettify/lang-scala.js"></script>
<script type="text/javascript">//<![CDATA[
jQuery(function(){window.prettyPrint && prettyPrint()});
//]]></script>
<script type="text/javascript" src="../assets/js/warnOldVersion.js"></script>
<script type="text/javascript">//<![CDATA[
jQuery(function(jq){initOldVersionWarnings(jq, '1.4.0', 'https://doc.akka.io/docs/akka-management/current/')});
//]]></script>


</body>
</html>
