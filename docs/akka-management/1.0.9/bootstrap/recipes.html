<!DOCTYPE html>
<html class="no-js" lang="en">

<head>
<title>Bootstrap environments &bull; Akka Management</title>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<meta name="description" content="Akka Management is a suite of tools for operating Akka Clusters."/>
<link rel="canonical" href="https://doc.akka.io/docs/akka-management/current/bootstrap/recipes.html"/>
<script type="text/javascript" src="../lib/jquery/jquery.min.js"></script>
<script type="text/javascript" src="../lib/foundation/dist/js/foundation.min.js"></script>
<link rel="stylesheet" type="text/css" href="../lib/normalize.css/normalize.css"/>
<link rel="stylesheet" type="text/css" href="../lib/foundation/dist/css/foundation.min.css"/>
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.css" />
<link rel="stylesheet" type="text/css" href="../css/icons.css"/>
<link rel="stylesheet" type="text/css" href="../css/page-7.css"/>
<link rel="stylesheet" type="text/css" href="../css/banner-1.css"/>
<link rel="shortcut icon" href="../images/favicon.ico" />
<link rel="apple-touch-icon" sizes="180x180" href="../images/apple-touch-icon.png"/>
<link rel="icon" type="image/png" sizes="32x32" href="../images/favicon-32x32.png"/>
<link rel="icon" type="image/png" sizes="16x16" href="../images/favicon-16x16.png"/>
<link rel="manifest" href="../images/manifest.json"/>
<meta name="msapplication-TileImage" content="../images/mstile-150x150.png"/>
<meta name="msapplication-TileColor" content="#15a9ce"/>
<meta name="theme-color" content="#15a9ce"/>
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>
<!-- OneTrust Cookies Consent Notice (Production Standard, akka.io, en-GB) start -->
<script src="https://optanon.blob.core.windows.net/consent/159bb13d-6748-4399-806e-ac28db879785.js" type="text/javascript" charset="UTF-8"></script>
<script type="text/javascript">
function OptanonWrapper() { }
</script>
<!-- OneTrust Cookies Consent Notice (Production Standard, akka.io, en-GB) end -->
<!--Google Analytics-->
<script type="text/plain" class="optanon-category-2">
var _gaq = _gaq || [];
_gaq.push(['_setAccount', '']);
_gaq.push(['_setDomainName', '']);
_gaq.push(['_trackPageview']);
(function() {
var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})()
</script>
<!-- Google Tag Manager -->
<script type="text/plain" class="optanon-category-2">
(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-KBJGH35');
</script>
<!--Marketo-->
<script type="text/plain" class="optanon-category-3">
(function() {
var didInit = false;
function initMunchkin() {
if(didInit === false) {
didInit = true;
Munchkin.init('558-NCX-702', { 'asyncOnly': true, 'disableClickDelay': true });
}
}
var s = document.createElement('script');
s.type = 'text/javascript';
s.async = true;
s.src = '//munchkin.marketo.net/munchkin.js';
s.onreadystatechange = function() {
if (this.readyState == 'complete' || this.readyState == 'loaded') {
initMunchkin();
}
};
s.onload = initMunchkin;
document.getElementsByTagName('head')[0].appendChild(s);
})();
</script>
</head>

<body id="underlay" data-toggler="nav-open">
<div id="lightbend-banner" class="lightbend-banner akka full-width" data-category="OSS Lightbend Banner Impression" data-label="Akka Banner Impression">
<div class="wrapper">
<div class="brand">
<a class="oss-track-link-label" data-category="OSS Lightbend Banner Clicks" data-label="Lightbend Logo - Akka Banner" href="https://www.lightbend.com?r=oss-banner-akka" target="_blank">
<img class="lightbend-logo" src="../images/banner-logos/lightbend-reverse.svg" alt="Lightbend" title="Lightbend">
</a>
</div>
<div class="nav">
<a class="banner-btn oss-track-link-label" data-category="OSS Lightbend Banner Clicks" data-label="Enhance your Akka systems with Akka Platform [Button] - Akka Banner" href="https://www.lightbend.com/akka-platform?r=oss-banner-akka" target="_blank">
<span>Enhance your Akka systems with</span>
<img class="akka-platform-reverse-logo" src="../images/banner-logos/akka-platform-reverse.svg" alt="Akka Platform" title="Akka Platform">
</a>
<div class="drop-down">
<svg class="svg-chevon-circle-down" version="1.1" id="Chevron_circled_down" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 20 20" enable-background="new 0 0 20 20" xml:space="preserve">
<path fill="#ffffff" d="M12.505,8.698L10,11L7.494,8.698c-0.198-0.196-0.518-0.196-0.718,0c-0.197,0.196-0.197,0.515,0,0.71l2.864,2.807
c0.199,0.196,0.52,0.196,0.717,0l2.864-2.807c0.199-0.195,0.198-0.514,0-0.71C13.024,8.502,12.704,8.502,12.505,8.698z M10,0.4
c-5.302,0-9.6,4.298-9.6,9.6c0,5.303,4.298,9.6,9.6,9.6s9.6-4.297,9.6-9.6C19.6,4.698,15.302,0.4,10,0.4z M10,18.354
c-4.615,0-8.354-3.74-8.354-8.354c0-4.614,3.739-8.354,8.354-8.354c4.613,0,8.354,3.74,8.354,8.354
C18.354,14.614,14.613,18.354,10,18.354z" />
</svg>
<div class="drop-down-content">
<div class="lightbend-family">
<a href="https://cloudflow.io" class="cloudflow oss-track-link-label" data-category="OSS Lightbend Banner Clicks" data-label="Cloudflow - Logo Tag Line - Akka Banner">
<img class="cloudflow-full-color-logo" src="../images/banner-logos/cloudflow-full-color.svg" alt="Cloudflow by Lightbend" title="Cloudflow by Lightbend">
</a>
<a href="https://cloudstate.io" class="cloudstate oss-track-link-label" data-category="OSS Lightbend Banner Clicks" data-label="Cloudstate - Logo Tag Line - Akka Banner">
<img class="cloudstate-full-color-logo" src="../images/banner-logos/cloudstate-full-color.svg" alt="Cloudstate by Lightbend" title="Cloudstate by Lightbend">
</a>
<a href="https://www.lagomframework.com" class="lagom oss-track-link-label" data-category="OSS Lightbend Banner Clicks" data-label="Lagom - Logo Tag Line - Akka Banner">
<img class="lagom-full-color-logo" src="../images/banner-logos/lagom-full-color.svg" alt="Lagom Framework by Lightbend" title="Lagom Framework by Lightbend">
</a>
<a href="https://www.playframework.com" class="play oss-track-link-label" data-category="OSS Lightbend Banner Clicks" data-label="Play - Logo Tag Line - Akka Banner">
<img class="play-full-color-logo" src="../images/banner-logos/play-full-color.svg" alt="Play Framework by Lightbend" title="Play Framework by Lightbend">
</a>
<a href="https://www.scala-lang.org" class="scala oss-track-link-label" data-category="OSS Lightbend Banner Clicks" data-label="Scala - Logo Tag Line - Akka Banner">
<img class="scala-full-color-logo" src="../images/banner-logos/scala-full-color.svg" alt="Scala by Lightbend" title="Scala by Lightbend">
</a>
<div class="akka current">
<img class="akka-full-color-logo" src="../images/banner-logos/akka-full-color.svg" alt="Akka by Lightbend" title="Akka by Lightbend">
<span>From the creators of <strong>Akka</strong>, get technology enhancements, monitoring, and expert support with Akka Platform from Lightbend.</span>
<a class="oss-track-link-label" data-category="OSS Lightbend Banner Clicks" data-label="Learn More [Button] - Akka Banner" href="https://www.lightbend.com/akka-platform?r=oss-banner-akka" target="_blank">Learn More</a>
</div>
</div>
<div class="title">The Lightbend Family</div>
</div>      
</div>
</div>
</div>
</div>

<header class="site-header hide-for-large">
<div class="sticky-header clearfix">
<a href="https://akka.io"><img class="logo" src="../images/akka-logo-reverse.svg"/></a>

<button class="menu-icon float-right" type="button" data-toggle="underlay overlay"></button>
</div>
<div id="overlay" class="overlay-nav" data-toggler="nav-open">
<header class="nav-header">
<div class="nav-header-title">
<h1><a href="../index.html">Akka Management</a></h1>
</div>
<div class="nav-header-version">
Version 1.0.9
</div>
<div class="nav-header-groups">
<select class="supergroup" name="Language"><option class="group" value="group-java">Java</option><option class="group" value="group-scala">Scala</option></select>
</div>
</header>
<nav class="nav-toc">
<ul>
  <li><a href="../index.html#overview" class="header">Overview</a></li>
  <li><a href="../kubernetes-deployment/index.html" class="page">Deploying Akka Cluster to Kubernetes</a></li>
  <li><a href="../akka-management.html" class="page">Akka Management</a></li>
  <li><a href="../migration.html" class="page">Migration guide</a></li>
  <li><a href="../healthchecks.html" class="page">Health checks</a></li>
  <li><a href="../bootstrap/index.html" class="page">Akka Cluster Bootstrap</a>
  <ul>
    <li><a href="../bootstrap/index.html#prerequisites" class="header">Prerequisites</a></li>
    <li><a href="../bootstrap/index.html#project-info" class="header">Project Info</a></li>
    <li><a href="../bootstrap/index.html#dependency" class="header">Dependency</a></li>
    <li><a href="../bootstrap/index.html#using" class="header">Using</a></li>
    <li><a href="../bootstrap/index.html#how-it-works" class="header">How It Works</a></li>
    <li><a href="../bootstrap/index.html#joining-mechanism-precedence" class="header">Joining Mechanism Precedence</a></li>
    <li><a href="../bootstrap/index.html#deployment-considerations" class="header">Deployment considerations</a></li>
    <li><a href="../bootstrap/index.html#bootstrap-recipes" class="header">Bootstrap Recipes</a></li>
    <li><a href="../bootstrap/recipes.html#bootstrap-environments" class="active page">Bootstrap environments</a>
    <ul>
      <li><a href="../bootstrap/recipes.html#local" class="header">Local</a></li>
      <li><a href="../bootstrap/recipes.html#running-akka-cluster-in-kubernetes" class="header">Running Akka Cluster in Kubernetes</a></li>
    </ul></li>
    <li><a href="../bootstrap/details.html" class="page">Bootstrap process</a></li>
    <li><a href="../bootstrap/troubleshooting.html" class="page">Troubleshooting</a></li>
    <li><a href="../bootstrap/local-config.html" class="page">Local using config</a></li>
    <li><a href="../bootstrap/kubernetes.html" class="page">Kubernetes via DNS</a></li>
    <li><a href="../bootstrap/kubernetes-api.html" class="page">Kubernetes API</a></li>
    <li><a href="../bootstrap/istio.html" class="page">Istio</a></li>
  </ul></li>
  <li><a href="../discovery/index.html" class="page">Akka Discovery Methods</a></li>
  <li><a href="../cluster-http-management.html" class="page">Cluster HTTP Management</a></li>
  <li><a href="../cluster-jmx-management.html" class="page">Built-in JMX Management</a></li>
  <li><a href="../loglevels.html" class="page">Dynamic Log Levels</a></li>
  <li><a href="../kubernetes-lease.html" class="page">Kubernetes Lease</a></li>
</ul>
</nav>
</div>
</header>
<div class="site-content-wrapper">
<aside class="sticky-sidebar show-for-large">
<header class="nav-header sticky-sidebar-header">
<div class="nav-header-title">
<h1><a href="../index.html">Akka Management</a></h1>
</div>
<div class="nav-header-version">
Version 1.0.9
</div>
<div class="nav-header-groups">
<select class="supergroup" name="Language"><option class="group" value="group-java">Java</option><option class="group" value="group-scala">Scala</option></select>
</div>
</header>
<nav class="site-nav sticky-sidebar-contents">
<div class="nav-toc">
<ul>
  <li><a href="../index.html#overview" class="header">Overview</a></li>
  <li><a href="../kubernetes-deployment/index.html" class="page">Deploying Akka Cluster to Kubernetes</a></li>
  <li><a href="../akka-management.html" class="page">Akka Management</a></li>
  <li><a href="../migration.html" class="page">Migration guide</a></li>
  <li><a href="../healthchecks.html" class="page">Health checks</a></li>
  <li><a href="../bootstrap/index.html" class="page">Akka Cluster Bootstrap</a>
  <ul>
    <li><a href="../bootstrap/index.html#prerequisites" class="header">Prerequisites</a></li>
    <li><a href="../bootstrap/index.html#project-info" class="header">Project Info</a></li>
    <li><a href="../bootstrap/index.html#dependency" class="header">Dependency</a></li>
    <li><a href="../bootstrap/index.html#using" class="header">Using</a></li>
    <li><a href="../bootstrap/index.html#how-it-works" class="header">How It Works</a></li>
    <li><a href="../bootstrap/index.html#joining-mechanism-precedence" class="header">Joining Mechanism Precedence</a></li>
    <li><a href="../bootstrap/index.html#deployment-considerations" class="header">Deployment considerations</a></li>
    <li><a href="../bootstrap/index.html#bootstrap-recipes" class="header">Bootstrap Recipes</a></li>
    <li><a href="../bootstrap/recipes.html#bootstrap-environments" class="active page">Bootstrap environments</a>
    <ul>
      <li><a href="../bootstrap/recipes.html#local" class="header">Local</a></li>
      <li><a href="../bootstrap/recipes.html#running-akka-cluster-in-kubernetes" class="header">Running Akka Cluster in Kubernetes</a></li>
    </ul></li>
    <li><a href="../bootstrap/details.html" class="page">Bootstrap process</a></li>
    <li><a href="../bootstrap/troubleshooting.html" class="page">Troubleshooting</a></li>
    <li><a href="../bootstrap/local-config.html" class="page">Local using config</a></li>
    <li><a href="../bootstrap/kubernetes.html" class="page">Kubernetes via DNS</a></li>
    <li><a href="../bootstrap/kubernetes-api.html" class="page">Kubernetes API</a></li>
    <li><a href="../bootstrap/istio.html" class="page">Istio</a></li>
  </ul></li>
  <li><a href="../discovery/index.html" class="page">Akka Discovery Methods</a></li>
  <li><a href="../cluster-http-management.html" class="page">Cluster HTTP Management</a></li>
  <li><a href="../cluster-jmx-management.html" class="page">Built-in JMX Management</a></li>
  <li><a href="../loglevels.html" class="page">Dynamic Log Levels</a></li>
  <li><a href="../kubernetes-lease.html" class="page">Kubernetes Lease</a></li>
</ul>
</div>
</nav>
<footer class="nav-footer sticky-sidebar-footer">
<a href="https://akka.io"><img class="logo" src="../images/akka-logo-reverse.svg"/></a>

</footer>
</aside>
<main class="fixed-shift-for-large expanded row">
<section class="site-content small-12 column">
<article class="page-content row">
<div class="small-12 column" id="docs">
<h1><a href="#bootstrap-environments" name="bootstrap-environments" class="anchor"><span class="anchor-link"></span></a>Bootstrap environments</h1>
<p>A set of integration tests projects can be found in <a href="https://github.com/akka/akka-management/tree/master/integration-test">integration-test folder of the Akka Management project</a>. These test various Akka management features together in various environments such as Kubernetes.</p>
<p>The following samples exist as standalone projects:</p>
<ul>
  <li><a href="https://github.com/akka/akka-sample-cluster-kubernetes-java">Akka Cluster bootstrap using the Kubernetes API with Java/Maven</a></li>
  <li><a href="https://github.com/akka/akka-sample-cluster-kubernetes-dns-java">Akka Cluster bootstrap using DNS in Kubernetes</a></li>
</ul>
<h2><a href="#local" name="local" class="anchor"><span class="anchor-link"></span></a>Local</h2>
<p>To run Bootstrap locally without any dependencies such as DNS or Kubernetes see the <a href="local-config.html"><code>local</code> example</a></p>
<h2><a href="#running-akka-cluster-in-kubernetes" name="running-akka-cluster-in-kubernetes" class="anchor"><span class="anchor-link"></span></a>Running Akka Cluster in Kubernetes</h2>
<p>The goal of bootstrap is to support running Akka Cluster in Kubernetes as if it is a stateless application. The part bootstrap solves is creating the initial cluster and handling scaling and re-deploys gracefully.</p>
<p>The recommended approach is to:</p>
<ul>
  <li>Use a Deployment for creating the pods</li>
  <li>Use either the Kubernetes API or DNS for contact point discovery (details below)</li>
  <li>Optionally use a service or ingress for any for traffic coming from outside of the Akka Cluster e.g. gRPC and HTTP</li>
</ul>
<h3><a href="#example-project" name="example-project" class="anchor"><span class="anchor-link"></span></a>Example project</h3>
<p>To get started, it might be helpful to have a look at the <a href="https://developer.lightbend.com/start/?group=akka&project=akka-sample-cluster-kubernetes-java">Akka Cluster on Kubernetes</a> example project.</p>
<h3><a href="#kubernetes-deployment" name="kubernetes-deployment" class="anchor"><span class="anchor-link"></span></a>Kubernetes Deployment</h3>
<p>Use a regular deployment (not a StatefulSet) with the following settings.</p>
<h4><a href="#update-strategy" name="update-strategy" class="anchor"><span class="anchor-link"></span></a>Update strategy</h4>
<p>For small clusters it may make sense to set <code>maxUnavailable</code> to 0 and <code>maxSurge</code> to 1. This means that a new pod is created before removing any existing pods so if the new pod fails the cluster remains at full strength until a rollback happens. For large clusters it may be too slow to do 1 pod at a time.</p>
<p>If using <a href="https://doc.akka.io/docs/akka/current/split-brain-resolver.html">Split Brain Resolver</a> have a <code>maxUnavailable</code> that will not cause downing</p>
<h3><a href="#cluster-singletons" name="cluster-singletons" class="anchor"><span class="anchor-link"></span></a>Cluster singletons</h3>
<p>Deployments order pods by pod state and then time spent ready when deciding which to remove first. This works well with cluster singletons as they are typically removed last and then the cluster singletons move to the the oldest new pod.</p>
<h3><a href="#external-traffic" name="external-traffic" class="anchor"><span class="anchor-link"></span></a>External traffic</h3>
<p>For production traffic e.g. HTTP use a regular service or an alternative ingress mechanism. With an appropriate readiness check this results in traffic not being routed until bootstrap has finished.</p>
<pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/akka-management/tree/v1.0.9/integration-test/kubernetes-dns/kubernetes/akka-cluster.yml#L86-L100" target="_blank" title="Go to snippet source"></a><code class="language-yml">apiVersion: v1
kind: Service
metadata:
  labels:
    app: akka-bootstrap-demo
  name: &quot;integration-test-kubernetes-dns&quot;
spec:
  ports:
  - name: http
    port: 8080
    protocol: TCP
    targetPort: 8080
  selector:
    app: &quot;akka-bootstrap-demo&quot;
  type: LoadBalancer</code></pre>
<p>This will result in a ClusterIP being created and only added to <code>Endpoints</code> when the pods are <code>ready</code></p>
<p>Note that the <code>app</code> is the same for both services as they both refer to the same pods.</p>
<h3><a href="#health-checks" name="health-checks" class="anchor"><span class="anchor-link"></span></a>Health checks</h3>
<p><code>akka-management</code> includes a HTTP route for readiness and liveness checks. <code>akka-management-cluster-http</code> includes readiness check for the Akka Cluster membership. To use it add the following dependency:</p><dl class="dependency"><dt>sbt</dt><dd><pre class="prettyprint"><code class="language-scala">val AkkaManagementVersion = "1.0.9"
libraryDependencies += "com.lightbend.akka.management" %% "akka-management-cluster-http" % AkkaManagementVersion</code></pre></dd><dt>Gradle</dt><dd><pre class="prettyprint"><code class="language-gradle">versions += [
  AkkaManagementVersion: "1.0.9",
  ScalaBinary: "2.12"
]
dependencies {
  compile group: 'com.lightbend.akka.management', name: "akka-management-cluster-http_${versions.ScalaBinary}", version: versions.AkkaManagementVersion
}</code></pre></dd><dt>Maven</dt><dd><pre class="prettyprint"><code class="language-xml">&lt;properties&gt;
  &lt;akka.management.version&gt;1.0.9&lt;/akka.management.version&gt;
  &lt;scala.binary.version&gt;2.12&lt;/scala.binary.version&gt;
&lt;/properties&gt;
&lt;dependency&gt;
  &lt;groupId&gt;com.lightbend.akka.management&lt;/groupId&gt;
  &lt;artifactId&gt;akka-management-cluster-http_${scala.binary.version}&lt;/artifactId&gt;
  &lt;version&gt;${akka.management.version}&lt;/version&gt;
&lt;/dependency&gt;</code></pre></dd></dl>
<p>Akka Cluster HTTP Management can be used with Akka 2.5.31 or 2.6.9 or later. You have to override the following Akka dependencies by defining them explicitly in your build and define the Akka version to the one that you are using. Latest patch version of Akka is recommended and a later version than 2.6.9 can be used.</p><dl class="dependency"><dt>sbt</dt><dd><pre class="prettyprint"><code class="language-scala">val AkkaVersion = "2.6.9"
libraryDependencies ++= Seq(
  "com.typesafe.akka" %% "akka-cluster-sharding" % AkkaVersion,
  "com.typesafe.akka" %% "akka-discovery" % AkkaVersion
)</code></pre></dd><dt>Gradle</dt><dd><pre class="prettyprint"><code class="language-gradle">versions += [
  AkkaVersion: "2.6.9",
  ScalaBinary: "2.12"
]
dependencies {
  compile group: 'com.typesafe.akka', name: "akka-cluster-sharding_${versions.ScalaBinary}", version: versions.AkkaVersion,
  compile group: 'com.typesafe.akka', name: "akka-discovery_${versions.ScalaBinary}", version: versions.AkkaVersion
}</code></pre></dd><dt>Maven</dt><dd><pre class="prettyprint"><code class="language-xml">&lt;properties&gt;
  &lt;akka.version&gt;2.6.9&lt;/akka.version&gt;
  &lt;scala.binary.version&gt;2.12&lt;/scala.binary.version&gt;
&lt;/properties&gt;
&lt;dependency&gt;
  &lt;groupId&gt;com.typesafe.akka&lt;/groupId&gt;
  &lt;artifactId&gt;akka-cluster-sharding_${scala.binary.version}&lt;/artifactId&gt;
  &lt;version&gt;${akka.version}&lt;/version&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
  &lt;groupId&gt;com.typesafe.akka&lt;/groupId&gt;
  &lt;artifactId&gt;akka-discovery_${scala.binary.version}&lt;/artifactId&gt;
  &lt;version&gt;${akka.version}&lt;/version&gt;
&lt;/dependency&gt;</code></pre></dd></dl>
<p>The readiness check is exposed on the Akka Management port as a <code>GET</code> on <code>/ready</code> and the liveness check is a <code>GET</code> on <code>/alive</code></p>
<p>Configure them to be used in your deployment:</p>
<pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/akka-management/tree/v1.0.9/integration-test/kubernetes-dns/kubernetes/akka-cluster.yml#L32-L39" target="_blank" title="Go to snippet source"></a><code class="language-yml">readinessProbe:
  httpGet:
    path: /ready
    port: management
livenessProbe:
  httpGet:
    path: /alive
    port: management</code></pre>
<p>This will mean that a pod won&rsquo;t get traffic until it is part of a cluster, which is important if either <code>ClusterSharding</code> or <code>ClusterSingleton</code> are used.</p>
<h3><a href="#contact-point-discovery" name="contact-point-discovery" class="anchor"><span class="anchor-link"></span></a>Contact point discovery</h3>
<p>Contact point discovery can use either <code>kubernetes</code> or <code>akka-dns</code> service discovery. Details on additional resources required and how they work:</p>
<ul>
  <li><a href="kubernetes-api.html">Kubernetes using <code>kubernetes-api</code> discovery</a></li>
  <li><a href="kubernetes.html">Kubernetes using <code>akka-dns</code> discovery</a></li>
</ul>
<p>Kubernetes-api is the more battle tested mechanism, DNS was added in Akka 2.5.15 and Akka Management 0.18. DNS has the benefit that it is agnostic of Kubernetes so does not require pods be able to communicate with the API server. However it requires a headless service that supports the <code>publishNotReadyAddresses</code> feature. If your Kubernetes setup does not support <code>publishNotReadyAddresses</code> yet then use the <code>kubernetes-api</code> discovery mechanism.</p>
<h3><a href="#running-in-istio" name="running-in-istio" class="anchor"><span class="anchor-link"></span></a>Running in Istio</h3>
<p>For considerations and configuration necessary for bootstrapping an Akka cluster in Istio, see <a href="istio.html">Bootstrapping an Akka cluster in Istio</a>.</p>
<h3><a href="#running-the-kubernetes-demos" name="running-the-kubernetes-demos" class="anchor"><span class="anchor-link"></span></a>Running the Kubernetes demos</h3>
<p>The following steps work for the <code>integration-test/kubernetes-api</code> or the <code>integration-test/kubernetes-dns</code> sub-project:</p>
<p>To run the demo in a real Kubernetes or OpenShift cluster the images must be pushed to a registry that cluster has access to and then <code>kubernetes/akka-cluster.yml</code> (in either sub-project) modified with the full image path.</p>
<p>The following shows how the sample can be run in a local cluster using either <code>minishift</code> or <code>minikube</code>. Unless explicitly stated <code>minikube</code> can be replaced with <code>minishift</code> and <code>kubectl</code> with <code>oc</code> in any of the commands below.</p>
<p>Start <a href="https://github.com/kubernetes/minikube">minikube</a> make sure you have installed and is running:</p>
<pre><code>$ minikube start
</code></pre>
<p>Make sure your shell is configured to target the docker daemon running inside the VM:</p>
<pre><code>$ eval $(minikube docker-env)
</code></pre>
<p>Publish the application docker image locally. If running this project in a real cluster you&rsquo;ll need to publish the image to a repository that is accessible from your Kubernetes cluster and update the <code>kubernetes/akka-cluster.yml</code> with the new image name.</p>
<pre><code>$ sbt shell
&gt; project integration-test-kubernetes-api (or integration-test-kubernetes-dns)
&gt; docker:publishLocal
</code></pre>
<p>You can run multiple different Akka Bootstrap-based applications in the same namespace, alongside any other containers that belong to the same logical application. The resources in <code>kubernetes/akka-cluster.yml</code> are configured to run in the <code>akka-bootstrap-demo-ns</code> namespace. Change that to the namespace you want to deploy to. If you do not have a namespace to run your application in yet, create it:</p>
<pre><code>kubectl create namespace &lt;insert-namespace-name-here&gt;

# and set it as the default for subsequent commands
kubectl config set-context $(kubectl config current-context) --namespace=&lt;insert-namespace-name-here&gt;
</code></pre>
<p>Or if running with <code>minishift</code>:</p>
<pre><code>oc new-project &lt;insert-namespace-name-here&gt;

# and switch to that project to make it the default for subsequent comments
oc project &lt;insert-namespace-name-here&gt;
</code></pre>
<p>Next deploy the application:</p>
<pre><code># minikube using Kubernetes API
kubectl apply -f integration-test/kubernetes-api/kubernetes/akka-cluster.yml

or

# minikube using DNS
kubectl apply -f integration-test/kubernetes-dns/kubernetes/akka-cluster.yml

or

# minishift using Kubernetes API
oc apply -f integration-test/kubernetes-api/kubernetes/akka-cluster.yaml

or

# minishift using DNS
oc apply -f integration-test/kubernetes-dns/kubernetes/akka-cluster.yaml
</code></pre>
<p>This will create and start running a number of Pods hosting the application. The application nodes will form a cluster.</p>
<p>In order to observe the logs during the cluster formation you can pick one of the pods and issue the kubectl logs command on it:</p>
<pre><code>$ POD=$(kubectl get pods | grep akka-bootstrap | grep Running | head -n1 | awk &#39;{ print $1 }&#39;); echo $POD
akka-integration-test-bcc456d8c-6qx87

$ kubectl logs $POD --follow | less
</code></pre>
<pre><code>[INFO] [12/13/2018 07:13:42.867] [main] [ClusterBootstrap(akka://default)] Initiating bootstrap procedure using akka.discovery.akka-dns method...
[DEBUG] [12/13/2018 07:13:42.906] [default-akka.actor.default-dispatcher-2] [TimerScheduler(akka://default)] Start timer [resolve-key] with generation [1]
[DEBUG] [12/13/2018 07:13:42.919] [default-akka.actor.default-dispatcher-2] [TimerScheduler(akka://default)] Start timer [decide-key] with generation [2]
[INFO] [12/13/2018 07:13:42.924] [default-akka.actor.default-dispatcher-2] [akka.tcp://default@172.17.0.7:2552/system/bootstrapCoordinator] Locating service members. Using discovery [akka.discovery.dns.DnsSimpleServiceDiscovery], join decider [akka.management.cluster.bootstrap.LowestAddressJoinDecider]
[INFO] [12/13/2018 07:13:42.933] [default-akka.actor.default-dispatcher-2] [akka.tcp://default@172.17.0.7:2552/system/bootstrapCoordinator] Looking up [Lookup(integration-test-kubernetes-dns-internal.akka-bootstrap.svc.cluster.local,Some(management),Some(tcp))]
[DEBUG] [12/13/2018 07:13:42.936] [default-akka.actor.default-dispatcher-2] [DnsSimpleServiceDiscovery(akka://default)] Lookup [Lookup(integration-test-kubernetes-dns-internal.akka-bootstrap-demo-ns.svc.cluster.local,Some(management),Some(tcp))] translated to SRV query [_management._tcp.integration-test-kubernetes-dns-internal.akka-bootstrap-demo-ns.svc.cluster.local] as contains portName and protocol
[DEBUG] [12/13/2018 07:13:42.995] [default-akka.actor.default-dispatcher-18] [akka.tcp://default@172.17.0.7:2552/system/IO-DNS] Resolution request for _management._tcp.integration-test-kubernetes-dns-internal.akka-bootstrap-demo-ns.svc.cluster.local Srv from Actor[akka://default/temp/$a]
[DEBUG] [12/13/2018 07:13:43.011] [default-akka.actor.default-dispatcher-6] [akka.tcp://default@172.17.0.7:2552/system/IO-DNS/async-dns/$a] Attempting to resolve _management._tcp.integration-test-kubernetes-dns-internal.akka-bootstrap-demo-ns.svc.cluster.local with Actor[akka://default/system/IO-DNS/async-dns/$a/$a#1272991285]
[DEBUG] [12/13/2018 07:13:43.049] [default-akka.actor.default-dispatcher-18] [akka.tcp://default@172.17.0.7:2552/system/IO-TCP/selectors/$a/0] Successfully bound to /0.0.0.0:8558
[DEBUG] [12/13/2018 07:13:43.134] [default-akka.actor.default-dispatcher-18] [akka.tcp://default@172.17.0.7:2552/system/IO-DNS/async-dns/$a/$a] Resolving [_management._tcp.integration-test-kubernetes-dns-internal.akka-bootstrap-demo-ns.svc.cluster.local] (SRV)
[INFO] [12/13/2018 07:13:43.147] [default-akka.actor.default-dispatcher-6] [AkkaManagement(akka://default)] Bound Akka Management (HTTP) endpoint to: 0.0.0.0:8558
[DEBUG] [12/13/2018 07:13:43.156] [default-akka.actor.default-dispatcher-5] [akka.tcp://default@172.17.0.7:2552/system/IO-TCP/selectors/$a/1] Successfully bound to /0.0.0.0:8080
[INFO] [12/13/2018 07:13:43.180] [main] [akka.actor.ActorSystemImpl(default)] Server online at http://localhost:8080/
....
[INFO] [12/13/2018 07:13:50.631] [default-akka.actor.default-dispatcher-5] [akka.cluster.Cluster(akka://default)] Cluster Node [akka.tcp://default@172.17.0.7:2552] - Welcome from [akka.tcp://default@172.17.0.6:2552]
[DEBUG] [12/13/2018 07:13:50.644] [default-akka.remote.default-remote-dispatcher-22] [akka.serialization.Serialization(akka://default)] Using serializer [akka.cluster.protobuf.ClusterMessageSerializer] for message [akka.cluster.GossipEnvelope]
[INFO] [12/13/2018 07:13:50.659] [default-akka.actor.default-dispatcher-18] [akka.tcp://default@172.17.0.7:2552/user/$b] Cluster akka.tcp://default@172.17.0.7:2552 &gt;&gt;&gt; MemberUp(Member(address = akka.tcp://default@172.17.0.6:2552, status = Up))
[INFO] [12/13/2018 07:13:50.676] [default-akka.actor.default-dispatcher-20] [akka.tcp://default@172.17.0.7:2552/user/$b] Cluster akka.tcp://default@172.17.0.7:2552 &gt;&gt;&gt; MemberJoined(Member(address = akka.tcp://default@172.17.0.7:2552, status = Joining))
[INFO] [12/13/2018 07:13:50.716] [default-akka.actor.default-dispatcher-6] [akka.tcp://default@172.17.0.7:2552/user/$b] Cluster akka.tcp://default@172.17.0.7:2552 &gt;&gt;&gt; LeaderChanged(Some(akka.tcp://default@172.17.0.6:2552))
[INFO] [12/13/2018 07:13:50.720] [default-akka.actor.default-dispatcher-3] [akka.tcp://default@172.17.0.7:2552/user/$b] Cluster akka.tcp://default@172.17.0.7:2552 &gt;&gt;&gt; RoleLeaderChanged(dc-default,Some(akka.tcp://default@172.17.0.6:2552))
[INFO] [12/13/2018 07:13:50.727] [default-akka.actor.default-dispatcher-6] [akka.tcp://default@172.17.0.7:2552/user/$b] Cluster akka.tcp://default@172.17.0.7:2552 &gt;&gt;&gt; SeenChanged(true,Set(akka.tcp://default@172.17.0.6:2552, akka.tcp://default@172.17.0.7:2552))
[INFO] [12/13/2018 07:13:50.733] [default-akka.actor.default-dispatcher-5] [akka.tcp://default@172.17.0.7:2552/user/$b] Cluster akka.tcp://default@172.17.0.7:2552 &gt;&gt;&gt; ReachabilityChanged()
</code></pre>
</div>
</article>
<div class="row">
<div class="small-12 column">
<section class="nav-prev-next row">
<div class="nav-prev small-6 column">
<a href="../bootstrap/index.html"><i class="icon-prev"></i> <span class="link-prev">Akka Cluster Bootstrap</span></a>
</div>
<div class="nav-next small-6 column clearfix">
<a class="float-right" href="../bootstrap/details.html">Bootstrap process <i class="icon-next"></i></a>
</div>
</section>
</div>
</div>
<div class="source-github row">
Found an error in this documentation? The source code for this page can be found <a href="https://github.com/akka/akka-management/tree/v1.0.9/docs/src/main/paradox/bootstrap/recipes.md">here</a>.
Please feel free to edit and contribute a pull request.
</div>

<footer class="page-footer row clearfix">
<img class="akka-icon float-left show-for-medium" src="../images/akka-icon.svg" />
<section class="copyright">
<div>Akka Management is Open Source and available under the Apache 2 License.</div>
<p class="legal">
&copy; 2011-2020 <a href="https://www.lightbend.com" target="_blank">Lightbend, Inc.</a> |
<a href="https://www.lightbend.com/legal/licenses" target="_blank">Licenses</a> |
<a href="https://www.lightbend.com/legal/terms" target="_blank">Terms</a> |
<a href="https://www.lightbend.com/legal/privacy" target="_blank">Privacy Policy</a> |
<a href="https://akka.io/cookie/" target="_blank">Cookie Listing</a> |
<a class="optanon-toggle-display">Cookie Settings</a>
</p>
</section>

</footer>
</section>
</main>
</div>

<script type="text/javascript" src="../js/scrollsneak.js"></script>
<script type="text/javascript">jQuery(document).foundation();</script>
<script type="text/javascript" src="../js/groups.js"></script>
<script type="text/javascript" src="../js/page.js"></script>
<script type="text/javascript" src="../js/magellan.js"></script>
<script type="text/javascript" src="../js/metadata-toggle.js"></script>

<style type="text/css">@import "../lib/prettify/prettify.css";</style>
<script type="text/javascript" src="../lib/prettify/prettify.js"></script>
<script type="text/javascript" src="../lib/prettify/lang-scala.js"></script>
<script type="text/javascript">//<![CDATA[
jQuery(function(){window.prettyPrint && prettyPrint()});
//]]></script>
<script type="text/javascript" src="../assets/js/warnOldVersion.js"></script>
<script type="text/javascript">//<![CDATA[
jQuery(function(jq){initOldVersionWarnings(jq, '1.0.9', 'https://doc.akka.io/docs/akka-management/current/')});
//]]></script>


</body>
</html>
