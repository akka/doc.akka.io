<!DOCTYPE html>
<html class="no-js" lang="en">

<head>
<title>Preparing for production &bull; Akka Management</title>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<meta name="description" content="Akka Management is a suite of tools for operating Akka Clusters."/>
<link rel="canonical" href="https://doc.akka.io/docs/akka-management/current/kubernetes-deployment/preparing-for-production.html"/>
<script type="text/javascript" src="../lib/jquery/jquery.min.js"></script>
<script type="text/javascript" src="../lib/foundation/dist/js/foundation.min.js"></script>
<link rel="stylesheet" type="text/css" href="../lib/normalize.css/normalize.css"/>
<link rel="stylesheet" type="text/css" href="../lib/foundation/dist/css/foundation.min.css"/>
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.css" />
<link rel="stylesheet" type="text/css" href="../css/icons.css"/>
<link rel="stylesheet" type="text/css" href="../css/page-8.css"/>
<link rel="stylesheet" type="text/css" href="../css/banner-2.css"/>
<link rel="shortcut icon" href="../images/favicon.ico" />
<link rel="apple-touch-icon" sizes="180x180" href="../images/apple-touch-icon.png"/>
<link rel="icon" type="image/png" sizes="32x32" href="../images/favicon-32x32.png"/>
<link rel="icon" type="image/png" sizes="16x16" href="../images/favicon-16x16.png"/>
<link rel="manifest" href="../images/manifest.json"/>
<meta name="msapplication-TileImage" content="../images/mstile-150x150.png"/>
<meta name="msapplication-TileColor" content="#15a9ce"/>
<meta name="theme-color" content="#15a9ce"/>
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>
<!-- OneTrust Cookies Consent Notice (Production Standard, akka.io, en-GB) start -->
<script src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js"  type="text/javascript" charset="UTF-8" data-domain-script="28b912e7-09e9-43d5-91e4-3d1897044004" ></script>
<script type="text/javascript">
function OptanonWrapper() { }
</script>
<!-- OneTrust Cookies Consent Notice (Production Standard, akka.io, en-GB) end -->
<!-- Google Tag Manager now loads Google Analytics and any other tracking scripts. GTM also performs respects a users cookie choices-->
<script type="text/javascript">
(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-KBJGH35');
</script>

</head>

<body id="underlay" data-toggler="nav-open">
<div id="lightbend-banner" class="lightbend-banner akka full-width" data-category="OSS Lightbend Banner Impression" data-label="Akka Banner Impression">
<div class="oss-wrapper">
<div class="oss-brand">
<a class="oss-track-link-label" data-category="OSS Lightbend Banner Clicks" data-label="Lightbend Logo - Akka Banner" href="https://www.lightbend.com">
<img class="lightbend-logo" src="../images/banner-logos/lightbend-reverse.svg" alt="Lightbend" title="Lightbend">
</a>
</div>
<div class="oss-ad no-drop-down">
<nav id="lightbendRotator" class="lightbend-rotator">
<a class="oss-track-link-label" data-category="OSS Lightbend Banner Clicks" data-label="Promo Rotator - Introducing Akka Cloud to Edge Continuum. Build once for the Cloud. Seamlessly deploy to the Edge. [Learn more] - Akka Banner" href="https://www.lightbend.com/blog/akka-edge-unifying-the-cloud-and-edge">
Introducing Akka Cloud to Edge Continuum. Build once for the Cloud. Seamlessly deploy to the Edge. <span class="akka-btn">Learn more</span>
</a>
</nav>
</div>
</div>
</div>

<header class="site-header hide-for-large">
<div class="sticky-header clearfix">
<a href="https://akka.io"><img class="logo" src="../images/akka-logo-reverse.svg"/></a>

<button class="menu-icon float-right" type="button" data-toggle="underlay overlay"></button>
</div>
<div id="overlay" class="overlay-nav" data-toggler="nav-open">
<header class="nav-header">
<div class="nav-header-title">
<h1><a href="../index.html">Akka Management</a></h1>
</div>
<div class="nav-header-version">
Version 1.5.1
</div>
<div class="nav-header-groups">
<select class="supergroup" name="Language"><option class="group" value="group-java">Java</option><option class="group" value="group-scala">Scala</option></select>
</div>
</header>
<nav class="nav-toc">
<ul>
  <li><a href="../index.html#overview" class="header">Overview</a></li>
  <li><a href="../kubernetes-deployment/index.html" class="page">Deploying Akka Cluster to Kubernetes</a>
  <ul>
    <li><a href="../kubernetes-deployment/preparing-for-production.html#preparing-for-production" class="active page">Preparing for production</a>
    <ul>
      <li><a href="../kubernetes-deployment/preparing-for-production.html#deployment-spec" class="header">Deployment Spec</a></li>
      <li><a href="../kubernetes-deployment/preparing-for-production.html#image-version-number" class="header">Image version number</a></li>
    </ul></li>
    <li><a href="../kubernetes-deployment/forming-a-cluster.html" class="page">Forming an Akka Cluster</a></li>
    <li><a href="../kubernetes-deployment/building.html" class="page">Building the application</a></li>
    <li><a href="../kubernetes-deployment/deploying.html" class="page">Deploying</a></li>
  </ul></li>
  <li><a href="../akka-management.html" class="page">Akka Management</a></li>
  <li><a href="../migration.html" class="page">Migration guide</a></li>
  <li><a href="../healthchecks.html" class="page">Health checks</a></li>
  <li><a href="../bootstrap/index.html" class="page">Akka Cluster Bootstrap</a></li>
  <li><a href="../discovery/index.html" class="page">Akka Discovery Methods</a></li>
  <li><a href="../rolling-updates.html" class="page">Rolling Updates</a></li>
  <li><a href="../cluster-http-management.html" class="page">Cluster HTTP Management</a></li>
  <li><a href="../cluster-jmx-management.html" class="page">Built-in JMX Management</a></li>
  <li><a href="../loglevels/index.html" class="page">Dynamic Log Levels</a></li>
  <li><a href="../kubernetes-lease.html" class="page">Kubernetes Lease</a></li>
  <li><a href="../native-image.html" class="page">Building Native Images</a></li>
</ul>
</nav>
</div>
</header>
<div class="site-content-wrapper">
<aside class="sticky-sidebar show-for-large">
<header class="nav-header sticky-sidebar-header">
<div class="nav-header-title">
<h1><a href="../index.html">Akka Management</a></h1>
</div>
<div class="nav-header-version">
Version 1.5.1
</div>
<div class="nav-header-groups">
<select class="supergroup" name="Language"><option class="group" value="group-java">Java</option><option class="group" value="group-scala">Scala</option></select>
</div>
</header>
<nav class="site-nav sticky-sidebar-contents">
<div class="nav-toc">
<ul>
  <li><a href="../index.html#overview" class="header">Overview</a></li>
  <li><a href="../kubernetes-deployment/index.html" class="page">Deploying Akka Cluster to Kubernetes</a>
  <ul>
    <li><a href="../kubernetes-deployment/preparing-for-production.html#preparing-for-production" class="active page">Preparing for production</a>
    <ul>
      <li><a href="../kubernetes-deployment/preparing-for-production.html#deployment-spec" class="header">Deployment Spec</a></li>
      <li><a href="../kubernetes-deployment/preparing-for-production.html#image-version-number" class="header">Image version number</a></li>
    </ul></li>
    <li><a href="../kubernetes-deployment/forming-a-cluster.html" class="page">Forming an Akka Cluster</a></li>
    <li><a href="../kubernetes-deployment/building.html" class="page">Building the application</a></li>
    <li><a href="../kubernetes-deployment/deploying.html" class="page">Deploying</a></li>
  </ul></li>
  <li><a href="../akka-management.html" class="page">Akka Management</a></li>
  <li><a href="../migration.html" class="page">Migration guide</a></li>
  <li><a href="../healthchecks.html" class="page">Health checks</a></li>
  <li><a href="../bootstrap/index.html" class="page">Akka Cluster Bootstrap</a></li>
  <li><a href="../discovery/index.html" class="page">Akka Discovery Methods</a></li>
  <li><a href="../rolling-updates.html" class="page">Rolling Updates</a></li>
  <li><a href="../cluster-http-management.html" class="page">Cluster HTTP Management</a></li>
  <li><a href="../cluster-jmx-management.html" class="page">Built-in JMX Management</a></li>
  <li><a href="../loglevels/index.html" class="page">Dynamic Log Levels</a></li>
  <li><a href="../kubernetes-lease.html" class="page">Kubernetes Lease</a></li>
  <li><a href="../native-image.html" class="page">Building Native Images</a></li>
</ul>
</div>
</nav>
<footer class="nav-footer sticky-sidebar-footer">
<a href="https://akka.io"><img class="logo" src="../images/akka-logo-reverse.svg"/></a>

</footer>
</aside>
<main class="fixed-shift-for-large expanded row">
<section class="site-content small-12 column">
<article class="page-content row">
<div class="small-12 column" id="docs">
<h1><a href="#preparing-for-production" name="preparing-for-production" class="anchor"><span class="anchor-link"></span></a>Preparing for production</h1>
<p>In preparation for production, we need to do two main things:</p>
<ol>
  <li>Write a Kubernetes deployment spec</li>
  <li>Configure our Akka cluster application</li>
</ol>
<p>The final configuration file and deployment spec are in the sample application. In this guide we will show snippets. Locations of the samples:</p>
<ul>
  <li><a href="https://developer.lightbend.com/start/?group=akka&project=akka-sample-cluster-kubernetes-java">Java</a></li>
  <li><a href="https://developer.lightbend.com/start/?group=akka&project=akka-sample-cluster-kubernetes-scala">Scala</a></li>
</ul>
<h2><a href="#deployment-spec" name="deployment-spec" class="anchor"><span class="anchor-link"></span></a>Deployment Spec</h2>
<p>Create a deployment spec in <code>kubernetes/akka-cluster.yaml</code>. The following configuration uses:</p>
<ul>
  <li>Application name / Actor system name: <code>appka</code></li>
  <li>Namespace: <code>appka-1</code></li>
</ul>
<p>Change these for your application.</p>
<pre class="prettyprint"><code class="language-yaml">apiVersion: apps/v1
kind: Deployment
metadata:
  labels:
    app: appka
  name: appka
  namespace: appka-1
spec:
  replicas: 2
  selector:
    matchLabels:
      app: appka
  template:
    metadata:
      labels:
        app: appka
    spec:
      containers:
      - name: appka
        image: akka-sample-cluster-kubernetes-scala:latest
        readinessProbe:
          httpGet:
            path: /ready
            port: management
        livenessProbe:
          httpGet:
            path: /alive
            port: management
        ports:
        - name: management
          containerPort: 8558
          protocol: TCP
        - name: http
          containerPort: 8080
          protocol: TCP
        resources:
          limits:
            memory: 1024Mi
          requests:
            cpu: 2
            memory: 1024Mi
</code></pre>
<p>Here are a few things to note:</p>
<ul>
  <li>We&rsquo;re using a Kubernetes deployment. Deployments are logical groupings of pods that represent a single service using the same template.  They support <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.11/#deploymentstrategy-v1-apps">configurable rolling updates</a>,  meaning the cluster will be gradually upgraded, rather than upgrading every node at once and incurring an outage. Be sure to consult <a href="../rolling-updates.html#kubernetes-rolling-updates">Kubernetes Rolling Updates</a> for recommendations.</li>
  <li>We label the pod in the <code>template</code> with <code>app: appka</code>. This must match the ActorSystem name so that <a href="../bootstrap/index.html">Akka Bootstrap</a> finds the other nodes in the cluster.</li>
  <li>The image we&rsquo;re using is <code>akka-sample-cluster-kubernetes:latest</code>. This corresponds to the name and version of the service in our build.  We will discuss how to select an appropriate version number below.</li>
  <li>We&rsquo;ve only requested minimal CPU to the pods for this service. This is suitable for a local deployment, but you may wish to increase it if you&rsquo;re  deploying to a real deployment. Note that we also haven&rsquo;t set a CPU limit, this is because it&rsquo;s  <a href="https://doc.akka.io/docs/akka/current/additional/deploying.html#resource-limits">recommended that JVMs do not set a CPU limit</a>.</li>
  <li>We&rsquo;ve configured a liveness probe and readiness probe. These are provided out of the box by Akka Management and are discussed later.</li>
</ul>
<h2><a href="#image-version-number" name="image-version-number" class="anchor"><span class="anchor-link"></span></a>Image version number</h2>
<p>We use a version tag of <code>latest</code> for the image. Not specifying a tag is the same as using the <code>latest</code> tag. We could have just specify <code>akka-sample-cluster-kubernetes</code>, and this would mean the same thing as <code>akka-sample-cluster-kubernetes:latest</code>.</p>
<p>For production, the use of the <code>latest</code> tag is bad practice. For development, it&rsquo;s convenient and usually fine. We recommend if you&rsquo;re deploying to production, that you replace this with an actual version number that is updated each time you deploy. In the <a href="building.html">Building your application</a> section of this guide we will describe how to configure your build to base its version number off the current git commit hash, which is great especially for continuous deployment scenarios as it means a human doesn&rsquo;t need to be involved in selecting a unique version number. After building the image, you can take the version number generated in that step and update the image referenced in the spec accordingly.</p>
</div>
</article>
<div class="row">
<div class="small-12 column">
<section class="nav-prev-next row">
<div class="nav-prev small-6 column">
<a href="../kubernetes-deployment/index.html"><i class="icon-prev"></i> <span class="link-prev">Deploying Akka Cluster to Kubernetes</span></a>
</div>
<div class="nav-next small-6 column clearfix">
<a class="float-right" href="../kubernetes-deployment/forming-a-cluster.html">Forming an Akka Cluster <i class="icon-next"></i></a>
</div>
</section>
</div>
</div>
<div class="source-github row">
Found an error in this documentation? The source code for this page can be found <a href="https://github.com/akka/akka-management/tree/v1.5.1/docs/src/main/paradox/kubernetes-deployment/preparing-for-production.md">here</a>.
Please feel free to edit and contribute a pull request.
</div>

<footer class="page-footer row clearfix">
<img class="akka-icon float-left show-for-medium" src="../images/akka-icon.svg" />
<section class="copyright">
<div>Akka Management is available under the <a href="https://www.lightbend.com/akka/license" target="_blank">Business Source License 1.1</a>.</div>
<p class="legal">
&copy; 2011-2023 <a href="https://www.lightbend.com" target="_blank">Lightbend, Inc.</a> |
<a href="https://www.lightbend.com/legal/licenses" target="_blank">Licenses</a> |
<a href="https://www.lightbend.com/legal/terms" target="_blank">Terms</a> |
<a href="https://www.lightbend.com/legal/privacy" target="_blank">Privacy Policy</a> |
<a href="https://akka.io/cookie/" target="_blank">Cookie Listing</a> |
<a class="optanon-toggle-display">Cookie Settings</a>
</p>
</section>

</footer>
</section>
</main>
</div>

<script type="text/javascript" src="../js/scrollsneak.js"></script>
<script type="text/javascript">jQuery(document).foundation();</script>
<script type="text/javascript" src="../js/groups.js"></script>
<script type="text/javascript" src="../js/page.js"></script>
<script type="text/javascript" src="../js/snippets.js"></script>
<script type="text/javascript" src="../js/magellan.js"></script>
<script type="text/javascript" src="../js/metadata-toggle.js"></script>
<script type="text/javascript" src="../js/lbHeader.js"></script>

<style type="text/css">@import "../lib/prettify/prettify.css";</style>
<script type="text/javascript" src="../lib/prettify/prettify.js"></script>
<script type="text/javascript" src="../lib/prettify/lang-scala.js"></script>
<script type="text/javascript">//<![CDATA[
jQuery(function(){window.prettyPrint && prettyPrint()});
//]]></script>
<script type="text/javascript" src="../assets/js/warnOldVersion.js"></script>
<script type="text/javascript">//<![CDATA[
jQuery(function(jq){initOldVersionWarnings(jq, '1.5.1', 'https://doc.akka.io/docs/akka-management/current/')});
//]]></script>


</body>
</html>
