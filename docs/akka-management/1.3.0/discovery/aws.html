<!DOCTYPE html>
<html class="no-js" lang="en">

<head>
<title>AWS API &bull; Akka Management</title>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<meta name="description" content="Akka Management is a suite of tools for operating Akka Clusters."/>
<link rel="canonical" href="https://doc.akka.io/docs/akka-management/current/discovery/aws.html"/>
<script type="text/javascript" src="../lib/jquery/jquery.min.js"></script>
<script type="text/javascript" src="../lib/foundation/dist/js/foundation.min.js"></script>
<link rel="stylesheet" type="text/css" href="../lib/normalize.css/normalize.css"/>
<link rel="stylesheet" type="text/css" href="../lib/foundation/dist/css/foundation.min.css"/>
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.css" />
<link rel="stylesheet" type="text/css" href="../css/icons.css"/>
<link rel="stylesheet" type="text/css" href="../css/page-8.css"/>
<link rel="stylesheet" type="text/css" href="../css/banner-2.css"/>
<link rel="shortcut icon" href="../images/favicon.ico" />
<link rel="apple-touch-icon" sizes="180x180" href="../images/apple-touch-icon.png"/>
<link rel="icon" type="image/png" sizes="32x32" href="../images/favicon-32x32.png"/>
<link rel="icon" type="image/png" sizes="16x16" href="../images/favicon-16x16.png"/>
<link rel="manifest" href="../images/manifest.json"/>
<meta name="msapplication-TileImage" content="../images/mstile-150x150.png"/>
<meta name="msapplication-TileColor" content="#15a9ce"/>
<meta name="theme-color" content="#15a9ce"/>
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>
<!-- OneTrust Cookies Consent Notice (Production Standard, akka.io, en-GB) start -->
<script src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js"  type="text/javascript" charset="UTF-8" data-domain-script="28b912e7-09e9-43d5-91e4-3d1897044004" ></script>
<script type="text/javascript">
function OptanonWrapper() { }
</script>
<!-- OneTrust Cookies Consent Notice (Production Standard, akka.io, en-GB) end -->
<!--Google Analytics-->
<script type="text/plain" class="optanon-category-2">
var _gaq = _gaq || [];
_gaq.push(['_setAccount', '']);
_gaq.push(['_setDomainName', '']);
_gaq.push(['_trackPageview']);
(function() {
var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})()
</script>
<!-- Google Tag Manager -->
<script type="text/plain" class="optanon-category-2">
(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-KBJGH35');
</script>
<!--Marketo-->
<script type="text/plain" class="optanon-category-3">
(function() {
var didInit = false;
function initMunchkin() {
if(didInit === false) {
didInit = true;
Munchkin.init('558-NCX-702', { 'asyncOnly': true, 'disableClickDelay': true });
}
}
var s = document.createElement('script');
s.type = 'text/javascript';
s.async = true;
s.src = '//munchkin.marketo.net/munchkin.js';
s.onreadystatechange = function() {
if (this.readyState == 'complete' || this.readyState == 'loaded') {
initMunchkin();
}
};
s.onload = initMunchkin;
document.getElementsByTagName('head')[0].appendChild(s);
})();
</script>
</head>

<body id="underlay" data-toggler="nav-open">
<div id="lightbend-banner" class="lightbend-banner akka full-width" data-category="OSS Lightbend Banner Impression" data-label="Akka Banner Impression">
<div class="oss-wrapper">
<div class="oss-brand">
<a class="oss-track-link-label" data-category="OSS Lightbend Banner Clicks" data-label="Lightbend Logo - Akka Banner" href="https://www.lightbend.com">
<img class="lightbend-logo" src="../images/banner-logos/lightbend-reverse.svg" alt="Lightbend" title="Lightbend">
</a>
</div>
<div class="oss-ad no-drop-down">
<nav id="lightbendRotator" class="lightbend-rotator">
<a class="oss-track-link-label" data-category="OSS Lightbend Banner Clicks" data-label="Promo Rotator - Lightbend is Changing its Software Licensing Model for Akka Technology. [License FAQ] - Akka Banner" href="https://www.lightbend.com/akka/license-faq">
<strong>Lightbend</strong> is Changing its Software Licensing Model for Akka Technology. <span class="akka-btn">License FAQ</span>
</a>
</nav>
</div>
</div>
</div>

<header class="site-header hide-for-large">
<div class="sticky-header clearfix">
<a href="https://akka.io"><img class="logo" src="../images/akka-logo-reverse.svg"/></a>

<button class="menu-icon float-right" type="button" data-toggle="underlay overlay"></button>
</div>
<div id="overlay" class="overlay-nav" data-toggler="nav-open">
<header class="nav-header">
<div class="nav-header-title">
<h1><a href="../index.html">Akka Management</a></h1>
</div>
<div class="nav-header-version">
Version 1.3.0
</div>
<div class="nav-header-groups">
<select class="supergroup" name="Language"><option class="group" value="group-java">Java</option><option class="group" value="group-scala">Scala</option></select>
</div>
</header>
<nav class="nav-toc">
<ul>
  <li><a href="../index.html#overview" class="header">Overview</a></li>
  <li><a href="../kubernetes-deployment/index.html" class="page">Deploying Akka Cluster to Kubernetes</a></li>
  <li><a href="../akka-management.html" class="page">Akka Management</a></li>
  <li><a href="../migration.html" class="page">Migration guide</a></li>
  <li><a href="../healthchecks.html" class="page">Health checks</a></li>
  <li><a href="../bootstrap/index.html" class="page">Akka Cluster Bootstrap</a></li>
  <li><a href="../discovery/index.html" class="page">Akka Discovery Methods</a>
  <ul>
    <li><a href="../discovery/kubernetes.html" class="page">Kubernetes API</a></li>
    <li><a href="../discovery/consul.html" class="page">Consul</a></li>
    <li><a href="../discovery/marathon.html" class="page">Marathon API</a></li>
    <li><a href="../discovery/aws.html#aws-api" class="active page">AWS API</a>
    <ul>
      <li><a href="../discovery/aws.html#project-info" class="header">Project Info</a></li>
    </ul></li>
  </ul></li>
  <li><a href="../rolling-updates.html" class="page">Rolling Updates</a></li>
  <li><a href="../cluster-http-management.html" class="page">Cluster HTTP Management</a></li>
  <li><a href="../cluster-jmx-management.html" class="page">Built-in JMX Management</a></li>
  <li><a href="../loglevels/index.html" class="page">Dynamic Log Levels</a></li>
  <li><a href="../kubernetes-lease.html" class="page">Kubernetes Lease</a></li>
</ul>
</nav>
</div>
</header>
<div class="site-content-wrapper">
<aside class="sticky-sidebar show-for-large">
<header class="nav-header sticky-sidebar-header">
<div class="nav-header-title">
<h1><a href="../index.html">Akka Management</a></h1>
</div>
<div class="nav-header-version">
Version 1.3.0
</div>
<div class="nav-header-groups">
<select class="supergroup" name="Language"><option class="group" value="group-java">Java</option><option class="group" value="group-scala">Scala</option></select>
</div>
</header>
<nav class="site-nav sticky-sidebar-contents">
<div class="nav-toc">
<ul>
  <li><a href="../index.html#overview" class="header">Overview</a></li>
  <li><a href="../kubernetes-deployment/index.html" class="page">Deploying Akka Cluster to Kubernetes</a></li>
  <li><a href="../akka-management.html" class="page">Akka Management</a></li>
  <li><a href="../migration.html" class="page">Migration guide</a></li>
  <li><a href="../healthchecks.html" class="page">Health checks</a></li>
  <li><a href="../bootstrap/index.html" class="page">Akka Cluster Bootstrap</a></li>
  <li><a href="../discovery/index.html" class="page">Akka Discovery Methods</a>
  <ul>
    <li><a href="../discovery/kubernetes.html" class="page">Kubernetes API</a></li>
    <li><a href="../discovery/consul.html" class="page">Consul</a></li>
    <li><a href="../discovery/marathon.html" class="page">Marathon API</a></li>
    <li><a href="../discovery/aws.html#aws-api" class="active page">AWS API</a>
    <ul>
      <li><a href="../discovery/aws.html#project-info" class="header">Project Info</a></li>
    </ul></li>
  </ul></li>
  <li><a href="../rolling-updates.html" class="page">Rolling Updates</a></li>
  <li><a href="../cluster-http-management.html" class="page">Cluster HTTP Management</a></li>
  <li><a href="../cluster-jmx-management.html" class="page">Built-in JMX Management</a></li>
  <li><a href="../loglevels/index.html" class="page">Dynamic Log Levels</a></li>
  <li><a href="../kubernetes-lease.html" class="page">Kubernetes Lease</a></li>
</ul>
</div>
</nav>
<footer class="nav-footer sticky-sidebar-footer">
<a href="https://akka.io"><img class="logo" src="../images/akka-logo-reverse.svg"/></a>

</footer>
</aside>
<main class="fixed-shift-for-large expanded row">
<section class="site-content small-12 column">
<article class="page-content row">
<div class="small-12 column" id="docs">
<h2><a href="#aws-api" name="aws-api" class="anchor"><span class="anchor-link"></span></a>AWS API</h2><div class="callout warning "><div class="callout-title">Warning</div>
<p>This module is community maintained and the Lightbend subscription doesn&rsquo;t cover support for this module.</p></div>
<p>If you&rsquo;re using EC2 directly <em>or</em> you&rsquo;re using ECS with host mode networking <em>and</em> you&rsquo;re deploying one container per cluster member, continue to <a href="aws.html#discovery-method-aws-api-ec2-tag-based-discovery">Discovery Method: AWS API - EC2 Tag-Based Discovery</a>.</p>
<p>If you&rsquo;re using ECS with <a href="https://aws.amazon.com/blogs/compute/introducing-cloud-native-networking-for-ecs-containers/">awsvpcs</a> mode networking (whether on EC2 or with <a href="https://aws.amazon.com/fargate/">Fargate</a>), continue to <a href="aws.html#discovery-method-aws-api-ecs-discovery">Discovery Method: AWS API - ECS Discovery</a>.</p>
<p>ECS with bridge mode networking is not supported.</p>
<p>If you&rsquo;re using EKS, then you may want to use the <a href="kubernetes.html">&lsquo;Kubernetes API&rsquo;-based discovery method</a> instead.</p>
<h2><a href="#project-info" name="project-info" class="anchor"><span class="anchor-link"></span></a>Project Info</h2>
<table class="project-info">
<tr><th colspan="2">Project Info: Akka Discovery AWS</th></tr>
  <tr><th>Artifact</th><td><div>com.lightbend.akka.discovery</div>
  <div>akka-discovery-aws-api</div>
  <div>1.3.0</div>
  <div><a href="https://oss.sonatype.org/content/repositories/snapshots/com/lightbend/akka/management/" target="_blank" rel="noopener noreferrer">Snapshots are available</a></div>
  </td></tr>
  <tr><th>JDK versions</th><td><div>Adopt OpenJDK 8 with Hotspot</div><div>Adopt OpenJDK 11 with Hotspot</div></td></tr>
  <tr><th>Scala versions</th><td>2.13.10, 2.12.17, 3.1.3</td></tr>
  <tr><th>License</th><td><div><a href="https://raw.githubusercontent.com/akka/akka-management/v1.3.0/LICENSE" target="_blank" rel="noopener noreferrer">BUSL-1.1</a></div>
  </td></tr>
  <tr><th>Readiness level</th><td><div class="readiness-level"><a href="https://developer.lightbend.com/docs/introduction/getting-help/support-terminology.html#community-driven" target="_blank" rel="noopener">Community-driven</a></div>
  <div>Since 0.11.0, 2018-04-09</div>
  </td></tr>
  <tr><th>Home page</th><td><a href="https://akka.io/">https://akka.io/</a></td></tr>
  <tr><th>API documentation</th><td>
  <div><a href="https://doc.akka.io/api/akka-management/1.3.0/akka/index.html" target="_blank" rel="noopener noreferrer">API (Scaladoc)</a></div>
  </td></tr>
  <tr><th>Forums</th><td>
  <div><a href="https://discuss.lightbend.com/c/akka/" target="_blank" rel="noopener noreferrer">Lightbend Discuss</a></div>
  <div><a href="https://gitter.im/akka/akka" target="_blank" rel="noopener noreferrer">akka/akka Gitter channel</a></div>
  </td></tr>
  <tr><th>Release notes</th><td><a href="https://github.com/akka/akka-management/releases" target="_blank" rel="noopener noreferrer">GitHub releases</a></td></tr>
  <tr><th>Issues</th><td><a href="https://github.com/akka/akka-management/issues" target="_blank" rel="noopener noreferrer">GitHub issues</a></td></tr>
  <tr><th>Sources</th><td><a href="https://github.com/akka/akka-management" target="_blank" rel="noopener noreferrer">https://github.com/akka/akka-management</a></td></tr>
</table>

<h3><a href="#discovery-method-aws-api-ec2-tag-based-discovery" name="discovery-method-aws-api-ec2-tag-based-discovery" class="anchor"><span class="anchor-link"></span></a>Discovery Method: AWS API - EC2 Tag-Based Discovery</h3>

<p>You can use tags to simply mark the instances that belong to the same cluster. Use a tag that has &ldquo;service&rdquo; as the key and set the value equal to the name of your service (same value as <code>akka.management.cluster.bootstrap.contact-point-discovery.service-name</code> defined in <code>application.conf</code>, if you&rsquo;re using this module for bootstrapping your Akka cluster).</p>

<p>Screenshot of two tagged EC2 instances:</p>

<p><img src="../images/discovery-aws-ec2-tagged-instances.png" alt="EC2 instances" /></p>

<p>Note the tag <strong>service</strong> -&gt; <em>products-api</em>. It is set on both instances.</p>

<p>Note that this implementation is adequate for users running service clusters on <em>vanilla</em> EC2 instances. These instances can be created and tagged manually, or created via an auto-scaling group (ASG). If they are created via an ASG, they can be tagged automatically on creation. Simply add the tag to the auto-scaling group configuration and ensure the &ldquo;Tag New Instances&rdquo; option is checked.</p>

<h4><a href="#dependencies-and-usage-ec2-tag-based-discovery-" name="dependencies-and-usage-ec2-tag-based-discovery-" class="anchor"><span class="anchor-link"></span></a>Dependencies and usage (EC2 Tag-Based Discovery)</h4>

<p>This is a separate JAR file:</p>
<dl class="dependency"><dt>sbt</dt><dd><pre class="prettyprint"><code class="language-scala">val AkkaManagementVersion = "1.3.0"
libraryDependencies += "com.lightbend.akka.discovery" %% "akka-discovery-aws-api" % AkkaManagementVersion</code></pre></dd><dt>Gradle</dt><dd><pre class="prettyprint"><code class="language-gradle">def versions = [
  AkkaManagementVersion: "1.3.0",
  ScalaBinary: "2.13"
]
dependencies {
  implementation "com.lightbend.akka.discovery:akka-discovery-aws-api_${versions.ScalaBinary}:${versions.AkkaManagementVersion}"
}</code></pre></dd><dt>Maven</dt><dd><pre class="prettyprint"><code class="language-xml">&lt;properties&gt;
  &lt;akka.management.version&gt;1.3.0&lt;/akka.management.version&gt;
  &lt;scala.binary.version&gt;2.13&lt;/scala.binary.version&gt;
&lt;/properties&gt;
&lt;dependencies&gt
  &lt;dependency&gt;
    &lt;groupId&gt;com.lightbend.akka.discovery&lt;/groupId&gt;
    &lt;artifactId&gt;akka-discovery-aws-api_${scala.binary.version}&lt;/artifactId&gt;
    &lt;version&gt;${akka.management.version}&lt;/version&gt;
  &lt;/dependency&gt
&lt;/dependencies&gt;</code></pre></dd></dl>
<p><code>akka-discovery-aws-api</code> can be used with Akka 2.7.0 or later. You have to override the following Akka dependencies by defining them explicitly in your build and define the Akka version to the one that you are using. Latest patch version of Akka is recommended and a later version than 2.7.0 can be used.</p><dl class="dependency"><dt>sbt</dt><dd><pre class="prettyprint"><code class="language-scala">val AkkaVersion = "2.7.0"
libraryDependencies ++= Seq(
  "com.typesafe.akka" %% "akka-cluster" % AkkaVersion,
  "com.typesafe.akka" %% "akka-discovery" % AkkaVersion
)</code></pre></dd><dt>Gradle</dt><dd><pre class="prettyprint"><code class="language-gradle">def versions = [
  AkkaVersion: "2.7.0",
  ScalaBinary: "2.13"
]
dependencies {
  implementation "com.typesafe.akka:akka-cluster_${versions.ScalaBinary}:${versions.AkkaVersion}"
  implementation "com.typesafe.akka:akka-discovery_${versions.ScalaBinary}:${versions.AkkaVersion}"
}</code></pre></dd><dt>Maven</dt><dd><pre class="prettyprint"><code class="language-xml">&lt;properties&gt;
  &lt;akka.version&gt;2.7.0&lt;/akka.version&gt;
  &lt;scala.binary.version&gt;2.13&lt;/scala.binary.version&gt;
&lt;/properties&gt;
&lt;dependencies&gt
  &lt;dependency&gt;
    &lt;groupId&gt;com.typesafe.akka&lt;/groupId&gt;
    &lt;artifactId&gt;akka-cluster_${scala.binary.version}&lt;/artifactId&gt;
    &lt;version&gt;${akka.version}&lt;/version&gt;
  &lt;/dependency&gt
  &lt;dependency&gt;
    &lt;groupId&gt;com.typesafe.akka&lt;/groupId&gt;
    &lt;artifactId&gt;akka-discovery_${scala.binary.version}&lt;/artifactId&gt;
    &lt;version&gt;${akka.version}&lt;/version&gt;
  &lt;/dependency&gt
&lt;/dependencies&gt;</code></pre></dd></dl>
<p>And in your <code>application.conf</code>:</p>
<pre><code>akka.discovery {
  method = aws-api-ec2-tag-based
}
</code></pre>
<p>Notes:</p>
<ul>
  <li>
  <p>You will need to make sure that the proper privileges are in place for the discovery implementation to access the Amazon EC2 API. The simplest way to do this is by creating a IAM role that, at a minimum, allows the <em>DescribeInstances</em> action. Attach this IAM role to the EC2 instances that need to access the discovery implementation. See the docs for <a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/iam-roles-for-amazon-ec2.html">IAM Roles for Amazon EC2</a>.</p></li>
  <li>
  <p>In general, for the EC2 instances to &ldquo;talk to each other&rdquo; (necessary for forming a cluster), they need to be in the same security group and <a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/security-group-rules-reference.html#sg-rules-other-instances">the proper rules have to be set</a>.</p></li>
  <li>
  <p>You can set additional filters (by instance type, region, other tags etc.) in your application.conf file, in the <code>akka.discovery.aws-api-ec2-tag-based.filters</code> key. The filters have to be key=value pairs separated by the semicolon character. For example:</p>
  <pre><code>akka {
  discovery {
    aws-api-ec2-tag-based {
      filters = &quot;instance-type=m1.small;tag:purpose=production&quot;
    }
  }
}
</code></pre></li>
  <li>
  <p>By default, this module is configured for clusters with one Akka node per EC2 instance: it  separates cluster members solely by their EC2 IP address. However, we can change the default configuration to indicate multiple ports per discovered EC2 IP, and achieve a setup with multiple Akka nodes (i.e. multiple JVMs) per EC2 instance.</p>
  <pre><code>akka {
  discovery {
    aws-api-ec2-tag-based {
      ports = [8557, 8558, 8559] # 3 Akka nodes per EC2 instance
      # note that the above need to be the ports associated with the *Akka Management* extension
    }
  }
}
</code></pre>
  <p>Note: this comes with the limitation that each EC2 instance has to have the same number of Akka nodes.</p></li>
  <li>
  <p>You can change the default tag key from &ldquo;service&rdquo; to something else. This can be done via <code>application.conf</code>, by setting <code>akka.discovery.aws-api-ec2-tag-based.tag-key</code> to something else.</p>
  <pre><code>akka.discovery.aws-api-ec2-tag-based.tag-key = &quot;akka-cluster&quot;
</code></pre></li>
  <li>
  <p>If your service is running in a docker container, you will need to configure Akka Management with separate  IPs for binding and discovery. This is because Akka Management needs to <em>bind</em> to the internal docker IP,  but will <em>discover</em> the &ldquo;host&rdquo; IP (the EC2 private IP) on the AWS API. See <a href="../akka-management.html">Basic  Configuration</a> on how to separate the bind IP from the discovery IP.</p></li>
</ul>
<p>Demo:</p>
<ul>
  <li>A working demo app is available in the <a href="https://github.com/akka/akka-management/tree/main/integration-test/aws-api-ec2">integration-test</a> folder.</li>
</ul>
<h3><a href="#discovery-method-aws-api-ecs-discovery" name="discovery-method-aws-api-ecs-discovery" class="anchor"><span class="anchor-link"></span></a>Discovery Method: AWS API - ECS Discovery</h3>
<p>If you&rsquo;re using ECS with <a href="https://aws.amazon.com/blogs/compute/introducing-cloud-native-networking-for-ecs-containers/">awsvpc</a> mode networking, you can have all task instances of a given ECS service discover each other. If you&rsquo;re using this module for bootstrapping your Akka cluster that you&rsquo;ll do so by setting the value of <code>akka.management.cluster.bootstrap.contact-point-discovery.service-name</code> to that of the ECS service itself.</p>
<p>Screenshot of two ECS task instances (the service name is <code>liquidity-application</code>):</p>
<p><img src="../images/discovery-aws-ecs-task-instances.png" alt="ECS task instances" /></p>
<h4><a href="#dependencies-and-usage-ecs-discovery-" name="dependencies-and-usage-ecs-discovery-" class="anchor"><span class="anchor-link"></span></a>Dependencies and usage (ECS Discovery)</h4>
<p>There are two &ldquo;flavours&rdquo; of the ECS Discovery module.</p>
<h5><a href="#akka-discovery-aws-api" name="akka-discovery-aws-api" class="anchor"><span class="anchor-link"></span></a>akka-discovery-aws-api</h5>
<p>This uses the mainstream AWS SDK. The advantage here is that if you&rsquo;ve already got the mainstream AWS SDK as a dependency you&rsquo;re not now also bringing in the preview SDK. The disadvantage is that the mainstream SDK does blocking IO.</p><dl class="dependency"><dt>sbt</dt><dd><pre class="prettyprint"><code class="language-scala">val AkkaManagementVersion = "1.3.0"
libraryDependencies += "com.lightbend.akka.discovery" %% "akka-discovery-aws-api" % AkkaManagementVersion</code></pre></dd><dt>Gradle</dt><dd><pre class="prettyprint"><code class="language-gradle">def versions = [
  AkkaManagementVersion: "1.3.0",
  ScalaBinary: "2.13"
]
dependencies {
  implementation "com.lightbend.akka.discovery:akka-discovery-aws-api_${versions.ScalaBinary}:${versions.AkkaManagementVersion}"
}</code></pre></dd><dt>Maven</dt><dd><pre class="prettyprint"><code class="language-xml">&lt;properties&gt;
  &lt;akka.management.version&gt;1.3.0&lt;/akka.management.version&gt;
  &lt;scala.binary.version&gt;2.13&lt;/scala.binary.version&gt;
&lt;/properties&gt;
&lt;dependencies&gt
  &lt;dependency&gt;
    &lt;groupId&gt;com.lightbend.akka.discovery&lt;/groupId&gt;
    &lt;artifactId&gt;akka-discovery-aws-api_${scala.binary.version}&lt;/artifactId&gt;
    &lt;version&gt;${akka.management.version}&lt;/version&gt;
  &lt;/dependency&gt
&lt;/dependencies&gt;</code></pre></dd></dl>
<p>And in your <code>application.conf</code>:</p>
<pre><code>akka.discovery {
  method = aws-api-ecs
  aws-api-ecs {
    # Defaults to &quot;default&quot; to match the AWS default cluster name if not overridden
    cluster = &quot;your-ecs-cluster-name&quot;
  }
}
</code></pre>
<h5><a href="#akka-discovery-aws-api-async" name="akka-discovery-aws-api-async" class="anchor"><span class="anchor-link"></span></a>akka-discovery-aws-api-async</h5>
<p>This uses the preview AWS SDK. The advantage here is that the SDK does non-blocking IO, which you probably want. You might need to think carefully before using this though if you&rsquo;ve already got the mainstream AWS SDK as a dependency.</p>
<p>Once the async AWS SDK is out of preview it is likely that the <code>akka-discovery-aws-api</code> module will be discontinued in favour of <code>akka-discovery-aws-api-async</code>.</p><dl class="dependency"><dt>sbt</dt><dd><pre class="prettyprint"><code class="language-scala">val AkkaManagementVersion = "1.3.0"
libraryDependencies += "com.lightbend.akka.discovery" %% "akka-discovery-aws-api-async" % AkkaManagementVersion</code></pre></dd><dt>Gradle</dt><dd><pre class="prettyprint"><code class="language-gradle">def versions = [
  AkkaManagementVersion: "1.3.0",
  ScalaBinary: "2.13"
]
dependencies {
  implementation "com.lightbend.akka.discovery:akka-discovery-aws-api-async_${versions.ScalaBinary}:${versions.AkkaManagementVersion}"
}</code></pre></dd><dt>Maven</dt><dd><pre class="prettyprint"><code class="language-xml">&lt;properties&gt;
  &lt;akka.management.version&gt;1.3.0&lt;/akka.management.version&gt;
  &lt;scala.binary.version&gt;2.13&lt;/scala.binary.version&gt;
&lt;/properties&gt;
&lt;dependencies&gt
  &lt;dependency&gt;
    &lt;groupId&gt;com.lightbend.akka.discovery&lt;/groupId&gt;
    &lt;artifactId&gt;akka-discovery-aws-api-async_${scala.binary.version}&lt;/artifactId&gt;
    &lt;version&gt;${akka.management.version}&lt;/version&gt;
  &lt;/dependency&gt
&lt;/dependencies&gt;</code></pre></dd></dl>
<p>We have 2 approaches in ECS: <code>aws-api-ecs-async</code> and <code>aws-api-ecs-task-set-async</code>.</p>
<h6><a href="#aws-api-ecs-async" name="aws-api-ecs-async" class="anchor"><span class="anchor-link"></span></a>aws-api-ecs-async</h6>
<p>In your <code>application.conf</code>:</p>
<pre><code>akka.discovery {
  method = aws-api-ecs-async
  aws-api-ecs-async {
    # Defaults to &quot;default&quot; to match the AWS default cluster name if not overridden
    cluster = &quot;your-ecs-cluster-name&quot;
    # Defaults to an empty list
    tags = [
      { key = &quot;deployment-side&quot;, value = &quot;blue&quot; }
    ]
  }
}
</code></pre>
<p>This will query the AWS API to retrieve all running tasks of the ESC service specified at <code>akka.management.cluster.bootstrap.contact-point-discovery.service-name</code>.</p>
<h6><a href="#aws-api-ecs-task-set-async" name="aws-api-ecs-task-set-async" class="anchor"><span class="anchor-link"></span></a>aws-api-ecs-task-set-async</h6>
<p>If you use AWS CodeDeploy, you probably want to use this method of discovery.</p>
<p>In your <code>application.conf</code>:</p>
<pre><code>akka.discovery {
  method = aws-api-ecs-task-set-async
  aws-api-ecs-task-set-async {
    # Defaults to &quot;default&quot; to match the AWS default cluster name if not overridden
    cluster = &quot;your-ecs-cluster-name&quot;
  }
}
</code></pre>
<p>The service-discovery works in 3 steps: 1. Query the internal ECS metadata API to retrieve the TaskARN of itself (See <a href="https://docs.aws.amazon.com/AmazonECS/latest/developerguide/task-metadata-endpoint-v3.html">AWS docs</a>) 2. Retrieve the TaskSet to which the TaskARN belongs 3. Retrieve all Tasks belonging to that TaskSet</p>
<p>Notes:</p>
<ul>
  <li>
  <p>Since the implementation uses the AWS ECS API, you&rsquo;ll need to make sure that  AWS credentials are provided. The simplest way to do this is to create an IAM  role that includes appropriate permissions for AWS ECS API access. Attach  this IAM role to the task definition of the ECS Service. See the docs for  <a href="https://docs.aws.amazon.com/AmazonECS/latest/developerguide/task-iam-roles.html">IAM Roles for Tasks</a>.</p></li>
  <li>
  <p>In general, for the ECS task instances to &ldquo;talk to each other&rdquo; (necessary for  forming a cluster), they need to be in the same security group and the proper  rules have to be set. See the docs for  <a href="https://docs.aws.amazon.com/AmazonECS/latest/developerguide/task-networking.html">Task Networking with the <code>awsvpc</code> Network Mode</a>.</p></li>
  <li>
  <p>akka-remote by default sets <code>akka.remote.netty.tcp.hostname</code> to the result of  <code>InetAddress.getLocalHost.getHostAddress</code>, and akka-management does the same  for <code>akka.management.http.hostname</code>. However,  <code>InetAddress.getLocalHost.getHostAddress</code> throws an exception when running in  awsvpc mode (because the container name cannot be resolved), so you will need  to set this explicitly. An alternative host address discovery method is  provided by both modules. The methods are  <code>EcsSimpleServiceDiscovery.getContainerAddress</code> and  <code>AsyncEcsDiscovery.getContainerAddress</code> respectively, which you  should use to programmatically set both config hostnames.</p></li>
  <li>
  <p>Because ECS service discovery is only able to discover IP addresses (not ports  too) you&rsquo;ll need to set  <code>akka.management.cluster.bootstrap.contact-point.fallback-port = 8558</code>, where  8558 is whatever port you choose to bind akka-management to.</p></li>
  <li>
  <p>You can set additional filters to only discover nodes with specific tag values in  your application.conf file, in the <code>akka.discovery.aws-api-ecs-async.tags</code> key.  An empty list of tags will not filter any nodes out.</p></li>
</ul>
<p>For example:  <code>
    akka {
      discovery {
        aws-api-ecs-async {
          tags = [
                { key = &quot;environment&quot;, value = &quot;staging&quot; },
                { key = &quot;deployment-side&quot;, value = &quot;blue&quot; }
              ]
        }
      }
    }
</code></p>
<ul>
  <li>The current implementation only supports discovery of service task instances  within the same region.</li>
</ul>
<p>Demo:</p>
<ul>
  <li>A working demo app is available in the  <a href="https://github.com/akka/akka-management/tree/main/integration-test/aws-api-ecs">integration-test</a>  folder. It includes CloudFormation templates with minimal permissions w.r.t to  IAM policies and security group ingress, and so is a good starting point for  any deployment that integrates the  <a href="https://en.wikipedia.org/wiki/Principle_of_least_privilege">principle of least privilege</a>.</li>
</ul>
</div>
</article>
<div class="row">
<div class="small-12 column">
<section class="nav-prev-next row">
<div class="nav-prev small-6 column">
<a href="../discovery/marathon.html"><i class="icon-prev"></i> <span class="link-prev">Marathon API</span></a>
</div>
<div class="nav-next small-6 column clearfix">
<a class="float-right" href="../rolling-updates.html">Rolling Updates <i class="icon-next"></i></a>
</div>
</section>
</div>
</div>
<div class="source-github row">
Found an error in this documentation? The source code for this page can be found <a href="https://github.com/akka/akka-management/tree/v1.3.0/docs/src/main/paradox/discovery/aws.md">here</a>.
Please feel free to edit and contribute a pull request.
</div>

<footer class="page-footer row clearfix">
<img class="akka-icon float-left show-for-medium" src="../images/akka-icon.svg" />
<section class="copyright">
<div>Akka Management is available under the <a href="https://www.lightbend.com/akka/license" target="_blank">Business Source License 1.1</a>.</div>
<p class="legal">
&copy; 2011-2021 <a href="https://www.lightbend.com" target="_blank">Lightbend, Inc.</a> |
<a href="https://www.lightbend.com/legal/licenses" target="_blank">Licenses</a> |
<a href="https://www.lightbend.com/legal/terms" target="_blank">Terms</a> |
<a href="https://www.lightbend.com/legal/privacy" target="_blank">Privacy Policy</a> |
<a href="https://akka.io/cookie/" target="_blank">Cookie Listing</a> |
<a class="optanon-toggle-display">Cookie Settings</a>
</p>
</section>

</footer>
</section>
</main>
</div>

<script type="text/javascript" src="../js/scrollsneak.js"></script>
<script type="text/javascript">jQuery(document).foundation();</script>
<script type="text/javascript" src="../js/groups.js"></script>
<script type="text/javascript" src="../js/page.js"></script>
<script type="text/javascript" src="../js/snippets.js"></script>
<script type="text/javascript" src="../js/magellan.js"></script>
<script type="text/javascript" src="../js/metadata-toggle.js"></script>
<script type="text/javascript" src="../js/lbHeader.js"></script>

<style type="text/css">@import "../lib/prettify/prettify.css";</style>
<script type="text/javascript" src="../lib/prettify/prettify.js"></script>
<script type="text/javascript" src="../lib/prettify/lang-scala.js"></script>
<script type="text/javascript">//<![CDATA[
jQuery(function(){window.prettyPrint && prettyPrint()});
//]]></script>
<script type="text/javascript" src="../assets/js/warnOldVersion.js"></script>
<script type="text/javascript">//<![CDATA[
jQuery(function(jq){initOldVersionWarnings(jq, '1.3.0', 'https://doc.akka.io/docs/akka-management/current/')});
//]]></script>


</body>
</html>
