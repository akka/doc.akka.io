<!DOCTYPE html>
<html class="no-js" lang="en">

<head>
<title>Akka Cluster Bootstrap &bull; Akka Management</title>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<meta name="description" content="Akka Management is a suite of tools for operating Akka Clusters."/>
<link rel="canonical" href="https://doc.akka.io/docs/akka-management/current/bootstrap/index.html"/>
<script type="text/javascript" src="../lib/jquery/jquery.min.js"></script>
<script type="text/javascript" src="../lib/foundation/dist/js/foundation.min.js"></script>
<link rel="stylesheet" type="text/css" href="../lib/normalize.css/normalize.css"/>
<link rel="stylesheet" type="text/css" href="../lib/foundation/dist/css/foundation.min.css"/>
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.css" />
<link rel="stylesheet" type="text/css" href="../css/icons.css"/>
<link rel="stylesheet" type="text/css" href="../css/page-7.css"/>
<link rel="stylesheet" type="text/css" href="../css/banner-1.css"/>
<link rel="shortcut icon" href="../images/favicon.ico" />
<link rel="apple-touch-icon" sizes="180x180" href="../images/apple-touch-icon.png"/>
<link rel="icon" type="image/png" sizes="32x32" href="../images/favicon-32x32.png"/>
<link rel="icon" type="image/png" sizes="16x16" href="../images/favicon-16x16.png"/>
<link rel="manifest" href="../images/manifest.json"/>
<meta name="msapplication-TileImage" content="../images/mstile-150x150.png"/>
<meta name="msapplication-TileColor" content="#15a9ce"/>
<meta name="theme-color" content="#15a9ce"/>
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>
<!-- OneTrust Cookies Consent Notice (Production Standard, akka.io, en-GB) start -->
<script src="https://optanon.blob.core.windows.net/consent/159bb13d-6748-4399-806e-ac28db879785.js" type="text/javascript" charset="UTF-8"></script>
<script type="text/javascript">
function OptanonWrapper() { }
</script>
<!-- OneTrust Cookies Consent Notice (Production Standard, akka.io, en-GB) end -->
<!--Google Analytics-->
<script type="text/plain" class="optanon-category-2">
var _gaq = _gaq || [];
_gaq.push(['_setAccount', '']);
_gaq.push(['_setDomainName', '']);
_gaq.push(['_trackPageview']);
(function() {
var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})()
</script>
<!-- Google Tag Manager -->
<script type="text/plain" class="optanon-category-2">
(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-KBJGH35');
</script>
<!--Marketo-->
<script type="text/plain" class="optanon-category-3">
(function() {
var didInit = false;
function initMunchkin() {
if(didInit === false) {
didInit = true;
Munchkin.init('558-NCX-702', { 'asyncOnly': true, 'disableClickDelay': true });
}
}
var s = document.createElement('script');
s.type = 'text/javascript';
s.async = true;
s.src = '//munchkin.marketo.net/munchkin.js';
s.onreadystatechange = function() {
if (this.readyState == 'complete' || this.readyState == 'loaded') {
initMunchkin();
}
};
s.onload = initMunchkin;
document.getElementsByTagName('head')[0].appendChild(s);
})();
</script>
</head>

<body id="underlay" data-toggler="nav-open">
<div id="lightbend-banner" class="lightbend-banner akka full-width" data-category="OSS Lightbend Banner Impression" data-label="Akka Banner Impression">
<div class="wrapper">
<div class="brand">
<a class="oss-track-link-label" data-category="OSS Lightbend Banner Clicks" data-label="Lightbend Logo - Akka Banner" href="https://www.lightbend.com?r=oss-banner-akka" target="_blank">
<img class="lightbend-logo" src="../images/banner-logos/lightbend-reverse.svg" alt="Lightbend" title="Lightbend">
</a>
</div>
<div class="nav">
<a class="banner-btn oss-track-link-label" data-category="OSS Lightbend Banner Clicks" data-label="Enhance your Akka systems with Akka Platform [Button] - Akka Banner" href="https://www.lightbend.com/akka-core-of-lightbend?r=oss-banner-akka" target="_blank">
<span>Enhance your Akka systems with</span>
<img class="akka-platform-reverse-logo" src="../images/banner-logos/akka-platform-reverse.svg" alt="Akka Platform" title="Akka Platform">
</a>
<div class="drop-down">
<svg class="svg-chevon-circle-down" version="1.1" id="Chevron_circled_down" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 20 20" enable-background="new 0 0 20 20" xml:space="preserve">
<path fill="#ffffff" d="M12.505,8.698L10,11L7.494,8.698c-0.198-0.196-0.518-0.196-0.718,0c-0.197,0.196-0.197,0.515,0,0.71l2.864,2.807
c0.199,0.196,0.52,0.196,0.717,0l2.864-2.807c0.199-0.195,0.198-0.514,0-0.71C13.024,8.502,12.704,8.502,12.505,8.698z M10,0.4
c-5.302,0-9.6,4.298-9.6,9.6c0,5.303,4.298,9.6,9.6,9.6s9.6-4.297,9.6-9.6C19.6,4.698,15.302,0.4,10,0.4z M10,18.354
c-4.615,0-8.354-3.74-8.354-8.354c0-4.614,3.739-8.354,8.354-8.354c4.613,0,8.354,3.74,8.354,8.354
C18.354,14.614,14.613,18.354,10,18.354z" />
</svg>
<div class="drop-down-content">
<div class="lightbend-family">
<a href="https://cloudflow.io" class="cloudflow oss-track-link-label" data-category="OSS Lightbend Banner Clicks" data-label="Cloudflow - Logo Tag Line - Akka Banner">
<img class="cloudflow-full-color-logo" src="../images/banner-logos/cloudflow-full-color.svg" alt="Cloudflow by Lightbend" title="Cloudflow by Lightbend">
</a>
<a href="https://cloudstate.io" class="cloudstate oss-track-link-label" data-category="OSS Lightbend Banner Clicks" data-label="Cloudstate - Logo Tag Line - Akka Banner">
<img class="cloudstate-full-color-logo" src="../images/banner-logos/cloudstate-full-color.svg" alt="Cloudstate by Lightbend" title="Cloudstate by Lightbend">
</a>
<a href="https://www.lagomframework.com" class="lagom oss-track-link-label" data-category="OSS Lightbend Banner Clicks" data-label="Lagom - Logo Tag Line - Akka Banner">
<img class="lagom-full-color-logo" src="../images/banner-logos/lagom-full-color.svg" alt="Lagom Framework by Lightbend" title="Lagom Framework by Lightbend">
</a>
<a href="https://www.playframework.com" class="play oss-track-link-label" data-category="OSS Lightbend Banner Clicks" data-label="Play - Logo Tag Line - Akka Banner">
<img class="play-full-color-logo" src="../images/banner-logos/play-full-color.svg" alt="Play Framework by Lightbend" title="Play Framework by Lightbend">
</a>
<a href="https://www.scala-lang.org" class="scala oss-track-link-label" data-category="OSS Lightbend Banner Clicks" data-label="Scala - Logo Tag Line - Akka Banner">
<img class="scala-full-color-logo" src="../images/banner-logos/scala-full-color.svg" alt="Scala by Lightbend" title="Scala by Lightbend">
</a>
<div class="akka current">
<img class="akka-full-color-logo" src="../images/banner-logos/akka-full-color.svg" alt="Akka by Lightbend" title="Akka by Lightbend">
<span>From the creators of <strong>Akka</strong>, get technology enhancements, monitoring, and expert support with Akka Platform from Lightbend.</span>
<a class="oss-track-link-label" data-category="OSS Lightbend Banner Clicks" data-label="Learn More [Button] - Akka Banner" href="https://www.lightbend.com/akka-core-of-lightbend?r=oss-banner-akka" target="_blank">Learn More</a>
</div>
</div>
<div class="title">The Lightbend Family</div>
</div>      
</div>
</div>
</div>
</div>
<header class="site-header hide-for-large">
<div class="sticky-header clearfix">
<a href="https://akka.io"><img class="logo" src="../images/akka-logo-reverse.svg"/></a>

<button class="menu-icon float-right" type="button" data-toggle="underlay overlay"></button>
</div>
<div id="overlay" class="overlay-nav" data-toggler="nav-open">
<header class="nav-header">
<div class="nav-header-title">
<h1><a href="../index.html">Akka Management</a></h1>
</div>
<div class="nav-header-version">
Version 1.0.6
</div>
<div class="nav-header-groups">
<select class="supergroup" name="Language"><option class="group" value="group-java">Java</option><option class="group" value="group-scala">Scala</option></select>
</div>
</header>
<nav class="nav-toc">
<ul>
  <li><a href="../index.html#overview" class="header">Overview</a></li>
  <li><a href="../akka-management.html" class="page">Akka Management</a></li>
  <li><a href="../migration.html" class="page">Migration guide</a></li>
  <li><a href="../healthchecks.html" class="page">Health checks</a></li>
  <li><a href="../bootstrap/index.html#akka-cluster-bootstrap" class="active page">Akka Cluster Bootstrap</a>
  <ul>
    <li><a href="../bootstrap/index.html#prerequisites" class="header">Prerequisites</a></li>
    <li><a href="../bootstrap/index.html#project-info" class="header">Project Info</a></li>
    <li><a href="../bootstrap/index.html#dependency" class="header">Dependency</a></li>
    <li><a href="../bootstrap/index.html#using" class="header">Using</a></li>
    <li><a href="../bootstrap/index.html#how-it-works" class="header">How It Works</a></li>
    <li><a href="../bootstrap/index.html#joining-mechanism-precedence" class="header">Joining Mechanism Precedence</a></li>
    <li><a href="../bootstrap/index.html#deployment-considerations" class="header">Deployment considerations</a></li>
    <li><a href="../bootstrap/index.html#bootstrap-recipes" class="header">Bootstrap Recipes</a></li>
    <li><a href="../bootstrap/recipes.html" class="page">Bootstrap environments</a></li>
    <li><a href="../bootstrap/details.html" class="page">Bootstrap process</a></li>
    <li><a href="../bootstrap/troubleshooting.html" class="page">Troubleshooting</a></li>
    <li><a href="../bootstrap/local-config.html" class="page">Local using config</a></li>
    <li><a href="../bootstrap/kubernetes.html" class="page">Kubernetes via DNS</a></li>
    <li><a href="../bootstrap/kubernetes-api.html" class="page">Kubernetes API</a></li>
    <li><a href="../bootstrap/istio.html" class="page">Istio</a></li>
  </ul></li>
  <li><a href="../discovery/index.html" class="page">Akka Discovery Methods</a></li>
  <li><a href="../cluster-http-management.html" class="page">Cluster HTTP Management</a></li>
  <li><a href="../cluster-jmx-management.html" class="page">Built-in JMX Management</a></li>
  <li><a href="../loglevels.html" class="page">Dynamic Log Levels</a></li>
</ul>
</nav>
</div>
</header>
<div class="site-content-wrapper">
<aside class="sticky-sidebar show-for-large">
<header class="nav-header sticky-sidebar-header">
<div class="nav-header-title">
<h1><a href="../index.html">Akka Management</a></h1>
</div>
<div class="nav-header-version">
Version 1.0.6
</div>
<div class="nav-header-groups">
<select class="supergroup" name="Language"><option class="group" value="group-java">Java</option><option class="group" value="group-scala">Scala</option></select>
</div>
</header>
<nav class="site-nav sticky-sidebar-contents">
<div class="nav-toc">
<ul>
  <li><a href="../index.html#overview" class="header">Overview</a></li>
  <li><a href="../akka-management.html" class="page">Akka Management</a></li>
  <li><a href="../migration.html" class="page">Migration guide</a></li>
  <li><a href="../healthchecks.html" class="page">Health checks</a></li>
  <li><a href="../bootstrap/index.html#akka-cluster-bootstrap" class="active page">Akka Cluster Bootstrap</a>
  <ul>
    <li><a href="../bootstrap/index.html#prerequisites" class="header">Prerequisites</a></li>
    <li><a href="../bootstrap/index.html#project-info" class="header">Project Info</a></li>
    <li><a href="../bootstrap/index.html#dependency" class="header">Dependency</a></li>
    <li><a href="../bootstrap/index.html#using" class="header">Using</a></li>
    <li><a href="../bootstrap/index.html#how-it-works" class="header">How It Works</a></li>
    <li><a href="../bootstrap/index.html#joining-mechanism-precedence" class="header">Joining Mechanism Precedence</a></li>
    <li><a href="../bootstrap/index.html#deployment-considerations" class="header">Deployment considerations</a></li>
    <li><a href="../bootstrap/index.html#bootstrap-recipes" class="header">Bootstrap Recipes</a></li>
    <li><a href="../bootstrap/recipes.html" class="page">Bootstrap environments</a></li>
    <li><a href="../bootstrap/details.html" class="page">Bootstrap process</a></li>
    <li><a href="../bootstrap/troubleshooting.html" class="page">Troubleshooting</a></li>
    <li><a href="../bootstrap/local-config.html" class="page">Local using config</a></li>
    <li><a href="../bootstrap/kubernetes.html" class="page">Kubernetes via DNS</a></li>
    <li><a href="../bootstrap/kubernetes-api.html" class="page">Kubernetes API</a></li>
    <li><a href="../bootstrap/istio.html" class="page">Istio</a></li>
  </ul></li>
  <li><a href="../discovery/index.html" class="page">Akka Discovery Methods</a></li>
  <li><a href="../cluster-http-management.html" class="page">Cluster HTTP Management</a></li>
  <li><a href="../cluster-jmx-management.html" class="page">Built-in JMX Management</a></li>
  <li><a href="../loglevels.html" class="page">Dynamic Log Levels</a></li>
</ul>
</div>
</nav>
<footer class="nav-footer sticky-sidebar-footer">
<a href="https://akka.io"><img class="logo" src="../images/akka-logo-reverse.svg"/></a>

</footer>
</aside>
<main class="fixed-shift-for-large expanded row">
<section class="site-content small-12 column">
<article class="page-content row">
<div class="small-12 column" id="docs">
<a id="bootstrap"></a>
<h1><a href="#akka-cluster-bootstrap" name="akka-cluster-bootstrap" class="anchor"><span class="anchor-link"></span></a>Akka Cluster Bootstrap</h1>
<p>Akka Cluster Bootstrap helps forming (or joining to) a cluster by using <a href="../discovery/index.html">Akka Discovery</a> to discover peer nodes. It is an alternative to configuring static <code>seed-nodes</code> in dynamic deployment environments such as on Kubernetes or AWS.</p>
<p>It builds on the flexibility of Akka Discovery, leveraging a range of discovery mechanisms depending on the environment you want to run your cluster in.</p>
<h2><a href="#prerequisites" name="prerequisites" class="anchor"><span class="anchor-link"></span></a>Prerequisites</h2>
<p>Bootstrap depends on:</p>
<ul>
  <li><a href="../discovery/index.html">Akka Discovery</a> to discover other members of the cluster</li>
  <li><a href="../akka-management.html">Akka Management</a> to host HTTP endpoints used during the bootstrap process</li>
</ul>
<p>A discovery mechanism needs to be chosen. A good default choice is DNS.</p>
<h2><a href="#project-info" name="project-info" class="anchor"><span class="anchor-link"></span></a>Project Info</h2>
<table class="project-info">
<tr><th colspan="2">Project Info: Akka Cluster Bootstrap</th></tr>
  <tr><th>Artifact</th><td><div>com.lightbend.akka.management</div>
  <div>akka-management-cluster-bootstrap</div>
  <div>1.0.6</div>
  <div><a href="https://doc.akka.io/docs/akka-management/snapshot/index.html" target="_blank" rel="noopener noreferrer">Snapshots are available</a></div>
  </td></tr>
  <tr><th>JDK versions</th><td><div>Adopt OpenJDK 8 with Hotspot</div><div>Adopt OpenJDK 11 with Hotspot</div></td></tr>
  <tr><th>Scala versions</th><td>2.11.12, 2.12.10, 2.13.0</td></tr>
  <tr><th>License</th><td><div><a href="https://www.apache.org/licenses/LICENSE-2.0" target="_blank" rel="noopener noreferrer">Apache-2.0</a></div>
  </td></tr>
  <tr><th>Readiness level</th><td><div class="readiness-level"><a href="https://developer.lightbend.com/docs/lightbend-platform/introduction/getting-help/support-terminology.html#supported" target="_blank" rel="noopener">Supported</a>, <a href="https://www.lightbend.com/lightbend-platform-subscription" target="_blank" rel="noopener">Lightbend Platform Subscription</a> provides support</div>
  <div>Since 1.0.0, 2019-03-15</div>
  </td></tr>
  <tr><th>Home page</th><td><a href="https://akka.io/">https://akka.io/</a></td></tr>
  <tr><th>API documentation</th><td>
  <div><a href="https://doc.akka.io/api/akka-management/1.0.6/akka/index.html" target="_blank" rel="noopener noreferrer">API (Scaladoc)</a></div>
  </td></tr>
  <tr><th>Forums</th><td>
  <div><a href="https://discuss.lightbend.com/c/akka/" target="_blank" rel="noopener noreferrer">Lightbend Discuss</a></div>
  <div><a href="https://gitter.im/akka/akka" target="_blank" rel="noopener noreferrer">akka/akka Gitter channel</a></div>
  </td></tr>
  <tr><th>Release notes</th><td><a href="https://github.com/akka/akka-management/releases" target="_blank" rel="noopener noreferrer">GitHub releases</a></td></tr>
  <tr><th>Issues</th><td><a href="https://github.com/akka/akka-management/issues" target="_blank" rel="noopener noreferrer">GitHub issues</a></td></tr>
  <tr><th>Sources</th><td><a href="https://github.com/akka/akka-management" target="_blank" rel="noopener noreferrer">https://github.com/akka/akka-management</a></td></tr>
</table>

<h2><a href="#dependency" name="dependency" class="anchor"><span class="anchor-link"></span></a>Dependency</h2>

<p>Add <code>akka-management-cluster-bootstrap</code> and one or more discovery mechanisms to use for the discovery process.</p>

<p>For example, you might choose to use the <a href="https://doc.akka.io/docs/akka/2.5.27/discovery/index.html#discovery-method-dns">DNS discovery</a> and bootstrap extensions:</p>
<dl class="dependency"><dt>sbt</dt><dd><pre class="prettyprint"><code class="language-scala">libraryDependencies ++= Seq(
  "com.lightbend.akka.management" %% "akka-management-cluster-bootstrap" % "1.0.6",
  "com.typesafe.akka" %% "akka-discovery" % "2.5.27"
)</code></pre></dd><dt>Gradle</dt><dd><pre class="prettyprint"><code class="language-gradle">dependencies {
  compile group: 'com.lightbend.akka.management', name: 'akka-management-cluster-bootstrap_2.12', version: '1.0.6',
  compile group: 'com.typesafe.akka', name: 'akka-discovery_2.12', version: '2.5.27'
}</code></pre></dd><dt>Maven</dt><dd><pre class="prettyprint"><code class="language-xml">&lt;dependency&gt;
  &lt;groupId&gt;com.lightbend.akka.management&lt;/groupId&gt;
  &lt;artifactId&gt;akka-management-cluster-bootstrap_2.12&lt;/artifactId&gt;
  &lt;version&gt;1.0.6&lt;/version&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
  &lt;groupId&gt;com.typesafe.akka&lt;/groupId&gt;
  &lt;artifactId&gt;akka-discovery_2.12&lt;/artifactId&gt;
  &lt;version&gt;2.5.27&lt;/version&gt;
&lt;/dependency&gt;</code></pre></dd></dl><div class="callout note "><div class="callout-title">Note</div>
<p><code>akka-discovery</code> is already a transitive dependency of <code>akka-management-cluster-bootstrap</code> but it can be good to define it explicitly in the build of the application to align the Akka versions with other dependencies from the application. The version must be the same across all Akka modules, e.g. <code>akka-actor</code>, <code>akka-discovery</code> and <code>akka-cluster</code> must be of the same version.</p>
<p>The minimum supported Akka version is 2.5.27. Use the same Akka version for <code>akka-discovery</code> as for other Akka dependencies in the application. Latest patch version of Akka is recommended and a later version than 2.5.27 can be used.</p></div>
<h2><a href="#using" name="using" class="anchor"><span class="anchor-link"></span></a>Using</h2>
<p>Akka management must be started as well as the bootstrap process:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/akka-management/tree/v1.0.6/cluster-bootstrap/src/test/scala/doc/akka/management/cluster/bootstrap/ClusterBootstrapCompileOnly.scala#L16-L20" target="_blank" title="Go to snippet source"></a><code class="language-scala">// Akka Management hosts the HTTP routes used by bootstrap
AkkaManagement(system).start()

// Starting the bootstrap process needs to be done explicitly
ClusterBootstrap(system).start()</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/akka-management/tree/v1.0.6/cluster-bootstrap/src/test/java/jdoc/akka/management/cluster/bootstrap/ClusterBootstrapCompileOnly.java#L17-L21" target="_blank" title="Go to snippet source"></a><code class="language-java">// Akka Management hosts the HTTP routes used by bootstrap
AkkaManagement.get(system).start();

// Starting the bootstrap process needs to be done explicitly
ClusterBootstrap.get(system).start();</code></pre></dd>
</dl>
<p>Ensure that <code>seed-nodes</code> is not present in configuration and that <code>start()</code> is called on every node.</p>
<p>The following configuration is required, more details for each and additional configuration can be found in <a href="https://github.com/akka/akka-management/blob/master/cluster-bootstrap/src/main/resources/reference.conf">reference.conf</a>:</p>
<ul>
  <li><code>akka.management.cluster.bootstrap.contact-point-discovery.service-name</code>: a unique name in the deployment environment for this cluster  instance which is used to lookup peers in service discovery. If unset, it will be derived from the <code>ActorSystem</code> name.</li>
  <li><code>akka.management.cluster.bootstrap.contact-point-discovery.discovery-method</code>: the intended service discovery mechanism (from what choices Akka Discovery provides).  If unset, falls back to the system-wide default from <code>akka.discovery.method</code>.</li>
</ul>
<h2><a href="#how-it-works" name="how-it-works" class="anchor"><span class="anchor-link"></span></a>How It Works</h2>
<ul>
  <li>Each node exposes an HTTP endpoint <code>/bootstrap/seed-nodes</code>. This is provided by <code>akka-management-cluster-bootstrap</code> and  exposed automatically by starting Akka management.</li>
  <li>During bootstrap each node queries service discovery repeatedly to get the initial contact points until at least the  number of contact points as defined in <code>contact-point-discovery.required-contact-point-nr</code> has been found.</li>
  <li>Each node then probes the found contact points&rsquo; <code>/bootstrap/seed-nodes</code> endpoint to see if a cluster has already  been formed
    <ul>
      <li>If there is an existing cluster, it joins the cluster and bootstrapping is finished.</li>
      <li>If no cluster exists, each node returns an empty list of <code>seed-nodes</code>. In that case, the node with the lowest  address from the set of contact points forms a new cluster and starts advertising itself as a seed node.</li>
    </ul>
  </li>
  <li>Other nodes will start to see the <code>/bootstrap/seed-nodes</code> of the node that self-joined and will join its cluster.</li>
</ul>
<p>See <a href="details.html">full bootstrap process and advanced configuration</a> for more details on the process.</p>
<h2><a href="#joining-mechanism-precedence" name="joining-mechanism-precedence" class="anchor"><span class="anchor-link"></span></a>Joining Mechanism Precedence</h2>
<p>As Akka Cluster allows nodes to join to a cluster using multiple different methods, the precedence of each method is strictly defined and is as follows:</p>
<ul>
  <li>If <code>akka.cluster.seed-nodes</code> (in your <code>application.conf</code>) are non-empty, those nodes will be joined, and bootstrap  will NOT execute even if <code>start()</code> is called, however a warning will be logged.</li>
  <li>If an explicit <code>cluster.join</code> or <code>cluster.joinSeedNodes</code> is invoked before the bootstrap completes, that  joining would take precedence over the bootstrap (but it&rsquo;s not recommended to do so, see below).</li>
  <li>The Cluster Bootstrap mechanism takes some time to complete, but eventually issues a <code>joinSeednodes</code>.</li>
</ul><div class="callout warning "><div class="callout-title">Warning</div>
<p>It is NOT recommended to mix various joining mechanisms. Pick one mechanism and stick to it in order to  avoid any surprises during cluster formation. E.g. do NOT set <code>akka.cluster.seed-nodes</code> if you are going  to be using the Bootstrap mechanism.</p></div>
<h2><a href="#deployment-considerations" name="deployment-considerations" class="anchor"><span class="anchor-link"></span></a>Deployment considerations</h2>
<h3><a href="#initial-deployment" name="initial-deployment" class="anchor"><span class="anchor-link"></span></a>Initial deployment</h3>
<p>Cluster Bootstrap will always attempt to join an existing cluster if possible. However if no other contact point advertises any <code>seed-nodes</code> a new cluster will be formed by the node decided by the <code>JoinDecider</code> where the default sorts the addresses then picks the lowest.</p>
<p>A setting is provided, <code>akka.management.cluster.bootstrap.new-cluster-enabled</code> that can be disable new cluster formation to only allow the node to join existing clusters. </p>
<ul>
  <li>On initial deployment use the default <code>akka.management.cluster.bootstrap.new-cluster-enabled=on</code></li>
  <li>Following the initial deployment it is recommended to set <code>akka.management.cluster.bootstrap.new-cluster-enabled=off</code>  with an immediate re-deployment once the initial cluster has formed</li>
</ul>
<p>This can be used to provide additional safety during restarts and redeploys while there is a network partition present. Without new cluster formation disabled an isolated set of nodes could form a new cluster if all are restarted. </p>
<p>For complete safety of the Initial Bootstrap it is recommended to set the <code>contact-point-discovery.required-contact-point-nr</code> setting to the exact number of nodes the initial startup of the cluster will be done. For example, if starting a cluster with 4 nodes initially, and later scaling it out to many more nodes, be sure to set this setting to <code>4</code> for additional safety of the initial joining, even in face of an flaky discovery mechanism!</p>
<h3><a href="#recommended-configuration" name="recommended-configuration" class="anchor"><span class="anchor-link"></span></a>Recommended Configuration</h3>
<p>When using the bootstrap module, there are some underlying Akka Cluster settings that should be specified to ensure that your deployment is robust.</p>
<p>Since the target environments for this module are dynamic, that is, instances can come and go, failure needs to be considered. The following configuration will result in your application being shut down after 30 seconds if it is unable to join the discovered seed nodes. In this case, the orchestrator (i.e. Kubernetes or Marathon) will restart your node and the operation will (presumably) eventually succeed. You&rsquo;ll want to specify the following in your <code>application.conf</code> file:</p>
<pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/akka-management/tree/v1.0.6/integration-test/local/src/main/resources/application.conf#L20-L21" target="_blank" title="Go to snippet source"></a><code class="language-conf">akka.cluster.shutdown-after-unsuccessful-join-seed-nodes = 30s
akka.coordinated-shutdown.exit-jvm = on</code></pre>
<h3><a href="#rolling-updates" name="rolling-updates" class="anchor"><span class="anchor-link"></span></a>Rolling updates</h3>
<h4><a href="#graceful-shutdown" name="graceful-shutdown" class="anchor"><span class="anchor-link"></span></a>Graceful shutdown</h4>
<p>Akka Cluster can handle hard failures using a downing provider such as Lightbend&rsquo;s split brain resolver discussed below. However this should not be relied upon for regular rolling redeploys. Features such as <code>ClusterSingleton</code>s and <code>ClusterSharding</code> can safely restart actors on new nodes far quicker when it is certain that a node has shutdown rather than crashed. </p>
<p>Graceful leaving will happen with the default settings as it is part of <a href="https://doc.akka.io/docs/akka/2.5.27/actors.html#coordinated-shutdown">Coordinated Shutdown</a>. Just ensure that a node is sent a <code>SIGTERM</code> and not a <code>SIGKILL</code>. Environments such as Kubernetes will do this, it is important to ensure that if JVM is wrapped with a script that it forwards the signal. </p>
<p>Upon receiving a <code>SIGTERM</code> Coordinated Shutdown will:</p>
<ul>
  <li>Perform a <code>Cluster(system).leave</code> on itself</li>
  <li>The status of the member will be changed to Exiting while allowing any shards to be shutdown gracefully and  <code>ClusterSingleton</code>s to be migrated if this was the oldest node. Finally the node is removed from the Akka Cluster membership.</li>
</ul>
<h4><a href="#number-of-nodes-to-redeploy-at-once" name="number-of-nodes-to-redeploy-at-once" class="anchor"><span class="anchor-link"></span></a>Number of nodes to redeploy at once</h4>
<p>Akka bootstrap requires a <code>stable-period</code> where service discovery returns a stable set of contact points. When doing rolling updates it is best to wait for a node (or group of nodes) to finish joining the cluster before adding and removing other nodes.</p>
<h4><a href="#cluster-singletons" name="cluster-singletons" class="anchor"><span class="anchor-link"></span></a>Cluster Singletons</h4>
<p><code>ClusterSingleton</code>s run on the oldest node in the cluster. To avoid singletons moving during every node deployment it is advised to start a rolling redeploy starting at the newest node. Then <code>ClusterSingleton</code>s only move once. This is the default behaviour for Kubernetes deployments. Cluster Sharding uses a singleton internally so this is important even if not using singletons directly.</p>
<h3><a href="#split-brains-and-ungraceful-shutdown" name="split-brains-and-ungraceful-shutdown" class="anchor"><span class="anchor-link"></span></a>Split brains and ungraceful shutdown</h3>
<p>Nodes can crash causing cluster members to become unreachable. This is a tricky problem as it is not possible to distinguish between a network partition and a node failure. To rectify this in an automated manner, Lightbend provides <a href="https://doc.akka.io/docs/akka-enhancements/current/split-brain-resolver.html">Split Brain Resolver</a> as a feature of the Lightbend Subscription. This module has a number of strategies that can ensure that the cluster continues to function during network partitions and node failures.</p>
<h2><a href="#bootstrap-recipes" name="bootstrap-recipes" class="anchor"><span class="anchor-link"></span></a>Bootstrap Recipes</h2>
<p>To see how to configure and use bootstrap in various environments such as Kubernetes, see <a href="recipes.html">recipes</a>.</p>
</div>
</article>
<div class="row">
<div class="small-12 column">
<section class="nav-prev-next row">
<div class="nav-prev small-6 column">
<a href="../healthchecks.html"><i class="icon-prev"></i> <span class="link-prev">Health checks</span></a>
</div>
<div class="nav-next small-6 column clearfix">
<a class="float-right" href="../bootstrap/recipes.html">Bootstrap environments <i class="icon-next"></i></a>
</div>
</section>
</div>
</div>
<div class="source-github row">
Found an error in this documentation? The source code for this page can be found <a href="https://github.com/akka/akka-management/tree/v1.0.6/docs/src/main/paradox/bootstrap/index.md">here</a>.
Please feel free to edit and contribute a pull request.
</div>

<footer class="page-footer row clearfix">
<img class="akka-icon float-left show-for-medium" src="../images/akka-icon.svg" />
<section class="copyright">
<div>Akka Management is Open Source and available under the Apache 2 License.</div>
<p class="legal">
&copy; 2011-2020 <a href="https://www.lightbend.com" target="_blank">Lightbend, Inc.</a> |
<a href="https://www.lightbend.com/legal/licenses" target="_blank">Licenses</a> |
<a href="https://www.lightbend.com/legal/terms" target="_blank">Terms</a> |
<a href="https://www.lightbend.com/legal/privacy" target="_blank">Privacy Policy</a> |
<a href="https://akka.io/cookie/" target="_blank">Cookie Listing</a> |
<a class="optanon-toggle-display">Cookie Settings</a>
</p>
</section>

</footer>
</section>
</main>
</div>

<script type="text/javascript" src="../js/scrollsneak.js"></script>
<script type="text/javascript">jQuery(document).foundation();</script>
<script type="text/javascript" src="../js/groups.js"></script>
<script type="text/javascript" src="../js/page.js"></script>
<script type="text/javascript" src="../js/magellan.js"></script>
<script type="text/javascript" src="../js/metadata-toggle.js"></script>

<style type="text/css">@import "../lib/prettify/prettify.css";</style>
<script type="text/javascript" src="../lib/prettify/prettify.js"></script>
<script type="text/javascript" src="../lib/prettify/lang-scala.js"></script>
<script type="text/javascript">//<![CDATA[
jQuery(function(){window.prettyPrint && prettyPrint()});
//]]></script>
<script type="text/javascript" src="../assets/js/warnOldVersion.js"></script>
<script type="text/javascript">//<![CDATA[
jQuery(function(jq){initOldVersionWarnings(jq, '1.0.6', 'https://doc.akka.io/docs/akka-management/current/')});
//]]></script>


</body>
</html>
