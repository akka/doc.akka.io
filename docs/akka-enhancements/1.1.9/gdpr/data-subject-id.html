<!DOCTYPE html>
<html class="no-js" lang="en">

<head>
<title>Subject identifiers &bull; Akka Enhancements</title>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<meta name="description" content="Akka Enhancements is a suite of useful components that complement Akka."/>
<link rel="canonical" href="https://doc.akka.io/docs/akka-enhancements/current/gdpr/data-subject-id.html"/>
<script type="text/javascript" src="../lib/jquery/jquery.min.js"></script>
<script type="text/javascript" src="../lib/foundation/dist/js/foundation.min.js"></script>
<link rel="stylesheet" type="text/css" href="../lib/normalize.css/normalize.css"/>
<link rel="stylesheet" type="text/css" href="../lib/foundation/dist/css/foundation.min.css"/>
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.css" />
<link rel="stylesheet" type="text/css" href="../css/icons.css"/>
<link rel="stylesheet" type="text/css" href="../css/page.css"/>
<link rel="shortcut icon" href="../images/favicon.ico" />
<link rel="apple-touch-icon" sizes="180x180" href="../images/apple-touch-icon.png"/>
<link rel="icon" type="image/png" sizes="32x32" href="../images/favicon-32x32.png"/>
<link rel="icon" type="image/png" sizes="16x16" href="../images/favicon-16x16.png"/>
<link rel="manifest" href="../images/manifest.json"/>
<meta name="msapplication-TileImage" content="../images/mstile-150x150.png"/>
<meta name="msapplication-TileColor" content="#15a9ce"/>
<meta name="theme-color" content="#15a9ce"/>
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>
<!-- OneTrust Cookies Consent Notice (Production Standard, akka.io, en-GB) start -->
<script src="https://optanon.blob.core.windows.net/consent/159bb13d-6748-4399-806e-ac28db879785.js" type="text/javascript" charset="UTF-8"></script>
<script type="text/javascript">
function OptanonWrapper() { }
</script>
<!-- OneTrust Cookies Consent Notice (Production Standard, akka.io, en-GB) end -->
<!--Google Analytics-->
<script type="text/plain" class="optanon-category-2">
var _gaq = _gaq || [];
_gaq.push(['_setAccount', '']);
_gaq.push(['_setDomainName', '']);
_gaq.push(['_trackPageview']);
(function() {
var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})()
</script>
<script type="text/plain" class="optanon-category-2">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-23127719-1', 'lightbend.com', {'allowLinker': true, 'name': 'tsTracker'});
ga('tsTracker.require', 'linker');
ga('tsTracker.linker:autoLink', ['lightbend.com','playframework.com','scala-lang.org','scaladays.org','spray.io','akka.io','scala-sbt.org','scala-ide.org']);
ga('tsTracker.send', 'pageview');
</script>
<!--Marketo-->
<script type="text/plain" class="optanon-category-3">
(function() {
var didInit = false;
function initMunchkin() {
if(didInit === false) {
didInit = true;
Munchkin.init('558-NCX-702', { 'asyncOnly': true, 'disableClickDelay': true });
}
}
var s = document.createElement('script');
s.type = 'text/javascript';
s.async = true;
s.src = '//munchkin.marketo.net/munchkin.js';
s.onreadystatechange = function() {
if (this.readyState == 'complete' || this.readyState == 'loaded') {
initMunchkin();
}
};
s.onload = initMunchkin;
document.getElementsByTagName('head')[0].appendChild(s);
})();
</script>
</head>

<body id="underlay" data-toggler="nav-open">

<header class="site-header hide-for-large">
<div class="sticky-header clearfix">
<a href="https://akka.io"><img class="logo" src="../images/akka-logo-reverse.svg"/></a>

<button class="menu-icon float-right" type="button" data-toggle="underlay overlay"></button>
</div>
<div id="overlay" class="overlay-nav" data-toggler="nav-open">
<header class="nav-header">
<div class="nav-header-title">
<h1><a href="../index.html">Akka Enhancements</a></h1>
</div>
<div class="nav-header-version">
Version 1.1.9
</div>
<div class="nav-header-groups">
<select class="supergroup" name="Languages"><option class="group" value="group-java">Java</option><option class="group" value="group-scala">Scala</option></select>
</div>
</header>
<nav class="nav-toc">
<ul>
  <li><a href="../akka-resilience-enhancements.html" class="page">Akka Resilience Enhancements</a></li>
  <li><a href="../akka-persistence-enhancements.html" class="page">Akka Persistence Enhancements</a>
  <ul>
    <li><a href="../persistence-dc/index.html" class="page">Akka Multi-DC Persistence</a></li>
    <li><a href="../gdpr/index.html" class="page">GDPR for Akka Persistence</a>
    <ul>
      <li><a href="../gdpr/index.html#introduction" class="header">Introduction</a></li>
      <li><a href="../gdpr/data-subject-id.html#subject-identifiers" class="active page">Subject identifiers</a>
      <ul>
        <li><a href="../gdpr/data-subject-id.html#example" class="header">Example</a></li>
      </ul></li>
      <li><a href="../gdpr/shredding.html" class="page">Shred or delete?</a></li>
      <li><a href="../gdpr/using.html" class="page">Using akka-gdpr</a></li>
      <li><a href="../gdpr/encryption.html" class="page">Encrypting data</a></li>
      <li><a href="../gdpr/migration.html" class="page">Migrating existing data</a></li>
      <li><a href="../gdpr/lagom.html" class="page">Lagom specifics</a></li>
      <li><a href="../gdpr/other-storage.html" class="page">Other data storage</a></li>
    </ul></li>
    <li><a href="../akka-persistence-enhancements-release-notes.html" class="page">Akka Persistence Enhancements Release Notes</a></li>
  </ul></li>
</ul>
</nav>
</div>
</header>

<aside class="show-for-large">
<header class="nav-header fixed-sidebar-header">
<div class="nav-header-title">
<h1><a href="../index.html">Akka Enhancements</a></h1>
</div>
<div class="nav-header-version">
Version 1.1.9
</div>
<div class="nav-header-groups">
<select class="supergroup" name="Languages"><option class="group" value="group-java">Java</option><option class="group" value="group-scala">Scala</option></select>
</div>
</header>
<nav class="site-nav fixed-sidebar-contents">
<div class="nav-toc">
<ul>
  <li><a href="../akka-resilience-enhancements.html" class="page">Akka Resilience Enhancements</a></li>
  <li><a href="../akka-persistence-enhancements.html" class="page">Akka Persistence Enhancements</a>
  <ul>
    <li><a href="../persistence-dc/index.html" class="page">Akka Multi-DC Persistence</a></li>
    <li><a href="../gdpr/index.html" class="page">GDPR for Akka Persistence</a>
    <ul>
      <li><a href="../gdpr/index.html#introduction" class="header">Introduction</a></li>
      <li><a href="../gdpr/data-subject-id.html#subject-identifiers" class="active page">Subject identifiers</a>
      <ul>
        <li><a href="../gdpr/data-subject-id.html#example" class="header">Example</a></li>
      </ul></li>
      <li><a href="../gdpr/shredding.html" class="page">Shred or delete?</a></li>
      <li><a href="../gdpr/using.html" class="page">Using akka-gdpr</a></li>
      <li><a href="../gdpr/encryption.html" class="page">Encrypting data</a></li>
      <li><a href="../gdpr/migration.html" class="page">Migrating existing data</a></li>
      <li><a href="../gdpr/lagom.html" class="page">Lagom specifics</a></li>
      <li><a href="../gdpr/other-storage.html" class="page">Other data storage</a></li>
    </ul></li>
    <li><a href="../akka-persistence-enhancements-release-notes.html" class="page">Akka Persistence Enhancements Release Notes</a></li>
  </ul></li>
</ul>
</div>
</nav>
<footer class="nav-footer fixed-sidebar-footer">
<a href="https://akka.io"><img class="logo" src="../images/akka-logo-reverse.svg"/></a>

</footer>
</aside>

<main class="fixed-shift-for-large expanded row">
<section class="site-content small-12 column">

<article class="page-content row">
<div class="small-12 large-9 column" id="docs">
<h1><a href="#subject-identifiers" name="subject-identifiers" class="anchor"><span class="anchor-link"></span></a>Subject identifiers</h1><div class="callout note "><div class="callout-title">Note</div>
<p>The following is not legal advice, but simply general suggestions and ideas. The GDPR field is still in flux, and only with time will accepted patterns and common use cases emerge. </p></div>
<p>As introduced in the <a href="index.html">overview</a>, dealing with data subject identifiers is an important part of a GDPR strategy. There are multiple ways to implement identifiers correctly, depending on your application:</p>
<ul>
  <li>
  <p>If your application already has some <code>userId</code> you may want to use this identifier for the data subject id. However, you should take care that such id does not <em>itself</em> carry personal information. For example, if the id includes the &ldquo;nickname&rdquo; of an user, you should <em>not</em> use it as a data subject id: the ID itself can be seen as personal data. If you would like to use user ids as your data subject ids you may want to consider using a SHA-1 of the user id and some additional seed, as illustrated in the example below.</p></li>
  <li>
  <p>A good alternative is to generate UUIDs for data subjects. You can do so using the <code>java.util.UUID</code> class and obtain its <code>String</code> representation to be used in the <code>WithDataSubjectId</code> wrapper provided by <code>akka-gdpr</code>, as described in @ref[]. </p></li>
</ul>
<p>Also, check whether &ldquo;a user&rdquo; has more than one data subject id. For example, different systems may have assigned the same user different ids. When a request to remove data for a given user is issued to your application, it may need to deal with all of the user&rsquo;s data subject ids. </p>
<p>Another point of discussion is whether metadata associated with a particular data subject id should be removed or not. Even when using data shredding, it is possible that information about when events were stored linked together with correlated data could be used to deduce some information about &ldquo;that specific&rdquo; data subject. At this point no rulings have established how far one should go with regards to sanitizing such metadata.</p>
<h2><a href="#example" name="example" class="anchor"><span class="anchor-link"></span></a>Example</h2>
<p>The following example illustrates using SHA-1 to encrypt a user id:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">import java.security.MessageDigest

import akka.Done
import akka.stream.scaladsl.Sink


// only share the instance when using parallelism = 1
private val sha1 = MessageDigest.getInstance(&quot;SHA-1&quot;)

/**
 * Implement your logic for determining a stable data subject id for each event here.
 *
 * For example, it could be based on masking a known user identifier that exists in all
 * events related to a given user. Or it could be *based on* the persistenceId of the event passed in,
 * which is a simple and effective solution.
 */
private def determineEncryptionKey(event: JournaledEvent): Option[String] = {
  if (event.persistenceId startsWith &quot;user&quot;) {
    try {
      sha1.update(&quot;my-app-secrets&quot;.getBytes)
      sha1.update(event.persistenceId.getBytes)

      Some(new String(sha1.digest()))
    } finally {
      sha1.reset()
    }
  } else {
    None
  }
}</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><code class="language-java">import java.security.MessageDigest;

final MessageDigest SHA1; // only share the instance when using parallelism = 1

/**
 * Implement your logic for determining a stable data subject id for each event here.
 *
 * For example, it could be based on masking a known user identifier that exists in all
 * events related to a given user. Or it could be *based on* the persistenceId of the event passed in,
 * which is a simple and effective solution.
 */
private Optional&lt;String&gt; determineEncryptionKey(JournaledEvent event) {
  if (event.persistenceId().startsWith(&quot;user&quot;)) {
    try {
      SHA1.update(&quot;my-app-secrets&quot;.getBytes());
      SHA1.update(event.persistenceId().getBytes());
      return Optional.of(new String(SHA1.digest()));
    } catch (Exception ex) {
      return  Optional.empty();
    } finally {
      SHA1.reset();
    }
  } else {
    return Optional.empty();
  }
}</code></pre></dd>
</dl>
</div>
</article>

<div class="row">
<div class="small-12 large-9 column">
<section class="nav-prev-next row">
<div class="nav-prev small-6 column">
<a href="../gdpr/index.html"><i class="icon-prev"></i> <span class="link-prev">GDPR for Akka Persistence</span></a>
</div>
<div class="nav-next small-6 column clearfix">
<a class="float-right" href="../gdpr/shredding.html">Shred or delete? <i class="icon-next"></i></a>
</div>
</section>
</div>
</div>

<!-- no source links for private github repository -->


<footer class="page-footer row clearfix">
<img class="akka-icon float-left show-for-medium" src="../images/akka-icon.svg"/>
<section class="copyright">
<div>Akka Enhancements is Open Source and available under the Apache 2 License.</div>
<p class="legal">
&copy; 2011-2019 <a href="https://www.lightbend.com" target="_blank">Lightbend, Inc.</a> | 
<a href="https://www.lightbend.com/legal/licenses" target="_blank">Licenses</a> | 
<a href="https://www.lightbend.com/legal/terms" target="_blank">Terms</a> | 
<a href="https://www.lightbend.com/legal/privacy" target="_blank">Privacy Policy</a> | 
<a href="https://akka.io/cookie/" target="_blank">Cookie Listing</a> | 
<a class="optanon-toggle-display">Cookie Settings</a>
</p>
</section>
</footer>

</section>
</main>

<script type="text/javascript" src="../js/scrollsneak.js"></script>
<script type="text/javascript">jQuery(document).foundation();</script>
<script type="text/javascript" src="../js/groups.js"></script>
<script type="text/javascript" src="../js/page.js"></script>
<script type="text/javascript" src="../js/magellan.js"></script>

<style type="text/css">@import "../lib/prettify/prettify.css";</style>
<script type="text/javascript" src="../lib/prettify/prettify.js"></script>
<script type="text/javascript" src="../lib/prettify/lang-scala.js"></script>
<script type="text/javascript">//<![CDATA[
jQuery(function(){window.prettyPrint && prettyPrint()});
//]]></script>
<!-- hook for including project specific javascript into the generated docs -->

</body>
</html>
