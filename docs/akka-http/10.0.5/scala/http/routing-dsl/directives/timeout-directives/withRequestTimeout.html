<!DOCTYPE html>
<html class="no-js" lang="en">

<head>
  <title>withRequestTimeout · Akka HTTP</title>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <meta name="description" content='akka-http-docs'/>
  <link
      href="https://fonts.googleapis.com/css?family=Roboto:100normal,100italic,300normal,300italic,400normal,400italic,500normal,500italic,700normal,700italic,900normal,900italicc"
      rel="stylesheet" type="text/css"/>
  <script type="text/javascript" src="../../../../../lib/jquery/jquery.min.js"></script>
  <script type="text/javascript" src="../../../../../js/page.js"></script>
  <link rel="stylesheet" type="text/css" href="../../../../../lib/normalize.css/normalize.css"/>
  <link rel="stylesheet" type="text/css" href="../../../../../lib/foundation/dist/foundation.min.css"/>
  <link rel="stylesheet" type="text/css" href="../../../../../css/page.css"/>


  <link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.css"/>
</head>

<body>
<div class="off-canvas-wrapper">
  <div class="off-canvas-wrapper-inner" data-off-canvas-wrapper>

    <div class="off-canvas position-left" id="off-canvas-menu" data-off-canvas>
      <nav class="off-canvas-nav">
        <div class="nav-home">
        <a href="../../../../../index.html" >
        <span class="home-icon">⌂</span>Akka HTTP
        </a>
        <div class="version-number">
        10.0.5
        </div>
        </div>
        <div class="nav-toc">
        <ul>
          <li><a href="../../../../../security.html">Security announcements</a></li>
          <li><a href="../../../../../release-notes.html">Release Notes</a></li>
          <li><a href="../../../../../java.html">Java Documentation</a>
          <ul>
            <li><a href="../../../../../java/http/index.html">Akka HTTP</a>
            <ul>
              <li><a href="../../../../../java/http/introduction.html">Introduction</a></li>
              <li><a href="../../../../../java/http/configuration.html">Configuration</a></li>
              <li><a href="../../../../../java/http/common/index.html">Common Abstractions (Client- and Server-Side)</a></li>
              <li><a href="../../../../../java/http/implications-of-streaming-http-entity.html">Implications of the streaming nature of Request/Response Entities</a></li>
              <li><a href="../../../../../java/http/server-side/low-level-server-side-api.html">Low-Level Server-Side API</a></li>
              <li><a href="../../../../../java/http/routing-dsl/index.html">High-level Server-Side API</a></li>
              <li><a href="../../../../../java/http/server-side/websocket-support.html">Server-Side WebSocket Support</a></li>
              <li><a href="../../../../../java/http/client-side/index.html">Consuming HTTP-based Services (Client-Side)</a></li>
              <li><a href="../../../../../java/http/server-side-https-support.html">Server-Side HTTPS Support</a></li>
              <li><a href="../../../../../java/http/migration-guide/index.html">Migration Guides (Java)</a></li>
            </ul></li>
          </ul></li>
          <li><a href="../../../../../scala.html">Scala Documentation</a>
          <ul>
            <li><a href="../../../../../scala/http/index.html">Akka HTTP</a>
            <ul>
              <li><a href="../../../../../scala/http/introduction.html">Introduction</a></li>
              <li><a href="../../../../../scala/http/configuration.html">Configuration</a></li>
              <li><a href="../../../../../scala/http/common/index.html">Common Abstractions (Client- and Server-Side)</a></li>
              <li><a href="../../../../../scala/http/implications-of-streaming-http-entity.html">Implications of the streaming nature of Request/Response Entities</a></li>
              <li><a href="../../../../../scala/http/low-level-server-side-api.html">Low-Level Server-Side API</a></li>
              <li><a href="../../../../../scala/http/routing-dsl/index.html">High-level Server-Side API</a></li>
              <li><a href="../../../../../scala/http/websocket-support.html">Server-Side WebSocket Support</a></li>
              <li><a href="../../../../../scala/http/client-side/index.html">Consuming HTTP-based Services (Client-Side)</a></li>
              <li><a href="../../../../../scala/http/server-side-https-support.html">Server-Side HTTPS Support</a></li>
              <li><a href="../../../../../scala/http/handling-blocking-operations-in-akka-http-routes.html">Handling blocking operations in Akka HTTP</a></li>
              <li><a href="../../../../../scala/http/migration-guide/index.html">Migration Guides</a></li>
            </ul></li>
          </ul></li>
        </ul>
        </div>

      </nav>
    </div>

    <div class="off-canvas-content" data-off-canvas-content>

      <header class="site-header expanded row">
        <div class="small-12 column">
          <a href="#" class="off-canvas-toggle hide-for-medium" data-toggle="off-canvas-menu"><svg class="svg-icon svg-icon-menu" version="1.1" id="Menu" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 20 20" enable-background="new 0 0 20 20" xml:space="preserve"> <path class="svg-icon-menu-path" fill="#53CDEC" d="M16.4,9H3.6C3.048,9,3,9.447,3,10c0,0.553,0.048,1,0.6,1H16.4c0.552,0,0.6-0.447,0.6-1C17,9.447,16.952,9,16.4,9z M16.4,13
H3.6C3.048,13,3,13.447,3,14c0,0.553,0.048,1,0.6,1H16.4c0.552,0,0.6-0.447,0.6-1C17,13.447,16.952,13,16.4,13z M3.6,7H16.4
C16.952,7,17,6.553,17,6c0-0.553-0.048-1-0.6-1H3.6C3.048,5,3,5.447,3,6C3,6.553,3.048,7,3.6,7z"/></svg>
</a>

          <img src="../../../../../css/../mini-akka-logo.png" alt="Akka logo" style="float: left"/> <div class="title"><a href="../../../../../index.html">Akka HTTP</a></div>


          <div style="position: relative; right:0; min-width:25%" class="float-right">
            <input type="search" id="search" class="form-control" style="margin: 10px 0;" placeholder="Search the docs..."/>
          </div>

        </div>
      </header>

      <div class="expanded row">

        <div class="medium-3 large-2 show-for-medium column">

          <nav class="site-nav">
            <div class="nav-home">
            <a href="../../../../../index.html" >
            <span class="home-icon">⌂</span>Akka HTTP
            </a>
            <div class="version-number">
            10.0.5
            </div>
            </div>
            <div class="nav-toc">
            <ul>
              <li><a href="../../../../../security.html">Security announcements</a></li>
              <li><a href="../../../../../release-notes.html">Release Notes</a></li>
              <li><a href="../../../../../java.html">Java Documentation</a>
              <ul>
                <li><a href="../../../../../java/http/index.html">Akka HTTP</a>
                <ul>
                  <li><a href="../../../../../java/http/introduction.html">Introduction</a></li>
                  <li><a href="../../../../../java/http/configuration.html">Configuration</a></li>
                  <li><a href="../../../../../java/http/common/index.html">Common Abstractions (Client- and Server-Side)</a></li>
                  <li><a href="../../../../../java/http/implications-of-streaming-http-entity.html">Implications of the streaming nature of Request/Response Entities</a></li>
                  <li><a href="../../../../../java/http/server-side/low-level-server-side-api.html">Low-Level Server-Side API</a></li>
                  <li><a href="../../../../../java/http/routing-dsl/index.html">High-level Server-Side API</a></li>
                  <li><a href="../../../../../java/http/server-side/websocket-support.html">Server-Side WebSocket Support</a></li>
                  <li><a href="../../../../../java/http/client-side/index.html">Consuming HTTP-based Services (Client-Side)</a></li>
                  <li><a href="../../../../../java/http/server-side-https-support.html">Server-Side HTTPS Support</a></li>
                  <li><a href="../../../../../java/http/migration-guide/index.html">Migration Guides (Java)</a></li>
                </ul></li>
              </ul></li>
              <li><a href="../../../../../scala.html">Scala Documentation</a>
              <ul>
                <li><a href="../../../../../scala/http/index.html">Akka HTTP</a>
                <ul>
                  <li><a href="../../../../../scala/http/introduction.html">Introduction</a></li>
                  <li><a href="../../../../../scala/http/configuration.html">Configuration</a></li>
                  <li><a href="../../../../../scala/http/common/index.html">Common Abstractions (Client- and Server-Side)</a></li>
                  <li><a href="../../../../../scala/http/implications-of-streaming-http-entity.html">Implications of the streaming nature of Request/Response Entities</a></li>
                  <li><a href="../../../../../scala/http/low-level-server-side-api.html">Low-Level Server-Side API</a></li>
                  <li><a href="../../../../../scala/http/routing-dsl/index.html">High-level Server-Side API</a></li>
                  <li><a href="../../../../../scala/http/websocket-support.html">Server-Side WebSocket Support</a></li>
                  <li><a href="../../../../../scala/http/client-side/index.html">Consuming HTTP-based Services (Client-Side)</a></li>
                  <li><a href="../../../../../scala/http/server-side-https-support.html">Server-Side HTTPS Support</a></li>
                  <li><a href="../../../../../scala/http/handling-blocking-operations-in-akka-http-routes.html">Handling blocking operations in Akka HTTP</a></li>
                  <li><a href="../../../../../scala/http/migration-guide/index.html">Migration Guides</a></li>
                </ul></li>
              </ul></li>
            </ul>
            </div>

          </nav>
        </div>

        <div class="small-12 medium-9 large-10 column">
          <section class="site-content">

            <div class="page-header row">
              <div class="medium-12 show-for-medium column">
                <div class="nav-breadcrumbs">
                  <ul>
                    <li><a href="../../../../../index.html">Akka HTTP</a></li>
                    <li><a href="../../../../../scala.html">Scala Documentation</a></li>
                    <li><a href="../../../../../scala/http/index.html">Akka HTTP</a></li>
                    <li><a href="../../../../../scala/http/routing-dsl/index.html">High-level Server-Side API</a></li>
                    <li><a href="../../../../../scala/http/routing-dsl/directives/index.html">Directives</a></li>
                    <li><a href="../../../../../scala/http/routing-dsl/directives/by-trait.html">Predefined Directives (by trait)</a></li>
                    <li><a href="../../../../../scala/http/routing-dsl/directives/timeout-directives/index.html">TimeoutDirectives</a></li>
                    <li>withRequestTimeout</li>
                  </ul>
                </div>
              </div>
            </div>

            <div class="page-content row">
              <div class="small-12 large-9 column" id="docs">

<a id="withrequesttimeout"></a>
<h1><a href="#withrequesttimeout" name="withrequesttimeout" class="anchor"><span class="anchor-link"></span></a>withRequestTimeout</h1>
<h2><a href="#signature" name="signature" class="anchor"><span class="anchor-link"></span></a>Signature</h2>
<pre class="prettyprint"><code class="language-scala">def withRequestTimeout(timeout: Duration): Directive0
def withRequestTimeout(timeout: Duration, handler: HttpRequest ⇒ HttpResponse): Directive0
def withRequestTimeout(timeout: Duration, handler: Option[HttpRequest ⇒ HttpResponse]): Directive0</code></pre>
<h2><a href="#description" name="description" class="anchor"><span class="anchor-link"></span></a>Description</h2>
<p>This directive enables &ldquo;late&rdquo; (during request processing) control over the <a href="../../../common/timeouts.html#request-timeout-scala">Request timeout</a> feature in Akka HTTP.</p>
<p>The timeout can be either loosened or made more tight using this directive, however one should be aware that it is inherently racy (which may especially show with very tight timeouts) since a timeout may already have been triggered when this directive executes.</p>
<p>In case of pipelined HTTP requests (multiple requests being accepted on the same connection before sending the first response) a the request timeout failure of the <code>n-th</code> request <em>will shut down the connection</em> causing the already enqueued requests to be dropped. This is by-design, as the request timeout feature serves as a &ldquo;safety net&rdquo; in case of programming errors (e.g. a Future that never completes thus potentially blocking the entire connection forever) or malicious attacks on the server.</p>
<p>Optionally, a timeout handler may be provided in which is called when a time-out is triggered and must produce an <code>HttpResponse</code> that will be sent back to the client instead of the &ldquo;too late&rdquo; response (in case it&rsquo;d ever arrive). See also <a href="withRequestTimeoutResponse.html#withrequesttimeoutresponse">withRequestTimeoutResponse</a> if only looking to customise the timeout response without changing the timeout itself.</p><div class="callout warning "><div class="callout-title">Warning</div>
<p>Please note that setting the timeout from within a directive is inherently racy (as the &ldquo;point in time from which we&rsquo;re measuring the timeout&rdquo; is already in the past (the moment we started handling the request), so if the existing timeout already was triggered before your directive had the chance to change it, an timeout may still be logged.</p>
<p>It is recommended to use a larger statically configured timeout (think of it as a &ldquo;safety net&rdquo; against programming errors or malicious attackers) and if needed tighten it using the directives – not the other way around.</p></div>
<p>For more information about various timeouts in Akka HTTP see <a href="../../../common/timeouts.html#http-timeouts-scala">Akka HTTP Timeouts</a>.</p>
<h2><a href="#example" name="example" class="anchor"><span class="anchor-link"></span></a>Example</h2>
<pre class="prettyprint"><code class="language-scala">val route =
  path(&quot;timeout&quot;) {
    withRequestTimeout(1.seconds) { // modifies the global akka.http.server.request-timeout for this request
      val response: Future[String] = slowFuture() // very slow
      complete(response)
    }
  }

// check
runRoute(route, &quot;timeout&quot;).status should ===(StatusCodes.ServiceUnavailable) // the timeout response</code></pre>
<p>With setting the handler at the same time:</p>
<pre class="prettyprint"><code class="language-scala">val timeoutResponse = HttpResponse(
  StatusCodes.EnhanceYourCalm,
  entity = &quot;Unable to serve response within time limit, please enhance your calm.&quot;)

val route =
  path(&quot;timeout&quot;) {
    // updates timeout and handler at
    withRequestTimeout(1.milli, request =&gt; timeoutResponse) {
      val response: Future[String] = slowFuture() // very slow
      complete(response)
    }
  }

// check
runRoute(route, &quot;timeout&quot;).status should ===(StatusCodes.EnhanceYourCalm) // the timeout response</code></pre>

                <div>
                  <div class="source-github">
                  The source code for this page can be found <a href="http://github.com/akka/akka-http/tree/master/docs/src/main/paradox/scala/http/routing-dsl/directives/timeout-directives/withRequestTimeout.md">here</a>.
                  </div>

                </div>

                <div class="nav-next">
                  <p><strong>Next:</strong> <a href="../../../../../scala/http/routing-dsl/directives/timeout-directives/withoutRequestTimeout.html">withoutRequestTimeout</a></p>
                </div>
              </div>
              <div class="large-3 show-for-large column" data-sticky-container>
                <nav class="sidebar sticky" data-sticky data-anchor="docs" data-sticky-on="large">
                  <div class="page-nav">
                    <div class="nav-title">On this page:</div>
                    <div class="nav-toc">
                      <ul>
                        <li><a href="../../../../../scala/http/routing-dsl/directives/timeout-directives/withRequestTimeout.html#withrequesttimeout">withRequestTimeout</a>
                        <ul>
                          <li><a href="../../../../../scala/http/routing-dsl/directives/timeout-directives/withRequestTimeout.html#signature">Signature</a></li>
                          <li><a href="../../../../../scala/http/routing-dsl/directives/timeout-directives/withRequestTimeout.html#description">Description</a></li>
                          <li><a href="../../../../../scala/http/routing-dsl/directives/timeout-directives/withRequestTimeout.html#example">Example</a></li>
                        </ul></li>
                      </ul>
                    </div>
                  </div>
                </nav>
              </div>
            </div>

          </section>
        </div>

      </div>

      <footer class="site-footer">

        <section class="site-footer-base">
          <div class="expanded row">
            <div class="small-12 large-12 column">
              <div class="row site-footer-content clearfix">
                <div class="float-right">
		  Last updated: Mar 20, 2017
		</div>
                <div class="float-left">
		  &copy; 2017 <a href="https://www.lightbend.com/">Lightbend Inc.</a>
		  <span class="license">Akka HTTP is Open Source and available under the Apache 2 License.</span>
                </div>
              </div>
            </div>
          </div>
        </section>
      </footer>

    </div>
  </div>
</div>

<script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.js"></script>
<style>.algolia-autocomplete { display: block !important }</style>
<script type="text/javascript">
  var version = '10.0.5'; // replaced by paradox

  var lang = "scala";
  var path = window.location.pathname;
  if (path.includes("/java/") || path.includes("java.html")) {
    lang = "java";
  }

  docsearch({
    apiKey: '0ccbb8bf5148554a406fbf07df0a93b9',
    indexName: 'akka-http',
    inputSelector: '#search',
    algoliaOptions: {'facetFilters': ["version:" + version, "language:" + lang]},
    debug: false // Set debug to true if you want to inspect the dropdown
  });
</script>
</body>

<script type="text/javascript" src="../../../../../lib/foundation/dist/foundation.min.js"></script>
<script type="text/javascript">jQuery(document).foundation();</script>
<script type="text/javascript" src="../../../../../js/magellan.js"></script>

<style type="text/css">@import "../../../../../lib/prettify/prettify.css";</style>
<script type="text/javascript" src="../../../../../lib/prettify/prettify.js"></script>
<script type="text/javascript" src="../../../../../lib/prettify/lang-scala.js"></script>
<script type="text/javascript">jQuery(function () {
  window.prettyPrint && prettyPrint()
});</script>

</html>
