<!DOCTYPE html>
<html class="no-js" lang="en">

<head>
<title>Client-Side HTTPS Support &bull; Akka HTTP</title>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<meta name="description" content="Akka HTTP: Modern, fast, asynchronous, streaming-first HTTP server and client."/><link rel="canonical" href="https://doc.akka.io/docs/akka-http/10.0/java/http/client-side/client-https-support.html"/>
<script type="text/javascript" src="../../../lib/jquery/jquery.min.js"></script>
<script type="text/javascript" src="../../../lib/foundation/dist/js/foundation.min.js"></script>
<link rel="stylesheet" type="text/css" href="../../../lib/normalize.css/normalize.css"/>
<link rel="stylesheet" type="text/css" href="../../../lib/foundation/dist/css/foundation.min.css"/>
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.css" />
<link rel="stylesheet" type="text/css" href="../../../css/icons.css"/>
<link rel="stylesheet" type="text/css" href="../../../css/page.css"/>
<link rel="shortcut icon" href="../../../images/favicon.ico" />
<meta name="theme-color" content="#15a9ce">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<!--Google Analytics-->
<script type="text/javascript">
var _gaq = _gaq || [];
_gaq.push(['_setAccount', 'UA-21117439-1']);
_gaq.push(['_setDomainName', 'akka.io']);
_gaq.push(['_trackPageview']);
(function() {
var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})()
</script>
<!--Google Analytics & Marketo-->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-23127719-1', 'lightbend.com', {'allowLinker': true, 'name': 'tsTracker'});
ga('tsTracker.require', 'linker');
ga('tsTracker.linker:autoLink', ['lightbend.com','playframework.com','scala-lang.org','scaladays.org','spray.io','akka.io','scala-sbt.org','scala-ide.org']);
ga('tsTracker.send', 'pageview');
(function() {
var didInit = false;
function initMunchkin() {
if(didInit === false) {
didInit = true;
Munchkin.init('558-NCX-702');
}
}
var s = document.createElement('script');
s.type = 'text/javascript';
s.async = true;
s.src = '//munchkin.marketo.net/munchkin.js';
s.onreadystatechange = function() {
if (this.readyState == 'complete' || this.readyState == 'loaded') {
initMunchkin();
}
};
s.onload = initMunchkin;
document.getElementsByTagName('head')[0].appendChild(s);
})();
</script>

</head>

<body id="underlay" data-toggler="nav-open">

<header class="site-header hide-for-large">
<div class="sticky-header clearfix">
<a href="https://akka.io"><img class="logo" src="../../../images/akka-logo-reverse.svg"></a>

<button class="menu-icon float-right" type="button" data-toggle="underlay overlay"></button>
</div>
<div id="overlay" class="overlay-nav" data-toggler="nav-open">
<header class="nav-header">
<div class="nav-header-title">
<h1><a href="../../../java/http/index.html">Akka HTTP</a></h1>
</div>
<div class="nav-header-version">
Version 10.0.9
</div>
<div class="nav-header-groups">
<select class="supergroup" name="Languages"><option class="group" value="group-scala">Scala</option><option class="group" value="group-java">Java</option></select>
</div>
<div id="overlay-search-container" class="nav-header-search">
<input id="overlay-search" type="search" class="search" placeholder="Search"/>
</div>
</header>
<nav class="nav-toc">
<ul>
  <li><a href="../../../java/http/security.html" class="page">Security Announcements</a></li>
  <li><a href="../../../java/http/introduction.html" class="page">Introduction</a></li>
  <li><a href="../../../java/http/configuration.html" class="page">Configuration</a></li>
  <li><a href="../../../java/http/common/index.html" class="page">Common Abstractions (Client- and Server-Side)</a></li>
  <li><a href="../../../java/http/implications-of-streaming-http-entity.html" class="page">Implications of the streaming nature of Request/Response Entities</a></li>
  <li><a href="../../../java/http/server-side/low-level-server-side-api.html" class="page">Low-Level Server-Side API</a></li>
  <li><a href="../../../java/http/routing-dsl/index.html" class="page">High-level Server-Side API</a></li>
  <li><a href="../../../java/http/server-side/websocket-support.html" class="page">Server-Side WebSocket Support</a></li>
  <li><a href="../../../java/http/client-side/index.html" class="page">Consuming HTTP-based Services (Client-Side)</a>
  <ul>
    <li><a href="../../../java/http/client-side/request-level.html" class="page">Request-Level Client-Side API</a></li>
    <li><a href="../../../java/http/client-side/host-level.html" class="page">Host-Level Client-Side API</a></li>
    <li><a href="../../../java/http/client-side/connection-level.html" class="page">Connection-Level Client-Side API</a></li>
    <li><a href="../../../java/http/client-side/pool-overflow.html" class="page">Pool overflow and the max-open-requests setting</a></li>
    <li><a href="../../../java/http/client-side/client-https-support.html#client-side-https-support" class="active page">Client-Side HTTPS Support</a>
    <ul>
      <li><a href="../../../java/http/client-side/client-https-support.html#ssl-config" class="header">SSL-Config</a></li>
      <li><a href="../../../java/http/client-side/client-https-support.html#detailed-configuration-and-workarounds" class="header">Detailed configuration and workarounds</a></li>
    </ul></li>
    <li><a href="../../../java/http/client-side/client-transport.html" class="page">Pluggable Client Transports / HTTPS Proxy Support</a></li>
    <li><a href="../../../java/http/client-side/websocket-support.html" class="page">Client-Side WebSocket Support</a></li>
  </ul></li>
  <li><a href="../../../java/http/server-side-https-support.html" class="page">Server-Side HTTPS Support</a></li>
  <li><a href="../../../java/http/migration-guide/index.html" class="page">Migration Guides</a></li>
  <li><a href="../../../java/http/release-notes.html" class="page">Release Notes</a></li>
</ul>
</nav>
</div>
</header>

<aside class="show-for-large">
<header class="nav-header fixed-sidebar-header">
<div class="nav-header-title">
<h1><a href="../../../java/http/index.html">Akka HTTP</a></h1>
</div>
<div class="nav-header-version">
Version 10.0.9
</div>
<div class="nav-header-groups">
<select class="supergroup" name="Languages"><option class="group" value="group-scala">Scala</option><option class="group" value="group-java">Java</option></select>
</div>
<div class="nav-header-search">
<input id="search" type="search" class="search" placeholder="Search"/>
</div>
</header>
<nav class="site-nav fixed-sidebar-contents">
<div class="nav-toc">
<ul>
  <li><a href="../../../java/http/security.html" class="page">Security Announcements</a></li>
  <li><a href="../../../java/http/introduction.html" class="page">Introduction</a></li>
  <li><a href="../../../java/http/configuration.html" class="page">Configuration</a></li>
  <li><a href="../../../java/http/common/index.html" class="page">Common Abstractions (Client- and Server-Side)</a></li>
  <li><a href="../../../java/http/implications-of-streaming-http-entity.html" class="page">Implications of the streaming nature of Request/Response Entities</a></li>
  <li><a href="../../../java/http/server-side/low-level-server-side-api.html" class="page">Low-Level Server-Side API</a></li>
  <li><a href="../../../java/http/routing-dsl/index.html" class="page">High-level Server-Side API</a></li>
  <li><a href="../../../java/http/server-side/websocket-support.html" class="page">Server-Side WebSocket Support</a></li>
  <li><a href="../../../java/http/client-side/index.html" class="page">Consuming HTTP-based Services (Client-Side)</a>
  <ul>
    <li><a href="../../../java/http/client-side/request-level.html" class="page">Request-Level Client-Side API</a></li>
    <li><a href="../../../java/http/client-side/host-level.html" class="page">Host-Level Client-Side API</a></li>
    <li><a href="../../../java/http/client-side/connection-level.html" class="page">Connection-Level Client-Side API</a></li>
    <li><a href="../../../java/http/client-side/pool-overflow.html" class="page">Pool overflow and the max-open-requests setting</a></li>
    <li><a href="../../../java/http/client-side/client-https-support.html#client-side-https-support" class="active page">Client-Side HTTPS Support</a>
    <ul>
      <li><a href="../../../java/http/client-side/client-https-support.html#ssl-config" class="header">SSL-Config</a></li>
      <li><a href="../../../java/http/client-side/client-https-support.html#detailed-configuration-and-workarounds" class="header">Detailed configuration and workarounds</a></li>
    </ul></li>
    <li><a href="../../../java/http/client-side/client-transport.html" class="page">Pluggable Client Transports / HTTPS Proxy Support</a></li>
    <li><a href="../../../java/http/client-side/websocket-support.html" class="page">Client-Side WebSocket Support</a></li>
  </ul></li>
  <li><a href="../../../java/http/server-side-https-support.html" class="page">Server-Side HTTPS Support</a></li>
  <li><a href="../../../java/http/migration-guide/index.html" class="page">Migration Guides</a></li>
  <li><a href="../../../java/http/release-notes.html" class="page">Release Notes</a></li>
</ul>
</div>
</nav>
<footer class="nav-footer fixed-sidebar-footer">
<a href="https://akka.io"><img class="logo" src="../../../images/akka-logo-reverse.svg"></a>

</footer>
</aside>

<main class="fixed-shift-for-large expanded row">
<section class="site-content small-12 column">

<article class="page-content row">
<div class="small-12 large-9 column" id="docs">
<a id="clientsidehttps-java"></a>
<h1><a href="#client-side-https-support" name="client-side-https-support" class="anchor"><span class="anchor-link"></span></a>Client-Side HTTPS Support</h1>
<p>Akka HTTP supports TLS encryption on the client-side as well as on the <a href="../server-side-https-support.html#serversidehttps-java">server-side</a>.</p>
<p>The central vehicle for configuring encryption is the <code>HttpsConnectionContext</code>, which can be created using the static method <code>ConnectionContext.https</code> which is defined like this:</p>
<pre class="prettyprint"><code class="language-scala">// ConnectionContext
/** Used to serve HTTPS traffic. */
def https(sslContext: SSLContext): HttpsConnectionContext =
  scaladsl.ConnectionContext.https(sslContext)

/** Used to serve HTTPS traffic. */
def https(
  sslContext:          SSLContext,
  sslConfig:           Optional[AkkaSSLConfig],
  enabledCipherSuites: Optional[JCollection[String]],
  enabledProtocols:    Optional[JCollection[String]],
  clientAuth:          Optional[TLSClientAuth],
  sslParameters:       Optional[SSLParameters]) =
  scaladsl.ConnectionContext.https(
    sslContext,
    OptionConverters.toScala(sslConfig),
    OptionConverters.toScala(enabledCipherSuites).map(Util.immutableSeq(_)),
    OptionConverters.toScala(enabledProtocols).map(Util.immutableSeq(_)),
    OptionConverters.toScala(clientAuth),
    OptionConverters.toScala(sslParameters))</code></pre>
<p>In addition to the <code>outgoingConnection</code>, <code>newHostConnectionPool</code> and <code>cachedHostConnectionPool</code> methods the <a href="https://doc.akka.io/japi/akka-http/10.0.9/?akka/http/javadsl/Http.html">akka.http.javadsl.Http</a> extension also defines <code>outgoingConnectionHttps</code>, <code>newHostConnectionPoolHttps</code> and <code>cachedHostConnectionPoolHttps</code>. These methods work identically to their counterparts without the <code>-Https</code> suffix, with the exception that all connections will always be encrypted.</p>
<p>The <code>singleRequest</code> and <code>superPool</code> methods determine the encryption state via the scheme of the incoming request, i.e. requests to an &ldquo;https&rdquo; URI will be encrypted, while requests to an &ldquo;http&rdquo; URI won&rsquo;t.</p>
<p>The encryption configuration for all HTTPS connections, i.e. the <code>HttpsContext</code> is determined according to the following logic:</p>
<ol>
  <li>If the optional <code>httpsContext</code> method parameter is defined it contains the configuration to be used (and thus takes precedence over any potentially set default client-side <code>HttpsContext</code>).</li>
  <li>If the optional <code>httpsContext</code> method parameter is undefined (which is the default) the default client-side <code>HttpsContext</code> is used, which can be set via the <code>setDefaultClientHttpsContext</code> on the <code>Http</code> extension.</li>
  <li>If no default client-side <code>HttpsContext</code> has been set via the <code>setDefaultClientHttpsContext</code> on the <code>Http</code> extension the default system configuration is used.</li>
</ol>
<p>Usually the process is, if the default system TLS configuration is not good enough for your application&rsquo;s needs, that you configure a custom <code>HttpsContext</code> instance and set it via <code>Http.get(system).setDefaultClientHttpsContext</code>. Afterwards you simply use <code>outgoingConnectionHttps</code>, <code>newHostConnectionPoolHttps</code>, <code>cachedHostConnectionPoolHttps</code>, <code>superPool</code> or <code>singleRequest</code> without a specific <code>httpsContext</code> argument, which causes encrypted connections to rely on the configured default client-side <code>HttpsContext</code>.</p>
<p>If no custom <code>HttpsContext</code> is defined the default context uses Java&rsquo;s default TLS settings. Customizing the <code>HttpsContext</code> can make the Https client less secure. Understand what you are doing!</p>
<h2><a href="#ssl-config" name="ssl-config" class="anchor"><span class="anchor-link"></span></a>SSL-Config</h2>
<p>Akka HTTP heavily relies on, and delegates most configuration of any SSL/TLS related options to <a href="http://typesafehub.github.io/ssl-config/">Lightbend SSL-Config</a>, which is a library specialized in providing an secure-by-default SSLContext and related options.</p>
<p>Please refer to the <a href="http://typesafehub.github.io/ssl-config/">Lightbend SSL-Config</a> documentation for detailed documentation of all available settings.</p>
<p>SSL Config settings used by Akka HTTP (as well as Streaming TCP) are located under the <em>akka.ssl-config</em> namespace.</p>
<h2><a href="#detailed-configuration-and-workarounds" name="detailed-configuration-and-workarounds" class="anchor"><span class="anchor-link"></span></a>Detailed configuration and workarounds</h2>
<p>Akka HTTP relies on <a href="http://typesafehub.github.io/ssl-config">Typesafe SSL-Config</a> which is a library maintained by Lightbend that makes configuring things related to SSL/TLS much simpler than using the raw SSL APIs provided by the JDK. Please refer to its documentation to learn more about it.</p>
<p>All configuration options available to this library may be set under the <code>akka.ssl-config</code> configuration for Akka HTTP applications.</p><div class="callout note "><div class="callout-title">Note</div>
<p>When encountering problems connecting to HTTPS hosts we highly encourage to reading up on the excellent ssl-config configuration. Especially the quick start sections about <a href="http://typesafehub.github.io/ssl-config/WSQuickStart.html#connecting-to-a-remote-server-over-https">adding certificates to the trust store</a> should prove very useful, for example to easily trust a self-signed certificate that applications might use in development mode.</p></div><div class="callout warning "><div class="callout-title">Warning</div>
<p>While it is possible to disable certain checks using the so called &ldquo;loose&rdquo; settings in SSL Config, we <strong>strongly recommend</strong> to instead attempt to solve these issues by properly configuring TLS–for example by adding trusted keys to the keystore.</p>
<p>If however certain checks really need to be disabled because of misconfigured (or legacy) servers that your application has to speak to, instead of disabling the checks globally (i.e. in <code>application.conf</code>) we suggest configuring the loose settings for <em>specific connections</em> that are known to need them disabled (and trusted for some other reason). The pattern of doing so is documented in the following sub-sections.</p></div>
<h3><a href="#hostname-verification" name="hostname-verification" class="anchor"><span class="anchor-link"></span></a>Hostname verification</h3>
<p>Hostname verification proves that the Akka HTTP client is actually communicating with the server it intended to communicate with. Without this check a man-in-the-middle attack is possible. In the attack scenario, an alternative certificate would be presented which was issued for another host name. Checking the host name in the certificate against the host name the connection was opened against is therefore vital.</p>
<p>The default <code>HttpsContext</code> enables hostname verification. Akka HTTP relies on the <a href="http://typesafehub.github.io/ssl-config">Typesafe SSL-Config</a> library to implement this and security options for SSL/TLS. Hostname verification is provided by the JDK and used by Akka HTTP since Java 7, and on Java 6 the verification is implemented by ssl-config manually.</p>
<p>For further recommended reading we would like to highlight the <a href="https://tersesystems.com/2014/03/23/fixing-hostname-verification/">fixing hostname verification blog post</a> by blog post by Will Sargent.</p>
<h3><a href="#server-name-indication-sni-" name="server-name-indication-sni-" class="anchor"><span class="anchor-link"></span></a>Server Name Indication (SNI)</h3>
<p>SNI is an TLS extension which aims to guard against man-in-the-middle attacks. It does so by having the client send the name of the virtual domain it is expecting to talk to as part of the TLS handshake.</p>
<p>It is specified as part of <a href="https://tools.ietf.org/html/rfc6066#page-6">RFC 6066</a>.</p>
<h3><a href="#disabling-tls-security-features-at-your-own-risk" name="disabling-tls-security-features-at-your-own-risk" class="anchor"><span class="anchor-link"></span></a>Disabling TLS security features, at your own risk</h3><div class="callout warning "><div class="callout-title">Warning</div>
<p>It is highly discouraged to disable any of the security features of TLS, however do acknowledge that workarounds may sometimes be needed.</p>
<p>Before disabling any of the features one should consider if they may be solvable <em>within</em> the TLS world, for example by <a href="http://typesafehub.github.io/ssl-config/WSQuickStart.html">trusting a certificate</a>, or <a href="http://typesafehub.github.io/ssl-config/CipherSuites.html">configuring the trusted cipher suites</a>. There&rsquo;s also a very important section in the ssl-config docs titled <a href="http://typesafehub.github.io/ssl-config/LooseSSL.html#please-read-this-before-turning-anything-off">LooseSSL - Please read this before turning anything off!</a>.</p>
<p>If disabling features is indeed desired, we recommend doing so for <em>specific connections</em>, instead of globally configuring it via <code>application.conf</code>.</p></div>
<p>The following shows an example of disabling SNI for a given connection:</p>
<pre class="prettyprint"><code class="language-java">final ActorSystem system = ActorSystem.create();
final ActorMaterializer mat = ActorMaterializer.create(system);
final Http http = Http.get(system);

// WARNING: disabling SNI is a very bad idea, please don&#39;t unless you have a very good reason to.
final AkkaSSLConfig defaultSSLConfig = AkkaSSLConfig.get(system);
final AkkaSSLConfig badSslConfig = defaultSSLConfig
  .convertSettings(s -&gt; s.withLoose(s.loose().withDisableSNI(true)));
final HttpsConnectionContext badCtx = http.createClientHttpsContext(badSslConfig);

http.outgoingConnection(ConnectHttp.toHostHttps(unsafeHost).withCustomHttpsContext(badCtx));</code></pre>
<p>The <code>badSslConfig</code> is a copy of the default <code>AkkaSSLConfig</code> with with the slightly changed configuration to disable SNI. This value can be cached and used for connections which should indeed not use this feature.</p>
</div>
</article>

<div class="row">
<div class="small-12 large-9 column">
<section class="nav-prev-next row">
<div class="nav-prev small-6 column">
<a href="../../../java/http/client-side/pool-overflow.html"><i class="icon-prev"></i> <span class="link-prev">Pool overflow and the max-open-requests setting</span></a>
</div>
<div class="nav-next small-6 column clearfix">
<a class="float-right" href="../../../java/http/client-side/client-transport.html">Pluggable Client Transports / HTTPS Proxy Support <i class="icon-next"></i></a>
</div>
</section>
</div>
</div>

<div class="source-github row">
The source code for this page can be found <a href="http://github.com/akka/akka-http/tree/master/docs/src/main/paradox/java/http/client-side/client-https-support.md">here</a>.
</div>


<footer class="page-footer row clearfix">
<img class="akka-icon float-left show-for-medium" src="../../../images/akka-icon.svg">
<section class="copyright">
<div>&copy; 2011-2017 <a href="https://www.lightbend.com">Lightbend</a></div>
<div>Akka HTTP is Open Source and available under the Apache 2 License.</div>
</section>
</footer>

</section>
</main>

<script type="text/javascript" src="../../../js/scrollsneak.js"></script>
<script type="text/javascript">jQuery(document).foundation();</script>
<script type="text/javascript" src="../../../js/groups.js"></script>
<script type="text/javascript" src="../../../js/page.js"></script>
<script type="text/javascript" src="../../../js/magellan.js"></script>

<style type="text/css">@import "../../../lib/prettify/prettify.css";</style>
<script type="text/javascript" src="../../../lib/prettify/prettify.js"></script>
<script type="text/javascript" src="../../../lib/prettify/lang-scala.js"></script>
<script type="text/javascript">jQuery(function(){window.prettyPrint && prettyPrint()});</script>

<!-- Algolia docs search -->
<script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.js"></script>
<style>.algolia-autocomplete { display: block !important }</style>
<script type="text/javascript">
var version = "10.0.9";

var lang = "scala";
var path = window.location.pathname;
if (path.includes("/java/") || path.includes("java.html")) {
lang = "java";
}

docsearch({
apiKey: '0ccbb8bf5148554a406fbf07df0a93b9',
indexName: 'akka-http',
inputSelector: '#search',
algoliaOptions: {
hitsPerPage: 5,
facetFilters: ["version:" + version, "language:" + lang]
}
});

docsearch({
apiKey: '0ccbb8bf5148554a406fbf07df0a93b9',
indexName: 'akka-http',
inputSelector: '#overlay-search',
algoliaOptions: {
hitsPerPage: 5,
facetFilters: ["version:" + version, "language:" + lang]
}
});

// set up "/" as global shortcut for focusing on search
jQuery(document).keypress(function (event) {
if (event.keyCode == 47) {
jQuery("#search").focus();
return false; // swallow key event, otherwise the / char would be input into the search box
}
});
</script>


</body>
</html>
