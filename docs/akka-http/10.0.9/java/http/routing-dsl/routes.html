<!DOCTYPE html>
<html class="no-js" lang="en">

<head>
<title>Routes &bull; Akka HTTP</title>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<meta name="description" content="Akka HTTP: Modern, fast, asynchronous, streaming-first HTTP server and client."/><link rel="canonical" href="https://doc.akka.io/docs/akka-http/10.0/java/http/routing-dsl/routes.html"/>
<script type="text/javascript" src="../../../lib/jquery/jquery.min.js"></script>
<script type="text/javascript" src="../../../lib/foundation/dist/js/foundation.min.js"></script>
<link rel="stylesheet" type="text/css" href="../../../lib/normalize.css/normalize.css"/>
<link rel="stylesheet" type="text/css" href="../../../lib/foundation/dist/css/foundation.min.css"/>
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.css" />
<link rel="stylesheet" type="text/css" href="../../../css/icons.css"/>
<link rel="stylesheet" type="text/css" href="../../../css/page.css"/>
<link rel="shortcut icon" href="../../../images/favicon.ico" />
<meta name="theme-color" content="#15a9ce">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<!--Google Analytics-->
<script type="text/javascript">
var _gaq = _gaq || [];
_gaq.push(['_setAccount', 'UA-21117439-1']);
_gaq.push(['_setDomainName', 'akka.io']);
_gaq.push(['_trackPageview']);
(function() {
var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})()
</script>
<!--Google Analytics & Marketo-->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-23127719-1', 'lightbend.com', {'allowLinker': true, 'name': 'tsTracker'});
ga('tsTracker.require', 'linker');
ga('tsTracker.linker:autoLink', ['lightbend.com','playframework.com','scala-lang.org','scaladays.org','spray.io','akka.io','scala-sbt.org','scala-ide.org']);
ga('tsTracker.send', 'pageview');
(function() {
var didInit = false;
function initMunchkin() {
if(didInit === false) {
didInit = true;
Munchkin.init('558-NCX-702');
}
}
var s = document.createElement('script');
s.type = 'text/javascript';
s.async = true;
s.src = '//munchkin.marketo.net/munchkin.js';
s.onreadystatechange = function() {
if (this.readyState == 'complete' || this.readyState == 'loaded') {
initMunchkin();
}
};
s.onload = initMunchkin;
document.getElementsByTagName('head')[0].appendChild(s);
})();
</script>

</head>

<body id="underlay" data-toggler="nav-open">

<header class="site-header hide-for-large">
<div class="sticky-header clearfix">
<a href="https://akka.io"><img class="logo" src="../../../images/akka-logo-reverse.svg"></a>

<button class="menu-icon float-right" type="button" data-toggle="underlay overlay"></button>
</div>
<div id="overlay" class="overlay-nav" data-toggler="nav-open">
<header class="nav-header">
<div class="nav-header-title">
<h1><a href="../../../java/http/index.html">Akka HTTP</a></h1>
</div>
<div class="nav-header-version">
Version 10.0.9
</div>
<div class="nav-header-groups">
<select class="supergroup" name="Languages"><option class="group" value="group-scala">Scala</option><option class="group" value="group-java">Java</option></select>
</div>
<div id="overlay-search-container" class="nav-header-search">
<input id="overlay-search" type="search" class="search" placeholder="Search"/>
</div>
</header>
<nav class="nav-toc">
<ul>
  <li><a href="../../../java/http/security.html" class="page">Security Announcements</a></li>
  <li><a href="../../../java/http/introduction.html" class="page">Introduction</a></li>
  <li><a href="../../../java/http/configuration.html" class="page">Configuration</a></li>
  <li><a href="../../../java/http/common/index.html" class="page">Common Abstractions (Client- and Server-Side)</a></li>
  <li><a href="../../../java/http/implications-of-streaming-http-entity.html" class="page">Implications of the streaming nature of Request/Response Entities</a></li>
  <li><a href="../../../java/http/server-side/low-level-server-side-api.html" class="page">Low-Level Server-Side API</a></li>
  <li><a href="../../../java/http/routing-dsl/index.html" class="page">High-level Server-Side API</a>
  <ul>
    <li><a href="../../../java/http/routing-dsl/index.html#minimal-example" class="header">Minimal Example</a></li>
    <li><a href="../../../java/http/routing-dsl/index.html#handling-http-server-failures-in-the-high-level-api" class="header">Handling HTTP Server failures in the High-Level API</a></li>
    <li><a href="../../../java/http/routing-dsl/overview.html" class="page">Routing DSL Overview</a></li>
    <li><a href="../../../java/http/routing-dsl/routes.html#routes" class="active page">Routes</a>
    <ul>
      <li><a href="../../../java/http/routing-dsl/routes.html#requestcontext" class="header">RequestContext</a></li>
      <li><a href="../../../java/http/routing-dsl/routes.html#routeresult" class="header">RouteResult</a></li>
      <li><a href="../../../java/http/routing-dsl/routes.html#composing-routes" class="header">Composing Routes</a></li>
      <li><a href="../../../java/http/routing-dsl/routes.html#the-routing-tree" class="header">The Routing Tree</a></li>
      <li><a href="../../../java/http/routing-dsl/routes.html#sealing-a-route" class="header">Sealing a Route</a></li>
    </ul></li>
    <li><a href="../../../java/http/routing-dsl/directives/index.html" class="page">Directives</a></li>
    <li><a href="../../../java/http/routing-dsl/marshalling.html" class="page">Marshalling &amp; Unmarshalling</a></li>
    <li><a href="../../../java/http/routing-dsl/exception-handling.html" class="page">Exception Handling</a></li>
    <li><a href="../../../java/http/routing-dsl/source-streaming-support.html" class="page">Source Streaming</a></li>
    <li><a href="../../../java/http/routing-dsl/rejections.html" class="page">Rejections</a></li>
    <li><a href="../../../java/http/routing-dsl/testkit.html" class="page">Route Testkit</a></li>
    <li><a href="../../../java/http/routing-dsl/HttpApp.html" class="page">HttpApp Bootstrap</a></li>
  </ul></li>
  <li><a href="../../../java/http/server-side/websocket-support.html" class="page">Server-Side WebSocket Support</a></li>
  <li><a href="../../../java/http/client-side/index.html" class="page">Consuming HTTP-based Services (Client-Side)</a></li>
  <li><a href="../../../java/http/server-side-https-support.html" class="page">Server-Side HTTPS Support</a></li>
  <li><a href="../../../java/http/migration-guide/index.html" class="page">Migration Guides</a></li>
  <li><a href="../../../java/http/release-notes.html" class="page">Release Notes</a></li>
</ul>
</nav>
</div>
</header>

<aside class="show-for-large">
<header class="nav-header fixed-sidebar-header">
<div class="nav-header-title">
<h1><a href="../../../java/http/index.html">Akka HTTP</a></h1>
</div>
<div class="nav-header-version">
Version 10.0.9
</div>
<div class="nav-header-groups">
<select class="supergroup" name="Languages"><option class="group" value="group-scala">Scala</option><option class="group" value="group-java">Java</option></select>
</div>
<div class="nav-header-search">
<input id="search" type="search" class="search" placeholder="Search"/>
</div>
</header>
<nav class="site-nav fixed-sidebar-contents">
<div class="nav-toc">
<ul>
  <li><a href="../../../java/http/security.html" class="page">Security Announcements</a></li>
  <li><a href="../../../java/http/introduction.html" class="page">Introduction</a></li>
  <li><a href="../../../java/http/configuration.html" class="page">Configuration</a></li>
  <li><a href="../../../java/http/common/index.html" class="page">Common Abstractions (Client- and Server-Side)</a></li>
  <li><a href="../../../java/http/implications-of-streaming-http-entity.html" class="page">Implications of the streaming nature of Request/Response Entities</a></li>
  <li><a href="../../../java/http/server-side/low-level-server-side-api.html" class="page">Low-Level Server-Side API</a></li>
  <li><a href="../../../java/http/routing-dsl/index.html" class="page">High-level Server-Side API</a>
  <ul>
    <li><a href="../../../java/http/routing-dsl/index.html#minimal-example" class="header">Minimal Example</a></li>
    <li><a href="../../../java/http/routing-dsl/index.html#handling-http-server-failures-in-the-high-level-api" class="header">Handling HTTP Server failures in the High-Level API</a></li>
    <li><a href="../../../java/http/routing-dsl/overview.html" class="page">Routing DSL Overview</a></li>
    <li><a href="../../../java/http/routing-dsl/routes.html#routes" class="active page">Routes</a>
    <ul>
      <li><a href="../../../java/http/routing-dsl/routes.html#requestcontext" class="header">RequestContext</a></li>
      <li><a href="../../../java/http/routing-dsl/routes.html#routeresult" class="header">RouteResult</a></li>
      <li><a href="../../../java/http/routing-dsl/routes.html#composing-routes" class="header">Composing Routes</a></li>
      <li><a href="../../../java/http/routing-dsl/routes.html#the-routing-tree" class="header">The Routing Tree</a></li>
      <li><a href="../../../java/http/routing-dsl/routes.html#sealing-a-route" class="header">Sealing a Route</a></li>
    </ul></li>
    <li><a href="../../../java/http/routing-dsl/directives/index.html" class="page">Directives</a></li>
    <li><a href="../../../java/http/routing-dsl/marshalling.html" class="page">Marshalling &amp; Unmarshalling</a></li>
    <li><a href="../../../java/http/routing-dsl/exception-handling.html" class="page">Exception Handling</a></li>
    <li><a href="../../../java/http/routing-dsl/source-streaming-support.html" class="page">Source Streaming</a></li>
    <li><a href="../../../java/http/routing-dsl/rejections.html" class="page">Rejections</a></li>
    <li><a href="../../../java/http/routing-dsl/testkit.html" class="page">Route Testkit</a></li>
    <li><a href="../../../java/http/routing-dsl/HttpApp.html" class="page">HttpApp Bootstrap</a></li>
  </ul></li>
  <li><a href="../../../java/http/server-side/websocket-support.html" class="page">Server-Side WebSocket Support</a></li>
  <li><a href="../../../java/http/client-side/index.html" class="page">Consuming HTTP-based Services (Client-Side)</a></li>
  <li><a href="../../../java/http/server-side-https-support.html" class="page">Server-Side HTTPS Support</a></li>
  <li><a href="../../../java/http/migration-guide/index.html" class="page">Migration Guides</a></li>
  <li><a href="../../../java/http/release-notes.html" class="page">Release Notes</a></li>
</ul>
</div>
</nav>
<footer class="nav-footer fixed-sidebar-footer">
<a href="https://akka.io"><img class="logo" src="../../../images/akka-logo-reverse.svg"></a>

</footer>
</aside>

<main class="fixed-shift-for-large expanded row">
<section class="site-content small-12 column">

<article class="page-content row">
<div class="small-12 large-9 column" id="docs">
<a id="routes-java"></a>
<h1><a href="#routes" name="routes" class="anchor"><span class="anchor-link"></span></a>Routes</h1>
<p>The &ldquo;Route&rdquo; is the central concept of Akka HTTP&rsquo;s Routing DSL. All the structures you build with the DSL, no matter whether they consists of a single line or span several hundred lines, are functions turning a <code>RequestContext</code> into a <code>CompletionStage&lt;RouteResult&gt;</code>.</p>
<p>A <code>Route</code> itself is a function that operates on a <code>RequestContext</code> and returns a <code>RouteResult</code>. The <code>RequestContext</code> is a data structure that contains the current request and auxiliary data like the so far unmatched path of the request URI that gets passed through the route structure. It also contains the current <code>ExecutionContext</code> and <code>akka.stream.Materializer</code>, so that these don&rsquo;t have to be passed around manually.</p>
<p>Generally when a route receives a request (or rather a <code>RequestContext</code> for it) it can do one of these things:</p>
<ul>
  <li>Complete the request by returning the value of <code>requestContext.complete(...)</code></li>
  <li>Reject the request by returning the value of <code>requestContext.reject(...)</code> (see <a href="rejections.html#rejections-java">Rejections</a>)</li>
  <li>Fail the request by returning the value of <code>requestContext.fail(...)</code> or by just throwing an exception (see <a href="exception-handling.html#exception-handling-java">Exception Handling</a>)</li>
  <li>Do any kind of asynchronous processing and instantly return a <code>CompletionStage&lt;RouteResult&gt;</code> to be eventually completed later</li>
</ul>
<p>The first case is pretty clear, by calling <code>complete</code> a given response is sent to the client as reaction to the request. In the second case &ldquo;reject&rdquo; means that the route does not want to handle the request. You&rsquo;ll see further down in the section about route composition what this is good for.</p>
<p>A <code>Route</code> can be &ldquo;sealed&rdquo; using <code>Route.seal</code>, which relies on the in-scope <code>RejectionHandler</code> and <code>ExceptionHandler</code> instances to convert rejections and exceptions into appropriate HTTP responses for the client.</p>
<p>Using <code>Route.handlerFlow</code> or <code>Route.asyncHandler</code> a <code>Route</code> can be lifted into a handler <code>Flow</code> or async handler function to be used with a <code>bindAndHandleXXX</code> call from the <a href="../server-side/low-level-server-side-api.html#http-low-level-server-side-api-java">Low-Level Server-Side API</a>.</p>
<a id="request-context-java"></a>
<h2><a href="#requestcontext" name="requestcontext" class="anchor"><span class="anchor-link"></span></a>RequestContext</h2>
<p>The request context wraps an <code>HttpRequest</code> instance to enrich it with additional information that are typically required by the routing logic, like an <code>ExecutionContext</code>, <code>Materializer</code>, <code>LoggingAdapter</code> and the configured <code>RoutingSettings</code>. It also contains the <code>unmatchedPath</code>, a value that describes how much of the request URI has not yet been matched by a <a href="directives/path-directives/index.html">Path Directive</a>.</p>
<p>The <code>RequestContext</code> itself is immutable but contains several helper methods which allow for convenient creation of modified copies.</p>
<a id="route-result-java"></a>
<h2><a href="#routeresult" name="routeresult" class="anchor"><span class="anchor-link"></span></a>RouteResult</h2>
<p>The <code>RouteResult</code> is an opaque structure that represents possible results of evaluating a route. A <code>RouteResult</code> can only be created by using one of the methods of the <code>RequestContext</code>. A result can either be a response, if it was generated by one of the <code>completeX</code> methods, or a rejection that contains information about why the route could not handle the request.</p>
<h2><a href="#composing-routes" name="composing-routes" class="anchor"><span class="anchor-link"></span></a>Composing Routes</h2>
<p>Routes are composed to form the route tree in two principle ways.</p>
<p>A route can be wrapped by a &ldquo;Directive&rdquo; which adds some behavioral aspect to its wrapped &ldquo;inner route&rdquo;. In the Java DSL, a Directive is a method that returns a Route. In many cases, a Directive method will have an inner route argument that is invoked when its semantics decide to do so, e.g. when a URL path is matched. </p>
<p>Example topics for directives include: </p>
<blockquote>
  <ul>
    <li>filtering requests to decide which requests will get to the inner route</li>
    <li>transforming the request before passing it to the inner route</li>
    <li>transforming the response (or more generally the route result) received from the inner route</li>
    <li>applying side-effects around inner route processing, such as measuring the time taken to run the inner route</li>
  </ul>
</blockquote>
<p>The other way of composition is defining a list of <code>Route</code> alternatives. Alternative routes are tried one after the other until one route &ldquo;accepts&rdquo; the request and provides a response. Otherwise, a route can also &ldquo;reject&rdquo; a request, in which case further alternatives are explored. Alternatives are specified by passing a list of routes to to <code>RouteDirectives.route()</code>.</p>
<a id="the-routing-tree-java"></a>
<h2><a href="#the-routing-tree" name="the-routing-tree" class="anchor"><span class="anchor-link"></span></a>The Routing Tree</h2>
<p>Essentially, when you combine routes via nesting and alternative, you build a routing structure that forms a tree. When a request comes in it is injected into this tree at the root and flows down through all the branches in a depth-first manner until either some node completes it or it is fully rejected.</p>
<p>Consider this schematic example. In place of directiveA, directiveB, etc., you can just imagine any of the available directives, e.g. matching a particular path, header or request parameter.:</p>
<pre class="prettyprint"><code class="language-java">import static akka.http.javadsl.server.Directives.*;

Route route =
  directiveA(route(() -&gt;
    directiveB(route(() -&gt;
      directiveC(
        ... // route 1
      ),
      directiveD(
        ... // route 2
      ),
      ... // route 3
    )),
    directiveE(
      ... // route 4
    )
  ));
</code></pre>
<p>Here five directives form a routing tree.</p>
<ul>
  <li>Route 1 will only be reached if directives <code>a</code>, <code>b</code> and <code>c</code> all let the request pass through.</li>
  <li>Route 2 will run if <code>a</code> and <code>b</code> pass, <code>c</code> rejects and <code>d</code> passes.</li>
  <li>Route 3 will run if <code>a</code> and <code>b</code> pass, but <code>c</code> and <code>d</code> reject.</li>
</ul>
<p>Route 3 can therefore be seen as a &ldquo;catch-all&rdquo; route that only kicks in, if routes chained into preceding positions reject. This mechanism can make complex filtering logic quite easy to implement: simply put the most specific cases up front and the most general cases in the back.</p>
<h2><a href="#sealing-a-route" name="sealing-a-route" class="anchor"><span class="anchor-link"></span></a>Sealing a Route</h2>
<p>As described in <a href="rejections.html#rejections-java">Rejections</a> and <a href="exception-handling.html#exception-handling-java">Exception Handling</a>, there are generally two ways to handle rejections and exceptions.</p>
<ul>
  <li>Pass rejection/exception handlers to the <code>seal()</code> method of the <code>Route</code></li>
  <li>Supply handlers as arguments to <a href="directives/execution-directives/handleRejections.html#handlerejections">handleRejections</a> and <a href="directives/execution-directives/handleExceptions.html#handleexceptions">handleExceptions</a> directives</li>
</ul>
<p>In the first case your handlers will be &ldquo;sealed&rdquo;, (which means that it will receive the default handler as a fallback for all cases your handler doesn&rsquo;t handle itself) and used for all rejections/exceptions that are not handled within the route structure itself.</p>
<h3><a href="#modify-httpresponse-from-a-sealed-route" name="modify-httpresponse-from-a-sealed-route" class="anchor"><span class="anchor-link"></span></a>Modify HttpResponse from a sealed Route</h3>
<p>You can use <code>Route</code> class&rsquo;s <code>seal()</code> method to perform modification on HttpResponse from the route. For example, if you want to add a special header, but still use the default rejection handler, then you can do the following. In the below case, the special header is added to rejected responses which did not match the route, as well as successful responses which matched the route.</p>
<pre class="prettyprint"><code class="language-java">public class RouteSealExample extends AllDirectives {

  public static void main(String [] args) throws IOException {
    RouteSealExample app = new RouteSealExample();
    app.runServer();
  }

  public void runServer(){
    ActorSystem system = ActorSystem.create();
    final ActorMaterializer materializer = ActorMaterializer.create(system);

    Route sealedRoute = get(
      () -&gt; pathSingleSlash( () -&gt;
        complete(&quot;Captain on the bridge!&quot;)
      )
    ).seal(system, materializer);

    Route route = respondWithHeader(
      RawHeader.create(&quot;special-header&quot;, &quot;you always have this even in 404&quot;),
      () -&gt; sealedRoute
    );

    final Http http = Http.get(system);
    final Flow&lt;HttpRequest, HttpResponse, NotUsed&gt; routeFlow = route.flow(system, materializer);
    final CompletionStage&lt;ServerBinding&gt; binding = http.bindAndHandle(routeFlow, ConnectHttp.toHost(&quot;localhost&quot;, 8080), materializer);
  }
}</code></pre>
</div>
</article>

<div class="row">
<div class="small-12 large-9 column">
<section class="nav-prev-next row">
<div class="nav-prev small-6 column">
<a href="../../../java/http/routing-dsl/overview.html"><i class="icon-prev"></i> <span class="link-prev">Routing DSL Overview</span></a>
</div>
<div class="nav-next small-6 column clearfix">
<a class="float-right" href="../../../java/http/routing-dsl/directives/index.html">Directives <i class="icon-next"></i></a>
</div>
</section>
</div>
</div>

<div class="source-github row">
The source code for this page can be found <a href="http://github.com/akka/akka-http/tree/master/docs/src/main/paradox/java/http/routing-dsl/routes.md">here</a>.
</div>


<footer class="page-footer row clearfix">
<img class="akka-icon float-left show-for-medium" src="../../../images/akka-icon.svg">
<section class="copyright">
<div>&copy; 2011-2017 <a href="https://www.lightbend.com">Lightbend</a></div>
<div>Akka HTTP is Open Source and available under the Apache 2 License.</div>
</section>
</footer>

</section>
</main>

<script type="text/javascript" src="../../../js/scrollsneak.js"></script>
<script type="text/javascript">jQuery(document).foundation();</script>
<script type="text/javascript" src="../../../js/groups.js"></script>
<script type="text/javascript" src="../../../js/page.js"></script>
<script type="text/javascript" src="../../../js/magellan.js"></script>

<style type="text/css">@import "../../../lib/prettify/prettify.css";</style>
<script type="text/javascript" src="../../../lib/prettify/prettify.js"></script>
<script type="text/javascript" src="../../../lib/prettify/lang-scala.js"></script>
<script type="text/javascript">jQuery(function(){window.prettyPrint && prettyPrint()});</script>

<!-- Algolia docs search -->
<script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.js"></script>
<style>.algolia-autocomplete { display: block !important }</style>
<script type="text/javascript">
var version = "10.0.9";

var lang = "scala";
var path = window.location.pathname;
if (path.includes("/java/") || path.includes("java.html")) {
lang = "java";
}

docsearch({
apiKey: '0ccbb8bf5148554a406fbf07df0a93b9',
indexName: 'akka-http',
inputSelector: '#search',
algoliaOptions: {
hitsPerPage: 5,
facetFilters: ["version:" + version, "language:" + lang]
}
});

docsearch({
apiKey: '0ccbb8bf5148554a406fbf07df0a93b9',
indexName: 'akka-http',
inputSelector: '#overlay-search',
algoliaOptions: {
hitsPerPage: 5,
facetFilters: ["version:" + version, "language:" + lang]
}
});

// set up "/" as global shortcut for focusing on search
jQuery(document).keypress(function (event) {
if (event.keyCode == 47) {
jQuery("#search").focus();
return false; // swallow key event, otherwise the / char would be input into the search box
}
});
</script>


</body>
</html>
