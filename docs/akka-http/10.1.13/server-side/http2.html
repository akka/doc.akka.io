<!DOCTYPE html>
<html class="no-js" lang="en">

<head>
<title>Server-Side HTTP/2 (Preview) &bull; Akka HTTP</title>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<meta name="description" content="Akka Http: Modern, fast, asynchronous, streaming-first HTTP server and client."/>
<link rel="canonical" href="https://doc.akka.io/docs/akka-http/current/server-side/http2.html"/>
<script type="text/javascript" src="../lib/jquery/jquery.min.js"></script>
<script type="text/javascript" src="../lib/foundation/dist/js/foundation.min.js"></script>
<link rel="stylesheet" type="text/css" href="../lib/normalize.css/normalize.css"/>
<link rel="stylesheet" type="text/css" href="../lib/foundation/dist/css/foundation.min.css"/>
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.css" />
<link rel="stylesheet" type="text/css" href="../css/icons.css"/>
<link rel="stylesheet" type="text/css" href="../css/page-7.css"/>
<link rel="stylesheet" type="text/css" href="../css/banner-1.css"/>
<link rel="shortcut icon" href="../images/favicon.ico" />
<link rel="apple-touch-icon" sizes="180x180" href="../images/apple-touch-icon.png"/>
<link rel="icon" type="image/png" sizes="32x32" href="../images/favicon-32x32.png"/>
<link rel="icon" type="image/png" sizes="16x16" href="../images/favicon-16x16.png"/>
<link rel="manifest" href="../images/manifest.json"/>
<meta name="msapplication-TileImage" content="../images/mstile-150x150.png"/>
<meta name="msapplication-TileColor" content="#15a9ce"/>
<meta name="theme-color" content="#15a9ce"/>
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>
<!-- OneTrust Cookies Consent Notice (Production Standard, akka.io, en-GB) start -->
<script src="https://optanon.blob.core.windows.net/consent/159bb13d-6748-4399-806e-ac28db879785.js" type="text/javascript" charset="UTF-8"></script>
<script type="text/javascript">
function OptanonWrapper() { }
</script>
<!-- OneTrust Cookies Consent Notice (Production Standard, akka.io, en-GB) end -->
<!--Google Analytics-->
<script type="text/plain" class="optanon-category-2">
var _gaq = _gaq || [];
_gaq.push(['_setAccount', 'UA-21117439-1']);
_gaq.push(['_setDomainName', 'akka.io']);
_gaq.push(['_trackPageview']);
(function() {
var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})()
</script>
<!-- Google Tag Manager -->
<script type="text/plain" class="optanon-category-2">
(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-KBJGH35');
</script>
<!--Marketo-->
<script type="text/plain" class="optanon-category-3">
(function() {
var didInit = false;
function initMunchkin() {
if(didInit === false) {
didInit = true;
Munchkin.init('558-NCX-702', { 'asyncOnly': true, 'disableClickDelay': true });
}
}
var s = document.createElement('script');
s.type = 'text/javascript';
s.async = true;
s.src = '//munchkin.marketo.net/munchkin.js';
s.onreadystatechange = function() {
if (this.readyState == 'complete' || this.readyState == 'loaded') {
initMunchkin();
}
};
s.onload = initMunchkin;
document.getElementsByTagName('head')[0].appendChild(s);
})();
</script>
</head>

<body id="underlay" data-toggler="nav-open">
<div id="lightbend-banner" class="lightbend-banner akka full-width" data-category="OSS Lightbend Banner Impression" data-label="Akka Banner Impression">
<div class="wrapper">
<div class="brand">
<a class="oss-track-link-label" data-category="OSS Lightbend Banner Clicks" data-label="Lightbend Logo - Akka Banner" href="https://www.lightbend.com?r=oss-banner-akka" target="_blank">
<img class="lightbend-logo" src="../images/banner-logos/lightbend-reverse.svg" alt="Lightbend" title="Lightbend">
</a>
</div>
<div class="nav">
<a class="banner-btn oss-track-link-label" data-category="OSS Lightbend Banner Clicks" data-label="Enhance your Akka systems with Akka Platform [Button] - Akka Banner" href="https://www.lightbend.com/akka-core-of-lightbend?r=oss-banner-akka" target="_blank">
<span>Enhance your Akka systems with</span>
<img class="akka-platform-reverse-logo" src="../images/banner-logos/akka-platform-reverse.svg" alt="Akka Platform" title="Akka Platform">
</a>
<div class="drop-down">
<svg class="svg-chevon-circle-down" version="1.1" id="Chevron_circled_down" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 20 20" enable-background="new 0 0 20 20" xml:space="preserve">
<path fill="#ffffff" d="M12.505,8.698L10,11L7.494,8.698c-0.198-0.196-0.518-0.196-0.718,0c-0.197,0.196-0.197,0.515,0,0.71l2.864,2.807
c0.199,0.196,0.52,0.196,0.717,0l2.864-2.807c0.199-0.195,0.198-0.514,0-0.71C13.024,8.502,12.704,8.502,12.505,8.698z M10,0.4
c-5.302,0-9.6,4.298-9.6,9.6c0,5.303,4.298,9.6,9.6,9.6s9.6-4.297,9.6-9.6C19.6,4.698,15.302,0.4,10,0.4z M10,18.354
c-4.615,0-8.354-3.74-8.354-8.354c0-4.614,3.739-8.354,8.354-8.354c4.613,0,8.354,3.74,8.354,8.354
C18.354,14.614,14.613,18.354,10,18.354z" />
</svg>
<div class="drop-down-content">
<div class="lightbend-family">
<a href="https://cloudflow.io" class="cloudflow oss-track-link-label" data-category="OSS Lightbend Banner Clicks" data-label="Cloudflow - Logo Tag Line - Akka Banner">
<img class="cloudflow-full-color-logo" src="../images/banner-logos/cloudflow-full-color.svg" alt="Cloudflow by Lightbend" title="Cloudflow by Lightbend">
</a>
<a href="https://cloudstate.io" class="cloudstate oss-track-link-label" data-category="OSS Lightbend Banner Clicks" data-label="Cloudstate - Logo Tag Line - Akka Banner">
<img class="cloudstate-full-color-logo" src="../images/banner-logos/cloudstate-full-color.svg" alt="Cloudstate by Lightbend" title="Cloudstate by Lightbend">
</a>
<a href="https://www.lagomframework.com" class="lagom oss-track-link-label" data-category="OSS Lightbend Banner Clicks" data-label="Lagom - Logo Tag Line - Akka Banner">
<img class="lagom-full-color-logo" src="../images/banner-logos/lagom-full-color.svg" alt="Lagom Framework by Lightbend" title="Lagom Framework by Lightbend">
</a>
<a href="https://www.playframework.com" class="play oss-track-link-label" data-category="OSS Lightbend Banner Clicks" data-label="Play - Logo Tag Line - Akka Banner">
<img class="play-full-color-logo" src="../images/banner-logos/play-full-color.svg" alt="Play Framework by Lightbend" title="Play Framework by Lightbend">
</a>
<a href="https://www.scala-lang.org" class="scala oss-track-link-label" data-category="OSS Lightbend Banner Clicks" data-label="Scala - Logo Tag Line - Akka Banner">
<img class="scala-full-color-logo" src="../images/banner-logos/scala-full-color.svg" alt="Scala by Lightbend" title="Scala by Lightbend">
</a>
<div class="akka current">
<img class="akka-full-color-logo" src="../images/banner-logos/akka-full-color.svg" alt="Akka by Lightbend" title="Akka by Lightbend">
<span>From the creators of <strong>Akka</strong>, get technology enhancements, monitoring, and expert support with Akka Platform from Lightbend.</span>
<a class="oss-track-link-label" data-category="OSS Lightbend Banner Clicks" data-label="Learn More [Button] - Akka Banner" href="https://www.lightbend.com/akka-core-of-lightbend?r=oss-banner-akka" target="_blank">Learn More</a>
</div>
</div>
<div class="title">The Lightbend Family</div>
</div>      
</div>
</div>
</div>
</div>
<header class="site-header hide-for-large">
<div class="sticky-header clearfix">
<a href="https://akka.io"><img class="logo" src="../images/akka-logo-reverse.svg"/></a>

<button class="menu-icon float-right" type="button" data-toggle="underlay overlay"></button>
</div>
<div id="overlay" class="overlay-nav" data-toggler="nav-open">
<header class="nav-header">
<div class="nav-header-title">
<h1><a href="../index.html">Akka HTTP</a></h1>
</div>
<div class="nav-header-version">
Version 10.1.13
</div>
<div class="nav-header-groups">
<select class="supergroup" name="Language"><option class="group" value="group-scala">Scala</option><option class="group" value="group-java">Java</option></select>
</div>
<div id="overlay-search-container" class="nav-header-search">
<input id="overlay-search" type="search" class="search" placeholder="Search" />
</div>
</header>
<nav class="nav-toc">
<ul>
  <li><a href="../security.html" class="page">! Security Announcements !</a></li>
  <li><a href="../release-notes/index.html" class="page">0. Release Notes</a></li>
  <li><a href="../introduction.html" class="page">1. Introduction</a></li>
  <li><a href="../usage.html" class="page">2. Usage</a></li>
  <li><a href="../common/index.html" class="page">3. Data Types &amp; Abstractions</a></li>
  <li><a href="../server-side/index.html" class="page">4. Server API</a>
  <ul>
    <li><a href="../server-side/low-level-api.html" class="page">Core Server API</a></li>
    <li><a href="../routing-dsl/index.html" class="page">Routing DSL</a></li>
    <li><a href="../server-side/websocket-support.html" class="page">Server WebSocket Support</a></li>
    <li><a href="../server-side/server-https-support.html" class="page">Server HTTPS Support</a></li>
    <li><a href="../server-side/graceful-termination.html" class="page">Graceful termination</a></li>
    <li><a href="../server-side/http2.html#server-side-http-2-preview-" class="active page">Server-Side HTTP/2 (Preview)</a>
    <ul>
      <li><a href="../server-side/http2.html#dependency" class="header">Dependency</a></li>
      <li><a href="../server-side/http2.html#enable-http-2-support" class="header">Enable HTTP/2 support</a></li>
      <li><a href="../server-side/http2.html#use-bindandhandleasync-and-https" class="header">Use <code>bindAndHandleAsync</code> and HTTPS</a></li>
      <li><a href="../server-side/http2.html#testing-with-curl" class="header">Testing with cURL</a></li>
      <li><a href="../server-side/http2.html#application-layer-protocol-negotiation-alpn-" class="header">Application-Layer Protocol Negotiation (ALPN)</a></li>
    </ul></li>
  </ul></li>
  <li><a href="../client-side/index.html" class="page">5. Client API</a></li>
  <li><a href="../extensions.html" class="page">6. Extensions</a></li>
  <li><a href="../technologies.html" class="page">7. Supported Technologies</a></li>
  <li><a href="../tipsandtricks.html" class="page">8. Tips And Tricks</a></li>
  <li><a href="../contributing.html" class="page">9. Contributing</a></li>
  <li><a href="../reference.html" class="page">10. Reference</a></li>
</ul>
</nav>
</div>
</header>
<div class="site-content-wrapper">
<aside class="sticky-sidebar show-for-large">
<header class="nav-header sticky-sidebar-header">
<div class="nav-header-title">
<h1><a href="../index.html">Akka HTTP</a></h1>
</div>
<div class="nav-header-version">
Version 10.1.13
</div>
<div class="nav-header-groups">
<select class="supergroup" name="Language"><option class="group" value="group-scala">Scala</option><option class="group" value="group-java">Java</option></select>
</div>
<div class="nav-header-search">
<input id="search" type="search" class="search" placeholder="Search" />
</div>
</header>
<nav class="site-nav sticky-sidebar-contents">
<div class="nav-toc">
<ul>
  <li><a href="../security.html" class="page">! Security Announcements !</a></li>
  <li><a href="../release-notes/index.html" class="page">0. Release Notes</a></li>
  <li><a href="../introduction.html" class="page">1. Introduction</a></li>
  <li><a href="../usage.html" class="page">2. Usage</a></li>
  <li><a href="../common/index.html" class="page">3. Data Types &amp; Abstractions</a></li>
  <li><a href="../server-side/index.html" class="page">4. Server API</a>
  <ul>
    <li><a href="../server-side/low-level-api.html" class="page">Core Server API</a></li>
    <li><a href="../routing-dsl/index.html" class="page">Routing DSL</a></li>
    <li><a href="../server-side/websocket-support.html" class="page">Server WebSocket Support</a></li>
    <li><a href="../server-side/server-https-support.html" class="page">Server HTTPS Support</a></li>
    <li><a href="../server-side/graceful-termination.html" class="page">Graceful termination</a></li>
    <li><a href="../server-side/http2.html#server-side-http-2-preview-" class="active page">Server-Side HTTP/2 (Preview)</a>
    <ul>
      <li><a href="../server-side/http2.html#dependency" class="header">Dependency</a></li>
      <li><a href="../server-side/http2.html#enable-http-2-support" class="header">Enable HTTP/2 support</a></li>
      <li><a href="../server-side/http2.html#use-bindandhandleasync-and-https" class="header">Use <code>bindAndHandleAsync</code> and HTTPS</a></li>
      <li><a href="../server-side/http2.html#testing-with-curl" class="header">Testing with cURL</a></li>
      <li><a href="../server-side/http2.html#application-layer-protocol-negotiation-alpn-" class="header">Application-Layer Protocol Negotiation (ALPN)</a></li>
    </ul></li>
  </ul></li>
  <li><a href="../client-side/index.html" class="page">5. Client API</a></li>
  <li><a href="../extensions.html" class="page">6. Extensions</a></li>
  <li><a href="../technologies.html" class="page">7. Supported Technologies</a></li>
  <li><a href="../tipsandtricks.html" class="page">8. Tips And Tricks</a></li>
  <li><a href="../contributing.html" class="page">9. Contributing</a></li>
  <li><a href="../reference.html" class="page">10. Reference</a></li>
</ul>
</div>
</nav>
<footer class="nav-footer sticky-sidebar-footer">
<a href="https://akka.io"><img class="logo" src="../images/akka-logo-reverse.svg"/></a>

</footer>
</aside>
<main class="fixed-shift-for-large expanded row">
<section class="site-content small-12 column">
<article class="page-content row">
<div class="small-12 column" id="docs">
<h1><a href="#server-side-http-2-preview-" name="server-side-http-2-preview-" class="anchor"><span class="anchor-link"></span></a>Server-Side HTTP/2 (Preview)</h1><div class="callout warning "><div class="callout-title">Warning</div>
<p>Server-Side HTTP/2 support in akka-http is currently available as a preview. This means it is ready to be evaluated, but the APIs and behavior are likely to change.</p></div>
<h2><a href="#dependency" name="dependency" class="anchor"><span class="anchor-link"></span></a>Dependency</h2>
<p>To use Akka HTTP2 Support, add the module to your project:</p><dl class="dependency"><dt>sbt</dt><dd><pre class="prettyprint"><code class="language-scala">libraryDependencies += "com.typesafe.akka" %% "akka-http2-support" % "10.1.13"</code></pre></dd><dt>Gradle</dt><dd><pre class="prettyprint"><code class="language-gradle">dependencies {
  compile group: 'com.typesafe.akka', name: 'akka-http2-support_2.12', version: '10.1.13'
}</code></pre></dd><dt>Maven</dt><dd><pre class="prettyprint"><code class="language-xml">&lt;dependency&gt;
  &lt;groupId&gt;com.typesafe.akka&lt;/groupId&gt;
  &lt;artifactId&gt;akka-http2-support_2.12&lt;/artifactId&gt;
  &lt;version&gt;10.1.13&lt;/version&gt;
&lt;/dependency&gt;</code></pre></dd></dl>
<h2><a href="#enable-http-2-support" name="enable-http-2-support" class="anchor"><span class="anchor-link"></span></a>Enable HTTP/2 support</h2>
<p>HTTP/2 can then be enabled through configuration:</p>
<pre><code>akka.http.server.preview.enable-http2 = on
</code></pre>
<h2><a href="#use-bindandhandleasync-and-https" name="use-bindandhandleasync-and-https" class="anchor"><span class="anchor-link"></span></a>Use <code>bindAndHandleAsync</code> and HTTPS</h2>
<p>HTTP/2 is primarily used over a secure connection (known as &ldquo;over HTTPS&rdquo; or &ldquo;with TLS&rdquo;), which also takes care of protocol negotiation and falling back to plain HTTPS when the client does not support HTTP/2. See the <a href="server-https-support.html">HTTPS section</a> for how to set up HTTPS.</p>
<p>You can use <span class="group-scala"><a href="https://doc.akka.io/api/akka-http/10.1.13/akka/http/scaladsl/HttpExt.html" title="akka.http.scaladsl.HttpExt"><code>Http().bindAndHandleAsync</code></a></span><span class="group-java"><a href="https://doc.akka.io/japi/akka-http/10.1.13/?akka/http/javadsl/HttpExt.html" title="akka.http.javadsl.HttpExt"><code>Http().get(system).bindAndHandleAsync()</code></a></span> as long as you followed the above steps:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/akka-http/tree/v10.1.13/docs/src/test/scala/docs/http/scaladsl/Http2Spec.scala#L12-L43" target="_blank" title="Go to snippet source"></a><code class="language-scala">import scala.concurrent.Future

import akka.http.scaladsl.HttpsConnectionContext
import akka.http.scaladsl.Http

Http().bindAndHandleAsync(
  asyncHandler,
  interface = &quot;localhost&quot;,
  port = 8443,
  httpsServerContext)</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/akka-http/tree/v10.1.13/docs/src/test/java/docs/http/javadsl/Http2Test.java#L19-L41" target="_blank" title="Go to snippet source"></a><code class="language-java">import akka.http.javadsl.Http;
import static akka.http.javadsl.ConnectHttp.toHostHttps;

Http.get(system)
  .bindAndHandleAsync(
    asyncHandler,
    toHostHttps(&quot;127.0.0.1&quot;, 8443).withCustomHttpsContext(httpsConnectionContext),
    materializer);</code></pre></dd>
</dl>
<p>Note that <code>bindAndHandle</code> currently does not support HTTP/2, you must use <code>bindAndHandleAsync</code>.</p>
<h3><a href="#http-2-without-https" name="http-2-without-https" class="anchor"><span class="anchor-link"></span></a>HTTP/2 without HTTPS</h3>
<p>While un-encrypted connections are allowed by HTTP/2, this is <a href="https://http2.github.io/faq/#does-http2-require-encryption">sometimes discouraged</a>.</p>
<p>There are 2 ways to implement un-encrypted HTTP/2 connections: by using the <a href="http://httpwg.org/specs/rfc7540.html#discover-http">HTTP Upgrade mechanism</a> or by starting communication in HTTP/2 directly which requires the client to have <a href="https://httpwg.org/specs/rfc7540.html#known-http">Prior Knowledge</a> of HTTP/2 support.</p>
<p>We support both approaches transparently on the same port. This feature is automatically enabled when HTTP/2 is enabled:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/akka-http/tree/v10.1.13/docs/src/test/scala/docs/http/scaladsl/Http2Spec.scala#L19-L51" target="_blank" title="Go to snippet source"></a><code class="language-scala">import akka.http.scaladsl.Http
import akka.http.scaladsl.HttpConnectionContext

Http().bindAndHandleAsync(
  asyncHandler,
  interface = &quot;localhost&quot;,
  port = 8080,
  connectionContext = HttpConnectionContext())</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/akka-http/tree/v10.1.13/docs/src/test/java/docs/http/javadsl/Http2Test.java#L25-L49" target="_blank" title="Go to snippet source"></a><code class="language-java">import static akka.http.javadsl.ConnectHttp.toHost;

Http.get(system)
  .bindAndHandleAsync(
    asyncHandler,
    toHost(&quot;127.0.0.1&quot;, 8080),
    materializer);</code></pre></dd>
</dl>
<h4><a href="#h2c-upgrade" name="h2c-upgrade" class="anchor"><span class="anchor-link"></span></a>h2c Upgrade</h4>
<p>The advantage of switching from HTTP/1.1 to HTTP/2 using the <a href="http://httpwg.org/specs/rfc7540.html#discover-http">HTTP Upgrade mechanism</a> is that both HTTP/1.1 and HTTP/2 clients can connect to the server on the same port, without being aware beforehand which protocol the server supports.</p>
<p>The disadvantage is that relatively few clients support switching to HTTP/2 in this way. Additionally, HTTP/2 communication cannot start until the first request has been completely sent. This means if your first request may be large, it might be worth it to start with an empty OPTIONS request to switch to HTTP/2 before sending your first &lsquo;real&rsquo; request, at the cost of a roundtrip.</p>
<h4><a href="#h2c-with-prior-knowledge" name="h2c-with-prior-knowledge" class="anchor"><span class="anchor-link"></span></a>h2c with prior knowledge</h4>
<p>The other option is to connect and start communicating in HTTP/2 immediately. The downside of this approach is the client must know beforehand that the server supports HTTP/2. For the reason this approach is known as h2c with Prior Knowledge](<a href="http://httpwg.org/specs/rfc7540.html#known-http">http://httpwg.org/specs/rfc7540.html#known-http</a>) of HTTP/2 support.</p>
<h2><a href="#testing-with-curl" name="testing-with-curl" class="anchor"><span class="anchor-link"></span></a>Testing with cURL</h2>
<p>At this point you should be able to connect, but HTTP/2 may still not be available.</p>
<p>You&rsquo;ll need a recent version of <a href="https://curl.haxx.se/">cURL</a> compiled with HTTP/2 support (for OSX see <a href="https://simonecarletti.com/blog/2016/01/http2-curl-macosx/">this article</a>). You can check whether your version supports HTTP2 with <code>curl --version</code>, look for the nghttp2 extension and the HTTP2 feature:</p>
<pre><code>curl 7.52.1 (x86_64-pc-linux-gnu) libcurl/7.52.1 OpenSSL/1.0.2l zlib/1.2.8 libidn2/0.16 libpsl/0.17.0 (+libidn2/0.16) libssh2/1.8.0 nghttp2/1.23.1 librtmp/2.3
Protocols: dict file ftp ftps gopher http https imap imaps ldap ldaps pop3 pop3s rtmp rtsp scp sftp smb smbs smtp smtps telnet tftp
Features: AsynchDNS IDN IPv6 Largefile GSS-API Kerberos SPNEGO NTLM NTLM_WB SSL libz TLS-SRP HTTP2 UnixSockets HTTPS-proxy PSL
</code></pre>
<p>When you connect to your service you may now see something like:</p>
<pre><code>$ curl -k -v https://localhost:8443
(...)
* ALPN, offering h2
* ALPN, offering http/1.1
(...)
* ALPN, server accepted to use h2
(...)
&gt; GET / HTTP/1.1
(...)
&lt; HTTP/2 200
(...)
</code></pre>
<p>If your curl output looks like above, you have successfully configured HTTP/2. However, on JDKs up to version 9, it is likely to look like this instead:</p>
<pre><code>$ curl -k -v https://localhost:8443
(...)
* ALPN, offering h2
* ALPN, offering http/1.1
(...)
* ALPN, server did not agree to a protocol
(...)
&gt; GET / HTTP/1.1
(...)
&lt; HTTP/1.1 200 OK
(...)
</code></pre>
<p>This shows <code>curl</code> declaring it is ready to speak <code>h2</code> (the shorthand name of HTTP/2), but could not determine whether the server is ready to, so it fell back to HTTP/1.1. To make this negotiation work you&rsquo;ll have to configure ALPN as described below.</p>
<h2><a href="#application-layer-protocol-negotiation-alpn-" name="application-layer-protocol-negotiation-alpn-" class="anchor"><span class="anchor-link"></span></a>Application-Layer Protocol Negotiation (ALPN)</h2>
<p><a href="https://en.wikipedia.org/wiki/Application-Layer_Protocol_Negotiation">Application-Layer Protocol Negotiation (ALPN)</a> is used to negotiate whether both client and server support HTTP/2.</p>
<p>ALPN support comes with the JVM starting from version 9 and in version 8 from update 252. If you&rsquo;re on a previous version of the JVM, you&rsquo;ll have to load a Java Agent to provide this functionality. We recommend to use a JVM &gt;= 8u252. If you need to run from an older JVM, you need to use the agent from the <a href="https://www.eclipse.org/jetty/">Jetty</a> project, <code>jetty-alpn-agent</code>, &gt;= 2.0.10.</p>
<h3><a href="#manually" name="manually" class="anchor"><span class="anchor-link"></span></a>manually</h3>
<p>This agent can be loaded with the <code>-javaagent</code> JVM option:</p>
<pre><code>  java -javaagent:/path/to/jetty-alpn-agent-2.0.10.jar -jar app.jar
</code></pre>
<h3><a href="#sbt" name="sbt" class="anchor"><span class="anchor-link"></span></a>sbt</h3>
<p>sbt can be configured to load the agent with the <a href="https://github.com/sbt/sbt-javaagent">sbt-javaagent plugin</a>:</p>
<pre><code>  .enablePlugins(JavaAgent)
  .settings(
    javaAgents += &quot;org.mortbay.jetty.alpn&quot; % &quot;jetty-alpn-agent&quot; % &quot;2.0.10&quot; % &quot;runtime&quot;
  )
</code></pre>
<p>This should automatically load the agent when running, testing, or even in distributions made with <a href="https://github.com/sbt/sbt-native-packager">sbt-native-package</a>.</p><div class="group-java">
<h3><a href="#maven" name="maven" class="anchor"><span class="anchor-link"></span></a>maven</h3>
<p>To configure maven to load the agent when running <code>mvn exec:exec</code>, add it as a &lsquo;runtime&rsquo; dependency:</p>
<pre><code>&lt;dependency&gt;
    &lt;groupId&gt;org.mortbay.jetty.alpn&lt;/groupId&gt;
    &lt;artifactId&gt;jetty-alpn-agent&lt;/artifactId&gt;
    &lt;version&gt;2.0.10&lt;/version&gt;
    &lt;scope&gt;runtime&lt;/scope&gt;
&lt;/dependency&gt;
</code></pre>
<p>and use the <code>maven-dependency-plugin</code>:</p>
<pre><code>&lt;plugin&gt;
    &lt;artifactId&gt;maven-dependency-plugin&lt;/artifactId&gt;
    &lt;version&gt;2.5.1&lt;/version&gt;
    &lt;executions&gt;
        &lt;execution&gt;
            &lt;id&gt;getClasspathFilenames&lt;/id&gt;
            &lt;goals&gt;
                &lt;goal&gt;properties&lt;/goal&gt;
            &lt;/goals&gt;
        &lt;/execution&gt;
     &lt;/executions&gt;
&lt;/plugin&gt;
</code></pre>
<p>to add it to the <code>exec-maven-plugin</code> arguments:</p>
<pre><code>&lt;plugin&gt;
    &lt;groupId&gt;org.codehaus.mojo&lt;/groupId&gt;
    &lt;artifactId&gt;exec-maven-plugin&lt;/artifactId&gt;
    &lt;version&gt;1.6.0&lt;/version&gt;
    &lt;configuration&gt;
        &lt;executable&gt;java&lt;/executable&gt;
        &lt;arguments&gt;
            &lt;argument&gt;-javaagent:${org.mortbay.jetty.alpn:jetty-alpn-agent:jar}&lt;/argument&gt;
            &lt;argument&gt;-classpath&lt;/argument&gt;
            &lt;classpath /&gt;
            &lt;argument&gt;com.example.HttpServer&lt;/argument&gt;
        &lt;/arguments&gt;
    &lt;/configuration&gt;
&lt;/plugin&gt;
</code></pre></div>
</div>
</article>
<div class="row">
<div class="small-12 column">
<section class="nav-prev-next row">
<div class="nav-prev small-6 column">
<a href="../server-side/graceful-termination.html"><i class="icon-prev"></i> <span class="link-prev">Graceful termination</span></a>
</div>
<div class="nav-next small-6 column clearfix">
<a class="float-right" href="../client-side/index.html">5. Client API <i class="icon-next"></i></a>
</div>
</section>
</div>
</div>
<div class="source-github row">
Found an error in this documentation? The source code for this page can be found <a href="https://github.com/akka/akka-http/tree/v10.1.13/docs/src/main/paradox/server-side/http2.md">here</a>.
Please feel free to edit and contribute a pull request.
</div>

<footer class="page-footer row clearfix">
<img class="akka-icon float-left show-for-medium" src="../images/akka-icon.svg" />
<section class="copyright">
<div>Akka HTTP is Open Source and available under the Apache 2 License.</div>
<p class="legal">
&copy; 2011-2020 <a href="https://www.lightbend.com" target="_blank">Lightbend, Inc.</a> |
<a href="https://www.lightbend.com/legal/licenses" target="_blank">Licenses</a> |
<a href="https://www.lightbend.com/legal/terms" target="_blank">Terms</a> |
<a href="https://www.lightbend.com/legal/privacy" target="_blank">Privacy Policy</a> |
<a href="https://akka.io/cookie/" target="_blank">Cookie Listing</a> |
<a class="optanon-toggle-display">Cookie Settings</a>
</p>
</section>

</footer>
</section>
</main>
</div>

<script type="text/javascript" src="../js/scrollsneak.js"></script>
<script type="text/javascript">jQuery(document).foundation();</script>
<script type="text/javascript" src="../js/groups.js"></script>
<script type="text/javascript" src="../js/page.js"></script>
<script type="text/javascript" src="../js/magellan.js"></script>
<script type="text/javascript" src="../js/metadata-toggle.js"></script>

<style type="text/css">@import "../lib/prettify/prettify.css";</style>
<script type="text/javascript" src="../lib/prettify/prettify.js"></script>
<script type="text/javascript" src="../lib/prettify/lang-scala.js"></script>
<script type="text/javascript">//<![CDATA[
jQuery(function(){window.prettyPrint && prettyPrint()});
//]]></script>
<!-- Algolia docs search -->
<script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.js"></script>
<style>.algolia-autocomplete { display: block !important }</style>
<script type="text/javascript">
docsearch({
apiKey: '0ccbb8bf5148554a406fbf07df0a93b9',
indexName: 'akka-http',
inputSelector: '#search',
algoliaOptions: {
hitsPerPage: 5
}
});

docsearch({
apiKey: '0ccbb8bf5148554a406fbf07df0a93b9',
indexName: 'akka-http',
inputSelector: '#overlay-search',
algoliaOptions: {
hitsPerPage: 5
}
});

// set up "/" as global shortcut for focusing on search
jQuery(document).keypress(function (event) {
if (event.keyCode == 47) {
jQuery("#search").focus();
return false; // swallow key event, otherwise the / char would be input into the search box
}
});
</script>

<script type="text/javascript" src="../assets/js/warnOldDocs.js"></script>


</body>
</html>
