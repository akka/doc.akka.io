<!DOCTYPE html>
<html class="no-js" lang="en">

<head>
<title>Exception Handling &bull; Akka HTTP</title>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<meta name="description" content="Akka HTTP: Modern, fast, asynchronous, streaming-first HTTP server and client."/><link rel="canonical" href="https://doc.akka.io/docs/akka-http/10.0/java/http/routing-dsl/exception-handling.html"/>
<script type="text/javascript" src="../../../lib/jquery/jquery.min.js"></script>
<script type="text/javascript" src="../../../lib/foundation/dist/js/foundation.min.js"></script>
<link rel="stylesheet" type="text/css" href="../../../lib/normalize.css/normalize.css"/>
<link rel="stylesheet" type="text/css" href="../../../lib/foundation/dist/css/foundation.min.css"/>
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.css" />
<link rel="stylesheet" type="text/css" href="../../../css/icons.css"/>
<link rel="stylesheet" type="text/css" href="../../../css/page.css"/>
<link rel="shortcut icon" href="../../../images/favicon.ico" />
<meta name="theme-color" content="#15a9ce">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<!--Google Analytics-->
<script type="text/javascript">
var _gaq = _gaq || [];
_gaq.push(['_setAccount', 'UA-21117439-1']);
_gaq.push(['_setDomainName', 'akka.io']);
_gaq.push(['_trackPageview']);
(function() {
var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})()
</script>
<!--Google Analytics & Marketo-->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-23127719-1', 'lightbend.com', {'allowLinker': true, 'name': 'tsTracker'});
ga('tsTracker.require', 'linker');
ga('tsTracker.linker:autoLink', ['lightbend.com','playframework.com','scala-lang.org','scaladays.org','spray.io','akka.io','scala-sbt.org','scala-ide.org']);
ga('tsTracker.send', 'pageview');
(function() {
var didInit = false;
function initMunchkin() {
if(didInit === false) {
didInit = true;
Munchkin.init('558-NCX-702');
}
}
var s = document.createElement('script');
s.type = 'text/javascript';
s.async = true;
s.src = '//munchkin.marketo.net/munchkin.js';
s.onreadystatechange = function() {
if (this.readyState == 'complete' || this.readyState == 'loaded') {
initMunchkin();
}
};
s.onload = initMunchkin;
document.getElementsByTagName('head')[0].appendChild(s);
})();
</script>

</head>

<body id="underlay" data-toggler="nav-open">

<header class="site-header hide-for-large">
<div class="sticky-header clearfix">
<a href="https://akka.io"><img class="logo" src="../../../images/akka-logo-reverse.svg"></a>

<button class="menu-icon float-right" type="button" data-toggle="underlay overlay"></button>
</div>
<div id="overlay" class="overlay-nav" data-toggler="nav-open">
<header class="nav-header">
<div class="nav-header-title">
<h1><a href="../../../java/http/index.html">Akka HTTP</a></h1>
</div>
<div class="nav-header-version">
Version 10.0.8
</div>
<div class="nav-header-groups">
<select class="supergroup" name="Languages"><option class="group" value="group-scala">Scala</option><option class="group" value="group-java">Java</option></select>
</div>
<div id="overlay-search-container" class="nav-header-search">
<input id="overlay-search" type="search" class="search" placeholder="Search"/>
</div>
</header>
<nav class="nav-toc">
<ul>
  <li><a href="../../../java/http/security.html" class="page">Security Announcements</a></li>
  <li><a href="../../../java/http/introduction.html" class="page">Introduction</a></li>
  <li><a href="../../../java/http/configuration.html" class="page">Configuration</a></li>
  <li><a href="../../../java/http/common/index.html" class="page">Common Abstractions (Client- and Server-Side)</a></li>
  <li><a href="../../../java/http/implications-of-streaming-http-entity.html" class="page">Implications of the streaming nature of Request/Response Entities</a></li>
  <li><a href="../../../java/http/server-side/low-level-server-side-api.html" class="page">Low-Level Server-Side API</a></li>
  <li><a href="../../../java/http/routing-dsl/index.html" class="page">High-level Server-Side API</a>
  <ul>
    <li><a href="../../../java/http/routing-dsl/index.html#minimal-example" class="header">Minimal Example</a></li>
    <li><a href="../../../java/http/routing-dsl/index.html#handling-http-server-failures-in-the-high-level-api" class="header">Handling HTTP Server failures in the High-Level API</a></li>
    <li><a href="../../../java/http/routing-dsl/overview.html" class="page">Routing DSL Overview</a></li>
    <li><a href="../../../java/http/routing-dsl/routes.html" class="page">Routes</a></li>
    <li><a href="../../../java/http/routing-dsl/directives/index.html" class="page">Directives</a></li>
    <li><a href="../../../java/http/routing-dsl/marshalling.html" class="page">Marshalling &amp; Unmarshalling</a></li>
    <li><a href="../../../java/http/routing-dsl/exception-handling.html#exception-handling" class="active page">Exception Handling</a>
    <ul>
      <li><a href="../../../java/http/routing-dsl/exception-handling.html#default-exception-handler" class="header">Default Exception Handler</a></li>
    </ul></li>
    <li><a href="../../../java/http/routing-dsl/source-streaming-support.html" class="page">Source Streaming</a></li>
    <li><a href="../../../java/http/routing-dsl/rejections.html" class="page">Rejections</a></li>
    <li><a href="../../../java/http/routing-dsl/testkit.html" class="page">Route Testkit</a></li>
    <li><a href="../../../java/http/routing-dsl/HttpApp.html" class="page">HttpApp Bootstrap</a></li>
  </ul></li>
  <li><a href="../../../java/http/server-side/websocket-support.html" class="page">Server-Side WebSocket Support</a></li>
  <li><a href="../../../java/http/client-side/index.html" class="page">Consuming HTTP-based Services (Client-Side)</a></li>
  <li><a href="../../../java/http/server-side-https-support.html" class="page">Server-Side HTTPS Support</a></li>
  <li><a href="../../../java/http/migration-guide/index.html" class="page">Migration Guides</a></li>
  <li><a href="../../../java/http/release-notes.html" class="page">Release Notes</a></li>
</ul>
</nav>
</div>
</header>

<aside class="show-for-large">
<header class="nav-header fixed-sidebar-header">
<div class="nav-header-title">
<h1><a href="../../../java/http/index.html">Akka HTTP</a></h1>
</div>
<div class="nav-header-version">
Version 10.0.8
</div>
<div class="nav-header-groups">
<select class="supergroup" name="Languages"><option class="group" value="group-scala">Scala</option><option class="group" value="group-java">Java</option></select>
</div>
<div class="nav-header-search">
<input id="search" type="search" class="search" placeholder="Search"/>
</div>
</header>
<nav class="site-nav fixed-sidebar-contents">
<div class="nav-toc">
<ul>
  <li><a href="../../../java/http/security.html" class="page">Security Announcements</a></li>
  <li><a href="../../../java/http/introduction.html" class="page">Introduction</a></li>
  <li><a href="../../../java/http/configuration.html" class="page">Configuration</a></li>
  <li><a href="../../../java/http/common/index.html" class="page">Common Abstractions (Client- and Server-Side)</a></li>
  <li><a href="../../../java/http/implications-of-streaming-http-entity.html" class="page">Implications of the streaming nature of Request/Response Entities</a></li>
  <li><a href="../../../java/http/server-side/low-level-server-side-api.html" class="page">Low-Level Server-Side API</a></li>
  <li><a href="../../../java/http/routing-dsl/index.html" class="page">High-level Server-Side API</a>
  <ul>
    <li><a href="../../../java/http/routing-dsl/index.html#minimal-example" class="header">Minimal Example</a></li>
    <li><a href="../../../java/http/routing-dsl/index.html#handling-http-server-failures-in-the-high-level-api" class="header">Handling HTTP Server failures in the High-Level API</a></li>
    <li><a href="../../../java/http/routing-dsl/overview.html" class="page">Routing DSL Overview</a></li>
    <li><a href="../../../java/http/routing-dsl/routes.html" class="page">Routes</a></li>
    <li><a href="../../../java/http/routing-dsl/directives/index.html" class="page">Directives</a></li>
    <li><a href="../../../java/http/routing-dsl/marshalling.html" class="page">Marshalling &amp; Unmarshalling</a></li>
    <li><a href="../../../java/http/routing-dsl/exception-handling.html#exception-handling" class="active page">Exception Handling</a>
    <ul>
      <li><a href="../../../java/http/routing-dsl/exception-handling.html#default-exception-handler" class="header">Default Exception Handler</a></li>
    </ul></li>
    <li><a href="../../../java/http/routing-dsl/source-streaming-support.html" class="page">Source Streaming</a></li>
    <li><a href="../../../java/http/routing-dsl/rejections.html" class="page">Rejections</a></li>
    <li><a href="../../../java/http/routing-dsl/testkit.html" class="page">Route Testkit</a></li>
    <li><a href="../../../java/http/routing-dsl/HttpApp.html" class="page">HttpApp Bootstrap</a></li>
  </ul></li>
  <li><a href="../../../java/http/server-side/websocket-support.html" class="page">Server-Side WebSocket Support</a></li>
  <li><a href="../../../java/http/client-side/index.html" class="page">Consuming HTTP-based Services (Client-Side)</a></li>
  <li><a href="../../../java/http/server-side-https-support.html" class="page">Server-Side HTTPS Support</a></li>
  <li><a href="../../../java/http/migration-guide/index.html" class="page">Migration Guides</a></li>
  <li><a href="../../../java/http/release-notes.html" class="page">Release Notes</a></li>
</ul>
</div>
</nav>
<footer class="nav-footer fixed-sidebar-footer">
<a href="https://akka.io"><img class="logo" src="../../../images/akka-logo-reverse.svg"></a>

</footer>
</aside>

<main class="fixed-shift-for-large expanded row">
<section class="site-content small-12 column">

<article class="page-content row">
<div class="small-12 large-9 column" id="docs">
<a id="exception-handling-java"></a>
<h1><a href="#exception-handling" name="exception-handling" class="anchor"><span class="anchor-link"></span></a>Exception Handling</h1>
<p>Exceptions thrown during route execution bubble up through the route structure to the next enclosing <a href="directives/execution-directives/handleExceptions.html#handleexceptions-java">handleExceptions</a> directive or the top of your route structure.</p>
<p>Similarly to the way that <a href="rejections.html#rejections-java">Rejections</a> are handled the <a href="directives/execution-directives/handleExceptions.html#handleexceptions-java">handleExceptions</a> directive delegates the actual job of converting an exception to its argument, an <code>ExceptionHandler</code>.</p>
<p>An <code>ExceptionHandler</code> is a partial function, so it can choose which exceptions it would like to handle and which not. Unhandled exceptions will simply continue to bubble up in the route structure. At the root of the route tree any still unhandled exception will be dealt with by the top-level handler which always handles <em>all</em> exceptions.</p>
<p><code>Route.seal</code> internally wraps its argument route with the <a href="directives/execution-directives/handleExceptions.html#handleexceptions-java">handleExceptions</a> directive in order to &ldquo;catch&rdquo; and handle any exception.</p>
<p>So, if you&rsquo;d like to customize the way certain exceptions are handled you need to write a custom <code>ExceptionHandler</code>. Once you have defined your custom <code>ExceptionHandler</code> you can supply it as argument to the <a href="directives/execution-directives/handleExceptions.html#handleexceptions-java">handleExceptions</a> directive. That will apply your handler to the inner route given to that directive. </p>
<p>Here is an example for wiring up a custom handler via <a href="directives/execution-directives/handleExceptions.html#handleexceptions-java">handleExceptions</a>: <code>Route</code> class&rsquo;s <code>seal()</code> method internally wraps its argument route with the <a href="directives/execution-directives/handleExceptions.html#handleexceptions-java">handleExceptions</a> directive in order to &ldquo;catch&rdquo; and handle any exception.</p>
<p>So, if you&rsquo;d like to customize the way certain exceptions are handled you need to write a custom <code>ExceptionHandler</code>. Once you have defined your custom <code>ExceptionHandler</code> you have two options.</p>
<ol>
  <li>Pass it to the <code>seal()</code> method of the <code>Route</code> class</li>
  <li>Supply it as an argument to <a href="directives/execution-directives/handleExceptions.html#handleexceptions-java">handleExceptions</a> directive</li>
</ol>
<p>In the first case your handler will be &ldquo;sealed&rdquo; (which means that it will receive the default handler as a fallback for all cases your handler doesn&rsquo;t handle itself) and used for all exceptions that are not handled within the route structure itself.</p>
<p>The second case allows you to restrict the applicability of your handler to certain branches of your route structure.</p>
<p>Here is an example for wiring up a custom handler via <a href="directives/execution-directives/handleExceptions.html#handleexceptions-java">handleExceptions</a>:</p>
<pre class="prettyprint"><code class="language-java">public class ExceptionHandlerExample extends AllDirectives {
  public static void main(String[] args) throws IOException {
    final ActorSystem system = ActorSystem.create();
    final ActorMaterializer materializer = ActorMaterializer.create(system);
    final Http http = Http.get(system);

    final ExceptionHandlerExample app = new ExceptionHandlerExample();

    final Flow&lt;HttpRequest, HttpResponse, NotUsed&gt; routeFlow = app.createRoute().flow(system, materializer);
    final CompletionStage&lt;ServerBinding&gt; binding = http.bindAndHandle(routeFlow, ConnectHttp.toHost(&quot;localhost&quot;, 8080), materializer);
  }


  public Route createRoute() {
    final ExceptionHandler divByZeroHandler = ExceptionHandler.newBuilder()
      .match(ArithmeticException.class, x -&gt;
        complete(StatusCodes.BAD_REQUEST, &quot;You&#39;ve got your arithmetic wrong, fool!&quot;))
      .build();

    return path(PathMatchers.segment(&quot;divide&quot;).slash(integerSegment()).slash(integerSegment()), (a, b) -&gt;
      handleExceptions(divByZeroHandler, () -&gt; complete(&quot;The result is &quot; + (a / b)))
    );
  }
}</code></pre>
<h2><a href="#default-exception-handler" name="default-exception-handler" class="anchor"><span class="anchor-link"></span></a>Default Exception Handler</h2>
<p>A default <code>ExceptionHandler</code> is used if no custom instance is provided.</p>
<p>It will handle every <code>NonFatal</code> throwable, write its stack trace and complete the request with <code>InternalServerError</code> <code>(500)</code> status code.</p>
<p>The message body will contain a string obtained via <code>Throwable#getMessage</code> call on the exception caught.</p>
<p>In case <code>getMessage</code> returns <code>null</code> (which is true for e.g. <code>NullPointerException</code> instances), the class name and a remark about the message being null are included in the response body.</p>
<p>Note that <code>IllegalRequestException</code>s&rsquo; stack traces are not logged, since instances of this class normally contain enough information to provide a useful error message.</p><div class="callout note "><div class="callout-title">Note</div>
<p>Users are strongly encouraged not to rely on the <code>ExceptionHandler</code> as a means of handling &lsquo;normally exceptional&rsquo; situations.</p>
<p>Exceptions are known to have a negative performance impact for cases when the depth of the call stack is significant (stack trace construction cost) and when the handler is located far from the place of the throwable instantiation (stack unwinding costs).</p>
<p>In a typical Akka application both these conditions are frequently true, so as a rule of thumb, you should try to minimize the number of <code>Throwable</code> instances reaching the exception handler.</p>
<p>To understand the performance implications of (mis-)using exceptions, have a read at this excellent post by A. Shipil—ëv: <a href="https://shipilev.net/blog/2014/exceptional-performance">The Exceptional Performance of Lil&rsquo; Exception</a>.</p></div>
</div>
</article>

<div class="row">
<div class="small-12 large-9 column">
<section class="nav-prev-next row">
<div class="nav-prev small-6 column">
<a href="../../../java/http/routing-dsl/marshalling.html"><i class="icon-prev"></i> <span class="link-prev">Marshalling & Unmarshalling</span></a>
</div>
<div class="nav-next small-6 column clearfix">
<a class="float-right" href="../../../java/http/routing-dsl/source-streaming-support.html">Source Streaming <i class="icon-next"></i></a>
</div>
</section>
</div>
</div>

<div class="source-github row">
The source code for this page can be found <a href="http://github.com/akka/akka-http/tree/master/docs/src/main/paradox/java/http/routing-dsl/exception-handling.md">here</a>.
</div>


<footer class="page-footer row clearfix">
<img class="akka-icon float-left show-for-medium" src="../../../images/akka-icon.svg">
<section class="copyright">
<div>&copy; 2011-2017 <a href="https://www.lightbend.com">Lightbend</a></div>
<div>Akka HTTP is Open Source and available under the Apache 2 License.</div>
</section>
</footer>

</section>
</main>

<script type="text/javascript" src="../../../js/scrollsneak.js"></script>
<script type="text/javascript">jQuery(document).foundation();</script>
<script type="text/javascript" src="../../../js/groups.js"></script>
<script type="text/javascript" src="../../../js/page.js"></script>
<script type="text/javascript" src="../../../js/magellan.js"></script>

<style type="text/css">@import "../../../lib/prettify/prettify.css";</style>
<script type="text/javascript" src="../../../lib/prettify/prettify.js"></script>
<script type="text/javascript" src="../../../lib/prettify/lang-scala.js"></script>
<script type="text/javascript">jQuery(function(){window.prettyPrint && prettyPrint()});</script>

<!-- Algolia docs search -->
<script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.js"></script>
<style>.algolia-autocomplete { display: block !important }</style>
<script type="text/javascript">
var version = "10.0.8";

var lang = "scala";
var path = window.location.pathname;
if (path.includes("/java/") || path.includes("java.html")) {
lang = "java";
}

docsearch({
apiKey: '0ccbb8bf5148554a406fbf07df0a93b9',
indexName: 'akka-http',
inputSelector: '#search',
algoliaOptions: {
hitsPerPage: 5,
facetFilters: ["version:" + version, "language:" + lang]
}
});

docsearch({
apiKey: '0ccbb8bf5148554a406fbf07df0a93b9',
indexName: 'akka-http',
inputSelector: '#overlay-search',
algoliaOptions: {
hitsPerPage: 5,
facetFilters: ["version:" + version, "language:" + lang]
}
});

// set up "/" as global shortcut for focusing on search
jQuery(document).keypress(function (event) {
if (event.keyCode == 47) {
jQuery("#search").focus();
return false; // swallow key event, otherwise the / char would be input into the search box
}
});
</script>


</body>
</html>
