<!DOCTYPE html>
<html class="no-js" lang="en">

<head>
<title>Migration Guide to and within Akka HTTP 10.2.x &bull; Akka HTTP</title>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<meta name="description" content="Akka Http: Modern, fast, asynchronous, streaming-first HTTP server and client."/>
<link rel="canonical" href="https://doc.akka.io/docs/akka-http/current/migration-guide/migration-guide-10.2.x.html"/>
<script type="text/javascript" src="../lib/jquery/jquery.min.js"></script>
<script type="text/javascript" src="../lib/foundation/dist/js/foundation.min.js"></script>
<link rel="stylesheet" type="text/css" href="../lib/normalize.css/normalize.css"/>
<link rel="stylesheet" type="text/css" href="../lib/foundation/dist/css/foundation.min.css"/>
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.css" />
<link rel="stylesheet" type="text/css" href="../css/icons.css"/>
<link rel="stylesheet" type="text/css" href="../css/page-8.css"/>
<link rel="stylesheet" type="text/css" href="../css/banner-2.css"/>
<link rel="shortcut icon" href="../images/favicon.ico" />
<link rel="apple-touch-icon" sizes="180x180" href="../images/apple-touch-icon.png"/>
<link rel="icon" type="image/png" sizes="32x32" href="../images/favicon-32x32.png"/>
<link rel="icon" type="image/png" sizes="16x16" href="../images/favicon-16x16.png"/>
<link rel="manifest" href="../images/manifest.json"/>
<meta name="msapplication-TileImage" content="../images/mstile-150x150.png"/>
<meta name="msapplication-TileColor" content="#15a9ce"/>
<meta name="theme-color" content="#15a9ce"/>
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>
<!-- OneTrust Cookies Consent Notice (Production Standard, akka.io, en-GB) start -->
<script src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js"  type="text/javascript" charset="UTF-8" data-domain-script="28b912e7-09e9-43d5-91e4-3d1897044004" ></script>
<script type="text/javascript">
function OptanonWrapper() { }
</script>
<!-- OneTrust Cookies Consent Notice (Production Standard, akka.io, en-GB) end -->
<!--Google Analytics-->
<script type="text/plain" class="optanon-category-2">
var _gaq = _gaq || [];
_gaq.push(['_setAccount', 'UA-21117439-1']);
_gaq.push(['_setDomainName', 'akka.io']);
_gaq.push(['_trackPageview']);
(function() {
var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})()
</script>
<!-- Google Tag Manager -->
<script type="text/plain" class="optanon-category-2">
(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-KBJGH35');
</script>
<!--Marketo-->
<script type="text/plain" class="optanon-category-3">
(function() {
var didInit = false;
function initMunchkin() {
if(didInit === false) {
didInit = true;
Munchkin.init('558-NCX-702', { 'asyncOnly': true, 'disableClickDelay': true });
}
}
var s = document.createElement('script');
s.type = 'text/javascript';
s.async = true;
s.src = '//munchkin.marketo.net/munchkin.js';
s.onreadystatechange = function() {
if (this.readyState == 'complete' || this.readyState == 'loaded') {
initMunchkin();
}
};
s.onload = initMunchkin;
document.getElementsByTagName('head')[0].appendChild(s);
})();
</script>
</head>

<body id="underlay" data-toggler="nav-open">
<div id="lightbend-banner" class="lightbend-banner akka full-width" data-category="OSS Lightbend Banner Impression" data-label="Akka Banner Impression">
<div class="oss-wrapper">
<div class="oss-brand">
<a class="oss-track-link-label" data-category="OSS Lightbend Banner Clicks" data-label="Lightbend Logo - Akka Banner" href="https://www.lightbend.com">
<img class="lightbend-logo" src="../images/banner-logos/lightbend-reverse.svg" alt="Lightbend" title="Lightbend">
</a>
</div>
<div class="oss-ad no-drop-down">
<nav id="lightbendRotator" class="lightbend-rotator">
<a class="oss-track-link-label" data-category="OSS Lightbend Banner Clicks" data-label="Promo Rotator - Akka Serverless - Keep the data. Lose the database. Try now for free. [Learn More] - Akka Banner" href="https://www.lightbend.com/akka-serverless">
<strong>Akka Serverless</strong> - Keep the data. Lose the database. Try now for free. <span class="akka-btn">Learn More</span>
</a>
<a class="oss-track-link-label" data-category="OSS Lightbend Banner Clicks" data-label="Promo Rotator - Meet Akka Insights! A stand alone telemetry & observability offering. [Learn More] - Akka Banner" href="https://www.lightbend.com/akka-insights">
<strong>Meet Akka Insights!</strong>&nbsp;&nbsp;A stand alone telemetry & observability offering. <span class="akka-btn">Learn More</span>
</a>
</nav>
</div>
</div>
</div>

<header class="site-header hide-for-large">
<div class="sticky-header clearfix">
<a href="https://akka.io"><img class="logo" src="../images/akka-logo-reverse.svg"/></a>

<button class="menu-icon float-right" type="button" data-toggle="underlay overlay"></button>
</div>
<div id="overlay" class="overlay-nav" data-toggler="nav-open">
<header class="nav-header">
<div class="nav-header-title">
<h1><a href="../index.html">Akka HTTP</a></h1>
</div>
<div class="nav-header-version">
Version 10.2.9
</div>
<div class="nav-header-groups">
<select class="supergroup" name="Language"><option class="group" value="group-scala">Scala</option><option class="group" value="group-java">Java</option></select>
</div>
<div id="overlay-search-container" class="nav-header-search">
<input id="overlay-search" type="search" class="search" placeholder="Search" />
</div>
</header>
<nav class="nav-toc">
<ul>
  <li><a href="../security.html" class="page">! Security Announcements !</a></li>
  <li><a href="../release-notes/index.html" class="page">0. Release Notes</a></li>
  <li><a href="../introduction.html" class="page">1. Introduction</a></li>
  <li><a href="../usage.html" class="page">2. Usage</a>
  <ul>
    <li><a href="../configuration.html" class="page">Configuration</a></li>
    <li><a href="../migration-guide/index.html" class="page">Migration Guides</a>
    <ul>
      <li><a href="../migration-guide/migration-guide-10.2.x.html#migration-guide-to-and-within-akka-http-10-2-x" class="active page">Migration Guide to and within Akka HTTP 10.2.x</a>
      <ul>
        <li><a href="../migration-guide/migration-guide-10.2.x.html#general-notes" class="header">General Notes</a></li>
        <li><a href="../migration-guide/migration-guide-10.2.x.html#akka-http-10-1-x-10-2-0" class="header">Akka HTTP 10.1.x -&gt; 10.2.0</a></li>
      </ul></li>
      <li><a href="../migration-guide/migration-guide-10.1.x.html" class="page">Migration Guide to and within Akka HTTP 10.1.x</a></li>
      <li><a href="../migration-guide/migration-guide-10.0.x.html" class="page">Migration Guide within Akka HTTP 10.0.x</a></li>
      <li><a href="../migration-guide/migration-guide-2.4.x-10.0.x.html" class="page">Migration Guide between Akka HTTP 2.4.x and 10.0.x</a></li>
      <li><a href="../migration-guide/migration-from-spray.html" class="page">Migration Guide from Spray</a></li>
      <li><a href="../migration-guide/migration-from-old-http-javadsl.html" class="page">Migration Guide from &ldquo;old&rdquo; HTTP JavaDSL</a></li>
    </ul></li>
    <li><a href="../compatibility-guidelines.html" class="page">Compatibility Guidelines</a></li>
  </ul></li>
  <li><a href="../common/index.html" class="page">3. Data Types &amp; Abstractions</a></li>
  <li><a href="../server-side/index.html" class="page">4. Server API</a></li>
  <li><a href="../client-side/index.html" class="page">5. Client API</a></li>
  <li><a href="../extensions.html" class="page">6. Extensions</a></li>
  <li><a href="../technologies.html" class="page">7. Supported Technologies</a></li>
  <li><a href="../tipsandtricks.html" class="page">8. Tips And Tricks</a></li>
  <li><a href="../contributing.html" class="page">9. Contributing</a></li>
  <li><a href="../reference.html" class="page">10. Reference</a></li>
</ul>
</nav>
</div>
</header>
<div class="site-content-wrapper">
<aside class="sticky-sidebar show-for-large">
<header class="nav-header sticky-sidebar-header">
<div class="nav-header-title">
<h1><a href="../index.html">Akka HTTP</a></h1>
</div>
<div class="nav-header-version">
Version 10.2.9
</div>
<div class="nav-header-groups">
<select class="supergroup" name="Language"><option class="group" value="group-scala">Scala</option><option class="group" value="group-java">Java</option></select>
</div>
<div class="nav-header-search">
<input id="search" type="search" class="search" placeholder="Search" />
</div>
</header>
<nav class="site-nav sticky-sidebar-contents">
<div class="nav-toc">
<ul>
  <li><a href="../security.html" class="page">! Security Announcements !</a></li>
  <li><a href="../release-notes/index.html" class="page">0. Release Notes</a></li>
  <li><a href="../introduction.html" class="page">1. Introduction</a></li>
  <li><a href="../usage.html" class="page">2. Usage</a>
  <ul>
    <li><a href="../configuration.html" class="page">Configuration</a></li>
    <li><a href="../migration-guide/index.html" class="page">Migration Guides</a>
    <ul>
      <li><a href="../migration-guide/migration-guide-10.2.x.html#migration-guide-to-and-within-akka-http-10-2-x" class="active page">Migration Guide to and within Akka HTTP 10.2.x</a>
      <ul>
        <li><a href="../migration-guide/migration-guide-10.2.x.html#general-notes" class="header">General Notes</a></li>
        <li><a href="../migration-guide/migration-guide-10.2.x.html#akka-http-10-1-x-10-2-0" class="header">Akka HTTP 10.1.x -&gt; 10.2.0</a></li>
      </ul></li>
      <li><a href="../migration-guide/migration-guide-10.1.x.html" class="page">Migration Guide to and within Akka HTTP 10.1.x</a></li>
      <li><a href="../migration-guide/migration-guide-10.0.x.html" class="page">Migration Guide within Akka HTTP 10.0.x</a></li>
      <li><a href="../migration-guide/migration-guide-2.4.x-10.0.x.html" class="page">Migration Guide between Akka HTTP 2.4.x and 10.0.x</a></li>
      <li><a href="../migration-guide/migration-from-spray.html" class="page">Migration Guide from Spray</a></li>
      <li><a href="../migration-guide/migration-from-old-http-javadsl.html" class="page">Migration Guide from &ldquo;old&rdquo; HTTP JavaDSL</a></li>
    </ul></li>
    <li><a href="../compatibility-guidelines.html" class="page">Compatibility Guidelines</a></li>
  </ul></li>
  <li><a href="../common/index.html" class="page">3. Data Types &amp; Abstractions</a></li>
  <li><a href="../server-side/index.html" class="page">4. Server API</a></li>
  <li><a href="../client-side/index.html" class="page">5. Client API</a></li>
  <li><a href="../extensions.html" class="page">6. Extensions</a></li>
  <li><a href="../technologies.html" class="page">7. Supported Technologies</a></li>
  <li><a href="../tipsandtricks.html" class="page">8. Tips And Tricks</a></li>
  <li><a href="../contributing.html" class="page">9. Contributing</a></li>
  <li><a href="../reference.html" class="page">10. Reference</a></li>
</ul>
</div>
</nav>
<footer class="nav-footer sticky-sidebar-footer">
<a href="https://akka.io"><img class="logo" src="../images/akka-logo-reverse.svg"/></a>

</footer>
</aside>
<main class="fixed-shift-for-large expanded row">
<section class="site-content small-12 column">
<article class="page-content row">
<div class="small-12 column" id="docs">
<h1><a href="#migration-guide-to-and-within-akka-http-10-2-x" name="migration-guide-to-and-within-akka-http-10-2-x" class="anchor"><span class="anchor-link"></span></a>Migration Guide to and within Akka HTTP 10.2.x</h1>
<h2><a href="#general-notes" name="general-notes" class="anchor"><span class="anchor-link"></span></a>General Notes</h2>
<p>See the general <a href="../compatibility-guidelines.html">compatibility guidelines</a>.</p>
<p>Under these guidelines, minor version updates are supposed to be binary compatible and drop-in replacements for former versions under the condition that user code only uses public, stable, non-deprecated API. Especially libraries should make sure not to depend on deprecated API to be compatible with both 10.1.x and 10.2.x.</p>
<p>If you find an unexpected incompatibility please let us know, so we can check whether the incompatibility is accidental, so we might still be able to fix it.</p>
<h2><a href="#akka-http-10-1-x-10-2-0" name="akka-http-10-1-x-10-2-0" class="anchor"><span class="anchor-link"></span></a>Akka HTTP 10.1.x -&gt; 10.2.0</h2>
<p>10.2.0 will introduce deprecation warnings to every server project because the existing <code>Http.bind*</code> methods have been deprecated and replaced by the <a href="#new-serverbuilder-api-to-create-server-bindings">new ServerBuild API</a>. To ease the migration pain, we have prepared scalafix rules to automatically rewrite existing code to the new API.</p>
<p>To run those rules, first add scalafix to your <code>project/plugins.sbt</code>:</p>
<pre class="prettyprint"><code class="language-scala">addSbtPlugin(&quot;ch.epfl.scala&quot; % &quot;sbt-scalafix&quot; % &quot;0.9.34&quot;)
</code></pre>
<p>The in the sbt shell of your project run:</p>
<pre><code>scalafixEnable
set scalacOptions in ThisBuild += &quot;-P:semanticdb:synthetics:on&quot;
scalafixAll dependency:MigrateToServerBuilder@com.typesafe.akka:akka-http-scalafix-rules:10.2.0
</code></pre>
<p>See also scalafix&rsquo;s <a href="https://scalacenter.github.io/scalafix/docs/users/installation.html">Installation</a> and <a href="https://scalacenter.github.io/scalafix/docs/rules/external-rules.html">External Rules</a> documentation.</p>
<p>If your open-source project uses <a href="https://github.com/scala-steward-org/scala-steward">scala-steward</a> it might already automatically run those scalafix migrations and include the changes in its update PR to your repository.</p>
<h3><a href="#hiding-materializer" name="hiding-materializer" class="anchor"><span class="anchor-link"></span></a>Hiding Materializer</h3>
<p>Recent Akka versions introduced a singleton system materializer that can be summoned from an ActorSystem automatically. In many cases, <code>Materializer</code> arguments are now optional and APIs have been simplified to require materializers in fewer places. In fact, most common uses do not require a materializer any more at all.</p>
<h3><a href="#new-serverbuilder-api-to-create-server-bindings" name="new-serverbuilder-api-to-create-server-bindings" class="anchor"><span class="anchor-link"></span></a>New ServerBuilder API to create server bindings</h3>
<p>To simplify binding servers (and to make it more consistent between Java and Scala), a new <span class="group-java"><a href="https://doc.akka.io/japi/akka-http/10.2.9/akka/http/javadsl/ServerBuilder.html" title="akka.http.javadsl.ServerBuilder"><code>ServerBuilder</code></a></span><span class="group-scala"><a href="https://doc.akka.io/api/akka-http/10.2.9/akka/http/scaladsl/ServerBuilder.html" title="akka.http.scaladsl.ServerBuilder"><code>ServerBuilder</code></a></span> API has been introduced. The most common change needed to bind a server to handle routes will be from:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/akka-http/tree/v10.2.9/docs/src/test/scala/docs/http/scaladsl/server/AkkaHttp1020MigrationSpec.scala#L19-L26" target="_blank" title="Go to snippet source">source</a><code class="language-scala">// only worked with classic actor system
implicit val system = akka.actor.ActorSystem(&quot;TheSystem&quot;)
implicit val mat: Materializer = ActorMaterializer()
val route: Route =
  get {
    complete(&quot;Hello world&quot;)
  }
Http().bindAndHandle(route, &quot;localhost&quot;, 8080)</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/akka-http/tree/v10.2.9/docs/src/test/java/docs/http/javadsl/server/AkkaHttp1020MigrationExample.java#L20-L24" target="_blank" title="Go to snippet source">source</a><code class="language-java">// only worked with classic actor system
akka.actor.ActorSystem system = akka.actor.ActorSystem.create(&quot;TheSystem&quot;);
Materializer mat = ActorMaterializer.create(system);
Route route = get(() -&gt; complete(&quot;Hello World!&quot;));
Http.get(system).bindAndHandle(route.flow(system), ConnectHttp.toHost(&quot;localhost&quot;, 8080), mat);</code></pre></dd>
</dl>
<p>to:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/akka-http/tree/v10.2.9/docs/src/test/scala/docs/http/scaladsl/server/AkkaHttp1020MigrationSpec.scala#L32-L43" target="_blank" title="Go to snippet source">source</a><code class="language-scala">// works with both classic and typed ActorSystem
implicit val system = akka.actor.typed.ActorSystem(Behaviors.empty, &quot;TheSystem&quot;)
// or
// implicit val system = akka.actor.ActorSystem(&quot;TheSystem&quot;)

// materializer not needed any more

val route: Route =
  get {
    complete(&quot;Hello world&quot;)
  }
Http().newServerAt(&quot;localhost&quot;, 8080).bind(route)</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/akka-http/tree/v10.2.9/docs/src/test/java/docs/http/javadsl/server/AkkaHttp1020MigrationExample.java#L30-L38" target="_blank" title="Go to snippet source">source</a><code class="language-java">// works with classic or typed actor system
akka.actor.typed.ActorSystem system = akka.actor.typed.ActorSystem.create(Behaviors.empty(), &quot;TheSystem&quot;);
// or
// akka.actor.ActorSystem system = akka.actor.ActorSystem.create(&quot;TheSystem&quot;);

// materializer not needed any more

Route route = get(() -&gt; complete(&quot;Hello World!&quot;));
Http.get(system).newServerAt(&quot;localhost&quot;, 8080).bind(route);</code></pre></dd>
</dl>
<h3><a href="#scala-2-11-support-dropped" name="scala-2-11-support-dropped" class="anchor"><span class="anchor-link"></span></a>Scala 2.11 support dropped</h3>
<p>Almost three years after the release of Scala 2.11.12, support for Scala 2.11 has been dropped following the example of Akka 2.6. Akka HTTP 10.1.x which still supports Scala 2.11 will be supported for a while.</p>
<h3><a href="#httprequest-copy-httpresponse-copy-deprecated-in-favor-of-withxyz-methods" name="httprequest-copy-httpresponse-copy-deprecated-in-favor-of-withxyz-methods" class="anchor"><span class="anchor-link"></span></a>HttpRequest.copy / HttpResponse.copy deprecated in favor of withXYZ methods</h3>
<p>HttpRequest and HttpResponse have been converted from case classes to regular classes already a while ago. This was necessary to keep being able to make binary compatible changes to the API. So far, we kept the <code>copy</code> methods available but, like all methods with default parameters, these started to become a liability as well. In 10.2.0, the <code>copy</code> methods are now deprecated in favor of the more explicit <code>withXYZ</code> methods. This will help us to evolve those APIs in the future (as unfortunate it is that the idiomatic Scala way of case classes / default arguments is not an option because of our compatibility constraints).</p>
<h3><a href="#http-2-support-requires-jdk-8-update-252-or-later" name="http-2-support-requires-jdk-8-update-252-or-later" class="anchor"><span class="anchor-link"></span></a>HTTP/2 support requires JDK 8 update 252 or later</h3>
<p>JVM support for ALPN has been backported to JDK 8u252 which is now widely available. Support for using the Jetty ALPN agent has been dropped in 10.2.0. HTTP/2 support therefore now requires to be run on JVM &gt;= 8u252.</p>
<h3><a href="#scalatest-dependency-upgraded-to-3-1-0" name="scalatest-dependency-upgraded-to-3-1-0" class="anchor"><span class="anchor-link"></span></a>Scalatest dependency upgraded to 3.1.0</h3>
<p>The Scalatest dependency for akka-http-testkit was upgraded to version 3.1.0. This version is incompatible with previous versions. This is relevant for user code if it uses methods from <a href="https://doc.akka.io/api/akka-http/10.2.9/akka/http/scaladsl/testkit/ScalatestUtils.html" title="akka.http.scaladsl.testkit.ScalatestUtils"><code>ScalatestUtils</code></a> (which are in scope if your test extends from <a href="https://doc.akka.io/api/akka-http/10.2.9/akka/http/scaladsl/testkit/ScalaTestRouteTest.html" title="akka.http.scaladsl.testkit.ScalaTestRouteTest"><code>ScalaTestRouteTest</code></a>). In this case, the project itself needs to be updated to use Scalatest &gt;= 3.1.0.</p>
<h3><a href="#providing-route-settings-exception-and-rejection-handling" name="providing-route-settings-exception-and-rejection-handling" class="anchor"><span class="anchor-link"></span></a>Providing route settings, exception and rejection handling</h3>
<p>Previously, the implicit conversion <code>route2HandlerFlow</code> that turns a <code>Route</code> into a <code>Flow[HttpRequest, HttpResponse]</code> allowed implicitly passing in Routing settings, Parser settings, custom <code>Materializer</code>, <code>RoutingLog</code> or <code>ExecutionContext</code>, and the <code>RejectionHandler</code>/<code>ExceptionHandler</code> to use.</p>
<p>This has been simplified to use system defaults by default and to require explicit code if you want to change those defaults:</p>
<ul>
  <li>To set Routing or Parser settings, set them in your actor system configuration, e.g. via <code>application.conf</code>. In the rare case where you&rsquo;d like to  test routes with different <span class="group-java"><a href="https://doc.akka.io/japi/akka-http/10.2.9/akka/http/javadsl/settings/RoutingSettings.html" title="akka.http.javadsl.settings.RoutingSettings"><code>RoutingSettings</code></a></span><span class="group-scala"><a href="https://doc.akka.io/api/akka-http/10.2.9/akka/http/scaladsl/settings/RoutingSettings.html" title="akka.http.scaladsl.settings.RoutingSettings"><code>RoutingSettings</code></a></span> within the same test, you can use the  <a href="../routing-dsl/directives/basic-directives/withSettings.html">withSettings</a> directive.</li>
  <li>To apply a custom <span class="group-java"><a href="https://doc.akka.io/japi/akka-http/10.2.9/akka/http/javadsl/server/RejectionHandler.html" title="akka.http.javadsl.server.RejectionHandler"><code>RejectionHandler</code></a></span><span class="group-scala"><a href="https://doc.akka.io/api/akka-http/10.2.9/akka/http/scaladsl/server/RejectionHandler.html" title="akka.http.scaladsl.server.RejectionHandler"><code>RejectionHandler</code></a></span> or <span class="group-java"><a href="https://doc.akka.io/japi/akka-http/10.2.9/akka/http/javadsl/server/ExceptionHandler.html" title="akka.http.javadsl.server.ExceptionHandler"><code>ExceptionHandler</code></a></span><span class="group-scala"><a href="https://doc.akka.io/api/akka-http/10.2.9/akka/http/scaladsl/server/ExceptionHandler.html" title="akka.http.scaladsl.server.ExceptionHandler"><code>ExceptionHandler</code></a></span>, use the <a href="../routing-dsl/directives/execution-directives/handleRejections.html">handleRejections</a>  and <a href="../routing-dsl/directives/execution-directives/handleExceptions.html">handleExceptions</a> directives</li>
</ul>
<h4><a href="#in-routetest-scaladsl-" name="in-routetest-scaladsl-" class="anchor"><span class="anchor-link"></span></a>In RouteTest (scaladsl)</h4>
<p>Similarly, <span class="group-java"><a href="https://doc.akka.io/japi/akka-http/10.2.9/akka/http/javadsl/testkit/RouteTest.html" title="akka.http.javadsl.testkit.RouteTest"><code>RouteTest</code></a></span><span class="group-scala"><a href="https://doc.akka.io/api/akka-http/10.2.9/akka/http/scaladsl/testkit/RouteTest.html" title="akka.http.scaladsl.testkit.RouteTest"><code>RouteTest</code></a></span> no longer automatically picks up such implicit values, and you can use the same approach to explicitly set them instead.</p>
<h3><a href="#strict-query-strings" name="strict-query-strings" class="anchor"><span class="anchor-link"></span></a>Strict query strings</h3>
<p>In 10.1.x, while parsing the query string of a URI, characters were accepted that are not allowed according to RFC 3986, even when <code>parsing.uri-parsing-mode</code> was set to the default value of <code>strict</code>. Parsing such URIs will now fail in <code>strict</code> mode. If you want to allow such characters in incoming URIs, set <code>parsing.uri-parsing-mode</code> to <code>relaxed</code>, in which case these characters will be percent-encoded automatically.</p>
<h3><a href="#transparent-head-requests-now-disabled-by-default" name="transparent-head-requests-now-disabled-by-default" class="anchor"><span class="anchor-link"></span></a>Transparent HEAD requests now disabled by default</h3>
<p>Prior to 10.2.0, when a client would perform a <code>HEAD</code> request, by default Akka HTTP would call the <code>GET</code> route but discard the body. This can save bandwidth in some cases, but is also counter-intuitive when you actually want to explicitly handle <code>HEAD</code> requests,  and may increase resource usage in cases where the logic behind the <code>GET</code> request is heavy. For this reason we have changed  the default value of <code>akka.http.server.transparent-head-requests</code> to <code>off</code>, making this feature opt-in.</p>
<h3><a href="#server-side-http-pipelining-now-disabled-by-default" name="server-side-http-pipelining-now-disabled-by-default" class="anchor"><span class="anchor-link"></span></a>Server-side HTTP pipelining now disabled by default</h3>
<p>HTTP pipelining is now disabled by default. It is not used commonly by clients because it suffers from head-of-line blocking. It is recommended to use pooled connections or HTTP/2 instead.</p>
<p>HTTP pipelining is still supported and can be re-enabled by setting <code>pipelining-limit = n</code> with a value of <code>n &gt; 1</code>.</p>
<h3><a href="#x-real-ip-now-takes-precedence-over-remote-address-in-extractclientip" name="x-real-ip-now-takes-precedence-over-remote-address-in-extractclientip" class="anchor"><span class="anchor-link"></span></a>X-Real-Ip now takes precedence over Remote-Address in extractClientIP</h3>
<p>The <a href="../routing-dsl/directives/misc-directives/extractClientIP.html">extractClientIP</a> now returns the value of the <code>X-Real-Ip</code> header when both an<code>X-Real-Ip</code> and a <code>Remote-Address</code> header is available. This directive provides a &lsquo;best guess&rsquo; of the client IP, but in a way that allows any client to provide this address in the header. For this reason you should never trust this value for security purposes.</p>
<p>When you need a secure way to get the client IP, use the <span class="group-java"><a href="https://doc.akka.io/japi/akka-http/10.2.9/akka/http/javadsl/model/AttributeKeys.html" title="akka.http.javadsl.model.AttributeKeys"><code>AttributeKeys.remoteAddress</code></a></span><span class="group-scala"><a href="https://doc.akka.io/api/akka-http/10.2.9/akka/http/scaladsl/model/AttributeKeys$.html" title="akka.http.scaladsl.model.AttributeKeys"><code>AttributeKeys.remoteAddress</code></a></span> <a href="../common/http-model.html#attributes">attribute</a>, or use the specific headers which are known to be set correctly by the infrastructure you do trust.</p>
<h3><a href="#max-content-length" name="max-content-length" class="anchor"><span class="anchor-link"></span></a>max-content-length</h3>
<p>The <code>max-content-length</code> setting can no longer be set on <code>akka.http.parsing</code>, and instead must now be set explicitly on <code>akka.http.client.parsing</code> and/or <code>akka.http.server.parsing</code>. The default for <code>akka.http.client.parsing.max-content-length</code> has been changed from <code>8m</code> to <code>infinite</code>.</p>
<h3><a href="#removal-of-legacy-host-connection-pool" name="removal-of-legacy-host-connection-pool" class="anchor"><span class="anchor-link"></span></a>Removal of legacy host connection pool</h3>
<p>The legacy host connection pool is the original client pool implementation from the beginnings of Akka HTTP backing <code>Http().singleRequest</code> and other client APIs. During the 10.0.x development the pool was reimplemented and could be used in an opt-in fashion. Since 10.1.0, this new pool implementation has been the default. With 10.2.0 we took the opportunity to remove the old pool implementation. The setting <code>akka.http.host-connection-pool.pool-implementation</code> has been removed as well as its code representation in <code>ConnectionPoolSettings</code>.</p>
<h3><a href="#headervaluebytype-scaladsl-" name="headervaluebytype-scaladsl-" class="anchor"><span class="anchor-link"></span></a>headerValueByType (scaladsl)</h3>
<p>When using the Scala DSL, invoking <a href="../routing-dsl/directives/header-directives/headerValueByType.html">headerValueByType</a> and <a href="../routing-dsl/directives/header-directives/optionalHeaderValueByType.html">optionalHeaderValueByType</a> by just its generic parameter, like <code>headerValueByType[Origin]()</code>, uses a Scala feature called &lsquo;argument adaptation&rsquo; that is planned to <a href="https://github.com/scala/scala/pull/3260">go away</a> in a future value of Scala. While you could earlier work around this by writing <code>headerValueByType[Origin](())</code>, we have now deprecated this as well and you are encouraged to use the companion object instead: <code>headerValueByType(Origin)</code>. For headers that do not have a companion object, you can <code>headerValueByType(classOf[UpgradeToWebSocket])</code>.</p>
<h3><a href="#parameters-formfields-scaladsl-" name="parameters-formfields-scaladsl-" class="anchor"><span class="anchor-link"></span></a>parameters / formFields (scaladsl)</h3>
<p>The <a href="../routing-dsl/directives/parameter-directives/parameter.html">parameters</a> and the <a href="../routing-dsl/directives/form-field-directives/formFields.html">formFields</a> directives used to rely on the &lsquo;magnet pattern&rsquo;. Unfortunately, for the case where you would match multiple parameters, the pattern relied on a Scala feature called &lsquo;argument adaptation&rsquo; which is planned to <a href="https://github.com/scala/scala/pull/3260">go away</a> in a future version of Scala.</p>
<p>Earlier, you would have to work around this by including double parentheses, like this (same for <code>formFields</code>):</p>
<pre><code>parameters((&quot;a&quot;.as[Int], &quot;b&quot;.as[Int]))
</code></pre>
<p>We have changed the implementation of the directives in a way that is binary compatible and source compatible, with one exception: previously, <code>&lt;name&gt;.requiredValue</code> would match and check a parameter, but it would not be extracted by the directive. From 10.2.0 forward it will be extracted by the directive even when it is required.</p>
<p>This means when in the past you had:</p>
<pre><code>parameter(&quot;nose&quot;.requiredValue(&quot;large&quot;)) { complete(&quot;Ok!&quot;) }
</code></pre>
<p>You would now have</p>
<pre><code>parameter(&quot;nose&quot;.requiredValue(&quot;large&quot;)) { _ =&gt; complete(&quot;Ok!&quot;) }
</code></pre>
<p>This is especially relevant when you were combining parameters directives with other directives using <code>|</code>: since the output types of the directives on both &lsquo;sides&rsquo; of the <code>|</code> need to be equal, where you previously might have had:</p>
<pre><code>(post | parameter(&quot;method&quot;.requiredValue(&quot;post&quot;))) { complete(&quot;POST&quot;) }
</code></pre>
<p>You will now have to explicitly discard the parameter value:</p>
<pre><code>(post | parameter(&quot;method&quot;.requiredValue(&quot;post&quot;)).tmap(_ =&gt; ())) { complete(&quot;POST&quot;) }
</code></pre>
<h3><a href="#coding-infrastructure-is-now-internal" name="coding-infrastructure-is-now-internal" class="anchor"><span class="anchor-link"></span></a>Coding infrastructure is now internal</h3>
<p>Previously, the coding infrastructure has been mostly public, exposing API that was never intended to be public. Most of the existing classes have now been marked as internal and deprecated. This will allow us to remove the coding infrastructure from akka-http itself in the future and use implementations provided by akka-stream directly.</p>
<p>Only parts of <code>Encoder</code>, <code>Decoder</code>, and <code>Coder</code> are still public. Predefined coders that have been available as e.g. <code>akka.http.scaladsl.coding.Gzip</code> are now available as <code>scaladsl.coding.Coders.Gzip</code>, <code>Coders.Deflate</code>, and <code>Coders.NoCoding</code>. Coding directives that use the default coding setup, like <code>encodeResponse</code> and <code>decodeRequest</code> continue to work without changes necessary.</p>
<h3><a href="#configuring-https-connections" name="configuring-https-connections" class="anchor"><span class="anchor-link"></span></a>Configuring HTTPS connections</h3>
<p>Akka HTTP no longer uses the HTTPS configuration configured with <code>ssl-config</code> by default. Instead, it will use the JRE defaults for client connections. For server connections you should create a <span class="group-java"><a href="https://doc.akka.io/japi/akka-http/10.2.9/akka/http/javadsl/HttpsConnectionContext.html" title="akka.http.javadsl.HttpsConnectionContext"><code>HttpsConnectionContext</code></a></span><span class="group-scala"><a href="https://doc.akka.io/api/akka-http/10.2.9/akka/http/scaladsl/HttpsConnectionContext.html" title="akka.http.scaladsl.HttpsConnectionContext"><code>HttpsConnectionContext</code></a></span> with the relevant configuration.</p>
<p>Previously, the SSL configuration was constructed based on the parameters you pass to <span class="group-java"><a href="https://doc.akka.io/japi/akka-http/10.2.9/akka/http/javadsl/HttpsConnectionContext.html" title="akka.http.javadsl.HttpsConnectionContext"><code>HttpsConnectionContext</code></a></span><span class="group-scala"><a href="https://doc.akka.io/api/akka-http/10.2.9/akka/http/scaladsl/HttpsConnectionContext$.html" title="akka.http.scaladsl.HttpsConnectionContext"><code>HttpsConnectionContext</code></a></span> and the logic and configuration used by the <a href="https://lightbend.github.io/ssl-config/">ssl-config</a> library. This was because back then the default JDK SSL configuration was a bad match for HTTP connections. Nowadays, however, the JDK defaults are much better and the use of <code>ssl-config</code> makes the configuration hard to reason about.</p>
<p>For this reason, we have deprecated the <code>ssl-config</code>-based APIs, and now provide <span class="group-java"><a href="https://doc.akka.io/japi/akka-http/10.2.9/akka/http/javadsl/ConnectionContext.html" title="akka.http.javadsl.ConnectionContext"><code>ConnectionContext.httpsServer</code></a></span><span class="group-scala"><a href="https://doc.akka.io/api/akka-http/10.2.9/akka/http/scaladsl/ConnectionContext$.html" title="akka.http.scaladsl.ConnectionContext"><code>ConnectionContext.httpsServer</code></a></span> and <span class="group-java"><a href="https://doc.akka.io/japi/akka-http/10.2.9/akka/http/javadsl/ConnectionContext.html" title="akka.http.javadsl.ConnectionContext"><code>ConnectionContext.httpsClient</code></a></span><span class="group-scala"><a href="https://doc.akka.io/api/akka-http/10.2.9/akka/http/scaladsl/ConnectionContext$.html" title="akka.http.scaladsl.ConnectionContext"><code>ConnectionContext.httpsClient</code></a></span> that will use the JDK defaults. There is also a <span class="group-java"><a href="https://doc.akka.io/japi/akka-http/10.2.9/akka/http/javadsl/ConnectionContext.html" title="akka.http.javadsl.ConnectionContext"><code>ConnectionContext.https</code></a></span><span class="group-scala"><a href="https://doc.akka.io/api/akka-http/10.2.9/akka/http/scaladsl/ConnectionContext$.html" title="akka.http.scaladsl.ConnectionContext"><code>ConnectionContext.https</code></a></span> where you can provide your own logic for creating <code>SSLEngine</code> instances. When using this more low-level API, remember it is up to you to set the <code>SSLEngine</code> &lsquo;mode&rsquo; (client or server), and further configuration such as enabling SNI and hostname verification features when needed.</p>
<h3><a href="#list-of-deprecated-and-deleted-apis" name="list-of-deprecated-and-deleted-apis" class="anchor"><span class="anchor-link"></span></a>List of deprecated and deleted APIs</h3>
<h4><a href="#deprecated-apis" name="deprecated-apis" class="anchor"><span class="anchor-link"></span></a>Deprecated APIs</h4>
<p>javadsl:</p>
<ul>
  <li>static <code>akka.http.javadsl.ConnectionContext.https</code></li>
  <li>most getters of <code>akka.http.javadsl.ConnectionContext</code></li>
  <li><code>akka.http.javadsl.Http.bind</code></li>
  <li><code>akka.http.javadsl.Http.bindAndHandle</code></li>
  <li><code>akka.http.javadsl.Http.bindAndHandleSync</code></li>
  <li><code>akka.http.javadsl.Http.bindAndHandleAsync</code></li>
  <li><code>akka.http.javadsl.Http.defaultServerHttpContext</code></li>
  <li><code>akka.http.javadsl.Http.setDefaultServerHttpContext</code></li>
  <li><code>akka.http.javadsl.Http.createServerHttpsContext</code></li>
  <li><code>akka.http.javadsl.Http.createClientHttpsContext</code></li>
  <li><code>akka.http.javadsl.Http.createDefaultClientHttpsContext</code></li>
  <li><code>akka.http.javadsl.model.ws.UpgradeToWebSocket</code></li>
  <li><code>akka.http.javadsl.server.HttpApp</code></li>
  <li><code>akka.http.javadsl.settings.ParserSettings.create</code></li>
  <li><code>akka.http.javadsl.settings.ServerSettings.getRemoteAddressHeader</code></li>
  <li><code>akka.http.javadsl.settings.ServerSettings.getWebsocketRandomFactory</code></li>
  <li><code>akka.http.javadsl.settings.ServerSettings.withWebsocketRandomFactory</code></li>
  <li><code>akka.http.javadsl.server.directives.WebSocketDirectives.extractUpgradeToWebSocket</code></li>
</ul>
<p>scaladsl:</p>
<ul>
  <li>most of <code>akka.http.scaladsl.ConnectionContext</code></li>
  <li><code>akka.http.scaladsl.HttpExt.bind</code></li>
  <li><code>akka.http.scaladsl.HttpExt.bindAndHandle</code></li>
  <li><code>akka.http.scaladsl.HttpExt.bindAndHandleSync</code></li>
  <li><code>akka.http.scaladsl.HttpExt.bindAndHandleAsync</code></li>
  <li><code>akka.http.scaladsl.Http.defaultServerHttpContext</code></li>
  <li><code>akka.http.scaladsl.Http.setDefaultServerHttpContext</code></li>
  <li><code>akka.http.scaladsl.Http.createClientHttpsContext</code></li>
  <li><code>akka.http.scaladsl.Http.createDefaultClientHttpsContext</code></li>
  <li><code>akka.http.scaladsl.model.HttpCookie.copy</code></li>
  <li><code>akka.http.scaladsl.model.HttpCookie.unapply</code></li>
  <li><code>akka.http.scaladsl.model.HttpRequest.copy</code></li>
  <li><code>akka.http.scaladsl.model.HttpResponse.copy</code></li>
  <li><code>akka.http.scaladsl.model.headers.Remote-Address</code></li>
  <li><code>akka.http.scaladsl.model.ws.UpgradeToWebSocket</code></li>
  <li><code>akka.http.scaladsl.server.HttpApp</code></li>
  <li><code>akka.http.scaladsl.settings.ParserSettings.apply</code></li>
  <li><code>akka.http.scaladsl.settings.ServerSettings.remoteAddressHeader</code></li>
  <li><code>akka.http.scaladsl.settings.ServerSettings.getWebsocketRandomFactory</code></li>
  <li><code>akka.http.scaladsl.settings.ServerSettings.withWebsocketRandomFactory</code></li>
  <li><code>akka.http.scaladsl.coding.Deflate</code></li>
  <li><code>akka.http.scaladsl.coding.DeflateCompressor</code></li>
  <li><code>akka.http.scaladsl.coding.StreamDecoder</code></li>
  <li><code>akka.http.scaladsl.coding.Encoder.encode(ByteString): ByteString</code></li>
  <li><code>akka.http.scaladsl.coding.Encoder.newCompressor</code></li>
  <li><code>akka.http.scaladsl.coding.Encoder.newEncodeTransformer</code></li>
  <li><code>akka.http.scaladsl.coding.Compressor</code></li>
  <li><code>akka.http.scaladsl.coding.Gzip</code></li>
  <li><code>akka.http.scaladsl.coding.NoCoding</code></li>
  <li><code>akka.http.scaladsl.server.Route.asyncHandler</code></li>
  <li><code>akka.http.scaladsl.server.directives.FormFieldDirectives.FieldMagnet</code></li>
  <li><code>akka.http.scaladsl.server.directives.FormFieldDirectives.FieldDef</code></li>
  <li><code>akka.http.scaladsl.server.directives.FormFieldDirectives.FieldDefAux</code></li>
  <li><code>akka.http.scaladsl.server.directives.HeaderDirectives.headerValueByName</code></li>
  <li><code>akka.http.scaladsl.server.directives.HeaderDirectives.optionalHeaderValueByName</code></li>
  <li><code>akka.http.scaladsl.server.directives.HeaderDirectives.fromUnitForModeledCustomHeader</code></li>
  <li><code>akka.http.scaladsl.server.directives.HeaderDirectives.fromUnitNormalHeader</code></li>
  <li><code>akka.http.scaladsl.server.directives.WebSocketDirectives.extractUpgradeToWebSocket</code></li>
</ul>
<h4><a href="#deleted-apis-or-overloads-" name="deleted-apis-or-overloads-" class="anchor"><span class="anchor-link"></span></a>Deleted APIs (or overloads)</h4>
<ul>
  <li>some <code>akka.http.javadsl.Http</code> method overloads with a materializer parameter (like <code>singleRequest</code>, <code>superPool</code>)</li>
  <li><code>akka.http.javadsl.HostConnectionPool.shutdown</code></li>
  <li><code>akka.http.javadsl.model.HttpMethod.getRequestEntityAcceptance</code></li>
  <li><code>akka.http.javadsl.model.HttpMethods.createCustom</code></li>
  <li><code>akka.http.javadsl.settings.ConnectionPoolSettings.getTransport</code></li>
  <li><code>akka.http.javadsl.*ConnectionContext.getDefaultPort</code></li>
  <li>
  <p>some <code>akka.http.scaladsl.HttpExt</code> method overloads with a materializer parameter (like <code>singleRequest</code>, <code>superPool</code>)</p></li>
  <li><code>akka.http.scaladsl.Http#HostConnectionPool.shutdown</code></li>
  <li><code>akka.http.scaladsl.HttpExt.outgoingConnectionUsingTransport</code></li>
  <li><code>akka.http.scaladsl.UseHttp2</code> and related methods in <em>ConnectionContext and ConnectHttp</em></li>
  <li><code>akka.http.scaladsl.model.HttpMethod.getRequestEntityAcceptance</code></li>
</ul>
</div>
</article>
<div class="row">
<div class="small-12 column">
<section class="nav-prev-next row">
<div class="nav-prev small-6 column">
<a href="../migration-guide/index.html"><i class="icon-prev"></i> <span class="link-prev">Migration Guides</span></a>
</div>
<div class="nav-next small-6 column clearfix">
<a class="float-right" href="../migration-guide/migration-guide-10.1.x.html">Migration Guide to and within Akka HTTP 10.1.x <i class="icon-next"></i></a>
</div>
</section>
</div>
</div>
<div class="source-github row">
Found an error in this documentation? The source code for this page can be found <a href="https://github.com/akka/akka-http/tree/v10.2.9/docs/src/main/paradox/migration-guide/migration-guide-10.2.x.md">here</a>.
Please feel free to edit and contribute a pull request.
</div>

<footer class="page-footer row clearfix">
<img class="akka-icon float-left show-for-medium" src="../images/akka-icon.svg" />
<section class="copyright">
<div>Akka HTTP is Open Source and available under the Apache 2 License.</div>
<p class="legal">
&copy; 2011-2022 <a href="https://www.lightbend.com" target="_blank">Lightbend, Inc.</a> |
<a href="https://www.lightbend.com/legal/licenses" target="_blank">Licenses</a> |
<a href="https://www.lightbend.com/legal/terms" target="_blank">Terms</a> |
<a href="https://www.lightbend.com/legal/privacy" target="_blank">Privacy Policy</a> |
<a href="https://akka.io/cookie/" target="_blank">Cookie Listing</a> |
<a class="optanon-toggle-display">Cookie Settings</a>
</p>
</section>

</footer>
</section>
</main>
</div>

<script type="text/javascript" src="../js/scrollsneak.js"></script>
<script type="text/javascript">jQuery(document).foundation();</script>
<script type="text/javascript" src="../js/groups.js"></script>
<script type="text/javascript" src="../js/page.js"></script>
<script type="text/javascript" src="../js/snippets.js"></script>
<script type="text/javascript" src="../js/magellan.js"></script>
<script type="text/javascript" src="../js/metadata-toggle.js"></script>
<script type="text/javascript" src="../js/lbHeader.js"></script>

<style type="text/css">@import "../lib/prettify/prettify.css";</style>
<script type="text/javascript" src="../lib/prettify/prettify.js"></script>
<script type="text/javascript" src="../lib/prettify/lang-scala.js"></script>
<script type="text/javascript">//<![CDATA[
jQuery(function(){window.prettyPrint && prettyPrint()});
//]]></script>
<!-- Algolia docs search -->
<script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.js"></script>
<style>.algolia-autocomplete { display: block !important }</style>
<script type="text/javascript">
docsearch({
apiKey: '0ccbb8bf5148554a406fbf07df0a93b9',
indexName: 'akka-http',
inputSelector: '#search',
algoliaOptions: {
hitsPerPage: 5
}
});

docsearch({
apiKey: '0ccbb8bf5148554a406fbf07df0a93b9',
indexName: 'akka-http',
inputSelector: '#overlay-search',
algoliaOptions: {
hitsPerPage: 5
}
});

// set up "/" as global shortcut for focusing on search
jQuery(document).keypress(function (event) {
if (event.keyCode == 47) {
jQuery("#search").focus();
return false; // swallow key event, otherwise the / char would be input into the search box
}
});
</script>

<script type="text/javascript" src="../assets/js/warnOldDocs.js"></script>
<script type="text/javascript" src="../assets/js/scrollToFragment.js"></script>


</body>
</html>
