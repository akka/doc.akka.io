<!DOCTYPE html>
<html class="no-js" lang="en">

<head>
<title>Testing with a Docker Kafka cluster &bull; Alpakka Kafka Documentation</title>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<meta name="description" content="Alpakka Kafka provides Testcontainers support for running a Kafka cluster locally using Docker containers."/>
<link rel="canonical" href="https://doc.akka.io/docs/alpakka-kafka/current/testing-testcontainers.html"/>
<script type="text/javascript" src="lib/jquery/jquery.min.js"></script>
<script type="text/javascript" src="lib/foundation/dist/js/foundation.min.js"></script>
<link rel="stylesheet" type="text/css" href="lib/normalize.css/normalize.css"/>
<link rel="stylesheet" type="text/css" href="lib/foundation/dist/css/foundation.min.css"/>
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.css" />
<link rel="stylesheet" type="text/css" href="css/icons.css"/>
<link rel="stylesheet" type="text/css" href="css/page-8.css"/>
<link rel="stylesheet" type="text/css" href="css/banner-2.css"/>
<link rel="shortcut icon" href="images/favicon.ico" />
<link rel="apple-touch-icon" sizes="180x180" href="images/apple-touch-icon.png"/>
<link rel="icon" type="image/png" sizes="32x32" href="images/favicon-32x32.png"/>
<link rel="icon" type="image/png" sizes="16x16" href="images/favicon-16x16.png"/>
<link rel="manifest" href="images/manifest.json"/>
<meta name="msapplication-TileImage" content="images/mstile-150x150.png"/>
<meta name="msapplication-TileColor" content="#15a9ce"/>
<meta name="theme-color" content="#15a9ce"/>
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>
<!-- OneTrust Cookies Consent Notice (Production Standard, akka.io, en-GB) start -->
<script src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js"  type="text/javascript" charset="UTF-8" data-domain-script="28b912e7-09e9-43d5-91e4-3d1897044004" ></script>
<script type="text/javascript">
function OptanonWrapper() { }
</script>
<!-- OneTrust Cookies Consent Notice (Production Standard, akka.io, en-GB) end -->
<!--Google Analytics NOTE this will stop processing data July 1st 2023. At which point this embed code can be removed-->
<script type="text/plain" class="optanon-category-2">
var _gaq = _gaq || [];
_gaq.push(['_setAccount', '']);
_gaq.push(['_setDomainName', '']);
_gaq.push(['_trackPageview']);
(function() {
var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})()
</script>

<!-- Google Tag Manager: Updated May 17th 2023 - Cookie Compliance checks have been moved into Google Tag Manager -->
<script type="text/javascript">
(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-KBJGH35');
</script>

</head>

<body id="underlay" data-toggler="nav-open">
<div id="lightbend-banner" class="lightbend-banner akka full-width" data-category="OSS Lightbend Banner Impression" data-label="Akka Banner Impression">
<div class="oss-wrapper">
<div class="oss-brand">
<a class="oss-track-link-label" data-category="OSS Lightbend Banner Clicks" data-label="Lightbend Logo - Akka Banner" href="https://www.lightbend.com">
<img class="lightbend-logo" src="images/banner-logos/lightbend-reverse.svg" alt="Lightbend" title="Lightbend">
</a>
</div>
<div class="oss-ad no-drop-down">
<nav id="lightbendRotator" class="lightbend-rotator">
<a class="oss-track-link-label" data-category="OSS Lightbend Banner Clicks" data-label="Promo Rotator - Lightbend Changed its Software Licensing Model for Akka Technology. [License FAQ] - Akka Banner" href="https://www.lightbend.com/akka/license-faq">
<strong>Lightbend</strong> Changed its Software Licensing Model for Akka Technology. <span class="akka-btn">License FAQ</span>
</a>
</nav>
</div>
</div>
</div>

<header class="site-header hide-for-large">
<div class="sticky-header clearfix">
<a href="https://akka.io"><img class="logo" src="images/akka-alpakka-reverse.svg"></a>

<button class="menu-icon float-right" type="button" data-toggle="underlay overlay"></button>
</div>
<div id="overlay" class="overlay-nav" data-toggler="nav-open">
<header class="nav-header">
<div class="nav-header-title">
<h1><a href="index.html">Alpakka Kafka Documentation</a></h1>
</div>
<div class="nav-header-version">
Version 5.0.0-M1
</div>
<div class="nav-header-groups">
<select class="supergroup" name="Language"><option class="group" value="group-java">Java</option><option class="group" value="group-scala">Scala</option></select>
</div>
</header>
<nav class="nav-toc">
<ul>
  <li><a href="home.html" class="page">Overview</a></li>
  <li><a href="producer.html" class="page">Producer</a></li>
  <li><a href="consumer.html" class="page">Consumer</a></li>
  <li><a href="discovery.html" class="page">Service discovery</a></li>
  <li><a href="cluster-sharding.html" class="page">Akka Cluster Sharding</a></li>
  <li><a href="errorhandling.html" class="page">Error handling</a></li>
  <li><a href="atleastonce.html" class="page">At-Least-Once Delivery</a></li>
  <li><a href="transactions.html" class="page">Transactions</a></li>
  <li><a href="serialization.html" class="page">Serialization</a></li>
  <li><a href="debugging.html" class="page">Debugging</a></li>
  <li><a href="testing.html" class="page">Testing</a>
  <ul>
    <li><a href="testing.html#running-kafka-with-your-tests" class="header">Running Kafka with your tests</a></li>
    <li><a href="testing.html#alternative-testing-libraries" class="header">Alternative testing libraries</a></li>
    <li><a href="testing.html#mocking-the-consumer-or-producer" class="header">Mocking the Consumer or Producer</a></li>
    <li><a href="testing-testcontainers.html#testing-with-a-docker-kafka-cluster" class="active page">Testing with a Docker Kafka cluster</a>
    <ul>
      <li><a href="testing-testcontainers.html#settings" class="header">Settings</a></li>
      <li><a href="testing-testcontainers.html#testing-with-a-docker-kafka-cluster-from-java-code" class="header">Testing with a Docker Kafka cluster from Java code</a></li>
      <li><a href="testing-testcontainers.html#testing-with-a-docker-kafka-cluster-from-scala-code" class="header">Testing with a Docker Kafka cluster from Scala code</a></li>
    </ul></li>
  </ul></li>
  <li><a href="production.html" class="page">Production considerations</a></li>
  <li><a href="snapshots.html" class="page">Snapshots</a></li>
</ul>
</nav>
</div>
</header>
<div class="site-content-wrapper">
<aside class="sticky-sidebar show-for-large">
<header class="nav-header sticky-sidebar-header">
<div class="nav-header-title">
<h1><a href="index.html">Alpakka Kafka Documentation</a></h1>
</div>
<div class="nav-header-version">
Version 5.0.0-M1
</div>
<div class="nav-header-groups">
<select class="supergroup" name="Language"><option class="group" value="group-java">Java</option><option class="group" value="group-scala">Scala</option></select>
</div>
</header>
<nav class="site-nav sticky-sidebar-contents">
<div class="nav-toc">
<ul>
  <li><a href="home.html" class="page">Overview</a></li>
  <li><a href="producer.html" class="page">Producer</a></li>
  <li><a href="consumer.html" class="page">Consumer</a></li>
  <li><a href="discovery.html" class="page">Service discovery</a></li>
  <li><a href="cluster-sharding.html" class="page">Akka Cluster Sharding</a></li>
  <li><a href="errorhandling.html" class="page">Error handling</a></li>
  <li><a href="atleastonce.html" class="page">At-Least-Once Delivery</a></li>
  <li><a href="transactions.html" class="page">Transactions</a></li>
  <li><a href="serialization.html" class="page">Serialization</a></li>
  <li><a href="debugging.html" class="page">Debugging</a></li>
  <li><a href="testing.html" class="page">Testing</a>
  <ul>
    <li><a href="testing.html#running-kafka-with-your-tests" class="header">Running Kafka with your tests</a></li>
    <li><a href="testing.html#alternative-testing-libraries" class="header">Alternative testing libraries</a></li>
    <li><a href="testing.html#mocking-the-consumer-or-producer" class="header">Mocking the Consumer or Producer</a></li>
    <li><a href="testing-testcontainers.html#testing-with-a-docker-kafka-cluster" class="active page">Testing with a Docker Kafka cluster</a>
    <ul>
      <li><a href="testing-testcontainers.html#settings" class="header">Settings</a></li>
      <li><a href="testing-testcontainers.html#testing-with-a-docker-kafka-cluster-from-java-code" class="header">Testing with a Docker Kafka cluster from Java code</a></li>
      <li><a href="testing-testcontainers.html#testing-with-a-docker-kafka-cluster-from-scala-code" class="header">Testing with a Docker Kafka cluster from Scala code</a></li>
    </ul></li>
  </ul></li>
  <li><a href="production.html" class="page">Production considerations</a></li>
  <li><a href="snapshots.html" class="page">Snapshots</a></li>
</ul>
</div>
</nav>
<footer class="nav-footer sticky-sidebar-footer">
<a href="https://akka.io"><img class="logo" src="images/akka-alpakka-reverse.svg"></a>

</footer>
</aside>
<main class="fixed-shift-for-large expanded row">
<section class="site-content small-12 column">
<article class="page-content row">
<div class="small-12 column" id="docs">
<h1><a href="#testing-with-a-docker-kafka-cluster" name="testing-with-a-docker-kafka-cluster" class="anchor"><span class="anchor-link"></span></a>Testing with a Docker Kafka cluster</h1>
<p>The <a href="https://www.testcontainers.org/">Testcontainers</a> project contains a nice API to start and stop Apache Kafka in Docker containers. This becomes very relevant when your application code uses a Scala version which Apache Kafka doesn&rsquo;t support so that <em>EmbeddedKafka</em> can&rsquo;t be used. Testcontainers also allow you to create a complete Kafka cluster (using Docker containers) to simulate production use cases.</p>
<h2><a href="#settings" name="settings" class="anchor"><span class="anchor-link"></span></a>Settings</h2>
<p>You can override testcontainers settings to create multi-broker Kafka clusters, or to finetune Kafka Broker, ZooKeeper and Schema Registry configuration, by updating <span class="group-scala"><a href="/api/alpakka-kafka/5.0.0-M1/akka/kafka/testkit/KafkaTestkitTestcontainersSettings.html" title="akka.kafka.testkit.KafkaTestkitTestcontainersSettings"><code>KafkaTestkitTestcontainersSettings</code></a></span><span class="group-java"><a href="/api/alpakka-kafka/5.0.0-M1/akka/kafka/testkit/KafkaTestkitTestcontainersSettings.html" title="akka.kafka.testkit.KafkaTestkitTestcontainersSettings"><code>KafkaTestkitTestcontainersSettings</code></a></span> in code or configuration. The <span class="group-scala"><a href="/api/alpakka-kafka/5.0.0-M1/akka/kafka/testkit/KafkaTestkitTestcontainersSettings.html" title="akka.kafka.testkit.KafkaTestkitTestcontainersSettings"><code>KafkaTestkitTestcontainersSettings</code></a></span><span class="group-java"><a href="/api/alpakka-kafka/5.0.0-M1/akka/kafka/testkit/KafkaTestkitTestcontainersSettings.html" title="akka.kafka.testkit.KafkaTestkitTestcontainersSettings"><code>KafkaTestkitTestcontainersSettings</code></a></span> type can be used to perform actions such as:</p>
<ul>
  <li>Set the docker image and tag of Kafka, ZooKeeper, and Schema Registry version to use (a recent Confluent Platform version is used by default)</li>
  <li>Define number of Kafka brokers</li>
  <li>Overriding container settings and environment variables (i.e. to change default Broker config)</li>
  <li>Apply custom docker configuration to the Kafka and ZooKeeper containers used to create a cluster</li>
</ul>
<p>To change defaults for all settings update the appropriate configuration in <code>akka.kafka.testkit.testcontainers</code>.</p>
<pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/alpakka-kafka/tree/v5.0.0-M1/testkit/src/main/resources/reference.conf#L16-L52" target="_blank" title="Go to snippet source">source</a><code class="language-conf">akka.kafka.testkit.testcontainers {

  # define these settings to select a different Kafka/ZooKeeper docker image
  # we recommend using Confluent Platform docker images and using the same version across all images
  # Confluent publishes images on DockerHub: https://hub.docker.com/r/confluentinc/cp-kafka/tags
  # Kafka versions in Confluent Platform: https://docs.confluent.io/current/installation/versions-interoperability.html
  zookeeper-image = &quot;confluentinc/cp-zookeeper&quot;
  zookeeper-image-tag = ${akka.kafka.testkit.testcontainers.confluent-platform-version}
  kafka-image = &quot;confluentinc/cp-kafka&quot;
  kafka-image-tag = ${akka.kafka.testkit.testcontainers.confluent-platform-version}
  schema-registry-image = &quot;confluentinc/cp-schema-registry&quot;
  schema-registry-image-tag = ${akka.kafka.testkit.testcontainers.confluent-platform-version}
  # See https://docs.confluent.io/platform/current/installation/versions-interoperability.html
  confluent-platform-version = &quot;7.0.0&quot;

  # the number of Kafka brokers to include in a test cluster
  num-brokers = 1

  # set this to use a replication factor for internal Kafka topics such as Consumer Offsets and Transaction log.
  # this replication factor must be less than or equal to `num-brokers`
  internal-topics-replication-factor = 1

  # set this to true to launch a testcontainer for Confluent Schema Registry
  use-schema-registry = false

  # set this to true to stream the STDOUT and STDERR of containers to SLF4J loggers
  # this requires the SLF4J dependency to be on the classpath and the loggers enabled in your logging configuration
  container-logging = false

  # set this to the total length of time to wait for a Kafka container cluster to start. this includes all brokers
  # zookeeper, and schema registry nodes. note that this can take a considerable time in limited resource environments.
  cluster-start-timeout = 360 s

  # set this to the total length of time to wait for a Kafka container readiness check to complete. note that this can
  # take a considerable time in limited resource environments.
  readiness-check-timeout = 360 s
}</code></pre>
<p>You can override all these defaults in code and per test class. By applying settings in code you can also configure the Kafka and ZooKeeper containers themselves.</p>
<p>For example, the following demonstrates creating a 3 Broker Kafka cluster and disables the automatic topic creation broker configuration using environment variables.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/alpakka-kafka/tree/v5.0.0-M1/tests/src/test/scala/akka/kafka/scaladsl/SpecBase.scala#L11-L30" target="_blank" title="Go to snippet source">source</a><code class="language-scala">import akka.kafka.testkit.scaladsl.ScalatestKafkaSpec
import org.scalatest.concurrent.{Eventually, IntegrationPatience, ScalaFutures}
import org.scalatest.wordspec.AnyWordSpecLike
import org.scalatest.matchers.should.Matchers

abstract class SpecBase(kafkaPort: Int)
    extends ScalatestKafkaSpec(kafkaPort)
    with AnyWordSpecLike
    with Matchers
    with ScalaFutures
    with Eventually {

  protected def this() = this(kafkaPort = -1)
}

import akka.kafka.testkit.KafkaTestkitTestcontainersSettings
import akka.kafka.testkit.scaladsl.TestcontainersKafkaPerClassLike

class TestcontainersNewSettingsSampleSpec extends SpecBase with TestcontainersKafkaPerClassLike {

  override val testcontainersSettings = KafkaTestkitTestcontainersSettings(system)
    .withNumBrokers(3)
    .withInternalTopicsReplicationFactor(2)
    .withConfigureKafka { brokerContainers =&gt;
      brokerContainers.foreach(_.withEnv(&quot;KAFKA_AUTO_CREATE_TOPICS_ENABLE&quot;, &quot;false&quot;))
    }

  // ...
}</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/alpakka-kafka/tree/v5.0.0-M1/tests/src/test/java/docs/javadsl/TestkitTestcontainersTest.java#L9-L45" target="_blank" title="Go to snippet source">source</a><code class="language-java">import akka.actor.ActorSystem;
import akka.kafka.testkit.KafkaTestkitTestcontainersSettings;
import akka.kafka.testkit.javadsl.TestcontainersKafkaTest;
import org.junit.jupiter.api.AfterAll;
import org.junit.jupiter.api.TestInstance;

@TestInstance(TestInstance.Lifecycle.PER_CLASS)
class TestkitTestcontainersTest extends TestcontainersKafkaTest {

  private static final ActorSystem system = ActorSystem.create(&quot;TestkitTestcontainersTest&quot;);

  private static KafkaTestkitTestcontainersSettings testcontainersSettings =
      KafkaTestkitTestcontainersSettings.create(system)
          .withNumBrokers(3)
          .withInternalTopicsReplicationFactor(2)
          .withConfigureKafkaConsumer(
              brokerContainers -&gt;
                  brokerContainers.forEach(
                      b -&gt; b.withEnv(&quot;KAFKA_AUTO_CREATE_TOPICS_ENABLE&quot;, &quot;false&quot;)));

  TestkitTestcontainersTest() {
    // this will only start a new cluster if it has not already been started.
    //
    // you must stop the cluster in the afterClass implementation if you want to create a cluster
    // per test class
    // using (TestInstance.Lifecycle.PER_CLASS)
    super(system, testcontainersSettings);
  }

  // ...

  // omit this implementation if you want the cluster to stay up for all your tests
  @AfterAll
  void afterClass() {
    TestcontainersKafkaTest.stopKafka();
  }
}</code></pre></dd>
</dl>
<!-- NOTE: Can't get this working with paradox..
To see what options are available for configuring testcontainers using `configureKafka` and `configureZooKeeper` in @apidoc[KafkaTestkitTestcontainersSettings] see the API docs for @apidoc[AlpakkaKafkaContainer] and @apidoc[org.testcontainers.containers.GenericContainer]. 
-->
<p>To see what options are available for configuring testcontainers using <code>configureKafka</code> and <code>configureZooKeeper</code> in <span class="group-scala"><a href="/api/alpakka-kafka/5.0.0-M1/akka/kafka/testkit/KafkaTestkitTestcontainersSettings.html" title="akka.kafka.testkit.KafkaTestkitTestcontainersSettings"><code>KafkaTestkitTestcontainersSettings</code></a></span><span class="group-java"><a href="/api/alpakka-kafka/5.0.0-M1/akka/kafka/testkit/KafkaTestkitTestcontainersSettings.html" title="akka.kafka.testkit.KafkaTestkitTestcontainersSettings"><code>KafkaTestkitTestcontainersSettings</code></a></span> see the API docs for <span class="group-scala"><a href="/api/alpakka-kafka/5.0.0-M1/akka/kafka/testkit/internal/AlpakkaKafkaContainer.html" title="akka.kafka.testkit.internal.AlpakkaKafkaContainer"><code>AlpakkaKafkaContainer</code></a></span><span class="group-java"><a href="/api/alpakka-kafka/5.0.0-M1/akka/kafka/testkit/internal/AlpakkaKafkaContainer.html" title="akka.kafka.testkit.internal.AlpakkaKafkaContainer"><code>AlpakkaKafkaContainer</code></a></span> and <a href="https://www.javadoc.io/static/org.testcontainers/testcontainers/1.19.1/org/testcontainers/containers/GenericContainer.html"><code>GenericContainer</code></a>.</p>
<h3><a href="#testing-with-schema-registry" name="testing-with-schema-registry" class="anchor"><span class="anchor-link"></span></a>Testing with Schema Registry</h3>
<p>If you use Confluent&rsquo;s Schema Registry in your client code you may optionally run a Schema Registry container as well. The following snippet demonstrates overriding a test class to use the container, or you can enable it for all tests in your <code>application.conf</code>.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/alpakka-kafka/tree/v5.0.0-M1/tests/src/test/scala/docs/scaladsl/SchemaRegistrySerializationSpec.scala#L38-L223" target="_blank" title="Go to snippet source">source</a><code class="language-scala">class SchemaRegistrySerializationSpec extends DocsSpecBase with TestcontainersKafkaPerClassLike {

  override val testcontainersSettings = KafkaTestkitTestcontainersSettings(system).withSchemaRegistry(true)

  // tests..
}</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/alpakka-kafka/tree/v5.0.0-M1/tests/src/test/java/docs/javadsl/SchemaRegistrySerializationTest.java#L51-L137" target="_blank" title="Go to snippet source">source</a><code class="language-java">public class SchemaRegistrySerializationTest extends TestcontainersKafkaJunit4Test {

  private static final ActorSystem sys = ActorSystem.create(&quot;SchemaRegistrySerializationTest&quot;);
  private static final Executor ec = Executors.newSingleThreadExecutor();

  public SchemaRegistrySerializationTest() {
    super(
        sys,
        KafkaTestkitTestcontainersSettings.create(sys)
            .withInternalTopicsReplicationFactor(1)
            .withSchemaRegistry(true));
  }

}</code></pre></dd>
</dl>
<p>You can retrieve the Schema Registry URL in your test configuration by calling <code>getSchemaRegistryUrl()</code> or <code>schemaRegistryUrl</code>.</p>
<h2><a href="#testing-with-a-docker-kafka-cluster-from-java-code" name="testing-with-a-docker-kafka-cluster-from-java-code" class="anchor"><span class="anchor-link"></span></a>Testing with a Docker Kafka cluster from Java code</h2>
<p>The Alpakka Kafka testkit contains helper classes to start Kafka via Testcontainers. Alternatively, you may use just Testcontainers, as it is designed to be used with JUnit and you can follow <a href="https://www.testcontainers.org/modules/kafka/">their documentation</a> to start and stop Kafka. To start a single instance for many tests see <a href="https://www.testcontainers.org/test_framework_integration/manual_lifecycle_control/">Singleton containers</a>.</p>
<p>The Testcontainers dependency must be added to your project explicitly.</p><dl class="dependency"><dt>Maven</dt><dd><pre class="prettyprint"><code class="language-xml">&lt;dependencies&gt
  &lt;dependency&gt;
    &lt;groupId&gt;org.testcontainers&lt;/groupId&gt;
    &lt;artifactId&gt;kafka&lt;/artifactId&gt;
    &lt;version&gt;1.19.1&lt;/version&gt;
    &lt;scope&gt;test&lt;/scope&gt;
  &lt;/dependency&gt
&lt;/dependencies&gt;</code></pre></dd><dt>sbt</dt><dd><pre class="prettyprint"><code class="language-scala">libraryDependencies += "org.testcontainers" % "kafka" % "1.19.1" % Test</code></pre></dd><dt>Gradle</dt><dd><pre class="prettyprint"><code class="language-gradle">dependencies {
  testImplementation "org.testcontainers:kafka:1.19.1"
}</code></pre></dd></dl>
<p>The example below shows skeleton test classes for JUnit 4 and JUnit 5. The Kafka broker will start before the first test and be stopped after all test classes are finished.</p>
<dl>
  <dt>Java JUnit 4</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/alpakka-kafka/tree/v5.0.0-M1/tests/src/test/java/docs/javadsl/AssignmentTest.java#L16-L214" target="_blank" title="Go to snippet source">source</a><code class="language-java">import akka.kafka.testkit.javadsl.TestcontainersKafkaJunit4Test;
import akka.testkit.javadsl.TestKit;
import org.junit.AfterClass;
import org.junit.Test;

public class AssignmentTest extends TestcontainersKafkaJunit4Test {

  private static final ActorSystem sys = ActorSystem.create(&quot;AssignmentTest&quot;);

  public AssignmentTest() {
    super(sys);
  }

  @AfterClass
  public static void afterClass() {
    TestKit.shutdownActorSystem(sys);
  }
}</code></pre></dd>
  <dt>Java JUnit 5</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/alpakka-kafka/tree/v5.0.0-M1/tests/src/test/java/docs/javadsl/ProducerTest.java#L14-L237" target="_blank" title="Go to snippet source">source</a><code class="language-java">import akka.kafka.testkit.javadsl.TestcontainersKafkaTest;
import akka.testkit.javadsl.TestKit;
import org.junit.jupiter.api.*;
import org.junit.jupiter.api.TestInstance.Lifecycle;
import org.junit.jupiter.api.extension.ExtendWith;

@TestInstance(Lifecycle.PER_CLASS)
class ProducerTest extends TestcontainersKafkaTest {

  private static final ActorSystem system = ActorSystem.create();

  ProducerTest() {
    super(system);
  }

  @AfterAll
  void shutdownActorSystem() {
    TestKit.shutdownActorSystem(system);
  }

}</code></pre></dd>
</dl>
<h2><a href="#testing-with-a-docker-kafka-cluster-from-scala-code" name="testing-with-a-docker-kafka-cluster-from-scala-code" class="anchor"><span class="anchor-link"></span></a>Testing with a Docker Kafka cluster from Scala code</h2>
<p>The Testcontainers dependency must be added to your project explicitly.</p><dl class="dependency"><dt>Maven</dt><dd><pre class="prettyprint"><code class="language-xml">&lt;dependencies&gt
  &lt;dependency&gt;
    &lt;groupId&gt;org.testcontainers&lt;/groupId&gt;
    &lt;artifactId&gt;kafka&lt;/artifactId&gt;
    &lt;version&gt;1.19.1&lt;/version&gt;
    &lt;scope&gt;test&lt;/scope&gt;
  &lt;/dependency&gt
&lt;/dependencies&gt;</code></pre></dd><dt>sbt</dt><dd><pre class="prettyprint"><code class="language-scala">libraryDependencies += "org.testcontainers" % "kafka" % "1.19.1" % Test</code></pre></dd><dt>Gradle</dt><dd><pre class="prettyprint"><code class="language-gradle">dependencies {
  testImplementation "org.testcontainers:kafka:1.19.1"
}</code></pre></dd></dl>
<p>To ensure proper shutdown of all stages in every test, wrap your test code in <span class="group-java"><a href="https://doc.akka.io/japi/akka/2.9/akka/stream/testkit/javadsl/StreamTestKit.html" title="akka.stream.testkit.javadsl.StreamTestKit"><code>assertAllStagesStopped</code></a></span><span class="group-scala"><a href="https://doc.akka.io/api/akka/2.9/akka/stream/testkit/scaladsl/StreamTestKit$.html" title="akka.stream.testkit.scaladsl.StreamTestKit"><code>assertAllStagesStopped</code></a></span>. This may interfere with the <code>stop-timeout</code> which delays shutdown for Alpakka Kafka consumers. You might need to configure a shorter timeout in your <code>application.conf</code> for tests.</p>
<h3><a href="#one-cluster-for-all-tests" name="one-cluster-for-all-tests" class="anchor"><span class="anchor-link"></span></a>One cluster for all tests</h3>
<p>By mixing in <a href="/api/alpakka-kafka/5.0.0-M1/akka/kafka/testkit/scaladsl/TestcontainersKafkaLike.html" title="akka.kafka.testkit.scaladsl.TestcontainersKafkaLike"><code>TestcontainersKafkaLike</code></a> the Kafka Docker cluster will be started before the first test and shut down after all tests are finished.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/alpakka-kafka/tree/v5.0.0-M1/tests/src/test/scala/akka/kafka/scaladsl/SpecBase.scala#L11-L30" target="_blank" title="Go to snippet source">source</a><code class="language-scala">import akka.kafka.testkit.scaladsl.ScalatestKafkaSpec
import org.scalatest.concurrent.{Eventually, IntegrationPatience, ScalaFutures}
import org.scalatest.wordspec.AnyWordSpecLike
import org.scalatest.matchers.should.Matchers

abstract class SpecBase(kafkaPort: Int)
    extends ScalatestKafkaSpec(kafkaPort)
    with AnyWordSpecLike
    with Matchers
    with ScalaFutures
    with Eventually {

  protected def this() = this(kafkaPort = -1)
}

import akka.kafka.testkit.scaladsl.TestcontainersKafkaLike

class TestcontainersSampleSpec extends SpecBase with TestcontainersKafkaLike {
  // ...
}</code></pre></dd>
</dl>
<p>With this <code>TestcontainersSampleSpec</code> class test classes can extend it to automatically start and stop a Kafka broker to test with.</p>
<h3><a href="#one-cluster-per-test-class" name="one-cluster-per-test-class" class="anchor"><span class="anchor-link"></span></a>One cluster per test class</h3>
<p>By mixing in <a href="/api/alpakka-kafka/5.0.0-M1/akka/kafka/testkit/scaladsl/TestcontainersKafkaPerClassLike.html" title="akka.kafka.testkit.scaladsl.TestcontainersKafkaPerClassLike"><code>TestcontainersKafkaPerClassLike</code></a> a specific Kafka Docker cluster will be started for that test class and stopped after its run finished.</p>
</div>
</article>
<div class="row">
<div class="small-12 column">
<section class="nav-prev-next row">
<div class="nav-prev small-6 column">
<a href="testing.html"><i class="icon-prev"></i> <span class="link-prev">Testing</span></a>
</div>
<div class="nav-next small-6 column clearfix">
<a class="float-right" href="production.html">Production considerations <i class="icon-next"></i></a>
</div>
</section>
</div>
</div>
<div class="source-github row">
Found an error in this documentation? The source code for this page can be found <a href="https://github.com/akka/alpakka-kafka/tree/v5.0.0-M1/docs/src/main/paradox/testing-testcontainers.md">here</a>.
Please feel free to edit and contribute a pull request.
</div>

<footer class="page-footer row clearfix">
<img class="akka-icon float-left show-for-medium" src="images/akka-icon.svg" />
<section class="copyright">
<div>Alpakka Kafka is available under the <a href="https://www.lightbend.com/akka/license" target="_blank">Business Source License 1.1</a>.</div>
<p class="legal">
&copy; 2011-2023 <a href="https://www.lightbend.com" target="_blank">Lightbend, Inc.</a> |
<a href="https://www.lightbend.com/legal/licenses" target="_blank">Licenses</a> |
<a href="https://www.lightbend.com/legal/terms" target="_blank">Terms</a> |
<a href="https://www.lightbend.com/legal/privacy" target="_blank">Privacy Policy</a> |
<a href="https://akka.io/cookie/" target="_blank">Cookie Listing</a> |
<a class="optanon-toggle-display">Cookie Settings</a>
</p>
</section>

</footer>
</section>
</main>
</div>

<script type="text/javascript" src="js/scrollsneak.js"></script>
<script type="text/javascript">jQuery(document).foundation();</script>
<script type="text/javascript" src="js/groups.js"></script>
<script type="text/javascript" src="js/page.js"></script>
<script type="text/javascript" src="js/snippets.js"></script>
<script type="text/javascript" src="js/magellan.js"></script>
<script type="text/javascript" src="js/metadata-toggle.js"></script>
<script type="text/javascript" src="js/lbHeader.js"></script>

<style type="text/css">@import "lib/prettify/prettify.css";</style>
<script type="text/javascript" src="lib/prettify/prettify.js"></script>
<script type="text/javascript" src="lib/prettify/lang-scala.js"></script>
<script type="text/javascript">//<![CDATA[
jQuery(function(){window.prettyPrint && prettyPrint()});
//]]></script>
<script type="text/javascript" src="assets/js/warnOldVersion.js"></script>
<script type="text/javascript">jQuery(function(jq){initOldVersionWarnings(jq, '5.0.0-M1', 'https://doc.akka.io/docs/alpakka-kafka/current')});</script>


</body>
</html>
