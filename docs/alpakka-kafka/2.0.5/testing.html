<!DOCTYPE html>
<html class="no-js" lang="en">

<head>
<title>Testing &bull; Alpakka Kafka Documentation</title>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<meta name="description" content="Alpakka Kafka provides a Testkit with support for running local Kafka brokers for integration tests."/>
<link rel="canonical" href="https://doc.akka.io/docs/alpakka-kafka/current/testing.html"/>
<script type="text/javascript" src="lib/jquery/jquery.min.js"></script>
<script type="text/javascript" src="lib/foundation/dist/js/foundation.min.js"></script>
<link rel="stylesheet" type="text/css" href="lib/normalize.css/normalize.css"/>
<link rel="stylesheet" type="text/css" href="lib/foundation/dist/css/foundation.min.css"/>
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.css" />
<link rel="stylesheet" type="text/css" href="css/icons.css"/>
<link rel="stylesheet" type="text/css" href="css/page-7.css"/>
<link rel="stylesheet" type="text/css" href="css/banner-1.css"/>
<link rel="shortcut icon" href="images/favicon.ico" />
<link rel="apple-touch-icon" sizes="180x180" href="images/apple-touch-icon.png"/>
<link rel="icon" type="image/png" sizes="32x32" href="images/favicon-32x32.png"/>
<link rel="icon" type="image/png" sizes="16x16" href="images/favicon-16x16.png"/>
<link rel="manifest" href="images/manifest.json"/>
<meta name="msapplication-TileImage" content="images/mstile-150x150.png"/>
<meta name="msapplication-TileColor" content="#15a9ce"/>
<meta name="theme-color" content="#15a9ce"/>
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>
<!-- OneTrust Cookies Consent Notice (Production Standard, akka.io, en-GB) start -->
<script src="https://optanon.blob.core.windows.net/consent/159bb13d-6748-4399-806e-ac28db879785.js" type="text/javascript" charset="UTF-8"></script>
<script type="text/javascript">
function OptanonWrapper() { }
</script>
<!-- OneTrust Cookies Consent Notice (Production Standard, akka.io, en-GB) end -->
<!--Google Analytics-->
<script type="text/plain" class="optanon-category-2">
var _gaq = _gaq || [];
_gaq.push(['_setAccount', '']);
_gaq.push(['_setDomainName', '']);
_gaq.push(['_trackPageview']);
(function() {
var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})()
</script>
<!-- Google Tag Manager -->
<script type="text/plain" class="optanon-category-2">
(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-KBJGH35');
</script>
<!--Marketo-->
<script type="text/plain" class="optanon-category-3">
(function() {
var didInit = false;
function initMunchkin() {
if(didInit === false) {
didInit = true;
Munchkin.init('558-NCX-702', { 'asyncOnly': true, 'disableClickDelay': true });
}
}
var s = document.createElement('script');
s.type = 'text/javascript';
s.async = true;
s.src = '//munchkin.marketo.net/munchkin.js';
s.onreadystatechange = function() {
if (this.readyState == 'complete' || this.readyState == 'loaded') {
initMunchkin();
}
};
s.onload = initMunchkin;
document.getElementsByTagName('head')[0].appendChild(s);
})();
</script>
</head>

<body id="underlay" data-toggler="nav-open">
<div id="lightbend-banner" class="lightbend-banner akka full-width" data-category="OSS Lightbend Banner Impression" data-label="Akka Banner Impression">
<div class="wrapper">
<div class="brand">
<a class="oss-track-link-label" data-category="OSS Lightbend Banner Clicks" data-label="Lightbend Logo - Akka Banner" href="https://www.lightbend.com?r=oss-banner-akka" target="_blank">
<img class="lightbend-logo" src="images/banner-logos/lightbend-reverse.svg" alt="Lightbend" title="Lightbend">
</a>
</div>
<div class="nav">
<a class="banner-btn oss-track-link-label" data-category="OSS Lightbend Banner Clicks" data-label="Enhance your Akka systems with Akka Platform [Button] - Akka Banner" href="https://www.lightbend.com/akka-platform?r=oss-banner-akka" target="_blank">
<span>Enhance your Akka systems with</span>
<img class="akka-platform-reverse-logo" src="images/banner-logos/akka-platform-reverse.svg" alt="Akka Platform" title="Akka Platform">
</a>
<div class="drop-down">
<svg class="svg-chevon-circle-down" version="1.1" id="Chevron_circled_down" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 20 20" enable-background="new 0 0 20 20" xml:space="preserve">
<path fill="#ffffff" d="M12.505,8.698L10,11L7.494,8.698c-0.198-0.196-0.518-0.196-0.718,0c-0.197,0.196-0.197,0.515,0,0.71l2.864,2.807
c0.199,0.196,0.52,0.196,0.717,0l2.864-2.807c0.199-0.195,0.198-0.514,0-0.71C13.024,8.502,12.704,8.502,12.505,8.698z M10,0.4
c-5.302,0-9.6,4.298-9.6,9.6c0,5.303,4.298,9.6,9.6,9.6s9.6-4.297,9.6-9.6C19.6,4.698,15.302,0.4,10,0.4z M10,18.354
c-4.615,0-8.354-3.74-8.354-8.354c0-4.614,3.739-8.354,8.354-8.354c4.613,0,8.354,3.74,8.354,8.354
C18.354,14.614,14.613,18.354,10,18.354z" />
</svg>
<div class="drop-down-content">
<div class="lightbend-family">
<a href="https://cloudflow.io" class="cloudflow oss-track-link-label" data-category="OSS Lightbend Banner Clicks" data-label="Cloudflow - Logo Tag Line - Akka Banner">
<img class="cloudflow-full-color-logo" src="images/banner-logos/cloudflow-full-color.svg" alt="Cloudflow by Lightbend" title="Cloudflow by Lightbend">
</a>
<a href="https://cloudstate.io" class="cloudstate oss-track-link-label" data-category="OSS Lightbend Banner Clicks" data-label="Cloudstate - Logo Tag Line - Akka Banner">
<img class="cloudstate-full-color-logo" src="images/banner-logos/cloudstate-full-color.svg" alt="Cloudstate by Lightbend" title="Cloudstate by Lightbend">
</a>
<a href="https://www.lagomframework.com" class="lagom oss-track-link-label" data-category="OSS Lightbend Banner Clicks" data-label="Lagom - Logo Tag Line - Akka Banner">
<img class="lagom-full-color-logo" src="images/banner-logos/lagom-full-color.svg" alt="Lagom Framework by Lightbend" title="Lagom Framework by Lightbend">
</a>
<a href="https://www.playframework.com" class="play oss-track-link-label" data-category="OSS Lightbend Banner Clicks" data-label="Play - Logo Tag Line - Akka Banner">
<img class="play-full-color-logo" src="images/banner-logos/play-full-color.svg" alt="Play Framework by Lightbend" title="Play Framework by Lightbend">
</a>
<a href="https://www.scala-lang.org" class="scala oss-track-link-label" data-category="OSS Lightbend Banner Clicks" data-label="Scala - Logo Tag Line - Akka Banner">
<img class="scala-full-color-logo" src="images/banner-logos/scala-full-color.svg" alt="Scala by Lightbend" title="Scala by Lightbend">
</a>
<div class="akka current">
<img class="akka-full-color-logo" src="images/banner-logos/akka-full-color.svg" alt="Akka by Lightbend" title="Akka by Lightbend">
<span>From the creators of <strong>Akka</strong>, get technology enhancements, monitoring, and expert support with Akka Platform from Lightbend.</span>
<a class="oss-track-link-label" data-category="OSS Lightbend Banner Clicks" data-label="Learn More [Button] - Akka Banner" href="https://www.lightbend.com/akka-platform?r=oss-banner-akka" target="_blank">Learn More</a>
</div>
</div>
<div class="title">The Lightbend Family</div>
</div>      
</div>
</div>
</div>
</div>

<header class="site-header hide-for-large">
<div class="sticky-header clearfix">
<a href="https://akka.io"><img class="logo" src="images/akka-alpakka-reverse.svg"></a>

<button class="menu-icon float-right" type="button" data-toggle="underlay overlay"></button>
</div>
<div id="overlay" class="overlay-nav" data-toggler="nav-open">
<header class="nav-header">
<div class="nav-header-title">
<h1><a href="index.html">Alpakka Kafka Documentation</a></h1>
</div>
<div class="nav-header-version">
Version 2.0.5
</div>
<div class="nav-header-groups">
<select class="supergroup" name="Language"><option class="group" value="group-java">Java</option><option class="group" value="group-scala">Scala</option></select>
</div>
</header>
<nav class="nav-toc">
<ul>
  <li><a href="home.html" class="page">Overview</a></li>
  <li><a href="producer.html" class="page">Producer</a></li>
  <li><a href="consumer.html" class="page">Consumer</a></li>
  <li><a href="discovery.html" class="page">Service discovery</a></li>
  <li><a href="cluster-sharding.html" class="page">Akka Cluster Sharding</a></li>
  <li><a href="errorhandling.html" class="page">Error handling</a></li>
  <li><a href="atleastonce.html" class="page">At-Least-Once Delivery</a></li>
  <li><a href="transactions.html" class="page">Transactions</a></li>
  <li><a href="serialization.html" class="page">Serialization</a></li>
  <li><a href="debugging.html" class="page">Debugging</a></li>
  <li><a href="testing.html#testing" class="active page">Testing</a>
  <ul>
    <li><a href="testing.html#running-kafka-with-your-tests" class="header">Running Kafka with your tests</a></li>
    <li><a href="testing.html#testing-with-an-embedded-kafka-server" class="header">Testing with an embedded Kafka server</a></li>
    <li><a href="testing.html#alternative-testing-libraries" class="header">Alternative testing libraries</a></li>
    <li><a href="testing.html#mocking-the-consumer-or-producer" class="header">Mocking the Consumer or Producer</a></li>
    <li><a href="testing-testcontainers.html" class="page">Testing with a Docker Kafka cluster</a></li>
  </ul></li>
  <li><a href="production.html" class="page">Production considerations</a></li>
  <li><a href="snapshots.html" class="page">Snapshots</a></li>
</ul>
</nav>
</div>
</header>
<div class="site-content-wrapper">
<aside class="sticky-sidebar show-for-large">
<header class="nav-header sticky-sidebar-header">
<div class="nav-header-title">
<h1><a href="index.html">Alpakka Kafka Documentation</a></h1>
</div>
<div class="nav-header-version">
Version 2.0.5
</div>
<div class="nav-header-groups">
<select class="supergroup" name="Language"><option class="group" value="group-java">Java</option><option class="group" value="group-scala">Scala</option></select>
</div>
</header>
<nav class="site-nav sticky-sidebar-contents">
<div class="nav-toc">
<ul>
  <li><a href="home.html" class="page">Overview</a></li>
  <li><a href="producer.html" class="page">Producer</a></li>
  <li><a href="consumer.html" class="page">Consumer</a></li>
  <li><a href="discovery.html" class="page">Service discovery</a></li>
  <li><a href="cluster-sharding.html" class="page">Akka Cluster Sharding</a></li>
  <li><a href="errorhandling.html" class="page">Error handling</a></li>
  <li><a href="atleastonce.html" class="page">At-Least-Once Delivery</a></li>
  <li><a href="transactions.html" class="page">Transactions</a></li>
  <li><a href="serialization.html" class="page">Serialization</a></li>
  <li><a href="debugging.html" class="page">Debugging</a></li>
  <li><a href="testing.html#testing" class="active page">Testing</a>
  <ul>
    <li><a href="testing.html#running-kafka-with-your-tests" class="header">Running Kafka with your tests</a></li>
    <li><a href="testing.html#testing-with-an-embedded-kafka-server" class="header">Testing with an embedded Kafka server</a></li>
    <li><a href="testing.html#alternative-testing-libraries" class="header">Alternative testing libraries</a></li>
    <li><a href="testing.html#mocking-the-consumer-or-producer" class="header">Mocking the Consumer or Producer</a></li>
    <li><a href="testing-testcontainers.html" class="page">Testing with a Docker Kafka cluster</a></li>
  </ul></li>
  <li><a href="production.html" class="page">Production considerations</a></li>
  <li><a href="snapshots.html" class="page">Snapshots</a></li>
</ul>
</div>
</nav>
<footer class="nav-footer sticky-sidebar-footer">
<a href="https://akka.io"><img class="logo" src="images/akka-alpakka-reverse.svg"></a>

</footer>
</aside>
<main class="fixed-shift-for-large expanded row">
<section class="site-content small-12 column">
<article class="page-content row">
<div class="small-12 column" id="docs">
<h1><a href="#testing" name="testing" class="anchor"><span class="anchor-link"></span></a>Testing</h1>
<p>To simplify testing of streaming integrations with Alpakka Kafka, it provides the <strong>Alpakka Kafka testkit</strong>. It provides help for</p><div class="callout note "><div class="callout-title">Note</div>
<p><strong>Embedded Kafka testkit support has been deprecated since 2.0.4 and will be removed in the next minor release.</strong></p>
<p><strong>Use <a href="testing-testcontainers.html">testcontainers (Docker)</a> instead.</strong></p></div>
<ul>
  <li><del><a href="testing.html#testing-with-an-embedded-kafka-server">Using an embedded Kafka broker</a></del></li>
  <li><a href="testing-testcontainers.html">Using Docker to launch a local Kafka cluster with testcontainers</a></li>
  <li><a href="testing.html#mocking-the-consumer-or-producer">Mocking the Alpakka Kafka Consumers and Producers</a></li>
</ul>
<table class="project-info">
<tr><th colspan="2">Project Info: Alpakka Kafka testkit</th></tr>
  <tr><th>Artifact</th><td><div>com.typesafe.akka</div>
  <div>akka-stream-kafka-testkit</div>
  <div>2.0.5</div>
  <div><a href="snapshots.html">Snapshots are available</a></div>
  </td></tr>
  <tr><th>JDK versions</th><td><div>Adopt OpenJDK 8 with Hotspot</div><div>Adopt OpenJDK 11 with Hotspot</div></td></tr>
  <tr><th>Scala versions</th><td>2.12.10, 2.11.12, 2.13.1</td></tr>
  <tr><th>JPMS module name</th><td>akka.stream.alpakka.kafka.testkit</td></tr>
  <tr><th>License</th><td><div><a href="http://opensource.org/licenses/Apache-2.0" target="_blank" rel="noopener noreferrer">Apache-2.0</a></div>
  </td></tr>
  <tr><th>Readiness level</th><td><div class="readiness-level"><a href="https://developer.lightbend.com/docs/introduction/getting-help/support-terminology.html#incubating" target="_blank" rel="noopener">Incubating</a></div>
  <div>Since 1.0-M1, 2018-11-06</div>
  <div>Note: The API of the testkit may change even for minor versions.</div>
  </td></tr>
  <tr><th>Home page</th><td><a href="https://doc.akka.io/docs/alpakka-kafka/current">https://doc.akka.io/docs/alpakka-kafka/current</a></td></tr>
  <tr><th>Forums</th><td>
  <div><a href="https://discuss.lightbend.com/c/akka/streams-and-alpakka" target="_blank" rel="noopener noreferrer">Lightbend Discuss</a></div>
  <div><a href="https://gitter.im/akka/alpakka-kafka" target="_blank" rel="noopener noreferrer">akka/alpakka-kafka Gitter channel</a></div>
  </td></tr>
  <tr><th>Release notes</th><td><a href="https://doc.akka.io/docs/alpakka-kafka/current/release-notes/index.html">In the documentation</a></td></tr>
  <tr><th>Issues</th><td><a href="https://github.com/akka/alpakka-kafka/issues" target="_blank" rel="noopener noreferrer">Github issues</a></td></tr>
  <tr><th>Sources</th><td><a href="https://github.com/akka/alpakka-kafka" target="_blank" rel="noopener noreferrer">https://github.com/akka/alpakka-kafka</a></td></tr>
</table>
<dl class="dependency"><dt>Maven</dt><dd><pre class="prettyprint"><code class="language-xml">&lt;properties&gt;
  &lt;akka.version&gt;2.5.31&lt;/akka.version&gt;
  &lt;scala.binary.version&gt;2.13&lt;/scala.binary.version&gt;
&lt;/properties&gt;
&lt;dependency&gt;
  &lt;groupId&gt;com.typesafe.akka&lt;/groupId&gt;
  &lt;artifactId&gt;akka-stream-kafka-testkit_${scala.binary.version}&lt;/artifactId&gt;
  &lt;version&gt;2.0.5&lt;/version&gt;
  &lt;scope&gt;test&lt;/scope&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
  &lt;groupId&gt;com.typesafe.akka&lt;/groupId&gt;
  &lt;artifactId&gt;akka-stream-testkit_${scala.binary.version}&lt;/artifactId&gt;
  &lt;version&gt;${akka.version}&lt;/version&gt;
  &lt;scope&gt;test&lt;/scope&gt;
&lt;/dependency&gt;</code></pre></dd><dt>sbt</dt><dd><pre class="prettyprint"><code class="language-scala">val AkkaVersion = "2.5.31"
libraryDependencies ++= Seq(
  "com.typesafe.akka" %% "akka-stream-kafka-testkit" % "2.0.5" % Test,
  "com.typesafe.akka" %% "akka-stream-testkit" % AkkaVersion % Test
)</code></pre></dd><dt>Gradle</dt><dd><pre class="prettyprint"><code class="language-gradle">versions += [
  AkkaVersion: "2.5.31",
  ScalaBinary: "2.13"
]
dependencies {
  test group: 'com.typesafe.akka', name: "akka-stream-kafka-testkit_${versions.ScalaBinary}", version: '2.0.5',
  test group: 'com.typesafe.akka', name: "akka-stream-testkit_${versions.ScalaBinary}", version: versions.AkkaVersion
}</code></pre></dd></dl>
<p>Note that Akka testkits do not promise binary compatibility. The API might be changed even between patch releases.</p>
<p>The table below shows Alpakka Kafka testkit&rsquo;s direct dependencies and the second tab shows all libraries it depends on transitively. We&rsquo;ve overriden the <code>commons-compress</code> library to use a version with <a href="https://commons.apache.org/proper/commons-compress/security-reports.html">fewer known security vulnerabilities</a>.</p>
<dl class="dependencies"><dt>Direct dependencies</dt><dd><table>
  <thead><tr><th>Organization</th><th>Artifact</th><th>Version</th></thead>
  <tbody>
    <tr><td>com.typesafe.akka</td><td>akka-stream-kafka_2.13</td><td><a href="https://mvnrepository.com/artifact/com.typesafe.akka/akka-stream-kafka_2.13/2.0.5" target="_blank">2.0.5</a></td></tr>
    <tr><td>com.typesafe.akka</td><td>akka-stream-testkit_2.13</td><td><a href="https://mvnrepository.com/artifact/com.typesafe.akka/akka-stream-testkit_2.13/2.5.31" target="_blank">2.5.31</a></td></tr>
    <tr><td>org.scala-lang</td><td>scala-library</td><td><a href="https://mvnrepository.com/artifact/org.scala-lang/scala-library/2.13.1" target="_blank">2.13.1</a></td></tr>
  </tbody>
</table></dd>
<dt>Dependency tree</dt><dd><pre>
com.typesafe.akka    akka-stream-kafka_2.13    <a href="https://mvnrepository.com/artifact/com.typesafe.akka/akka-stream-kafka_2.13/2.0.5" target="_blank">2.0.5</a>
    com.typesafe.akka    akka-stream_2.13    <a href="https://mvnrepository.com/artifact/com.typesafe.akka/akka-stream_2.13/2.5.31" target="_blank">2.5.31</a>
        com.typesafe.akka    akka-actor_2.13    <a href="https://mvnrepository.com/artifact/com.typesafe.akka/akka-actor_2.13/2.5.31" target="_blank">2.5.31</a>
            com.typesafe    config    <a href="https://mvnrepository.com/artifact/com.typesafe/config/1.3.3" target="_blank">1.3.3</a>
            org.scala-lang.modules    scala-java8-compat_2.13    <a href="https://mvnrepository.com/artifact/org.scala-lang.modules/scala-java8-compat_2.13/0.9.0" target="_blank">0.9.0</a>
                org.scala-lang    scala-library    <a href="https://mvnrepository.com/artifact/org.scala-lang/scala-library/2.13.1" target="_blank">2.13.1</a>
            org.scala-lang    scala-library    <a href="https://mvnrepository.com/artifact/org.scala-lang/scala-library/2.13.1" target="_blank">2.13.1</a>
        com.typesafe.akka    akka-protobuf_2.13    <a href="https://mvnrepository.com/artifact/com.typesafe.akka/akka-protobuf_2.13/2.5.31" target="_blank">2.5.31</a>
            org.scala-lang    scala-library    <a href="https://mvnrepository.com/artifact/org.scala-lang/scala-library/2.13.1" target="_blank">2.13.1</a>
        com.typesafe    ssl-config-core_2.13    <a href="https://mvnrepository.com/artifact/com.typesafe/ssl-config-core_2.13/0.3.8" target="_blank">0.3.8</a>
            com.typesafe    config    <a href="https://mvnrepository.com/artifact/com.typesafe/config/1.3.3" target="_blank">1.3.3</a>
            org.scala-lang.modules    scala-parser-combinators_2.13    <a href="https://mvnrepository.com/artifact/org.scala-lang.modules/scala-parser-combinators_2.13/1.1.2" target="_blank">1.1.2</a>
                org.scala-lang    scala-library    <a href="https://mvnrepository.com/artifact/org.scala-lang/scala-library/2.13.1" target="_blank">2.13.1</a>
            org.scala-lang    scala-library    <a href="https://mvnrepository.com/artifact/org.scala-lang/scala-library/2.13.1" target="_blank">2.13.1</a>
        org.reactivestreams    reactive-streams    <a href="https://mvnrepository.com/artifact/org.reactivestreams/reactive-streams/1.0.2" target="_blank">1.0.2</a>
        org.scala-lang    scala-library    <a href="https://mvnrepository.com/artifact/org.scala-lang/scala-library/2.13.1" target="_blank">2.13.1</a>
    org.apache.kafka    kafka-clients    <a href="https://mvnrepository.com/artifact/org.apache.kafka/kafka-clients/2.4.1" target="_blank">2.4.1</a>
        com.github.luben    zstd-jni    <a href="https://mvnrepository.com/artifact/com.github.luben/zstd-jni/1.4.3-1" target="_blank">1.4.3-1</a>
        org.lz4    lz4-java    <a href="https://mvnrepository.com/artifact/org.lz4/lz4-java/1.6.0" target="_blank">1.6.0</a>
        org.slf4j    slf4j-api    <a href="https://mvnrepository.com/artifact/org.slf4j/slf4j-api/1.7.30" target="_blank">1.7.30</a>
        org.xerial.snappy    snappy-java    <a href="https://mvnrepository.com/artifact/org.xerial.snappy/snappy-java/1.1.7.3" target="_blank">1.1.7.3</a>
    org.scala-lang.modules    scala-collection-compat_2.13    <a href="https://mvnrepository.com/artifact/org.scala-lang.modules/scala-collection-compat_2.13/2.1.6" target="_blank">2.1.6</a>
        org.scala-lang    scala-library    <a href="https://mvnrepository.com/artifact/org.scala-lang/scala-library/2.13.1" target="_blank">2.13.1</a>
    org.scala-lang    scala-library    <a href="https://mvnrepository.com/artifact/org.scala-lang/scala-library/2.13.1" target="_blank">2.13.1</a>
com.typesafe.akka    akka-stream-testkit_2.13    <a href="https://mvnrepository.com/artifact/com.typesafe.akka/akka-stream-testkit_2.13/2.5.31" target="_blank">2.5.31</a>
    com.typesafe.akka    akka-stream_2.13    <a href="https://mvnrepository.com/artifact/com.typesafe.akka/akka-stream_2.13/2.5.31" target="_blank">2.5.31</a>
        com.typesafe.akka    akka-actor_2.13    <a href="https://mvnrepository.com/artifact/com.typesafe.akka/akka-actor_2.13/2.5.31" target="_blank">2.5.31</a>
            com.typesafe    config    <a href="https://mvnrepository.com/artifact/com.typesafe/config/1.3.3" target="_blank">1.3.3</a>
            org.scala-lang.modules    scala-java8-compat_2.13    <a href="https://mvnrepository.com/artifact/org.scala-lang.modules/scala-java8-compat_2.13/0.9.0" target="_blank">0.9.0</a>
                org.scala-lang    scala-library    <a href="https://mvnrepository.com/artifact/org.scala-lang/scala-library/2.13.1" target="_blank">2.13.1</a>
            org.scala-lang    scala-library    <a href="https://mvnrepository.com/artifact/org.scala-lang/scala-library/2.13.1" target="_blank">2.13.1</a>
        com.typesafe.akka    akka-protobuf_2.13    <a href="https://mvnrepository.com/artifact/com.typesafe.akka/akka-protobuf_2.13/2.5.31" target="_blank">2.5.31</a>
            org.scala-lang    scala-library    <a href="https://mvnrepository.com/artifact/org.scala-lang/scala-library/2.13.1" target="_blank">2.13.1</a>
        com.typesafe    ssl-config-core_2.13    <a href="https://mvnrepository.com/artifact/com.typesafe/ssl-config-core_2.13/0.3.8" target="_blank">0.3.8</a>
            com.typesafe    config    <a href="https://mvnrepository.com/artifact/com.typesafe/config/1.3.3" target="_blank">1.3.3</a>
            org.scala-lang.modules    scala-parser-combinators_2.13    <a href="https://mvnrepository.com/artifact/org.scala-lang.modules/scala-parser-combinators_2.13/1.1.2" target="_blank">1.1.2</a>
                org.scala-lang    scala-library    <a href="https://mvnrepository.com/artifact/org.scala-lang/scala-library/2.13.1" target="_blank">2.13.1</a>
            org.scala-lang    scala-library    <a href="https://mvnrepository.com/artifact/org.scala-lang/scala-library/2.13.1" target="_blank">2.13.1</a>
        org.reactivestreams    reactive-streams    <a href="https://mvnrepository.com/artifact/org.reactivestreams/reactive-streams/1.0.2" target="_blank">1.0.2</a>
        org.scala-lang    scala-library    <a href="https://mvnrepository.com/artifact/org.scala-lang/scala-library/2.13.1" target="_blank">2.13.1</a>
    com.typesafe.akka    akka-testkit_2.13    <a href="https://mvnrepository.com/artifact/com.typesafe.akka/akka-testkit_2.13/2.5.31" target="_blank">2.5.31</a>
        com.typesafe.akka    akka-actor_2.13    <a href="https://mvnrepository.com/artifact/com.typesafe.akka/akka-actor_2.13/2.5.31" target="_blank">2.5.31</a>
            com.typesafe    config    <a href="https://mvnrepository.com/artifact/com.typesafe/config/1.3.3" target="_blank">1.3.3</a>
            org.scala-lang.modules    scala-java8-compat_2.13    <a href="https://mvnrepository.com/artifact/org.scala-lang.modules/scala-java8-compat_2.13/0.9.0" target="_blank">0.9.0</a>
                org.scala-lang    scala-library    <a href="https://mvnrepository.com/artifact/org.scala-lang/scala-library/2.13.1" target="_blank">2.13.1</a>
            org.scala-lang    scala-library    <a href="https://mvnrepository.com/artifact/org.scala-lang/scala-library/2.13.1" target="_blank">2.13.1</a>
        org.scala-lang    scala-library    <a href="https://mvnrepository.com/artifact/org.scala-lang/scala-library/2.13.1" target="_blank">2.13.1</a>
    org.scala-lang    scala-library    <a href="https://mvnrepository.com/artifact/org.scala-lang/scala-library/2.13.1" target="_blank">2.13.1</a>
org.scala-lang    scala-library    <a href="https://mvnrepository.com/artifact/org.scala-lang/scala-library/2.13.1" target="_blank">2.13.1</a></pre></dd>
</dl>

<h2><a href="#running-kafka-with-your-tests" name="running-kafka-with-your-tests" class="anchor"><span class="anchor-link"></span></a>Running Kafka with your tests</h2>
<div class="callout note "><div class="callout-title">Note</div>
<p><strong>Embedded Kafka testkit support has been deprecated since 2.0.4</strong></p></div>
<p>The Testkit provides a variety of ways to test your application against a real Kafka broker or cluster. There are two main options:</p>
<ol>
  <li><del><a href="testing.html#testing-with-an-embedded-kafka-server">Embedded Kafka</a></del></li>
  <li><a href="testing-testcontainers.html">Testcontainers (Docker)</a></li>
</ol>
<p>The table below helps guide you to the right Testkit implementation depending on your programming language, testing framework, and use (or not) of Docker containers. You must mix in or implement these types into your test classes to use them. See the documentation for each for more details.</p>
<table>
  <thead>
    <tr>
      <th>Type </th>
      <th>Test Framework </th>
      <th>Runtime Mode </th>
      <th>Cluster </th>
      <th>Schema Registry </th>
      <th>Lang </th>
      <th>Lifetime </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><del><a href="testing.html#testing-with-avro-and-schema-registry-from-java-code"><code>akka.kafka.testkit.javadsl.EmbeddedKafkaTest</code></a></del> </td>
      <td><del>JUnit 5</del> </td>
      <td><del>Embedded Kafka</del> </td>
      <td><del>No</del> </td>
      <td><del>Yes</del> </td>
      <td><del>Java</del> </td>
      <td><del>All tests, Per class</del> </td>
    </tr>
    <tr>
      <td><del><a href="testing.html#testing-with-avro-and-schema-registry-from-java-code"><code>akka.kafka.testkit.javadsl.EmbeddedKafkaJunit4Test</code></a></del> </td>
      <td><del>JUnit 4</del> </td>
      <td><del>Embedded Kafka</del> </td>
      <td><del>No</del> </td>
      <td><del>Yes</del> </td>
      <td><del>Java</del> </td>
      <td><del>All tests, Per class</del> </td>
    </tr>
    <tr>
      <td><del><a href="testing.html#testing-with-avro-and-schema-registry-from-scala-code"><code>akka.kafka.testkit.scaladsl.EmbeddedKafkaLike</code></a></del> </td>
      <td><del>ScalaTest</del> </td>
      <td><del>Embedded Kafka</del> </td>
      <td><del>No</del> </td>
      <td><del>Yes</del> </td>
      <td><del>Scala</del> </td>
      <td><del>Per class</del> </td>
    </tr>
    <tr>
      <td><a href="testing-testcontainers.html#testing-with-a-docker-kafka-cluster-from-java-code"><code>akka.kafka.testkit.javadsl.TestcontainersKafkaJunit4Test</code></a> </td>
      <td>JUnit 5 </td>
      <td>Testcontainers </td>
      <td>Yes </td>
      <td>Yes </td>
      <td>Java </td>
      <td>All tests, Per class </td>
    </tr>
    <tr>
      <td><a href="testing-testcontainers.html#testing-with-a-docker-kafka-cluster-from-java-code"><code>akka.kafka.testkit.javadsl.TestcontainersKafkaTest</code></a> </td>
      <td>JUnit 4 </td>
      <td>Testcontainers </td>
      <td>Yes </td>
      <td>Yes </td>
      <td>Java </td>
      <td>All tests, Per class </td>
    </tr>
    <tr>
      <td><a href="testing-testcontainers.html#testing-with-a-docker-kafka-cluster-from-scala-code"><code>akka.kafka.testkit.scaladsl.TestcontainersKafkaLike</code></a> </td>
      <td>ScalaTest </td>
      <td>Testcontainers </td>
      <td>Yes </td>
      <td>Yes </td>
      <td>Scala </td>
      <td>All tests </td>
    </tr>
    <tr>
      <td><a href="testing-testcontainers.html#testing-with-a-docker-kafka-cluster-from-scala-code"><code>akka.kafka.testkit.scaladsl.TestcontainersKafkaPerClassLike</code></a> </td>
      <td>ScalaTest </td>
      <td>Testcontainers </td>
      <td>Yes </td>
      <td>Yes </td>
      <td>Scala </td>
      <td>Per class </td>
    </tr>
  </tbody>
</table>
<h2><a href="#testing-with-an-embedded-kafka-server" name="testing-with-an-embedded-kafka-server" class="anchor"><span class="anchor-link"></span></a>Testing with an embedded Kafka server</h2><div class="callout note "><div class="callout-title">Note</div>
<p><strong>Embedded Kafka testkit support has been deprecated since 2.0.4</strong></p></div>
<p>To test the Alpakka Kafka connector the <a href="https://github.com/embeddedkafka/embedded-kafka">Embedded Kafka library</a> is an important tool as it helps to easily start and stop Kafka brokers from test cases.</p>
<p>Add the Embedded Kafka to your test dependencies:</p><dl class="dependency"><dt>Maven</dt><dd><pre class="prettyprint"><code class="language-xml">&lt;dependency&gt;
  &lt;groupId&gt;io.github.embeddedkafka&lt;/groupId&gt;
  &lt;artifactId&gt;embedded-kafka_2.12&lt;/artifactId&gt;
  &lt;version&gt;2.4.1.1&lt;/version&gt;
  &lt;scope&gt;test&lt;/scope&gt;
&lt;/dependency&gt;</code></pre></dd><dt>sbt</dt><dd><pre class="prettyprint"><code class="language-scala">libraryDependencies += "io.github.embeddedkafka" % "embedded-kafka_2.12" % "2.4.1.1" % Test</code></pre></dd><dt>Gradle</dt><dd><pre class="prettyprint"><code class="language-gradle">dependencies {
  test group: 'io.github.embeddedkafka', name: 'embedded-kafka_2.12', version: '2.4.1.1'
}</code></pre></dd></dl><div class="callout note "><div class="callout-title">Note</div>
<p>As Kafka uses Scala internally, only the Scala versions supported by Kafka can be used together with Embedded Kafka. To be independent of Kafka&rsquo;s supported Scala versions, run <a href="testing-testcontainers.html">Kafka in a Docker container</a>.</p>
<p>The helpers for running Embedded Kafka are available for <strong>Scala 2.11 and 2.12</strong>.</p></div>
<p>The testkit contains helper classes used by the tests in the Alpakka Kafka connector and may be used for other testing, as well.</p>
<h3><a href="#testing-with-avro-and-schema-registry" name="testing-with-avro-and-schema-registry" class="anchor"><span class="anchor-link"></span></a>Testing with Avro and Schema Registry</h3><div class="callout note "><div class="callout-title">Note</div>
<p><strong>Embedded Kafka testkit support has been deprecated since 2.0.4</strong></p></div>
<p>If you need to run tests using <a href="https://docs.confluent.io/current/schema-registry/docs/index.html">Confluent&rsquo;s Schema Registry</a>, you might include <a href="https://github.com/embeddedkafka/embedded-kafka-schema-registry">embedded-kafka-schema-registry</a> instead.</p>
<h3><a href="#testing-with-avro-and-schema-registry-from-java-code" name="testing-with-avro-and-schema-registry-from-java-code" class="anchor"><span class="anchor-link"></span></a>Testing with Avro and Schema Registry from Java code</h3><div class="callout note "><div class="callout-title">Note</div>
<p><strong>Embedded Kafka testkit support has been deprecated since 2.0.4</strong></p></div>
<p>Test classes may extend <a href="/api/alpakka-kafka/2.0.5/akka/kafka/testkit/javadsl/EmbeddedKafkaTest.html" title="akka.kafka.testkit.javadsl.EmbeddedKafkaTest"><code>EmbeddedKafkaTest</code></a> (JUnit 5) or <a href="/api/alpakka-kafka/2.0.5/akka/kafka/testkit/javadsl/EmbeddedKafkaJunit4Test.html" title="akka.kafka.testkit.javadsl.EmbeddedKafkaJunit4Test"><code>EmbeddedKafkaJunit4Test</code></a> (JUnit 4) to automatically start and stop an embedded Kafka broker.</p>
<p>Furthermore it provides</p>
<ul>
  <li>preconfigured consumer settings (<code>ConsumerSettings&lt;String, String&gt; consumerDefaults</code>),</li>
  <li>preconfigured producer settings (<code>ProducerSettings&lt;String, String&gt; producerDefaults</code>),</li>
  <li>unique topic creation (<code>createTopic(int number, int partitions, int replication)</code>), and</li>
  <li><code>CompletionStage</code> value extraction helper (<code>&lt;T&gt; T resultOf(CompletionStage&lt;T&gt; stage, java.time.Duration timeout)</code>).</li>
</ul>
<p>The example below shows skeleton test classes for JUnit 4 and JUnit 5.</p>
<dl>
  <dt>Java JUnit 4</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/alpakka-kafka/tree/v2.0.5/tests/src/test/java/docs/javadsl/AssignmentTest.java#L17-L218" target="_blank" title="Go to snippet source"></a><code class="language-java">import akka.kafka.testkit.javadsl.EmbeddedKafkaJunit4Test;
import akka.testkit.javadsl.TestKit;
import org.junit.AfterClass;
import org.junit.Rule;
import org.junit.Test;
public class AssignmentTest extends EmbeddedKafkaJunit4Test {

  @Rule public final LogCapturingJunit4 logCapturing = new LogCapturingJunit4();

  private static final ActorSystem sys = ActorSystem.create(&quot;AssignmentTest&quot;);
  private static final Materializer mat = ActorMaterializer.create(sys);

  public AssignmentTest() {
    super(sys, mat, KafkaPorts.AssignmentTest());
  }

  @AfterClass
  public static void afterClass() {
    TestKit.shutdownActorSystem(sys);
  }
}</code></pre></dd>
  <dt>Java JUnit 5</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/alpakka-kafka/tree/v2.0.5/tests/src/test/java/docs/javadsl/ProducerExampleTest.java#L14-L84" target="_blank" title="Go to snippet source"></a><code class="language-java">import akka.kafka.testkit.javadsl.EmbeddedKafkaTest;
import akka.testkit.javadsl.TestKit;
import org.junit.jupiter.api.*;
import org.junit.jupiter.api.TestInstance.Lifecycle;
import org.junit.jupiter.api.extension.ExtendWith;

@TestInstance(Lifecycle.PER_CLASS)
class ProducerExampleTest extends EmbeddedKafkaTest {

  private static final ActorSystem system = ActorSystem.create(&quot;ProducerExampleTest&quot;);
  private static final Materializer materializer = ActorMaterializer.create(system);

  ProducerExampleTest() {
    super(system, materializer, KafkaPorts.ProducerExamplesTest());
  }

  @AfterAll
  void shutdownActorSystem() {
    TestKit.shutdownActorSystem(system);
    executor.shutdown();
  }

}</code></pre></dd>
</dl>
<p>The JUnit test base classes run the <a href="https://doc.akka.io/japi/akka/2.5/akka/stream/testkit/javadsl/StreamTestKit.html#assertAllStagesStopped(akka.stream.Materializer)" title="akka.stream.testkit.javadsl.StreamTestKit"><code>assertAllStagesStopped</code></a> check from Akka Stream testkit to ensure all stages are shut down properly within each test. This may interfere with the <code>stop-timeout</code> which delays shutdown for Alpakka Kafka consumers. You might need to configure a shorter timeout in your <code>application.conf</code> for tests.</p>
<h3><a href="#testing-with-avro-and-schema-registry-from-scala-code" name="testing-with-avro-and-schema-registry-from-scala-code" class="anchor"><span class="anchor-link"></span></a>Testing with Avro and Schema Registry from Scala code</h3><div class="callout note "><div class="callout-title">Note</div>
<p><strong>Embedded Kafka testkit support has been deprecated since 2.0.4</strong></p></div>
<p>The <a href="/api/alpakka-kafka/2.0.5/akka/kafka/testkit/scaladsl/KafkaSpec.html" title="akka.kafka.testkit.scaladsl.KafkaSpec"><code>KafkaSpec</code></a> class offers access to </p>
<ul>
  <li>preconfigured consumer settings (<code>consumerDefaults: ConsumerSettings[String, String]</code>),</li>
  <li>preconfigured producer settings (<code>producerDefaults: ProducerSettings[String, String]</code>),</li>
  <li>unique topic creation (<code>createTopic(number: Int = 0, partitions: Int = 1, replication: Int = 1)</code>),</li>
  <li>an implicit <code>LoggingAdapter</code> for use with the <code>log()</code> operator, and</li>
  <li>other goodies.</li>
</ul>
<p><a href="/api/alpakka-kafka/2.0.5/akka/kafka/testkit/scaladsl/EmbeddedKafkaLike.html" title="akka.kafka.testkit.scaladsl.EmbeddedKafkaLike"><code>EmbeddedKafkaLike</code></a> extends <a href="/api/alpakka-kafka/2.0.5/akka/kafka/testkit/scaladsl/KafkaSpec.html" title="akka.kafka.testkit.scaladsl.KafkaSpec"><code>KafkaSpec</code></a> to add automatic starting and stopping of the embedded Kafka broker.</p>
<p>Some Alpakka Kafka tests implemented in Scala use <a href="http://www.scalatest.org/">Scalatest</a> with the mix-ins shown below. You need to add Scalatest explicitly in your test dependencies (this release of Alpakka Kafka uses Scalatest 3.0.8.)</p><dl class="dependency"><dt>Maven</dt><dd><pre class="prettyprint"><code class="language-xml">&lt;dependency&gt;
  &lt;groupId&gt;org.scalatest&lt;/groupId&gt;
  &lt;artifactId&gt;scalatest&lt;/artifactId&gt;
  &lt;version&gt;3.0.8&lt;/version&gt;
  &lt;scope&gt;test&lt;/scope&gt;
&lt;/dependency&gt;</code></pre></dd><dt>sbt</dt><dd><pre class="prettyprint"><code class="language-scala">libraryDependencies += "org.scalatest" % "scalatest" % "3.0.8" % Test</code></pre></dd><dt>Gradle</dt><dd><pre class="prettyprint"><code class="language-gradle">dependencies {
  test group: 'org.scalatest', name: 'scalatest', version: '3.0.8'
}</code></pre></dd></dl>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/alpakka-kafka/tree/v2.0.5/tests/src/test/scala/akka/kafka/scaladsl/SpecBase.scala#L11-L29" target="_blank" title="Go to snippet source"></a><code class="language-scala">import akka.kafka.testkit.scaladsl.ScalatestKafkaSpec
import org.scalatest.concurrent.{Eventually, IntegrationPatience, ScalaFutures}
import org.scalatest.{Matchers, WordSpecLike}

abstract class SpecBase(kafkaPort: Int)
    extends ScalatestKafkaSpec(kafkaPort)
    with WordSpecLike
    with Matchers
    with ScalaFutures
    with Eventually {

  protected def this() = this(kafkaPort = -1)
}
</code></pre></dd>
</dl>
<p>By mixing in <a href="/api/alpakka-kafka/2.0.5/akka/kafka/testkit/scaladsl/EmbeddedKafkaLike.html" title="akka.kafka.testkit.scaladsl.EmbeddedKafkaLike"><code>EmbeddedKafkaLike</code></a> an embedded Kafka instance will be started before the tests in this test class execute shut down after all tests in this test class are finished.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/alpakka-kafka/tree/v2.0.5/tests/src/test/scala/akka/kafka/scaladsl/EmbeddedKafkaSampleSpec.scala#L9-L27" target="_blank" title="Go to snippet source"></a><code class="language-scala">import akka.kafka.testkit.scaladsl.EmbeddedKafkaLike
import com.github.ghik.silencer.silent
import net.manub.embeddedkafka.EmbeddedKafkaConfig

@silent
class EmbeddedKafkaSampleSpec extends SpecBase(kafkaPort = 1234) with EmbeddedKafkaLike {

  // if a specific Kafka broker configuration is desired
  override def createKafkaConfig: EmbeddedKafkaConfig =
    EmbeddedKafkaConfig(kafkaPort,
                        zooKeeperPort,
                        Map(
                          &quot;offsets.topic.replication.factor&quot; -&gt; &quot;1&quot;,
                          &quot;offsets.retention.minutes&quot; -&gt; &quot;1&quot;,
                          &quot;offsets.retention.check.interval.ms&quot; -&gt; &quot;100&quot;
                        ))

  // ...
}</code></pre></dd>
</dl>
<p>With this <code>EmbeddedKafkaSpecBase</code> class test classes can extend it to automatically start and stop a Kafka broker to test with. To configure the Kafka broker non-default, override the <code>createKafkaConfig</code> as shown above.</p>
<p>To ensure proper shutdown of all stages in every test, wrap your test code in <a href="https://doc.akka.io/api/akka/2.5/akka/stream/testkit/scaladsl/StreamTestKit$.html" title="akka.stream.testkit.scaladsl.StreamTestKit"><code>assertAllStagesStopped</code></a>. This may interfere with the <code>stop-timeout</code> which delays shutdown for Alpakka Kafka consumers. You might need to configure a shorter timeout in your <code>application.conf</code> for tests.</p>
<h2><a href="#alternative-testing-libraries" name="alternative-testing-libraries" class="anchor"><span class="anchor-link"></span></a>Alternative testing libraries</h2>
<p>If using Maven and Java, an alternative library that provides running Kafka broker instance during testing is <a href="https://github.com/salesforce/kafka-junit">kafka-unit by salesforce</a>. It has support for Junit 4 and 5 and supports many different versions of Kafka.</p>
<h2><a href="#mocking-the-consumer-or-producer" name="mocking-the-consumer-or-producer" class="anchor"><span class="anchor-link"></span></a>Mocking the Consumer or Producer</h2>
<p>The testkit contains factories to create the messages emitted by Consumer sources in <code>akka.kafka.testkit.ConsumerResultFactory</code> and Producer flows in <code>akka.kafka.testkit.ProducerResultFactory</code>.</p>
<p>To create the materialized value of Consumer sources, <span class="group-java"><a href="/api/alpakka-kafka/2.0.5/akka/kafka/testkit/javadsl/ConsumerControlFactory$.html" title="akka.kafka.testkit.javadsl.ConsumerControlFactory"><code>ConsumerControlFactory</code></a></span><span class="group-scala"><a href="/api/alpakka-kafka/2.0.5/akka/kafka/testkit/scaladsl/ConsumerControlFactory$.html" title="akka.kafka.testkit.scaladsl.ConsumerControlFactory"><code>ConsumerControlFactory</code></a></span> offers a wrapped <span class="group-scala"><a href="https://doc.akka.io/api/akka/2.5/akka/stream/KillSwitch.html" title="akka.stream.KillSwitch"><code>KillSwitch</code></a></span><span class="group-java"><a href="https://doc.akka.io/japi/akka/2.5/akka/stream/KillSwitch.html" title="akka.stream.KillSwitch"><code>KillSwitch</code></a></span>.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/alpakka-kafka/tree/v2.0.5/tests/src/test/scala/docs/scaladsl/TestkitSamplesSpec.scala#L42-L81" target="_blank" title="Go to snippet source"></a><code class="language-scala">import akka.kafka.testkit.scaladsl.ConsumerControlFactory
import akka.kafka.testkit.{ConsumerResultFactory, ProducerResultFactory}

// create elements emitted by the mocked Consumer
val elements = (0 to 10).map { i =&gt;
  val nextOffset = startOffset + i
  ConsumerResultFactory.committableMessage(
    new ConsumerRecord(topic, partition, nextOffset, &quot;key&quot;, s&quot;value $i&quot;),
    ConsumerResultFactory.committableOffset(groupId, topic, partition, nextOffset, s&quot;metadata $i&quot;)
  )
}

// create a source imitating the Consumer.committableSource
val mockedKafkaConsumerSource: Source[ConsumerMessage.CommittableMessage[String, String], Consumer.Control] =
  Source(elements).viaMat(ConsumerControlFactory.controlFlow())(Keep.right)

// create a source imitating the Producer.flexiFlow
val mockedKafkaProducerFlow: Flow[ProducerMessage.Envelope[String, String, CommittableOffset],
                                  ProducerMessage.Results[String, String, CommittableOffset],
                                  NotUsed] =
  Flow[ProducerMessage.Envelope[String, String, CommittableOffset]]
    .map {
      case msg: ProducerMessage.Message[String, String, CommittableOffset] =&gt;
        ProducerResultFactory.result(msg)
      case other =&gt; throw new Exception(s&quot;excluded: $other&quot;)
    }

// run the flow as if it was connected to a Kafka broker
val (control, streamCompletion) = mockedKafkaConsumerSource
  .map(
    msg =&gt;
      ProducerMessage.Message(
        new ProducerRecord[String, String](targetTopic, msg.record.value),
        msg.committableOffset
      )
  )
  .via(mockedKafkaProducerFlow)
  .map(_.passThrough)
  .toMat(Committer.sink(committerSettings))(Keep.both)
  .run()</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/alpakka-kafka/tree/v2.0.5/tests/src/test/java/docs/javadsl/TestkitSamplesTest.java#L34-L122" target="_blank" title="Go to snippet source"></a><code class="language-java">import akka.kafka.testkit.ConsumerResultFactory;
import akka.kafka.testkit.ProducerResultFactory;
import akka.kafka.testkit.javadsl.ConsumerControlFactory;

// create elements emitted by the mocked Consumer
List&lt;ConsumerMessage.CommittableMessage&lt;String, String&gt;&gt; elements =
    Arrays.asList(
        ConsumerResultFactory.committableMessage(
            new ConsumerRecord&lt;&gt;(topic, partition, startOffset, &quot;key&quot;, &quot;value 1&quot;),
            ConsumerResultFactory.committableOffset(
                groupId, topic, partition, startOffset, &quot;metadata&quot;)),
        ConsumerResultFactory.committableMessage(
            new ConsumerRecord&lt;&gt;(topic, partition, startOffset + 1, &quot;key&quot;, &quot;value 2&quot;),
            ConsumerResultFactory.committableOffset(
                groupId, topic, partition, startOffset + 1, &quot;metadata 2&quot;)));

// create a source imitating the Consumer.committableSource
Source&lt;ConsumerMessage.CommittableMessage&lt;String, String&gt;, Consumer.Control&gt;
    mockedKafkaConsumerSource =
        Source.cycle(elements::iterator)
            .viaMat(ConsumerControlFactory.controlFlow(), Keep.right());

// create a source imitating the Producer.flexiFlow
Flow&lt;
        ProducerMessage.Envelope&lt;String, String, ConsumerMessage.CommittableOffset&gt;,
        ProducerMessage.Results&lt;String, String, ConsumerMessage.CommittableOffset&gt;,
        NotUsed&gt;
    mockedKafkaProducerFlow =
        Flow
            .&lt;ProducerMessage.Envelope&lt;String, String, ConsumerMessage.CommittableOffset&gt;&gt;
                create()
            .map(
                msg -&gt; {
                  if (msg instanceof ProducerMessage.Message) {
                    ProducerMessage.Message&lt;String, String, ConsumerMessage.CommittableOffset&gt;
                        msg2 =
                            (ProducerMessage.Message&lt;
                                    String, String, ConsumerMessage.CommittableOffset&gt;)
                                msg;
                    return ProducerResultFactory.result(msg2);
                  } else throw new RuntimeException(&quot;unexpected element: &quot; + msg);
                });

// run the flow as if it was connected to a Kafka broker
Pair&lt;Consumer.Control, CompletionStage&lt;Done&gt;&gt; stream =
    mockedKafkaConsumerSource
        .map(
            msg -&gt; {
              ProducerMessage.Envelope&lt;String, String, ConsumerMessage.CommittableOffset&gt;
                  message =
                      new ProducerMessage.Message&lt;&gt;(
                          new ProducerRecord&lt;&gt;(
                              targetTopic, msg.record().key(), msg.record().value()),
                          msg.committableOffset());
              return message;
            })
        .via(mockedKafkaProducerFlow)
        .map(ProducerMessage.Results::passThrough)
        .toMat(Committer.sink(committerSettings), Keep.both())
        .run(mat);</code></pre></dd>
</dl>
</div>
</article>
<div class="row">
<div class="small-12 column">
<section class="nav-prev-next row">
<div class="nav-prev small-6 column">
<a href="debugging.html"><i class="icon-prev"></i> <span class="link-prev">Debugging</span></a>
</div>
<div class="nav-next small-6 column clearfix">
<a class="float-right" href="testing-testcontainers.html">Testing with a Docker Kafka cluster <i class="icon-next"></i></a>
</div>
</section>
</div>
</div>
<div class="source-github row">
Found an error in this documentation? The source code for this page can be found <a href="https://github.com/akka/alpakka-kafka/tree/v2.0.5/docs/src/main/paradox/testing.md">here</a>.
Please feel free to edit and contribute a pull request.
</div>

<footer class="page-footer row clearfix">
<img class="akka-icon float-left show-for-medium" src="images/akka-icon.svg" />
<section class="copyright">
<div>Alpakka Kafka is Open Source and available under the Apache 2 License.</div>
<p class="legal">
&copy; 2011-2020 <a href="https://www.lightbend.com" target="_blank">Lightbend, Inc.</a> |
<a href="https://www.lightbend.com/legal/licenses" target="_blank">Licenses</a> |
<a href="https://www.lightbend.com/legal/terms" target="_blank">Terms</a> |
<a href="https://www.lightbend.com/legal/privacy" target="_blank">Privacy Policy</a> |
<a href="https://akka.io/cookie/" target="_blank">Cookie Listing</a> |
<a class="optanon-toggle-display">Cookie Settings</a>
</p>
</section>

</footer>
</section>
</main>
</div>

<script type="text/javascript" src="js/scrollsneak.js"></script>
<script type="text/javascript">jQuery(document).foundation();</script>
<script type="text/javascript" src="js/groups.js"></script>
<script type="text/javascript" src="js/page.js"></script>
<script type="text/javascript" src="js/magellan.js"></script>
<script type="text/javascript" src="js/metadata-toggle.js"></script>

<style type="text/css">@import "lib/prettify/prettify.css";</style>
<script type="text/javascript" src="lib/prettify/prettify.js"></script>
<script type="text/javascript" src="lib/prettify/lang-scala.js"></script>
<script type="text/javascript">//<![CDATA[
jQuery(function(){window.prettyPrint && prettyPrint()});
//]]></script>
<script type="text/javascript" src="assets/js/warnOldVersion.js"></script>
<script type="text/javascript">jQuery(function(jq){initOldVersionWarnings(jq, '2.0.5', 'https://doc.akka.io/docs/alpakka-kafka/current')});</script>


</body>
</html>
