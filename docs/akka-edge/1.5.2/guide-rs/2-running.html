<!DOCTYPE html>
<html class="no-js" lang="en">

<head>
<title>Running the sample &bull; Akka Edge</title>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<meta name="description" content="Akka Projection."/>
<link rel="canonical" href="https://doc.akka.io/docs/akka-edge/current/guide-rs/2-running.html"/>
<script type="text/javascript" src="../lib/jquery/jquery.min.js"></script>
<script type="text/javascript" src="../lib/foundation/dist/js/foundation.min.js"></script>
<link rel="stylesheet" type="text/css" href="../lib/normalize.css/normalize.css"/>
<link rel="stylesheet" type="text/css" href="../lib/foundation/dist/css/foundation.min.css"/>
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.css" />
<link rel="stylesheet" type="text/css" href="../css/icons.css"/>
<link rel="stylesheet" type="text/css" href="../css/page-8.css"/>
<link rel="stylesheet" type="text/css" href="../css/banner-2.css"/>
<link rel="shortcut icon" href="../images/favicon.ico" />
<link rel="apple-touch-icon" sizes="180x180" href="../images/apple-touch-icon.png"/>
<link rel="icon" type="image/png" sizes="32x32" href="../images/favicon-32x32.png"/>
<link rel="icon" type="image/png" sizes="16x16" href="../images/favicon-16x16.png"/>
<link rel="manifest" href="../images/manifest.json"/>
<meta name="msapplication-TileImage" content="../images/mstile-150x150.png"/>
<meta name="msapplication-TileColor" content="#15a9ce"/>
<meta name="theme-color" content="#15a9ce"/>
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>
<!-- OneTrust Cookies Consent Notice (Production Standard, akka.io, en-GB) start -->
<script src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js"  type="text/javascript" charset="UTF-8" data-domain-script="28b912e7-09e9-43d5-91e4-3d1897044004" ></script>
<script type="text/javascript">
function OptanonWrapper() { }
</script>
<!-- OneTrust Cookies Consent Notice (Production Standard, akka.io, en-GB) end -->
<!-- Google Tag Manager now loads Google Analytics and any other tracking scripts. GTM also performs respects a users cookie choices-->
<script type="text/javascript">
(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-KBJGH35');
</script>

</head>

<body id="underlay" data-toggler="nav-open">
<div id="lightbend-banner" class="lightbend-banner akka full-width" data-category="OSS Lightbend Banner Impression" data-label="Akka Banner Impression">
<div class="oss-wrapper">
<div class="oss-brand">
<a class="oss-track-link-label" data-category="OSS Lightbend Banner Clicks" data-label="Lightbend Logo - Akka Banner" href="https://www.lightbend.com">
<img class="lightbend-logo" src="../images/banner-logos/lightbend-reverse.svg" alt="Lightbend" title="Lightbend">
</a>
</div>
<div class="oss-ad no-drop-down">
<nav id="lightbendRotator" class="lightbend-rotator">
<a class="oss-track-link-label" data-category="OSS Lightbend Banner Clicks" data-label="Promo Rotator - Introducing Akka Cloud to Edge Continuum. Build once for the Cloud. Seamlessly deploy to the Edge. [Learn more] - Akka Banner" href="https://www.lightbend.com/blog/akka-edge-unifying-the-cloud-and-edge">
Introducing Akka Cloud to Edge Continuum. Build once for the Cloud. Seamlessly deploy to the Edge. <span class="akka-btn">Learn more</span>
</a>
</nav>
</div>
</div>
</div>

<header class="site-header hide-for-large">
<div class="sticky-header clearfix">
<a href="https://akka.io"><img class="logo" src="../images/akka-logo-reverse.svg"/></a>

<button class="menu-icon float-right" type="button" data-toggle="underlay overlay"></button>
</div>
<div id="overlay" class="overlay-nav" data-toggler="nav-open">
<header class="nav-header">
<div class="nav-header-title">
<h1><a href="../index.html">Akka Edge</a></h1>
</div>
<div class="nav-header-version">
Version 1.5.2
</div>
<div class="nav-header-groups">
<select class="supergroup" name="Language"><option class="group" value="group-java">Java</option><option class="group" value="group-scala">Scala</option></select>
</div>
</header>
<nav class="nav-toc">
<ul>
  <li><a href="../overview.html" class="page">Architectural Overview</a></li>
  <li><a href="../use-cases.html" class="page">Example Use Cases</a></li>
  <li><a href="../feature-summary.html" class="page">Feature Summary</a></li>
  <li><a href="../guide.html" class="page">Guide - Java/Scala</a></li>
  <li><a href="../guide-rs.html" class="page">Guide - Rust</a>
  <ul>
    <li><a href="../guide-rs/1-setup.html" class="page">Getting started</a></li>
    <li><a href="../guide-rs/2-running.html#running-the-sample" class="active page">Running the sample</a>
    <ul>
      <li><a href="../guide-rs/2-running.html#running" class="header">Running</a></li>
      <li><a href="../guide-rs/2-running.html#whats-next-" class="header">What&rsquo;s next?</a></li>
    </ul></li>
    <li><a href="../guide-rs/3-temperature-entity.html" class="page">The temperature entity</a></li>
    <li><a href="../guide-rs/4-registration-projection.html" class="page">Consuming registration events</a></li>
    <li><a href="../guide-rs/5-temperature-production.html" class="page">Producing temperature events</a></li>
    <li><a href="../guide-rs/6-temperature-production-http.html" class="page">HTTP temperature events</a></li>
    <li><a href="../guide-rs/7-udp-consumption.html" class="page">UDP observations</a></li>
    <li><a href="../guide-rs/8-main.html" class="page">The main function</a></li>
  </ul></li>
  <li><a href="../lightweight-deployments.html" class="page">Lightweight deployments</a></li>
</ul>
</nav>
</div>
</header>
<div class="site-content-wrapper">
<aside class="sticky-sidebar show-for-large">
<header class="nav-header sticky-sidebar-header">
<div class="nav-header-title">
<h1><a href="../index.html">Akka Edge</a></h1>
</div>
<div class="nav-header-version">
Version 1.5.2
</div>
<div class="nav-header-groups">
<select class="supergroup" name="Language"><option class="group" value="group-java">Java</option><option class="group" value="group-scala">Scala</option></select>
</div>
</header>
<nav class="site-nav sticky-sidebar-contents">
<div class="nav-toc">
<ul>
  <li><a href="../overview.html" class="page">Architectural Overview</a></li>
  <li><a href="../use-cases.html" class="page">Example Use Cases</a></li>
  <li><a href="../feature-summary.html" class="page">Feature Summary</a></li>
  <li><a href="../guide.html" class="page">Guide - Java/Scala</a></li>
  <li><a href="../guide-rs.html" class="page">Guide - Rust</a>
  <ul>
    <li><a href="../guide-rs/1-setup.html" class="page">Getting started</a></li>
    <li><a href="../guide-rs/2-running.html#running-the-sample" class="active page">Running the sample</a>
    <ul>
      <li><a href="../guide-rs/2-running.html#running" class="header">Running</a></li>
      <li><a href="../guide-rs/2-running.html#whats-next-" class="header">What&rsquo;s next?</a></li>
    </ul></li>
    <li><a href="../guide-rs/3-temperature-entity.html" class="page">The temperature entity</a></li>
    <li><a href="../guide-rs/4-registration-projection.html" class="page">Consuming registration events</a></li>
    <li><a href="../guide-rs/5-temperature-production.html" class="page">Producing temperature events</a></li>
    <li><a href="../guide-rs/6-temperature-production-http.html" class="page">HTTP temperature events</a></li>
    <li><a href="../guide-rs/7-udp-consumption.html" class="page">UDP observations</a></li>
    <li><a href="../guide-rs/8-main.html" class="page">The main function</a></li>
  </ul></li>
  <li><a href="../lightweight-deployments.html" class="page">Lightweight deployments</a></li>
</ul>
</div>
</nav>
<footer class="nav-footer sticky-sidebar-footer">
<a href="https://akka.io"><img class="logo" src="../images/akka-logo-reverse.svg"/></a>

</footer>
</aside>
<main class="fixed-shift-for-large expanded row">
<section class="site-content small-12 column">
<article class="page-content row">
<div class="small-12 column" id="docs">
<h1><a href="#running-the-sample" name="running-the-sample" class="anchor"><span class="anchor-link"></span></a>Running the sample</h1>
<p>The sample Akka Edge Rust project is a fairly complete example of how a service can be written for the edge, and includes encryption. Encryption should normally be applied to data storage and transmission. For simplicity, we apply encryption to storage data, but not http and UDP.</p>
<h2><a href="#running" name="running" class="anchor"><span class="anchor-link"></span></a>Running</h2>
<p>The complete sample can be downloaded from <a href="../attachments/iot-service.zip">iot-service.zip</a> </p>
<p>Then unzip and navigate to the <code>iot-service-rs</code> project:</p>
<pre><code>cd iot-service-rs
</code></pre>
<p>To run via cargo:</p><div class="callout note "><div class="callout-title">Note</div>
<p>If you have previously run the Rust service then run the following to start again from scratch:</p>
<pre><code>rm -rf /tmp/iot-service/var/lib
</code></pre></div>
<pre><code>mkdir -p /tmp/iot-service/var/lib/confidant
chmod 700 /tmp/iot-service/var/lib/confidant
mkdir -p /tmp/iot-service/var/lib/logged
echo -n &quot;01234567890123456789012345678912some-secret-id&quot; | \
RUST_LOG=info cargo run --manifest-path=backend/Cargo.toml -- \
  --cl-root-path=/tmp/iot-service/var/lib/logged \
  --ss-role-id=&quot;iot-service&quot; \
  --ss-root-path=/tmp/iot-service/var/lib/confidant
</code></pre><div class="callout note "><div class="callout-title">Note</div>
<p>If you would like to understand what the above command line parameters refer to, or learn about more options, then you can also type:</p>
<pre><code>cargo run --manifest-path=backend/Cargo.toml -- --help
</code></pre></div>
<p>We must first register the device ids that we wish to receive data for. This is a form of authentication where, in the real-world, a shared key between the device and service would be conveyed. That key would then be used to encrypt data. We simply use the key as a registration mechanism and do not accept data for devices where we have no key.</p>
<p>Let&rsquo;s first query for a sensor&rsquo;s data. Open another terminal window and type the following:</p>
<pre><code>curl -v &quot;127.0.0.1:8080/api/temperature/events/1&quot;
</code></pre>
<p>&hellip;it will return an empty stream as we have no sensors yet.</p>
<p>So, let&rsquo;s now provision one. To do this, we must start up the JVM-based iot-service. From a new terminal window navigate to the iot-service project from within the repository:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre><code>cd iot-service-scala
</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre><code>cd iot-service-java
</code></pre></dd>
</dl><div class="callout note "><div class="callout-title">Note</div>
<p>If you have previously run the JVM iot-service then run the following to start again from scratch:</p>
<pre><code>docker rm -f postgres_db 
</code></pre></div>
<p>Please follow steps 1 and 2 at the JVM <span class="group-scala"><code>iot-service-scala/README.md</code></span><span class="group-java"><code>iot-service-java/README.md</code></span>. Once done, provision a sensor back in the terminal window where you previously issued <code>curl</code>:</p>
<pre><code>grpcurl \
  -d &#39;{&quot;sensor_entity_id&quot;:&quot;1&quot;, &quot;secret&quot;:&quot;foo&quot;}&#39; \
  -plaintext \
  127.0.0.1:8101 \
  iot.registration.RegistrationService.Register
</code></pre>
<p>You should now be able to query for the current state of a temperature sensor, although they&rsquo;ll be no observations recorded for it yet, so it will still be an empty stream. However, this time it is waiting on events.</p>
<pre><code>curl -v &quot;127.0.0.1:8080/api/temperature/events/1&quot;
</code></pre>
<p>From another terminal, let&rsquo;s now post database events to the UDP socket so that the sensor has observations. Note that we&rsquo;re using Postcard to deserialize binary data. Postcard uses variable length integers where the top bit, when set, indicates that the next byte also contains data. See <a href="https://docs.rs/postcard/latest/postcard/">Postcard</a> for more details.</p>
<pre><code>echo -n -e &quot;\x01\x02&quot; | nc -w0 127.0.0.1 -u 8081
</code></pre>
<p>You should see an <code>INFO</code> log in the JVM iot-service indicating that the post has been received. You will also see events appearing from the above curl command.</p>
<p>Back over in the JVM iot-service, you should also see these temperature observations appear in its log, and you can retrieve the latest observation with:</p>
<pre><code>grpcurl \
  -d &#39;{&quot;sensor_entity_id&quot;:&quot;1&quot;}&#39; \
  -plaintext \
  127.0.0.1:8101 \
  iot.temperature.SensorTwinService.GetTemperature
</code></pre>
<p>Now let&rsquo;s run the user interface. Please follow <a href="https://yew.rs/docs/getting-started/introduction">Yew&rsquo;s getting started guide</a> to install <code>trunk</code> along with the Rust Webassembly target. Then, from the <code>iot-service-rs</code> project:</p>
<pre><code>(cd frontend &amp;&amp; trunk serve)
</code></pre>
<p>.. and then navigate to <a href="http://localhost:8081/">http://localhost:8081/</a>. Looking up entity <code>1</code> will display the temperature observations that have been sent over UDP. </p><div class="callout note "><div class="callout-title">Note</div>
<p>If you encounter any issues using <code>trunk</code> then it may be because you already have a version of the <code>sass</code> compiler installed on your system. Version <code>1.54.9</code> of the sass compiler is required at a minimum.</p></div>
<p>To see an observation display in near-real-time, keep the browser window visible and then update the temperature observation with another value, in this case 3 degrees:</p>
<pre><code>echo -n -e &quot;\x01\x03&quot; | nc -w0 127.0.0.1 -u 8081
</code></pre>
<h2><a href="#whats-next-" name="whats-next-" class="anchor"><span class="anchor-link"></span></a>What&rsquo;s next?</h2>
<ul>
  <li>The temperature entity</li>
</ul>
</div>
</article>
<div class="row">
<div class="small-12 column">
<section class="nav-prev-next row">
<div class="nav-prev small-6 column">
<a href="../guide-rs/1-setup.html"><i class="icon-prev"></i> <span class="link-prev">Getting started</span></a>
</div>
<div class="nav-next small-6 column clearfix">
<a class="float-right" href="../guide-rs/3-temperature-entity.html">The temperature entity <i class="icon-next"></i></a>
</div>
</section>
</div>
</div>
<div class="source-github row">
Found an error in this documentation? The source code for this page can be found <a href="https://github.com/akka/akka-projection/tree/master/akka-edge-docs/src/main/paradox/guide-rs/2-running.md">here</a>.
Please feel free to edit and contribute a pull request.
</div>

<footer class="page-footer row clearfix">
<img class="akka-icon float-left show-for-medium" src="../images/akka-icon.svg" />
<section class="copyright">
<div>Akka Edge is available under the <a href="https://www.lightbend.com/akka/license" target="_blank">Business Source License 1.1</a>.</div>
<p class="legal">
&copy; 2011-2024 <a href="https://www.lightbend.com" target="_blank">Lightbend, Inc.</a> |
<a href="https://www.lightbend.com/legal/licenses" target="_blank">Licenses</a> |
<a href="https://www.lightbend.com/legal/terms" target="_blank">Terms</a> |
<a href="https://www.lightbend.com/legal/privacy" target="_blank">Privacy Policy</a> |
<a href="https://akka.io/cookie/" target="_blank">Cookie Listing</a> |
<a class="optanon-toggle-display">Cookie Settings</a>
</p>
</section>

</footer>
</section>
</main>
</div>

<script type="text/javascript" src="../js/scrollsneak.js"></script>
<script type="text/javascript">jQuery(document).foundation();</script>
<script type="text/javascript" src="../js/groups.js"></script>
<script type="text/javascript" src="../js/page.js"></script>
<script type="text/javascript" src="../js/snippets.js"></script>
<script type="text/javascript" src="../js/magellan.js"></script>
<script type="text/javascript" src="../js/metadata-toggle.js"></script>
<script type="text/javascript" src="../js/lbHeader.js"></script>

<style type="text/css">@import "../lib/prettify/prettify.css";</style>
<script type="text/javascript" src="../lib/prettify/prettify.js"></script>
<script type="text/javascript" src="../lib/prettify/lang-scala.js"></script>
<script type="text/javascript">//<![CDATA[
jQuery(function(){window.prettyPrint && prettyPrint()});
//]]></script>
<!-- hook for including project specific javascript into the generated docs -->

</body>
</html>
