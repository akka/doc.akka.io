<!DOCTYPE html>
<html class="no-js" lang="en">

<head>
<title>Lightweight deployments &bull; Akka Edge</title>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<meta name="description" content="Akka Projection."/>
<link rel="canonical" href="https://doc.akka.io/docs/akka-edge/current/lightweight-deployments.html"/>
<script type="text/javascript" src="lib/jquery/jquery.min.js"></script>
<script type="text/javascript" src="lib/foundation/dist/js/foundation.min.js"></script>
<link rel="stylesheet" type="text/css" href="lib/normalize.css/normalize.css"/>
<link rel="stylesheet" type="text/css" href="lib/foundation/dist/css/foundation.min.css"/>
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.css" />
<link rel="stylesheet" type="text/css" href="css/icons.css"/>
<link rel="stylesheet" type="text/css" href="css/page-8.css"/>
<link rel="stylesheet" type="text/css" href="css/banner-2.css"/>
<link rel="shortcut icon" href="images/favicon.ico" />
<link rel="apple-touch-icon" sizes="180x180" href="images/apple-touch-icon.png"/>
<link rel="icon" type="image/png" sizes="32x32" href="images/favicon-32x32.png"/>
<link rel="icon" type="image/png" sizes="16x16" href="images/favicon-16x16.png"/>
<link rel="manifest" href="images/manifest.json"/>
<meta name="msapplication-TileImage" content="images/mstile-150x150.png"/>
<meta name="msapplication-TileColor" content="#15a9ce"/>
<meta name="theme-color" content="#15a9ce"/>
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>
<!-- OneTrust Cookies Consent Notice (Production Standard, akka.io, en-GB) start -->
<script src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js"  type="text/javascript" charset="UTF-8" data-domain-script="28b912e7-09e9-43d5-91e4-3d1897044004" ></script>
<script type="text/javascript">
function OptanonWrapper() { }
</script>
<!-- OneTrust Cookies Consent Notice (Production Standard, akka.io, en-GB) end -->
<!-- Google Tag Manager now loads Google Analytics and any other tracking scripts. GTM also performs respects a users cookie choices-->
<script type="text/javascript">
(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-KBJGH35');
</script>

</head>

<body id="underlay" data-toggler="nav-open">
<div id="lightbend-banner" class="lightbend-banner akka full-width" data-category="OSS Lightbend Banner Impression" data-label="Akka Banner Impression">
<div class="oss-wrapper">
<div class="oss-brand">
<a class="oss-track-link-label" data-category="OSS Lightbend Banner Clicks" data-label="Lightbend Logo - Akka Banner" href="https://www.lightbend.com">
<img class="lightbend-logo" src="images/banner-logos/lightbend-reverse.svg" alt="Lightbend" title="Lightbend">
</a>
</div>
<div class="oss-ad no-drop-down">
<nav id="lightbendRotator" class="lightbend-rotator">
<a class="oss-track-link-label" data-category="OSS Lightbend Banner Clicks" data-label="Promo Rotator - Introducing Akka Cloud to Edge Continuum. Build once for the Cloud. Seamlessly deploy to the Edge. [Learn more] - Akka Banner" href="https://www.lightbend.com/blog/akka-edge-unifying-the-cloud-and-edge">
Introducing Akka Cloud to Edge Continuum. Build once for the Cloud. Seamlessly deploy to the Edge. <span class="akka-btn">Learn more</span>
</a>
</nav>
</div>
</div>
</div>

<header class="site-header hide-for-large">
<div class="sticky-header clearfix">
<a href="https://akka.io"><img class="logo" src="images/akka-logo-reverse.svg"/></a>

<button class="menu-icon float-right" type="button" data-toggle="underlay overlay"></button>
</div>
<div id="overlay" class="overlay-nav" data-toggler="nav-open">
<header class="nav-header">
<div class="nav-header-title">
<h1><a href="index.html">Akka Edge</a></h1>
</div>
<div class="nav-header-version">
Version 1.5.1-M2
</div>
<div class="nav-header-groups">
<select class="supergroup" name="Language"><option class="group" value="group-java">Java</option><option class="group" value="group-scala">Scala</option></select>
</div>
</header>
<nav class="nav-toc">
<ul>
  <li><a href="overview.html" class="page">Architectural Overview</a></li>
  <li><a href="use-cases.html" class="page">Example Use Cases</a></li>
  <li><a href="feature-summary.html" class="page">Feature Summary</a></li>
  <li><a href="guide.html" class="page">Guide</a></li>
  <li><a href="lightweight-deployments.html#lightweight-deployments" class="active page">Lightweight deployments</a>
  <ul>
    <li><a href="lightweight-deployments.html#lightweight-kubernetes" class="header">Lightweight Kubernetes</a></li>
    <li><a href="lightweight-deployments.html#cloud-optimized-jvms" class="header">Cloud-optimized JVMs</a></li>
    <li><a href="lightweight-deployments.html#graalvm-native-image" class="header">GraalVM Native Image</a></li>
    <li><a href="lightweight-deployments.html#multidimensional-autoscaling" class="header">Multidimensional autoscaling</a></li>
  </ul></li>
</ul>
</nav>
</div>
</header>
<div class="site-content-wrapper">
<aside class="sticky-sidebar show-for-large">
<header class="nav-header sticky-sidebar-header">
<div class="nav-header-title">
<h1><a href="index.html">Akka Edge</a></h1>
</div>
<div class="nav-header-version">
Version 1.5.1-M2
</div>
<div class="nav-header-groups">
<select class="supergroup" name="Language"><option class="group" value="group-java">Java</option><option class="group" value="group-scala">Scala</option></select>
</div>
</header>
<nav class="site-nav sticky-sidebar-contents">
<div class="nav-toc">
<ul>
  <li><a href="overview.html" class="page">Architectural Overview</a></li>
  <li><a href="use-cases.html" class="page">Example Use Cases</a></li>
  <li><a href="feature-summary.html" class="page">Feature Summary</a></li>
  <li><a href="guide.html" class="page">Guide</a></li>
  <li><a href="lightweight-deployments.html#lightweight-deployments" class="active page">Lightweight deployments</a>
  <ul>
    <li><a href="lightweight-deployments.html#lightweight-kubernetes" class="header">Lightweight Kubernetes</a></li>
    <li><a href="lightweight-deployments.html#cloud-optimized-jvms" class="header">Cloud-optimized JVMs</a></li>
    <li><a href="lightweight-deployments.html#graalvm-native-image" class="header">GraalVM Native Image</a></li>
    <li><a href="lightweight-deployments.html#multidimensional-autoscaling" class="header">Multidimensional autoscaling</a></li>
  </ul></li>
</ul>
</div>
</nav>
<footer class="nav-footer sticky-sidebar-footer">
<a href="https://akka.io"><img class="logo" src="images/akka-logo-reverse.svg"/></a>

</footer>
</aside>
<main class="fixed-shift-for-large expanded row">
<section class="site-content small-12 column">
<article class="page-content row">
<div class="small-12 column" id="docs">
<h1><a href="#lightweight-deployments" name="lightweight-deployments" class="anchor"><span class="anchor-link"></span></a>Lightweight deployments</h1>
<p>Deployments at the edge of the cloud may need to minimize resource usage and be capable of running in resource-constrained environments. Akka Edge applications can be configured and built to run with low resource usage and adapt to changing resource needs.</p>
<p>Some approaches to running lightweight deployments for Akka Edge applications include:</p>
<ul>
  <li><a href="lightweight-deployments.html#lightweight-kubernetes">Using lightweight Kubernetes distributions</a></li>
  <li><a href="lightweight-deployments.html#cloud-optimized-jvms">Using cloud-optimized JVMs</a></li>
  <li><a href="lightweight-deployments.html#graalvm-native-image">Building GraalVM Native Image executables</a></li>
  <li><a href="lightweight-deployments.html#multidimensional-autoscaling">Configuring adaptive resource usage with multidimensional autoscaling</a></li>
</ul>
<p>These approaches are useful when running applications in edge environments that are on-premise or in 5G edge computing infrastructure, including cloud provider products such as <a href="https://aws.amazon.com/wavelength/">AWS Wavelength</a>, <a href="https://aws.amazon.com/outposts/">AWS Outposts</a>, <a href="https://cloud.google.com/distributed-cloud-edge">Google Distributed Cloud Edge</a>, or <a href="https://azure.microsoft.com/en-us/products/azure-stack/edge/">Azure Stack Edge</a>.</p>
<h2><a href="#lightweight-kubernetes" name="lightweight-kubernetes" class="anchor"><span class="anchor-link"></span></a>Lightweight Kubernetes</h2>
<p>Kubernetes has become the standard orchestration tool for deploying containers and there are lightweight Kubernetes distributions that are specifically designed for edge computing environments. <a href="https://k3s.io">K3s</a> and <a href="https://microk8s.io">MicroK8s</a> are lightweight Kubernetes distributions that are suitable for deploying containerized Akka Edge applications.</p>
<h2><a href="#cloud-optimized-jvms" name="cloud-optimized-jvms" class="anchor"><span class="anchor-link"></span></a>Cloud-optimized JVMs</h2>
<p>The Java Virtual Machine (JVM) can be configured to run with lower resource usage. OpenJDK&rsquo;s <a href="https://openjdk.org/projects/leyden/">Project Leyden</a> is not released yet, but is looking to improve the startup time, time to peak performance, and the footprint of Java programs.</p>
<h3><a href="#openj9" name="openj9" class="anchor"><span class="anchor-link"></span></a>OpenJ9</h3>
<p><a href="https://eclipse.dev/openj9/">OpenJ9</a> is a JVM that is optimized for running in cloud environments and configured for lower resource usage. Options include <a href="https://eclipse.dev/openj9/docs/xtunevirtualized/">tuning for virtualized environments</a>, <a href="https://eclipse.dev/openj9/docs/shrc/">class data sharing</a>, and <a href="https://eclipse.dev/openj9/docs/aot/">ahead-of-time (AOT) compilation</a> for faster starts and warmup.</p>
<h2><a href="#graalvm-native-image" name="graalvm-native-image" class="anchor"><span class="anchor-link"></span></a>GraalVM Native Image</h2>
<p><a href="https://www.graalvm.org/latest/reference-manual/native-image/">GraalVM Native Image</a> compiles Java or Scala code ahead-of-time to a native executable. A native image executable provides lower resource usage compared with the JVM, smaller deployments, faster starts, and immediate peak performance — making it ideal for Akka Edge deployments in resource-constrained environments and for responsiveness under autoscaling.</p>
<p>Native Image builds can be integrated into your application using build tool plugins:</p>
<ul>
  <li><a href="https://graalvm.github.io/native-build-tools/latest/maven-plugin.html">Maven plugin for GraalVM Native Image</a></li>
  <li><a href="https://graalvm.github.io/native-build-tools/latest/gradle-plugin.html">Gradle plugin for GraalVM Native Image</a></li>
  <li><a href="https://github.com/scalameta/sbt-native-image">sbt plugin for GraalVM Native Image</a></li>
</ul>
<p>Native Image builds need to be configured in various ways. See the build tool plugins and the <a href="https://www.graalvm.org/latest/reference-manual/native-image/overview/BuildConfiguration/">Native Image build configuration</a> reference documentation for more information on how to do this. An important part of the configuration is the <em>reachability metadata</em>, which covers dynamic features used at runtime and which can&rsquo;t be discovered statically at build time.</p>
<h3><a href="#graalvm-tracing-agent" name="graalvm-tracing-agent" class="anchor"><span class="anchor-link"></span></a>GraalVM tracing agent</h3>
<p>GraalVM provides a <a href="https://www.graalvm.org/latest/reference-manual/native-image/metadata/AutomaticMetadataCollection/">tracing agent</a> to automatically gather metadata and create configuration files. The tracing agent tracks usage of dynamic features during regular running of the application in a JVM, and outputs Native Image configuration based on the code paths that were exercised. The build tool plugins for Native Image provide ways to run locally with the tracing agent enabled. It can also be useful to deploy your application to a testing environment with the GraalVM tracing agent enabled, to capture usage in an actual deployment environment and exercising all the Akka Edge features that are being used.</p><div class="callout note "><div class="callout-title">Note</div>
<p>The GraalVM Native Image tracing agent can only generate configuration for code paths that were observed during the running of an application. When using this approach for generating configuration, make sure that tests exercise all possible code paths. In particular, check dynamic serialization of classes used for persistence or cross-node communication.</p></div>
<h3><a href="#graalvm-native-image-build-examples" name="graalvm-native-image-build-examples" class="anchor"><span class="anchor-link"></span></a>GraalVM Native Image build examples</h3>
<p>The Local Drone Control service from the <a href="guide.html">Akka Edge guide</a> has been configured for GraalVM Native Image as an example:</p>
<ul>
  <li><a href="https://github.com/akka/akka-projection/blob/main/samples/grpc/local-drone-control-java/native-image/README.md">Native Image build for Local Drone Control service in Java</a></li>
  <li><a href="https://github.com/akka/akka-projection/blob/main/samples/grpc/local-drone-control-scala/native-image/README.md">Native Image build for Local Drone Control service in Scala</a></li>
</ul>
<h2><a href="#multidimensional-autoscaling" name="multidimensional-autoscaling" class="anchor"><span class="anchor-link"></span></a>Multidimensional autoscaling</h2>
<p>An application using Akka Edge features, such as event sourcing and projections over gRPC, cannot scale to zero when idle. It&rsquo;s possible, however, for the application to be scaled to and from &ldquo;near zero&rdquo; — scaling down to a state of minimal resource usage when idle, scaling up and out when load is increased. Multidimensional autoscaling is scaling both vertically (lower or higher resource allocation) and horizontally (fewer or more instances) and can be used to align resource usage with the actual demand given dynamic workloads.</p>
<p>In Kubernetes, the <a href="https://kubernetes.io/docs/tasks/run-application/horizontal-pod-autoscale/">horizontal pod autoscaler (HPA)</a> and the <a href="https://github.com/kubernetes/autoscaler/tree/master/vertical-pod-autoscaler">vertical pod autoscaler (VPA)</a> can be combined, so that when the service is idle it is both <em>scaled down</em> with minimal resource requests, and <em>scaled in</em> to a minimal number of pods.</p>
<p>A multidimensional autoscaling configuration for an Akka Edge application in Kubernetes can be set up with:</p>
<ul>
  <li>
  <p>Custom VPA recommender for vertical autoscaling configured to respond quickly, to &ldquo;activate&rdquo; the application. The  default vertical pod autoscaler bases its recommendations for resource requests over long time frames (over days). A  custom VPA recommender is needed to go from minimal resource allocation to higher requests more quickly.</p></li>
  <li>
  <p>HPA configured to horizontally autoscale based on <a href="https://kubernetes.io/docs/tasks/run-application/horizontal-pod-autoscale/#scaling-on-custom-metrics">custom metrics</a> — such as the number of active event sourced  entities in an Akka Cluster. Custom metrics need to be exposed by the application and configured for the Kubernetes  custom metrics API with an &ldquo;adapter&rdquo;, such as the <a href="https://github.com/kubernetes-sigs/prometheus-adapter">Prometheus adapter</a>.</p></li>
  <li>
  <p>Application availability ensured by having a minimum of 2 replicas, and configuring a <a href="https://kubernetes.io/docs/tasks/run-application/configure-pdb/">pod disruption budget  (PDB)</a> so that no more than one pod is unavailable at a time. When the vertical autoscaler makes changes, pods  are evicted and restarted with updated resource requests. In-place changes are not currently supported by Kubernetes.</p></li>
</ul><div class="callout note "><div class="callout-title">Note</div>
<p>The Kubernetes horizontal and vertical pod autoscalers should not be triggered using the same metrics. As the default vertical autoscaler is currently designed for resource metrics (CPU and memory), the horizontal autoscaler should be configured to use custom metrics.</p></div>
<h3><a href="#multidimensional-autoscaling-examples" name="multidimensional-autoscaling-examples" class="anchor"><span class="anchor-link"></span></a>Multidimensional autoscaling examples</h3>
<p>The Local Drone Control service from the <a href="guide.html">Akka Edge guide</a> has been configured for multidimensional autoscaling. The example uses GraalVM Native Image builds for low resource usage, combines the vertical and horizontal pod autoscalers, and runs in k3s (lightweight Kubernetes).</p>
<ul>
  <li><a href="https://github.com/akka/akka-projection/blob/main/samples/grpc/local-drone-control-java/autoscaling/README.md">Multidimensional autoscaling example for Local Drone Control service in Java</a></li>
  <li><a href="https://github.com/akka/akka-projection/blob/main/samples/grpc/local-drone-control-scala/autoscaling/README.md">Multidimensional autoscaling example for Local Drone Control service in Scala</a></li>
</ul>
</div>
</article>
<div class="row">
<div class="small-12 column">
<section class="nav-prev-next row">
<div class="nav-prev small-6 column">
<a href="guide/5-deploying-the-services.html"><i class="icon-prev"></i> <span class="link-prev">Deploying the Restaurant Delivery Service</span></a>
</div>
<div class="nav-next small-6 column clearfix">
</div>
</section>
</div>
</div>
<div class="source-github row">
Found an error in this documentation? The source code for this page can be found <a href="https://github.com/akka/akka-projection/tree/master/akka-edge-docs/src/main/paradox/lightweight-deployments.md">here</a>.
Please feel free to edit and contribute a pull request.
</div>

<footer class="page-footer row clearfix">
<img class="akka-icon float-left show-for-medium" src="images/akka-icon.svg" />
<section class="copyright">
<div>Akka Edge is available under the <a href="https://www.lightbend.com/akka/license" target="_blank">Business Source License 1.1</a>.</div>
<p class="legal">
&copy; 2011-2023 <a href="https://www.lightbend.com" target="_blank">Lightbend, Inc.</a> |
<a href="https://www.lightbend.com/legal/licenses" target="_blank">Licenses</a> |
<a href="https://www.lightbend.com/legal/terms" target="_blank">Terms</a> |
<a href="https://www.lightbend.com/legal/privacy" target="_blank">Privacy Policy</a> |
<a href="https://akka.io/cookie/" target="_blank">Cookie Listing</a> |
<a class="optanon-toggle-display">Cookie Settings</a>
</p>
</section>

</footer>
</section>
</main>
</div>

<script type="text/javascript" src="js/scrollsneak.js"></script>
<script type="text/javascript">jQuery(document).foundation();</script>
<script type="text/javascript" src="js/groups.js"></script>
<script type="text/javascript" src="js/page.js"></script>
<script type="text/javascript" src="js/snippets.js"></script>
<script type="text/javascript" src="js/magellan.js"></script>
<script type="text/javascript" src="js/metadata-toggle.js"></script>
<script type="text/javascript" src="js/lbHeader.js"></script>

<style type="text/css">@import "lib/prettify/prettify.css";</style>
<script type="text/javascript" src="lib/prettify/prettify.js"></script>
<script type="text/javascript" src="lib/prettify/lang-scala.js"></script>
<script type="text/javascript">//<![CDATA[
jQuery(function(){window.prettyPrint && prettyPrint()});
//]]></script>
<!-- hook for including project specific javascript into the generated docs -->

</body>
</html>
