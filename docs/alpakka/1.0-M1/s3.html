<!DOCTYPE html>
<html class="no-js" lang="en">

<head>
<title>AWS S3 &bull; Alpakka Documentation</title>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<meta name="description" content="Alpakka is a Reactive Enterprise Integration library for Java and Scala, based on Reactive Streams and Akka."/><link rel="canonical" href="https://doc.akka.io/docs/alpakka/current/s3.html"/>
<script type="text/javascript" src="lib/jquery/jquery.min.js"></script>
<script type="text/javascript" src="lib/foundation/dist/js/foundation.min.js"></script>
<link rel="stylesheet" type="text/css" href="lib/normalize.css/normalize.css"/>
<link rel="stylesheet" type="text/css" href="lib/foundation/dist/css/foundation.min.css"/>
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.css" />
<link rel="stylesheet" type="text/css" href="css/icons.css"/>
<link rel="stylesheet" type="text/css" href="css/page.css"/>
<link rel="shortcut icon" href="images/favicon.ico" />
<link rel="apple-touch-icon" sizes="180x180" href="images/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="images/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="images/favicon-16x16.png">
<link rel="manifest" href="images/manifest.json">
<meta name="msapplication-TileImage" content="images/mstile-150x150.png">
<meta name="msapplication-TileColor" content="#15a9ce">
<meta name="theme-color" content="#15a9ce">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<!-- OneTrust Cookies Consent Notice (Production Standard, akka.io, en-GB) start -->
<script src="https://optanon.blob.core.windows.net/consent/159bb13d-6748-4399-806e-ac28db879785.js" type="text/javascript" charset="UTF-8"></script>
<script type="text/javascript">
function OptanonWrapper() { }
</script>
<!-- OneTrust Cookies Consent Notice (Production Standard, akka.io, en-GB) end -->
<!--Google Analytics-->
<script type="text/plain" class="optanon-category-2">
var _gaq = _gaq || [];
_gaq.push(['_setAccount', '']);
_gaq.push(['_setDomainName', '']);
_gaq.push(['_trackPageview']);
(function() {
var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})()
</script>
<script type="text/plain" class="optanon-category-2">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-23127719-1', 'lightbend.com', {'allowLinker': true, 'name': 'tsTracker'});
ga('tsTracker.require', 'linker');
ga('tsTracker.linker:autoLink', ['lightbend.com','playframework.com','scala-lang.org','scaladays.org','spray.io','akka.io','scala-sbt.org','scala-ide.org']);
ga('tsTracker.send', 'pageview');
</script>
<!--Marketo-->
<script type="text/plain" class="optanon-category-3">
(function() {
var didInit = false;
function initMunchkin() {
if(didInit === false) {
didInit = true;
Munchkin.init('558-NCX-702', { 'asyncOnly': true, 'disableClickDelay': true });
}
}
var s = document.createElement('script');
s.type = 'text/javascript';
s.async = true;
s.src = '//munchkin.marketo.net/munchkin.js';
s.onreadystatechange = function() {
if (this.readyState == 'complete' || this.readyState == 'loaded') {
initMunchkin();
}
};
s.onload = initMunchkin;
document.getElementsByTagName('head')[0].appendChild(s);
})();
</script>
</head>

<body id="underlay" data-toggler="nav-open">

<header class="site-header hide-for-large">
<div class="sticky-header clearfix">
<a href="https://akka.io"><img class="logo" src="images/akka-alpakka-reverse.svg"></a>

<button class="menu-icon float-right" type="button" data-toggle="underlay overlay"></button>
</div>
<div id="overlay" class="overlay-nav" data-toggler="nav-open">
<header class="nav-header">
<div class="nav-header-title">
<h1><a href="index.html">Alpakka Documentation</a></h1>
</div>
<div class="nav-header-version">
Version 1.0-M1
</div>
<div class="nav-header-groups">
<select class="supergroup" name="Language"><option class="group" value="group-java">Java</option><option class="group" value="group-scala">Scala</option></select>
</div>
</header>
<nav class="nav-toc">
<ul>
  <li><a href="overview.html" class="page">Overview</a></li>
  <li><a href="data-transformations/index.html" class="page">Data Transformations</a></li>
  <li><a href="amqp.html" class="page">AMQP</a></li>
  <li><a href="external/apache-camel.html" class="page">Apache Camel</a></li>
  <li><a href="cassandra.html" class="page">Apache Cassandra</a></li>
  <li><a href="geode.html" class="page">Apache Geode</a></li>
  <li><a href="kafka.html" class="page">Apache Kafka</a></li>
  <li><a href="kudu.html" class="page">Apache Kudu</a></li>
  <li><a href="solr.html" class="page">Apache Solr</a></li>
  <li><a href="avroparquet.html" class="page">Avro Parquet</a></li>
  <li><a href="dynamodb.html" class="page">AWS DynamoDB</a></li>
  <li><a href="kinesis.html" class="page">AWS Kinesis</a></li>
  <li><a href="awslambda.html" class="page">AWS Lambda</a></li>
  <li><a href="s3.html#aws-s3" class="active page">AWS S3</a>
  <ul>
    <li><a href="s3.html#reported-issues" class="header">Reported issues</a></li>
    <li><a href="s3.html#artifacts" class="header">Artifacts</a></li>
    <li><a href="s3.html#usage" class="header">Usage</a></li>
    <li><a href="s3.html#bluemix-cloud-object-storage-with-s3-api" class="header">Bluemix Cloud Object Storage with S3 API</a></li>
  </ul></li>
  <li><a href="sns.html" class="page">AWS SNS</a></li>
  <li><a href="sqs.html" class="page">AWS SQS</a></li>
  <li><a href="external/azure-event-hubs.html" class="page">Azure Event Hubs</a></li>
  <li><a href="external/azure-iot-hub.html" class="page">Azure IoT Hub</a></li>
  <li><a href="azure-storage-queue.html" class="page">Azure Storage Queue</a></li>
  <li><a href="external/couchbase.html" class="page">Couchbase</a></li>
  <li><a href="elasticsearch.html" class="page">Elasticsearch</a></li>
  <li><a href="external/eventuate.html" class="page">Eventuate</a></li>
  <li><a href="file.html" class="page">Files</a></li>
  <li><a href="external/fs2.html" class="page">FS2</a></li>
  <li><a href="ftp.html" class="page">FTP</a></li>
  <li><a href="google-cloud-pub-sub.html" class="page">Google Cloud Pub/Sub</a></li>
  <li><a href="google-cloud-pub-sub-grpc.html" class="page">Google Cloud Pub/Sub gRPC</a></li>
  <li><a href="google-fcm.html" class="page">Google Firebase Cloud Messaging</a></li>
  <li><a href="external/grpc.html" class="page">gRPC</a></li>
  <li><a href="hdfs.html" class="page">Hadoop Distributed File System - HDFS</a></li>
  <li><a href="hbase.html" class="page">HBase</a></li>
  <li><a href="external/http.html" class="page">HTTP</a></li>
  <li><a href="ironmq.html" class="page">IronMQ</a></li>
  <li><a href="jms.html" class="page">JMS</a></li>
  <li><a href="mongodb.html" class="page">MongoDB</a></li>
  <li><a href="mqtt.html" class="page">MQTT</a></li>
  <li><a href="orientdb.html" class="page">OrientDB</a></li>
  <li><a href="external/pulsar.html" class="page">Pulsar</a></li>
  <li><a href="sse.html" class="page">Server-sent Events (SSE)</a></li>
  <li><a href="slick.html" class="page">Slick (JDBC)</a></li>
  <li><a href="spring-web.html" class="page">Spring Web</a></li>
  <li><a href="external/tcp.html" class="page">TCP</a></li>
  <li><a href="udp.html" class="page">UDP</a></li>
  <li><a href="unix-domain-socket.html" class="page">Unix Domain Socket</a></li>
</ul>
</nav>
</div>
</header>

<aside class="show-for-large">
<header class="nav-header fixed-sidebar-header">
<div class="nav-header-title">
<h1><a href="index.html">Alpakka Documentation</a></h1>
</div>
<div class="nav-header-version">
Version 1.0-M1
</div>
<div class="nav-header-groups">
<select class="supergroup" name="Language"><option class="group" value="group-java">Java</option><option class="group" value="group-scala">Scala</option></select>
</div>
</header>
<nav class="site-nav fixed-sidebar-contents">
<div class="nav-toc">
<ul>
  <li><a href="overview.html" class="page">Overview</a></li>
  <li><a href="data-transformations/index.html" class="page">Data Transformations</a></li>
  <li><a href="amqp.html" class="page">AMQP</a></li>
  <li><a href="external/apache-camel.html" class="page">Apache Camel</a></li>
  <li><a href="cassandra.html" class="page">Apache Cassandra</a></li>
  <li><a href="geode.html" class="page">Apache Geode</a></li>
  <li><a href="kafka.html" class="page">Apache Kafka</a></li>
  <li><a href="kudu.html" class="page">Apache Kudu</a></li>
  <li><a href="solr.html" class="page">Apache Solr</a></li>
  <li><a href="avroparquet.html" class="page">Avro Parquet</a></li>
  <li><a href="dynamodb.html" class="page">AWS DynamoDB</a></li>
  <li><a href="kinesis.html" class="page">AWS Kinesis</a></li>
  <li><a href="awslambda.html" class="page">AWS Lambda</a></li>
  <li><a href="s3.html#aws-s3" class="active page">AWS S3</a>
  <ul>
    <li><a href="s3.html#reported-issues" class="header">Reported issues</a></li>
    <li><a href="s3.html#artifacts" class="header">Artifacts</a></li>
    <li><a href="s3.html#usage" class="header">Usage</a></li>
    <li><a href="s3.html#bluemix-cloud-object-storage-with-s3-api" class="header">Bluemix Cloud Object Storage with S3 API</a></li>
  </ul></li>
  <li><a href="sns.html" class="page">AWS SNS</a></li>
  <li><a href="sqs.html" class="page">AWS SQS</a></li>
  <li><a href="external/azure-event-hubs.html" class="page">Azure Event Hubs</a></li>
  <li><a href="external/azure-iot-hub.html" class="page">Azure IoT Hub</a></li>
  <li><a href="azure-storage-queue.html" class="page">Azure Storage Queue</a></li>
  <li><a href="external/couchbase.html" class="page">Couchbase</a></li>
  <li><a href="elasticsearch.html" class="page">Elasticsearch</a></li>
  <li><a href="external/eventuate.html" class="page">Eventuate</a></li>
  <li><a href="file.html" class="page">Files</a></li>
  <li><a href="external/fs2.html" class="page">FS2</a></li>
  <li><a href="ftp.html" class="page">FTP</a></li>
  <li><a href="google-cloud-pub-sub.html" class="page">Google Cloud Pub/Sub</a></li>
  <li><a href="google-cloud-pub-sub-grpc.html" class="page">Google Cloud Pub/Sub gRPC</a></li>
  <li><a href="google-fcm.html" class="page">Google Firebase Cloud Messaging</a></li>
  <li><a href="external/grpc.html" class="page">gRPC</a></li>
  <li><a href="hdfs.html" class="page">Hadoop Distributed File System - HDFS</a></li>
  <li><a href="hbase.html" class="page">HBase</a></li>
  <li><a href="external/http.html" class="page">HTTP</a></li>
  <li><a href="ironmq.html" class="page">IronMQ</a></li>
  <li><a href="jms.html" class="page">JMS</a></li>
  <li><a href="mongodb.html" class="page">MongoDB</a></li>
  <li><a href="mqtt.html" class="page">MQTT</a></li>
  <li><a href="orientdb.html" class="page">OrientDB</a></li>
  <li><a href="external/pulsar.html" class="page">Pulsar</a></li>
  <li><a href="sse.html" class="page">Server-sent Events (SSE)</a></li>
  <li><a href="slick.html" class="page">Slick (JDBC)</a></li>
  <li><a href="spring-web.html" class="page">Spring Web</a></li>
  <li><a href="external/tcp.html" class="page">TCP</a></li>
  <li><a href="udp.html" class="page">UDP</a></li>
  <li><a href="unix-domain-socket.html" class="page">Unix Domain Socket</a></li>
</ul>
</div>
</nav>
<footer class="nav-footer fixed-sidebar-footer">
<a href="https://akka.io"><img class="logo" src="images/akka-alpakka-reverse.svg"></a>

</footer>
</aside>

<main class="fixed-shift-for-large expanded row">
<section class="site-content small-12 column">

<article class="page-content row">
<div class="small-12 large-9 column" id="docs">
<h1><a href="#aws-s3" name="aws-s3" class="anchor"><span class="anchor-link"></span></a>AWS S3</h1>
<p>The AWS S3 connector provides Akka Stream sources and sinks to connect to <a href="https://aws.amazon.com/s3/">Amazon S3</a>. S3 stands for Simple Storage Service and is an object storage service with a web service interface.</p>
<h3><a href="#reported-issues" name="reported-issues" class="anchor"><span class="anchor-link"></span></a>Reported issues</h3>
<p><a href="https://github.com/akka/alpakka/labels/p%3Aaws-s3">Tagged issues at Github</a></p>
<h2><a href="#artifacts" name="artifacts" class="anchor"><span class="anchor-link"></span></a>Artifacts</h2><dl class="dependency"><dt>sbt</dt><dd><pre class="prettyprint"><code class="language-scala">libraryDependencies += "com.lightbend.akka" %% "akka-stream-alpakka-s3" % "1.0-M1"</code></pre></dd><dt>Maven</dt><dd><pre class="prettyprint"><code class="language-xml">&lt;dependency&gt;
  &lt;groupId&gt;com.lightbend.akka&lt;/groupId&gt;
  &lt;artifactId&gt;akka-stream-alpakka-s3_2.12&lt;/artifactId&gt;
  &lt;version&gt;1.0-M1&lt;/version&gt;
&lt;/dependency&gt;</code></pre></dd><dt>Gradle</dt><dd><pre class="prettyprint"><code class="language-gradle">dependencies {
  compile group: 'com.lightbend.akka', name: 'akka-stream-alpakka-s3_2.12', version: '1.0-M1'
}</code></pre></dd></dl>
<h2><a href="#usage" name="usage" class="anchor"><span class="anchor-link"></span></a>Usage</h2>
<h3><a href="#set-up-your-s3-clients" name="set-up-your-s3-clients" class="anchor"><span class="anchor-link"></span></a>Set up your S3 clients</h3>
<p>The S3 connector can be configured within your <code>application.conf</code> file.</p>
<dl>
  <dt>Configuration</dt>
  <dd>
  <pre class="prettyprint"><code class="language-conf">akka.stream.alpakka.s3 {
  # whether the buffer request chunks (up to 5MB each) to &quot;memory&quot; or &quot;disk&quot;
  buffer = &quot;memory&quot;
  
  # location for temporary files, if buffer is set to &quot;disk&quot;. If empty, uses the standard java temp path.
  disk-buffer-path = &quot;&quot;

  proxy {
    # hostname of the proxy. If undefined (&quot;&quot;) proxy is not enabled.
    host = &quot;&quot;
    port = 8000

    # if &quot;secure&quot; is set to &quot;true&quot; then HTTPS will be used for all requests to S3, otherwise HTTP will be used
    secure = true
  }

  # default values for AWS configuration. If credentials and/or region are not specified when creating S3Client,
  # these values will be used.
  aws {
    # DEPRECATION WARNING
    # Support for settins directly on this level is left for compatibility.
    # It may be removed in future releases.
    # An attempt will be made to read these if no `aws.credentials.*` params
    # will be provided. If you used these parameters, switch to the new format.
    # access-key-id
    # secret-access-key
    # Equivalent config would be:
    # akka.stream.alpakka.s3.aws.credentials {
    #   provider = static
    #   access-key-id = ${old-access-key-id}
    #   secret-access-key = ${old-secret-access-key}
    # }
    # If this section is absent, the fallback behavior is to use the
    # com.amazonaws.auth.DefaultAWSCredentialsProviderChain instance to resolve credentials
    credentials {
      # supported providers:
      # anon - anonymous requests (&quot;no auth&quot;)
      # static - static credentials,
      #   required params:
      #     access-key-id
      #     secret-access-key
      #   optional:
      #     token
      # default: as described in com.amazonaws.auth.DefaultAWSCredentialsProviderChain docs,
      # attempts to get the credentials from either:
      #   - environment variables
      #   - system properties
      #   - credentials file
      #   - EC2 credentials service
      #   - IAM / metadata
      provider = default
    }

    # If this section is absent, the fallback behavior is to use the
    # com.amazonaws.regions.AwsRegionProvider.DefaultAwsRegionProviderChain instance to resolve region
    region {
      # supported providers:
      # static - static credentials,
      #   required params:
      #     default-region
      # default: as described in com.amazonaws.regions.AwsRegionProvider.DefaultAwsRegionProviderChain docs,
      # attempts to get the region from either:
      #   - environment variables
      #   - system properties
      #   - progile file
      #   - EC2 metadata
      provider = default
    }
  }

  # Enable path style access to s3, i.e. &quot;https://s3-eu-west-1.amazonaws.com/my.bucket/myobject&quot;
  # Default is virtual-hosted style.
  # When using virtual hosted–style buckets with SSL, the S3 wild card certificate only matches buckets that do not contain periods.
  # Buckets containing periods will lead to certificate errors. In those cases it&#39;s useful to enable path-style access.
  path-style-access = false

  # Custom endpoint url, used for alternate s3 implementations
  # endpoint-url = null

  # Which version of the list bucket api to use. Set to 1 to use the old style version 1 API.
  # By default the newer version 2 api is used.
  list-bucket-api-version = 2
}</code></pre><a href="https://github.com/akka/alpakka/tree/v1.0-M1/s3/src/main/resources/reference.conf" class="snippet-full-source github">Full source at GitHub</a></dd>
</dl>
<h3><a href="#create-an-s3-client" name="create-an-s3-client" class="anchor"><span class="anchor-link"></span></a>Create an S3 client</h3>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">val awsCredentialsProvider = new AWSStaticCredentialsProvider(
  new BasicAWSCredentials(&quot;my-AWS-access-key-ID&quot;, &quot;my-AWS-password&quot;)
)
val regionProvider =
  new AwsRegionProvider {
    def getRegion: String = &quot;us-east-1&quot;
  }
val proxy = Option(Proxy(&quot;localhost&quot;, port, &quot;http&quot;))
val settings =
  new S3Settings(MemoryBufferType, proxy, awsCredentialsProvider, regionProvider, false, None, ListBucketVersion2)
val s3Client = new S3Client(settings)(system, materializer)</code></pre><a href="https://github.com/akka/alpakka/tree/v1.0-M1/s3/src/test/scala/akka/stream/alpakka/s3/scaladsl/S3SourceSpec.scala#L21-L31" class="snippet-full-source github">Full source at GitHub</a></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><code class="language-java">private final AWSCredentialsProvider credentials =
    new AWSStaticCredentialsProvider(
        new BasicAWSCredentials(&quot;my-AWS-access-key-ID&quot;, &quot;my-AWS-password&quot;));

private AwsRegionProvider regionProvider(String region) {
  return new AwsRegionProvider() {
    @Override
    public String getRegion() throws SdkClientException {
      return region;
    }
  };
};

private final Proxy proxy = new Proxy(&quot;localhost&quot;, port(), &quot;http&quot;);
private final S3Settings settings =
    new S3Settings(
        MemoryBufferType.getInstance(),
        Some.apply(proxy),
        credentials,
        regionProvider(&quot;us-east-1&quot;),
        false,
        scala.Option.empty(),
        ListBucketVersion2.getInstance());
private final S3Client client = new S3Client(settings, system(), materializer);</code></pre><a href="https://github.com/akka/alpakka/tree/v1.0-M1/s3/src/test/java/akka/stream/alpakka/s3/javadsl/S3ClientTest.java#L44-L67" class="snippet-full-source github">Full source at GitHub</a></dd>
</dl>
<h3><a href="#storing-a-file-in-s3" name="storing-a-file-in-s3" class="anchor"><span class="anchor-link"></span></a>Storing a file in S3</h3>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">val s3Sink: Sink[ByteString, Future[MultipartUploadResult]] = s3Client.multipartUpload(bucket, bucketKey)
val s3Sink: Sink[ByteString, Future[MultipartUploadResult]] =
  s3Client.multipartUploadWithHeaders(bucket, bucketKey, s3Headers = Some(S3Headers(ServerSideEncryption.AES256)))</code></pre><a href="https://github.com/akka/alpakka/tree/v1.0-M1/s3/src/test/scala/akka/stream/alpakka/s3/scaladsl/S3SinkSpec.scala#L34-L61" class="snippet-full-source github">Full source at GitHub</a></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><code class="language-java">final Sink&lt;ByteString, CompletionStage&lt;MultipartUploadResult&gt;&gt; sink =
    client.multipartUpload(bucket(), bucketKey());
final Sink&lt;ByteString, CompletionStage&lt;MultipartUploadResult&gt;&gt; sink =
    client.multipartUpload(bucket(), bucketKey(), sseCustomerKeys());</code></pre><a href="https://github.com/akka/alpakka/tree/v1.0-M1/s3/src/test/java/akka/stream/alpakka/s3/javadsl/S3ClientTest.java#L76-L99" class="snippet-full-source github">Full source at GitHub</a></dd>
</dl>
<h3><a href="#downloading-a-file-from-s3" name="downloading-a-file-from-s3" class="anchor"><span class="anchor-link"></span></a>Downloading a file from S3</h3>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">val (s3Source: Source[ByteString, _], _) = s3Client.download(bucket, bucketKey)
val (s3Source, _) = s3Client.download(bucket, bucketKey, sse = Some(sseCustomerKeys))
val (s3Source, metadata) =
  s3Client.download(bucket, bucketKey, versionId = Some(versionId), sse = Some(sseCustomerKeys))</code></pre><a href="https://github.com/akka/alpakka/tree/v1.0-M1/s3/src/test/scala/akka/stream/alpakka/s3/scaladsl/S3SourceSpec.scala#L39-L127" class="snippet-full-source github">Full source at GitHub</a></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><code class="language-java">final Pair&lt;Source&lt;ByteString, NotUsed&gt;, CompletionStage&lt;ObjectMetadata&gt;&gt; sourceAndMeta =
    client.download(bucket(), bucketKey());
final Source&lt;ByteString, NotUsed&gt; source = sourceAndMeta.first();
final Pair&lt;Source&lt;ByteString, NotUsed&gt;, CompletionStage&lt;ObjectMetadata&gt;&gt; sourceAndMeta =
    client.download(bucket(), bucketKey(), sseCustomerKeys());
final Source&lt;ByteString, NotUsed&gt; source = sourceAndMeta.first();
final Pair&lt;Source&lt;ByteString, NotUsed&gt;, CompletionStage&lt;ObjectMetadata&gt;&gt; sourceAndMeta =
    client.download(bucket(), bucketKey(), null, Optional.of(versionId), sseCustomerKeys());
final Source&lt;ByteString, NotUsed&gt; source = sourceAndMeta.first();
final CompletionStage&lt;String&gt; resultCompletionStage =
    source.map(ByteString::utf8String).runWith(Sink.head(), materializer);
final CompletionStage&lt;ObjectMetadata&gt; objectMetadataCompletionStage = sourceAndMeta.second();</code></pre><a href="https://github.com/akka/alpakka/tree/v1.0-M1/s3/src/test/java/akka/stream/alpakka/s3/javadsl/S3ClientTest.java#L120-L218" class="snippet-full-source github">Full source at GitHub</a></dd>
</dl>
<p>In order to download a range of a file&rsquo;s data you can use overloaded method which additionally takes <code>ByteRange</code> as argument.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">val (s3Source: Source[ByteString, _], _) =
  s3Client.download(bucket, bucketKey, Some(ByteRange(bytesRangeStart, bytesRangeEnd)))</code></pre><a href="https://github.com/akka/alpakka/tree/v1.0-M1/s3/src/test/scala/akka/stream/alpakka/s3/scaladsl/S3SourceSpec.scala#L99-L100" class="snippet-full-source github">Full source at GitHub</a></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><code class="language-java">final Pair&lt;Source&lt;ByteString, NotUsed&gt;, CompletionStage&lt;ObjectMetadata&gt;&gt; sourceAndMeta =
    client.download(
        bucket(), bucketKey(), ByteRange.createSlice(bytesRangeStart(), bytesRangeEnd()));
final Source&lt;ByteString, NotUsed&gt; source = sourceAndMeta.first();
final Pair&lt;Source&lt;ByteString, NotUsed&gt;, CompletionStage&lt;ObjectMetadata&gt;&gt; sourceAndMeta =
    client.download(
        bucket(),
        bucketKey(),
        ByteRange.createSlice(bytesRangeStart(), bytesRangeEnd()),
        sseCustomerKeys());
final Source&lt;ByteString, NotUsed&gt; source = sourceAndMeta.first();</code></pre><a href="https://github.com/akka/alpakka/tree/v1.0-M1/s3/src/test/java/akka/stream/alpakka/s3/javadsl/S3ClientTest.java#L234-L260" class="snippet-full-source github">Full source at GitHub</a></dd>
</dl>
<h4><a href="#accessing-object-metadata" name="accessing-object-metadata" class="anchor"><span class="anchor-link"></span></a>Accessing object metadata</h4>
<p>When downloading an object you also get the object&rsquo;s metadata with it. Here&rsquo;s an example of using this metadata to stream an object back to a client in akka http</p>
<pre class="prettyprint"><code class="language-scala">val (data, eventualMeta) = s3Client.download(bucket, objectKey)
complete( eventualMeta.map ( meta ⇒
  HttpResponse(
    entity = HttpEntity(
      meta.contentType.flatMap(ContentType.parse(_).toOption).getOrElse(`application/octet-stream`),
      meta.contentLength,
      data
    )
  )
))
</code></pre>
<h3><a href="#accessing-object-metadata-without-downloading-object-from-s3" name="accessing-object-metadata-without-downloading-object-from-s3" class="anchor"><span class="anchor-link"></span></a>Accessing object metadata without downloading object from S3</h3>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">val metadata = s3Client.getObjectMetadata(bucket, bucketKey)
val metadata = s3Client.getObjectMetadata(bucket, bucketKey, Some(versionId))
val metadata = s3Client.getObjectMetadata(bucket, bucketKey, sse = Some(sseCustomerKeys))</code></pre><a href="https://github.com/akka/alpakka/tree/v1.0-M1/s3/src/test/scala/akka/stream/alpakka/s3/scaladsl/S3SourceSpec.scala#L52-L85" class="snippet-full-source github">Full source at GitHub</a></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><code class="language-java">final CompletionStage&lt;Optional&lt;ObjectMetadata&gt;&gt; source =
    client.getObjectMetadata(bucket(), bucketKey());
final CompletionStage&lt;Optional&lt;ObjectMetadata&gt;&gt; source =
    client.getObjectMetadata(bucket(), bucketKey(), Optional.of(versionId), null);
final CompletionStage&lt;Optional&lt;ObjectMetadata&gt;&gt; source =
    client.getObjectMetadata(bucket(), bucketKey(), sseCustomerKeys());</code></pre><a href="https://github.com/akka/alpakka/tree/v1.0-M1/s3/src/test/java/akka/stream/alpakka/s3/javadsl/S3ClientTest.java#L139-L179" class="snippet-full-source github">Full source at GitHub</a></dd>
</dl>
<h3><a href="#list-bucket-contents" name="list-bucket-contents" class="anchor"><span class="anchor-link"></span></a>List bucket contents</h3>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">val keySource: Source[ListBucketResultContents, NotUsed] = s3Client.listBucket(bucket, Some(listPrefix))</code></pre><a href="https://github.com/akka/alpakka/tree/v1.0-M1/s3/src/test/scala/akka/stream/alpakka/s3/scaladsl/S3SourceSpec.scala#L181" class="snippet-full-source github">Full source at GitHub</a></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><code class="language-java">final Source&lt;ListBucketResultContents, NotUsed&gt; keySource =
    client.listBucket(bucket(), Option.apply(listPrefix()));</code></pre><a href="https://github.com/akka/alpakka/tree/v1.0-M1/s3/src/test/java/akka/stream/alpakka/s3/javadsl/S3ClientTest.java#L277-L278" class="snippet-full-source github">Full source at GitHub</a></dd>
</dl>
<h3><a href="#copy-upload-multi-part-" name="copy-upload-multi-part-" class="anchor"><span class="anchor-link"></span></a>Copy upload (multi part)</h3>
<p>Copy an S3 object from source bucket to target bucket using multi part copy upload.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">val result: Future[MultipartUploadResult] = s3Client.multipartCopy(bucket, bucketKey, targetBucket, targetBucketKey)</code></pre><a href="https://github.com/akka/alpakka/tree/v1.0-M1/s3/src/test/scala/akka/stream/alpakka/s3/scaladsl/S3SinkSpec.scala#L84" class="snippet-full-source github">Full source at GitHub</a></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><code class="language-java">final CompletionStage&lt;MultipartUploadResult&gt; resultCompletionStage =
    client.multipartCopy(
        bucket, sourceKey,
        targetBucket, targetKey);</code></pre><a href="https://github.com/akka/alpakka/tree/v1.0-M1/s3/src/test/java/akka/stream/alpakka/s3/javadsl/S3ClientTest.java#L299-L302" class="snippet-full-source github">Full source at GitHub</a></dd>
</dl>
<h3><a href="#copy-upload-multi-part-a-specific-version-of-source-object" name="copy-upload-multi-part-a-specific-version-of-source-object" class="anchor"><span class="anchor-link"></span></a>Copy upload (multi part) a specific version of source object</h3>
<p>Copy an S3 object from source bucket to target bucket using multi part copy upload. If your bucket has versioning enabled, you could have multiple versions of the same object. By default AWS identifies the current version of the object to copy. You can optionally specify a specific version of the source object to copy by adding the <code>sourceVersionId</code> parameter.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">val result: Future[MultipartUploadResult] =
  s3Client.multipartCopy(bucket,
                         bucketKey,
                         targetBucket,
                         targetBucketKey,
                         sourceVersionId = Some(&quot;3/L4kqtJlcpXroDTDmJ+rmSpXd3dIbrHY+MTRCxf3vjVBH40Nr8X8gdRQBpUMLUo&quot;))</code></pre><a href="https://github.com/akka/alpakka/tree/v1.0-M1/s3/src/test/scala/akka/stream/alpakka/s3/scaladsl/S3SinkSpec.scala#L130-L135" class="snippet-full-source github">Full source at GitHub</a></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><code class="language-java">String sourceVersionId = &quot;3/L4kqtJlcpXroDTDmJ+rmSpXd3dIbrHY+MTRCxf3vjVBH40Nr8X8gdRQBpUMLUo&quot;;
final CompletionStage&lt;MultipartUploadResult&gt; resultCompletionStage =
    client.multipartCopy(
        bucket,
        sourceKey,
        targetBucket,
        targetKey,
        Optional.of(sourceVersionId),
        S3Headers.empty(),
        null // encryption
        );</code></pre><a href="https://github.com/akka/alpakka/tree/v1.0-M1/s3/src/test/java/akka/stream/alpakka/s3/javadsl/S3ClientTest.java#L324-L334" class="snippet-full-source github">Full source at GitHub</a></dd>
</dl>
<h4><a href="#java-examples-with-custom-headers" name="java-examples-with-custom-headers" class="anchor"><span class="anchor-link"></span></a>Java examples with custom headers</h4>
<dl>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><code class="language-java">// setting the encryption to AES256
CompletionStage&lt;MultipartUploadResult&gt; result =
    client.multipartCopy(
        sourceBucket,
        sourceKey,
        targetBucket,
        targetKey,
        S3Headers.empty(),
        ServerSideEncryption.AES256$.MODULE$);

// using canned ACL
CompletionStage&lt;MultipartUploadResult&gt; result =
    client.multipartCopy(
        sourceBucket,
        sourceKey,
        targetBucket,
        targetKey,
        S3Headers.apply(CannedAcl.Private$.MODULE$),
        null // encryption
        );</code></pre><a href="https://github.com/akka/alpakka/tree/v1.0-M1/s3/src/test/java/akka/stream/alpakka/s3/javadsl/JavaExamplesSnippets.java#L59-L84" class="snippet-full-source github">Full source at GitHub</a></dd>
</dl>
<h3><a href="#running-the-example-code" name="running-the-example-code" class="anchor"><span class="anchor-link"></span></a>Running the example code</h3>
<p>The code in this guide is part of runnable tests of this project. You are welcome to edit the code and run it in sbt.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre><code>sbt
&gt; s3/test
</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre><code>sbt
&gt; s3/test
</code></pre></dd>
</dl>
<h1><a href="#bluemix-cloud-object-storage-with-s3-api" name="bluemix-cloud-object-storage-with-s3-api" class="anchor"><span class="anchor-link"></span></a>Bluemix Cloud Object Storage with S3 API</h1>
<p>The Alpakka S3 connector can connect to a range of S3 compatible services. One of them is IBM Bluemix Cloud Object Storage, which supports a dialect of the AWS S3 API. Most functionality provided by the Alpakka S3 connector is compatible with Cloud Object Store, but there are a few limitations, which are listed below.</p>
<h2><a href="#connection-limitations" name="connection-limitations" class="anchor"><span class="anchor-link"></span></a>Connection limitations</h2>
<ul>
  <li>This S3 connector does not support domain-style access for Cloud Object Store, so only path-style access is supported.</li>
  <li>Regions in COS are always part of the host/endpoint, therefore leave the s3Region field in S3Settings empty</li>
  <li>The object proxy, containing host/endpoint, port and scheme, must always be specified.</li>
</ul>
<h2><a href="#external-references" name="external-references" class="anchor"><span class="anchor-link"></span></a>External references</h2>
<p><a href="https://ibm-public-cos.github.io/crs-docs/api-reference">IBM Cloud Object Storage Documentation</a></p>
<h2><a href="#example" name="example" class="anchor"><span class="anchor-link"></span></a>Example</h2>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">val host = &quot;s3.eu-geo.objectstorage.softlayer.net&quot;
val port = 443

val credentialsProvider = new AWSStaticCredentialsProvider(
  new BasicAWSCredentials(
    &quot;myAccessKeyId&quot;,
    &quot;mySecretAccessKey&quot;
  )
)
val regionProvider = new AwsRegionProvider {
  def getRegion = &quot;&quot;
}
val proxy = Some(Proxy(host, port, &quot;https&quot;))

// Set pathStyleAccess to true and specify proxy, leave region blank
val settings =
  new S3Settings(MemoryBufferType, proxy, credentialsProvider, regionProvider, true, None, ListBucketVersion2)
val s3Client = new S3Client(settings)(system, materializer)</code></pre><a href="https://github.com/akka/alpakka/tree/v1.0-M1/s3/src/test/scala/akka/stream/alpakka/s3/scaladsl/DocSnippets.scala#L21-L38" class="snippet-full-source github">Full source at GitHub</a></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><code class="language-java">final String host = &quot;s3.eu-geo.objectstorage.softlayer.net&quot;;
final int port = 443;

final AWSStaticCredentialsProvider credentials =
    new AWSStaticCredentialsProvider(
        new BasicAWSCredentials(&quot;myAccessKeyId&quot;, &quot;mySecretAccessKey&quot;));
final AwsRegionProvider regionProvider =
    new AwsRegionProvider() {
      public String getRegion() {
        return &quot;&quot;;
      }
    };
final Proxy proxy = new Proxy(host, port, &quot;https&quot;);

// Set pathStyleAccess to true and specify proxy, leave region blank
final S3Settings settings =
    new S3Settings(
        MemoryBufferType.getInstance(),
        Some.apply(proxy),
        credentials,
        regionProvider,
        true,
        scala.Option.empty(),
        ListBucketVersion2.getInstance());
final S3Client s3Client = new S3Client(settings, system(), mat);</code></pre><a href="https://github.com/akka/alpakka/tree/v1.0-M1/s3/src/test/java/akka/stream/alpakka/s3/javadsl/DocSnippets.java#L28-L52" class="snippet-full-source github">Full source at GitHub</a></dd>
</dl>
</div>
</article>

<div class="row">
<div class="small-12 large-9 column">
<section class="nav-prev-next row">
<div class="nav-prev small-6 column">
<a href="awslambda.html"><i class="icon-prev"></i> <span class="link-prev">AWS Lambda</span></a>
</div>
<div class="nav-next small-6 column clearfix">
<a class="float-right" href="sns.html">AWS SNS <i class="icon-next"></i></a>
</div>
</section>
</div>
</div>

<div class="source-github row">
Found an error in this documentation? The source code for this page can be found <a href="https://github.com/akka/alpakka/tree/v1.0-M1/docs/src/main/paradox/s3.md">here</a>.
Please feel free to edit and contribute a pull request.
</div>


<footer class="page-footer row clearfix">
<img class="akka-icon float-left show-for-medium" src="images/akka-icon.svg">
<section class="copyright">
<div>Alpakka is Open Source and available under the Apache 2 License.</div>
<p class="legal">
&copy; 2011-2019 <a href="https://www.lightbend.com" target="_blank">Lightbend, Inc.</a> | 
<a href="https://www.lightbend.com/legal/licenses" target="_blank">Licenses</a> | 
<a href="https://www.lightbend.com/legal/terms" target="_blank">Terms</a> | 
<a href="https://www.lightbend.com/legal/privacy" target="_blank">Privacy Policy</a> | 
<a href="https://akka.io/cookie/" target="_blank">Cookie Listing</a> | 
<a class="optanon-toggle-display">Cookie Settings</a>
</p>
</section>
</footer>

</section>
</main>

<script type="text/javascript" src="js/scrollsneak.js"></script>
<script type="text/javascript">jQuery(document).foundation();</script>
<script type="text/javascript" src="js/groups.js"></script>
<script type="text/javascript" src="js/page.js"></script>
<script type="text/javascript" src="js/magellan.js"></script>

<style type="text/css">@import "lib/prettify/prettify.css";</style>
<script type="text/javascript" src="lib/prettify/prettify.js"></script>
<script type="text/javascript" src="lib/prettify/lang-scala.js"></script>
<script type="text/javascript">jQuery(function(){window.prettyPrint && prettyPrint()});</script>

<script type="text/javascript" src="assets/js/warnOldVersion.js"></script>
<script type="text/javascript">jQuery(function(jq){initOldVersionWarnings(jq, '1.0-M1', 'https://doc.akka.io/docs/alpakka/current/')});</script>


</body>
</html>
