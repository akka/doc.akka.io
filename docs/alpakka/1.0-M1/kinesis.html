<!DOCTYPE html>
<html class="no-js" lang="en">

<head>
<title>AWS Kinesis &bull; Alpakka Documentation</title>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<meta name="description" content="Alpakka is a Reactive Enterprise Integration library for Java and Scala, based on Reactive Streams and Akka."/><link rel="canonical" href="https://doc.akka.io/docs/alpakka/current/kinesis.html"/>
<script type="text/javascript" src="lib/jquery/jquery.min.js"></script>
<script type="text/javascript" src="lib/foundation/dist/js/foundation.min.js"></script>
<link rel="stylesheet" type="text/css" href="lib/normalize.css/normalize.css"/>
<link rel="stylesheet" type="text/css" href="lib/foundation/dist/css/foundation.min.css"/>
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.css" />
<link rel="stylesheet" type="text/css" href="css/icons.css"/>
<link rel="stylesheet" type="text/css" href="css/page.css"/>
<link rel="shortcut icon" href="images/favicon.ico" />
<link rel="apple-touch-icon" sizes="180x180" href="images/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="images/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="images/favicon-16x16.png">
<link rel="manifest" href="images/manifest.json">
<meta name="msapplication-TileImage" content="images/mstile-150x150.png">
<meta name="msapplication-TileColor" content="#15a9ce">
<meta name="theme-color" content="#15a9ce">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<!-- OneTrust Cookies Consent Notice (Production Standard, akka.io, en-GB) start -->
<script src="https://optanon.blob.core.windows.net/consent/159bb13d-6748-4399-806e-ac28db879785.js" type="text/javascript" charset="UTF-8"></script>
<script type="text/javascript">
function OptanonWrapper() { }
</script>
<!-- OneTrust Cookies Consent Notice (Production Standard, akka.io, en-GB) end -->
<!--Google Analytics-->
<script type="text/plain" class="optanon-category-2">
var _gaq = _gaq || [];
_gaq.push(['_setAccount', '']);
_gaq.push(['_setDomainName', '']);
_gaq.push(['_trackPageview']);
(function() {
var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})()
</script>
<script type="text/plain" class="optanon-category-2">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-23127719-1', 'lightbend.com', {'allowLinker': true, 'name': 'tsTracker'});
ga('tsTracker.require', 'linker');
ga('tsTracker.linker:autoLink', ['lightbend.com','playframework.com','scala-lang.org','scaladays.org','spray.io','akka.io','scala-sbt.org','scala-ide.org']);
ga('tsTracker.send', 'pageview');
</script>
<!--Marketo-->
<script type="text/plain" class="optanon-category-3">
(function() {
var didInit = false;
function initMunchkin() {
if(didInit === false) {
didInit = true;
Munchkin.init('558-NCX-702', { 'asyncOnly': true, 'disableClickDelay': true });
}
}
var s = document.createElement('script');
s.type = 'text/javascript';
s.async = true;
s.src = '//munchkin.marketo.net/munchkin.js';
s.onreadystatechange = function() {
if (this.readyState == 'complete' || this.readyState == 'loaded') {
initMunchkin();
}
};
s.onload = initMunchkin;
document.getElementsByTagName('head')[0].appendChild(s);
})();
</script>
</head>

<body id="underlay" data-toggler="nav-open">

<header class="site-header hide-for-large">
<div class="sticky-header clearfix">
<a href="https://akka.io"><img class="logo" src="images/akka-alpakka-reverse.svg"></a>

<button class="menu-icon float-right" type="button" data-toggle="underlay overlay"></button>
</div>
<div id="overlay" class="overlay-nav" data-toggler="nav-open">
<header class="nav-header">
<div class="nav-header-title">
<h1><a href="index.html">Alpakka Documentation</a></h1>
</div>
<div class="nav-header-version">
Version 1.0-M1
</div>
<div class="nav-header-groups">
<select class="supergroup" name="Language"><option class="group" value="group-java">Java</option><option class="group" value="group-scala">Scala</option></select>
</div>
</header>
<nav class="nav-toc">
<ul>
  <li><a href="overview.html" class="page">Overview</a></li>
  <li><a href="data-transformations/index.html" class="page">Data Transformations</a></li>
  <li><a href="amqp.html" class="page">AMQP</a></li>
  <li><a href="external/apache-camel.html" class="page">Apache Camel</a></li>
  <li><a href="cassandra.html" class="page">Apache Cassandra</a></li>
  <li><a href="geode.html" class="page">Apache Geode</a></li>
  <li><a href="kafka.html" class="page">Apache Kafka</a></li>
  <li><a href="kudu.html" class="page">Apache Kudu</a></li>
  <li><a href="solr.html" class="page">Apache Solr</a></li>
  <li><a href="avroparquet.html" class="page">Avro Parquet</a></li>
  <li><a href="dynamodb.html" class="page">AWS DynamoDB</a></li>
  <li><a href="kinesis.html#aws-kinesis" class="active page">AWS Kinesis</a>
  <ul>
    <li><a href="kinesis.html#reported-issues" class="header">Reported issues</a></li>
    <li><a href="kinesis.html#artifacts" class="header">Artifacts</a></li>
    <li><a href="kinesis.html#kinesis-data-streams" class="header">Kinesis Data Streams</a></li>
    <li><a href="kinesis.html#kinesis-firehose-streams" class="header">Kinesis Firehose Streams</a></li>
  </ul></li>
  <li><a href="awslambda.html" class="page">AWS Lambda</a></li>
  <li><a href="s3.html" class="page">AWS S3</a></li>
  <li><a href="sns.html" class="page">AWS SNS</a></li>
  <li><a href="sqs.html" class="page">AWS SQS</a></li>
  <li><a href="external/azure-event-hubs.html" class="page">Azure Event Hubs</a></li>
  <li><a href="external/azure-iot-hub.html" class="page">Azure IoT Hub</a></li>
  <li><a href="azure-storage-queue.html" class="page">Azure Storage Queue</a></li>
  <li><a href="external/couchbase.html" class="page">Couchbase</a></li>
  <li><a href="elasticsearch.html" class="page">Elasticsearch</a></li>
  <li><a href="external/eventuate.html" class="page">Eventuate</a></li>
  <li><a href="file.html" class="page">Files</a></li>
  <li><a href="external/fs2.html" class="page">FS2</a></li>
  <li><a href="ftp.html" class="page">FTP</a></li>
  <li><a href="google-cloud-pub-sub.html" class="page">Google Cloud Pub/Sub</a></li>
  <li><a href="google-cloud-pub-sub-grpc.html" class="page">Google Cloud Pub/Sub gRPC</a></li>
  <li><a href="google-fcm.html" class="page">Google Firebase Cloud Messaging</a></li>
  <li><a href="external/grpc.html" class="page">gRPC</a></li>
  <li><a href="hdfs.html" class="page">Hadoop Distributed File System - HDFS</a></li>
  <li><a href="hbase.html" class="page">HBase</a></li>
  <li><a href="external/http.html" class="page">HTTP</a></li>
  <li><a href="ironmq.html" class="page">IronMQ</a></li>
  <li><a href="jms.html" class="page">JMS</a></li>
  <li><a href="mongodb.html" class="page">MongoDB</a></li>
  <li><a href="mqtt.html" class="page">MQTT</a></li>
  <li><a href="orientdb.html" class="page">OrientDB</a></li>
  <li><a href="external/pulsar.html" class="page">Pulsar</a></li>
  <li><a href="sse.html" class="page">Server-sent Events (SSE)</a></li>
  <li><a href="slick.html" class="page">Slick (JDBC)</a></li>
  <li><a href="spring-web.html" class="page">Spring Web</a></li>
  <li><a href="external/tcp.html" class="page">TCP</a></li>
  <li><a href="udp.html" class="page">UDP</a></li>
  <li><a href="unix-domain-socket.html" class="page">Unix Domain Socket</a></li>
</ul>
</nav>
</div>
</header>

<aside class="show-for-large">
<header class="nav-header fixed-sidebar-header">
<div class="nav-header-title">
<h1><a href="index.html">Alpakka Documentation</a></h1>
</div>
<div class="nav-header-version">
Version 1.0-M1
</div>
<div class="nav-header-groups">
<select class="supergroup" name="Language"><option class="group" value="group-java">Java</option><option class="group" value="group-scala">Scala</option></select>
</div>
</header>
<nav class="site-nav fixed-sidebar-contents">
<div class="nav-toc">
<ul>
  <li><a href="overview.html" class="page">Overview</a></li>
  <li><a href="data-transformations/index.html" class="page">Data Transformations</a></li>
  <li><a href="amqp.html" class="page">AMQP</a></li>
  <li><a href="external/apache-camel.html" class="page">Apache Camel</a></li>
  <li><a href="cassandra.html" class="page">Apache Cassandra</a></li>
  <li><a href="geode.html" class="page">Apache Geode</a></li>
  <li><a href="kafka.html" class="page">Apache Kafka</a></li>
  <li><a href="kudu.html" class="page">Apache Kudu</a></li>
  <li><a href="solr.html" class="page">Apache Solr</a></li>
  <li><a href="avroparquet.html" class="page">Avro Parquet</a></li>
  <li><a href="dynamodb.html" class="page">AWS DynamoDB</a></li>
  <li><a href="kinesis.html#aws-kinesis" class="active page">AWS Kinesis</a>
  <ul>
    <li><a href="kinesis.html#reported-issues" class="header">Reported issues</a></li>
    <li><a href="kinesis.html#artifacts" class="header">Artifacts</a></li>
    <li><a href="kinesis.html#kinesis-data-streams" class="header">Kinesis Data Streams</a></li>
    <li><a href="kinesis.html#kinesis-firehose-streams" class="header">Kinesis Firehose Streams</a></li>
  </ul></li>
  <li><a href="awslambda.html" class="page">AWS Lambda</a></li>
  <li><a href="s3.html" class="page">AWS S3</a></li>
  <li><a href="sns.html" class="page">AWS SNS</a></li>
  <li><a href="sqs.html" class="page">AWS SQS</a></li>
  <li><a href="external/azure-event-hubs.html" class="page">Azure Event Hubs</a></li>
  <li><a href="external/azure-iot-hub.html" class="page">Azure IoT Hub</a></li>
  <li><a href="azure-storage-queue.html" class="page">Azure Storage Queue</a></li>
  <li><a href="external/couchbase.html" class="page">Couchbase</a></li>
  <li><a href="elasticsearch.html" class="page">Elasticsearch</a></li>
  <li><a href="external/eventuate.html" class="page">Eventuate</a></li>
  <li><a href="file.html" class="page">Files</a></li>
  <li><a href="external/fs2.html" class="page">FS2</a></li>
  <li><a href="ftp.html" class="page">FTP</a></li>
  <li><a href="google-cloud-pub-sub.html" class="page">Google Cloud Pub/Sub</a></li>
  <li><a href="google-cloud-pub-sub-grpc.html" class="page">Google Cloud Pub/Sub gRPC</a></li>
  <li><a href="google-fcm.html" class="page">Google Firebase Cloud Messaging</a></li>
  <li><a href="external/grpc.html" class="page">gRPC</a></li>
  <li><a href="hdfs.html" class="page">Hadoop Distributed File System - HDFS</a></li>
  <li><a href="hbase.html" class="page">HBase</a></li>
  <li><a href="external/http.html" class="page">HTTP</a></li>
  <li><a href="ironmq.html" class="page">IronMQ</a></li>
  <li><a href="jms.html" class="page">JMS</a></li>
  <li><a href="mongodb.html" class="page">MongoDB</a></li>
  <li><a href="mqtt.html" class="page">MQTT</a></li>
  <li><a href="orientdb.html" class="page">OrientDB</a></li>
  <li><a href="external/pulsar.html" class="page">Pulsar</a></li>
  <li><a href="sse.html" class="page">Server-sent Events (SSE)</a></li>
  <li><a href="slick.html" class="page">Slick (JDBC)</a></li>
  <li><a href="spring-web.html" class="page">Spring Web</a></li>
  <li><a href="external/tcp.html" class="page">TCP</a></li>
  <li><a href="udp.html" class="page">UDP</a></li>
  <li><a href="unix-domain-socket.html" class="page">Unix Domain Socket</a></li>
</ul>
</div>
</nav>
<footer class="nav-footer fixed-sidebar-footer">
<a href="https://akka.io"><img class="logo" src="images/akka-alpakka-reverse.svg"></a>

</footer>
</aside>

<main class="fixed-shift-for-large expanded row">
<section class="site-content small-12 column">

<article class="page-content row">
<div class="small-12 large-9 column" id="docs">
<h1><a href="#aws-kinesis" name="aws-kinesis" class="anchor"><span class="anchor-link"></span></a>AWS Kinesis</h1>
<p>The AWS Kinesis connector provides flows for streaming data to and from Kinesis Data streams and to Kinesis Firehose streams.</p>
<p>For more information about Kinesis please visit the <a href="https://aws.amazon.com/documentation/kinesis/">Kinesis documentation</a>.</p><div class="callout note "><div class="callout-title">Alternative connector 1</div>
<p>Another Kinesis connector which is based on the Kinesis Client Library is available.</p>
<p>The KCL Source can read from several shards and rebalance automatically when other Workers are started or stopped. It also handles record sequence checkpoints.</p>
<p>Please read more about it at <a href="https://github.com/aserrallerios/kcl-akka-stream">GitHub aserrallerios/kcl-akka-stream</a>.</p></div><div class="callout note "><div class="callout-title">Alternative connector 2</div>
<p>Another Kinesis connector which is based on the Kinesis Client Library is available.</p>
<p>This library combines the convenience of Akka Streams with KCL checkpoint management, failover, load-balancing, and re-sharding capabilities.</p>
<p>Please read more about it at <a href="https://github.com/StreetContxt/kcl-akka-stream">GitHub StreetContxt/kcl-akka-stream</a>.</p></div>
<h3><a href="#reported-issues" name="reported-issues" class="anchor"><span class="anchor-link"></span></a>Reported issues</h3>
<p><a href="https://github.com/akka/alpakka/labels/p%3Akinesis">Tagged issues at Github</a></p>
<h2><a href="#artifacts" name="artifacts" class="anchor"><span class="anchor-link"></span></a>Artifacts</h2><dl class="dependency"><dt>sbt</dt><dd><pre class="prettyprint"><code class="language-scala">libraryDependencies += "com.lightbend.akka" %% "akka-stream-alpakka-kinesis" % "1.0-M1"</code></pre></dd><dt>Maven</dt><dd><pre class="prettyprint"><code class="language-xml">&lt;dependency&gt;
  &lt;groupId&gt;com.lightbend.akka&lt;/groupId&gt;
  &lt;artifactId&gt;akka-stream-alpakka-kinesis_2.12&lt;/artifactId&gt;
  &lt;version&gt;1.0-M1&lt;/version&gt;
&lt;/dependency&gt;</code></pre></dd><dt>Gradle</dt><dd><pre class="prettyprint"><code class="language-gradle">dependencies {
  compile group: 'com.lightbend.akka', name: 'akka-stream-alpakka-kinesis_2.12', version: '1.0-M1'
}</code></pre></dd></dl>
<h2><a href="#kinesis-data-streams" name="kinesis-data-streams" class="anchor"><span class="anchor-link"></span></a>Kinesis Data Streams</h2>
<h3><a href="#create-the-kinesis-client" name="create-the-kinesis-client" class="anchor"><span class="anchor-link"></span></a>Create the Kinesis client</h3>
<p>Sources and Flows provided by this connector need a <code>AmazonKinesisAsync</code> instance to consume messages from a shard.</p><div class="callout note "><div class="callout-title">Note</div>
<p>The <code>AmazonKinesisAsync</code> instance you supply is thread-safe and can be shared amongst multiple <code>GraphStages</code>. As a result, individual <code>GraphStages</code> will not automatically shutdown the supplied client when they complete. It is recommended to shut the client instance down on Actor system termination.</p></div>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">implicit val system: ActorSystem = ActorSystem()
implicit val materializer: Materializer = ActorMaterializer()

implicit val amazonKinesisAsync: com.amazonaws.services.kinesis.AmazonKinesisAsync =
  AmazonKinesisAsyncClientBuilder.defaultClient()

system.registerOnTermination(amazonKinesisAsync.shutdown())</code></pre><a href="https://github.com/akka/alpakka/tree/v1.0-M1/kinesis/src/test/scala/akka/stream/alpakka/kinesis/scaladsl/Examples.scala#L24-L30" class="snippet-full-source github">Full source at GitHub</a></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><code class="language-java">final ActorSystem system = ActorSystem.create();
final ActorMaterializer materializer = ActorMaterializer.create(system);

final com.amazonaws.services.kinesis.AmazonKinesisAsync amazonKinesisAsync =
    AmazonKinesisAsyncClientBuilder.defaultClient();

  system.registerOnTermination(amazonKinesisAsync::shutdown);</code></pre><a href="https://github.com/akka/alpakka/tree/v1.0-M1/kinesis/src/test/java/akka/stream/alpakka/kinesis/javadsl/Examples.java#L30-L40" class="snippet-full-source github">Full source at GitHub</a></dd>
</dl>
<h3><a href="#kinesis-as-source" name="kinesis-as-source" class="anchor"><span class="anchor-link"></span></a>Kinesis as Source</h3>
<p>The <code>KinesisSource</code> creates one <code>GraphStage</code> per shard. Reading from a shard requires an instance of <code>ShardSettings</code>.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">val settings = ShardSettings(streamName = &quot;myStreamName&quot;,
                             shardId = &quot;shard-id&quot;,
                             shardIteratorType = ShardIteratorType.TRIM_HORIZON,
                             refreshInterval = 1.second,
                             limit = 500)</code></pre><a href="https://github.com/akka/alpakka/tree/v1.0-M1/kinesis/src/test/scala/akka/stream/alpakka/kinesis/scaladsl/Examples.scala#L34-L38" class="snippet-full-source github">Full source at GitHub</a></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><code class="language-java">final ShardSettings settings =
    ShardSettings.create(&quot;streamName&quot;, &quot;shard-id&quot;)
        .withShardIteratorType(ShardIteratorType.LATEST)
        .withRefreshInterval(1L, TimeUnit.SECONDS)
        .withLimit(500);</code></pre><a href="https://github.com/akka/alpakka/tree/v1.0-M1/kinesis/src/test/java/akka/stream/alpakka/kinesis/javadsl/Examples.java#L45-L49" class="snippet-full-source github">Full source at GitHub</a></dd>
</dl>
<p>You have the choice of reading from a single shard, or reading from multiple shards. In the case of multiple shards the results of running a separate <code>GraphStage</code> for each shard will be merged together.</p><div class="callout warning "><div class="callout-title">Warning</div>
<p>The <code>GraphStage</code> associated with a shard will remain open until the graph is stopped, or a <a href="http://docs.aws.amazon.com/kinesis/latest/APIReference/API_GetRecords.html">GetRecords</a> result returns an empty shard iterator indicating that the shard has been closed. This means that if you wish to continue processing records after a merge or reshard, you will need to recreate the source with the results of a new <a href="http://docs.aws.amazon.com/kinesis/latest/APIReference/API_DescribeStream.html">DescribeStream</a> request, which can be done by simply creating a new <code>KinesisSource</code>. You can read more about adapting to a reshard <a href="http://docs.aws.amazon.com/streams/latest/dev/developing-consumers-with-sdk.html">here</a>.</p></div>
<p>For a single shard you simply provide the settings for a single shard.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">val source: Source[com.amazonaws.services.kinesis.model.Record, NotUsed] =
  KinesisSource.basic(settings, amazonKinesisAsync)</code></pre><a href="https://github.com/akka/alpakka/tree/v1.0-M1/kinesis/src/test/scala/akka/stream/alpakka/kinesis/scaladsl/Examples.scala#L42-L43" class="snippet-full-source github">Full source at GitHub</a></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><code class="language-java">final Source&lt;com.amazonaws.services.kinesis.model.Record, NotUsed&gt; source =
    KinesisSource.basic(settings, amazonKinesisAsync);</code></pre><a href="https://github.com/akka/alpakka/tree/v1.0-M1/kinesis/src/test/java/akka/stream/alpakka/kinesis/javadsl/Examples.java#L53-L54" class="snippet-full-source github">Full source at GitHub</a></dd>
</dl>
<p>You can merge multiple shards by providing a list settings.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">val mergeSettings = List(
  ShardSettings(&quot;myStreamName&quot;,
                &quot;shard-id-1&quot;,
                ShardIteratorType.AT_SEQUENCE_NUMBER,
                startingSequenceNumber = Some(&quot;sequence&quot;),
                refreshInterval = 1.second,
                limit = 500),
  ShardSettings(&quot;myStreamName&quot;,
                &quot;shard-id-2&quot;,
                ShardIteratorType.AT_TIMESTAMP,
                atTimestamp = Some(new Date()),
                refreshInterval = 1.second,
                limit = 500)
)

val mergedSource: Source[Record, NotUsed] = KinesisSource.basicMerge(mergeSettings, amazonKinesisAsync)</code></pre><a href="https://github.com/akka/alpakka/tree/v1.0-M1/kinesis/src/test/scala/akka/stream/alpakka/kinesis/scaladsl/Examples.scala#L47-L62" class="snippet-full-source github">Full source at GitHub</a></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><code class="language-java">final Source&lt;Record, NotUsed&gt; two =
    KinesisSource.basicMerge(Arrays.asList(settings), amazonKinesisAsync);</code></pre><a href="https://github.com/akka/alpakka/tree/v1.0-M1/kinesis/src/test/java/akka/stream/alpakka/kinesis/javadsl/Examples.java#L58-L59" class="snippet-full-source github">Full source at GitHub</a></dd>
</dl>
<p>The constructed <code>Source</code> will return <a href="http://docs.aws.amazon.com/kinesis/latest/APIReference/API_Record.html">Record</a> objects by calling <a href="http://docs.aws.amazon.com/kinesis/latest/APIReference/API_GetRecords.html">GetRecords</a> at the specified interval and according to the downstream demand.</p>
<h3><a href="#kinesis-put-via-flow-or-as-sink" name="kinesis-put-via-flow-or-as-sink" class="anchor"><span class="anchor-link"></span></a>Kinesis Put via Flow or as Sink</h3>
<p>The <span class="group-scala"><a href="https://doc.akka.io/api/alpakka/1.0-M1/akka/stream/alpakka/kinesis/scaladsl/KinesisFlow.html">KinesisFlow</a> (or <a href="https://doc.akka.io/api/alpakka/1.0-M1/akka/stream/alpakka/kinesis/scaladsl/KinesisSink$.html">KinesisSink</a>)</span> <span class="group-java"><a href="https://doc.akka.io/api/alpakka/1.0-M1/akka/stream/alpakka/kinesis/javadsl/KinesisFlow$.html">KinesisFlow</a> (or <a href="https://doc.akka.io/api/alpakka/1.0-M1/akka/stream/alpakka/kinesis/javadsl/KinesisSink$.html">KinesisSink</a>)</span> publishes messages into a Kinesis stream using its partition key and message body. It uses dynamic size batches, can perform several requests in parallel and retries failed records. These features are necessary to achieve the best possible write throughput to the stream. The Flow outputs the result of publishing each record.</p><div class="callout warning "><div class="callout-title">Warning</div>
<p>Batching has a drawback: message order cannot be guaranteed, as some records within a single batch may fail to be published. That also means that the Flow output may not match the same input order.</p>
<p>More information can be found <a href="http://docs.aws.amazon.com/streams/latest/dev/developing-producers-with-sdk.html#kinesis-using-sdk-java-putrecords">here</a> and <a href="http://docs.aws.amazon.com/kinesis/latest/APIReference/API_PutRecords.html">here</a>.</p></div>
<p>In order to correlate the results with the original message, an optional user context object of arbitrary type can be associated with every message and will be returned with the corresponding result. This allows keeping track of which messages have been successfully sent to Kinesis even if the message order gets mixed up.</p>
<p>Publishing to a Kinesis stream requires an instance of <code>KinesisFlowSettings</code>, although a default instance with sane values and a method that returns settings based on the stream shard number are also available:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">val flowSettings = KinesisFlowSettings(
  parallelism = 1,
  maxBatchSize = 500,
  maxRecordsPerSecond = 1000,
  maxBytesPerSecond = 1000000,
  maxRetries = 5,
  backoffStrategy = KinesisFlowSettings.Exponential,
  retryInitialTimeout = 100.millis
)

val defaultFlowSettings = KinesisFlowSettings.defaultInstance

val fourShardFlowSettings = KinesisFlowSettings.byNumberOfShards(4)</code></pre><a href="https://github.com/akka/alpakka/tree/v1.0-M1/kinesis/src/test/scala/akka/stream/alpakka/kinesis/scaladsl/Examples.scala#L66-L78" class="snippet-full-source github">Full source at GitHub</a></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><code class="language-java">final KinesisFlowSettings flowSettings =
    KinesisFlowSettings.create()
        .withParallelism(1)
        .withMaxBatchSize(500)
        .withMaxRecordsPerSecond(1_000)
        .withMaxBytesPerSecond(1_000_000)
        .withMaxRecordsPerSecond(5)
        .withBackoffStrategyExponential()
        .withRetryInitialTimeout(100L, TimeUnit.MILLISECONDS);

final KinesisFlowSettings defaultFlowSettings = KinesisFlowSettings.create();

final KinesisFlowSettings fourShardFlowSettings = KinesisFlowSettings.byNumberOfShards(4);</code></pre><a href="https://github.com/akka/alpakka/tree/v1.0-M1/kinesis/src/test/java/akka/stream/alpakka/kinesis/javadsl/Examples.java#L63-L75" class="snippet-full-source github">Full source at GitHub</a></dd>
</dl><div class="callout warning "><div class="callout-title">Warning</div>
<p>Note that throughput settings <code>maxRecordsPerSecond</code> and <code>maxBytesPerSecond</code> are vital to minimize server errors (like <code>ProvisionedThroughputExceededException</code>) and retries, and thus achieve a higher publication rate.</p></div>
<p>The Flow/Sink can now be created.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">val flow1: Flow[PutRecordsRequestEntry, PutRecordsResultEntry, NotUsed] = KinesisFlow(&quot;myStreamName&quot;)

val flow2: Flow[PutRecordsRequestEntry, PutRecordsResultEntry, NotUsed] = KinesisFlow(&quot;myStreamName&quot;, flowSettings)

val flow3: Flow[(PutRecordsRequestEntry, String), (PutRecordsResultEntry, String), NotUsed] =
  KinesisFlow.withUserContext(&quot;myStreamName&quot;)

val flow4: Flow[(PutRecordsRequestEntry, String), (PutRecordsResultEntry, String), NotUsed] =
  KinesisFlow.withUserContext(&quot;myStreamName&quot;, flowSettings)

val flow5: Flow[(String, ByteString), PutRecordsResultEntry, NotUsed] =
  KinesisFlow.byPartitionAndBytes(&quot;myStreamName&quot;)

val flow6: Flow[(String, ByteBuffer), PutRecordsResultEntry, NotUsed] =
  KinesisFlow.byPartitionAndData(&quot;myStreamName&quot;)

val sink1: Sink[PutRecordsRequestEntry, NotUsed] = KinesisSink(&quot;myStreamName&quot;)
val sink2: Sink[PutRecordsRequestEntry, NotUsed] = KinesisSink(&quot;myStreamName&quot;, flowSettings)
val sink3: Sink[(String, ByteString), NotUsed] = KinesisSink.byPartitionAndBytes(&quot;myStreamName&quot;)
val sink4: Sink[(String, ByteBuffer), NotUsed] = KinesisSink.byPartitionAndData(&quot;myStreamName&quot;)</code></pre><a href="https://github.com/akka/alpakka/tree/v1.0-M1/kinesis/src/test/scala/akka/stream/alpakka/kinesis/scaladsl/Examples.scala#L82-L101" class="snippet-full-source github">Full source at GitHub</a></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><code class="language-java">final Flow&lt;PutRecordsRequestEntry, PutRecordsResultEntry, NotUsed&gt; flow =
    KinesisFlow.apply(&quot;streamName&quot;, flowSettings, amazonKinesisAsync);

final Flow&lt;PutRecordsRequestEntry, PutRecordsResultEntry, NotUsed&gt; defaultSettingsFlow =
    KinesisFlow.apply(&quot;streamName&quot;, amazonKinesisAsync);

final Flow&lt;Pair&lt;PutRecordsRequestEntry, String&gt;, Pair&lt;PutRecordsResultEntry, String&gt;, NotUsed&gt;
    flowWithStringContext =
        KinesisFlow.withUserContext(&quot;streamName&quot;, flowSettings, amazonKinesisAsync);

final Flow&lt;Pair&lt;PutRecordsRequestEntry, String&gt;, Pair&lt;PutRecordsResultEntry, String&gt;, NotUsed&gt;
    defaultSettingsFlowWithStringContext =
        KinesisFlow.withUserContext(&quot;streamName&quot;, flowSettings, amazonKinesisAsync);

final Sink&lt;PutRecordsRequestEntry, NotUsed&gt; sink =
    KinesisSink.apply(&quot;streamName&quot;, flowSettings, amazonKinesisAsync);

final Sink&lt;PutRecordsRequestEntry, NotUsed&gt; defaultSettingsSink =
    KinesisSink.apply(&quot;streamName&quot;, amazonKinesisAsync);</code></pre><a href="https://github.com/akka/alpakka/tree/v1.0-M1/kinesis/src/test/java/akka/stream/alpakka/kinesis/javadsl/Examples.java#L79-L97" class="snippet-full-source github">Full source at GitHub</a></dd>
</dl>
<h2><a href="#kinesis-firehose-streams" name="kinesis-firehose-streams" class="anchor"><span class="anchor-link"></span></a>Kinesis Firehose Streams</h2>
<h3><a href="#create-the-kinesis-firehose-client" name="create-the-kinesis-firehose-client" class="anchor"><span class="anchor-link"></span></a>Create the Kinesis Firehose client</h3>
<p>Flows provided by this connector need a <code>AmazonKinesisFirehoseAsync</code> instance to publish messages.</p><div class="callout note "><div class="callout-title">Note</div>
<p>The <code>AmazonKinesisFirehoseAsync</code> instance you supply is thread-safe and can be shared amongst multiple <code>GraphStages</code>. As a result, individual <code>GraphStages</code> will not automatically shutdown the supplied client when they complete. It is recommended to shut the client instance down on Actor system termination.</p></div>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">implicit val system: ActorSystem = ActorSystem()
implicit val materializer: Materializer = ActorMaterializer()

implicit val amazonKinesisFirehoseAsync: com.amazonaws.services.kinesisfirehose.AmazonKinesisFirehoseAsync =
  AmazonKinesisFirehoseAsyncClientBuilder.defaultClient()

system.registerOnTermination(amazonKinesisFirehoseAsync.shutdown())</code></pre><a href="https://github.com/akka/alpakka/tree/v1.0-M1/kinesis/src/test/scala/akka/stream/alpakka/kinesisfirehose/scaladsl/Examples.scala#L20-L26" class="snippet-full-source github">Full source at GitHub</a></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><code class="language-java">final ActorSystem system = ActorSystem.create();
final ActorMaterializer materializer = ActorMaterializer.create(system);

final com.amazonaws.services.kinesisfirehose.AmazonKinesisFirehoseAsync
    amazonKinesisFirehoseAsync = AmazonKinesisFirehoseAsyncClientBuilder.defaultClient();

  system.registerOnTermination(amazonKinesisFirehoseAsync::shutdown);</code></pre><a href="https://github.com/akka/alpakka/tree/v1.0-M1/kinesis/src/test/java/akka/stream/alpakka/kinesisfirehose/javadsl/Examples.java#L22-L32" class="snippet-full-source github">Full source at GitHub</a></dd>
</dl>
<h3><a href="#kinesis-put-via-flow-or-as-sink" name="kinesis-put-via-flow-or-as-sink" class="anchor"><span class="anchor-link"></span></a>Kinesis Put via Flow or as Sink</h3>
<p>The <span class="group-scala"><a href="https://doc.akka.io/api/alpakka/1.0-M1/akka/stream/alpakka/kinesisfirehose/scaladsl/KinesisFirehoseFlow.html">KinesisFirehoseFlow</a> (or <a href="https://doc.akka.io/api/alpakka/1.0-M1/akka/stream/alpakka/kinesisfirehose/scaladsl/KinesisFirehoseSink$.html">KinesisFirehoseSink</a>)</span> <span class="group-java"><a href="https://doc.akka.io/api/alpakka/1.0-M1/akka/stream/alpakka/kinesisfirehose/javadsl/KinesisFirehoseFlow$.html">KinesisFirehoseFlow</a> (or <a href="https://doc.akka.io/api/alpakka/1.0-M1/akka/stream/alpakka/kinesisfirehose/javadsl/KinesisFirehoseSink$.html">KinesisFirehoseSink</a>)</span> publishes messages into a Kinesis Firehose stream using its message body. It uses dynamic size batches, can perform several requests in parallel and retries failed records. These features are necessary to achieve the best possible write throughput to the stream. The Flow outputs the result of publishing each record.</p><div class="callout warning "><div class="callout-title">Warning</div>
<p>Batching has a drawback: message order cannot be guaranteed, as some records within a single batch may fail to be published. That also means that the Flow output may not match the same input order.</p>
<p>More information can be found <a href="https://docs.aws.amazon.com/firehose/latest/APIReference/API_PutRecordBatch.html">here</a>.</p></div>
<p>Publishing to a Kinesis Firehose stream requires an instance of <code>KinesisFirehoseFlowSettings</code>, although a default instance with sane values is available:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">val flowSettings = KinesisFirehoseFlowSettings(
  parallelism = 1,
  maxBatchSize = 500,
  maxRecordsPerSecond = 5000,
  maxBytesPerSecond = 4000000,
  maxRetries = 5,
  backoffStrategy = KinesisFirehoseFlowSettings.Exponential,
  retryInitialTimeout = 100.millis
)

val defaultFlowSettings = KinesisFirehoseFlowSettings.defaultInstance</code></pre><a href="https://github.com/akka/alpakka/tree/v1.0-M1/kinesis/src/test/scala/akka/stream/alpakka/kinesisfirehose/scaladsl/Examples.scala#L30-L40" class="snippet-full-source github">Full source at GitHub</a></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><code class="language-java">final KinesisFirehoseFlowSettings flowSettings =
    KinesisFirehoseFlowSettings.create()
        .withParallelism(1)
        .withMaxBatchSize(500)
        .withMaxRecordsPerSecond(1_000)
        .withMaxBytesPerSecond(1_000_000)
        .withMaxRecordsPerSecond(5)
        .withBackoffStrategyExponential()
        .withRetryInitialTimeout(100L, TimeUnit.MILLISECONDS);

final KinesisFirehoseFlowSettings defaultFlowSettings = KinesisFirehoseFlowSettings.create();</code></pre><a href="https://github.com/akka/alpakka/tree/v1.0-M1/kinesis/src/test/java/akka/stream/alpakka/kinesisfirehose/javadsl/Examples.java#L37-L47" class="snippet-full-source github">Full source at GitHub</a></dd>
</dl><div class="callout warning "><div class="callout-title">Warning</div>
<p>Note that throughput settings <code>maxRecordsPerSecond</code> and <code>maxBytesPerSecond</code> are vital to minimize server errors (like <code>ProvisionedThroughputExceededException</code>) and retries, and thus achieve a higher publication rate.</p></div>
<p>The Flow/Sink can now be created.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">val flow1: Flow[Record, PutRecordBatchResponseEntry, NotUsed] = KinesisFirehoseFlow(&quot;myStreamName&quot;)

val flow2: Flow[Record, PutRecordBatchResponseEntry, NotUsed] = KinesisFirehoseFlow(&quot;myStreamName&quot;, flowSettings)

val sink1: Sink[Record, NotUsed] = KinesisFirehoseSink(&quot;myStreamName&quot;)
val sink2: Sink[Record, NotUsed] = KinesisFirehoseSink(&quot;myStreamName&quot;, flowSettings)</code></pre><a href="https://github.com/akka/alpakka/tree/v1.0-M1/kinesis/src/test/scala/akka/stream/alpakka/kinesisfirehose/scaladsl/Examples.scala#L44-L49" class="snippet-full-source github">Full source at GitHub</a></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><code class="language-java">final Flow&lt;Record, PutRecordBatchResponseEntry, NotUsed&gt; flow =
    KinesisFirehoseFlow.apply(&quot;streamName&quot;, flowSettings, amazonKinesisFirehoseAsync);

final Flow&lt;Record, PutRecordBatchResponseEntry, NotUsed&gt; defaultSettingsFlow =
    KinesisFirehoseFlow.apply(&quot;streamName&quot;, amazonKinesisFirehoseAsync);

final Sink&lt;Record, NotUsed&gt; sink =
    KinesisFirehoseSink.apply(&quot;streamName&quot;, flowSettings, amazonKinesisFirehoseAsync);

final Sink&lt;Record, NotUsed&gt; defaultSettingsSink =
    KinesisFirehoseSink.apply(&quot;streamName&quot;, amazonKinesisFirehoseAsync);</code></pre><a href="https://github.com/akka/alpakka/tree/v1.0-M1/kinesis/src/test/java/akka/stream/alpakka/kinesisfirehose/javadsl/Examples.java#L51-L61" class="snippet-full-source github">Full source at GitHub</a></dd>
</dl>
</div>
</article>

<div class="row">
<div class="small-12 large-9 column">
<section class="nav-prev-next row">
<div class="nav-prev small-6 column">
<a href="dynamodb.html"><i class="icon-prev"></i> <span class="link-prev">AWS DynamoDB</span></a>
</div>
<div class="nav-next small-6 column clearfix">
<a class="float-right" href="awslambda.html">AWS Lambda <i class="icon-next"></i></a>
</div>
</section>
</div>
</div>

<div class="source-github row">
Found an error in this documentation? The source code for this page can be found <a href="https://github.com/akka/alpakka/tree/v1.0-M1/docs/src/main/paradox/kinesis.md">here</a>.
Please feel free to edit and contribute a pull request.
</div>


<footer class="page-footer row clearfix">
<img class="akka-icon float-left show-for-medium" src="images/akka-icon.svg">
<section class="copyright">
<div>Alpakka is Open Source and available under the Apache 2 License.</div>
<p class="legal">
&copy; 2011-2019 <a href="https://www.lightbend.com" target="_blank">Lightbend, Inc.</a> | 
<a href="https://www.lightbend.com/legal/licenses" target="_blank">Licenses</a> | 
<a href="https://www.lightbend.com/legal/terms" target="_blank">Terms</a> | 
<a href="https://www.lightbend.com/legal/privacy" target="_blank">Privacy Policy</a> | 
<a href="https://akka.io/cookie/" target="_blank">Cookie Listing</a> | 
<a class="optanon-toggle-display">Cookie Settings</a>
</p>
</section>
</footer>

</section>
</main>

<script type="text/javascript" src="js/scrollsneak.js"></script>
<script type="text/javascript">jQuery(document).foundation();</script>
<script type="text/javascript" src="js/groups.js"></script>
<script type="text/javascript" src="js/page.js"></script>
<script type="text/javascript" src="js/magellan.js"></script>

<style type="text/css">@import "lib/prettify/prettify.css";</style>
<script type="text/javascript" src="lib/prettify/prettify.js"></script>
<script type="text/javascript" src="lib/prettify/lang-scala.js"></script>
<script type="text/javascript">jQuery(function(){window.prettyPrint && prettyPrint()});</script>

<script type="text/javascript" src="assets/js/warnOldVersion.js"></script>
<script type="text/javascript">jQuery(function(jq){initOldVersionWarnings(jq, '1.0-M1', 'https://doc.akka.io/docs/alpakka/current/')});</script>


</body>
</html>
