<!DOCTYPE html>
<html class="no-js" lang="en">

<head>
<title>Google Cloud BigQuery &bull; Alpakka Documentation</title>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<meta name="description" content="Alpakka is a Reactive Enterprise Integration library for Java and Scala, based on Reactive Streams and Akka."/>
<link rel="canonical" href="https://doc.akka.io/docs/alpakka/current/google-cloud-bigquery.html"/>
<script type="text/javascript" src="lib/jquery/jquery.min.js"></script>
<script type="text/javascript" src="lib/foundation/dist/js/foundation.min.js"></script>
<link rel="stylesheet" type="text/css" href="lib/normalize.css/normalize.css"/>
<link rel="stylesheet" type="text/css" href="lib/foundation/dist/css/foundation.min.css"/>
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.css" />
<link rel="stylesheet" type="text/css" href="css/icons.css"/>
<link rel="stylesheet" type="text/css" href="css/page-8.css"/>
<link rel="stylesheet" type="text/css" href="css/banner-2.css"/>
<link rel="shortcut icon" href="images/favicon.ico" />
<link rel="apple-touch-icon" sizes="180x180" href="images/apple-touch-icon.png"/>
<link rel="icon" type="image/png" sizes="32x32" href="images/favicon-32x32.png"/>
<link rel="icon" type="image/png" sizes="16x16" href="images/favicon-16x16.png"/>
<link rel="manifest" href="images/manifest.json"/>
<meta name="msapplication-TileImage" content="images/mstile-150x150.png"/>
<meta name="msapplication-TileColor" content="#15a9ce"/>
<meta name="theme-color" content="#15a9ce"/>
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>
<!-- OneTrust Cookies Consent Notice (Production Standard, akka.io, en-GB) start -->
<script src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js"  type="text/javascript" charset="UTF-8" data-domain-script="28b912e7-09e9-43d5-91e4-3d1897044004" ></script>
<script type="text/javascript">
function OptanonWrapper() { }
</script>
<!-- OneTrust Cookies Consent Notice (Production Standard, akka.io, en-GB) end -->
<!--Google Analytics-->
<script type="text/plain" class="optanon-category-2">
var _gaq = _gaq || [];
_gaq.push(['_setAccount', '']);
_gaq.push(['_setDomainName', '']);
_gaq.push(['_trackPageview']);
(function() {
var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})()
</script>
<!-- Google Tag Manager -->
<script type="text/plain" class="optanon-category-2">
(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-KBJGH35');
</script>
<!--Marketo-->
<script type="text/plain" class="optanon-category-3">
(function() {
var didInit = false;
function initMunchkin() {
if(didInit === false) {
didInit = true;
Munchkin.init('558-NCX-702', { 'asyncOnly': true, 'disableClickDelay': true });
}
}
var s = document.createElement('script');
s.type = 'text/javascript';
s.async = true;
s.src = '//munchkin.marketo.net/munchkin.js';
s.onreadystatechange = function() {
if (this.readyState == 'complete' || this.readyState == 'loaded') {
initMunchkin();
}
};
s.onload = initMunchkin;
document.getElementsByTagName('head')[0].appendChild(s);
})();
</script>
</head>

<body id="underlay" data-toggler="nav-open">
<div id="lightbend-banner" class="lightbend-banner akka full-width" data-category="OSS Lightbend Banner Impression" data-label="Akka Banner Impression">
<div class="oss-wrapper">
<div class="oss-brand">
<a class="oss-track-link-label" data-category="OSS Lightbend Banner Clicks" data-label="Lightbend Logo - Akka Banner" href="https://www.lightbend.com">
<img class="lightbend-logo" src="images/banner-logos/lightbend-reverse.svg" alt="Lightbend" title="Lightbend">
</a>
</div>
<div class="oss-ad no-drop-down">
<nav id="lightbendRotator" class="lightbend-rotator">
<a class="oss-track-link-label" data-category="OSS Lightbend Banner Clicks" data-label="Promo Rotator - Kalix - High-performance microservices and APIs with no operations required. - Akka Banner" href="https://www.kalix.io/">
<strong>Kalix</strong> - High-performance microservices and APIs with no operations required. <span class="akka-btn">Learn More</span>
</a>
<a class="oss-track-link-label" data-category="OSS Lightbend Banner Clicks" data-label="Promo Rotator - Meet Akka Insights! A stand alone telemetry & observability offering. [Learn More] - Akka Banner" href="https://www.lightbend.com/akka-insights">
<strong>Meet Akka Insights!</strong>&nbsp;&nbsp;A stand alone telemetry & observability offering. <span class="akka-btn">Learn More</span>
</a>
</nav>
</div>
</div>
</div>

<header class="site-header hide-for-large">
<div class="sticky-header clearfix">
<a href="https://akka.io"><img class="logo" src="images/akka-alpakka-reverse.svg"/></a>

<button class="menu-icon float-right" type="button" data-toggle="underlay overlay"></button>
</div>
<div id="overlay" class="overlay-nav" data-toggler="nav-open">
<header class="nav-header">
<div class="nav-header-title">
<h1><a href="index.html">Alpakka Documentation</a></h1>
</div>
<div class="nav-header-version">
Version 4.0.0-M1
</div>
<div class="nav-header-groups">
<select class="supergroup" name="Language"><option class="group" value="group-java">Java</option><option class="group" value="group-scala">Scala</option></select>
</div>
</header>
<nav class="nav-toc">
<ul>
  <li><a href="overview.html" class="page">Overview</a></li>
  <li><a href="data-transformations/index.html" class="page">Data Transformations</a></li>
  <li><a href="amqp.html" class="page">AMQP</a></li>
  <li><a href="external/apache-camel.html" class="page">Apache Camel</a></li>
  <li><a href="cassandra.html" class="page">Apache Cassandra</a></li>
  <li><a href="geode.html" class="page">Apache Geode</a></li>
  <li><a href="kafka.html" class="page">Apache Kafka</a></li>
  <li><a href="kudu.html" class="page">Apache Kudu</a></li>
  <li><a href="solr.html" class="page">Apache Solr</a></li>
  <li><a href="avroparquet.html" class="page">Avro Parquet</a></li>
  <li><a href="aws-event-bridge.html" class="page">AWS EventBridge</a></li>
  <li><a href="dynamodb.html" class="page">AWS DynamoDB</a></li>
  <li><a href="kinesis.html" class="page">AWS Kinesis and Firehose</a></li>
  <li><a href="awslambda.html" class="page">AWS Lambda</a></li>
  <li><a href="s3.html" class="page">AWS S3</a></li>
  <li><a href="sns.html" class="page">AWS SNS</a></li>
  <li><a href="sqs.html" class="page">AWS SQS</a></li>
  <li><a href="azure-storage-queue.html" class="page">Azure Storage Queue</a></li>
  <li><a href="couchbase.html" class="page">Couchbase</a></li>
  <li><a href="elasticsearch.html" class="page">Elasticsearch</a></li>
  <li><a href="external/eventuate.html" class="page">Eventuate</a></li>
  <li><a href="file.html" class="page">File</a></li>
  <li><a href="external/fs2.html" class="page">FS2</a></li>
  <li><a href="ftp.html" class="page">FTP</a></li>
  <li><a href="google-common.html" class="page">Google Common</a></li>
  <li><a href="google-cloud-bigquery.html#google-cloud-bigquery" class="active page">Google Cloud BigQuery</a>
  <ul>
    <li><a href="google-cloud-bigquery.html#artifacts" class="header">Artifacts</a></li>
    <li><a href="google-cloud-bigquery.html#configuration" class="header">Configuration</a></li>
    <li><a href="google-cloud-bigquery.html#imports" class="header">Imports</a></li>
    <li><a href="google-cloud-bigquery.html#setup-data-classes" class="header">Setup data classes</a></li>
    <li><a href="google-cloud-bigquery.html#run-a-query" class="header">Run a query</a></li>
    <li><a href="google-cloud-bigquery.html#load-data-into-bigquery" class="header">Load data into BigQuery</a></li>
    <li><a href="google-cloud-bigquery.html#managing-datasets-and-tables" class="header">Managing datasets and tables</a></li>
    <li><a href="google-cloud-bigquery.html#apply-custom-settings-to-a-part-of-the-stream" class="header">Apply custom settings to a part of the stream</a></li>
    <li><a href="google-cloud-bigquery.html#make-raw-api-requests" class="header">Make raw API requests</a></li>
  </ul></li>
  <li><a href="google-cloud-bigquery-storage.html" class="page">Google Cloud BigQuery Storage</a></li>
  <li><a href="google-cloud-pub-sub.html" class="page">Google Cloud Pub/Sub</a></li>
  <li><a href="google-cloud-pub-sub-grpc.html" class="page">Google Cloud Pub/Sub gRPC</a></li>
  <li><a href="google-cloud-storage.html" class="page">Google Cloud Storage</a></li>
  <li><a href="google-fcm.html" class="page">Google FCM</a></li>
  <li><a href="external/grpc.html" class="page">gRPC</a></li>
  <li><a href="hdfs.html" class="page">Hadoop Distributed File System - HDFS</a></li>
  <li><a href="hbase.html" class="page">HBase</a></li>
  <li><a href="huawei-push-kit.html" class="page">Huawei Push Kit</a></li>
  <li><a href="external/http.html" class="page">HTTP</a></li>
  <li><a href="bluemix-cos.html" class="page">IBM Bluemix Cloud Object Storage</a></li>
  <li><a href="external/db2-event-store.html" class="page">IBM Db2 Event Store</a></li>
  <li><a href="influxdb.html" class="page">InfluxDB</a></li>
  <li><a href="ironmq.html" class="page">IronMQ</a></li>
  <li><a href="jms/index.html" class="page">JMS</a></li>
  <li><a href="external/mapr.html" class="page">MapR Database</a></li>
  <li><a href="mongodb.html" class="page">MongoDB</a></li>
  <li><a href="mqtt.html" class="page">MQTT</a></li>
  <li><a href="mqtt-streaming.html" class="page">MQTT Streaming</a></li>
  <li><a href="opensearch.html" class="page">Opensearch</a></li>
  <li><a href="orientdb.html" class="page">OrientDB</a></li>
  <li><a href="external/pulsar.html" class="page">Pulsar</a></li>
  <li><a href="pravega.html" class="page">Pravega</a></li>
  <li><a href="sse.html" class="page">Server-sent Events (SSE)</a></li>
  <li><a href="slick.html" class="page">Slick (JDBC)</a></li>
  <li><a href="spring-web.html" class="page">Spring Web</a></li>
  <li><a href="external/tcp.html" class="page">TCP</a></li>
  <li><a href="udp.html" class="page">UDP</a></li>
  <li><a href="unix-domain-socket.html" class="page">Unix Domain Socket</a></li>
</ul>
</nav>
</div>
</header>
<div class="site-content-wrapper">
<aside class="sticky-sidebar show-for-large">
<header class="nav-header sticky-sidebar-header">
<div class="nav-header-title">
<h1><a href="index.html">Alpakka Documentation</a></h1>
</div>
<div class="nav-header-version">
Version 4.0.0-M1
</div>
<div class="nav-header-groups">
<select class="supergroup" name="Language"><option class="group" value="group-java">Java</option><option class="group" value="group-scala">Scala</option></select>
</div>
</header>
<nav class="site-nav sticky-sidebar-contents">
<div class="nav-toc">
<ul>
  <li><a href="overview.html" class="page">Overview</a></li>
  <li><a href="data-transformations/index.html" class="page">Data Transformations</a></li>
  <li><a href="amqp.html" class="page">AMQP</a></li>
  <li><a href="external/apache-camel.html" class="page">Apache Camel</a></li>
  <li><a href="cassandra.html" class="page">Apache Cassandra</a></li>
  <li><a href="geode.html" class="page">Apache Geode</a></li>
  <li><a href="kafka.html" class="page">Apache Kafka</a></li>
  <li><a href="kudu.html" class="page">Apache Kudu</a></li>
  <li><a href="solr.html" class="page">Apache Solr</a></li>
  <li><a href="avroparquet.html" class="page">Avro Parquet</a></li>
  <li><a href="aws-event-bridge.html" class="page">AWS EventBridge</a></li>
  <li><a href="dynamodb.html" class="page">AWS DynamoDB</a></li>
  <li><a href="kinesis.html" class="page">AWS Kinesis and Firehose</a></li>
  <li><a href="awslambda.html" class="page">AWS Lambda</a></li>
  <li><a href="s3.html" class="page">AWS S3</a></li>
  <li><a href="sns.html" class="page">AWS SNS</a></li>
  <li><a href="sqs.html" class="page">AWS SQS</a></li>
  <li><a href="azure-storage-queue.html" class="page">Azure Storage Queue</a></li>
  <li><a href="couchbase.html" class="page">Couchbase</a></li>
  <li><a href="elasticsearch.html" class="page">Elasticsearch</a></li>
  <li><a href="external/eventuate.html" class="page">Eventuate</a></li>
  <li><a href="file.html" class="page">File</a></li>
  <li><a href="external/fs2.html" class="page">FS2</a></li>
  <li><a href="ftp.html" class="page">FTP</a></li>
  <li><a href="google-common.html" class="page">Google Common</a></li>
  <li><a href="google-cloud-bigquery.html#google-cloud-bigquery" class="active page">Google Cloud BigQuery</a>
  <ul>
    <li><a href="google-cloud-bigquery.html#artifacts" class="header">Artifacts</a></li>
    <li><a href="google-cloud-bigquery.html#configuration" class="header">Configuration</a></li>
    <li><a href="google-cloud-bigquery.html#imports" class="header">Imports</a></li>
    <li><a href="google-cloud-bigquery.html#setup-data-classes" class="header">Setup data classes</a></li>
    <li><a href="google-cloud-bigquery.html#run-a-query" class="header">Run a query</a></li>
    <li><a href="google-cloud-bigquery.html#load-data-into-bigquery" class="header">Load data into BigQuery</a></li>
    <li><a href="google-cloud-bigquery.html#managing-datasets-and-tables" class="header">Managing datasets and tables</a></li>
    <li><a href="google-cloud-bigquery.html#apply-custom-settings-to-a-part-of-the-stream" class="header">Apply custom settings to a part of the stream</a></li>
    <li><a href="google-cloud-bigquery.html#make-raw-api-requests" class="header">Make raw API requests</a></li>
  </ul></li>
  <li><a href="google-cloud-bigquery-storage.html" class="page">Google Cloud BigQuery Storage</a></li>
  <li><a href="google-cloud-pub-sub.html" class="page">Google Cloud Pub/Sub</a></li>
  <li><a href="google-cloud-pub-sub-grpc.html" class="page">Google Cloud Pub/Sub gRPC</a></li>
  <li><a href="google-cloud-storage.html" class="page">Google Cloud Storage</a></li>
  <li><a href="google-fcm.html" class="page">Google FCM</a></li>
  <li><a href="external/grpc.html" class="page">gRPC</a></li>
  <li><a href="hdfs.html" class="page">Hadoop Distributed File System - HDFS</a></li>
  <li><a href="hbase.html" class="page">HBase</a></li>
  <li><a href="huawei-push-kit.html" class="page">Huawei Push Kit</a></li>
  <li><a href="external/http.html" class="page">HTTP</a></li>
  <li><a href="bluemix-cos.html" class="page">IBM Bluemix Cloud Object Storage</a></li>
  <li><a href="external/db2-event-store.html" class="page">IBM Db2 Event Store</a></li>
  <li><a href="influxdb.html" class="page">InfluxDB</a></li>
  <li><a href="ironmq.html" class="page">IronMQ</a></li>
  <li><a href="jms/index.html" class="page">JMS</a></li>
  <li><a href="external/mapr.html" class="page">MapR Database</a></li>
  <li><a href="mongodb.html" class="page">MongoDB</a></li>
  <li><a href="mqtt.html" class="page">MQTT</a></li>
  <li><a href="mqtt-streaming.html" class="page">MQTT Streaming</a></li>
  <li><a href="opensearch.html" class="page">Opensearch</a></li>
  <li><a href="orientdb.html" class="page">OrientDB</a></li>
  <li><a href="external/pulsar.html" class="page">Pulsar</a></li>
  <li><a href="pravega.html" class="page">Pravega</a></li>
  <li><a href="sse.html" class="page">Server-sent Events (SSE)</a></li>
  <li><a href="slick.html" class="page">Slick (JDBC)</a></li>
  <li><a href="spring-web.html" class="page">Spring Web</a></li>
  <li><a href="external/tcp.html" class="page">TCP</a></li>
  <li><a href="udp.html" class="page">UDP</a></li>
  <li><a href="unix-domain-socket.html" class="page">Unix Domain Socket</a></li>
</ul>
</div>
</nav>
<footer class="nav-footer sticky-sidebar-footer">
<a href="https://akka.io"><img class="logo" src="images/akka-alpakka-reverse.svg"/></a>

</footer>
</aside>
<main class="fixed-shift-for-large expanded row">
<section class="site-content small-12 column">
<article class="page-content row">
<div class="small-12 column" id="docs">
<h1><a href="#google-cloud-bigquery" name="google-cloud-bigquery" class="anchor"><span class="anchor-link"></span></a>Google Cloud BigQuery</h1>
<p>The BigQuery connector provides Akka Stream sources and sinks to connect to <a href="https://cloud.google.com/bigquery/">Google Cloud BigQuery</a>. BigQuery is a serverless data warehouse for storing and analyzing massive datasets. This connector is primarily intended for streaming data into and out of BigQuery tables and running SQL queries, although it also provides basic support for managing datasets and tables and flexible access to the BigQuery REST API.</p>
<table class="project-info">
<tr><th colspan="2">Project Info: Alpakka Google Cloud BigQuery</th></tr>
  <tr><th>Artifact</th><td><div>com.lightbend.akka</div>
  <div>akka-stream-alpakka-google-cloud-bigquery</div>
  <div>4.0.0-M1</div>
  <div><a href="other-docs/snapshots.html">Snapshots are available</a></div>
  </td></tr>
  <tr><th>JDK versions</th><td><div>Adopt OpenJDK 8</div><div>Adopt OpenJDK 11</div></td></tr>
  <tr><th>Scala versions</th><td>2.13.8</td></tr>
  <tr><th>JPMS module name</th><td>akka.stream.alpakka.google.cloud.bigquery</td></tr>
  <tr><th>License</th><td><div><a href="https://www.apache.org/licenses/LICENSE-2.0.txt" target="_blank" rel="noopener noreferrer">Apache-2.0</a></div>
  </td></tr>
  <tr><th>Readiness level</th><td><div class="readiness-level"><a href="https://developer.lightbend.com/docs/introduction/getting-help/support-terminology.html#community-driven" target="_blank" rel="noopener">Community-driven</a></div>
  <div>Since 2.0.2, 2020-07-31</div>
  </td></tr>
  <tr><th>Home page</th><td><a href="https://doc.akka.io/docs/alpakka/current">https://doc.akka.io/docs/alpakka/current</a></td></tr>
  <tr><th>API documentation</th><td>
  <div><a href="https://doc.akka.io/api/alpakka/4.0.0-M1/akka/stream/alpakka/googlecloud/bigquery/index.html" target="_blank" rel="noopener noreferrer">API (Scaladoc)</a></div>
  </td></tr>
  <tr><th>Forums</th><td>
  <div><a href="https://discuss.lightbend.com/c/akka/" target="_blank" rel="noopener noreferrer">Lightbend Discuss</a></div>
  </td></tr>
  <tr><th>Release notes</th><td><a href="https://github.com/akka/alpakka/releases" target="_blank" rel="noopener noreferrer">GitHub releases</a></td></tr>
  <tr><th>Issues</th><td><a href="https://github.com/akka/alpakka/labels/p%3Agoogle-cloud-bigquery" target="_blank" rel="noopener noreferrer">Github issues</a></td></tr>
  <tr><th>Sources</th><td><a href="https://github.com/akka/alpakka" target="_blank" rel="noopener noreferrer">https://github.com/akka/alpakka</a></td></tr>
</table>
<div class="callout warning "><div class="callout-title">API may change</div>
<p>Alpakka Google Cloud BigQuery was added in Alpakka 2.0.2 in July 2020 and is marked as &ldquo;API may change&rdquo;. Please try it out and suggest improvements. <a href="https://github.com/akka/alpakka/pull/2548">PR #2548</a></p></div>
<h2><a href="#artifacts" name="artifacts" class="anchor"><span class="anchor-link"></span></a>Artifacts</h2><dl class="dependency"><dt>sbt</dt><dd><pre class="prettyprint"><code class="language-scala">val AkkaVersion = "2.6.19"
val AkkaHttpVersion = "10.2.9"
libraryDependencies ++= Seq(
  "com.lightbend.akka" %% "akka-stream-alpakka-google-cloud-bigquery" % "4.0.0-M1",
  "com.typesafe.akka" %% "akka-stream" % AkkaVersion,
  "com.typesafe.akka" %% "akka-http" % AkkaHttpVersion,
  "com.typesafe.akka" %% "akka-http-spray-json" % AkkaHttpVersion
)</code></pre></dd><dt>Maven</dt><dd><pre class="prettyprint"><code class="language-xml">&lt;properties&gt;
  &lt;akka.version&gt;2.6.19&lt;/akka.version&gt;
  &lt;akka.http.version&gt;10.2.9&lt;/akka.http.version&gt;
  &lt;scala.binary.version&gt;2.13&lt;/scala.binary.version&gt;
&lt;/properties&gt;
&lt;dependencies&gt
  &lt;dependency&gt;
    &lt;groupId&gt;com.lightbend.akka&lt;/groupId&gt;
    &lt;artifactId&gt;akka-stream-alpakka-google-cloud-bigquery_${scala.binary.version}&lt;/artifactId&gt;
    &lt;version&gt;4.0.0-M1&lt;/version&gt;
  &lt;/dependency&gt
  &lt;dependency&gt;
    &lt;groupId&gt;com.typesafe.akka&lt;/groupId&gt;
    &lt;artifactId&gt;akka-stream_${scala.binary.version}&lt;/artifactId&gt;
    &lt;version&gt;${akka.version}&lt;/version&gt;
  &lt;/dependency&gt
  &lt;dependency&gt;
    &lt;groupId&gt;com.typesafe.akka&lt;/groupId&gt;
    &lt;artifactId&gt;akka-http_${scala.binary.version}&lt;/artifactId&gt;
    &lt;version&gt;${akka.http.version}&lt;/version&gt;
  &lt;/dependency&gt
  &lt;dependency&gt;
    &lt;groupId&gt;com.typesafe.akka&lt;/groupId&gt;
    &lt;artifactId&gt;akka-http-spray-json_${scala.binary.version}&lt;/artifactId&gt;
    &lt;version&gt;${akka.http.version}&lt;/version&gt;
  &lt;/dependency&gt
&lt;/dependencies&gt;</code></pre></dd><dt>Gradle</dt><dd><pre class="prettyprint"><code class="language-gradle">def versions = [
  AkkaVersion: "2.6.19",
  AkkaHttpVersion: "10.2.9",
  ScalaBinary: "2.13"
]
dependencies {
  implementation "com.lightbend.akka:akka-stream-alpakka-google-cloud-bigquery_${versions.ScalaBinary}:4.0.0-M1"
  implementation "com.typesafe.akka:akka-stream_${versions.ScalaBinary}:${versions.AkkaVersion}"
  implementation "com.typesafe.akka:akka-http_${versions.ScalaBinary}:${versions.AkkaHttpVersion}"
  implementation "com.typesafe.akka:akka-http-spray-json_${versions.ScalaBinary}:${versions.AkkaHttpVersion}"
}</code></pre></dd></dl>
<p>To use the <a href="https://github.com/FasterXML/jackson">Jackson JSON library</a> for marshalling you must also add the Akka HTTP module for Jackson support.</p><dl class="dependency"><dt>sbt</dt><dd><pre class="prettyprint"><code class="language-scala">val AkkaHttpVersion = "10.2.9"
libraryDependencies += "com.typesafe.akka" %% "akka-http-jackson" % AkkaHttpVersion</code></pre></dd><dt>Maven</dt><dd><pre class="prettyprint"><code class="language-xml">&lt;properties&gt;
  &lt;akka.http.version&gt;10.2.9&lt;/akka.http.version&gt;
  &lt;scala.binary.version&gt;2.13&lt;/scala.binary.version&gt;
&lt;/properties&gt;
&lt;dependencies&gt
  &lt;dependency&gt;
    &lt;groupId&gt;com.typesafe.akka&lt;/groupId&gt;
    &lt;artifactId&gt;akka-http-jackson_${scala.binary.version}&lt;/artifactId&gt;
    &lt;version&gt;${akka.http.version}&lt;/version&gt;
  &lt;/dependency&gt
&lt;/dependencies&gt;</code></pre></dd><dt>Gradle</dt><dd><pre class="prettyprint"><code class="language-gradle">def versions = [
  AkkaHttpVersion: "10.2.9",
  ScalaBinary: "2.13"
]
dependencies {
  implementation "com.typesafe.akka:akka-http-jackson_${versions.ScalaBinary}:${versions.AkkaHttpVersion}"
}</code></pre></dd></dl>
<p>The table below shows direct dependencies of this module and the second tab shows all libraries that it depends on transitively.</p>
<dl class="dependencies"><dt>Direct dependencies</dt><dd><table>
  <thead><tr><th>Organization</th><th>Artifact</th><th>Version</th></thead>
  <tbody>
    <tr><td>com.fasterxml.jackson.core</td><td>jackson-annotations</td><td><a href="https://mvnrepository.com/artifact/com.fasterxml.jackson.core/jackson-annotations/2.11.4" target="_blank">2.11.4</a></td></tr>
    <tr><td>com.lightbend.akka</td><td>akka-stream-alpakka-google-common_2.13</td><td><a href="https://mvnrepository.com/artifact/com.lightbend.akka/akka-stream-alpakka-google-common_2.13/4.0.0-M1" target="_blank">4.0.0-M1</a></td></tr>
    <tr><td>com.typesafe.akka</td><td>akka-http-spray-json_2.13</td><td><a href="https://mvnrepository.com/artifact/com.typesafe.akka/akka-http-spray-json_2.13/10.2.9" target="_blank">10.2.9</a></td></tr>
    <tr><td>com.typesafe.akka</td><td>akka-http_2.13</td><td><a href="https://mvnrepository.com/artifact/com.typesafe.akka/akka-http_2.13/10.2.9" target="_blank">10.2.9</a></td></tr>
    <tr><td>com.typesafe.akka</td><td>akka-stream_2.13</td><td><a href="https://mvnrepository.com/artifact/com.typesafe.akka/akka-stream_2.13/2.6.19" target="_blank">2.6.19</a></td></tr>
    <tr><td>io.spray</td><td>spray-json_2.13</td><td><a href="https://mvnrepository.com/artifact/io.spray/spray-json_2.13/1.3.6" target="_blank">1.3.6</a></td></tr>
    <tr><td>org.scala-lang</td><td>scala-library</td><td><a href="https://mvnrepository.com/artifact/org.scala-lang/scala-library/2.13.8" target="_blank">2.13.8</a></td></tr>
  </tbody>
</table></dd>
<dt>Dependency tree</dt><dd><pre>
com.fasterxml.jackson.core    jackson-annotations    <a href="https://mvnrepository.com/artifact/com.fasterxml.jackson.core/jackson-annotations/2.11.4" target="_blank">2.11.4</a>    The Apache Software License, Version 2.0
com.lightbend.akka    akka-stream-alpakka-google-common_2.13    <a href="https://mvnrepository.com/artifact/com.lightbend.akka/akka-stream-alpakka-google-common_2.13/4.0.0-M1" target="_blank">4.0.0-M1</a>
    com.github.jwt-scala    jwt-spray-json_2.13    <a href="https://mvnrepository.com/artifact/com.github.jwt-scala/jwt-spray-json_2.13/7.1.4" target="_blank">7.1.4</a>    Apache-2.0
        com.github.jwt-scala    jwt-json-common_2.13    <a href="https://mvnrepository.com/artifact/com.github.jwt-scala/jwt-json-common_2.13/7.1.4" target="_blank">7.1.4</a>    Apache-2.0
            com.github.jwt-scala    jwt-core_2.13    <a href="https://mvnrepository.com/artifact/com.github.jwt-scala/jwt-core_2.13/7.1.4" target="_blank">7.1.4</a>    Apache-2.0
                org.scala-lang    scala-library    <a href="https://mvnrepository.com/artifact/org.scala-lang/scala-library/2.13.8" target="_blank">2.13.8</a>    Apache-2.0
            org.scala-lang    scala-library    <a href="https://mvnrepository.com/artifact/org.scala-lang/scala-library/2.13.8" target="_blank">2.13.8</a>    Apache-2.0
        io.spray    spray-json_2.13    <a href="https://mvnrepository.com/artifact/io.spray/spray-json_2.13/1.3.6" target="_blank">1.3.6</a>    Apache 2
            org.scala-lang    scala-library    <a href="https://mvnrepository.com/artifact/org.scala-lang/scala-library/2.13.8" target="_blank">2.13.8</a>    Apache-2.0
        org.scala-lang    scala-library    <a href="https://mvnrepository.com/artifact/org.scala-lang/scala-library/2.13.8" target="_blank">2.13.8</a>    Apache-2.0
    com.google.auth    google-auth-library-credentials    <a href="https://mvnrepository.com/artifact/com.google.auth/google-auth-library-credentials/0.24.1" target="_blank">0.24.1</a>
    com.typesafe.akka    akka-http-spray-json_2.13    <a href="https://mvnrepository.com/artifact/com.typesafe.akka/akka-http-spray-json_2.13/10.2.9" target="_blank">10.2.9</a>    Apache-2.0
        com.typesafe.akka    akka-http_2.13    <a href="https://mvnrepository.com/artifact/com.typesafe.akka/akka-http_2.13/10.2.9" target="_blank">10.2.9</a>    Apache-2.0
            com.typesafe.akka    akka-http-core_2.13    <a href="https://mvnrepository.com/artifact/com.typesafe.akka/akka-http-core_2.13/10.2.9" target="_blank">10.2.9</a>    Apache-2.0
                com.typesafe.akka    akka-parsing_2.13    <a href="https://mvnrepository.com/artifact/com.typesafe.akka/akka-parsing_2.13/10.2.9" target="_blank">10.2.9</a>    Apache-2.0
                    org.scala-lang    scala-library    <a href="https://mvnrepository.com/artifact/org.scala-lang/scala-library/2.13.8" target="_blank">2.13.8</a>    Apache-2.0
                org.scala-lang    scala-library    <a href="https://mvnrepository.com/artifact/org.scala-lang/scala-library/2.13.8" target="_blank">2.13.8</a>    Apache-2.0
            org.scala-lang    scala-library    <a href="https://mvnrepository.com/artifact/org.scala-lang/scala-library/2.13.8" target="_blank">2.13.8</a>    Apache-2.0
        io.spray    spray-json_2.13    <a href="https://mvnrepository.com/artifact/io.spray/spray-json_2.13/1.3.6" target="_blank">1.3.6</a>    Apache 2
            org.scala-lang    scala-library    <a href="https://mvnrepository.com/artifact/org.scala-lang/scala-library/2.13.8" target="_blank">2.13.8</a>    Apache-2.0
        org.scala-lang    scala-library    <a href="https://mvnrepository.com/artifact/org.scala-lang/scala-library/2.13.8" target="_blank">2.13.8</a>    Apache-2.0
    com.typesafe.akka    akka-http_2.13    <a href="https://mvnrepository.com/artifact/com.typesafe.akka/akka-http_2.13/10.2.9" target="_blank">10.2.9</a>    Apache-2.0
        com.typesafe.akka    akka-http-core_2.13    <a href="https://mvnrepository.com/artifact/com.typesafe.akka/akka-http-core_2.13/10.2.9" target="_blank">10.2.9</a>    Apache-2.0
            com.typesafe.akka    akka-parsing_2.13    <a href="https://mvnrepository.com/artifact/com.typesafe.akka/akka-parsing_2.13/10.2.9" target="_blank">10.2.9</a>    Apache-2.0
                org.scala-lang    scala-library    <a href="https://mvnrepository.com/artifact/org.scala-lang/scala-library/2.13.8" target="_blank">2.13.8</a>    Apache-2.0
            org.scala-lang    scala-library    <a href="https://mvnrepository.com/artifact/org.scala-lang/scala-library/2.13.8" target="_blank">2.13.8</a>    Apache-2.0
        org.scala-lang    scala-library    <a href="https://mvnrepository.com/artifact/org.scala-lang/scala-library/2.13.8" target="_blank">2.13.8</a>    Apache-2.0
    com.typesafe.akka    akka-stream_2.13    <a href="https://mvnrepository.com/artifact/com.typesafe.akka/akka-stream_2.13/2.6.19" target="_blank">2.6.19</a>    Apache-2.0
        com.typesafe.akka    akka-actor_2.13    <a href="https://mvnrepository.com/artifact/com.typesafe.akka/akka-actor_2.13/2.6.19" target="_blank">2.6.19</a>    Apache-2.0
            com.typesafe    config    <a href="https://mvnrepository.com/artifact/com.typesafe/config/1.4.2" target="_blank">1.4.2</a>    Apache-2.0
            org.scala-lang.modules    scala-java8-compat_2.13    <a href="https://mvnrepository.com/artifact/org.scala-lang.modules/scala-java8-compat_2.13/1.0.0" target="_blank">1.0.0</a>    Apache-2.0
                org.scala-lang    scala-library    <a href="https://mvnrepository.com/artifact/org.scala-lang/scala-library/2.13.8" target="_blank">2.13.8</a>    Apache-2.0
            org.scala-lang    scala-library    <a href="https://mvnrepository.com/artifact/org.scala-lang/scala-library/2.13.8" target="_blank">2.13.8</a>    Apache-2.0
        com.typesafe.akka    akka-protobuf-v3_2.13    <a href="https://mvnrepository.com/artifact/com.typesafe.akka/akka-protobuf-v3_2.13/2.6.19" target="_blank">2.6.19</a>    Apache-2.0
        com.typesafe    ssl-config-core_2.13    <a href="https://mvnrepository.com/artifact/com.typesafe/ssl-config-core_2.13/0.4.3" target="_blank">0.4.3</a>    Apache-2.0
            com.typesafe    config    <a href="https://mvnrepository.com/artifact/com.typesafe/config/1.4.2" target="_blank">1.4.2</a>    Apache-2.0
            org.scala-lang.modules    scala-parser-combinators_2.13    <a href="https://mvnrepository.com/artifact/org.scala-lang.modules/scala-parser-combinators_2.13/1.1.2" target="_blank">1.1.2</a>    Apache-2.0
                org.scala-lang    scala-library    <a href="https://mvnrepository.com/artifact/org.scala-lang/scala-library/2.13.8" target="_blank">2.13.8</a>    Apache-2.0
            org.scala-lang    scala-library    <a href="https://mvnrepository.com/artifact/org.scala-lang/scala-library/2.13.8" target="_blank">2.13.8</a>    Apache-2.0
        org.reactivestreams    reactive-streams    <a href="https://mvnrepository.com/artifact/org.reactivestreams/reactive-streams/1.0.3" target="_blank">1.0.3</a>    CC0
        org.scala-lang    scala-library    <a href="https://mvnrepository.com/artifact/org.scala-lang/scala-library/2.13.8" target="_blank">2.13.8</a>    Apache-2.0
    org.scala-lang    scala-library    <a href="https://mvnrepository.com/artifact/org.scala-lang/scala-library/2.13.8" target="_blank">2.13.8</a>    Apache-2.0
com.typesafe.akka    akka-http-spray-json_2.13    <a href="https://mvnrepository.com/artifact/com.typesafe.akka/akka-http-spray-json_2.13/10.2.9" target="_blank">10.2.9</a>    Apache-2.0
    com.typesafe.akka    akka-http_2.13    <a href="https://mvnrepository.com/artifact/com.typesafe.akka/akka-http_2.13/10.2.9" target="_blank">10.2.9</a>    Apache-2.0
        com.typesafe.akka    akka-http-core_2.13    <a href="https://mvnrepository.com/artifact/com.typesafe.akka/akka-http-core_2.13/10.2.9" target="_blank">10.2.9</a>    Apache-2.0
            com.typesafe.akka    akka-parsing_2.13    <a href="https://mvnrepository.com/artifact/com.typesafe.akka/akka-parsing_2.13/10.2.9" target="_blank">10.2.9</a>    Apache-2.0
                org.scala-lang    scala-library    <a href="https://mvnrepository.com/artifact/org.scala-lang/scala-library/2.13.8" target="_blank">2.13.8</a>    Apache-2.0
            org.scala-lang    scala-library    <a href="https://mvnrepository.com/artifact/org.scala-lang/scala-library/2.13.8" target="_blank">2.13.8</a>    Apache-2.0
        org.scala-lang    scala-library    <a href="https://mvnrepository.com/artifact/org.scala-lang/scala-library/2.13.8" target="_blank">2.13.8</a>    Apache-2.0
    io.spray    spray-json_2.13    <a href="https://mvnrepository.com/artifact/io.spray/spray-json_2.13/1.3.6" target="_blank">1.3.6</a>    Apache 2
        org.scala-lang    scala-library    <a href="https://mvnrepository.com/artifact/org.scala-lang/scala-library/2.13.8" target="_blank">2.13.8</a>    Apache-2.0
    org.scala-lang    scala-library    <a href="https://mvnrepository.com/artifact/org.scala-lang/scala-library/2.13.8" target="_blank">2.13.8</a>    Apache-2.0
com.typesafe.akka    akka-http_2.13    <a href="https://mvnrepository.com/artifact/com.typesafe.akka/akka-http_2.13/10.2.9" target="_blank">10.2.9</a>    Apache-2.0
    com.typesafe.akka    akka-http-core_2.13    <a href="https://mvnrepository.com/artifact/com.typesafe.akka/akka-http-core_2.13/10.2.9" target="_blank">10.2.9</a>    Apache-2.0
        com.typesafe.akka    akka-parsing_2.13    <a href="https://mvnrepository.com/artifact/com.typesafe.akka/akka-parsing_2.13/10.2.9" target="_blank">10.2.9</a>    Apache-2.0
            org.scala-lang    scala-library    <a href="https://mvnrepository.com/artifact/org.scala-lang/scala-library/2.13.8" target="_blank">2.13.8</a>    Apache-2.0
        org.scala-lang    scala-library    <a href="https://mvnrepository.com/artifact/org.scala-lang/scala-library/2.13.8" target="_blank">2.13.8</a>    Apache-2.0
    org.scala-lang    scala-library    <a href="https://mvnrepository.com/artifact/org.scala-lang/scala-library/2.13.8" target="_blank">2.13.8</a>    Apache-2.0
com.typesafe.akka    akka-stream_2.13    <a href="https://mvnrepository.com/artifact/com.typesafe.akka/akka-stream_2.13/2.6.19" target="_blank">2.6.19</a>    Apache-2.0
    com.typesafe.akka    akka-actor_2.13    <a href="https://mvnrepository.com/artifact/com.typesafe.akka/akka-actor_2.13/2.6.19" target="_blank">2.6.19</a>    Apache-2.0
        com.typesafe    config    <a href="https://mvnrepository.com/artifact/com.typesafe/config/1.4.2" target="_blank">1.4.2</a>    Apache-2.0
        org.scala-lang.modules    scala-java8-compat_2.13    <a href="https://mvnrepository.com/artifact/org.scala-lang.modules/scala-java8-compat_2.13/1.0.0" target="_blank">1.0.0</a>    Apache-2.0
            org.scala-lang    scala-library    <a href="https://mvnrepository.com/artifact/org.scala-lang/scala-library/2.13.8" target="_blank">2.13.8</a>    Apache-2.0
        org.scala-lang    scala-library    <a href="https://mvnrepository.com/artifact/org.scala-lang/scala-library/2.13.8" target="_blank">2.13.8</a>    Apache-2.0
    com.typesafe.akka    akka-protobuf-v3_2.13    <a href="https://mvnrepository.com/artifact/com.typesafe.akka/akka-protobuf-v3_2.13/2.6.19" target="_blank">2.6.19</a>    Apache-2.0
    com.typesafe    ssl-config-core_2.13    <a href="https://mvnrepository.com/artifact/com.typesafe/ssl-config-core_2.13/0.4.3" target="_blank">0.4.3</a>    Apache-2.0
        com.typesafe    config    <a href="https://mvnrepository.com/artifact/com.typesafe/config/1.4.2" target="_blank">1.4.2</a>    Apache-2.0
        org.scala-lang.modules    scala-parser-combinators_2.13    <a href="https://mvnrepository.com/artifact/org.scala-lang.modules/scala-parser-combinators_2.13/1.1.2" target="_blank">1.1.2</a>    Apache-2.0
            org.scala-lang    scala-library    <a href="https://mvnrepository.com/artifact/org.scala-lang/scala-library/2.13.8" target="_blank">2.13.8</a>    Apache-2.0
        org.scala-lang    scala-library    <a href="https://mvnrepository.com/artifact/org.scala-lang/scala-library/2.13.8" target="_blank">2.13.8</a>    Apache-2.0
    org.reactivestreams    reactive-streams    <a href="https://mvnrepository.com/artifact/org.reactivestreams/reactive-streams/1.0.3" target="_blank">1.0.3</a>    CC0
    org.scala-lang    scala-library    <a href="https://mvnrepository.com/artifact/org.scala-lang/scala-library/2.13.8" target="_blank">2.13.8</a>    Apache-2.0
io.spray    spray-json_2.13    <a href="https://mvnrepository.com/artifact/io.spray/spray-json_2.13/1.3.6" target="_blank">1.3.6</a>    Apache 2
    org.scala-lang    scala-library    <a href="https://mvnrepository.com/artifact/org.scala-lang/scala-library/2.13.8" target="_blank">2.13.8</a>    Apache-2.0
org.scala-lang    scala-library    <a href="https://mvnrepository.com/artifact/org.scala-lang/scala-library/2.13.8" target="_blank">2.13.8</a>    Apache-2.0</pre></dd>
</dl>

<h2><a href="#configuration" name="configuration" class="anchor"><span class="anchor-link"></span></a>Configuration</h2>

<p>The BigQuery connector <a href="google-common.html">shares its basic configuration</a> with all the Google connectors in Alpakka. Additional BigQuery-specific configuration settings can be found in its <a href="https://github.com/akka/alpakka/tree/v4.0.0-M1/google-cloud-bigquery/src/main/resources/reference.conf">reference.conf</a>.</p>

<h2><a href="#imports" name="imports" class="anchor"><span class="anchor-link"></span></a>Imports</h2>

<p>All of the examples below assume the following imports are in scope.</p>

<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/alpakka/tree/v4.0.0-M1/google-cloud-bigquery/src/test/scala/docs/scaladsl/BigQueryDoc.scala#L8-L29" target="_blank" title="Go to snippet source">source</a><code class="language-scala">import akka.http.scaladsl.marshallers.sprayjson.SprayJsonSupport._
import akka.stream.alpakka.google.{GoogleAttributes, GoogleSettings}
import akka.stream.alpakka.googlecloud.bigquery.InsertAllRetryPolicy
import akka.stream.alpakka.googlecloud.bigquery.model.{
  Dataset,
  Job,
  JobReference,
  JobState,
  QueryResponse,
  Table,
  TableDataListResponse,
  TableListResponse
}
import akka.stream.alpakka.googlecloud.bigquery.scaladsl.BigQuery
import akka.stream.alpakka.googlecloud.bigquery.scaladsl.schema.BigQuerySchemas._
import akka.stream.alpakka.googlecloud.bigquery.scaladsl.spray.BigQueryJsonProtocol._
import akka.stream.scaladsl.{Flow, Sink, Source}
import akka.{Done, NotUsed}

import scala.annotation.nowarn
import scala.collection.immutable.Seq
import scala.concurrent.Future</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/alpakka/tree/v4.0.0-M1/google-cloud-bigquery/src/test/java/docs/javadsl/BigQueryDoc.java#L8-L53" target="_blank" title="Go to snippet source">source</a><code class="language-java"><br/>import akka.Done;
import akka.NotUsed;
import akka.http.javadsl.marshallers.jackson.Jackson;
import akka.http.javadsl.marshalling.Marshaller;
import akka.http.javadsl.model.HttpEntity;
import akka.http.javadsl.model.RequestEntity;
import akka.http.javadsl.unmarshalling.Unmarshaller;
import akka.stream.alpakka.google.GoogleAttributes;
import akka.stream.alpakka.google.GoogleSettings;
import akka.stream.alpakka.googlecloud.bigquery.InsertAllRetryPolicy;
import akka.stream.alpakka.googlecloud.bigquery.javadsl.BigQuery;
import akka.stream.alpakka.googlecloud.bigquery.javadsl.jackson.BigQueryMarshallers;
import akka.stream.alpakka.googlecloud.bigquery.model.Dataset;
import akka.stream.alpakka.googlecloud.bigquery.model.Job;
import akka.stream.alpakka.googlecloud.bigquery.model.JobReference;
import akka.stream.alpakka.googlecloud.bigquery.model.JobState;
import akka.stream.alpakka.googlecloud.bigquery.model.QueryResponse;
import akka.stream.alpakka.googlecloud.bigquery.model.Table;
import akka.stream.alpakka.googlecloud.bigquery.model.TableDataInsertAllRequest;
import akka.stream.alpakka.googlecloud.bigquery.model.TableDataListResponse;
import akka.stream.alpakka.googlecloud.bigquery.model.TableFieldSchema;
import akka.stream.alpakka.googlecloud.bigquery.model.TableFieldSchemaMode;
import akka.stream.alpakka.googlecloud.bigquery.model.TableFieldSchemaType;
import akka.stream.alpakka.googlecloud.bigquery.model.TableListResponse;
import akka.stream.alpakka.googlecloud.bigquery.model.TableSchema;
import akka.stream.javadsl.Flow;
import akka.stream.javadsl.Sink;
import akka.stream.javadsl.Source;
import com.fasterxml.jackson.annotation.JsonCreator;
import com.fasterxml.jackson.annotation.JsonProperty;
import com.fasterxml.jackson.databind.JsonNode;
import com.fasterxml.jackson.databind.ObjectMapper;
import com.fasterxml.jackson.databind.ObjectReader;

import java.io.IOException;
import java.util.ArrayList;
import java.util.Collections;
import java.util.List;
import java.util.Optional;
import java.util.OptionalInt;
import java.util.OptionalLong;
import java.util.concurrent.CompletableFuture;
import java.util.concurrent.CompletionStage;
import java.util.function.Function;
import java.util.stream.Collectors;</code></pre></dd>
</dl>
<h2><a href="#setup-data-classes" name="setup-data-classes" class="anchor"><span class="anchor-link"></span></a>Setup data classes</h2>
<p>As a working example throughout this documentation, we will use the <code>Person</code> <span class="group-scala">case</span> class to model the data in our BigQuery tables.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/alpakka/tree/v4.0.0-M1/google-cloud-bigquery/src/test/scala/docs/scaladsl/BigQueryDoc.scala#L39-L42" target="_blank" title="Go to snippet source">source</a><code class="language-scala">case class Person(name: String, age: Int, addresses: Seq[Address], isHakker: Boolean)
case class Address(street: String, city: String, postalCode: Option[Int])
implicit val addressFormat = bigQueryJsonFormat3(Address)
implicit val personFormat = bigQueryJsonFormat4(Person)</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/alpakka/tree/v4.0.0-M1/google-cloud-bigquery/src/test/java/docs/javadsl/BigQueryDoc.java#L61-L139" target="_blank" title="Go to snippet source">source</a><code class="language-java">ObjectMapper objectMapper = new ObjectMapper();

public class Person {
  private String name;
  private Integer age;
  private List&lt;Address&gt; addresses;
  private Boolean isHakker;

  @JsonCreator
  public Person(@JsonProperty(&quot;f&quot;) JsonNode fields) throws IOException {
    name = fields.get(0).get(&quot;v&quot;).textValue();
    age = Integer.parseInt(fields.get(1).get(&quot;v&quot;).textValue());
    addresses = new ArrayList&lt;&gt;();
    ObjectReader addressReader = objectMapper.readerFor(Address.class);
    for (JsonNode node : fields.get(2).get(&quot;v&quot;)) {
      Address address = addressReader.readValue(node.get(&quot;v&quot;));
      addresses.add(address);
    }
    isHakker = Boolean.parseBoolean(fields.get(3).get(&quot;v&quot;).textValue());
  }

  public String getName() {
    return name;
  }

  public Integer getAge() {
    return age;
  }

  public List&lt;Address&gt; getAddresses() {
    return addresses;
  }

  public Boolean getIsHakker() {
    return isHakker;
  }
}

public class Address {
  private String street;
  private String city;
  private Integer postalCode;

  @JsonCreator
  public Address(@JsonProperty(&quot;f&quot;) JsonNode fields) {
    street = fields.get(0).get(&quot;v&quot;).textValue();
    city = fields.get(1).get(&quot;v&quot;).textValue();
    postalCode =
        Optional.of(fields.get(2).get(&quot;v&quot;).textValue()).map(Integer::parseInt).orElse(null);
  }

  public String getStreet() {
    return street;
  }

  public String getCity() {
    return city;
  }

  public Integer getPostalCode() {
    return postalCode;
  }
}

public class NameAddressesPair {
  private String name;
  private List&lt;Address&gt; addresses;

  @JsonCreator
  public NameAddressesPair(@JsonProperty(&quot;f&quot;) JsonNode fields) throws IOException {
    name = fields.get(0).get(&quot;v&quot;).textValue();
    addresses = new ArrayList&lt;&gt;();
    ObjectReader addressReader = objectMapper.readerFor(Address.class);
    for (JsonNode node : fields.get(1).get(&quot;v&quot;)) {
      Address address = addressReader.readValue(node.get(&quot;v&quot;));
      addresses.add(address);
    }
  }
}</code></pre></dd>
</dl>
<p><span class="group-scala">  To enable automatic support for (un)marshalling <code>User</code> and <code>Address</code> as BigQuery table rows and query results we create implicit <a href="/api/alpakka/4.0.0-M1/akka/stream/alpakka/googlecloud/bigquery/scaladsl/spray/BigQueryRootJsonFormat.html" title="akka.stream.alpakka.googlecloud.bigquery.scaladsl.spray.BigQueryRootJsonFormat"><code>BigQueryRootJsonFormat[T]</code></a> instances.  The <code>bigQueryJsonFormatN</code> methods are imported from <a href="/api/alpakka/4.0.0-M1/akka/stream/alpakka/googlecloud/bigquery/scaladsl/spray/BigQueryJsonProtocol$.html" title="akka.stream.alpakka.googlecloud.bigquery.scaladsl.spray.BigQueryJsonProtocol"><code>BigQueryJsonProtocol</code></a>, analogous to Spray’s <a href="https://javadoc.io/doc/io.spray/spray-json_2.13/latest/spray/json/DefaultJsonProtocol.html" title="spray.json.DefaultJsonProtocol"><code>DefaultJsonProtocol</code></a>. </span> <span class="group-java">  To enable support for (un)marshalling <code>User</code> and <code>Address</code> as BigQuery table rows and query results we use Jackson’s <a href="https://javadoc.io/doc/com.fasterxml.jackson.core/jackson-annotations/latest/com/fasterxml/jackson/annotation/JsonCreator.html" title="com.fasterxml.jackson.annotation.JsonCreator"><code>@JsonCreator</code></a> and <a href="https://javadoc.io/doc/com.fasterxml.jackson.core/jackson-annotations/latest/com/fasterxml/jackson/annotation/JsonProperty.html" title="com.fasterxml.jackson.annotation.JsonProperty"><code>@JsonProperty</code></a> annotations.  Note that a custom <a href="https://javadoc.io/doc/com.fasterxml.jackson.core/jackson-annotations/latest/com/fasterxml/jackson/annotation/JsonCreator.html" title="com.fasterxml.jackson.annotation.JsonCreator"><code>@JsonCreator</code></a> constructor is necessary due to BigQuery’s unusual encoding of rows as “a series of JSON f,v objects for indicating fields and values” (<a href="https://cloud.google.com/bigquery/docs/reference/rest/v2/jobs/getQueryResults#body.GetQueryResultsResponse.FIELDS.rows">reference documentation</a>).  In addition, we also define <code>NameAddressesPair</code> to model the result of the query in the <a href="google-cloud-bigquery.html#run-a-query">next section</a>. </span></p>
<h2><a href="#run-a-query" name="run-a-query" class="anchor"><span class="anchor-link"></span></a>Run a query</h2>
<p>You can run a SQL query and stream the unmarshalled results with the <span class="group-scala"><span class="group-java"><a href="/api/alpakka/4.0.0-M1/akka/stream/alpakka/googlecloud/bigquery/javadsl/BigQuery$.html" title="akka.stream.alpakka.googlecloud.bigquery.javadsl.BigQuery"><code>BigQuery.query&lt;Out&gt;</code></a></span><span class="group-scala"><a href="/api/alpakka/4.0.0-M1/akka/stream/alpakka/googlecloud/bigquery/scaladsl/BigQuery$.html" title="akka.stream.alpakka.googlecloud.bigquery.scaladsl.BigQuery"><code>BigQuery.query[Out]</code></a></span></span> <span class="group-java"><span class="group-java"><a href="/api/alpakka/4.0.0-M1/akka/stream/alpakka/googlecloud/bigquery/javadsl/BigQuery$.html" title="akka.stream.alpakka.googlecloud.bigquery.javadsl.BigQuery"><code>BigQuery.&lt;Out&gt;query</code></a></span><span class="group-scala"><a href="/api/alpakka/4.0.0-M1/akka/stream/alpakka/googlecloud/bigquery/scaladsl/BigQuery$.html" title="akka.stream.alpakka.googlecloud.bigquery.scaladsl.BigQuery"><code>BigQuery.&lt;Out&gt;query</code></a></span></span> method. <span class="group-scala">  The output type <code>Out</code> can be a tuple or any user-defined class for which an implicit <a href="/api/alpakka/4.0.0-M1/akka/stream/alpakka/googlecloud/bigquery/scaladsl/spray/BigQueryRootJsonFormat.html" title="akka.stream.alpakka.googlecloud.bigquery.scaladsl.spray.BigQueryRootJsonFormat"><code>BigQueryRootJsonFormat[Out]</code></a> is available.  Note that the order and presence of fields in <code>Out</code> must strictly match your SQL query. </span> <span class="group-java">To create the unmarshaller, use the <a href="/api/alpakka/4.0.0-M1/akka/stream/alpakka/googlecloud/bigquery/javadsl/jackson/BigQueryMarshallers$.html" title="akka.stream.alpakka.googlecloud.bigquery.javadsl.jackson.BigQueryMarshallers"><code>BigQueryMarshallers.&lt;Out&gt;queryResponseUnmarshaller</code></a> method.</span></p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/alpakka/tree/v4.0.0-M1/google-cloud-bigquery/src/test/scala/docs/scaladsl/BigQueryDoc.scala#L51-L53" target="_blank" title="Go to snippet source">source</a><code class="language-scala">val sqlQuery = s&quot;SELECT name, addresses FROM $datasetId.$tableId WHERE age &gt;= 100&quot;
val centenarians: Source[(String, Seq[Address]), Future[QueryResponse[(String, Seq[Address])]]] =
  BigQuery.query[(String, Seq[Address])](sqlQuery, useLegacySql = false)</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/alpakka/tree/v4.0.0-M1/google-cloud-bigquery/src/test/java/docs/javadsl/BigQueryDoc.java#L148-L153" target="_blank" title="Go to snippet source">source</a><code class="language-java">String sqlQuery =
    String.format(&quot;SELECT name, addresses FROM %s.%s WHERE age &gt;= 100&quot;, datasetId, tableId);
Unmarshaller&lt;HttpEntity, QueryResponse&lt;NameAddressesPair&gt;&gt; queryResponseUnmarshaller =
    BigQueryMarshallers.queryResponseUnmarshaller(NameAddressesPair.class);
Source&lt;NameAddressesPair, CompletionStage&lt;QueryResponse&lt;NameAddressesPair&gt;&gt;&gt; centenarians =
    BigQuery.query(sqlQuery, false, false, queryResponseUnmarshaller);</code></pre></dd>
</dl>
<p>Notice that the source materializes a <span class="group-scala"><code>Future[QueryResponse[(String, Seq[Address])]]</code></span> <span class="group-java"><code>CompletionStage&lt;QueryResponse&lt;NameAddressesTuple&gt;&gt;</code></span> which can be used to retrieve metadata related to the query. For example, you can use a dry run to estimate the number of bytes that will be read by a query.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/alpakka/tree/v4.0.0-M1/google-cloud-bigquery/src/test/scala/docs/scaladsl/BigQueryDoc.scala#L57-L58" target="_blank" title="Go to snippet source">source</a><code class="language-scala">val centenariansDryRun = BigQuery.query[(String, Seq[Address])](sqlQuery, dryRun = true, useLegacySql = false)
val bytesProcessed: Future[Long] = centenariansDryRun.to(Sink.ignore).run().map(_.totalBytesProcessed.get)</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/alpakka/tree/v4.0.0-M1/google-cloud-bigquery/src/test/java/docs/javadsl/BigQueryDoc.java#L157-L163" target="_blank" title="Go to snippet source">source</a><code class="language-java">Source&lt;NameAddressesPair, CompletionStage&lt;QueryResponse&lt;NameAddressesPair&gt;&gt;&gt;
    centenariansDryRun = BigQuery.query(sqlQuery, false, false, queryResponseUnmarshaller);
CompletionStage&lt;Long&gt; bytesProcessed =
    centenariansDryRun
        .to(Sink.ignore())
        .run(system)
        .thenApply(r -&gt; r.getTotalBytesProcessed().getAsLong());</code></pre></dd>
</dl>
<p>Finally, you can also stream all of the rows in a table without the expense of running a query with the <span class="group-scala"><span class="group-java"><a href="/api/alpakka/4.0.0-M1/akka/stream/alpakka/googlecloud/bigquery/javadsl/BigQuery$.html" title="akka.stream.alpakka.googlecloud.bigquery.javadsl.BigQuery"><code>BigQuery.tableData&lt;Out&gt;</code></a></span><span class="group-scala"><a href="/api/alpakka/4.0.0-M1/akka/stream/alpakka/googlecloud/bigquery/scaladsl/BigQuery$.html" title="akka.stream.alpakka.googlecloud.bigquery.scaladsl.BigQuery"><code>BigQuery.tableData[Out]</code></a></span></span> <span class="group-java"><span class="group-java"><a href="/api/alpakka/4.0.0-M1/akka/stream/alpakka/googlecloud/bigquery/javadsl/BigQuery$.html" title="akka.stream.alpakka.googlecloud.bigquery.javadsl.BigQuery"><code>BigQuery.&lt;Out&gt;listTableData</code></a></span><span class="group-scala"><a href="/api/alpakka/4.0.0-M1/akka/stream/alpakka/googlecloud/bigquery/scaladsl/BigQuery$.html" title="akka.stream.alpakka.googlecloud.bigquery.scaladsl.BigQuery"><code>BigQuery.&lt;Out&gt;listTableData</code></a></span></span> method.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/alpakka/tree/v4.0.0-M1/google-cloud-bigquery/src/test/scala/docs/scaladsl/BigQueryDoc.scala#L62-L63" target="_blank" title="Go to snippet source">source</a><code class="language-scala">val everyone: Source[Person, Future[TableDataListResponse[Person]]] =
  BigQuery.tableData[Person](datasetId, tableId)</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/alpakka/tree/v4.0.0-M1/google-cloud-bigquery/src/test/java/docs/javadsl/BigQueryDoc.java#L167-L176" target="_blank" title="Go to snippet source">source</a><code class="language-java">Unmarshaller&lt;HttpEntity, TableDataListResponse&lt;Person&gt;&gt; tableDataListUnmarshaller =
    BigQueryMarshallers.tableDataListResponseUnmarshaller(Person.class);
Source&lt;Person, CompletionStage&lt;TableDataListResponse&lt;Person&gt;&gt;&gt; everyone =
    BigQuery.listTableData(
        datasetId,
        tableId,
        OptionalLong.empty(),
        OptionalInt.empty(),
        Collections.emptyList(),
        tableDataListUnmarshaller);</code></pre></dd>
</dl>
<h2><a href="#load-data-into-bigquery" name="load-data-into-bigquery" class="anchor"><span class="anchor-link"></span></a>Load data into BigQuery</h2>
<p>The BigQuery connector enables loading data into tables via real-time streaming inserts or batch loading. For an overview of these strategies see the <a href="https://cloud.google.com/bigquery/docs/loading-data">BigQuery documentation</a>.</p>
<p>The <span class="group-scala"><span class="group-java"><a href="/api/alpakka/4.0.0-M1/akka/stream/alpakka/googlecloud/bigquery/javadsl/BigQuery$.html" title="akka.stream.alpakka.googlecloud.bigquery.javadsl.BigQuery"><code>BigQuery.insertAll&lt;In&gt;</code></a></span><span class="group-scala"><a href="/api/alpakka/4.0.0-M1/akka/stream/alpakka/googlecloud/bigquery/scaladsl/BigQuery$.html" title="akka.stream.alpakka.googlecloud.bigquery.scaladsl.BigQuery"><code>BigQuery.insertAll[In]</code></a></span></span> <span class="group-java"><span class="group-java"><a href="/api/alpakka/4.0.0-M1/akka/stream/alpakka/googlecloud/bigquery/javadsl/BigQuery$.html" title="akka.stream.alpakka.googlecloud.bigquery.javadsl.BigQuery"><code>BigQuery.&lt;In&gt;insertAll</code></a></span><span class="group-scala"><a href="/api/alpakka/4.0.0-M1/akka/stream/alpakka/googlecloud/bigquery/scaladsl/BigQuery$.html" title="akka.stream.alpakka.googlecloud.bigquery.scaladsl.BigQuery"><code>BigQuery.&lt;In&gt;insertAll</code></a></span></span> method creates a sink that accepts batches of <span class="group-scala"><code>Seq[In]</code></span> <span class="group-java"><code>List&lt;In&gt;</code></span> (for example created via the <a href="https://doc.akka.io/docs/akka/current/stream/operators/Source-or-Flow/batch.html"><code>batch</code></a> operator) and streams them directly into a table. To enable/disable BigQuery’s best-effort deduplication feature use the appropriate <span class="group-scala"><a href="/api/alpakka/4.0.0-M1/akka/stream/alpakka/googlecloud/bigquery/InsertAllRetryPolicy$.html" title="akka.stream.alpakka.googlecloud.bigquery.InsertAllRetryPolicy"><code>InsertAllRetryPolicy</code></a></span><span class="group-java"><a href="/api/alpakka/4.0.0-M1/akka/stream/alpakka/googlecloud/bigquery/InsertAllRetryPolicy$.html" title="akka.stream.alpakka.googlecloud.bigquery.InsertAllRetryPolicy"><code>InsertAllRetryPolicy</code></a></span>.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/alpakka/tree/v4.0.0-M1/google-cloud-bigquery/src/test/scala/docs/scaladsl/BigQueryDoc.scala#L67-L68" target="_blank" title="Go to snippet source">source</a><code class="language-scala">val peopleInsertSink: Sink[Seq[Person], NotUsed] =
  BigQuery.insertAll[Person](datasetId, tableId, InsertAllRetryPolicy.WithDeduplication)</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/alpakka/tree/v4.0.0-M1/google-cloud-bigquery/src/test/java/docs/javadsl/BigQueryDoc.java#L180-L188" target="_blank" title="Go to snippet source">source</a><code class="language-java">Marshaller&lt;TableDataInsertAllRequest&lt;Person&gt;, RequestEntity&gt; tableDataInsertAllMarshaller =
    BigQueryMarshallers.tableDataInsertAllRequestMarshaller();
Sink&lt;List&lt;Person&gt;, NotUsed&gt; peopleInsertSink =
    BigQuery.insertAll(
        datasetId,
        tableId,
        InsertAllRetryPolicy.withDeduplication(),
        Optional.empty(),
        tableDataInsertAllMarshaller);</code></pre></dd>
</dl>
<p>As a cost-saving alternative to streaming inserts, you can also add data to a table via asynchronous load jobs. The <span class="group-scala"><span class="group-java"><a href="/api/alpakka/4.0.0-M1/akka/stream/alpakka/googlecloud/bigquery/javadsl/BigQuery$.html" title="akka.stream.alpakka.googlecloud.bigquery.javadsl.BigQuery"><code>BigQuery.insertAllAsync&lt;In&gt;</code></a></span><span class="group-scala"><a href="/api/alpakka/4.0.0-M1/akka/stream/alpakka/googlecloud/bigquery/scaladsl/BigQuery$.html" title="akka.stream.alpakka.googlecloud.bigquery.scaladsl.BigQuery"><code>BigQuery.insertAllAsync[In]</code></a></span></span> <span class="group-java"><span class="group-java"><a href="/api/alpakka/4.0.0-M1/akka/stream/alpakka/googlecloud/bigquery/javadsl/BigQuery$.html" title="akka.stream.alpakka.googlecloud.bigquery.javadsl.BigQuery"><code>BigQuery.&lt;In&gt;insertAllAsync</code></a></span><span class="group-scala"><a href="/api/alpakka/4.0.0-M1/akka/stream/alpakka/googlecloud/bigquery/scaladsl/BigQuery$.html" title="akka.stream.alpakka.googlecloud.bigquery.scaladsl.BigQuery"><code>BigQuery.&lt;In&gt;insertAllAsync</code></a></span></span> method creates a flow that starts a series of batch load jobs. By default, a new load job is created every minute to attempt to emulate near-real-time streaming inserts, although there is no guarantee when the job will actually run. The frequency with which new load jobs are created is controlled by the <code>alpakka.google.bigquery.load-job-per-table-quota</code> configuration setting.</p><div class="callout warning "><div class="callout-title">Warning</div>
<p>Pending the resolution of <a href="https://issuetracker.google.com/176002651">Google BigQuery issue 176002651</a>, the <code>BigQuery.insertAllAsync</code> API may not work as expected.</p>
<p>As a workaround, you can use the config setting <code>akka.http.parsing.conflicting-content-type-header-processing-mode = first</code> with Akka HTTP v10.2.4 or later.</p></div>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/alpakka/tree/v4.0.0-M1/google-cloud-bigquery/src/test/scala/docs/scaladsl/BigQueryDoc.scala#L72" target="_blank" title="Go to snippet source">source</a><code class="language-scala">val peopleLoadFlow: Flow[Person, Job, NotUsed] = BigQuery.insertAllAsync[Person](datasetId, tableId)</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/alpakka/tree/v4.0.0-M1/google-cloud-bigquery/src/test/java/docs/javadsl/BigQueryDoc.java#L192-L193" target="_blank" title="Go to snippet source">source</a><code class="language-java">Flow&lt;Person, Job, NotUsed&gt; peopleLoadFlow =
    BigQuery.insertAllAsync(datasetId, tableId, Jackson.marshaller());</code></pre></dd>
</dl>
<p>To check the status of the load jobs use the <span class="group-scala"><span class="group-java"><a href="/api/alpakka/4.0.0-M1/akka/stream/alpakka/googlecloud/bigquery/javadsl/BigQuery$.html" title="akka.stream.alpakka.googlecloud.bigquery.javadsl.BigQuery"><code>BigQuery.job</code></a></span><span class="group-scala"><a href="/api/alpakka/4.0.0-M1/akka/stream/alpakka/googlecloud/bigquery/scaladsl/BigQuery$.html" title="akka.stream.alpakka.googlecloud.bigquery.scaladsl.BigQuery"><code>BigQuery.job</code></a></span></span> <span class="group-java"><span class="group-java"><a href="/api/alpakka/4.0.0-M1/akka/stream/alpakka/googlecloud/bigquery/javadsl/BigQuery$.html" title="akka.stream.alpakka.googlecloud.bigquery.javadsl.BigQuery"><code>BigQuery.getJob</code></a></span><span class="group-scala"><a href="/api/alpakka/4.0.0-M1/akka/stream/alpakka/googlecloud/bigquery/scaladsl/BigQuery$.html" title="akka.stream.alpakka.googlecloud.bigquery.scaladsl.BigQuery"><code>BigQuery.getJob</code></a></span></span> method.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/alpakka/tree/v4.0.0-M1/google-cloud-bigquery/src/test/scala/docs/scaladsl/BigQueryDoc.scala#L79-L89" target="_blank" title="Go to snippet source">source</a><code class="language-scala">def checkIfJobsDone(jobReferences: Seq[JobReference]): Future[Boolean] = {
  for {
    jobs &lt;- Future.sequence(jobReferences.map(ref =&gt; BigQuery.job(ref.jobId.get)))
  } yield jobs.forall(job =&gt; job.status.exists(_.state == JobState.Done))
}

val isDone: Future[Boolean] = for {
  jobs &lt;- Source(people).via(peopleLoadFlow).runWith(Sink.seq)
  jobReferences = jobs.flatMap(job =&gt; job.jobReference)
  isDone &lt;- checkIfJobsDone(jobReferences)
} yield isDone</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/alpakka/tree/v4.0.0-M1/google-cloud-bigquery/src/test/java/docs/javadsl/BigQueryDoc.java#L199-L220" target="_blank" title="Go to snippet source">source</a><code class="language-java">Function&lt;List&lt;JobReference&gt;, CompletionStage&lt;Boolean&gt;&gt; checkIfJobsDone =
    jobReferences -&gt; {
      GoogleSettings settings = GoogleSettings.create(system);
      CompletionStage&lt;Boolean&gt; allAreDone = CompletableFuture.completedFuture(true);
      for (JobReference jobReference : jobReferences) {
        CompletionStage&lt;Job&gt; job =
            BigQuery.getJob(jobReference.getJobId().get(), Optional.empty(), settings, system);
        CompletionStage&lt;Boolean&gt; jobIsDone =
            job.thenApply(
                j -&gt;
                    j.getStatus().map(s -&gt; s.getState().equals(JobState.done())).orElse(false));
        allAreDone = allAreDone.thenCombine(jobIsDone, (a, b) -&gt; a &amp; b);
      }
      return allAreDone;
    };

CompletionStage&lt;List&lt;Job&gt;&gt; jobs =
    Source.from(people).via(peopleLoadFlow).runWith(Sink.&lt;Job&gt;seq(), system);
CompletionStage&lt;List&lt;JobReference&gt;&gt; jobReferences =
    jobs.thenApply(
        js -&gt; js.stream().map(j -&gt; j.getJobReference().get()).collect(Collectors.toList()));
CompletionStage&lt;Boolean&gt; isDone = jobReferences.thenCompose(checkIfJobsDone);</code></pre></dd>
</dl>
<h2><a href="#managing-datasets-and-tables" name="managing-datasets-and-tables" class="anchor"><span class="anchor-link"></span></a>Managing datasets and tables</h2>
<p>The BigQuery connector provides methods for basic management of datasets and tables.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/alpakka/tree/v4.0.0-M1/google-cloud-bigquery/src/test/scala/docs/scaladsl/BigQueryDoc.scala#L93-L96" target="_blank" title="Go to snippet source">source</a><code class="language-scala">val allDatasets: Source[Dataset, NotUsed] = BigQuery.datasets
val existingDataset: Future[Dataset] = BigQuery.dataset(datasetId)
val newDataset: Future[Dataset] = BigQuery.createDataset(&quot;newDatasetId&quot;)
val datasetDeleted: Future[Done] = BigQuery.deleteDataset(datasetId)
val allTablesInDataset: Source[Table, Future[TableListResponse]] = BigQuery.tables(datasetId)
val existingTable: Future[Table] = BigQuery.table(datasetId, tableId)
val tableDeleted: Future[Done] = BigQuery.deleteTable(datasetId, tableId)</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/alpakka/tree/v4.0.0-M1/google-cloud-bigquery/src/test/java/docs/javadsl/BigQueryDoc.java#L224-L230" target="_blank" title="Go to snippet source">source</a><code class="language-java">GoogleSettings settings = GoogleSettings.create(system);
Source&lt;Dataset, NotUsed&gt; allDatasets =
    BigQuery.listDatasets(OptionalInt.empty(), Optional.empty(), Collections.emptyMap());
CompletionStage&lt;Dataset&gt; existingDataset = BigQuery.getDataset(datasetId, settings, system);
CompletionStage&lt;Dataset&gt; newDataset = BigQuery.createDataset(&quot;newDatasetId&quot;, settings, system);
CompletionStage&lt;Done&gt; datasetDeleted =
    BigQuery.deleteDataset(datasetId, false, settings, system);
Source&lt;Table, CompletionStage&lt;TableListResponse&gt;&gt; allTablesInDataset =
    BigQuery.listTables(datasetId, OptionalInt.empty());
CompletionStage&lt;Table&gt; existingTable = BigQuery.getTable(datasetId, tableId, settings, system);
CompletionStage&lt;Done&gt; tableDeleted = BigQuery.deleteTable(datasetId, tableId, settings, system);</code></pre></dd>
</dl>
<p>Creating a table requires a little more work to specify the schema. <span class="group-scala">To enable automatic schema generation, you can bring implicit <a href="/api/alpakka/4.0.0-M1/akka/stream/alpakka/googlecloud/bigquery/scaladsl/schema/TableSchemaWriter.html" title="akka.stream.alpakka.googlecloud.bigquery.scaladsl.schema.TableSchemaWriter"><code>TableSchemaWriter[T]</code></a> instances for your classes into scope via the <code>bigQuerySchemaN</code> methods in <a href="/api/alpakka/4.0.0-M1/akka/stream/alpakka/googlecloud/bigquery/scaladsl/schema/BigQuerySchemas$.html" title="akka.stream.alpakka.googlecloud.bigquery.scaladsl.schema.BigQuerySchemas"><code>BigQuerySchemas</code></a>.</span></p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/alpakka/tree/v4.0.0-M1/google-cloud-bigquery/src/test/scala/docs/scaladsl/BigQueryDoc.scala#L106-L108" target="_blank" title="Go to snippet source">source</a><code class="language-scala">implicit val addressSchema = bigQuerySchema3(Address)
implicit val personSchema = bigQuerySchema4(Person)
val newTable: Future[Table] = BigQuery.createTable[Person](datasetId, &quot;newTableId&quot;)</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/alpakka/tree/v4.0.0-M1/google-cloud-bigquery/src/test/java/docs/javadsl/BigQueryDoc.java#L241-L257" target="_blank" title="Go to snippet source">source</a><code class="language-java">TableSchema personSchema =
    TableSchema.create(
        TableFieldSchema.create(&quot;name&quot;, TableFieldSchemaType.string(), Optional.empty()),
        TableFieldSchema.create(&quot;age&quot;, TableFieldSchemaType.integer(), Optional.empty()),
        TableFieldSchema.create(
            &quot;addresses&quot;,
            TableFieldSchemaType.record(),
            Optional.of(TableFieldSchemaMode.repeated()),
            TableFieldSchema.create(&quot;street&quot;, TableFieldSchemaType.string(), Optional.empty()),
            TableFieldSchema.create(&quot;city&quot;, TableFieldSchemaType.string(), Optional.empty()),
            TableFieldSchema.create(
                &quot;postalCode&quot;,
                TableFieldSchemaType.integer(),
                Optional.of(TableFieldSchemaMode.nullable()))),
        TableFieldSchema.create(&quot;isHakker&quot;, TableFieldSchemaType.bool(), Optional.empty()));
CompletionStage&lt;Table&gt; newTable =
    BigQuery.createTable(datasetId, &quot;newTableId&quot;, personSchema, settings, system);</code></pre></dd>
</dl>
<h2><a href="#apply-custom-settings-to-a-part-of-the-stream" name="apply-custom-settings-to-a-part-of-the-stream" class="anchor"><span class="anchor-link"></span></a>Apply custom settings to a part of the stream</h2>
<p>In certain situations it may be desirable to modify the <span class="group-scala"><a href="/api/alpakka/4.0.0-M1/akka/stream/alpakka/google/GoogleSettings.html" title="akka.stream.alpakka.google.GoogleSettings"><code>GoogleSettings</code></a></span><span class="group-java"><a href="/api/alpakka/4.0.0-M1/akka/stream/alpakka/google/GoogleSettings.html" title="akka.stream.alpakka.google.GoogleSettings"><code>GoogleSettings</code></a></span> applied to a part of the stream, for example to change the project ID or use different <span class="group-scala"><a href="/api/alpakka/4.0.0-M1/akka/stream/alpakka/google/RetrySettings.html" title="akka.stream.alpakka.google.RetrySettings"><code>RetrySettings</code></a></span><span class="group-java"><a href="/api/alpakka/4.0.0-M1/akka/stream/alpakka/google/RetrySettings.html" title="akka.stream.alpakka.google.RetrySettings"><code>RetrySettings</code></a></span>.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/alpakka/tree/v4.0.0-M1/google-cloud-bigquery/src/test/scala/docs/scaladsl/BigQueryDoc.scala#L112-L114" target="_blank" title="Go to snippet source">source</a><code class="language-scala">val defaultSettings: GoogleSettings = GoogleSettings()
val customSettings = defaultSettings.copy(projectId = &quot;myOtherProject&quot;)
BigQuery.query[(String, Seq[Address])](sqlQuery).withAttributes(GoogleAttributes.settings(customSettings))</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/alpakka/tree/v4.0.0-M1/google-cloud-bigquery/src/test/java/docs/javadsl/BigQueryDoc.java#L261-L264" target="_blank" title="Go to snippet source">source</a><code class="language-java">GoogleSettings defaultSettings = GoogleSettings.create(system);
GoogleSettings customSettings = defaultSettings.withProjectId(&quot;myOtherProjectId&quot;);
BigQuery.query(sqlQuery, false, false, queryResponseUnmarshaller)
    .withAttributes(GoogleAttributes.settings(customSettings));</code></pre></dd>
</dl>
<h2><a href="#make-raw-api-requests" name="make-raw-api-requests" class="anchor"><span class="anchor-link"></span></a>Make raw API requests</h2>
<p>If you would like to interact with the BigQuery REST API beyond what the BigQuery connector supports, you can make authenticated raw requests via the <span class="group-java"><a href="/api/alpakka/4.0.0-M1/akka/stream/alpakka/googlecloud/bigquery/javadsl/BigQuery$.html" title="akka.stream.alpakka.googlecloud.bigquery.javadsl.BigQuery"><code>BigQuery.singleRequest</code></a></span><span class="group-scala"><a href="/api/alpakka/4.0.0-M1/akka/stream/alpakka/googlecloud/bigquery/scaladsl/BigQuery$.html" title="akka.stream.alpakka.googlecloud.bigquery.scaladsl.BigQuery"><code>BigQuery.singleRequest</code></a></span> and <span class="group-scala"><span class="group-java"><a href="/api/alpakka/4.0.0-M1/akka/stream/alpakka/googlecloud/bigquery/javadsl/BigQuery$.html" title="akka.stream.alpakka.googlecloud.bigquery.javadsl.BigQuery"><code>BigQuery.paginatedRequest&lt;Out&gt;</code></a></span><span class="group-scala"><a href="/api/alpakka/4.0.0-M1/akka/stream/alpakka/googlecloud/bigquery/scaladsl/BigQuery$.html" title="akka.stream.alpakka.googlecloud.bigquery.scaladsl.BigQuery"><code>BigQuery.paginatedRequest[Out]</code></a></span></span> <span class="group-java"><span class="group-java"><a href="/api/alpakka/4.0.0-M1/akka/stream/alpakka/googlecloud/bigquery/javadsl/BigQuery$.html" title="akka.stream.alpakka.googlecloud.bigquery.javadsl.BigQuery"><code>BigQuery.&lt;Out&gt;paginatedRequest</code></a></span><span class="group-scala"><a href="/api/alpakka/4.0.0-M1/akka/stream/alpakka/googlecloud/bigquery/scaladsl/BigQuery$.html" title="akka.stream.alpakka.googlecloud.bigquery.scaladsl.BigQuery"><code>BigQuery.&lt;Out&gt;paginatedRequest</code></a></span></span> methods.</p>
</div>
</article>
<div class="row">
<div class="small-12 column">
<section class="nav-prev-next row">
<div class="nav-prev small-6 column">
<a href="google-common.html"><i class="icon-prev"></i> <span class="link-prev">Google Common</span></a>
</div>
<div class="nav-next small-6 column clearfix">
<a class="float-right" href="google-cloud-bigquery-storage.html">Google Cloud BigQuery Storage <i class="icon-next"></i></a>
</div>
</section>
</div>
</div>
<div class="source-github row">
Found an error in this documentation? The source code for this page can be found <a href="https://github.com/akka/alpakka/tree/v4.0.0-M1/docs/src/main/paradox/google-cloud-bigquery.md">here</a>.
Please feel free to edit and contribute a pull request.
</div>

<footer class="page-footer row clearfix">
<img class="akka-icon float-left show-for-medium" src="images/akka-icon.svg" />
<section class="copyright">
<div>Alpakka is Open Source and available under the Apache 2 License.</div>
<p class="legal">
&copy; 2011-2022 <a href="https://www.lightbend.com" target="_blank">Lightbend, Inc.</a> |
<a href="https://www.lightbend.com/legal/licenses" target="_blank">Licenses</a> |
<a href="https://www.lightbend.com/legal/terms" target="_blank">Terms</a> |
<a href="https://www.lightbend.com/legal/privacy" target="_blank">Privacy Policy</a> |
<a href="https://akka.io/cookie/" target="_blank">Cookie Listing</a> |
<a class="optanon-toggle-display">Cookie Settings</a>
</p>
</section>

</footer>
</section>
</main>
</div>

<script type="text/javascript" src="js/scrollsneak.js"></script>
<script type="text/javascript">jQuery(document).foundation();</script>
<script type="text/javascript" src="js/groups.js"></script>
<script type="text/javascript" src="js/page.js"></script>
<script type="text/javascript" src="js/snippets.js"></script>
<script type="text/javascript" src="js/magellan.js"></script>
<script type="text/javascript" src="js/metadata-toggle.js"></script>
<script type="text/javascript" src="js/lbHeader.js"></script>

<style type="text/css">@import "lib/prettify/prettify.css";</style>
<script type="text/javascript" src="lib/prettify/prettify.js"></script>
<script type="text/javascript" src="lib/prettify/lang-scala.js"></script>
<script type="text/javascript">//<![CDATA[
jQuery(function(){window.prettyPrint && prettyPrint()});
//]]></script>
<script type="text/javascript" src="assets/js/warnOldVersion.js"></script>
<script type="text/javascript">//<![CDATA[
jQuery(function(jq){initOldVersionWarnings(jq, '4.0.0-M1', 'https://doc.akka.io/docs/alpakka/current')});
//]]></script>


</body>
</html>
