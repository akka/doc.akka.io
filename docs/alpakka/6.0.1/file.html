<!DOCTYPE html>
<html class="no-js" lang="en">

<head>
<title>File &bull; Alpakka Documentation</title>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<meta name="description" content="Alpakka is a Reactive Enterprise Integration library for Java and Scala, based on Reactive Streams and Akka."/>
<link rel="canonical" href="https://doc.akka.io/docs/alpakka/current/file.html"/>
<script type="text/javascript" src="lib/jquery/jquery.min.js"></script>
<script type="text/javascript" src="lib/foundation/dist/js/foundation.min.js"></script>
<link rel="stylesheet" type="text/css" href="lib/normalize.css/normalize.css"/>
<link rel="stylesheet" type="text/css" href="lib/foundation/dist/css/foundation.min.css"/>
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.css" />
<link rel="stylesheet" type="text/css" href="css/icons.css"/>
<link rel="stylesheet" type="text/css" href="css/page-8.css"/>
<link rel="stylesheet" type="text/css" href="css/banner-2.css"/>
<link rel="shortcut icon" href="images/favicon.ico" />
<link rel="apple-touch-icon" sizes="180x180" href="images/apple-touch-icon.png"/>
<link rel="icon" type="image/png" sizes="32x32" href="images/favicon-32x32.png"/>
<link rel="icon" type="image/png" sizes="16x16" href="images/favicon-16x16.png"/>
<link rel="manifest" href="images/manifest.json"/>
<meta name="msapplication-TileImage" content="images/mstile-150x150.png"/>
<meta name="msapplication-TileColor" content="#15a9ce"/>
<meta name="theme-color" content="#15a9ce"/>
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>
<!-- OneTrust Cookies Consent Notice (Production Standard, akka.io, en-GB) start -->
<script src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js"  type="text/javascript" charset="UTF-8" data-domain-script="28b912e7-09e9-43d5-91e4-3d1897044004" ></script>
<script type="text/javascript">
function OptanonWrapper() { }
</script>
<!-- OneTrust Cookies Consent Notice (Production Standard, akka.io, en-GB) end -->
<!--Google Analytics NOTE this will stop processing data July 1st 2023. At which point this embed code can be removed-->
<script type="text/plain" class="optanon-category-2">
var _gaq = _gaq || [];
_gaq.push(['_setAccount', '']);
_gaq.push(['_setDomainName', '']);
_gaq.push(['_trackPageview']);
(function() {
var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})()
</script>

<!-- Google Tag Manager: Updated May 17th 2023 - Cookie Compliance checks have been moved into Google Tag Manager -->
<script type="text/javascript">
(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-KBJGH35');
</script>

</head>

<body id="underlay" data-toggler="nav-open">
<div id="lightbend-banner" class="lightbend-banner akka full-width" data-category="OSS Lightbend Banner Impression" data-label="Akka Banner Impression">
<div class="oss-wrapper">
<div class="oss-brand">
<a class="oss-track-link-label" data-category="OSS Lightbend Banner Clicks" data-label="Lightbend Logo - Akka Banner" href="https://www.lightbend.com">
<img class="lightbend-logo" src="images/banner-logos/lightbend-reverse.svg" alt="Lightbend" title="Lightbend">
</a>
</div>
<div class="oss-ad no-drop-down">
<nav id="lightbendRotator" class="lightbend-rotator">
<a class="oss-track-link-label" data-category="OSS Lightbend Banner Clicks" data-label="Promo Rotator - Lightbend Changed its Software Licensing Model for Akka Technology. [License FAQ] - Akka Banner" href="https://www.lightbend.com/akka/license-faq">
<strong>Lightbend</strong> Changed its Software Licensing Model for Akka Technology. <span class="akka-btn">License FAQ</span>
</a>
</nav>
</div>
</div>
</div>

<header class="site-header hide-for-large">
<div class="sticky-header clearfix">
<a href="https://akka.io"><img class="logo" src="images/akka-alpakka-reverse.svg"/></a>

<button class="menu-icon float-right" type="button" data-toggle="underlay overlay"></button>
</div>
<div id="overlay" class="overlay-nav" data-toggler="nav-open">
<header class="nav-header">
<div class="nav-header-title">
<h1><a href="index.html">Alpakka Documentation</a></h1>
</div>
<div class="nav-header-version">
Version 6.0.1
</div>
<div class="nav-header-groups">
<select class="supergroup" name="Language"><option class="group" value="group-java">Java</option><option class="group" value="group-scala">Scala</option></select>
</div>
</header>
<nav class="nav-toc">
<ul>
  <li><a href="overview.html" class="page">Overview</a></li>
  <li><a href="data-transformations/index.html" class="page">Data Transformations</a></li>
  <li><a href="amqp.html" class="page">AMQP</a></li>
  <li><a href="external/apache-camel.html" class="page">Apache Camel</a></li>
  <li><a href="cassandra.html" class="page">Apache Cassandra</a></li>
  <li><a href="geode.html" class="page">Apache Geode</a></li>
  <li><a href="kafka.html" class="page">Apache Kafka</a></li>
  <li><a href="kudu.html" class="page">Apache Kudu</a></li>
  <li><a href="solr.html" class="page">Apache Solr</a></li>
  <li><a href="avroparquet.html" class="page">Avro Parquet</a></li>
  <li><a href="aws-event-bridge.html" class="page">AWS EventBridge</a></li>
  <li><a href="dynamodb.html" class="page">AWS DynamoDB</a></li>
  <li><a href="kinesis.html" class="page">AWS Kinesis and Firehose</a></li>
  <li><a href="awslambda.html" class="page">AWS Lambda</a></li>
  <li><a href="s3.html" class="page">AWS S3</a></li>
  <li><a href="sns.html" class="page">AWS SNS</a></li>
  <li><a href="sqs.html" class="page">AWS SQS</a></li>
  <li><a href="azure-storage-queue.html" class="page">Azure Storage Queue</a></li>
  <li><a href="couchbase.html" class="page">Couchbase</a></li>
  <li><a href="elasticsearch.html" class="page">Elasticsearch</a></li>
  <li><a href="external/eventuate.html" class="page">Eventuate</a></li>
  <li><a href="file.html#file" class="active page">File</a>
  <ul>
    <li><a href="file.html#artifacts" class="header">Artifacts</a></li>
    <li><a href="file.html#writing-to-and-reading-from-files" class="header">Writing to and reading from files</a></li>
    <li><a href="file.html#tailing-a-file-into-a-stream" class="header">Tailing a file into a stream</a></li>
    <li><a href="file.html#creating-directories" class="header">Creating directories</a></li>
    <li><a href="file.html#listing-directory-contents" class="header">Listing directory contents</a></li>
    <li><a href="file.html#listening-to-changes-in-a-directory" class="header">Listening to changes in a directory</a></li>
    <li><a href="file.html#rotating-the-file-to-stream-into" class="header">Rotating the file to stream into</a></li>
    <li><a href="file.html#zip-archive" class="header">ZIP Archive</a></li>
    <li><a href="file.html#tar-archive" class="header">TAR Archive</a></li>
  </ul></li>
  <li><a href="external/fs2.html" class="page">FS2</a></li>
  <li><a href="ftp.html" class="page">FTP</a></li>
  <li><a href="google-common.html" class="page">Google Common</a></li>
  <li><a href="google-cloud-bigquery.html" class="page">Google Cloud BigQuery</a></li>
  <li><a href="google-cloud-bigquery-storage.html" class="page">Google Cloud BigQuery Storage</a></li>
  <li><a href="google-cloud-pub-sub.html" class="page">Google Cloud Pub/Sub</a></li>
  <li><a href="google-cloud-pub-sub-grpc.html" class="page">Google Cloud Pub/Sub gRPC</a></li>
  <li><a href="google-cloud-storage.html" class="page">Google Cloud Storage</a></li>
  <li><a href="google-fcm.html" class="page">Google FCM</a></li>
  <li><a href="external/grpc.html" class="page">gRPC</a></li>
  <li><a href="hdfs.html" class="page">Hadoop Distributed File System - HDFS</a></li>
  <li><a href="hbase.html" class="page">HBase</a></li>
  <li><a href="huawei-push-kit.html" class="page">Huawei Push Kit</a></li>
  <li><a href="external/http.html" class="page">HTTP</a></li>
  <li><a href="bluemix-cos.html" class="page">IBM Bluemix Cloud Object Storage</a></li>
  <li><a href="external/db2-event-store.html" class="page">IBM Db2 Event Store</a></li>
  <li><a href="influxdb.html" class="page">InfluxDB</a></li>
  <li><a href="ironmq.html" class="page">IronMQ</a></li>
  <li><a href="jms/index.html" class="page">JMS</a></li>
  <li><a href="mongodb.html" class="page">MongoDB</a></li>
  <li><a href="mqtt.html" class="page">MQTT</a></li>
  <li><a href="mqtt-streaming.html" class="page">MQTT Streaming</a></li>
  <li><a href="opensearch.html" class="page">Opensearch</a></li>
  <li><a href="orientdb.html" class="page">OrientDB</a></li>
  <li><a href="external/pulsar.html" class="page">Pulsar</a></li>
  <li><a href="pravega.html" class="page">Pravega</a></li>
  <li><a href="sse.html" class="page">Server-sent Events (SSE)</a></li>
  <li><a href="slick.html" class="page">Slick (JDBC)</a></li>
  <li><a href="spring-web.html" class="page">Spring Web</a></li>
  <li><a href="external/tcp.html" class="page">TCP</a></li>
  <li><a href="udp.html" class="page">UDP</a></li>
  <li><a href="unix-domain-socket.html" class="page">Unix Domain Socket</a></li>
</ul>
</nav>
</div>
</header>
<div class="site-content-wrapper">
<aside class="sticky-sidebar show-for-large">
<header class="nav-header sticky-sidebar-header">
<div class="nav-header-title">
<h1><a href="index.html">Alpakka Documentation</a></h1>
</div>
<div class="nav-header-version">
Version 6.0.1
</div>
<div class="nav-header-groups">
<select class="supergroup" name="Language"><option class="group" value="group-java">Java</option><option class="group" value="group-scala">Scala</option></select>
</div>
</header>
<nav class="site-nav sticky-sidebar-contents">
<div class="nav-toc">
<ul>
  <li><a href="overview.html" class="page">Overview</a></li>
  <li><a href="data-transformations/index.html" class="page">Data Transformations</a></li>
  <li><a href="amqp.html" class="page">AMQP</a></li>
  <li><a href="external/apache-camel.html" class="page">Apache Camel</a></li>
  <li><a href="cassandra.html" class="page">Apache Cassandra</a></li>
  <li><a href="geode.html" class="page">Apache Geode</a></li>
  <li><a href="kafka.html" class="page">Apache Kafka</a></li>
  <li><a href="kudu.html" class="page">Apache Kudu</a></li>
  <li><a href="solr.html" class="page">Apache Solr</a></li>
  <li><a href="avroparquet.html" class="page">Avro Parquet</a></li>
  <li><a href="aws-event-bridge.html" class="page">AWS EventBridge</a></li>
  <li><a href="dynamodb.html" class="page">AWS DynamoDB</a></li>
  <li><a href="kinesis.html" class="page">AWS Kinesis and Firehose</a></li>
  <li><a href="awslambda.html" class="page">AWS Lambda</a></li>
  <li><a href="s3.html" class="page">AWS S3</a></li>
  <li><a href="sns.html" class="page">AWS SNS</a></li>
  <li><a href="sqs.html" class="page">AWS SQS</a></li>
  <li><a href="azure-storage-queue.html" class="page">Azure Storage Queue</a></li>
  <li><a href="couchbase.html" class="page">Couchbase</a></li>
  <li><a href="elasticsearch.html" class="page">Elasticsearch</a></li>
  <li><a href="external/eventuate.html" class="page">Eventuate</a></li>
  <li><a href="file.html#file" class="active page">File</a>
  <ul>
    <li><a href="file.html#artifacts" class="header">Artifacts</a></li>
    <li><a href="file.html#writing-to-and-reading-from-files" class="header">Writing to and reading from files</a></li>
    <li><a href="file.html#tailing-a-file-into-a-stream" class="header">Tailing a file into a stream</a></li>
    <li><a href="file.html#creating-directories" class="header">Creating directories</a></li>
    <li><a href="file.html#listing-directory-contents" class="header">Listing directory contents</a></li>
    <li><a href="file.html#listening-to-changes-in-a-directory" class="header">Listening to changes in a directory</a></li>
    <li><a href="file.html#rotating-the-file-to-stream-into" class="header">Rotating the file to stream into</a></li>
    <li><a href="file.html#zip-archive" class="header">ZIP Archive</a></li>
    <li><a href="file.html#tar-archive" class="header">TAR Archive</a></li>
  </ul></li>
  <li><a href="external/fs2.html" class="page">FS2</a></li>
  <li><a href="ftp.html" class="page">FTP</a></li>
  <li><a href="google-common.html" class="page">Google Common</a></li>
  <li><a href="google-cloud-bigquery.html" class="page">Google Cloud BigQuery</a></li>
  <li><a href="google-cloud-bigquery-storage.html" class="page">Google Cloud BigQuery Storage</a></li>
  <li><a href="google-cloud-pub-sub.html" class="page">Google Cloud Pub/Sub</a></li>
  <li><a href="google-cloud-pub-sub-grpc.html" class="page">Google Cloud Pub/Sub gRPC</a></li>
  <li><a href="google-cloud-storage.html" class="page">Google Cloud Storage</a></li>
  <li><a href="google-fcm.html" class="page">Google FCM</a></li>
  <li><a href="external/grpc.html" class="page">gRPC</a></li>
  <li><a href="hdfs.html" class="page">Hadoop Distributed File System - HDFS</a></li>
  <li><a href="hbase.html" class="page">HBase</a></li>
  <li><a href="huawei-push-kit.html" class="page">Huawei Push Kit</a></li>
  <li><a href="external/http.html" class="page">HTTP</a></li>
  <li><a href="bluemix-cos.html" class="page">IBM Bluemix Cloud Object Storage</a></li>
  <li><a href="external/db2-event-store.html" class="page">IBM Db2 Event Store</a></li>
  <li><a href="influxdb.html" class="page">InfluxDB</a></li>
  <li><a href="ironmq.html" class="page">IronMQ</a></li>
  <li><a href="jms/index.html" class="page">JMS</a></li>
  <li><a href="mongodb.html" class="page">MongoDB</a></li>
  <li><a href="mqtt.html" class="page">MQTT</a></li>
  <li><a href="mqtt-streaming.html" class="page">MQTT Streaming</a></li>
  <li><a href="opensearch.html" class="page">Opensearch</a></li>
  <li><a href="orientdb.html" class="page">OrientDB</a></li>
  <li><a href="external/pulsar.html" class="page">Pulsar</a></li>
  <li><a href="pravega.html" class="page">Pravega</a></li>
  <li><a href="sse.html" class="page">Server-sent Events (SSE)</a></li>
  <li><a href="slick.html" class="page">Slick (JDBC)</a></li>
  <li><a href="spring-web.html" class="page">Spring Web</a></li>
  <li><a href="external/tcp.html" class="page">TCP</a></li>
  <li><a href="udp.html" class="page">UDP</a></li>
  <li><a href="unix-domain-socket.html" class="page">Unix Domain Socket</a></li>
</ul>
</div>
</nav>
<footer class="nav-footer sticky-sidebar-footer">
<a href="https://akka.io"><img class="logo" src="images/akka-alpakka-reverse.svg"/></a>

</footer>
</aside>
<main class="fixed-shift-for-large expanded row">
<section class="site-content small-12 column">
<article class="page-content row">
<div class="small-12 column" id="docs">
<h1><a href="#file" name="file" class="anchor"><span class="anchor-link"></span></a>File</h1>
<p>The File connectors provide additional connectors for filesystems complementing the sources and sinks for files already included in core Akka Streams (which can be found in ).</p>
<table class="project-info">
<tr><th colspan="2">Project Info: Alpakka File</th></tr>
  <tr><th>Artifact</th><td><div>com.lightbend.akka</div>
  <div>akka-stream-alpakka-file</div>
  <div>6.0.1</div>
  <div><a href="other-docs/snapshots.html">Snapshots are available</a></div>
  </td></tr>
  <tr><th>JDK versions</th><td><div>Adopt OpenJDK 8</div><div>Adopt OpenJDK 11</div></td></tr>
  <tr><th>Scala versions</th><td>2.13.10, 2.12.17</td></tr>
  <tr><th>JPMS module name</th><td>akka.stream.alpakka.file</td></tr>
  <tr><th>License</th><td><div><a href="https://raw.githubusercontent.com/akka/alpakka/v6.0.1/LICENSE" target="_blank" rel="noopener noreferrer">BUSL-1.1</a></div>
  </td></tr>
  <tr><th>Readiness level</th><td><div class="readiness-level"><a href="https://developer.lightbend.com/docs/introduction/getting-help/support-terminology.html#community-driven" target="_blank" rel="noopener">Community-driven</a></div>
  <div>Since 0.1, 2016-11-16</div>
  </td></tr>
  <tr><th>Home page</th><td><a href="https://doc.akka.io/docs/alpakka/current">https://doc.akka.io/docs/alpakka/current</a></td></tr>
  <tr><th>API documentation</th><td>
  <div><a href="https://doc.akka.io/api/alpakka/6.0.1/akka/stream/alpakka/file/index.html" target="_blank" rel="noopener noreferrer">API (Scaladoc)</a></div>
  </td></tr>
  <tr><th>Forums</th><td>
  <div><a href="https://discuss.lightbend.com/c/akka/" target="_blank" rel="noopener noreferrer">Lightbend Discuss</a></div>
  </td></tr>
  <tr><th>Release notes</th><td><a href="https://github.com/akka/alpakka/releases" target="_blank" rel="noopener noreferrer">GitHub releases</a></td></tr>
  <tr><th>Issues</th><td><a href="https://github.com/akka/alpakka/labels/p%3Afile" target="_blank" rel="noopener noreferrer">Github issues</a></td></tr>
  <tr><th>Sources</th><td><a href="https://github.com/akka/alpakka" target="_blank" rel="noopener noreferrer">https://github.com/akka/alpakka</a></td></tr>
</table>

<h2><a href="#artifacts" name="artifacts" class="anchor"><span class="anchor-link"></span></a>Artifacts</h2>

<p>The Akka dependencies are available from Akka&rsquo;s library repository. To access them there, you need to configure the URL for this repository.</p>
<dl class="repository"><dt>sbt</dt><dd><pre class="prettyprint"><code class="language-scala">resolvers += "Akka library repository".at("https://repo.akka.io/maven")
</code></pre></dd><dt>Maven</dt><dd><pre class="prettyprint"><code class="language-xml">&lt;project&gt
  ...
  &lt;repositories&gt;
    &lt;repository&gt;
      &lt;id&gt;akka-repository&lt;/id&gt;
      &lt;name>Akka library repository&lt;/name&gt;
      &lt;url>https://repo.akka.io/maven&lt;/url&gt;
    &lt;/repository&gt;
  &lt;/repositories&gt
&lt;/project&gt;
</code></pre></dd><dt>Gradle</dt><dd><pre class="prettyprint"><code class="language-gradle">repositories {
    mavenCentral()
    maven {
        url "https://repo.akka.io/maven"
    }
}
</code></pre></dd></dl>
<p>Additionally, add the dependencies as below.</p><dl class="dependency"><dt>sbt</dt><dd><pre class="prettyprint"><code class="language-scala">val AkkaVersion = "2.8.1"
libraryDependencies ++= Seq(
  "com.lightbend.akka" %% "akka-stream-alpakka-file" % "6.0.1",
  "com.typesafe.akka" %% "akka-stream" % AkkaVersion
)</code></pre></dd><dt>Maven</dt><dd><pre class="prettyprint"><code class="language-xml">&lt;properties&gt;
  &lt;akka.version&gt;2.8.1&lt;/akka.version&gt;
  &lt;scala.binary.version&gt;2.13&lt;/scala.binary.version&gt;
&lt;/properties&gt;
&lt;dependencies&gt
  &lt;dependency&gt;
    &lt;groupId&gt;com.lightbend.akka&lt;/groupId&gt;
    &lt;artifactId&gt;akka-stream-alpakka-file_${scala.binary.version}&lt;/artifactId&gt;
    &lt;version&gt;6.0.1&lt;/version&gt;
  &lt;/dependency&gt
  &lt;dependency&gt;
    &lt;groupId&gt;com.typesafe.akka&lt;/groupId&gt;
    &lt;artifactId&gt;akka-stream_${scala.binary.version}&lt;/artifactId&gt;
    &lt;version&gt;${akka.version}&lt;/version&gt;
  &lt;/dependency&gt
&lt;/dependencies&gt;</code></pre></dd><dt>Gradle</dt><dd><pre class="prettyprint"><code class="language-gradle">def versions = [
  AkkaVersion: "2.8.1",
  ScalaBinary: "2.13"
]
dependencies {
  implementation "com.lightbend.akka:akka-stream-alpakka-file_${versions.ScalaBinary}:6.0.1"
  implementation "com.typesafe.akka:akka-stream_${versions.ScalaBinary}:${versions.AkkaVersion}"
}</code></pre></dd></dl>
<p>The table below shows direct dependencies of this module and the second tab shows all libraries it depends on transitively.</p>
<dl class="dependencies"><dt>Direct dependencies</dt><dd><table>
  <thead><tr><th>Organization</th><th>Artifact</th><th>Version</th></thead>
  <tbody>
    <tr><td>com.typesafe.akka</td><td>akka-stream_2.13</td><td><a href="https://mvnrepository.com/artifact/com.typesafe.akka/akka-stream_2.13/2.8.1" target="_blank">2.8.1</a></td></tr>
    <tr><td>org.scala-lang</td><td>scala-library</td><td><a href="https://mvnrepository.com/artifact/org.scala-lang/scala-library/2.13.10" target="_blank">2.13.10</a></td></tr>
  </tbody>
</table></dd>
<dt>Dependency tree</dt><dd><pre>
com.typesafe.akka    akka-stream_2.13    <a href="https://mvnrepository.com/artifact/com.typesafe.akka/akka-stream_2.13/2.8.1" target="_blank">2.8.1</a>    BUSL-1.1
    com.typesafe.akka    akka-actor_2.13    <a href="https://mvnrepository.com/artifact/com.typesafe.akka/akka-actor_2.13/2.8.1" target="_blank">2.8.1</a>    BUSL-1.1
        com.typesafe    config    <a href="https://mvnrepository.com/artifact/com.typesafe/config/1.4.2" target="_blank">1.4.2</a>    Apache-2.0
        org.scala-lang.modules    scala-java8-compat_2.13    <a href="https://mvnrepository.com/artifact/org.scala-lang.modules/scala-java8-compat_2.13/1.0.0" target="_blank">1.0.0</a>    Apache-2.0
            org.scala-lang    scala-library    <a href="https://mvnrepository.com/artifact/org.scala-lang/scala-library/2.13.10" target="_blank">2.13.10</a>    Apache-2.0
        org.scala-lang    scala-library    <a href="https://mvnrepository.com/artifact/org.scala-lang/scala-library/2.13.10" target="_blank">2.13.10</a>    Apache-2.0
    com.typesafe.akka    akka-protobuf-v3_2.13    <a href="https://mvnrepository.com/artifact/com.typesafe.akka/akka-protobuf-v3_2.13/2.8.1" target="_blank">2.8.1</a>    BUSL-1.1
    com.typesafe    ssl-config-core_2.13    <a href="https://mvnrepository.com/artifact/com.typesafe/ssl-config-core_2.13/0.6.1" target="_blank">0.6.1</a>    Apache-2.0
        com.typesafe    config    <a href="https://mvnrepository.com/artifact/com.typesafe/config/1.4.2" target="_blank">1.4.2</a>    Apache-2.0
        org.scala-lang    scala-library    <a href="https://mvnrepository.com/artifact/org.scala-lang/scala-library/2.13.10" target="_blank">2.13.10</a>    Apache-2.0
    org.reactivestreams    reactive-streams    <a href="https://mvnrepository.com/artifact/org.reactivestreams/reactive-streams/1.0.4" target="_blank">1.0.4</a>    MIT-0
    org.scala-lang    scala-library    <a href="https://mvnrepository.com/artifact/org.scala-lang/scala-library/2.13.10" target="_blank">2.13.10</a>    Apache-2.0
org.scala-lang    scala-library    <a href="https://mvnrepository.com/artifact/org.scala-lang/scala-library/2.13.10" target="_blank">2.13.10</a>    Apache-2.0</pre></dd>
</dl>

<h2><a href="#writing-to-and-reading-from-files" name="writing-to-and-reading-from-files" class="anchor"><span class="anchor-link"></span></a>Writing to and reading from files</h2>

<p>Use the <code>FileIO</code> class to create streams reading from or writing to files. It is part part of Akka streams. </p>

<p><a href="https://doc.akka.io/docs/akka/current/stream/stream-io.html#streaming-file-io">Akka Streaming File IO documentation</a></p>

<h2><a href="#tailing-a-file-into-a-stream" name="tailing-a-file-into-a-stream" class="anchor"><span class="anchor-link"></span></a>Tailing a file into a stream</h2>

<p>The <code>FileTailSource</code> starts at a given offset in a file and emits chunks of bytes until reaching the end of the file, it will then poll the file for changes and emit new changes as they are written  to the file (unless there is backpressure).</p>

<p>A very common use case is combining reading bytes with parsing the bytes into lines, therefore <code>FileTailSource</code> contains a few factory methods to create a source that parses the bytes into lines and emits those.</p>

<p>In this sample we simply tail the lines of a file and print them to standard out:</p>

<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/alpakka/tree/v6.0.1/file/src/test/scala/docs/scaladsl/FileTailSourceSpec.scala#L24-L33" target="_blank" title="Go to snippet source">source</a><code class="language-scala">import akka.stream.alpakka.file.scaladsl.FileTailSource

val fs = FileSystems.getDefault
val lines: Source[String, NotUsed] = FileTailSource.lines(
  path = fs.getPath(path),
  maxLineSize = 8192,
  pollingInterval = 250.millis
)

lines.runForeach(line =&gt; System.out.println(line))</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/alpakka/tree/v6.0.1/file/src/test/java/docs/javadsl/FileTailSourceTest.java#L222-L230" target="_blank" title="Go to snippet source">source</a><code class="language-java">final FileSystem fs = FileSystems.getDefault();
final Duration pollingInterval = Duration.ofMillis(250);
final int maxLineSize = 8192;

final Source&lt;String, NotUsed&gt; lines =
    akka.stream.alpakka.file.javadsl.FileTailSource.createLines(
        fs.getPath(path), maxLineSize, pollingInterval);

lines.runForeach(System.out::println, system);</code></pre></dd>
</dl>
<h3><a href="#shutdown-stream-when-file-is-deleted" name="shutdown-stream-when-file-is-deleted" class="anchor"><span class="anchor-link"></span></a>Shutdown stream when file is deleted</h3>
<p>The <code>FileTailSource</code> stream will not shutdown or throw an error when the file it is tailing is deleted from the filesystem. If you would like to shutdown the stream, or throw an error, you can do so by merging in a <span class="group-java"><a href="/api/alpakka/6.0.1/akka/stream/alpakka/file/javadsl/DirectoryChangesSource$.html" title="akka.stream.alpakka.file.javadsl.DirectoryChangesSource"><code>DirectoryChangesSource</code></a></span><span class="group-scala"><a href="/api/alpakka/6.0.1/akka/stream/alpakka/file/scaladsl/DirectoryChangesSource$.html" title="akka.stream.alpakka.file.scaladsl.DirectoryChangesSource"><code>DirectoryChangesSource</code></a></span> that listens to filesystem events in the directory that contains the file.</p>
<p>In the following example, a <code>DirectoryChangesSource</code> is used to watch for events in a directory. If a file delete event is observed for the file we are tailing then we shutdown the stream gracefully by using a <span class="group-java"><a href="https://doc.akka.io/japi/akka/2.8/akka/stream/javadsl/Flow.html" title="akka.stream.javadsl.Flow"><code>Flow.recoverWithRetries</code></a></span><span class="group-scala"><a href="https://doc.akka.io/api/akka/2.8/akka/stream/scaladsl/Flow$.html" title="akka.stream.scaladsl.Flow"><code>Flow.recoverWithRetries</code></a></span> to switch to a <span class="group-java"><a href="https://doc.akka.io/japi/akka/2.8/akka/stream/javadsl/Source.html" title="akka.stream.javadsl.Source"><code>Source.empty</code></a></span><span class="group-scala"><a href="https://doc.akka.io/api/akka/2.8/akka/stream/scaladsl/Source$.html" title="akka.stream.scaladsl.Source"><code>Source.empty</code></a></span>, which with immediately send an <code>OnComplete</code> signal and shutdown the stream.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/alpakka/tree/v6.0.1/file/src/test/scala/docs/scaladsl/FileTailSourceExtrasSpec.scala#L44-L58" target="_blank" title="Go to snippet source">source</a><code class="language-scala"><br/>val checkInterval = 1.second
val fileCheckSource = DirectoryChangesSource(path.getParent, checkInterval, 8192)
  .collect {
    case (p, DirectoryChange.Deletion) if path == p =&gt;
      throw new FileNotFoundException(path.toString)
  }
  .recoverWithRetries(1, {
    case _: FileNotFoundException =&gt; Source.empty
  })

val stream = FileTailSource
  .lines(path = path, maxLineSize = 8192, pollingInterval = 250.millis)
  .merge(fileCheckSource, eagerComplete = true)
</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/alpakka/tree/v6.0.1/file/src/test/java/docs/javadsl/FileTailSourceTest.java#L136-L160" target="_blank" title="Go to snippet source">source</a><code class="language-java"><br/>final Duration checkInterval = Duration.ofSeconds(1);
final Source&lt;String, NotUsed&gt; fileCheckSource =
    akka.stream.alpakka.file.javadsl.DirectoryChangesSource.create(
            path.getParent(), checkInterval, 8192)
        .mapConcat(
            pair -&gt; {
              if (pair.first().equals(path) &amp;&amp; pair.second() == DirectoryChange.Deletion) {
                throw new FileNotFoundException();
              }
              return Collections.&lt;String&gt;emptyList();
            })
        .recoverWithRetries(
            -1,
            new PFBuilder&lt;Throwable, Source&lt;String, NotUsed&gt;&gt;()
                .match(FileNotFoundException.class, t -&gt; Source.empty())
                .build());

final Source&lt;String, NotUsed&gt; source =
    akka.stream.alpakka.file.javadsl.FileTailSource.createLines(
            path,
            8192, // chunk size
            Duration.ofMillis(250))
        .merge(fileCheckSource, true);
</code></pre></dd>
</dl><div class="callout note "><div class="callout-title">Stream Shutdown Race Condition</div>
<p>Since the <code>DirectoryChangesSource</code> and the <code>FileTailSource</code> operate asynchronously as separate sources there is the possibility that the stream could be shutdown prematurely. If the file is detected as deleted and the stream is shutdown before the last element is emitted from <code>FileTailSource</code>, then that data will never be available to downstream user stages.</p></div>
<h3><a href="#shutdown-stream-after-an-idle-timeout" name="shutdown-stream-after-an-idle-timeout" class="anchor"><span class="anchor-link"></span></a>Shutdown stream after an idle timeout</h3>
<p>It may be useful to shutdown the stream when no new data has been added for awhile to a file being tailed by <code>FileTailSource</code>. In the following example, a <span class="group-java"><a href="https://doc.akka.io/japi/akka/2.8/akka/stream/javadsl/Flow.html" title="akka.stream.javadsl.Flow"><code>Flow.idleTimeout</code></a></span><span class="group-scala"><a href="https://doc.akka.io/api/akka/2.8/akka/stream/scaladsl/Flow$.html" title="akka.stream.scaladsl.Flow"><code>Flow.idleTimeout</code></a></span> operator is used to trigger a <code>TimeoutException</code> that can be recovered with <span class="group-java"><a href="https://doc.akka.io/japi/akka/2.8/akka/stream/javadsl/Flow.html" title="akka.stream.javadsl.Flow"><code>Flow.recoverWithRetries</code></a></span><span class="group-scala"><a href="https://doc.akka.io/api/akka/2.8/akka/stream/scaladsl/Flow$.html" title="akka.stream.scaladsl.Flow"><code>Flow.recoverWithRetries</code></a></span> and a <span class="group-java"><a href="https://doc.akka.io/japi/akka/2.8/akka/stream/javadsl/Source.html" title="akka.stream.javadsl.Source"><code>Source.empty</code></a></span><span class="group-scala"><a href="https://doc.akka.io/api/akka/2.8/akka/stream/scaladsl/Source$.html" title="akka.stream.scaladsl.Source"><code>Source.empty</code></a></span> to successfully shutdown the stream.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/alpakka/tree/v6.0.1/file/src/test/scala/docs/scaladsl/FileTailSourceExtrasSpec.scala#L77-L84" target="_blank" title="Go to snippet source">source</a><code class="language-scala"><br/>val stream = FileTailSource
  .lines(path = path, maxLineSize = 8192, pollingInterval = 250.millis)
  .idleTimeout(5.seconds)
  .recoverWithRetries(1, {
    case _: TimeoutException =&gt; Source.empty
  })
</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/alpakka/tree/v6.0.1/file/src/test/java/docs/javadsl/FileTailSourceTest.java#L182-L194" target="_blank" title="Go to snippet source">source</a><code class="language-java"><br/>Source&lt;String, NotUsed&gt; stream =
    akka.stream.alpakka.file.javadsl.FileTailSource.createLines(
            path,
            8192, // chunk size
            Duration.ofMillis(250))
        .idleTimeout(Duration.ofSeconds(5))
        .recoverWithRetries(
            -1,
            new PFBuilder&lt;Throwable, Source&lt;String, NotUsed&gt;&gt;()
                .match(TimeoutException.class, t -&gt; Source.empty())
                .build());
</code></pre></dd>
</dl>
<h2><a href="#creating-directories" name="creating-directories" class="anchor"><span class="anchor-link"></span></a>Creating directories</h2>
<p><code>Directory.mkdirs()</code> and <code>Directory.mkdirsWithContext()</code> create directories for <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/nio/file/Path.html" title="java.nio.file.Path"><code>Path</code></a> elements in the stream. The <code>withContext</code>-variant allows the user to pass through additional information with every path.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/alpakka/tree/v6.0.1/file/src/test/scala/docs/scaladsl/DirectorySpec.scala#L86-L109" target="_blank" title="Go to snippet source">source</a><code class="language-scala">import akka.stream.alpakka.file.scaladsl.Directory

val flow: Flow[Path, Path, NotUsed] = Directory.mkdirs()

val created: Future[immutable.Seq[Path]] =
  Source(immutable.Seq(dir.resolve(&quot;dirA&quot;), dir.resolve(&quot;dirB&quot;)))
    .via(flow)
    .runWith(Sink.seq)

val flowWithContext: FlowWithContext[Path, SomeContext, Path, SomeContext, NotUsed] =
  Directory.mkdirsWithContext[SomeContext]()</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/alpakka/tree/v6.0.1/file/src/test/java/docs/javadsl/DirectoryTest.java#L132-L153" target="_blank" title="Go to snippet source">source</a><code class="language-java">Flow&lt;Path, Path, NotUsed&gt; flow = Directory.mkdirs();

CompletionStage&lt;List&lt;Path&gt;&gt; created =
    Source.from(Arrays.asList(dir.resolve(&quot;dirA&quot;), dir.resolve(&quot;dirB&quot;)))
        .via(flow)
        .runWith(Sink.seq(), system);

FlowWithContext&lt;Path, SomeContext, Path, SomeContext, NotUsed&gt; flowWithContext =
    Directory.mkdirsWithContext();</code></pre></dd>
</dl>
<h2><a href="#listing-directory-contents" name="listing-directory-contents" class="anchor"><span class="anchor-link"></span></a>Listing directory contents</h2>
<p><code>Directory.ls(path)</code> lists all files and directories directly in a given directory:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/alpakka/tree/v6.0.1/file/src/test/scala/docs/scaladsl/DirectorySpec.scala#L44-L46" target="_blank" title="Go to snippet source">source</a><code class="language-scala">import akka.stream.alpakka.file.scaladsl.Directory

val source: Source[Path, NotUsed] = Directory.ls(dir)</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/alpakka/tree/v6.0.1/file/src/test/java/docs/javadsl/DirectoryTest.java#L12-L70" target="_blank" title="Go to snippet source">source</a><code class="language-java">import akka.stream.Materializer;
import akka.stream.alpakka.file.javadsl.Directory;

final Source&lt;Path, NotUsed&gt; source = Directory.ls(dir);</code></pre></dd>
</dl>
<p><code>Directory.walk(path)</code> traverses all subdirectories and lists files and directories depth first:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/alpakka/tree/v6.0.1/file/src/test/scala/docs/scaladsl/DirectorySpec.scala#L66-L71" target="_blank" title="Go to snippet source">source</a><code class="language-scala">import akka.stream.alpakka.file.scaladsl.Directory
import java.nio.file.FileVisitOption

val files: Source[Path, NotUsed] = Directory.walk(root)

val files2: Source[Path, NotUsed] = Directory.walk(root, maxDepth = Some(1), List(FileVisitOption.FOLLOW_LINKS))</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/alpakka/tree/v6.0.1/file/src/test/java/docs/javadsl/DirectoryTest.java#L12-L118" target="_blank" title="Go to snippet source">source</a><code class="language-java">import akka.stream.Materializer;
import akka.stream.alpakka.file.javadsl.Directory;
import java.nio.file.FileVisitOption;

final Source&lt;Path, NotUsed&gt; source = Directory.walk(root);

final Source&lt;Path, NotUsed&gt; source = Directory.walk(root, 1, FileVisitOption.FOLLOW_LINKS);</code></pre></dd>
</dl>
<h2><a href="#listening-to-changes-in-a-directory" name="listening-to-changes-in-a-directory" class="anchor"><span class="anchor-link"></span></a>Listening to changes in a directory</h2>
<p>The <code>DirectoryChangesSource</code> will emit elements every time there is a change to a watched directory in the local filesystem, the emitted change concists of the path that was changed and an enumeration describing what kind of change it was.</p>
<p>In this sample we simply print each change to the directory to standard output:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/alpakka/tree/v6.0.1/file/src/test/scala/docs/scaladsl/DirectoryChangesSourceSpec.scala#L20-L26" target="_blank" title="Go to snippet source">source</a><code class="language-scala">import akka.stream.alpakka.file.scaladsl.DirectoryChangesSource

val fs = FileSystems.getDefault
val changes = DirectoryChangesSource(fs.getPath(path), pollInterval = 1.second, maxBufferSize = 1000)
changes.runForeach {
  case (path, change) =&gt; println(&quot;Path: &quot; + path + &quot;, Change: &quot; + change)
}</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/alpakka/tree/v6.0.1/file/src/test/java/docs/javadsl/DirectoryChangesSourceTest.java#L13-L163" target="_blank" title="Go to snippet source">source</a><code class="language-java">import akka.stream.alpakka.file.javadsl.DirectoryChangesSource;

final FileSystem fs = FileSystems.getDefault();
final Duration pollingInterval = Duration.ofSeconds(1);
final int maxBufferSize = 1000;
final Source&lt;Pair&lt;Path, DirectoryChange&gt;, NotUsed&gt; changes =
    DirectoryChangesSource.create(fs.getPath(path), pollingInterval, maxBufferSize);

changes.runForeach(
    (Pair&lt;Path, DirectoryChange&gt; pair) -&gt; {
      final Path changedPath = pair.first();
      final DirectoryChange change = pair.second();
      System.out.println(&quot;Path: &quot; + changedPath + &quot;, Change: &quot; + change);
    },
    system);</code></pre></dd>
</dl>
<h2><a href="#rotating-the-file-to-stream-into" name="rotating-the-file-to-stream-into" class="anchor"><span class="anchor-link"></span></a>Rotating the file to stream into</h2>
<p>The <span class="group-java"><a href="/api/alpakka/6.0.1/akka/stream/alpakka/file/javadsl/LogRotatorSink$.html" title="akka.stream.alpakka.file.javadsl.LogRotatorSink"><code>LogRotatorSink</code></a></span><span class="group-scala"><a href="/api/alpakka/6.0.1/akka/stream/alpakka/file/scaladsl/LogRotatorSink$.html" title="akka.stream.alpakka.file.scaladsl.LogRotatorSink"><code>LogRotatorSink</code></a></span> will create and  write to multiple files.<br/>This sink takes a creator as parameter which returns a  <span class="group-scala"><code>Bytestring =&gt; Option[Path]</code> function</span><span class="group-java"><code>Function&lt;ByteString, Optional&lt;Path&gt;&gt;</code></span>. If the generated function returns a path  the sink will rotate the file output to this new path and the actual <code>ByteString</code> will be  written to this new file too.  With this approach the user can define a custom stateful file generation implementation.</p>
<p>This example usage shows the built-in target file creation and a custom sink factory which is required to use <span class="group-java"><a href="https://doc.akka.io/japi/akka/2.8/akka/stream/javadsl/Compression.html" title="akka.stream.javadsl.Compression"><code>Compression</code></a></span><span class="group-scala"><a href="https://doc.akka.io/api/akka/2.8/akka/stream/scaladsl/Compression$.html" title="akka.stream.scaladsl.Compression"><code>Compression</code></a></span> for the target files.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/alpakka/tree/v6.0.1/file/src/test/scala/docs/scaladsl/LogRotatorSinkSpec.scala#L155-L284" target="_blank" title="Go to snippet source">source</a><code class="language-scala">val triggerFunctionCreator: () =&gt; ByteString =&gt; Option[Path] = ???

val completion = Source(immutable.Seq(&quot;test1&quot;, &quot;test2&quot;, &quot;test3&quot;, &quot;test4&quot;, &quot;test5&quot;, &quot;test6&quot;))
  .map(ByteString(_))
  .runWith(LogRotatorSink(triggerFunctionCreator))

// GZip compressing the data written
val completion =
  source
    .runWith(
      LogRotatorSink.withSinkFactory(
        triggerFunctionCreator,
        (path: Path) =&gt;
          Flow[ByteString]
            .via(Compression.gzip)
            .toMat(FileIO.toPath(path))(Keep.right)
      )
    )</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/alpakka/tree/v6.0.1/file/src/test/java/docs/javadsl/LogRotatorSinkTest.java#L119-L145" target="_blank" title="Go to snippet source">source</a><code class="language-java">import akka.stream.alpakka.file.javadsl.LogRotatorSink;

Creator&lt;Function&lt;ByteString, Optional&lt;Path&gt;&gt;&gt; triggerFunctionCreator = ...;

CompletionStage&lt;Done&gt; completion =
    Source.from(Arrays.asList(&quot;test1&quot;, &quot;test2&quot;, &quot;test3&quot;, &quot;test4&quot;, &quot;test5&quot;, &quot;test6&quot;))
        .map(ByteString::fromString)
        .runWith(LogRotatorSink.createFromFunction(triggerFunctionCreator), system);

// GZip compressing the data written
CompletionStage&lt;Done&gt; compressedCompletion =
    source.runWith(
        LogRotatorSink.withSinkFactory(
            triggerFunctionCreator,
            path -&gt;
                Flow.of(ByteString.class)
                    .via(Compression.gzip())
                    .toMat(FileIO.toPath(path), Keep.right())),
        system);</code></pre></dd>
</dl>
<h3><a href="#example-size-based-rotation" name="example-size-based-rotation" class="anchor"><span class="anchor-link"></span></a>Example: size-based rotation</h3>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/alpakka/tree/v6.0.1/file/src/test/scala/docs/scaladsl/LogRotatorSinkSpec.scala#L100-L117" target="_blank" title="Go to snippet source">source</a><code class="language-scala">import akka.stream.alpakka.file.scaladsl.LogRotatorSink

val fileSizeTriggerCreator: () =&gt; ByteString =&gt; Option[Path] = () =&gt; {
  val max = 10 * 1024 * 1024
  var size: Long = max
  element: ByteString =&gt;
    if (size + element.size &gt; max) {
      val path = Files.createTempFile(&quot;out-&quot;, &quot;.log&quot;)
      size = element.size
      Some(path)
    } else {
      size += element.size
      None
    }
}

val sizeRotatorSink: Sink[ByteString, Future[Done]] =
  LogRotatorSink(fileSizeTriggerCreator)</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/alpakka/tree/v6.0.1/file/src/test/java/docs/javadsl/LogRotatorSinkTest.java#L57-L74" target="_blank" title="Go to snippet source">source</a><code class="language-java">Creator&lt;Function&lt;ByteString, Optional&lt;Path&gt;&gt;&gt; sizeBasedTriggerCreator =
    () -&gt; {
      long max = 10 * 1024 * 1024;
      final long[] size = new long[] {max};
      return (element) -&gt; {
        if (size[0] + element.size() &gt; max) {
          Path path = Files.createTempFile(&quot;out-&quot;, &quot;.log&quot;);
          size[0] = element.size();
          return Optional.of(path);
        } else {
          size[0] += element.size();
          return Optional.empty();
        }
      };
    };

Sink&lt;ByteString, CompletionStage&lt;Done&gt;&gt; sizeRotatorSink =
    LogRotatorSink.createFromFunction(sizeBasedTriggerCreator);</code></pre></dd>
</dl>
<h3><a href="#example-time-based-rotation" name="example-time-based-rotation" class="anchor"><span class="anchor-link"></span></a>Example: time-based rotation</h3>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/alpakka/tree/v6.0.1/file/src/test/scala/docs/scaladsl/LogRotatorSinkSpec.scala#L129-L146" target="_blank" title="Go to snippet source">source</a><code class="language-scala">val destinationDir = FileSystems.getDefault.getPath(&quot;/tmp&quot;)
val formatter = DateTimeFormatter.ofPattern(&quot;&#39;stream-&#39;yyyy-MM-dd_HH&#39;.log&#39;&quot;)

val timeBasedTriggerCreator: () =&gt; ByteString =&gt; Option[Path] = () =&gt; {
  var currentFilename: Option[String] = None
  (_: ByteString) =&gt; {
    val newName = LocalDateTime.now().format(formatter)
    if (currentFilename.contains(newName)) {
      None
    } else {
      currentFilename = Some(newName)
      Some(destinationDir.resolve(newName))
    }
  }
}

val timeBasedSink: Sink[ByteString, Future[Done]] =
  LogRotatorSink(timeBasedTriggerCreator)</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/alpakka/tree/v6.0.1/file/src/test/java/docs/javadsl/LogRotatorSinkTest.java#L88-L106" target="_blank" title="Go to snippet source">source</a><code class="language-java">final Path destinationDir = FileSystems.getDefault().getPath(&quot;/tmp&quot;);
final DateTimeFormatter formatter = DateTimeFormatter.ofPattern(&quot;&#39;stream-&#39;yyyy-MM-dd_HH&#39;.log&#39;&quot;);

Creator&lt;Function&lt;ByteString, Optional&lt;Path&gt;&gt;&gt; timeBasedTriggerCreator =
    () -&gt; {
      final String[] currentFileName = new String[] {null};
      return (element) -&gt; {
        String newName = LocalDateTime.now().format(formatter);
        if (newName.equals(currentFileName[0])) {
          return Optional.empty();
        } else {
          currentFileName[0] = newName;
          return Optional.of(destinationDir.resolve(newName));
        }
      };
    };

Sink&lt;ByteString, CompletionStage&lt;Done&gt;&gt; timeBasedSink =
    LogRotatorSink.createFromFunction(timeBasedTriggerCreator);</code></pre></dd>
</dl>
<h3><a href="#example-content-based-rotation-with-compression-to-sftp-file" name="example-content-based-rotation-with-compression-to-sftp-file" class="anchor"><span class="anchor-link"></span></a>Example: content-based rotation with compression to SFTP file</h3>
<p>This example can be found in the <a href="examples/ftp-samples.html#example-rotate-data-stream-over-to-multiple-compressed-files-on-sftp-server">self-contained example documentation section</a>.</p>
<h2><a href="#zip-archive" name="zip-archive" class="anchor"><span class="anchor-link"></span></a>ZIP Archive</h2>
<h3><a href="#writing-zip-archives" name="writing-zip-archives" class="anchor"><span class="anchor-link"></span></a>Writing ZIP Archives</h3>
<p>The <span class="group-java"><a href="/api/alpakka/6.0.1/akka/stream/alpakka/file/javadsl/Archive$.html" title="akka.stream.alpakka.file.javadsl.Archive"><code>Archive</code></a></span><span class="group-scala"><a href="/api/alpakka/6.0.1/akka/stream/alpakka/file/scaladsl/Archive$.html" title="akka.stream.alpakka.file.scaladsl.Archive"><code>Archive</code></a></span> contains flow for compressing multiple files into one ZIP file.</p>
<p>Result of flow can be send to sink even before whole ZIP file is created, so size of resulting ZIP archive is not limited to memory size. </p>
<p>This example usage shows compressing files from disk. </p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/alpakka/tree/v6.0.1/file/src/test/scala/docs/scaladsl/ArchiveSpec.scala#L61-L77" target="_blank" title="Go to snippet source">source</a><code class="language-scala">val fileStream1: Source[ByteString,  Any] = ...
val fileStream2: Source[ByteString,  Any] = ...

val filesStream = Source(
  List(
    (ArchiveMetadata(&quot;akka_full_color.svg&quot;), fileStream1),
    (ArchiveMetadata(&quot;akka_icon_reverse.svg&quot;), fileStream2)
  )
)

val result = filesStream
  .via(Archive.zip())
  .runWith(FileIO.toPath(Paths.get(&quot;result.zip&quot;)))</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/alpakka/tree/v6.0.1/file/src/test/java/docs/javadsl/ArchiveTest.java#L76-L93" target="_blank" title="Go to snippet source">source</a><code class="language-java">Source&lt;ByteString, NotUsed&gt; source1 = ...
Source&lt;ByteString, NotUsed&gt; source2 = ...

Pair&lt;ArchiveMetadata, Source&lt;ByteString, NotUsed&gt;&gt; pair1 =
    Pair.create(ArchiveMetadata.create(&quot;akka_full_color.svg&quot;), source1);
Pair&lt;ArchiveMetadata, Source&lt;ByteString, NotUsed&gt;&gt; pair2 =
    Pair.create(ArchiveMetadata.create(&quot;akka_icon_reverse.svg&quot;), source2);

Source&lt;Pair&lt;ArchiveMetadata, Source&lt;ByteString, NotUsed&gt;&gt;, NotUsed&gt; source =
    Source.from(Arrays.asList(pair1, pair2));

Sink&lt;ByteString, CompletionStage&lt;IOResult&gt;&gt; fileSink = FileIO.toPath(Paths.get(&quot;logo.zip&quot;));
CompletionStage&lt;IOResult&gt; ioResult = source.via(Archive.zip()).runWith(fileSink, system);
</code></pre></dd>
</dl>
<h3><a href="#reading-zip-archives" name="reading-zip-archives" class="anchor"><span class="anchor-link"></span></a>Reading ZIP archives</h3>
<p><span class="group-java"><a href="/api/alpakka/6.0.1/akka/stream/alpakka/file/javadsl/Archive$.html" title="akka.stream.alpakka.file.javadsl.Archive"><code>Archive.zipReader()</code></a></span><span class="group-scala"><a href="/api/alpakka/6.0.1/akka/stream/alpakka/file/scaladsl/Archive$.html" title="akka.stream.alpakka.file.scaladsl.Archive"><code>Archive.zipReader()</code></a></span> reads a file in ZIP format, and emitting the metadata entry and a <code>Source</code> for every file in the stream. It is not needed to emit every file, also multiple files can be emitted in parallel. (Every sub-source will seek into the archive.)</p>
<p>The example below reads the incoming file, and unzip all to the local file system.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/alpakka/tree/v6.0.1/file/src/test/scala/docs/scaladsl/ArchiveSpec.scala#L126-L152" target="_blank" title="Go to snippet source">source</a><code class="language-scala">val zipFile = // ???
val target: Path = // ???
Archive
  .zipReader(zipFile)
  .mapAsyncUnordered(4) {
    case (metadata, source) =&gt;
      val targetFile = target.resolve(metadata.name)
      targetFile.toFile.getParentFile.mkdirs() //missing error handler
      source.runWith(FileIO.toPath(targetFile))
  }</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/alpakka/tree/v6.0.1/file/src/test/java/docs/javadsl/ArchiveTest.java#L113-L125" target="_blank" title="Go to snippet source">source</a><code class="language-java">Archive.zipReader(Paths.get(&quot;logo.zip&quot;).toFile())
    .mapAsync(
        4,
        pair -&gt; {
          ZipArchiveMetadata metadata = pair.first();
          Path targetFile = target.resolve(metadata.getName());
          targetFile.toFile().getParentFile().mkdirs(); // missing error handler
          Source&lt;ByteString, NotUsed&gt; fSource = pair.second();
          // create the target directory
          return fSource
              .runWith(FileIO.toPath(targetFile), system)
              .thenApply(io -&gt; Done.done());
        });</code></pre></dd>
</dl>
<h2><a href="#tar-archive" name="tar-archive" class="anchor"><span class="anchor-link"></span></a>TAR Archive</h2>
<h3><a href="#writing-tar-archives" name="writing-tar-archives" class="anchor"><span class="anchor-link"></span></a>Writing TAR archives</h3>
<p><span class="group-java"><a href="/api/alpakka/6.0.1/akka/stream/alpakka/file/javadsl/Archive$.html" title="akka.stream.alpakka.file.javadsl.Archive"><code>Archive.tar()</code></a></span><span class="group-scala"><a href="/api/alpakka/6.0.1/akka/stream/alpakka/file/scaladsl/Archive$.html" title="akka.stream.alpakka.file.scaladsl.Archive"><code>Archive.tar()</code></a></span> creates a flow for packaging multiple files into one TAR archive.</p>
<p>Result of flow can be send to sink even before whole TAR file is created, so size of resulting TAR archive is not limited to memory size.</p>
<p>This example usage shows packaging directories and files from disk.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/alpakka/tree/v6.0.1/file/src/test/scala/docs/scaladsl/TarArchiveSpec.scala#L68-L88" target="_blank" title="Go to snippet source">source</a><code class="language-scala">  val fileStream1: Source[ByteString,  Any] = ...
  val fileStream2: Source[ByteString,  Any] = ...
  val fileSize1: Long = ...
  val fileSize2: Long = ...

val filesStream = Source(
  List(
    (TarArchiveMetadata.directory(&quot;subdir&quot;, lastModification), Source.empty),
    (TarArchiveMetadata(&quot;subdir&quot;, &quot;akka_full_color.svg&quot;, fileSize1, lastModification), fileStream1),
    (TarArchiveMetadata(&quot;akka_icon_reverse.svg&quot;, fileSize2, lastModification), fileStream2)
  )
)

val result = filesStream
  .via(Archive.tar())
  .runWith(FileIO.toPath(Paths.get(&quot;result.tar&quot;)))</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/alpakka/tree/v6.0.1/file/src/test/java/docs/javadsl/ArchiveTest.java#L147-L172" target="_blank" title="Go to snippet source">source</a><code class="language-java">Source&lt;ByteString, NotUsed&gt; source1 = ...
Source&lt;ByteString, NotUsed&gt; source2 = ...
Long size1 = ...
Long size2 = ...

Pair&lt;TarArchiveMetadata, Source&lt;ByteString, NotUsed&gt;&gt; dir =
    Pair.create(TarArchiveMetadata.directory(&quot;subdir&quot;, lastModification), Source.empty());

Pair&lt;TarArchiveMetadata, Source&lt;ByteString, NotUsed&gt;&gt; pair1 =
    Pair.create(
        TarArchiveMetadata.create(&quot;subdir&quot;, &quot;akka_full_color.svg&quot;, size1, lastModification),
        source1);
Pair&lt;TarArchiveMetadata, Source&lt;ByteString, NotUsed&gt;&gt; pair2 =
    Pair.create(
        TarArchiveMetadata.create(&quot;akka_icon_reverse.svg&quot;, size2, lastModification), source2);

Source&lt;Pair&lt;TarArchiveMetadata, Source&lt;ByteString, NotUsed&gt;&gt;, NotUsed&gt; source =
    Source.from(Arrays.asList(dir, pair1, pair2));

Sink&lt;ByteString, CompletionStage&lt;IOResult&gt;&gt; fileSink = FileIO.toPath(Paths.get(&quot;logo.tar&quot;));
CompletionStage&lt;IOResult&gt; ioResult = source.via(Archive.tar()).runWith(fileSink, system);</code></pre></dd>
</dl>
<p>To produce a gzipped TAR file see the following example.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/alpakka/tree/v6.0.1/file/src/test/scala/docs/scaladsl/TarArchiveSpec.scala#L92-L94" target="_blank" title="Go to snippet source">source</a><code class="language-scala">val resultGz = filesStream
  .via(Archive.tar().via(akka.stream.scaladsl.Compression.gzip))
  .runWith(FileIO.toPath(Paths.get(&quot;result.tar.gz&quot;)))</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/alpakka/tree/v6.0.1/file/src/test/java/docs/javadsl/ArchiveTest.java#L176-L181" target="_blank" title="Go to snippet source">source</a><code class="language-java">Sink&lt;ByteString, CompletionStage&lt;IOResult&gt;&gt; fileSinkGz =
    FileIO.toPath(Paths.get(&quot;logo.tar.gz&quot;));
CompletionStage&lt;IOResult&gt; ioResultGz =
    source
        .via(Archive.tar().via(akka.stream.javadsl.Compression.gzip()))
        .runWith(fileSinkGz, system);</code></pre></dd>
</dl>
<h3><a href="#reading-tar-archives" name="reading-tar-archives" class="anchor"><span class="anchor-link"></span></a>Reading TAR archives</h3>
<p><span class="group-java"><a href="/api/alpakka/6.0.1/akka/stream/alpakka/file/javadsl/Archive$.html" title="akka.stream.alpakka.file.javadsl.Archive"><code>Archive.tarReader()</code></a></span><span class="group-scala"><a href="/api/alpakka/6.0.1/akka/stream/alpakka/file/scaladsl/Archive$.html" title="akka.stream.alpakka.file.scaladsl.Archive"><code>Archive.tarReader()</code></a></span> reads a stream of <code>ByteString</code>s as TAR format emitting the metadata entry and a <code>Source</code> for every file in the stream. It is essential to request all the emitted source&rsquo;s data, otherwise the stream will not reach the next file entry.</p>
<p>The example below reads the incoming stream, creates directories and stores all files in the local file system.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/alpakka/tree/v6.0.1/file/src/test/scala/docs/scaladsl/TarArchiveSpec.scala#L172-L201" target="_blank" title="Go to snippet source">source</a><code class="language-scala">val bytesSource: Source[ByteString, NotUsed] = // ???
val tar =
  bytesSource
    .via(Archive.tarReader())
    .mapAsync(1) {
      case (metadata, source) =&gt;
        val targetFile = target.resolve(metadata.filePath)
        if (metadata.isDirectory) {
          Source
            .single(targetFile)
            .via(Directory.mkdirs())
            .runWith(Sink.ignore)
        } else {
          // create the target directory
          Source
            .single(targetFile.getParent)
            .via(Directory.mkdirs())
            .runWith(Sink.ignore)
            .map { _ =&gt;
              // stream the file contents to a local file
              source.runWith(FileIO.toPath(targetFile))
            }
        }
    }
    .runWith(Sink.ignore)</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/alpakka/tree/v6.0.1/file/src/test/java/docs/javadsl/ArchiveTest.java#L206-L238" target="_blank" title="Go to snippet source">source</a><code class="language-java">Source&lt;ByteString, NotUsed&gt; bytesSource = // ???
CompletionStage&lt;Done&gt; tar =
    bytesSource
        .via(Archive.tarReader())
        .mapAsync(
            1,
            pair -&gt; {
              TarArchiveMetadata metadata = pair.first();
              Path targetFile = target.resolve(metadata.filePath());
              if (metadata.isDirectory()) {
                return Source.single(targetFile)
                    .via(Directory.mkdirs())
                    .runWith(Sink.ignore(), system);
              } else {
                Source&lt;ByteString, NotUsed&gt; source = pair.second();
                // create the target directory
                return Source.single(targetFile.getParent())
                    .via(Directory.mkdirs())
                    .runWith(Sink.ignore(), system)
                    .thenCompose(
                        done -&gt;
                            // stream the file contents to a local file
                            source
                                .runWith(FileIO.toPath(targetFile), system)
                                .thenApply(io -&gt; Done.done()));
              }
            })
        .runWith(Sink.ignore(), system);</code></pre></dd>
</dl>
<p>The test in <a href="https://github.com/akka/alpakka/tree/v6.0.1/file/src/test/java/docs/javadsl/NestedTarReaderTest.java"><code>NestedTarRaderTest</code></a> illustrates how the tar reader may be used to extract tar archives from within a tar archive.</p>
</div>
</article>
<div class="row">
<div class="small-12 column">
<section class="nav-prev-next row">
<div class="nav-prev small-6 column">
<a href="external/eventuate.html"><i class="icon-prev"></i> <span class="link-prev">Eventuate</span></a>
</div>
<div class="nav-next small-6 column clearfix">
<a class="float-right" href="external/fs2.html">FS2 <i class="icon-next"></i></a>
</div>
</section>
</div>
</div>
<div class="source-github row">
Found an error in this documentation? The source code for this page can be found <a href="https://github.com/akka/alpakka/tree/v6.0.1/docs/src/main/paradox/file.md">here</a>.
Please feel free to edit and contribute a pull request.
</div>

<footer class="page-footer row clearfix">
<img class="akka-icon float-left show-for-medium" src="images/akka-icon.svg" />
<section class="copyright">
<div>Alpakka is available under the <a href="https://www.lightbend.com/akka/license" target="_blank">Business Source License 1.1</a>.</div>
<p class="legal">
&copy; 2011-2023 <a href="https://www.lightbend.com" target="_blank">Lightbend, Inc.</a> |
<a href="https://www.lightbend.com/legal/licenses" target="_blank">Licenses</a> |
<a href="https://www.lightbend.com/legal/terms" target="_blank">Terms</a> |
<a href="https://www.lightbend.com/legal/privacy" target="_blank">Privacy Policy</a> |
<a href="https://akka.io/cookie/" target="_blank">Cookie Listing</a> |
<a class="optanon-toggle-display">Cookie Settings</a>
</p>
</section>

</footer>
</section>
</main>
</div>

<script type="text/javascript" src="js/scrollsneak.js"></script>
<script type="text/javascript">jQuery(document).foundation();</script>
<script type="text/javascript" src="js/groups.js"></script>
<script type="text/javascript" src="js/page.js"></script>
<script type="text/javascript" src="js/snippets.js"></script>
<script type="text/javascript" src="js/magellan.js"></script>
<script type="text/javascript" src="js/metadata-toggle.js"></script>
<script type="text/javascript" src="js/lbHeader.js"></script>

<style type="text/css">@import "lib/prettify/prettify.css";</style>
<script type="text/javascript" src="lib/prettify/prettify.js"></script>
<script type="text/javascript" src="lib/prettify/lang-scala.js"></script>
<script type="text/javascript">//<![CDATA[
jQuery(function(){window.prettyPrint && prettyPrint()});
//]]></script>
<script type="text/javascript" src="assets/js/warnOldVersion.js"></script>
<script type="text/javascript">//<![CDATA[
jQuery(function(jq){initOldVersionWarnings(jq, '6.0.1', 'https://doc.akka.io/docs/alpakka/current')});
//]]></script>


</body>
</html>
