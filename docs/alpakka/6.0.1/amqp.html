<!DOCTYPE html>
<html class="no-js" lang="en">

<head>
<title>AMQP &bull; Alpakka Documentation</title>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<meta name="description" content="Alpakka is a Reactive Enterprise Integration library for Java and Scala, based on Reactive Streams and Akka."/>
<link rel="canonical" href="https://doc.akka.io/docs/alpakka/current/amqp.html"/>
<script type="text/javascript" src="lib/jquery/jquery.min.js"></script>
<script type="text/javascript" src="lib/foundation/dist/js/foundation.min.js"></script>
<link rel="stylesheet" type="text/css" href="lib/normalize.css/normalize.css"/>
<link rel="stylesheet" type="text/css" href="lib/foundation/dist/css/foundation.min.css"/>
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.css" />
<link rel="stylesheet" type="text/css" href="css/icons.css"/>
<link rel="stylesheet" type="text/css" href="css/page-8.css"/>
<link rel="stylesheet" type="text/css" href="css/banner-2.css"/>
<link rel="shortcut icon" href="images/favicon.ico" />
<link rel="apple-touch-icon" sizes="180x180" href="images/apple-touch-icon.png"/>
<link rel="icon" type="image/png" sizes="32x32" href="images/favicon-32x32.png"/>
<link rel="icon" type="image/png" sizes="16x16" href="images/favicon-16x16.png"/>
<link rel="manifest" href="images/manifest.json"/>
<meta name="msapplication-TileImage" content="images/mstile-150x150.png"/>
<meta name="msapplication-TileColor" content="#15a9ce"/>
<meta name="theme-color" content="#15a9ce"/>
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>
<!-- OneTrust Cookies Consent Notice (Production Standard, akka.io, en-GB) start -->
<script src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js"  type="text/javascript" charset="UTF-8" data-domain-script="28b912e7-09e9-43d5-91e4-3d1897044004" ></script>
<script type="text/javascript">
function OptanonWrapper() { }
</script>
<!-- OneTrust Cookies Consent Notice (Production Standard, akka.io, en-GB) end -->
<!--Google Analytics-->
<script type="text/plain" class="optanon-category-2">
var _gaq = _gaq || [];
_gaq.push(['_setAccount', '']);
_gaq.push(['_setDomainName', '']);
_gaq.push(['_trackPageview']);
(function() {
var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})()
</script>
<!-- Google Tag Manager -->
<script type="text/plain" class="optanon-category-2">
(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-KBJGH35');
</script>
<!--Marketo-->
<script type="text/plain" class="optanon-category-3">
(function() {
var didInit = false;
function initMunchkin() {
if(didInit === false) {
didInit = true;
Munchkin.init('558-NCX-702', { 'asyncOnly': true, 'disableClickDelay': true });
}
}
var s = document.createElement('script');
s.type = 'text/javascript';
s.async = true;
s.src = '//munchkin.marketo.net/munchkin.js';
s.onreadystatechange = function() {
if (this.readyState == 'complete' || this.readyState == 'loaded') {
initMunchkin();
}
};
s.onload = initMunchkin;
document.getElementsByTagName('head')[0].appendChild(s);
})();
</script>
</head>

<body id="underlay" data-toggler="nav-open">
<div id="lightbend-banner" class="lightbend-banner akka full-width" data-category="OSS Lightbend Banner Impression" data-label="Akka Banner Impression">
<div class="oss-wrapper">
<div class="oss-brand">
<a class="oss-track-link-label" data-category="OSS Lightbend Banner Clicks" data-label="Lightbend Logo - Akka Banner" href="https://www.lightbend.com">
<img class="lightbend-logo" src="images/banner-logos/lightbend-reverse.svg" alt="Lightbend" title="Lightbend">
</a>
</div>
<div class="oss-ad no-drop-down">
<nav id="lightbendRotator" class="lightbend-rotator">
<a class="oss-track-link-label" data-category="OSS Lightbend Banner Clicks" data-label="Promo Rotator - Lightbend Changed its Software Licensing Model for Akka Technology. [License FAQ] - Akka Banner" href="https://www.lightbend.com/akka/license-faq">
<strong>Lightbend</strong> Changed its Software Licensing Model for Akka Technology. <span class="akka-btn">License FAQ</span>
</a>
</nav>
</div>
</div>
</div>

<header class="site-header hide-for-large">
<div class="sticky-header clearfix">
<a href="https://akka.io"><img class="logo" src="images/akka-alpakka-reverse.svg"/></a>

<button class="menu-icon float-right" type="button" data-toggle="underlay overlay"></button>
</div>
<div id="overlay" class="overlay-nav" data-toggler="nav-open">
<header class="nav-header">
<div class="nav-header-title">
<h1><a href="index.html">Alpakka Documentation</a></h1>
</div>
<div class="nav-header-version">
Version 6.0.1
</div>
<div class="nav-header-groups">
<select class="supergroup" name="Language"><option class="group" value="group-java">Java</option><option class="group" value="group-scala">Scala</option></select>
</div>
</header>
<nav class="nav-toc">
<ul>
  <li><a href="overview.html" class="page">Overview</a></li>
  <li><a href="data-transformations/index.html" class="page">Data Transformations</a></li>
  <li><a href="amqp.html#amqp" class="active page">AMQP</a>
  <ul>
    <li><a href="amqp.html#artifacts" class="header">Artifacts</a></li>
    <li><a href="amqp.html#connecting-to-server" class="header">Connecting to server</a></li>
    <li><a href="amqp.html#sending-messages" class="header">Sending messages</a></li>
    <li><a href="amqp.html#receiving-messages" class="header">Receiving messages</a></li>
    <li><a href="amqp.html#using-pub-sub" class="header">Using Pub/Sub</a></li>
    <li><a href="amqp.html#using-rabbitmq-as-an-rpc-mechanism" class="header">Using rabbitmq as an RPC mechanism</a></li>
    <li><a href="amqp.html#acknowledging-messages-downstream" class="header">Acknowledging messages downstream</a></li>
  </ul></li>
  <li><a href="external/apache-camel.html" class="page">Apache Camel</a></li>
  <li><a href="cassandra.html" class="page">Apache Cassandra</a></li>
  <li><a href="geode.html" class="page">Apache Geode</a></li>
  <li><a href="kafka.html" class="page">Apache Kafka</a></li>
  <li><a href="kudu.html" class="page">Apache Kudu</a></li>
  <li><a href="solr.html" class="page">Apache Solr</a></li>
  <li><a href="avroparquet.html" class="page">Avro Parquet</a></li>
  <li><a href="aws-event-bridge.html" class="page">AWS EventBridge</a></li>
  <li><a href="dynamodb.html" class="page">AWS DynamoDB</a></li>
  <li><a href="kinesis.html" class="page">AWS Kinesis and Firehose</a></li>
  <li><a href="awslambda.html" class="page">AWS Lambda</a></li>
  <li><a href="s3.html" class="page">AWS S3</a></li>
  <li><a href="sns.html" class="page">AWS SNS</a></li>
  <li><a href="sqs.html" class="page">AWS SQS</a></li>
  <li><a href="azure-storage-queue.html" class="page">Azure Storage Queue</a></li>
  <li><a href="couchbase.html" class="page">Couchbase</a></li>
  <li><a href="elasticsearch.html" class="page">Elasticsearch</a></li>
  <li><a href="external/eventuate.html" class="page">Eventuate</a></li>
  <li><a href="file.html" class="page">File</a></li>
  <li><a href="external/fs2.html" class="page">FS2</a></li>
  <li><a href="ftp.html" class="page">FTP</a></li>
  <li><a href="google-common.html" class="page">Google Common</a></li>
  <li><a href="google-cloud-bigquery.html" class="page">Google Cloud BigQuery</a></li>
  <li><a href="google-cloud-bigquery-storage.html" class="page">Google Cloud BigQuery Storage</a></li>
  <li><a href="google-cloud-pub-sub.html" class="page">Google Cloud Pub/Sub</a></li>
  <li><a href="google-cloud-pub-sub-grpc.html" class="page">Google Cloud Pub/Sub gRPC</a></li>
  <li><a href="google-cloud-storage.html" class="page">Google Cloud Storage</a></li>
  <li><a href="google-fcm.html" class="page">Google FCM</a></li>
  <li><a href="external/grpc.html" class="page">gRPC</a></li>
  <li><a href="hdfs.html" class="page">Hadoop Distributed File System - HDFS</a></li>
  <li><a href="hbase.html" class="page">HBase</a></li>
  <li><a href="huawei-push-kit.html" class="page">Huawei Push Kit</a></li>
  <li><a href="external/http.html" class="page">HTTP</a></li>
  <li><a href="bluemix-cos.html" class="page">IBM Bluemix Cloud Object Storage</a></li>
  <li><a href="external/db2-event-store.html" class="page">IBM Db2 Event Store</a></li>
  <li><a href="influxdb.html" class="page">InfluxDB</a></li>
  <li><a href="ironmq.html" class="page">IronMQ</a></li>
  <li><a href="jms/index.html" class="page">JMS</a></li>
  <li><a href="mongodb.html" class="page">MongoDB</a></li>
  <li><a href="mqtt.html" class="page">MQTT</a></li>
  <li><a href="mqtt-streaming.html" class="page">MQTT Streaming</a></li>
  <li><a href="opensearch.html" class="page">Opensearch</a></li>
  <li><a href="orientdb.html" class="page">OrientDB</a></li>
  <li><a href="external/pulsar.html" class="page">Pulsar</a></li>
  <li><a href="pravega.html" class="page">Pravega</a></li>
  <li><a href="sse.html" class="page">Server-sent Events (SSE)</a></li>
  <li><a href="slick.html" class="page">Slick (JDBC)</a></li>
  <li><a href="spring-web.html" class="page">Spring Web</a></li>
  <li><a href="external/tcp.html" class="page">TCP</a></li>
  <li><a href="udp.html" class="page">UDP</a></li>
  <li><a href="unix-domain-socket.html" class="page">Unix Domain Socket</a></li>
</ul>
</nav>
</div>
</header>
<div class="site-content-wrapper">
<aside class="sticky-sidebar show-for-large">
<header class="nav-header sticky-sidebar-header">
<div class="nav-header-title">
<h1><a href="index.html">Alpakka Documentation</a></h1>
</div>
<div class="nav-header-version">
Version 6.0.1
</div>
<div class="nav-header-groups">
<select class="supergroup" name="Language"><option class="group" value="group-java">Java</option><option class="group" value="group-scala">Scala</option></select>
</div>
</header>
<nav class="site-nav sticky-sidebar-contents">
<div class="nav-toc">
<ul>
  <li><a href="overview.html" class="page">Overview</a></li>
  <li><a href="data-transformations/index.html" class="page">Data Transformations</a></li>
  <li><a href="amqp.html#amqp" class="active page">AMQP</a>
  <ul>
    <li><a href="amqp.html#artifacts" class="header">Artifacts</a></li>
    <li><a href="amqp.html#connecting-to-server" class="header">Connecting to server</a></li>
    <li><a href="amqp.html#sending-messages" class="header">Sending messages</a></li>
    <li><a href="amqp.html#receiving-messages" class="header">Receiving messages</a></li>
    <li><a href="amqp.html#using-pub-sub" class="header">Using Pub/Sub</a></li>
    <li><a href="amqp.html#using-rabbitmq-as-an-rpc-mechanism" class="header">Using rabbitmq as an RPC mechanism</a></li>
    <li><a href="amqp.html#acknowledging-messages-downstream" class="header">Acknowledging messages downstream</a></li>
  </ul></li>
  <li><a href="external/apache-camel.html" class="page">Apache Camel</a></li>
  <li><a href="cassandra.html" class="page">Apache Cassandra</a></li>
  <li><a href="geode.html" class="page">Apache Geode</a></li>
  <li><a href="kafka.html" class="page">Apache Kafka</a></li>
  <li><a href="kudu.html" class="page">Apache Kudu</a></li>
  <li><a href="solr.html" class="page">Apache Solr</a></li>
  <li><a href="avroparquet.html" class="page">Avro Parquet</a></li>
  <li><a href="aws-event-bridge.html" class="page">AWS EventBridge</a></li>
  <li><a href="dynamodb.html" class="page">AWS DynamoDB</a></li>
  <li><a href="kinesis.html" class="page">AWS Kinesis and Firehose</a></li>
  <li><a href="awslambda.html" class="page">AWS Lambda</a></li>
  <li><a href="s3.html" class="page">AWS S3</a></li>
  <li><a href="sns.html" class="page">AWS SNS</a></li>
  <li><a href="sqs.html" class="page">AWS SQS</a></li>
  <li><a href="azure-storage-queue.html" class="page">Azure Storage Queue</a></li>
  <li><a href="couchbase.html" class="page">Couchbase</a></li>
  <li><a href="elasticsearch.html" class="page">Elasticsearch</a></li>
  <li><a href="external/eventuate.html" class="page">Eventuate</a></li>
  <li><a href="file.html" class="page">File</a></li>
  <li><a href="external/fs2.html" class="page">FS2</a></li>
  <li><a href="ftp.html" class="page">FTP</a></li>
  <li><a href="google-common.html" class="page">Google Common</a></li>
  <li><a href="google-cloud-bigquery.html" class="page">Google Cloud BigQuery</a></li>
  <li><a href="google-cloud-bigquery-storage.html" class="page">Google Cloud BigQuery Storage</a></li>
  <li><a href="google-cloud-pub-sub.html" class="page">Google Cloud Pub/Sub</a></li>
  <li><a href="google-cloud-pub-sub-grpc.html" class="page">Google Cloud Pub/Sub gRPC</a></li>
  <li><a href="google-cloud-storage.html" class="page">Google Cloud Storage</a></li>
  <li><a href="google-fcm.html" class="page">Google FCM</a></li>
  <li><a href="external/grpc.html" class="page">gRPC</a></li>
  <li><a href="hdfs.html" class="page">Hadoop Distributed File System - HDFS</a></li>
  <li><a href="hbase.html" class="page">HBase</a></li>
  <li><a href="huawei-push-kit.html" class="page">Huawei Push Kit</a></li>
  <li><a href="external/http.html" class="page">HTTP</a></li>
  <li><a href="bluemix-cos.html" class="page">IBM Bluemix Cloud Object Storage</a></li>
  <li><a href="external/db2-event-store.html" class="page">IBM Db2 Event Store</a></li>
  <li><a href="influxdb.html" class="page">InfluxDB</a></li>
  <li><a href="ironmq.html" class="page">IronMQ</a></li>
  <li><a href="jms/index.html" class="page">JMS</a></li>
  <li><a href="mongodb.html" class="page">MongoDB</a></li>
  <li><a href="mqtt.html" class="page">MQTT</a></li>
  <li><a href="mqtt-streaming.html" class="page">MQTT Streaming</a></li>
  <li><a href="opensearch.html" class="page">Opensearch</a></li>
  <li><a href="orientdb.html" class="page">OrientDB</a></li>
  <li><a href="external/pulsar.html" class="page">Pulsar</a></li>
  <li><a href="pravega.html" class="page">Pravega</a></li>
  <li><a href="sse.html" class="page">Server-sent Events (SSE)</a></li>
  <li><a href="slick.html" class="page">Slick (JDBC)</a></li>
  <li><a href="spring-web.html" class="page">Spring Web</a></li>
  <li><a href="external/tcp.html" class="page">TCP</a></li>
  <li><a href="udp.html" class="page">UDP</a></li>
  <li><a href="unix-domain-socket.html" class="page">Unix Domain Socket</a></li>
</ul>
</div>
</nav>
<footer class="nav-footer sticky-sidebar-footer">
<a href="https://akka.io"><img class="logo" src="images/akka-alpakka-reverse.svg"/></a>

</footer>
</aside>
<main class="fixed-shift-for-large expanded row">
<section class="site-content small-12 column">
<article class="page-content row">
<div class="small-12 column" id="docs">
<h1><a href="#amqp" name="amqp" class="anchor"><span class="anchor-link"></span></a>AMQP</h1>
<p>The AMQP connector provides Akka Stream sources and sinks to connect to AMQP 0.9.1 servers (RabbitMQ, OpenAMQ, etc.).</p>
<p>AMQP 1.0 is currently not supported (Qpid, ActiveMQ, Solace, etc.).</p>
<table class="project-info">
<tr><th colspan="2">Project Info: Alpakka AMQP</th></tr>
  <tr><th>Artifact</th><td><div>com.lightbend.akka</div>
  <div>akka-stream-alpakka-amqp</div>
  <div>6.0.1</div>
  <div><a href="other-docs/snapshots.html">Snapshots are available</a></div>
  </td></tr>
  <tr><th>JDK versions</th><td><div>Adopt OpenJDK 8</div><div>Adopt OpenJDK 11</div></td></tr>
  <tr><th>Scala versions</th><td>2.13.10, 2.12.17, 3.2.2</td></tr>
  <tr><th>JPMS module name</th><td>akka.stream.alpakka.amqp</td></tr>
  <tr><th>License</th><td><div><a href="https://raw.githubusercontent.com/akka/alpakka/v6.0.1/LICENSE" target="_blank" rel="noopener noreferrer">BUSL-1.1</a></div>
  </td></tr>
  <tr><th>Readiness level</th><td><div class="readiness-level"><a href="https://developer.lightbend.com/docs/introduction/getting-help/support-terminology.html#community-driven" target="_blank" rel="noopener">Community-driven</a></div>
  <div>Since 0.1, 2016-11-11</div>
  </td></tr>
  <tr><th>Home page</th><td><a href="https://doc.akka.io/docs/alpakka/current">https://doc.akka.io/docs/alpakka/current</a></td></tr>
  <tr><th>API documentation</th><td>
  <div><a href="https://doc.akka.io/api/alpakka/6.0.1/akka/stream/alpakka/amqp/index.html" target="_blank" rel="noopener noreferrer">API (Scaladoc)</a></div>
  </td></tr>
  <tr><th>Forums</th><td>
  <div><a href="https://discuss.lightbend.com/c/akka/" target="_blank" rel="noopener noreferrer">Lightbend Discuss</a></div>
  </td></tr>
  <tr><th>Release notes</th><td><a href="https://github.com/akka/alpakka/releases" target="_blank" rel="noopener noreferrer">GitHub releases</a></td></tr>
  <tr><th>Issues</th><td><a href="https://github.com/akka/alpakka/labels/p%3Aamqp" target="_blank" rel="noopener noreferrer">Github issues</a></td></tr>
  <tr><th>Sources</th><td><a href="https://github.com/akka/alpakka" target="_blank" rel="noopener noreferrer">https://github.com/akka/alpakka</a></td></tr>
</table>

<h2><a href="#artifacts" name="artifacts" class="anchor"><span class="anchor-link"></span></a>Artifacts</h2>
<dl class="dependency"><dt>sbt</dt><dd><pre class="prettyprint"><code class="language-scala">val AkkaVersion = "2.8.1"
libraryDependencies ++= Seq(
  "com.lightbend.akka" %% "akka-stream-alpakka-amqp" % "6.0.1",
  "com.typesafe.akka" %% "akka-stream" % AkkaVersion
)</code></pre></dd><dt>Maven</dt><dd><pre class="prettyprint"><code class="language-xml">&lt;properties&gt;
  &lt;akka.version&gt;2.8.1&lt;/akka.version&gt;
  &lt;scala.binary.version&gt;2.13&lt;/scala.binary.version&gt;
&lt;/properties&gt;
&lt;dependencies&gt
  &lt;dependency&gt;
    &lt;groupId&gt;com.lightbend.akka&lt;/groupId&gt;
    &lt;artifactId&gt;akka-stream-alpakka-amqp_${scala.binary.version}&lt;/artifactId&gt;
    &lt;version&gt;6.0.1&lt;/version&gt;
  &lt;/dependency&gt
  &lt;dependency&gt;
    &lt;groupId&gt;com.typesafe.akka&lt;/groupId&gt;
    &lt;artifactId&gt;akka-stream_${scala.binary.version}&lt;/artifactId&gt;
    &lt;version&gt;${akka.version}&lt;/version&gt;
  &lt;/dependency&gt
&lt;/dependencies&gt;</code></pre></dd><dt>Gradle</dt><dd><pre class="prettyprint"><code class="language-gradle">def versions = [
  AkkaVersion: "2.8.1",
  ScalaBinary: "2.13"
]
dependencies {
  implementation "com.lightbend.akka:akka-stream-alpakka-amqp_${versions.ScalaBinary}:6.0.1"
  implementation "com.typesafe.akka:akka-stream_${versions.ScalaBinary}:${versions.AkkaVersion}"
}</code></pre></dd></dl>
<p>The table below shows direct dependencies of this module and the second tab shows all libraries it depends on transitively.</p>
<dl class="dependencies"><dt>Direct dependencies</dt><dd><table>
  <thead><tr><th>Organization</th><th>Artifact</th><th>Version</th></thead>
  <tbody>
    <tr><td>com.rabbitmq</td><td>amqp-client</td><td><a href="https://mvnrepository.com/artifact/com.rabbitmq/amqp-client/5.14.2" target="_blank">5.14.2</a></td></tr>
    <tr><td>com.typesafe.akka</td><td>akka-stream_2.13</td><td><a href="https://mvnrepository.com/artifact/com.typesafe.akka/akka-stream_2.13/2.8.1" target="_blank">2.8.1</a></td></tr>
    <tr><td>org.scala-lang</td><td>scala-library</td><td><a href="https://mvnrepository.com/artifact/org.scala-lang/scala-library/2.13.10" target="_blank">2.13.10</a></td></tr>
  </tbody>
</table></dd>
<dt>Dependency tree</dt><dd><pre>
com.rabbitmq    amqp-client    <a href="https://mvnrepository.com/artifact/com.rabbitmq/amqp-client/5.14.2" target="_blank">5.14.2</a>    ASL 2.0
    org.slf4j    slf4j-api    <a href="https://mvnrepository.com/artifact/org.slf4j/slf4j-api/1.7.32" target="_blank">1.7.32</a>
com.typesafe.akka    akka-stream_2.13    <a href="https://mvnrepository.com/artifact/com.typesafe.akka/akka-stream_2.13/2.8.1" target="_blank">2.8.1</a>    BUSL-1.1
    com.typesafe.akka    akka-actor_2.13    <a href="https://mvnrepository.com/artifact/com.typesafe.akka/akka-actor_2.13/2.8.1" target="_blank">2.8.1</a>    BUSL-1.1
        com.typesafe    config    <a href="https://mvnrepository.com/artifact/com.typesafe/config/1.4.2" target="_blank">1.4.2</a>    Apache-2.0
        org.scala-lang.modules    scala-java8-compat_2.13    <a href="https://mvnrepository.com/artifact/org.scala-lang.modules/scala-java8-compat_2.13/1.0.0" target="_blank">1.0.0</a>    Apache-2.0
            org.scala-lang    scala-library    <a href="https://mvnrepository.com/artifact/org.scala-lang/scala-library/2.13.10" target="_blank">2.13.10</a>    Apache-2.0
        org.scala-lang    scala-library    <a href="https://mvnrepository.com/artifact/org.scala-lang/scala-library/2.13.10" target="_blank">2.13.10</a>    Apache-2.0
    com.typesafe.akka    akka-protobuf-v3_2.13    <a href="https://mvnrepository.com/artifact/com.typesafe.akka/akka-protobuf-v3_2.13/2.8.1" target="_blank">2.8.1</a>    BUSL-1.1
    com.typesafe    ssl-config-core_2.13    <a href="https://mvnrepository.com/artifact/com.typesafe/ssl-config-core_2.13/0.6.1" target="_blank">0.6.1</a>    Apache-2.0
        com.typesafe    config    <a href="https://mvnrepository.com/artifact/com.typesafe/config/1.4.2" target="_blank">1.4.2</a>    Apache-2.0
        org.scala-lang    scala-library    <a href="https://mvnrepository.com/artifact/org.scala-lang/scala-library/2.13.10" target="_blank">2.13.10</a>    Apache-2.0
    org.reactivestreams    reactive-streams    <a href="https://mvnrepository.com/artifact/org.reactivestreams/reactive-streams/1.0.4" target="_blank">1.0.4</a>    MIT-0
    org.scala-lang    scala-library    <a href="https://mvnrepository.com/artifact/org.scala-lang/scala-library/2.13.10" target="_blank">2.13.10</a>    Apache-2.0
org.scala-lang    scala-library    <a href="https://mvnrepository.com/artifact/org.scala-lang/scala-library/2.13.10" target="_blank">2.13.10</a>    Apache-2.0</pre></dd>
</dl>

<h2><a href="#connecting-to-server" name="connecting-to-server" class="anchor"><span class="anchor-link"></span></a>Connecting to server</h2>

<p>All the AMQP connectors are configured using a <span class="group-scala"><a href="/api/alpakka/6.0.1/akka/stream/alpakka/amqp/AmqpConnectionProvider.html" title="akka.stream.alpakka.amqp.AmqpConnectionProvider"><code>AmqpConnectionProvider</code></a></span><span class="group-java"><a href="/api/alpakka/6.0.1/akka/stream/alpakka/amqp/AmqpConnectionProvider.html" title="akka.stream.alpakka.amqp.AmqpConnectionProvider"><code>AmqpConnectionProvider</code></a></span> and a list of <span class="group-scala"><a href="/api/alpakka/6.0.1/akka/stream/alpakka/amqp/Declaration.html" title="akka.stream.alpakka.amqp.Declaration"><code>Declaration</code></a></span><span class="group-java"><a href="/api/alpakka/6.0.1/akka/stream/alpakka/amqp/Declaration.html" title="akka.stream.alpakka.amqp.Declaration"><code>Declaration</code></a></span></p>

<p>There are several types of <span class="group-scala"><a href="/api/alpakka/6.0.1/akka/stream/alpakka/amqp/AmqpConnectionProvider.html" title="akka.stream.alpakka.amqp.AmqpConnectionProvider"><code>AmqpConnectionProvider</code></a></span><span class="group-java"><a href="/api/alpakka/6.0.1/akka/stream/alpakka/amqp/AmqpConnectionProvider.html" title="akka.stream.alpakka.amqp.AmqpConnectionProvider"><code>AmqpConnectionProvider</code></a></span>:</p>

<ul>
  <li><span class="group-scala"><a href="/api/alpakka/6.0.1/akka/stream/alpakka/amqp/AmqpLocalConnectionProvider$.html" title="akka.stream.alpakka.amqp.AmqpLocalConnectionProvider"><code>AmqpLocalConnectionProvider</code></a></span><span class="group-java"><a href="/api/alpakka/6.0.1/akka/stream/alpakka/amqp/AmqpLocalConnectionProvider$.html" title="akka.stream.alpakka.amqp.AmqpLocalConnectionProvider"><code>AmqpLocalConnectionProvider</code></a></span> which connects to the default localhost. It creates a new connection for each stage.</li>
  <li><span class="group-scala"><a href="/api/alpakka/6.0.1/akka/stream/alpakka/amqp/AmqpUriConnectionProvider$.html" title="akka.stream.alpakka.amqp.AmqpUriConnectionProvider"><code>AmqpUriConnectionProvider</code></a></span><span class="group-java"><a href="/api/alpakka/6.0.1/akka/stream/alpakka/amqp/AmqpUriConnectionProvider$.html" title="akka.stream.alpakka.amqp.AmqpUriConnectionProvider"><code>AmqpUriConnectionProvider</code></a></span> which connects to the given AMQP URI. It creates a new connection for each stage.</li>
  <li><span class="group-scala"><a href="/api/alpakka/6.0.1/akka/stream/alpakka/amqp/AmqpDetailsConnectionProvider$.html" title="akka.stream.alpakka.amqp.AmqpDetailsConnectionProvider"><code>AmqpDetailsConnectionProvider</code></a></span><span class="group-java"><a href="/api/alpakka/6.0.1/akka/stream/alpakka/amqp/AmqpDetailsConnectionProvider$.html" title="akka.stream.alpakka.amqp.AmqpDetailsConnectionProvider"><code>AmqpDetailsConnectionProvider</code></a></span> which supports more fine-grained configuration. It creates a new connection for each stage.</li>
  <li><span class="group-scala"><a href="/api/alpakka/6.0.1/akka/stream/alpakka/amqp/AmqpConnectionFactoryConnectionProvider$.html" title="akka.stream.alpakka.amqp.AmqpConnectionFactoryConnectionProvider"><code>AmqpConnectionFactoryConnectionProvider</code></a></span><span class="group-java"><a href="/api/alpakka/6.0.1/akka/stream/alpakka/amqp/AmqpConnectionFactoryConnectionProvider$.html" title="akka.stream.alpakka.amqp.AmqpConnectionFactoryConnectionProvider"><code>AmqpConnectionFactoryConnectionProvider</code></a></span> which takes a raw <a href="https://rabbitmq.github.io/rabbitmq-java-client/api/current/com/rabbitmq/client/ConnectionFactory.html">ConnectionFactory</a>. It creates a new connection for each stage.</li>
  <li><span class="group-scala"><a href="/api/alpakka/6.0.1/akka/stream/alpakka/amqp/AmqpCachedConnectionProvider$.html" title="akka.stream.alpakka.amqp.AmqpCachedConnectionProvider"><code>AmqpCachedConnectionProvider</code></a></span><span class="group-java"><a href="/api/alpakka/6.0.1/akka/stream/alpakka/amqp/AmqpCachedConnectionProvider$.html" title="akka.stream.alpakka.amqp.AmqpCachedConnectionProvider"><code>AmqpCachedConnectionProvider</code></a></span> which receive any other provider as parameter and caches the connection it provides to be used in all stages. By default it closes the connection whenever the last stage using the provider stops. Optionally, it takes <code>automaticRelease</code> boolean parameter so the connection is not automatically release and the user have to release it explicitly.</li>
</ul><div class="callout warning "><div class="callout-title">Warning</div>
<p>Please be aware that the basic usage of <span class="group-scala"><a href="/api/alpakka/6.0.1/akka/stream/alpakka/amqp/AmqpConnectionProvider.html" title="akka.stream.alpakka.amqp.AmqpConnectionProvider"><code>AmqpConnectionProvider</code></a></span><span class="group-java"><a href="/api/alpakka/6.0.1/akka/stream/alpakka/amqp/AmqpConnectionProvider.html" title="akka.stream.alpakka.amqp.AmqpConnectionProvider"><code>AmqpConnectionProvider</code></a></span> like this <code>AmqpUriConnectionProvider(s&quot;amqp://$host:$port&quot;)</code> has an issue with recovering connections, more details can be found in this <a href="https://github.com/akka/alpakka/issues/1270">issue</a></p></div>
<h2><a href="#sending-messages" name="sending-messages" class="anchor"><span class="anchor-link"></span></a>Sending messages</h2>
<p>First define a queue name and the declaration of the queue that the messages will be sent to.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/alpakka/tree/v6.0.1/amqp/src/test/scala/docs/scaladsl/AmqpDocsSpec.scala#L42-L43" target="_blank" title="Go to snippet source">source</a><code class="language-scala">val queueName = &quot;amqp-conn-it-spec-simple-queue-&quot; + System.currentTimeMillis()
val queueDeclaration = QueueDeclaration(queueName)</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/alpakka/tree/v6.0.1/amqp/src/test/java/docs/javadsl/AmqpDocsTest.java#L69-L70" target="_blank" title="Go to snippet source">source</a><code class="language-java">final String queueName = &quot;amqp-conn-it-test-simple-queue-&quot; + System.currentTimeMillis();
final QueueDeclaration queueDeclaration = QueueDeclaration.create(queueName);</code></pre></dd>
</dl>
<p>Here we used <span class="group-scala"><a href="/api/alpakka/6.0.1/akka/stream/alpakka/amqp/QueueDeclaration.html" title="akka.stream.alpakka.amqp.QueueDeclaration"><code>QueueDeclaration</code></a></span><span class="group-java"><a href="/api/alpakka/6.0.1/akka/stream/alpakka/amqp/QueueDeclaration.html" title="akka.stream.alpakka.amqp.QueueDeclaration"><code>QueueDeclaration</code></a></span> configuration class to create a queue declaration.</p>
<h3><a href="#with-flow" name="with-flow" class="anchor"><span class="anchor-link"></span></a>With flow</h3>
<p>Similarly as with Sink, the first step is to create Flow which accepts <span class="group-scala"><a href="/api/alpakka/6.0.1/akka/stream/alpakka/amqp/WriteMessage.html" title="akka.stream.alpakka.amqp.WriteMessage"><code>WriteMessage</code></a></span><span class="group-java"><a href="/api/alpakka/6.0.1/akka/stream/alpakka/amqp/WriteMessage.html" title="akka.stream.alpakka.amqp.WriteMessage"><code>WriteMessage</code></a></span>s and forwards it&rsquo;s content to the AMQP server. Flow emits <span class="group-scala"><a href="/api/alpakka/6.0.1/akka/stream/alpakka/amqp/WriteResult.html" title="akka.stream.alpakka.amqp.WriteResult"><code>WriteResult</code></a></span><span class="group-java"><a href="/api/alpakka/6.0.1/akka/stream/alpakka/amqp/WriteResult.html" title="akka.stream.alpakka.amqp.WriteResult"><code>WriteResult</code></a></span>s informing about publication result (see below for summary of delivery guarantees for different Flow variants).</p>
<p><span class="group-java"><a href="/api/alpakka/6.0.1/akka/stream/alpakka/amqp/javadsl/AmqpFlow$.html" title="akka.stream.alpakka.amqp.javadsl.AmqpFlow"><code>AmqpFlow</code></a></span><span class="group-scala"><a href="/api/alpakka/6.0.1/akka/stream/alpakka/amqp/scaladsl/AmqpFlow$.html" title="akka.stream.alpakka.amqp.scaladsl.AmqpFlow"><code>AmqpFlow</code></a></span> is a collection of factory methods that facilitates creation of flows. Here we created a <em>simple</em> sink, which means that we are able to pass <code>ByteString</code>s to the sink instead of wrapping data into <span class="group-scala"><a href="/api/alpakka/6.0.1/akka/stream/alpakka/amqp/WriteMessage.html" title="akka.stream.alpakka.amqp.WriteMessage"><code>WriteMessage</code></a></span><span class="group-java"><a href="/api/alpakka/6.0.1/akka/stream/alpakka/amqp/WriteMessage.html" title="akka.stream.alpakka.amqp.WriteMessage"><code>WriteMessage</code></a></span>s.</p>
<p>Last step is to <a href="https://doc.akka.io/docs/akka/2.8/stream/stream-flows-and-basics.html">materialize</a> and run the flow we have created.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/alpakka/tree/v6.0.1/amqp/src/test/scala/docs/scaladsl/AmqpDocsSpec.scala#L255-L269" target="_blank" title="Go to snippet source">source</a><code class="language-scala">val settings = AmqpWriteSettings(connectionProvider)
  .withRoutingKey(queueName)
  .withDeclaration(queueDeclaration)
  .withBufferSize(10)
  .withConfirmationTimeout(200.millis)

val amqpFlow: Flow[WriteMessage, WriteResult, Future[Done]] =
  AmqpFlow.withConfirm(settings)

val input = Vector(&quot;one&quot;, &quot;two&quot;, &quot;three&quot;, &quot;four&quot;, &quot;five&quot;)
val result: Future[Seq[WriteResult]] =
  Source(input)
    .map(message =&gt; WriteMessage(ByteString(message)))
    .via(amqpFlow)
    .runWith(Sink.seq)</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/alpakka/tree/v6.0.1/amqp/src/test/java/docs/javadsl/AmqpDocsTest.java#L346-L364" target="_blank" title="Go to snippet source">source</a><code class="language-java">final AmqpWriteSettings settings =
    AmqpWriteSettings.create(connectionProvider)
        .withRoutingKey(queueName)
        .withDeclaration(queueDeclaration)
        .withBufferSize(10)
        .withConfirmationTimeout(Duration.ofMillis(200));

final Flow&lt;WriteMessage, WriteResult, CompletionStage&lt;Done&gt;&gt; amqpFlow =
    AmqpFlow.createWithConfirm(settings);

final List&lt;String&gt; input = Arrays.asList(&quot;one&quot;, &quot;two&quot;, &quot;three&quot;, &quot;four&quot;, &quot;five&quot;);

final List&lt;WriteResult&gt; result =
    Source.from(input)
        .map(message -&gt; WriteMessage.create(ByteString.fromString(message)))
        .via(amqpFlow)
        .runWith(Sink.seq(), system)
        .toCompletableFuture()
        .get();</code></pre></dd>
</dl>
<p>Various variants of AMQP flow offer different delivery and ordering guarantees:</p>
<table>
  <thead>
    <tr>
      <th>AMQP flow factory </th>
      <th>Description </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>AmqpFlow.apply </td>
      <td>The most basic type of flow. Does not impose delivery guarantees, messages are published in a fire-and-forget manner. Emitted results have <code>confirmed</code> always set to true.</td>
    </tr>
    <tr>
      <td>AmqpFlow.withConfirm </td>
      <td>Variant that uses asynchronous confirmations. Maximum number of messages simultaneously waiting for confirmation before signaling backpressure is configured with a <code>bufferSize</code> parameter. Emitted results preserve the order of messages pulled from upstream - due to that restriction this flow is expected to be slightly less effective than it&rsquo;s unordered counterpart.</td>
    </tr>
    <tr>
      <td>AmqpFlow.withConfirmUnordered </td>
      <td>The same as <code>AmqpFlow.withConfirm</code> with the exception of ordering guarantee - results are emitted downstream as soon as confirmation is received, meaning that there is no ordering guarantee of any sort.</td>
    </tr>
  </tbody>
</table>
<p>For <span class="group-java"><a href="https://doc.akka.io/japi/akka/2.8/akka/stream/javadsl/FlowWithContext.html" title="akka.stream.javadsl.FlowWithContext"><code>FlowWithContext</code></a></span><span class="group-scala"><a href="https://doc.akka.io/api/akka/2.8/akka/stream/scaladsl/FlowWithContext$.html" title="akka.stream.scaladsl.FlowWithContext"><code>FlowWithContext</code></a></span> counterparts of above flows see <span class="group-java"><a href="/api/alpakka/6.0.1/akka/stream/alpakka/amqp/javadsl/AmqpFlowWithContext$.html" title="akka.stream.alpakka.amqp.javadsl.AmqpFlowWithContext"><code>AmqpFlowWithContext</code></a></span><span class="group-scala"><a href="/api/alpakka/6.0.1/akka/stream/alpakka/amqp/scaladsl/AmqpFlowWithContext$.html" title="akka.stream.alpakka.amqp.scaladsl.AmqpFlowWithContext"><code>AmqpFlowWithContext</code></a></span>.</p><div class="callout warning "><div class="callout-title">Warning</div>
<p><code>AmqpFlow.withConfirm</code> and <code>AmqpFlow.withConfirmUnordered</code> are implemented using RabbitMQ&rsquo;s extension to AMQP protocol (<a href="https://www.rabbitmq.com/confirms.html#publisher-confirms">Publisher Confirms</a>), therefore they are not intended to work with another AMQP brokers.</p></div>
<h3><a href="#with-sink" name="with-sink" class="anchor"><span class="anchor-link"></span></a>With sink</h3>
<p>Create a sink, that accepts and forwards <span class="group-scala"><a href="https://doc.akka.io/api/akka/2.8/akka/util/ByteString.html" title="akka.util.ByteString"><code>ByteString</code></a></span><span class="group-java"><a href="https://doc.akka.io/japi/akka/2.8/akka/util/ByteString.html" title="akka.util.ByteString"><code>ByteString</code></a></span>s to the AMQP server.</p>
<p><span class="group-java"><a href="/api/alpakka/6.0.1/akka/stream/alpakka/amqp/javadsl/AmqpSink$.html" title="akka.stream.alpakka.amqp.javadsl.AmqpSink"><code>AmqpSink</code></a></span><span class="group-scala"><a href="/api/alpakka/6.0.1/akka/stream/alpakka/amqp/scaladsl/AmqpSink$.html" title="akka.stream.alpakka.amqp.scaladsl.AmqpSink"><code>AmqpSink</code></a></span> is a collection of factory methods that facilitates creation of sinks. Here we created a <em>simple</em> sink, which means that we are able to pass <code>ByteString</code>s to the sink instead of wrapping data into <span class="group-scala"><a href="/api/alpakka/6.0.1/akka/stream/alpakka/amqp/WriteMessage.html" title="akka.stream.alpakka.amqp.WriteMessage"><code>WriteMessage</code></a></span><span class="group-java"><a href="/api/alpakka/6.0.1/akka/stream/alpakka/amqp/WriteMessage.html" title="akka.stream.alpakka.amqp.WriteMessage"><code>WriteMessage</code></a></span>s.</p>
<p>Last step is to <a href="https://doc.akka.io/docs/akka/2.8/stream/stream-flows-and-basics.html">materialize</a> and run the sink we have created.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/alpakka/tree/v6.0.1/amqp/src/test/scala/docs/scaladsl/AmqpDocsSpec.scala#L47-L58" target="_blank" title="Go to snippet source">source</a><code class="language-scala">val amqpSink: Sink[ByteString, Future[Done]] =
  AmqpSink.simple(
    AmqpWriteSettings(connectionProvider)
      .withRoutingKey(queueName)
      .withDeclaration(queueDeclaration)
  )

val input = Vector(&quot;one&quot;, &quot;two&quot;, &quot;three&quot;, &quot;four&quot;, &quot;five&quot;)
val writing: Future[Done] =
  Source(input)
    .map(s =&gt; ByteString(s))
    .runWith(amqpSink)</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/alpakka/tree/v6.0.1/amqp/src/test/java/docs/javadsl/AmqpDocsTest.java#L80-L88" target="_blank" title="Go to snippet source">source</a><code class="language-java">final Sink&lt;ByteString, CompletionStage&lt;Done&gt;&gt; amqpSink =
    AmqpSink.createSimple(
        AmqpWriteSettings.create(connectionProvider)
            .withRoutingKey(queueName)
            .withDeclaration(queueDeclaration));

final List&lt;String&gt; input = Arrays.asList(&quot;one&quot;, &quot;two&quot;, &quot;three&quot;, &quot;four&quot;, &quot;five&quot;);
CompletionStage&lt;Done&gt; writing =
    Source.from(input).map(ByteString::fromString).runWith(amqpSink, system);</code></pre></dd>
</dl>
<h2><a href="#receiving-messages" name="receiving-messages" class="anchor"><span class="anchor-link"></span></a>Receiving messages</h2>
<p>Create a source using the same queue declaration as before.</p>
<p>The <code>bufferSize</code> parameter controls the maximum number of messages to prefetch from the AMQP server.</p>
<p>Run the source and take the same amount of messages as we previously sent to it.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/alpakka/tree/v6.0.1/amqp/src/test/scala/docs/scaladsl/AmqpDocsSpec.scala#L63-L74" target="_blank" title="Go to snippet source">source</a><code class="language-scala">val amqpSource: Source[ReadResult, NotUsed] =
  AmqpSource.atMostOnceSource(
    NamedQueueSourceSettings(connectionProvider, queueName)
      .withDeclaration(queueDeclaration)
      .withAckRequired(false),
    bufferSize = 10
  )

val result: Future[immutable.Seq[ReadResult]] =
  amqpSource
    .take(input.size)
    .runWith(Sink.seq)</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/alpakka/tree/v6.0.1/amqp/src/test/java/docs/javadsl/AmqpDocsTest.java#L93-L102" target="_blank" title="Go to snippet source">source</a><code class="language-java">final Integer bufferSize = 10;
final Source&lt;ReadResult, NotUsed&gt; amqpSource =
    AmqpSource.atMostOnceSource(
        NamedQueueSourceSettings.create(connectionProvider, queueName)
            .withDeclaration(queueDeclaration)
            .withAckRequired(false),
        bufferSize);

final CompletionStage&lt;List&lt;ReadResult&gt;&gt; result =
    amqpSource.take(input.size()).runWith(Sink.seq(), system);</code></pre></dd>
</dl>
<p>This is how you send and receive message from AMQP server using this connector.</p>
<h2><a href="#using-pub-sub" name="using-pub-sub" class="anchor"><span class="anchor-link"></span></a>Using Pub/Sub</h2>
<p>Instead of sending messages directly to queues, it is possible to send messages to an exchange and then provide instructions to the AMQP server what to do with incoming messages. We are going to use the <em>fanout</em> type of the exchange, which enables message broadcasting to multiple consumers. We are going to do that by using an exchange declaration for the sink and all of the sources.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/alpakka/tree/v6.0.1/amqp/src/test/scala/docs/scaladsl/AmqpDocsSpec.scala#L125-L126" target="_blank" title="Go to snippet source">source</a><code class="language-scala">val exchangeName = &quot;amqp-conn-it-spec-pub-sub-&quot; + System.currentTimeMillis()
val exchangeDeclaration = ExchangeDeclaration(exchangeName, &quot;fanout&quot;)</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/alpakka/tree/v6.0.1/amqp/src/test/java/docs/javadsl/AmqpDocsTest.java#L174-L176" target="_blank" title="Go to snippet source">source</a><code class="language-java">final String exchangeName = &quot;amqp-conn-it-test-pub-sub-&quot; + System.currentTimeMillis();
final ExchangeDeclaration exchangeDeclaration =
    ExchangeDeclaration.create(exchangeName, &quot;fanout&quot;);</code></pre></dd>
</dl>
<p>The sink for the exchange is created in a very similar way.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/alpakka/tree/v6.0.1/amqp/src/test/scala/docs/scaladsl/AmqpDocsSpec.scala#L130-L134" target="_blank" title="Go to snippet source">source</a><code class="language-scala">val amqpSink = AmqpSink.simple(
  AmqpWriteSettings(connectionProvider)
    .withExchange(exchangeName)
    .withDeclaration(exchangeDeclaration)
)</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/alpakka/tree/v6.0.1/amqp/src/test/java/docs/javadsl/AmqpDocsTest.java#L180-L184" target="_blank" title="Go to snippet source">source</a><code class="language-java">final Sink&lt;ByteString, CompletionStage&lt;Done&gt;&gt; amqpSink =
    AmqpSink.createSimple(
        AmqpWriteSettings.create(connectionProvider)
            .withExchange(exchangeName)
            .withDeclaration(exchangeDeclaration));</code></pre></dd>
</dl>
<p>For the source, we are going to create multiple sources and merge them using <a href="https://doc.akka.io/docs/akka/2.8/stream/operators/index.html">Akka Streams operators</a>.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/alpakka/tree/v6.0.1/amqp/src/test/scala/docs/scaladsl/AmqpDocsSpec.scala#L138-L153" target="_blank" title="Go to snippet source">source</a><code class="language-scala">val fanoutSize = 4

val mergedSources = (0 until fanoutSize).foldLeft(Source.empty[(Int, String)]) {
  case (source, fanoutBranch) =&gt;
    source.merge(
      AmqpSource
        .atMostOnceSource(
          TemporaryQueueSourceSettings(
            connectionProvider,
            exchangeName
          ).withDeclaration(exchangeDeclaration),
          bufferSize = 1
        )
        .map(msg =&gt; (fanoutBranch, msg.bytes.utf8String))
    )
}</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/alpakka/tree/v6.0.1/amqp/src/test/java/docs/javadsl/AmqpDocsTest.java#L188-L201" target="_blank" title="Go to snippet source">source</a><code class="language-java">final int fanoutSize = 4;
final int bufferSize = 1;

Source&lt;Pair&lt;Integer, String&gt;, NotUsed&gt; mergedSources = Source.empty();
for (int i = 0; i &lt; fanoutSize; i++) {
  final int fanoutBranch = i;
  mergedSources =
      mergedSources.merge(
          AmqpSource.atMostOnceSource(
                  TemporaryQueueSourceSettings.create(connectionProvider, exchangeName)
                      .withDeclaration(exchangeDeclaration),
                  bufferSize)
              .map(msg -&gt; Pair.create(fanoutBranch, msg.bytes().utf8String())));
}</code></pre></dd>
</dl>
<p>We merge all sources into one and add the index of the source to all incoming messages, so we can distinguish which source the incoming message came from.</p>
<p>Such sink and source can be started the same way as in the previous example.</p>
<h2><a href="#using-rabbitmq-as-an-rpc-mechanism" name="using-rabbitmq-as-an-rpc-mechanism" class="anchor"><span class="anchor-link"></span></a>Using rabbitmq as an RPC mechanism</h2>
<p>If you have remote workers that you want to incorporate into a stream, you can do it using rabbit RPC workflow <a href="https://www.rabbitmq.com/tutorials/tutorial-six-java.html">RabbitMQ RPC</a></p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/alpakka/tree/v6.0.1/amqp/src/test/scala/docs/scaladsl/AmqpDocsSpec.scala#L93-L101" target="_blank" title="Go to snippet source">source</a><code class="language-scala">val amqpRpcFlow = AmqpRpcFlow.simple(
  AmqpWriteSettings(connectionProvider).withRoutingKey(queueName).withDeclaration(queueDeclaration)
)

val (rpcQueueF: Future[String], probe: TestSubscriber.Probe[ByteString]) = Source(input)
  .map(s =&gt; ByteString(s))
  .viaMat(amqpRpcFlow)(Keep.right)
  .toMat(TestSink())(Keep.both)
  .run()</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/alpakka/tree/v6.0.1/amqp/src/test/java/docs/javadsl/AmqpDocsTest.java#L128-L140" target="_blank" title="Go to snippet source">source</a><code class="language-java">final Flow&lt;ByteString, ByteString, CompletionStage&lt;String&gt;&gt; ampqRpcFlow =
    AmqpRpcFlow.createSimple(
        AmqpWriteSettings.create(connectionProvider)
            .withRoutingKey(queueName)
            .withDeclaration(queueDeclaration),
        1);

Pair&lt;CompletionStage&lt;String&gt;, TestSubscriber.Probe&lt;ByteString&gt;&gt; result =
    Source.from(input)
        .map(ByteString::fromString)
        .viaMat(ampqRpcFlow, Keep.right())
        .toMat(TestSink.create(system), Keep.both())
        .run(system);</code></pre></dd>
</dl>
<h2><a href="#acknowledging-messages-downstream" name="acknowledging-messages-downstream" class="anchor"><span class="anchor-link"></span></a>Acknowledging messages downstream</h2>
<p>Committable sources return <span class="group-java"><a href="/api/alpakka/6.0.1/akka/stream/alpakka/amqp/javadsl/CommittableReadResult.html" title="akka.stream.alpakka.amqp.javadsl.CommittableReadResult"><code>CommittableReadResult</code></a></span><span class="group-scala"><a href="/api/alpakka/6.0.1/akka/stream/alpakka/amqp/scaladsl/CommittableReadResult.html" title="akka.stream.alpakka.amqp.scaladsl.CommittableReadResult"><code>CommittableReadResult</code></a></span> which wraps the <span class="group-scala"><a href="/api/alpakka/6.0.1/akka/stream/alpakka/amqp/ReadResult.html" title="akka.stream.alpakka.amqp.ReadResult"><code>ReadResult</code></a></span><span class="group-java"><a href="/api/alpakka/6.0.1/akka/stream/alpakka/amqp/ReadResult.html" title="akka.stream.alpakka.amqp.ReadResult"><code>ReadResult</code></a></span> and exposes the methods <code>ack</code> and <code>nack</code>.</p>
<p>Use <code>ack</code> to acknowledge the message back to RabbitMQ. <code>ack</code> takes an optional boolean parameter <code>multiple</code> indicating whether you are acknowledging the individual message or all the messages up to it.</p>
<p>Use <code>nack</code> to reject a message. Apart from the <code>multiple</code> argument, <code>nack</code> takes another optional boolean parameter indicating whether the item should be requeued or not.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/alpakka/tree/v6.0.1/amqp/src/test/scala/docs/scaladsl/AmqpDocsSpec.scala#L196-L237" target="_blank" title="Go to snippet source">source</a><code class="language-scala">val amqpSource = AmqpSource.committableSource(
  NamedQueueSourceSettings(connectionProvider, queueName)
    .withDeclaration(queueDeclaration),
  bufferSize = 10
)

val result: Future[immutable.Seq[ReadResult]] = amqpSource
  .mapAsync(1)(businessLogic)
  .mapAsync(1)(cm =&gt; cm.ack().map(_ =&gt; cm.message))
  .take(input.size)
  .runWith(Sink.seq)

val nackedResults: Future[immutable.Seq[ReadResult]] = amqpSource
  .mapAsync(1)(businessLogic)
  .take(input.size)
  .mapAsync(1)(cm =&gt; cm.nack(multiple = false, requeue = true).map(_ =&gt; cm.message))
  .runWith(Sink.seq)</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/alpakka/tree/v6.0.1/amqp/src/test/java/docs/javadsl/AmqpDocsTest.java#L260-L318" target="_blank" title="Go to snippet source">source</a><code class="language-java">final Integer bufferSize = 10;
final Source&lt;CommittableReadResult, NotUsed&gt; amqpSource =
    AmqpSource.committableSource(
        NamedQueueSourceSettings.create(connectionProvider, queueName)
            .withDeclaration(queueDeclaration),
        bufferSize);

final CompletionStage&lt;List&lt;ReadResult&gt;&gt; result =
    amqpSource
        .mapAsync(1, this::businessLogic)
        .mapAsync(1, cm -&gt; cm.ack(/* multiple */ false).thenApply(unused -&gt; cm.message()))
        .take(input.size())
        .runWith(Sink.seq(), system);

final CompletionStage&lt;List&lt;ReadResult&gt;&gt; nackedResults =
    amqpSource
        .take(input.size())
        .mapAsync(1, this::businessLogic)
        .mapAsync(
            1,
            cm -&gt;
                cm.nack(/* multiple */ false, /* requeue */ true)
                    .thenApply(unused -&gt; cm.message()))
        .runWith(Sink.seq(), system);</code></pre></dd>
</dl>
</div>
</article>
<div class="row">
<div class="small-12 column">
<section class="nav-prev-next row">
<div class="nav-prev small-6 column">
<a href="data-transformations/xml.html"><i class="icon-prev"></i> <span class="link-prev">Extensible Markup Language - XML</span></a>
</div>
<div class="nav-next small-6 column clearfix">
<a class="float-right" href="external/apache-camel.html">Apache Camel <i class="icon-next"></i></a>
</div>
</section>
</div>
</div>
<div class="source-github row">
Found an error in this documentation? The source code for this page can be found <a href="https://github.com/akka/alpakka/tree/v6.0.1/docs/src/main/paradox/amqp.md">here</a>.
Please feel free to edit and contribute a pull request.
</div>

<footer class="page-footer row clearfix">
<img class="akka-icon float-left show-for-medium" src="images/akka-icon.svg" />
<section class="copyright">
<div>Alpakka is available under the <a href="https://www.lightbend.com/akka/license" target="_blank">Business Source License 1.1</a>.</div>
<p class="legal">
&copy; 2011-2023 <a href="https://www.lightbend.com" target="_blank">Lightbend, Inc.</a> |
<a href="https://www.lightbend.com/legal/licenses" target="_blank">Licenses</a> |
<a href="https://www.lightbend.com/legal/terms" target="_blank">Terms</a> |
<a href="https://www.lightbend.com/legal/privacy" target="_blank">Privacy Policy</a> |
<a href="https://akka.io/cookie/" target="_blank">Cookie Listing</a> |
<a class="optanon-toggle-display">Cookie Settings</a>
</p>
</section>

</footer>
</section>
</main>
</div>

<script type="text/javascript" src="js/scrollsneak.js"></script>
<script type="text/javascript">jQuery(document).foundation();</script>
<script type="text/javascript" src="js/groups.js"></script>
<script type="text/javascript" src="js/page.js"></script>
<script type="text/javascript" src="js/snippets.js"></script>
<script type="text/javascript" src="js/magellan.js"></script>
<script type="text/javascript" src="js/metadata-toggle.js"></script>
<script type="text/javascript" src="js/lbHeader.js"></script>

<style type="text/css">@import "lib/prettify/prettify.css";</style>
<script type="text/javascript" src="lib/prettify/prettify.js"></script>
<script type="text/javascript" src="lib/prettify/lang-scala.js"></script>
<script type="text/javascript">//<![CDATA[
jQuery(function(){window.prettyPrint && prettyPrint()});
//]]></script>
<script type="text/javascript" src="assets/js/warnOldVersion.js"></script>
<script type="text/javascript">//<![CDATA[
jQuery(function(jq){initOldVersionWarnings(jq, '6.0.1', 'https://doc.akka.io/docs/alpakka/current')});
//]]></script>


</body>
</html>
