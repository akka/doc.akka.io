<!DOCTYPE html>
<html class="no-js" lang="en">

<head>
<title>AWS SQS Connector · Alpakka</title>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<meta name="description" content="Alpakka is a Reactive Enterprise Integration library for Java and Scala, based on Reactive Streams and Akka."/><link rel="canonical" href="https://doc.akka.io/docs/alpakka/current/sqs.html"/>
<link href="https://fonts.googleapis.com/css?family=Roboto:100normal,100italic,300normal,300italic,400normal,400italic,500normal,500italic,700normal,700italic,900normal,900italicc" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="lib/jquery/jquery.min.js"></script>
<script type="text/javascript" src="js/page.js"></script>
<script type="text/javascript" src="js/groups.js"></script>
<link rel="stylesheet" type="text/css" href="lib/normalize.css/normalize.css"/>
<link rel="stylesheet" type="text/css" href="lib/foundation/dist/foundation.min.css"/>
<link rel="stylesheet" type="text/css" href="css/page.css"/>

<!--
<link rel="shortcut icon" href="images/favicon.ico" />
-->
</head>

<body>
<div class="off-canvas-wrapper">
<div class="off-canvas-wrapper-inner" data-off-canvas-wrapper>

<div class="off-canvas position-left" id="off-canvas-menu" data-off-canvas>
<nav class="off-canvas-nav">
<div class="nav-home">
<a href="index.html" >
<span class="home-icon">⌂</span>Alpakka
</a>
<div class="version-number">
0.17
</div>
</div>
<select class="supergroup" name="Language"><option class="group" value="group-scala">Scala</option><option class="group" value="group-java">Java</option></select>
<div class="nav-toc">
<ul>
  <li><a href="connectors.html" class="page">Connectors</a>
  <ul>
    <li><a href="amqp.html" class="page">AMQP Connector</a></li>
    <li><a href="geode.html" class="page">Apache Geode connector</a></li>
    <li><a href="solr.html" class="page">Apache Solr Connector</a></li>
    <li><a href="dynamodb.html" class="page">AWS DynamoDB Connector</a></li>
    <li><a href="kinesis.html" class="page">AWS Kinesis Connector</a></li>
    <li><a href="awslambda.html" class="page">AWS Lambda Connector</a></li>
    <li><a href="s3.html" class="page">AWS S3 Connector</a></li>
    <li><a href="sns.html" class="page">AWS SNS Connector</a></li>
    <li><a href="sqs.html" class="active page">AWS SQS Connector</a></li>
    <li><a href="azure-storage-queue.html" class="page">Azure Storage Queue Connector</a></li>
    <li><a href="cassandra.html" class="page">Cassandra Connector</a></li>
    <li><a href="elasticsearch.html" class="page">Elasticsearch Connector</a></li>
    <li><a href="file.html" class="page">File Connectors</a></li>
    <li><a href="ftp.html" class="page">FTP Connector</a></li>
    <li><a href="google-cloud-pub-sub.html" class="page">Google Cloud Pub/Sub</a></li>
    <li><a href="hbase.html" class="page">HBase connector</a></li>
    <li><a href="ironmq.html" class="page">IronMq Connector</a></li>
    <li><a href="jms.html" class="page">JMS Connector</a></li>
    <li><a href="mongodb.html" class="page">MongoDB Connector</a></li>
    <li><a href="mqtt.html" class="page">MQTT Connector</a></li>
    <li><a href="orientdb.html" class="page">OrientDB Connector</a></li>
    <li><a href="sse.html" class="page">Server-sent Events (SSE) Connector</a></li>
    <li><a href="slick.html" class="page">Slick (JDBC) Connector</a></li>
    <li><a href="spring-web.html" class="page">Spring Web</a></li>
    <li><a href="unix-domain-socket.html" class="page">Unix Domain Socket Connector</a></li>
  </ul></li>
  <li><a href="external-connectors.html" class="page">External Connectors</a></li>
  <li><a href="external-components.html" class="page">External Components</a></li>
  <li><a href="examples/index.html" class="page">Self-contained examples</a>
  <ul>
    <li><a href="examples/jms-samples.html" class="page">JMS examples</a></li>
    <li><a href="examples/ftp-samples.html" class="page">FTP examples</a></li>
    <li><a href="examples/csv-samples.html" class="page">CSV examples</a></li>
    <li><a href="examples/elasticsearch-samples.html" class="page">Elasticsearch examples</a></li>
  </ul></li>
  <li><a href="other-docs.html" class="page">Other documentation</a></li>
  <li><a href="patterns.html" class="page">Integration Patterns</a></li>
  <li><a href="data-transformations/index.html" class="page">Data Transformations</a>
  <ul>
    <li><a href="data-transformations/parsing-lines.html" class="page">Parsing Lines</a></li>
    <li><a href="data-transformations/json.html" class="page">JSON</a></li>
    <li><a href="data-transformations/compression.html" class="page">Compressing/decompressing</a></li>
    <li><a href="data-transformations/csv.html" class="page">Comma-Separated Values - CSV</a></li>
    <li><a href="data-transformations/recordio.html" class="page">RecordIO Framing</a></li>
    <li><a href="data-transformations/xml.html" class="page">Extensible Markup Language - XML</a></li>
  </ul></li>
</ul>
</div>

</nav>
</div>

<div class="off-canvas-content" data-off-canvas-content>

<header class="site-header expanded row">
<div class="small-12 column">
<a href="#" class="off-canvas-toggle hide-for-medium" data-toggle="off-canvas-menu"><svg class="svg-icon svg-icon-menu" version="1.1" id="Menu" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 20 20" enable-background="new 0 0 20 20" xml:space="preserve"> <path class="svg-icon-menu-path" fill="#53CDEC" d="M16.4,9H3.6C3.048,9,3,9.447,3,10c0,0.553,0.048,1,0.6,1H16.4c0.552,0,0.6-0.447,0.6-1C17,9.447,16.952,9,16.4,9z M16.4,13
H3.6C3.048,13,3,13.447,3,14c0,0.553,0.048,1,0.6,1H16.4c0.552,0,0.6-0.447,0.6-1C17,13.447,16.952,13,16.4,13z M3.6,7H16.4
C16.952,7,17,6.553,17,6c0-0.553-0.048-1-0.6-1H3.6C3.048,5,3,5.447,3,6C3,6.553,3.048,7,3.6,7z"/></svg>
</a>
<div class="title"><a href="index.html" class="logo" style="margin-top: 15px;"><svg class="svg-icon svg-icon-logo" style="height: 45px; width: 184px;" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1070 262"><title>akka-stream-alpakka</title><g id="akka-stream-alpakka" class="svg-icon-logo-text" fill="#fff"><path d="M349.6 105.5v-12.2h19.9v58.4c0 7.1 1.7 9.8 6.1 9.8 1.2 0 2.7-.2 4.1-.3v16.1c-2.2.8-5.5 1.3-9.8 1.3-4.8 0-8.6-.8-11.6-2.7-3.7-2.5-6-5.8-6.8-10.1-5.8 8.8-15.4 13.1-28.7 13.1-11.8 0-21.7-4.1-29.9-12.6-8-8.5-12-18.8-12-31.2s4-22.7 12-31c8.1-8.5 18.1-12.6 29.9-12.6 13.6 0 23.7 6 26.8 14zm-5.9 47.9c5-4.8 7.5-11 7.5-18.3s-2.5-13.4-7.5-18.3c-4.8-4.8-11-7.3-18.1-7.3-7.1 0-12.9 2.5-17.8 7.3-4.6 4.8-7 11-7 18.3s2.3 13.4 7 18.3c4.8 4.8 10.6 7.3 17.8 7.3 7.1 0 13.3-2.5 18.1-7.3zM388.5 177v-115.7h19.8v67.6l30.9-35.5h22.8l-32.7 37.4 36.2 46.3h-22.6l-26.4-33.7-8.3 9.3v24.3h-19.7zM470.8 177v-115.7h19.8v67.6l30.9-35.5h22.9l-32.7 37.4 36.2 46.3h-22.6l-26.4-33.7-8.3 9.3v24.3h-19.8zM607.9 105.5v-12.2h19.9v58.4c0 7.1 1.7 9.8 6.1 9.8 1.2 0 2.7-.2 4.1-.3v16.1c-2.2.8-5.5 1.3-9.8 1.3-4.8 0-8.6-.8-11.6-2.7-3.7-2.5-6-5.8-6.8-10.1-5.8 8.8-15.4 13.1-28.7 13.1-11.8 0-21.7-4.1-29.9-12.6-8-8.5-12-18.8-12-31.2s4-22.7 12-31c8.1-8.5 18.1-12.6 29.9-12.6 13.5 0 23.6 6 26.8 14zm-6 47.9c5-4.8 7.5-11 7.5-18.3s-2.5-13.4-7.5-18.3c-4.8-4.8-11-7.3-18.1-7.3-7.1 0-12.9 2.5-17.8 7.3-4.6 4.8-7 11-7 18.3s2.3 13.4 7 18.3c4.8 4.8 10.6 7.3 17.8 7.3 7.1 0 13.3-2.5 18.1-7.3z"/></g><path fill="#0B5567" d="M230.3 212.8c35.9 28.7 58.9-57 1.7-72.8-48-13.3-96.3 9.5-144.7 62.7 0 0 89.4-32.7 143 10.1z"/><path fill="#15A9CE" d="M88.1 202c34.4-35.7 91.6-75.5 144.9-60.8 12.4 3.5 21.2 10.7 26.9 19.3l-50.4-101.7c-7.2-11.5-25.6-9.1-36-.3l-133.2 111.6c-12.1 10.4-12.8 28.9-1.6 40.1 9.9 9.9 25.6 10.8 36.5 2l12.9-10.2z"/></g></svg>
</a></div>

<!--
<a href="https://www.example.com" class="logo show-for-medium">logo</a>
-->
</div>
</header>

<div class="expanded row">

<div class="medium-3 large-2 show-for-medium column">
<nav class="site-nav">
<div class="nav-home">
<a href="index.html" >
<span class="home-icon">⌂</span>Alpakka
</a>
<div class="version-number">
0.17
</div>
</div>
<select class="supergroup" name="Language"><option class="group" value="group-scala">Scala</option><option class="group" value="group-java">Java</option></select>
<div class="nav-toc">
<ul>
  <li><a href="connectors.html" class="page">Connectors</a>
  <ul>
    <li><a href="amqp.html" class="page">AMQP Connector</a></li>
    <li><a href="geode.html" class="page">Apache Geode connector</a></li>
    <li><a href="solr.html" class="page">Apache Solr Connector</a></li>
    <li><a href="dynamodb.html" class="page">AWS DynamoDB Connector</a></li>
    <li><a href="kinesis.html" class="page">AWS Kinesis Connector</a></li>
    <li><a href="awslambda.html" class="page">AWS Lambda Connector</a></li>
    <li><a href="s3.html" class="page">AWS S3 Connector</a></li>
    <li><a href="sns.html" class="page">AWS SNS Connector</a></li>
    <li><a href="sqs.html" class="active page">AWS SQS Connector</a></li>
    <li><a href="azure-storage-queue.html" class="page">Azure Storage Queue Connector</a></li>
    <li><a href="cassandra.html" class="page">Cassandra Connector</a></li>
    <li><a href="elasticsearch.html" class="page">Elasticsearch Connector</a></li>
    <li><a href="file.html" class="page">File Connectors</a></li>
    <li><a href="ftp.html" class="page">FTP Connector</a></li>
    <li><a href="google-cloud-pub-sub.html" class="page">Google Cloud Pub/Sub</a></li>
    <li><a href="hbase.html" class="page">HBase connector</a></li>
    <li><a href="ironmq.html" class="page">IronMq Connector</a></li>
    <li><a href="jms.html" class="page">JMS Connector</a></li>
    <li><a href="mongodb.html" class="page">MongoDB Connector</a></li>
    <li><a href="mqtt.html" class="page">MQTT Connector</a></li>
    <li><a href="orientdb.html" class="page">OrientDB Connector</a></li>
    <li><a href="sse.html" class="page">Server-sent Events (SSE) Connector</a></li>
    <li><a href="slick.html" class="page">Slick (JDBC) Connector</a></li>
    <li><a href="spring-web.html" class="page">Spring Web</a></li>
    <li><a href="unix-domain-socket.html" class="page">Unix Domain Socket Connector</a></li>
  </ul></li>
  <li><a href="external-connectors.html" class="page">External Connectors</a></li>
  <li><a href="external-components.html" class="page">External Components</a></li>
  <li><a href="examples/index.html" class="page">Self-contained examples</a>
  <ul>
    <li><a href="examples/jms-samples.html" class="page">JMS examples</a></li>
    <li><a href="examples/ftp-samples.html" class="page">FTP examples</a></li>
    <li><a href="examples/csv-samples.html" class="page">CSV examples</a></li>
    <li><a href="examples/elasticsearch-samples.html" class="page">Elasticsearch examples</a></li>
  </ul></li>
  <li><a href="other-docs.html" class="page">Other documentation</a></li>
  <li><a href="patterns.html" class="page">Integration Patterns</a></li>
  <li><a href="data-transformations/index.html" class="page">Data Transformations</a>
  <ul>
    <li><a href="data-transformations/parsing-lines.html" class="page">Parsing Lines</a></li>
    <li><a href="data-transformations/json.html" class="page">JSON</a></li>
    <li><a href="data-transformations/compression.html" class="page">Compressing/decompressing</a></li>
    <li><a href="data-transformations/csv.html" class="page">Comma-Separated Values - CSV</a></li>
    <li><a href="data-transformations/recordio.html" class="page">RecordIO Framing</a></li>
    <li><a href="data-transformations/xml.html" class="page">Extensible Markup Language - XML</a></li>
  </ul></li>
</ul>
</div>

</nav>
</div>

<div class="small-12 medium-9 large-10 column">
<section class="site-content">

<div class="page-header row">
<div class="medium-12 show-for-medium column">
<div class="nav-breadcrumbs">
<ul>
  <li><a href="index.html">Alpakka</a></li>
  <li><a href="connectors.html">Connectors</a></li>
  <li>AWS SQS Connector</li>
</ul>
</div>
</div>
</div>

<div class="page-content row">
<div class="small-12 large-9 column" id="docs">
<h1><a href="#aws-sqs-connector" name="aws-sqs-connector" class="anchor"><span class="anchor-link"></span></a>AWS SQS Connector</h1>
<p>The AWS SQS connector provides Akka Stream sources and sinks for AWS SQS queues.</p>
<p>For more information about AWS SQS please visit the <a href="https://aws.amazon.com/documentation/sqs/">official documentation</a>.</p>
<h3><a href="#reported-issues" name="reported-issues" class="anchor"><span class="anchor-link"></span></a>Reported issues</h3>
<p><a href="https://github.com/akka/alpakka/labels/p%3Aaws-sqs">Tagged issues at Github</a></p>
<h2><a href="#artifacts" name="artifacts" class="anchor"><span class="anchor-link"></span></a>Artifacts</h2><dl class="dependency"><dt>sbt</dt><dd><pre class="prettyprint"><code class="language-scala">libraryDependencies += "com.lightbend.akka" %% "akka-stream-alpakka-sqs" % "0.17"</code></pre></dd><dt>Maven</dt><dd><pre class="prettyprint"><code class="language-xml">&lt;dependency&gt;
  &lt;groupId&gt;com.lightbend.akka&lt;/groupId&gt;
  &lt;artifactId&gt;akka-stream-alpakka-sqs_2.12&lt;/artifactId&gt;
  &lt;version&gt;0.17&lt;/version&gt;
&lt;/dependency&gt;</code></pre></dd><dt>Gradle</dt><dd><pre class="prettyprint"><code class="language-gradle">dependencies {
  compile group: 'com.lightbend.akka', name: 'akka-stream-alpakka-sqs_2.12', version: '0.17'
}</code></pre></dd></dl>
<h2><a href="#usage" name="usage" class="anchor"><span class="anchor-link"></span></a>Usage</h2>
<p>Sources, Flows and Sinks provided by this connector need a prepared <code>AmazonSQSAsync</code> to load messages from a queue.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">val client: AmazonSQSAsync = AmazonSQSAsyncClientBuilder
  .standard()
  .withCredentials(credentialsProvider)
  .withEndpointConfiguration(new EndpointConfiguration(sqsEndpoint, &quot;eu-central-1&quot;))
  .build()</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><code class="language-java">AmazonSQSAsync client = AmazonSQSAsyncClientBuilder.standard()
  .withCredentials(credentialsProvider)
  .withEndpointConfiguration(
          new AwsClientBuilder.EndpointConfiguration(sqsEndpoint, &quot;eu-central-1&quot;))
  .build();</code></pre></dd>
</dl>
<p>We will also need an <a href="https://doc.akka.io/api/akka/2.5.9/akka/actor/ActorSystem.html">ActorSystem</a> and an <a href="https://doc.akka.io/api/akka/2.5.9/akka/stream/ActorMaterializer.html">ActorMaterializer</a>.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">implicit val system = ActorSystem()
implicit val mat = ActorMaterializer()</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><code class="language-java">system = ActorSystem.create();
materializer = ActorMaterializer.create(system);</code></pre></dd>
</dl>
<p>This is all preparation that we are going to need.</p>
<h3><a href="#stream-messages-from-a-sqs-queue" name="stream-messages-from-a-sqs-queue" class="anchor"><span class="anchor-link"></span></a>Stream messages from a SQS queue</h3>
<p>Now we can stream AWS Java SDK SQS <code>Message</code> objects from any SQS queue where we have access to by providing the queue URL to the <a href="http://developer.lightbend.com/docs/api/alpakka/0.17/akka/stream/alpakka/sqs/scaladsl/SqsSource$.html">SqsSource</a> factory.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">SqsSource(queue, sqsSourceSettings).take(100).runWith(Sink.seq).map(_ should have size 100)</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><code class="language-java">final CompletionStage&lt;String&gt; cs = SqsSource.create(queueUrl, sqsSourceSettings, sqsClient)
    .map(Message::getBody)
    .runWith(Sink.head(), materializer);
final CompletionStage&lt;String&gt; cs = SqsSource.create(queueUrl, sqsSourceSettings, customSqsClient)
        .map(Message::getBody)
        .take(1)
        .runWith(Sink.head(), materializer);</code></pre></dd>
</dl>
<p>As you have seen we take the first 100 elements from the stream. The reason for this is, that reading messages from SQS queues never finishes because there is no direct way to determine the end of a queue.</p>
<h4><a href="#source-configuration" name="source-configuration" class="anchor"><span class="anchor-link"></span></a>Source configuration</h4>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">final case class SqsSourceSettings(
    waitTimeSeconds: Int,
    maxBufferSize: Int,
    maxBatchSize: Int,
    attributeNames: Seq[AttributeName] = Seq(),
    messageAttributeNames: Seq[MessageAttributeName] = Seq()
) {
  require(maxBatchSize &lt;= maxBufferSize, &quot;maxBatchSize must be lower or equal than maxBufferSize&quot;)
  // SQS requirements
  require(0 &lt;= waitTimeSeconds &amp;&amp; waitTimeSeconds &lt;= 20,
          s&quot;Invalid value ($waitTimeSeconds) for waitTimeSeconds. Requirement: 0 &lt;= waitTimeSeconds &lt;= 20 &quot;)
  require(1 &lt;= maxBatchSize &amp;&amp; maxBatchSize &lt;= 10,
          s&quot;Invalid value ($maxBatchSize) for maxBatchSize. Requirement: 1 &lt;= maxBatchSize &lt;= 10 &quot;)
}</code></pre></dd>
</dl>
<p>Options:</p>
<ul>
  <li><code>maxBatchSize</code> - the maximum number of messages to return (see <code>MaxNumberOfMessages</code> in AWS docs). Default: 10</li>
  <li><code>maxBufferSize</code> - internal buffer size used by the <code>Source</code>. Default: 100 messages</li>
  <li><code>waitTimeSeconds</code> - the duration for which the call waits for a message to arrive in the queue before returning (see <code>WaitTimeSeconds</code> in AWS docs). Default: 20 seconds</li>
</ul>
<p>Be aware that the <code>SqsSource</code> runs multiple requests to Amazon SQS in parallel. The maximum number of concurrent requests is limited by <code>parallelism = maxBufferSize / maxBatchSize</code>. E.g.: By default <code>maxBatchSize</code> is set to 10 and <code>maxBufferSize</code> is set to 100 so at the maximum, <code>SqsSource</code> will run 10 concurrent requests to Amazon SQS. <code>AmazonSQSAsyncClient</code> uses a fixed thread pool with 50 threads by default. To tune the thread pool used by <code>AmazonSQSAsyncClient</code> you can supply a custom <code>ExecutorService</code> on client creation.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">val customSqsClient: AmazonSQSAsync =
  AmazonSQSAsyncClientBuilder
    .standard()
    .withCredentials(credentialsProvider)
    .withExecutorFactory(new ExecutorFactory {
      override def newExecutor() = Executors.newFixedThreadPool(10)
    })
    .withEndpointConfiguration(new EndpointConfiguration(sqsEndpoint, &quot;eu-central-1&quot;))
    .build()</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><code class="language-java">AmazonSQSAsync customSqsClient =
  AmazonSQSAsyncClientBuilder
    .standard()
    .withCredentials(credentialsProvider)
    .withExecutorFactory(() -&gt; Executors.newFixedThreadPool(10))
    .withEndpointConfiguration(
            new AwsClientBuilder.EndpointConfiguration(sqsEndpoint, &quot;eu-central-1&quot;))
    .build();</code></pre></dd>
</dl>
<p>Please make sure to configure a big enough thread pool to avoid resource starvation. This is especially important if you share the client between multiple Sources, Sinks and Flows. For the SQS Sinks and Sources the sum of all <code>parallelism</code> (Source) and <code>maxInFlight</code> (Sink) must be less than or equal to the thread pool size.</p>
<h3><a href="#stream-messages-to-a-sqs-queue" name="stream-messages-to-a-sqs-queue" class="anchor"><span class="anchor-link"></span></a>Stream messages to a SQS queue</h3>
<p>Create a sink, that forwards <code>String</code> to the SQS queue.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">val future = Source.single(&quot;alpakka&quot;).runWith(SqsSink(queue))
Await.ready(future, 1.second)</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><code class="language-java">CompletionStage&lt;Done&gt; done = Source
  .single(&quot;alpakka&quot;)
  .runWith(SqsSink.create(queueUrl, sqsClient), materializer);

done.toCompletableFuture().get(1, TimeUnit.SECONDS);</code></pre></dd>
</dl>
<p>Create a sink, that forwards <code>SendMessageRequest</code> to the SQS queue.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">val future = Source.single(new SendMessageRequest().withMessageBody(&quot;alpakka&quot;)).runWith(SqsSink.messageSink(queue))
Await.ready(future, 1.second)</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><code class="language-java">CompletionStage&lt;Done&gt; done = Source
        .single(new SendMessageRequest().withMessageBody(&quot;alpakka&quot;))
        .runWith(SqsSink.messageSink(queueUrl, sqsClient), materializer);

done.toCompletableFuture().get(1, TimeUnit.SECONDS);</code></pre></dd>
</dl>
<h3><a href="#stream-messages-to-a-sqs-queue-with-underlying-batching" name="stream-messages-to-a-sqs-queue-with-underlying-batching" class="anchor"><span class="anchor-link"></span></a>Stream messages to a SQS queue with underlying batching</h3>
<p>Create a sink, that forwards <code>String</code> to the SQS queue. However, the main difference from the previous use case, it batches items and sends as a one request.</p>
<p>Note: There is also another option to send batch of messages to SQS which is using <code>AmazonSQSBufferedAsyncClient</code>. This client buffers <code>SendMessageRequest</code>s under the hood and sends them as a batch instead of sending them one by one. However, beware that <code>AmazonSQSBufferedAsyncClient</code> does not support FIFO Queues. See <a href="http://docs.aws.amazon.com/AWSSimpleQueueService/latest/SQSDeveloperGuide/sqs-client-side-buffering-request-batching.html">documentation for client-side buffering.</a></p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">val messages = for (i &lt;- 0 until 20) yield s&quot;Message - $i&quot;

val future = Source(messages).runWith(SqsSink.grouped(queue))
Await.ready(future, 1.second)</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><code class="language-java">ArrayList&lt;String&gt; messagesToSend = new ArrayList&lt;&gt;();
for (int i = 0; i &lt; 20; i++) {
    messagesToSend.add(&quot;message - &quot; + i);
}

CompletionStage&lt;Done&gt; done = Source
        .from(messagesToSend)
        .runWith(SqsSink.grouped(queueUrl,sqsClient), materializer);

done.toCompletableFuture().get(1, TimeUnit.SECONDS);</code></pre></dd>
</dl>
<h4><a href="#batch-configuration" name="batch-configuration" class="anchor"><span class="anchor-link"></span></a>Batch configuration</h4>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">final case class SqsBatchFlowSettings(maxBatchSize: Int, maxBatchWait: FiniteDuration, concurrentRequests: Int) {
  require(
    maxBatchSize &gt; 0 &amp;&amp; maxBatchSize &lt;= 10,
    s&quot;Invalid value for maxBatchSize: $maxBatchSize. It should be 0 &lt; maxBatchSize &lt; 10, due to the Amazon SQS requirements.&quot;
  )
}</code></pre></dd>
</dl>
<p>Options:</p>
<ul>
  <li><code>maxBatchSize</code> - the maximum number of messages in batch to send SQS. Default: 10.</li>
  <li><code>maxBatchWait</code> - the maximum duration for which the stage waits until <code>maxBatchSize</code> messages arrived. Sends what is collects at the end of the time period even though the <code>maxBatchSize</code> is not fulfilled. Default: 500 milliseconds</li>
  <li><code>concurrentRequests</code> - the number of batches sending to SQS concurrently.</li>
</ul>
<h3><a href="#stream-batches-of-messages-to-a-sqs-queue" name="stream-batches-of-messages-to-a-sqs-queue" class="anchor"><span class="anchor-link"></span></a>Stream batches of messages to a SQS queue</h3>
<p>Create a sink, that forwards <code>Seq[String]</code> to the SQS queue.</p>
<p>Be aware that the size of the batch must be less than or equal to 10 because Amazon SQS has a limit for batch request. If the batch has more than 10 entries, the request will fail.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">val messages = for (i &lt;- 0 until 10) yield s&quot;Message - $i&quot;

val future = Source.single(messages).runWith(SqsSink.batch(queue))
Await.ready(future, 1.second)</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><code class="language-java">ArrayList&lt;String&gt; messagesToSend = new ArrayList&lt;&gt;();
for (int i = 0; i &lt; 10; i++) {
    messagesToSend.add(&quot;Message - &quot; + i);
}
Iterable&lt;String&gt; it = messagesToSend;

CompletionStage&lt;Done&gt; done = Source
        .single(it)
        .runWith(SqsSink.batch(queueUrl,sqsClient), materializer);

done.toCompletableFuture().get(1, TimeUnit.SECONDS);</code></pre></dd>
</dl>
<p>Create a sink, that forwards <code>Seq[SendMessageRequest]</code> to the SQS queue.</p>
<p>Be aware that the size of the batch must be less than or equal to 10 because Amazon SQS has a limit for batch request. If the batch has more than 10 entries, the request will fail.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">val messages = for (i &lt;- 0 until 10) yield new SendMessageRequest().withMessageBody(s&quot;Message - $i&quot;)

val future = Source.single(messages).runWith(SqsSink.batchedMessageSink(queue))
Await.ready(future, 1.second)</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><code class="language-java">ArrayList&lt;SendMessageRequest&gt; messagesToSend = new ArrayList&lt;&gt;();
for (int i = 0; i &lt; 10; i++) {
    messagesToSend.add(new SendMessageRequest().withMessageBody(&quot;Message - &quot; + i));
}
Iterable&lt;SendMessageRequest&gt; it = messagesToSend;

CompletionStage&lt;Done&gt; done = Source
        .single(it)
        .runWith(SqsSink.batchedMessageSink(queueUrl,sqsClient), materializer);

done.toCompletableFuture().get(1, TimeUnit.SECONDS);</code></pre></dd>
</dl>
<h4><a href="#sink-configuration" name="sink-configuration" class="anchor"><span class="anchor-link"></span></a>Sink configuration</h4>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">final case class SqsSinkSettings(maxInFlight: Int) {
  require(maxInFlight &gt; 0)
}</code></pre></dd>
</dl>
<p>Options:</p>
<ul>
  <li><code>maxInFlight</code> - maximum number of messages being processed by <code>AmazonSQSAsync</code> at the same time. Default: 10</li>
</ul>
<h3><a href="#message-processing-with-acknowledgement" name="message-processing-with-acknowledgement" class="anchor"><span class="anchor-link"></span></a>Message processing with acknowledgement</h3>
<p><code>SqsAckSink</code> provides possibility to acknowledge (delete), ignore, or postpone a message.</p>
<p>Your flow must decide which action to take and push it with message:</p>
<ul>
  <li><code>Delete</code> - delete message from the queue</li>
  <li><code>Ignore</code> - ignore the message and let it reappear in the queue after visibility timeout</li>
  <li><code>ChangeMessageVisibility(visibilityTimeout: Int)</code> - can be used to postpone a message, or make  the message immediately visible to other consumers. See <a href="http://docs.aws.amazon.com/AWSSimpleQueueService/latest/SQSDeveloperGuide/sqs-visibility-timeout.html">official documentation</a> for more details.</li>
</ul>
<dl>
  <dt>Scala (ack)
  </dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">val future = SqsSource(queue)(awsSqsClient)
  .take(1)
  .map { m: Message =&gt;
    (m, MessageAction.Delete)
  }
  .runWith(SqsAckSink(queue)(awsSqsClient))</code></pre></dd>
  <dt>Scala (ignore)
  </dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">val result = SqsSource(queue)(awsSqsClient)
  .take(1)
  .map { m: Message =&gt;
    (m, MessageAction.Ignore)
  }
  .via(SqsAckFlow(queue)(awsSqsClient))
  .runWith(TestSink.probe[AckResult])
  .requestNext(1.second)</code></pre></dd>
  <dt>Scala (change visibility timeout)
  </dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">val future = SqsSource(queue)(awsSqsClient)
  .take(1)
  .map { m: Message =&gt;
    (m, MessageAction.ChangeMessageVisibility(5))
  }
  .runWith(SqsAckSink(queue)(awsSqsClient))</code></pre></dd>
  <dt>Java (ack)
  </dt>
  <dd>
  <pre class="prettyprint"><code class="language-java">Tuple2&lt;Message, MessageAction&gt; pair = new Tuple2&lt;&gt;(
        new Message().withBody(&quot;test&quot;),
        MessageAction.delete()
);
CompletionStage&lt;Done&gt; done = Source
        .single(pair)
        .runWith(SqsAckSink.create(queueUrl, awsClient), materializer);

done.toCompletableFuture().get(1, TimeUnit.SECONDS);</code></pre></dd>
  <dt>Java (ignore)
  </dt>
  <dd>
  <pre class="prettyprint"><code class="language-java">Tuple2&lt;Message, MessageAction&gt; pair = new Tuple2&lt;&gt;(
        new Message().withBody(&quot;test&quot;),
        MessageAction.ignore()
);
CompletionStage&lt;AckResult&gt; stage = Source
        .single(pair)
        .via(SqsAckFlow.create(queueUrl, awsClient))
        .runWith(Sink.head(), materializer);
AckResult result = stage.toCompletableFuture().get(1, TimeUnit.SECONDS);</code></pre></dd>
  <dt>Java (change visibility timeout)
  </dt>
  <dd>
  <pre class="prettyprint"><code class="language-java">Tuple2&lt;Message, MessageAction&gt; pair = new Tuple2&lt;&gt;(
        new Message().withBody(&quot;test&quot;),
        MessageAction.changeMessageVisibility(12)
);
CompletionStage&lt;Done&gt; done = Source
        .single(pair)
        .runWith(SqsAckSink.create(queueUrl, awsClient), materializer);
done.toCompletableFuture().get(1, TimeUnit.SECONDS);</code></pre></dd>
</dl>
<h4><a href="#sqsacksink-configuration" name="sqsacksink-configuration" class="anchor"><span class="anchor-link"></span></a>SqsAckSink configuration</h4>
<p>Same as the normal <code>SqsSink</code>:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">final case class SqsAckSinkSettings(maxInFlight: Int) {
  require(maxInFlight &gt; 0)
}</code></pre></dd>
</dl>
<p>Options:</p>
<ul>
  <li><code>maxInFlight</code> - maximum number of messages being processed by <code>AmazonSQSAsync</code> at the same time. Default: 10</li>
</ul>
<h3><a href="#using-sqs-as-a-flow" name="using-sqs-as-a-flow" class="anchor"><span class="anchor-link"></span></a>Using SQS as a Flow</h3>
<p>You can also build flow stages which put or acknowledge messages in SQS, backpressure on queue response and then forward responses further down the stream. The API is similar to creating Sinks.</p>
<dl>
  <dt>Scala (flow)
  </dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">val future = Source.single(new SendMessageRequest(queue, &quot;alpakka&quot;)).via(SqsFlow(queue)).runWith(Sink.ignore)</code></pre></dd>
  <dt>Java (flow)
  </dt>
  <dd>
  <pre class="prettyprint"><code class="language-java">CompletionStage&lt;Done&gt; done = Source
        .single(new SendMessageRequest(queueUrl, &quot;alpakka-flow&quot;))
        .via(SqsFlow.create(queueUrl, sqsClient))
        .runWith(Sink.ignore(), materializer);

done.toCompletableFuture().get(1, TimeUnit.SECONDS);
CompletionStage&lt;Done&gt; done = Source
        .single(new SendMessageRequest(queueUrl, &quot;alpakka-flow&quot;))
        .via(SqsFlow.create(queueUrl, sqsClient))
        .runWith(Sink.ignore(), materializer);

done.toCompletableFuture().get(1, TimeUnit.SECONDS);</code></pre></dd>
  <dt>Scala (flow with ack)
  </dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">val future = SqsSource(queue)(awsSqsClient)
  .take(1)
  .map { m: Message =&gt;
    (m, MessageAction.Delete)
  }
  .via(SqsAckFlow(queue)(awsSqsClient))
  .runWith(Sink.ignore)</code></pre></dd>
  <dt>Java (flow with ack)
  </dt>
  <dd>
  <pre class="prettyprint"><code class="language-java">Tuple2&lt;Message, MessageAction&gt; pair = new Tuple2&lt;&gt;(
        new Message().withBody(&quot;test-ack-flow&quot;),
        MessageAction.delete()
);
CompletionStage&lt;Done&gt; done = Source
        .single(pair)
        .via(SqsAckFlow.create(queueUrl, awsClient))
        .runWith(Sink.ignore(), materializer);

done.toCompletableFuture().get(1, TimeUnit.SECONDS);</code></pre></dd>
</dl>
<h3><a href="#running-the-example-code" name="running-the-example-code" class="anchor"><span class="anchor-link"></span></a>Running the example code</h3>
<p>The code in this guide is part of runnable tests of this project. You are welcome to edit the code and run it in sbt.</p>
<blockquote>
  <p>The test code uses embedded <a href="https://github.com/adamw/elasticmq">ElasticMQ</a> as queuing service which serves an AWS SQS compatible API.</p>
</blockquote>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre><code>sbt &#39;project sqs&#39; test
</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre><code>sbt &#39;project sqs&#39; test
</code></pre></dd>
</dl>
<div class="source-github">
The source code for this page can be found <a href="https://github.com/akka/alpakka/tree/master/docs/src/main/paradox/sqs.md">here</a>.
</div>

<div class="nav-next">
<p><strong>Next:</strong> <a href="azure-storage-queue.html">Azure Storage Queue Connector</a></p>
</div>
</div>
<div class="large-3 show-for-large column" data-sticky-container>
<nav class="sidebar sticky" data-sticky data-anchor="docs" data-sticky-on="large">
<div class="page-nav">
<div class="nav-title">On this page:</div>
<div class="nav-toc">
<ul>
  <li><a href="sqs.html#aws-sqs-connector" class="header">AWS SQS Connector</a>
  <ul>
    <li><a href="sqs.html#reported-issues" class="header">Reported issues</a></li>
    <li><a href="sqs.html#artifacts" class="header">Artifacts</a></li>
    <li><a href="sqs.html#usage" class="header">Usage</a></li>
  </ul></li>
</ul>
</div>
</div>
</nav>
</div>
</div>

</section>
</div>

</div>

<footer class="site-footer">

<section class="site-footer-nav">
<div class="expanded row">
<div class="small-12 large-offset-2 large-10 column">
<div class="row site-footer-content">

<div class="small-12 medium-4 large-3 text-center column">
<div class="nav-links">
<ul>
<!-- <li><a href="https://www.example.com/products/">Products</a> -->
</ul>
</div>
</div>

</div>
</div>
</div>
</section>

<section class="site-footer-base">
<div class="expanded row">
<div class="small-12 large-offset-2 large-10 column">
<div class="row site-footer-content">

<div class="small-12 text-center large-9 column">

<!--
<div class="copyright">
<span class="text">&copy; 2019</span>
<a href="https://www.example.com" class="logo">logo</a>
</div>
-->
</div>

</div>
</div>
</div>
</section>
</footer>

</div>
</div>
</div>
</body>

<script type="text/javascript" src="lib/foundation/dist/foundation.min.js"></script>
<script type="text/javascript">jQuery(document).foundation();</script>
<script type="text/javascript" src="js/magellan.js"></script>

<style type="text/css">@import "lib/prettify/prettify.css";</style>
<script type="text/javascript" src="lib/prettify/prettify.js"></script>
<script type="text/javascript" src="lib/prettify/lang-scala.js"></script>
<script type="text/javascript">jQuery(function(){window.prettyPrint && prettyPrint()});</script>

</html>
