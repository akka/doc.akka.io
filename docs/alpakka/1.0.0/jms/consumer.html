<!DOCTYPE html>
<html class="no-js" lang="en">

<head>
<title>Consumer &bull; Alpakka Documentation</title>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<meta name="description" content="Alpakka is a Reactive Enterprise Integration library for Java and Scala, based on Reactive Streams and Akka."/>
<link rel="canonical" href="https://doc.akka.io/docs/alpakka/current/jms/consumer.html"/>
<script type="text/javascript" src="../lib/jquery/jquery.min.js"></script>
<script type="text/javascript" src="../lib/foundation/dist/js/foundation.min.js"></script>
<link rel="stylesheet" type="text/css" href="../lib/normalize.css/normalize.css"/>
<link rel="stylesheet" type="text/css" href="../lib/foundation/dist/css/foundation.min.css"/>
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.css" />
<link rel="stylesheet" type="text/css" href="../css/icons.css"/>
<link rel="stylesheet" type="text/css" href="../css/page.css"/>
<link rel="shortcut icon" href="../images/favicon.ico" />
<link rel="apple-touch-icon" sizes="180x180" href="../images/apple-touch-icon.png"/>
<link rel="icon" type="image/png" sizes="32x32" href="../images/favicon-32x32.png"/>
<link rel="icon" type="image/png" sizes="16x16" href="../images/favicon-16x16.png"/>
<link rel="manifest" href="../images/manifest.json"/>
<meta name="msapplication-TileImage" content="../images/mstile-150x150.png"/>
<meta name="msapplication-TileColor" content="#15a9ce"/>
<meta name="theme-color" content="#15a9ce"/>
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>
<!-- OneTrust Cookies Consent Notice (Production Standard, akka.io, en-GB) start -->
<script src="https://optanon.blob.core.windows.net/consent/159bb13d-6748-4399-806e-ac28db879785.js" type="text/javascript" charset="UTF-8"></script>
<script type="text/javascript">
function OptanonWrapper() { }
</script>
<!-- OneTrust Cookies Consent Notice (Production Standard, akka.io, en-GB) end -->
<!--Google Analytics-->
<script type="text/plain" class="optanon-category-2">
var _gaq = _gaq || [];
_gaq.push(['_setAccount', '']);
_gaq.push(['_setDomainName', '']);
_gaq.push(['_trackPageview']);
(function() {
var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})()
</script>
<script type="text/plain" class="optanon-category-2">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-23127719-1', 'lightbend.com', {'allowLinker': true, 'name': 'tsTracker'});
ga('tsTracker.require', 'linker');
ga('tsTracker.linker:autoLink', ['lightbend.com','playframework.com','scala-lang.org','scaladays.org','spray.io','akka.io','scala-sbt.org','scala-ide.org']);
ga('tsTracker.send', 'pageview');
</script>
<!--Marketo-->
<script type="text/plain" class="optanon-category-3">
(function() {
var didInit = false;
function initMunchkin() {
if(didInit === false) {
didInit = true;
Munchkin.init('558-NCX-702', { 'asyncOnly': true, 'disableClickDelay': true });
}
}
var s = document.createElement('script');
s.type = 'text/javascript';
s.async = true;
s.src = '//munchkin.marketo.net/munchkin.js';
s.onreadystatechange = function() {
if (this.readyState == 'complete' || this.readyState == 'loaded') {
initMunchkin();
}
};
s.onload = initMunchkin;
document.getElementsByTagName('head')[0].appendChild(s);
})();
</script>
</head>

<body id="underlay" data-toggler="nav-open">

<header class="site-header hide-for-large">
<div class="sticky-header clearfix">
<a href="http://akka.io"><img class="logo" src="../images/akka-alpakka-reverse.svg"/></a>

<button class="menu-icon float-right" type="button" data-toggle="underlay overlay"></button>
</div>
<div id="overlay" class="overlay-nav" data-toggler="nav-open">
<header class="nav-header">
<div class="nav-header-title">
<h1><a href="../index.html">Alpakka Documentation</a></h1>
</div>
<div class="nav-header-version">
Version 1.0.0
</div>
<div class="nav-header-groups">
<select class="supergroup" name="Language"><option class="group" value="group-java">Java</option><option class="group" value="group-scala">Scala</option></select>
</div>
</header>
<nav class="nav-toc">
<ul>
  <li><a href="../overview.html" class="page">Overview</a></li>
  <li><a href="../data-transformations/index.html" class="page">Data Transformations</a></li>
  <li><a href="../amqp.html" class="page">AMQP</a></li>
  <li><a href="../external/apache-camel.html" class="page">Apache Camel</a></li>
  <li><a href="../cassandra.html" class="page">Apache Cassandra</a></li>
  <li><a href="../geode.html" class="page">Apache Geode</a></li>
  <li><a href="../kafka.html" class="page">Apache Kafka</a></li>
  <li><a href="../kudu.html" class="page">Apache Kudu</a></li>
  <li><a href="../solr.html" class="page">Apache Solr</a></li>
  <li><a href="../avroparquet.html" class="page">Avro Parquet</a></li>
  <li><a href="../dynamodb.html" class="page">AWS DynamoDB</a></li>
  <li><a href="../kinesis.html" class="page">AWS Kinesis</a></li>
  <li><a href="../awslambda.html" class="page">AWS Lambda</a></li>
  <li><a href="../s3.html" class="page">AWS S3</a></li>
  <li><a href="../sns.html" class="page">AWS SNS</a></li>
  <li><a href="../sqs.html" class="page">AWS SQS</a></li>
  <li><a href="../external/azure-event-hubs.html" class="page">Azure Event Hubs</a></li>
  <li><a href="../external/azure-iot-hub.html" class="page">Azure IoT Hub</a></li>
  <li><a href="../azure-storage-queue.html" class="page">Azure Storage Queue</a></li>
  <li><a href="../couchbase.html" class="page">Couchbase</a></li>
  <li><a href="../elasticsearch.html" class="page">Elasticsearch</a></li>
  <li><a href="../external/eventuate.html" class="page">Eventuate</a></li>
  <li><a href="../file.html" class="page">File</a></li>
  <li><a href="../external/fs2.html" class="page">FS2</a></li>
  <li><a href="../ftp.html" class="page">FTP</a></li>
  <li><a href="../google-cloud-pub-sub.html" class="page">Google Cloud Pub/Sub</a></li>
  <li><a href="../google-cloud-pub-sub-grpc.html" class="page">Google Cloud Pub/Sub gRPC</a></li>
  <li><a href="../google-fcm.html" class="page">Google FCM</a></li>
  <li><a href="../external/grpc.html" class="page">gRPC</a></li>
  <li><a href="../hdfs.html" class="page">Hadoop Distributed File System - HDFS</a></li>
  <li><a href="../hbase.html" class="page">HBase</a></li>
  <li><a href="../external/http.html" class="page">HTTP</a></li>
  <li><a href="../bluemix-cos.html" class="page">IBM Bluemix Cloud Object Storage</a></li>
  <li><a href="../external/db2-event-store.html" class="page">IBM Db2 Event Store</a></li>
  <li><a href="../ironmq.html" class="page">IronMQ</a></li>
  <li><a href="../jms/index.html" class="page">JMS</a>
  <ul>
    <li><a href="../jms/index.html#reported-issues" class="header">Reported issues</a></li>
    <li><a href="../jms/index.html#artifacts" class="header">Artifacts</a></li>
    <li><a href="../jms/producer.html" class="page">Producer</a></li>
    <li><a href="../jms/consumer.html#consumer" class="active page">Consumer</a>
    <ul>
      <li><a href="../jms/consumer.html#receiving-messages" class="header">Receiving messages</a></li>
      <li><a href="../jms/consumer.html#configure-jms-consumers" class="header">Configure JMS consumers</a></li>
      <li><a href="../jms/consumer.html#using-jms-client-acknowledgement" class="header">Using JMS client acknowledgement</a></li>
      <li><a href="../jms/consumer.html#using-jms-transactions" class="header">Using JMS transactions</a></li>
      <li><a href="../jms/consumer.html#using-jms-selectors" class="header">Using JMS selectors</a></li>
      <li><a href="../jms/consumer.html#raw-jvm-type-sources" class="header">Raw JVM type sources</a></li>
    </ul></li>
    <li><a href="../jms/browse.html" class="page">Browse</a></li>
    <li><a href="../jms/ibm-mq.html" class="page">Using IBM MQ</a></li>
  </ul></li>
  <li><a href="../mongodb.html" class="page">MongoDB</a></li>
  <li><a href="../mqtt.html" class="page">MQTT</a></li>
  <li><a href="../mqtt-streaming.html" class="page">MQTT Streaming</a></li>
  <li><a href="../orientdb.html" class="page">OrientDB</a></li>
  <li><a href="../external/pulsar.html" class="page">Pulsar</a></li>
  <li><a href="../sse.html" class="page">Server-sent Events (SSE)</a></li>
  <li><a href="../slick.html" class="page">Slick (JDBC)</a></li>
  <li><a href="../spring-web.html" class="page">Spring Web</a></li>
  <li><a href="../external/tcp.html" class="page">TCP</a></li>
  <li><a href="../udp.html" class="page">UDP</a></li>
  <li><a href="../unix-domain-socket.html" class="page">Unix Domain Socket</a></li>
</ul>
</nav>
</div>
</header>

<aside class="show-for-large">
<header class="nav-header fixed-sidebar-header">
<div class="nav-header-title">
<h1><a href="../index.html">Alpakka Documentation</a></h1>
</div>
<div class="nav-header-version">
Version 1.0.0
</div>
<div class="nav-header-groups">
<select class="supergroup" name="Language"><option class="group" value="group-java">Java</option><option class="group" value="group-scala">Scala</option></select>
</div>
</header>
<nav class="site-nav fixed-sidebar-contents">
<div class="nav-toc">
<ul>
  <li><a href="../overview.html" class="page">Overview</a></li>
  <li><a href="../data-transformations/index.html" class="page">Data Transformations</a></li>
  <li><a href="../amqp.html" class="page">AMQP</a></li>
  <li><a href="../external/apache-camel.html" class="page">Apache Camel</a></li>
  <li><a href="../cassandra.html" class="page">Apache Cassandra</a></li>
  <li><a href="../geode.html" class="page">Apache Geode</a></li>
  <li><a href="../kafka.html" class="page">Apache Kafka</a></li>
  <li><a href="../kudu.html" class="page">Apache Kudu</a></li>
  <li><a href="../solr.html" class="page">Apache Solr</a></li>
  <li><a href="../avroparquet.html" class="page">Avro Parquet</a></li>
  <li><a href="../dynamodb.html" class="page">AWS DynamoDB</a></li>
  <li><a href="../kinesis.html" class="page">AWS Kinesis</a></li>
  <li><a href="../awslambda.html" class="page">AWS Lambda</a></li>
  <li><a href="../s3.html" class="page">AWS S3</a></li>
  <li><a href="../sns.html" class="page">AWS SNS</a></li>
  <li><a href="../sqs.html" class="page">AWS SQS</a></li>
  <li><a href="../external/azure-event-hubs.html" class="page">Azure Event Hubs</a></li>
  <li><a href="../external/azure-iot-hub.html" class="page">Azure IoT Hub</a></li>
  <li><a href="../azure-storage-queue.html" class="page">Azure Storage Queue</a></li>
  <li><a href="../couchbase.html" class="page">Couchbase</a></li>
  <li><a href="../elasticsearch.html" class="page">Elasticsearch</a></li>
  <li><a href="../external/eventuate.html" class="page">Eventuate</a></li>
  <li><a href="../file.html" class="page">File</a></li>
  <li><a href="../external/fs2.html" class="page">FS2</a></li>
  <li><a href="../ftp.html" class="page">FTP</a></li>
  <li><a href="../google-cloud-pub-sub.html" class="page">Google Cloud Pub/Sub</a></li>
  <li><a href="../google-cloud-pub-sub-grpc.html" class="page">Google Cloud Pub/Sub gRPC</a></li>
  <li><a href="../google-fcm.html" class="page">Google FCM</a></li>
  <li><a href="../external/grpc.html" class="page">gRPC</a></li>
  <li><a href="../hdfs.html" class="page">Hadoop Distributed File System - HDFS</a></li>
  <li><a href="../hbase.html" class="page">HBase</a></li>
  <li><a href="../external/http.html" class="page">HTTP</a></li>
  <li><a href="../bluemix-cos.html" class="page">IBM Bluemix Cloud Object Storage</a></li>
  <li><a href="../external/db2-event-store.html" class="page">IBM Db2 Event Store</a></li>
  <li><a href="../ironmq.html" class="page">IronMQ</a></li>
  <li><a href="../jms/index.html" class="page">JMS</a>
  <ul>
    <li><a href="../jms/index.html#reported-issues" class="header">Reported issues</a></li>
    <li><a href="../jms/index.html#artifacts" class="header">Artifacts</a></li>
    <li><a href="../jms/producer.html" class="page">Producer</a></li>
    <li><a href="../jms/consumer.html#consumer" class="active page">Consumer</a>
    <ul>
      <li><a href="../jms/consumer.html#receiving-messages" class="header">Receiving messages</a></li>
      <li><a href="../jms/consumer.html#configure-jms-consumers" class="header">Configure JMS consumers</a></li>
      <li><a href="../jms/consumer.html#using-jms-client-acknowledgement" class="header">Using JMS client acknowledgement</a></li>
      <li><a href="../jms/consumer.html#using-jms-transactions" class="header">Using JMS transactions</a></li>
      <li><a href="../jms/consumer.html#using-jms-selectors" class="header">Using JMS selectors</a></li>
      <li><a href="../jms/consumer.html#raw-jvm-type-sources" class="header">Raw JVM type sources</a></li>
    </ul></li>
    <li><a href="../jms/browse.html" class="page">Browse</a></li>
    <li><a href="../jms/ibm-mq.html" class="page">Using IBM MQ</a></li>
  </ul></li>
  <li><a href="../mongodb.html" class="page">MongoDB</a></li>
  <li><a href="../mqtt.html" class="page">MQTT</a></li>
  <li><a href="../mqtt-streaming.html" class="page">MQTT Streaming</a></li>
  <li><a href="../orientdb.html" class="page">OrientDB</a></li>
  <li><a href="../external/pulsar.html" class="page">Pulsar</a></li>
  <li><a href="../sse.html" class="page">Server-sent Events (SSE)</a></li>
  <li><a href="../slick.html" class="page">Slick (JDBC)</a></li>
  <li><a href="../spring-web.html" class="page">Spring Web</a></li>
  <li><a href="../external/tcp.html" class="page">TCP</a></li>
  <li><a href="../udp.html" class="page">UDP</a></li>
  <li><a href="../unix-domain-socket.html" class="page">Unix Domain Socket</a></li>
</ul>
</div>
</nav>
<footer class="nav-footer fixed-sidebar-footer">
<a href="http://akka.io"><img class="logo" src="../images/akka-alpakka-reverse.svg"/></a>

</footer>
</aside>

<main class="fixed-shift-for-large expanded row">
<section class="site-content small-12 column">

<article class="page-content row">
<div class="small-12 large-9 column" id="docs">
<h1><a href="#consumer" name="consumer" class="anchor"><span class="anchor-link"></span></a>Consumer</h1>
<p>The Alpakka JMS connector offers consuming JMS messages from topics or queues:</p>
<ul>
  <li>Read <code>javax.jms.Message</code>s from an Akka Streams source</li>
  <li>Allow for client acknowledgement to the JMS broker</li>
  <li>Allow for JMS transactions</li>
  <li>Read raw JVM types from an Akka Streams Source</li>
</ul>
<p>The JMS message model supports several types of message bodies in (see <a href="https://docs.oracle.com/javaee/7/api/?javax/jms/Message.html">javax.jms.Message</a>), which may be created directly from the Akka Stream elements, or in wrappers to access more advanced features.</p>
<h2><a href="#receiving-messages" name="receiving-messages" class="anchor"><span class="anchor-link"></span></a>Receiving messages</h2>
<p><span class="group-java"><a href="https://doc.akka.io/api/alpakka/1.0.0/akka/stream/alpakka/jms/javadsl/JmsConsumer$.html">JmsConsumer</a></span><span class="group-scala"><a href="https://doc.akka.io/api/alpakka/1.0.0/akka/stream/alpakka/jms/scaladsl/JmsConsumer$.html">JmsConsumer</a></span> offers factory methods to consume JMS messages in a number of ways.</p>
<p>This examples shows how to listen to a JMS queue and emit <a href="https://docs.oracle.com/javaee/7/api/?javax/jms/Message.html"><code>javax.jms.Message</code></a> elements into the stream.</p>
<p>The materialized value <code>JmsConsumerControl</code> is used to shut down the consumer (it is a <a href="https://doc.akka.io/api/akka/2.5.21/akka/stream/KillSwitch.html">Killswitch</a>) and offers the possibility to inspect the connectivity state of the consumer. </p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/alpakka/tree/v1.0.0/jms/src/test/scala/docs/scaladsl/JmsConnectorsSpec.scala#L209-L227" target="_blank" title="Go to snippet source"></a><code class="language-scala">val jmsSource: Source[javax.jms.Message, JmsConsumerControl] = JmsConsumer(
  JmsConsumerSettings(system, connectionFactory).withQueue(&quot;numbers&quot;)
)

val (control, result): (JmsConsumerControl, Future[immutable.Seq[String]]) =
  jmsSource
    .take(msgsIn.size)
    .map {
      case t: javax.jms.TextMessage =&gt; t.getText
      case other =&gt; sys.error(s&quot;unexpected message type ${other.getClass}&quot;)
    }
    .toMat(Sink.seq)(Keep.both)
    .run()

control.shutdown()</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/alpakka/tree/v1.0.0/jms/src/test/java/docs/javadsl/JmsConnectorsTest.java#L279-L322" target="_blank" title="Go to snippet source"></a><code class="language-java">ConnectionFactory connectionFactory = server.createConnectionFactory();

Source&lt;javax.jms.Message, JmsConsumerControl&gt; jmsSource =
    JmsConsumer.create(
        JmsConsumerSettings.create(system, connectionFactory).withQueue(&quot;test&quot;));

Pair&lt;JmsConsumerControl, CompletionStage&lt;List&lt;String&gt;&gt;&gt; controlAndResult =
    jmsSource
        .take(expectedMessages)
        .map(
            msg -&gt; {
              if (msg instanceof TextMessage) {
                TextMessage t = (TextMessage) msg;
                return t.getText();
              } else
                throw new RuntimeException(&quot;unexpected message type &quot; + msg.getClass());
            })
        .toMat(Sink.seq(), Keep.both())
        .run(materializer);

JmsConsumerControl control = controlAndResult.first();
control.shutdown();</code></pre></dd>
</dl>
<h2><a href="#configure-jms-consumers" name="configure-jms-consumers" class="anchor"><span class="anchor-link"></span></a>Configure JMS consumers</h2>
<p>To connect to the JMS broker, first define an appropriate <a href="https://docs.oracle.com/javaee/7/api/?javax/jms/ConnectionFactory.html">javax.jms.ConnectionFactory</a>. The Alpakka tests and all examples use Active MQ.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/alpakka/tree/v1.0.0/jms/src/test/scala/docs/scaladsl/JmsConnectorsSpec.scala#L43" target="_blank" title="Go to snippet source"></a><code class="language-scala">val connectionFactory: javax.jms.ConnectionFactory = new org.apache.activemq.ActiveMQConnectionFactory(url)</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/alpakka/tree/v1.0.0/jms/src/test/java/docs/javadsl/JmsConnectorsTest.java#L124" target="_blank" title="Go to snippet source"></a><code class="language-java">javax.jms.ConnectionFactory connectionFactory = server.createConnectionFactory();</code></pre></dd>
</dl>
<p>The created <a href="https://docs.oracle.com/javaee/7/api/?javax/jms/ConnectionFactory.html">ConnectionFactory</a> is then used for the creation of the different JMS sources.</p>
<p>The <code>JmsConsumerSettings</code> factories allow for passing the actor system to read from the default <code>alpakka.jms.consumer</code> section, or you may pass a <code>Config</code> instance which is resolved to a section of the same structure. </p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/alpakka/tree/v1.0.0/jms/src/test/scala/docs/scaladsl/JmsSettingsSpec.scala#L74-L82" target="_blank" title="Go to snippet source"></a><code class="language-scala">val consumerConfig: Config = system.settings.config.getConfig(JmsConsumerSettings.configPath)
// reiterating defaults from reference.conf
val settings = JmsConsumerSettings(consumerConfig, connectionFactory)
  .withQueue(&quot;target-queue&quot;)
  .withCredentials(Credentials(&quot;username&quot;, &quot;password&quot;))
  .withConnectionRetrySettings(retrySettings)
  .withSessionCount(1)
  .withBufferSize(100)
  .withAckTimeout(1.second)</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/alpakka/tree/v1.0.0/jms/src/test/java/docs/javadsl/JmsSettingsTest.java#L78-L86" target="_blank" title="Go to snippet source"></a><code class="language-java">Config consumerConfig = config.getConfig(JmsConsumerSettings.configPath());
JmsConsumerSettings settings =
    JmsConsumerSettings.create(consumerConfig, new ActiveMQConnectionFactory(&quot;broker-url&quot;))
        .withTopic(&quot;message-topic&quot;)
        .withCredential(Credentials.create(&quot;username&quot;, &quot;password&quot;))
        .withConnectionRetrySettings(retrySettings)
        .withSessionCount(10)
        .withAcknowledgeMode(AcknowledgeMode.AutoAcknowledge())
        .withSelector(&quot;Important = TRUE&quot;);</code></pre></dd>
</dl>
<p>The Alpakka JMS consumer is configured via default settings in the <a href="https://github.com/lightbend/config#using-hocon-the-json-superset">HOCON</a> config file section <code>alpakka.jms.consumer</code> in your <code>application.conf</code>, and settings may be tweaked in the code using the <code>withXyz</code> methods. On the second tab the section from <code>reference.conf</code> shows the structure to use for configuring multiple set-ups.</p>
<dl>
  <dt>Table</dt>
  <dd>
  <table>
    <thead>
      <tr>
        <th>Setting </th>
        <th>Description </th>
        <th>Default Value </th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>connectionFactory </td>
        <td>Factory to use for creating JMS connections </td>
        <td>Must be set in code </td>
      </tr>
      <tr>
        <td>destination </td>
        <td>Destination (queue or topic) to send JMS messages to </td>
        <td>Must be set in code </td>
      </tr>
      <tr>
        <td>credentials </td>
        <td>JMS broker credentials </td>
        <td>Empty </td>
      </tr>
      <tr>
        <td>connectionRetrySettings </td>
        <td>Retry characteristics if the connection failed to be established or is taking a long time. </td>
        <td>See <a href="producer.html#connection-retries">Connection Retries</a></td>
      </tr>
      <tr>
        <td>sessionCount </td>
        <td>Number of parallel sessions to use for receiving JMS messages. </td>
        <td>defaults to <code>1</code> </td>
      </tr>
      <tr>
        <td>bufferSize </td>
        <td>Maximum number of messages to prefetch before applying backpressure. </td>
        <td>100 </td>
      </tr>
      <tr>
        <td>ackTimeout </td>
        <td>For use with JMS transactions, only: maximum time given to a message to be committed or rolled back. </td>
        <td>1 second </td>
      </tr>
      <tr>
        <td>selector </td>
        <td>JMS selector expression (see <a href="#using-jms-selectors">below</a>) </td>
        <td>Empty </td>
      </tr>
    </tbody>
  </table></dd>
  <dt>reference.conf
  </dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/alpakka/tree/v1.0.0/jms/src/main/resources/reference.conf#L24-L53" target="_blank" title="Go to snippet source"></a><code class="language-conf"># Jms Consumer Settings
# sets default values
consumer {
  # Configure connection retrying by providing settings for ConnectionRetrySettings.
  connection-retry = ${alpakka.jms.connection-retry}
  # Credentials to connect to the JMS broker.
  # credentials {
  #   username = &quot;some text&quot;
  #   password = &quot;some text&quot;
  # }
  # &quot;off&quot; to not use any credentials.
  credentials = off
  # Number of parallel sessions to use for receiving JMS messages.
  session-count = 1
  # Buffer size for maximum number for messages read from JMS when there is no demand
  # (or acks are pending for acknowledged consumers).
  buffer-size = 100
  # JMS selector expression.
  # See https://docs.oracle.com/cd/E19798-01/821-1841/bncer/index.html
  # empty string for unset
  selector = &quot;&quot; # optional
  # Set an explicit acknowledge mode.
  # (Consumers have specific defaults.)
  # See eg. javax.jms.Session.AUTO_ACKNOWLEDGE
  # Allowed values: &quot;off&quot;, &quot;auto&quot;, &quot;client&quot;, &quot;duplicates-ok&quot;, &quot;session&quot;, integer value
  acknowledge-mode = off
  # Timeout for acknowledge.
  # (Used by TX consumers.)
  ack-timeout = 1 second
}</code></pre></dd>
</dl>
<h3><a href="#broker-specific-destinations" name="broker-specific-destinations" class="anchor"><span class="anchor-link"></span></a>Broker specific destinations</h3>
<p>To reach out to special features of the JMS broker, destinations can be created as <code>CustomDestination</code> which takes a factory method for creating destinations.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/alpakka/tree/v1.0.0/jms/src/test/scala/docs/scaladsl/JmsConnectorsSpec.scala#L297-L319" target="_blank" title="Go to snippet source"></a><code class="language-scala">def createQueue(destinationName: String): Session =&gt; javax.jms.Queue = { (session: Session) =&gt;
  val amqSession = session.asInstanceOf[ActiveMQSession]
  amqSession.createQueue(s&quot;my-$destinationName&quot;)
}

val jmsSource: Source[javax.jms.Message, JmsConsumerControl] = JmsConsumer(
  JmsConsumerSettings(consumerConfig, connectionFactory)
    .withDestination(CustomDestination(&quot;custom&quot;, createQueue(&quot;custom&quot;)))
)</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/alpakka/tree/v1.0.0/jms/src/test/java/docs/javadsl/JmsConnectorsTest.java#L387-L417" target="_blank" title="Go to snippet source"></a><code class="language-java">Function&lt;javax.jms.Session, javax.jms.Destination&gt; createQueue(String destinationName) {
  return (session) -&gt; {
    ActiveMQSession amqSession = (ActiveMQSession) session;
    try {
      return amqSession.createQueue(&quot;my-&quot; + destinationName);
    } catch (JMSException e) {
      throw new RuntimeException(e);
    }
  };
}

        Source&lt;Message, JmsConsumerControl&gt; jmsSource =
            JmsConsumer.create(
                JmsConsumerSettings.create(system, connectionFactory)
                    .withDestination(new CustomDestination(&quot;custom&quot;, createQueue(&quot;custom&quot;))));</code></pre></dd>
</dl>
<h2><a href="#using-jms-client-acknowledgement" name="using-jms-client-acknowledgement" class="anchor"><span class="anchor-link"></span></a>Using JMS client acknowledgement</h2>
<p>Client acknowledgement ensures a message is successfully received by the consumer and notifies the JMS broker for every message. Due to the threading details in JMS brokers, this special source is required (see the explanation below).</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/alpakka/tree/v1.0.0/jms/src/test/scala/docs/scaladsl/JmsBufferedAckConnectorsSpec.scala#L66-L79" target="_blank" title="Go to snippet source"></a><code class="language-scala">val jmsSource: Source[AckEnvelope, JmsConsumerControl] = JmsConsumer.ackSource(
  JmsConsumerSettings(consumerConfig, connectionFactory)
    .withSessionCount(5)
    .withQueue(&quot;numbers&quot;)
)

val result: Future[immutable.Seq[javax.jms.Message]] =
  jmsSource
    .take(msgsIn.size)
    .map { ackEnvelope =&gt;
      ackEnvelope.acknowledge()
      ackEnvelope.message
    }
    .runWith(Sink.seq)</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/alpakka/tree/v1.0.0/jms/src/test/java/docs/javadsl/JmsBufferedAckConnectorsTest.java#L114-L140" target="_blank" title="Go to snippet source"></a><code class="language-java">ConnectionFactory connectionFactory = server.createConnectionFactory();

Source&lt;akka.stream.alpakka.jms.AckEnvelope, JmsConsumerControl&gt; jmsSource =
    JmsConsumer.ackSource(
        JmsConsumerSettings.create(system, connectionFactory)
            .withSessionCount(5)
            .withQueue(&quot;test&quot;));

CompletionStage&lt;List&lt;javax.jms.Message&gt;&gt; result =
    jmsSource
        .take(msgsIn.size())
        .map(
            envelope -&gt; {
              envelope.acknowledge();
              return envelope.message();
            })
        .runWith(Sink.seq(), materializer);</code></pre></dd>
</dl>
<p>The <code>sessionCount</code> parameter controls the number of JMS sessions to run in parallel.</p>
<p><strong>Notes:</strong></p>
<ul>
  <li>Using multiple sessions increases throughput, especially if acknowledging message by message is desired.</li>
  <li>Messages may arrive out of order if <code>sessionCount</code> is larger than 1.</li>
  <li>Message-by-message acknowledgement can be achieved by setting <code>bufferSize</code> to 0, thus disabling buffering. The outstanding messages before backpressure will be the <code>sessionCount</code>.</li>
  <li>The default <code>AcknowledgeMode</code> is <code>ClientAcknowledge</code> but can be overridden to custom <code>AcknowledgeMode</code>s, even implementation-specific ones by setting the <code>AcknowledgeMode</code> in the <code>JmsConsumerSettings</code> when creating the stream.</li>
</ul><div class="callout warning "><div class="callout-title">Warning</div>
<p>Using a regular <code>JmsConsumer</code> with <code>AcknowledgeMode.ClientAcknowledge</code> and using <code>message.acknowledge()</code> from the stream is not compliant with the JMS specification and can cause issues for some message brokers. <code>message.acknowledge()</code> in many cases acknowledges the session and not the message itself, contrary to what the API makes you believe.</p>
<p>Use this <code>JmsConsumer.ackSource</code> as shown above instead.</p></div>
<h2><a href="#using-jms-transactions" name="using-jms-transactions" class="anchor"><span class="anchor-link"></span></a>Using JMS transactions</h2>
<p>JMS transactions may be used with this connector. Be aware that transactions are a heavy-weight tool and may not perform very good.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/alpakka/tree/v1.0.0/jms/src/test/scala/docs/scaladsl/JmsTxConnectorsSpec.scala#L65-L79" target="_blank" title="Go to snippet source"></a><code class="language-scala">val jmsSource: Source[TxEnvelope, JmsConsumerControl] = JmsConsumer.txSource(
  JmsConsumerSettings(consumerConfig, connectionFactory)
    .withSessionCount(5)
    .withAckTimeout(1.second)
    .withQueue(&quot;numbers&quot;)
)

val result: Future[immutable.Seq[javax.jms.Message]] =
  jmsSource
    .take(msgsIn.size)
    .map { txEnvelope =&gt;
      txEnvelope.commit()
      txEnvelope.message
    }
    .runWith(Sink.seq)</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/alpakka/tree/v1.0.0/jms/src/test/java/docs/javadsl/JmsTxConnectorsTest.java#L115-L141" target="_blank" title="Go to snippet source"></a><code class="language-java">ConnectionFactory connectionFactory = server.createConnectionFactory();

Source&lt;akka.stream.alpakka.jms.TxEnvelope, JmsConsumerControl&gt; jmsSource =
    JmsConsumer.txSource(
        JmsConsumerSettings.create(system, connectionFactory)
            .withSessionCount(5)
            .withAckTimeout(Duration.ofSeconds(1))
            .withQueue(&quot;test&quot;));

CompletionStage&lt;List&lt;javax.jms.Message&gt;&gt; result =
    jmsSource
        .take(msgsIn.size())
        .map(
            txEnvelope -&gt; {
              txEnvelope.commit();
              return txEnvelope.message();
            })
        .runWith(Sink.seq(), materializer);</code></pre></dd>
</dl>
<p>The <code>sessionCount</code> parameter controls the number of JMS sessions to run in parallel.</p>
<p>The <code>ackTimeout</code> parameter controls the maximum time given to a message to be committed or rolled back. If the message times out it will automatically be rolled back. This is to prevent stream from starvation if the application fails to commit or rollback a message, or if the message errors out and the stream is resumed by a <code>decider</code>.</p>
<p><strong>Notes:</strong></p>
<ul>
  <li>Higher throughput is achieved by increasing the <code>sessionCount</code>.</li>
  <li>Messages will arrive out of order if <code>sessionCount</code> is larger than 1.</li>
  <li>Buffering is not supported in transaction mode. The <code>bufferSize</code> is ignored.</li>
  <li>The default <code>AcknowledgeMode</code> is <code>SessionTransacted</code> but can be overridden to custom <code>AcknowledgeMode</code>s, even implementation-specific ones by setting the <code>AcknowledgeMode</code> in the <code>JmsConsumerSettings</code> when creating the stream.</li>
</ul>
<h2><a href="#using-jms-selectors" name="using-jms-selectors" class="anchor"><span class="anchor-link"></span></a>Using JMS selectors</h2>
<p>Create a <a href="https://docs.oracle.com/javaee/7/api/?javax/jms/Message.html">javax.jms.Message</a> source specifying a <a href="https://docs.oracle.com/cd/E19798-01/821-1841/bncer/index.html">JMS selector expression</a>: Verify that we are only receiving messages according to the selector:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/alpakka/tree/v1.0.0/jms/src/test/scala/docs/scaladsl/JmsConnectorsSpec.scala#L346-L350" target="_blank" title="Go to snippet source"></a><code class="language-scala">val jmsSource = JmsConsumer(
  JmsConsumerSettings(consumerConfig, connectionFactory)
    .withQueue(&quot;numbers&quot;)
    .withSelector(&quot;IsOdd = TRUE&quot;)
)</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/alpakka/tree/v1.0.0/jms/src/test/java/docs/javadsl/JmsConnectorsTest.java#L442-L446" target="_blank" title="Go to snippet source"></a><code class="language-java">Source&lt;Message, JmsConsumerControl&gt; jmsSource =
    JmsConsumer.create(
        JmsConsumerSettings.create(system, connectionFactory)
            .withQueue(&quot;test&quot;)
            .withSelector(&quot;IsOdd = TRUE&quot;));</code></pre></dd>
</dl>
<h2><a href="#raw-jvm-type-sources" name="raw-jvm-type-sources" class="anchor"><span class="anchor-link"></span></a>Raw JVM type sources</h2>
<table>
  <thead>
    <tr>
      <th>Stream element type </th>
      <th>Alpakka source factory </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>String </td>
      <td><a href="#text-sources"><code>JmsConsumer.textSource</code></a> </td>
    </tr>
    <tr>
      <td><span class="group-scala">Array[Byte]</span><span class="group-java">byte[</span>] </td>
      <td><a href="#byte-array-sources"><code>JmsConsumer.bytesSource</code></a> </td>
    </tr>
    <tr>
      <td><span class="group-scala">Map[String, AnyRef]</span><span class="group-java">Map&lt;String, Object&gt;</span> </td>
      <td><a href="#map-messages-sources"><code>JmsConsumer.mapSource</code></a> </td>
    </tr>
    <tr>
      <td>Object (<code>java.io.Serializable</code>) </td>
      <td><a href="#object-sources"><code>JmsConsumer.objectSource</code></a> </td>
    </tr>
  </tbody>
</table>
<h3><a href="#text-sources" name="text-sources" class="anchor"><span class="anchor-link"></span></a>Text sources</h3>
<p>The <code>textSource</code> emits the received message body as String:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/alpakka/tree/v1.0.0/jms/src/test/scala/docs/scaladsl/JmsConnectorsSpec.scala#L43-L64" target="_blank" title="Go to snippet source"></a><code class="language-scala">val connectionFactory: javax.jms.ConnectionFactory = new org.apache.activemq.ActiveMQConnectionFactory(url)
val jmsSource: Source[String, JmsConsumerControl] = JmsConsumer.textSource(
  JmsConsumerSettings(system, connectionFactory).withQueue(&quot;test&quot;)
)

val result: Future[immutable.Seq[String]] = jmsSource.take(in.size).runWith(Sink.seq)</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/alpakka/tree/v1.0.0/jms/src/test/java/docs/javadsl/JmsConnectorsTest.java#L124-L144" target="_blank" title="Go to snippet source"></a><code class="language-java">javax.jms.ConnectionFactory connectionFactory = server.createConnectionFactory();
Source&lt;String, JmsConsumerControl&gt; jmsSource =
    JmsConsumer.textSource(
        JmsConsumerSettings.create(system, connectionFactory).withQueue(&quot;test&quot;));

CompletionStage&lt;List&lt;String&gt;&gt; result =
    jmsSource.take(in.size()).runWith(Sink.seq(), materializer);</code></pre></dd>
</dl>
<h3><a href="#byte-array-sources" name="byte-array-sources" class="anchor"><span class="anchor-link"></span></a>Byte array sources</h3>
<p>The <code>bytesSource</code> emits the received message body as byte array:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/alpakka/tree/v1.0.0/jms/src/test/scala/docs/scaladsl/JmsConnectorsSpec.scala#L119-L126" target="_blank" title="Go to snippet source"></a><code class="language-scala">val jmsSource: Source[Array[Byte], JmsConsumerControl] = JmsConsumer.bytesSource(
  JmsConsumerSettings(system, connectionFactory).withQueue(&quot;test&quot;)
)

val result: Future[Array[Byte]] =
  jmsSource
    .take(1)
    .runWith(Sink.head)</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/alpakka/tree/v1.0.0/jms/src/test/java/docs/javadsl/JmsConnectorsTest.java#L195-L213" target="_blank" title="Go to snippet source"></a><code class="language-java">ConnectionFactory connectionFactory = server.createConnectionFactory();

Source&lt;byte[], JmsConsumerControl&gt; jmsSource =
    JmsConsumer.bytesSource(
        JmsConsumerSettings.create(system, connectionFactory).withQueue(&quot;test&quot;));

CompletionStage&lt;byte[]&gt; result = jmsSource.take(1).runWith(Sink.head(), materializer);</code></pre></dd>
</dl>
<h3><a href="#map-sources" name="map-sources" class="anchor"><span class="anchor-link"></span></a>Map sources</h3>
<p>The <code>mapSource</code> emits the received message body as <span class="group-scala">Map[String, Object]</span><span class="group-java">Map&lt;String, Object&gt;</span>:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/alpakka/tree/v1.0.0/jms/src/test/scala/docs/scaladsl/JmsConnectorsSpec.scala#L161-L168" target="_blank" title="Go to snippet source"></a><code class="language-scala">val jmsSource: Source[Map[String, Any], JmsConsumerControl] = JmsConsumer.mapSource(
  JmsConsumerSettings(system, connectionFactory).withQueue(&quot;test&quot;)
)

val result: Future[immutable.Seq[Map[String, Any]]] =
  jmsSource
    .take(1)
    .runWith(Sink.seq)</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/alpakka/tree/v1.0.0/jms/src/test/java/docs/javadsl/JmsConnectorsTest.java#L227-L254" target="_blank" title="Go to snippet source"></a><code class="language-java">ConnectionFactory connectionFactory = server.createConnectionFactory();

Source&lt;Map&lt;String, Object&gt;, JmsConsumerControl&gt; jmsSource =
    JmsConsumer.mapSource(
        JmsConsumerSettings.create(system, connectionFactory).withQueue(&quot;test&quot;));

CompletionStage&lt;Map&lt;String, Object&gt;&gt; resultStage =
    jmsSource.take(1).runWith(Sink.head(), materializer);</code></pre></dd>
</dl>
<h3><a href="#object-sources" name="object-sources" class="anchor"><span class="anchor-link"></span></a>Object sources</h3>
<p>The <code>objectSource</code> emits the received message body as deserialized JVM instance. As serialization may be a security concern, JMS clients require special configuration to allow this. The example shows how to configure ActiveMQ connection factory to support serialization. See <a href="http://activemq.apache.org/objectmessage.html">ActiveMQ Security</a> for more information on this.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/alpakka/tree/v1.0.0/jms/src/test/scala/docs/scaladsl/JmsConnectorsSpec.scala#L73-L97" target="_blank" title="Go to snippet source"></a><code class="language-scala">val connectionFactory = connFactory.asInstanceOf[ActiveMQConnectionFactory]
connectionFactory.setTrustedPackages(List(classOf[DummyObject].getPackage.getName).asJava)
val jmsSource: Source[java.io.Serializable, JmsConsumerControl] = JmsConsumer.objectSource(
  JmsConsumerSettings(system, connectionFactory).withQueue(&quot;test&quot;)
)

val result: Future[java.io.Serializable] =
  jmsSource
    .take(1)
    .runWith(Sink.head)</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/alpakka/tree/v1.0.0/jms/src/test/java/docs/javadsl/JmsConnectorsTest.java#L158-L181" target="_blank" title="Go to snippet source"></a><code class="language-java">ActiveMQConnectionFactory connectionFactory =
    (ActiveMQConnectionFactory) server.createConnectionFactory();
connectionFactory.setTrustedPackages(
    Arrays.asList(DummyJavaTests.class.getPackage().getName()));

Source&lt;java.io.Serializable, JmsConsumerControl&gt; jmsSource =
    JmsConsumer.objectSource(
        JmsConsumerSettings.create(system, connectionFactory).withQueue(&quot;test&quot;));

CompletionStage&lt;java.io.Serializable&gt; result =
    jmsSource.take(1).runWith(Sink.head(), materializer);</code></pre></dd>
</dl>
</div>
</article>

<div class="row">
<div class="small-12 large-9 column">
<section class="nav-prev-next row">
<div class="nav-prev small-6 column">
<a href="../jms/producer.html"><i class="icon-prev"></i> <span class="link-prev">Producer</span></a>
</div>
<div class="nav-next small-6 column clearfix">
<a class="float-right" href="../jms/browse.html">Browse <i class="icon-next"></i></a>
</div>
</section>
</div>
</div>

<div class="source-github row">
Found an error in this documentation? The source code for this page can be found <a href="https://github.com/akka/alpakka/tree/v1.0.0/docs/src/main/paradox/jms/consumer.md">here</a>.
Please feel free to edit and contribute a pull request.
</div>


<footer class="page-footer row clearfix">
<img class="akka-icon float-left show-for-medium" src="../images/akka-icon.svg"/>
<section class="copyright">
<div>Alpakka is Open Source and available under the Apache 2 License.</div>
<p class="legal">
&copy; 2011-2019 <a href="https://www.lightbend.com" target="_blank">Lightbend, Inc.</a> | 
<a href="https://www.lightbend.com/legal/licenses" target="_blank">Licenses</a> | 
<a href="https://www.lightbend.com/legal/terms" target="_blank">Terms</a> | 
<a href="https://www.lightbend.com/legal/privacy" target="_blank">Privacy Policy</a> | 
<a href="https://akka.io/cookie/" target="_blank">Cookie Listing</a> | 
<a class="optanon-toggle-display">Cookie Settings</a>
</p>
</section>
</footer>

</section>
</main>

<script type="text/javascript" src="../js/scrollsneak.js"></script>
<script type="text/javascript">jQuery(document).foundation();</script>
<script type="text/javascript" src="../js/groups.js"></script>
<script type="text/javascript" src="../js/page.js"></script>
<script type="text/javascript" src="../js/magellan.js"></script>

<style type="text/css">@import "../lib/prettify/prettify.css";</style>
<script type="text/javascript" src="../lib/prettify/prettify.js"></script>
<script type="text/javascript" src="../lib/prettify/lang-scala.js"></script>
<script type="text/javascript">//<![CDATA[
jQuery(function(){window.prettyPrint && prettyPrint()});
//]]></script>
<script type="text/javascript" src="../assets/js/warnOldVersion.js"></script>
<script type="text/javascript">//<![CDATA[
jQuery(function(jq){initOldVersionWarnings(jq, '1.0.0', 'https://doc.akka.io/docs/alpakka/current/')});
//]]></script>


</body>
</html>
