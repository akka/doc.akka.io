<!DOCTYPE html>
<html class="no-js" lang="en">

<head>
<title>MQTT &bull; Alpakka Documentation</title>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<meta name="description" content="Alpakka is a Reactive Enterprise Integration library for Java and Scala, based on Reactive Streams and Akka."/>
<link rel="canonical" href="https://doc.akka.io/docs/alpakka/current/mqtt.html"/>
<script type="text/javascript" src="lib/jquery/jquery.min.js"></script>
<script type="text/javascript" src="lib/foundation/dist/js/foundation.min.js"></script>
<link rel="stylesheet" type="text/css" href="lib/normalize.css/normalize.css"/>
<link rel="stylesheet" type="text/css" href="lib/foundation/dist/css/foundation.min.css"/>
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.css" />
<link rel="stylesheet" type="text/css" href="css/icons.css"/>
<link rel="stylesheet" type="text/css" href="css/page.css"/>
<link rel="shortcut icon" href="images/favicon.ico" />
<link rel="apple-touch-icon" sizes="180x180" href="images/apple-touch-icon.png"/>
<link rel="icon" type="image/png" sizes="32x32" href="images/favicon-32x32.png"/>
<link rel="icon" type="image/png" sizes="16x16" href="images/favicon-16x16.png"/>
<link rel="manifest" href="images/manifest.json"/>
<meta name="msapplication-TileImage" content="images/mstile-150x150.png"/>
<meta name="msapplication-TileColor" content="#15a9ce"/>
<meta name="theme-color" content="#15a9ce"/>
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>
<!-- OneTrust Cookies Consent Notice (Production Standard, akka.io, en-GB) start -->
<script src="https://optanon.blob.core.windows.net/consent/159bb13d-6748-4399-806e-ac28db879785.js" type="text/javascript" charset="UTF-8"></script>
<script type="text/javascript">
function OptanonWrapper() { }
</script>
<!-- OneTrust Cookies Consent Notice (Production Standard, akka.io, en-GB) end -->
<!--Google Analytics-->
<script type="text/plain" class="optanon-category-2">
var _gaq = _gaq || [];
_gaq.push(['_setAccount', '']);
_gaq.push(['_setDomainName', '']);
_gaq.push(['_trackPageview']);
(function() {
var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})()
</script>
<script type="text/plain" class="optanon-category-2">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-23127719-1', 'lightbend.com', {'allowLinker': true, 'name': 'tsTracker'});
ga('tsTracker.require', 'linker');
ga('tsTracker.linker:autoLink', ['lightbend.com','playframework.com','scala-lang.org','scaladays.org','spray.io','akka.io','scala-sbt.org','scala-ide.org']);
ga('tsTracker.send', 'pageview');
</script>
<!--Marketo-->
<script type="text/plain" class="optanon-category-3">
(function() {
var didInit = false;
function initMunchkin() {
if(didInit === false) {
didInit = true;
Munchkin.init('558-NCX-702', { 'asyncOnly': true, 'disableClickDelay': true });
}
}
var s = document.createElement('script');
s.type = 'text/javascript';
s.async = true;
s.src = '//munchkin.marketo.net/munchkin.js';
s.onreadystatechange = function() {
if (this.readyState == 'complete' || this.readyState == 'loaded') {
initMunchkin();
}
};
s.onload = initMunchkin;
document.getElementsByTagName('head')[0].appendChild(s);
})();
</script>
</head>

<body id="underlay" data-toggler="nav-open">

<header class="site-header hide-for-large">
<div class="sticky-header clearfix">
<a href="http://akka.io"><img class="logo" src="images/akka-alpakka-reverse.svg"/></a>

<button class="menu-icon float-right" type="button" data-toggle="underlay overlay"></button>
</div>
<div id="overlay" class="overlay-nav" data-toggler="nav-open">
<header class="nav-header">
<div class="nav-header-title">
<h1><a href="index.html">Alpakka Documentation</a></h1>
</div>
<div class="nav-header-version">
Version 1.0.0
</div>
<div class="nav-header-groups">
<select class="supergroup" name="Language"><option class="group" value="group-java">Java</option><option class="group" value="group-scala">Scala</option></select>
</div>
</header>
<nav class="nav-toc">
<ul>
  <li><a href="overview.html" class="page">Overview</a></li>
  <li><a href="data-transformations/index.html" class="page">Data Transformations</a></li>
  <li><a href="amqp.html" class="page">AMQP</a></li>
  <li><a href="external/apache-camel.html" class="page">Apache Camel</a></li>
  <li><a href="cassandra.html" class="page">Apache Cassandra</a></li>
  <li><a href="geode.html" class="page">Apache Geode</a></li>
  <li><a href="kafka.html" class="page">Apache Kafka</a></li>
  <li><a href="kudu.html" class="page">Apache Kudu</a></li>
  <li><a href="solr.html" class="page">Apache Solr</a></li>
  <li><a href="avroparquet.html" class="page">Avro Parquet</a></li>
  <li><a href="dynamodb.html" class="page">AWS DynamoDB</a></li>
  <li><a href="kinesis.html" class="page">AWS Kinesis</a></li>
  <li><a href="awslambda.html" class="page">AWS Lambda</a></li>
  <li><a href="s3.html" class="page">AWS S3</a></li>
  <li><a href="sns.html" class="page">AWS SNS</a></li>
  <li><a href="sqs.html" class="page">AWS SQS</a></li>
  <li><a href="external/azure-event-hubs.html" class="page">Azure Event Hubs</a></li>
  <li><a href="external/azure-iot-hub.html" class="page">Azure IoT Hub</a></li>
  <li><a href="azure-storage-queue.html" class="page">Azure Storage Queue</a></li>
  <li><a href="couchbase.html" class="page">Couchbase</a></li>
  <li><a href="elasticsearch.html" class="page">Elasticsearch</a></li>
  <li><a href="external/eventuate.html" class="page">Eventuate</a></li>
  <li><a href="file.html" class="page">File</a></li>
  <li><a href="external/fs2.html" class="page">FS2</a></li>
  <li><a href="ftp.html" class="page">FTP</a></li>
  <li><a href="google-cloud-pub-sub.html" class="page">Google Cloud Pub/Sub</a></li>
  <li><a href="google-cloud-pub-sub-grpc.html" class="page">Google Cloud Pub/Sub gRPC</a></li>
  <li><a href="google-fcm.html" class="page">Google FCM</a></li>
  <li><a href="external/grpc.html" class="page">gRPC</a></li>
  <li><a href="hdfs.html" class="page">Hadoop Distributed File System - HDFS</a></li>
  <li><a href="hbase.html" class="page">HBase</a></li>
  <li><a href="external/http.html" class="page">HTTP</a></li>
  <li><a href="bluemix-cos.html" class="page">IBM Bluemix Cloud Object Storage</a></li>
  <li><a href="external/db2-event-store.html" class="page">IBM Db2 Event Store</a></li>
  <li><a href="ironmq.html" class="page">IronMQ</a></li>
  <li><a href="jms/index.html" class="page">JMS</a></li>
  <li><a href="mongodb.html" class="page">MongoDB</a></li>
  <li><a href="mqtt.html#mqtt" class="active page">MQTT</a>
  <ul>
    <li><a href="mqtt.html#artifacts" class="header">Artifacts</a></li>
    <li><a href="mqtt.html#settings" class="header">Settings</a></li>
    <li><a href="mqtt.html#reading-from-mqtt" class="header">Reading from MQTT</a></li>
    <li><a href="mqtt.html#publishing-to-mqtt" class="header">Publishing to MQTT</a></li>
    <li><a href="mqtt.html#publish-and-subscribe-in-a-single-flow" class="header">Publish and subscribe in a single flow</a></li>
    <li><a href="mqtt.html#capturing-mqtt-client-logging" class="header">Capturing MQTT client logging</a></li>
    <li><a href="mqtt.html#running-the-example-code" class="header">Running the example code</a></li>
  </ul></li>
  <li><a href="mqtt-streaming.html" class="page">MQTT Streaming</a></li>
  <li><a href="orientdb.html" class="page">OrientDB</a></li>
  <li><a href="external/pulsar.html" class="page">Pulsar</a></li>
  <li><a href="sse.html" class="page">Server-sent Events (SSE)</a></li>
  <li><a href="slick.html" class="page">Slick (JDBC)</a></li>
  <li><a href="spring-web.html" class="page">Spring Web</a></li>
  <li><a href="external/tcp.html" class="page">TCP</a></li>
  <li><a href="udp.html" class="page">UDP</a></li>
  <li><a href="unix-domain-socket.html" class="page">Unix Domain Socket</a></li>
</ul>
</nav>
</div>
</header>

<aside class="show-for-large">
<header class="nav-header fixed-sidebar-header">
<div class="nav-header-title">
<h1><a href="index.html">Alpakka Documentation</a></h1>
</div>
<div class="nav-header-version">
Version 1.0.0
</div>
<div class="nav-header-groups">
<select class="supergroup" name="Language"><option class="group" value="group-java">Java</option><option class="group" value="group-scala">Scala</option></select>
</div>
</header>
<nav class="site-nav fixed-sidebar-contents">
<div class="nav-toc">
<ul>
  <li><a href="overview.html" class="page">Overview</a></li>
  <li><a href="data-transformations/index.html" class="page">Data Transformations</a></li>
  <li><a href="amqp.html" class="page">AMQP</a></li>
  <li><a href="external/apache-camel.html" class="page">Apache Camel</a></li>
  <li><a href="cassandra.html" class="page">Apache Cassandra</a></li>
  <li><a href="geode.html" class="page">Apache Geode</a></li>
  <li><a href="kafka.html" class="page">Apache Kafka</a></li>
  <li><a href="kudu.html" class="page">Apache Kudu</a></li>
  <li><a href="solr.html" class="page">Apache Solr</a></li>
  <li><a href="avroparquet.html" class="page">Avro Parquet</a></li>
  <li><a href="dynamodb.html" class="page">AWS DynamoDB</a></li>
  <li><a href="kinesis.html" class="page">AWS Kinesis</a></li>
  <li><a href="awslambda.html" class="page">AWS Lambda</a></li>
  <li><a href="s3.html" class="page">AWS S3</a></li>
  <li><a href="sns.html" class="page">AWS SNS</a></li>
  <li><a href="sqs.html" class="page">AWS SQS</a></li>
  <li><a href="external/azure-event-hubs.html" class="page">Azure Event Hubs</a></li>
  <li><a href="external/azure-iot-hub.html" class="page">Azure IoT Hub</a></li>
  <li><a href="azure-storage-queue.html" class="page">Azure Storage Queue</a></li>
  <li><a href="couchbase.html" class="page">Couchbase</a></li>
  <li><a href="elasticsearch.html" class="page">Elasticsearch</a></li>
  <li><a href="external/eventuate.html" class="page">Eventuate</a></li>
  <li><a href="file.html" class="page">File</a></li>
  <li><a href="external/fs2.html" class="page">FS2</a></li>
  <li><a href="ftp.html" class="page">FTP</a></li>
  <li><a href="google-cloud-pub-sub.html" class="page">Google Cloud Pub/Sub</a></li>
  <li><a href="google-cloud-pub-sub-grpc.html" class="page">Google Cloud Pub/Sub gRPC</a></li>
  <li><a href="google-fcm.html" class="page">Google FCM</a></li>
  <li><a href="external/grpc.html" class="page">gRPC</a></li>
  <li><a href="hdfs.html" class="page">Hadoop Distributed File System - HDFS</a></li>
  <li><a href="hbase.html" class="page">HBase</a></li>
  <li><a href="external/http.html" class="page">HTTP</a></li>
  <li><a href="bluemix-cos.html" class="page">IBM Bluemix Cloud Object Storage</a></li>
  <li><a href="external/db2-event-store.html" class="page">IBM Db2 Event Store</a></li>
  <li><a href="ironmq.html" class="page">IronMQ</a></li>
  <li><a href="jms/index.html" class="page">JMS</a></li>
  <li><a href="mongodb.html" class="page">MongoDB</a></li>
  <li><a href="mqtt.html#mqtt" class="active page">MQTT</a>
  <ul>
    <li><a href="mqtt.html#artifacts" class="header">Artifacts</a></li>
    <li><a href="mqtt.html#settings" class="header">Settings</a></li>
    <li><a href="mqtt.html#reading-from-mqtt" class="header">Reading from MQTT</a></li>
    <li><a href="mqtt.html#publishing-to-mqtt" class="header">Publishing to MQTT</a></li>
    <li><a href="mqtt.html#publish-and-subscribe-in-a-single-flow" class="header">Publish and subscribe in a single flow</a></li>
    <li><a href="mqtt.html#capturing-mqtt-client-logging" class="header">Capturing MQTT client logging</a></li>
    <li><a href="mqtt.html#running-the-example-code" class="header">Running the example code</a></li>
  </ul></li>
  <li><a href="mqtt-streaming.html" class="page">MQTT Streaming</a></li>
  <li><a href="orientdb.html" class="page">OrientDB</a></li>
  <li><a href="external/pulsar.html" class="page">Pulsar</a></li>
  <li><a href="sse.html" class="page">Server-sent Events (SSE)</a></li>
  <li><a href="slick.html" class="page">Slick (JDBC)</a></li>
  <li><a href="spring-web.html" class="page">Spring Web</a></li>
  <li><a href="external/tcp.html" class="page">TCP</a></li>
  <li><a href="udp.html" class="page">UDP</a></li>
  <li><a href="unix-domain-socket.html" class="page">Unix Domain Socket</a></li>
</ul>
</div>
</nav>
<footer class="nav-footer fixed-sidebar-footer">
<a href="http://akka.io"><img class="logo" src="images/akka-alpakka-reverse.svg"/></a>

</footer>
</aside>

<main class="fixed-shift-for-large expanded row">
<section class="site-content small-12 column">

<article class="page-content row">
<div class="small-12 large-9 column" id="docs">
<h1><a href="#mqtt" name="mqtt" class="anchor"><span class="anchor-link"></span></a>MQTT</h1><div class="callout note "><div class="callout-title">MQTT</div>
<p>MQTT stands for MQ Telemetry Transport. It is a publish/subscribe, extremely simple and lightweight messaging protocol, designed for constrained devices and low-bandwidth, high-latency or unreliable networks. The design principles are to minimise network bandwidth and device resource requirements whilst also attempting to ensure reliability and some degree of assurance of delivery. These principles also turn out to make the protocol ideal of the emerging “machine-to-machine” (M2M) or “Internet of Things” world of connected devices, and for mobile applications where bandwidth and battery power are at a premium. </p>
<p>Further information on <a href="https://mqtt.org/">mqtt.org</a>.</p></div><div class="callout note "><div class="callout-title">Streaming Differences</div>
<p>Alpakka contains <a href="mqtt-streaming.html">another MQTT connector</a> which is <em>not</em> based on the Eclipse Paho client, unlike this one. Please refer to the other connector where the differences are expanded on.</p></div>
<p>The Alpakka MQTT connector provides an Akka Stream source, sink and flow to connect to MQTT brokers. It is based on the <a href="https://www.eclipse.org/paho/clients/java/">Eclipse Paho Java client</a>.</p>
<table class="project-info">
<tr><th colspan="2">Project Info: Alpakka MQTT</th></tr>
  <tr><th>Artifact</th><td><div>com.lightbend.akka</div>
  <div>akka-stream-alpakka-mqtt</div>
  <div>1.0.0</div>
  <div><a href="other-docs/snapshots.html">Snapshots are available</a></div>
  </td></tr>
  <tr><th>JDK versions</th><td><div>OpenJDK 8</div></td></tr>
  <tr><th>Scala versions</th><td>2.12.7, 2.11.12, 2.13.0-M5</td></tr>
  <tr><th>JPMS module name</th><td>akka.stream.alpakka.mqtt</td></tr>
  <tr><th>License</th><td><div><a href="http://www.apache.org/licenses/LICENSE-2.0" target="_blank" rel="noopener noreferrer">Apache-2.0</a></div>
  </td></tr>
  <tr><th>Readiness level</th><td><div class="readiness-level"><a href="https://developer.lightbend.com/docs/reactive-platform/2.0/support-terminology/index.html#community-driven" target="_blank" rel="noopener noreferrer">Community-driven</a></div>
  <div>Since 0.1, 2016-11-10</div>
  </td></tr>
  <tr><th>Home page</th><td><a href="https://doc.akka.io/docs/alpakka/current/">https://doc.akka.io/docs/alpakka/current/</a></td></tr>
  <tr><th>API documentation</th><td>
  <div><a href="https://doc.akka.io/api/alpakka/1.0.0/akka/stream/alpakka/mqtt/index.html" target="_blank" rel="noopener noreferrer">API (Scaladoc)</a></div>
  </td></tr>
  <tr><th>Forums</th><td>
  <div><a href="https://discuss.lightbend.com/c/akka/" target="_blank" rel="noopener noreferrer">Lightbend Discuss</a></div>
  <div><a href="https://gitter.im/akka/akka" target="_blank" rel="noopener noreferrer">akka/akka Gitter channel</a></div>
  </td></tr>
  <tr><th>Release notes</th><td><a href="https://doc.akka.io/docs/alpakka/current/release-notes/index.html">In the documentation</a></td></tr>
  <tr><th>Issues</th><td><a href="https://github.com/akka/alpakka/labels/p%3Amqtt" target="_blank" rel="noopener noreferrer">Github issues</a></td></tr>
  <tr><th>Sources</th><td><a href="https://github.com/akka/alpakka" target="_blank" rel="noopener noreferrer">https://github.com/akka/alpakka</a></td></tr>
</table>

<h2><a href="#artifacts" name="artifacts" class="anchor"><span class="anchor-link"></span></a>Artifacts</h2>
<dl class="dependency"><dt>sbt</dt><dd><pre class="prettyprint"><code class="language-scala">libraryDependencies += "com.lightbend.akka" %% "akka-stream-alpakka-mqtt" % "1.0.0"</code></pre></dd><dt>Maven</dt><dd><pre class="prettyprint"><code class="language-xml">&lt;dependency&gt;
  &lt;groupId&gt;com.lightbend.akka&lt;/groupId&gt;
  &lt;artifactId&gt;akka-stream-alpakka-mqtt_2.12&lt;/artifactId&gt;
  &lt;version&gt;1.0.0&lt;/version&gt;
&lt;/dependency&gt;</code></pre></dd><dt>Gradle</dt><dd><pre class="prettyprint"><code class="language-gradle">dependencies {
  compile group: 'com.lightbend.akka', name: 'akka-stream-alpakka-mqtt_2.12', version: '1.0.0'
}</code></pre></dd></dl>
<p>The table below shows direct dependencies of this module and the second tab shows all libraries it depends on transitively.</p>
<dl class="dependencies"><dt>Direct dependencies</dt><dd><table>
  <thead><tr><th>Organization</th><th>Artifact</th><th>Version</th><th>License</th></tr></thead>
  <tbody>
    <tr><td>com.typesafe.akka</td><td>akka-stream_2.12</td><td><a href="https://mvnrepository.com/artifact/com.typesafe.akka/akka-stream_2.12/2.5.21" target="_blank">2.5.21</a></td><td>Apache License, Version 2.0</td></tr>
    <tr><td>org.eclipse.paho</td><td>org.eclipse.paho.client.mqttv3</td><td><a href="https://mvnrepository.com/artifact/org.eclipse.paho/org.eclipse.paho.client.mqttv3/1.2.0" target="_blank">1.2.0</a></td><td>Eclipse Public License - Version 1.0</td></tr>
    <tr><td>org.scala-lang</td><td>scala-library</td><td><a href="https://mvnrepository.com/artifact/org.scala-lang/scala-library/2.12.7" target="_blank">2.12.7</a></td><td>BSD 3-Clause</td></tr>
  </tbody>
</table></dd>
<dt>Dependency tree</dt><dd><pre>
com.typesafe.akka    akka-stream_2.12    <a href="https://mvnrepository.com/artifact/com.typesafe.akka/akka-stream_2.12/2.5.21" target="_blank">2.5.21</a>    Apache License, Version 2.0
    com.typesafe.akka    akka-actor_2.12    <a href="https://mvnrepository.com/artifact/com.typesafe.akka/akka-actor_2.12/2.5.21" target="_blank">2.5.21</a>    Apache License, Version 2.0
        com.typesafe    config    <a href="https://mvnrepository.com/artifact/com.typesafe/config/1.3.3" target="_blank">1.3.3</a>    Apache License, Version 2.0
        org.scala-lang.modules    scala-java8-compat_2.12    <a href="https://mvnrepository.com/artifact/org.scala-lang.modules/scala-java8-compat_2.12/0.8.0" target="_blank">0.8.0</a>    BSD 3-clause
            org.scala-lang    scala-library    <a href="https://mvnrepository.com/artifact/org.scala-lang/scala-library/2.12.7" target="_blank">2.12.7</a>    BSD 3-Clause
        org.scala-lang    scala-library    <a href="https://mvnrepository.com/artifact/org.scala-lang/scala-library/2.12.7" target="_blank">2.12.7</a>    BSD 3-Clause
    com.typesafe.akka    akka-protobuf_2.12    <a href="https://mvnrepository.com/artifact/com.typesafe.akka/akka-protobuf_2.12/2.5.21" target="_blank">2.5.21</a>    Apache License, Version 2.0
        org.scala-lang    scala-library    <a href="https://mvnrepository.com/artifact/org.scala-lang/scala-library/2.12.7" target="_blank">2.12.7</a>    BSD 3-Clause
    com.typesafe    ssl-config-core_2.12    <a href="https://mvnrepository.com/artifact/com.typesafe/ssl-config-core_2.12/0.3.7" target="_blank">0.3.7</a>    Apache-2.0
        com.typesafe    config    <a href="https://mvnrepository.com/artifact/com.typesafe/config/1.3.3" target="_blank">1.3.3</a>    Apache License, Version 2.0
        org.scala-lang.modules    scala-parser-combinators_2.12    <a href="https://mvnrepository.com/artifact/org.scala-lang.modules/scala-parser-combinators_2.12/1.1.1" target="_blank">1.1.1</a>    BSD 3-clause
            org.scala-lang    scala-library    <a href="https://mvnrepository.com/artifact/org.scala-lang/scala-library/2.12.7" target="_blank">2.12.7</a>    BSD 3-Clause
        org.scala-lang    scala-library    <a href="https://mvnrepository.com/artifact/org.scala-lang/scala-library/2.12.7" target="_blank">2.12.7</a>    BSD 3-Clause
    org.reactivestreams    reactive-streams    <a href="https://mvnrepository.com/artifact/org.reactivestreams/reactive-streams/1.0.2" target="_blank">1.0.2</a>    CC0
    org.scala-lang    scala-library    <a href="https://mvnrepository.com/artifact/org.scala-lang/scala-library/2.12.7" target="_blank">2.12.7</a>    BSD 3-Clause
org.eclipse.paho    org.eclipse.paho.client.mqttv3    <a href="https://mvnrepository.com/artifact/org.eclipse.paho/org.eclipse.paho.client.mqttv3/1.2.0" target="_blank">1.2.0</a>    Eclipse Public License - Version 1.0
org.scala-lang    scala-library    <a href="https://mvnrepository.com/artifact/org.scala-lang/scala-library/2.12.7" target="_blank">2.12.7</a>    BSD 3-Clause</pre></dd>
</dl>

<h2><a href="#settings" name="settings" class="anchor"><span class="anchor-link"></span></a>Settings</h2>

<p>The required <code>MqttConnectionSettings</code> (<a href="https://doc.akka.io/api/alpakka/1.0.0/akka/stream/alpakka/mqtt/MqttConnectionSettings$.html">API</a>) settings to connect to an MQTT server are </p>

<ol>
  <li>the MQTT broker address</li>
  <li>a unique ID for the client (setting it to the empty string should let the MQTT broker assign it, but not all do; you might want to generate it)</li>
  <li>the MQTT client persistence to use (eg. <a href="https://www.eclipse.org/paho/files/javadoc/?org/eclipse/paho/client/mqttv3/persist/MemoryPersistence.html">MemoryPersistence</a>) which allows to control reliability guarantees</li>
</ol>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/alpakka/tree/v1.0.0/mqtt/src/test/scala/docs/scaladsl/MqttSourceSpec.scala#L80-L84" target="_blank" title="Go to snippet source"></a><code class="language-scala">val connectionSettings = MqttConnectionSettings(
  &quot;tcp://localhost:1883&quot;, // (1)
  &quot;test-scala-client&quot;, // (2)
  new MemoryPersistence // (3)
)</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/alpakka/tree/v1.0.0/mqtt/src/test/java/docs/javadsl/MqttSourceTest.java#L73-L78" target="_blank" title="Go to snippet source"></a><code class="language-java">MqttConnectionSettings connectionSettings =
    MqttConnectionSettings.create(
        &quot;tcp://localhost:1883&quot;, // (1)
        &quot;test-java-client&quot;, // (2)
        new MemoryPersistence() // (3)
        );</code></pre></dd>
</dl>
<p>Most settings are passed on to Paho&rsquo;s <code>MqttConnectOptions</code> (<a href="https://www.eclipse.org/paho/files/javadoc/?org/eclipse/paho/client/mqttv3/MqttConnectOptions.html">API</a>) and documented there. </p><div class="callout warning "><div class="callout-title">Use delayed stream restarts</div>
<p>Note that the following examples do not provide any connection management and are designed to get you going quickly. Consider empty client IDs to auto-generate unique identifiers and the use of <a href="https://doc.akka.io/docs/akka/current/stream/stream-error.html?language=scala#delayed-restarts-with-a-backoff-stage">delayed stream restarts</a>. The underlying Paho library&rsquo;s auto-reconnect feature <a href="https://github.com/eclipse/paho.mqtt.golang/issues/77">does not handle initial connections by design</a>.</p></div>
<h3><a href="#configure-encrypted-connections" name="configure-encrypted-connections" class="anchor"><span class="anchor-link"></span></a>Configure encrypted connections</h3>
<p>To connect with transport-level security configure the address as <code>ssl://</code>, set authentication details and pass in a socket factory.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/alpakka/tree/v1.0.0/mqtt/src/test/scala/docs/scaladsl/MqttSourceSpec.scala#L91-L96" target="_blank" title="Go to snippet source"></a><code class="language-scala">val connectionSettings = MqttConnectionSettings(
  &quot;ssl://localhost:1885&quot;,
  &quot;ssl-client&quot;,
  new MemoryPersistence
).withAuth(&quot;mqttUser&quot;, &quot;mqttPassword&quot;)
  .withSocketFactory(SSLContext.getDefault.getSocketFactory)</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/alpakka/tree/v1.0.0/mqtt/src/test/java/docs/javadsl/MqttSourceTest.java#L86-L89" target="_blank" title="Go to snippet source"></a><code class="language-java">MqttConnectionSettings connectionSettings =
    MqttConnectionSettings.create(&quot;ssl://localhost:1885&quot;, &quot;ssl-client&quot;, new MemoryPersistence())
        .withAuth(&quot;mqttUser&quot;, &quot;mqttPassword&quot;)
        .withSocketFactory(SSLContext.getDefault().getSocketFactory());</code></pre></dd>
</dl>
<h2><a href="#reading-from-mqtt" name="reading-from-mqtt" class="anchor"><span class="anchor-link"></span></a>Reading from MQTT</h2>
<h3><a href="#at-most-once" name="at-most-once" class="anchor"><span class="anchor-link"></span></a>At most once</h3>
<p>Then let&rsquo;s create a source that connects to the MQTT server and receives messages from the subscribed topics.</p>
<p>The <code>bufferSize</code> sets the maximum number of messages read from MQTT before back-pressure applies.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/alpakka/tree/v1.0.0/mqtt/src/test/scala/docs/scaladsl/MqttSourceSpec.scala#L204-L214" target="_blank" title="Go to snippet source"></a><code class="language-scala">val mqttSource: Source[MqttMessage, Future[Done]] =
  MqttSource.atMostOnce(
    connectionSettings.withClientId(clientId = &quot;source-spec/source&quot;),
    MqttSubscriptions(Map(topic1 -&gt; MqttQoS.AtLeastOnce, topic2 -&gt; MqttQoS.AtLeastOnce)),
    bufferSize = 8
  )

val (subscribed, streamResult) = mqttSource
  .take(messages.size)
  .toMat(Sink.seq)(Keep.both)
  .run()</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/alpakka/tree/v1.0.0/mqtt/src/test/java/docs/javadsl/MqttSourceTest.java#L221-L237" target="_blank" title="Go to snippet source"></a><code class="language-java">MqttSubscriptions subscriptions =
    MqttSubscriptions.create(topic1, MqttQoS.atMostOnce())
        .addSubscription(topic2, MqttQoS.atMostOnce());

Source&lt;MqttMessage, CompletionStage&lt;Done&gt;&gt; mqttSource =
    MqttSource.atMostOnce(
        connectionSettings.withClientId(&quot;source-test/source&quot;), subscriptions, bufferSize);

Pair&lt;CompletionStage&lt;Done&gt;, CompletionStage&lt;List&lt;String&gt;&gt;&gt; materialized =
    mqttSource
        .map(m -&gt; m.topic() + &quot;-&quot; + m.payload().utf8String())
        .take(messageCount * 2)
        .toMat(Sink.seq(), Keep.both())
        .run(materializer);

CompletionStage&lt;Done&gt; subscribed = materialized.first();
CompletionStage&lt;List&lt;String&gt;&gt; streamResult = materialized.second();</code></pre></dd>
</dl>
<p>This source has a materialized value (<span class="group-scala"><a href="https://www.scala-lang.org/api/current/scala/concurrent/Future.html">Future[Done]</a></span><span class="group-java"><a href="https://docs.oracle.com/javase/8/docs/api/?java/util/concurrent/CompletionStage.html">CompletionStage&lt;Done&gt;</a></span>) which is completed when the subscription to the MQTT broker has been established.</p>
<p>MQTT <code>atMostOnce</code> automatically acknowledges messages back to the server when they are passed downstream. </p>
<h3><a href="#at-least-once" name="at-least-once" class="anchor"><span class="anchor-link"></span></a>At least once</h3>
<p>The <code>atLeastOnce</code> source allow users to acknowledge the messages anywhere downstream. Please note that for manual acks to work <code>CleanSession</code> should be set to false and <code>MqttQoS</code> should be <code>AtLeastOnce</code>.</p>
<p>The <code>bufferSize</code> sets the maximum number of messages read from MQTT before back-pressure applies.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/alpakka/tree/v1.0.0/mqtt/src/test/scala/docs/scaladsl/MqttSourceSpec.scala#L128-L135" target="_blank" title="Go to snippet source"></a><code class="language-scala">val mqttSource: Source[MqttMessageWithAck, Future[Done]] =
  MqttSource.atLeastOnce(
    connectionSettings
      .withClientId(clientId = &quot;source-spec/source1&quot;)
      .withCleanSession(false),
    MqttSubscriptions(topic, MqttQoS.AtLeastOnce),
    bufferSize = 8
  )</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/alpakka/tree/v1.0.0/mqtt/src/test/java/docs/javadsl/MqttSourceTest.java#L107-L113" target="_blank" title="Go to snippet source"></a><code class="language-java">Source&lt;MqttMessageWithAck, CompletionStage&lt;Done&gt;&gt; mqttSource =
    MqttSource.atLeastOnce(
        connectionSettings
            .withClientId(&quot;source-test/source-withoutAutoAck&quot;)
            .withCleanSession(false),
        MqttSubscriptions.create(topic, MqttQoS.atLeastOnce()),
        bufferSize);</code></pre></dd>
</dl>
<p>The <code>atLeastOnce</code> source returns <span class="group-scala"><a href="https://doc.akka.io/api/alpakka/1.0.0/akka/stream/alpakka/mqtt/scaladsl/MqttMessageWithAck.html">MqttMessageWithAck</a></span><span class="group-java"><a href="https://doc.akka.io/api/alpakka/1.0.0/akka/stream/alpakka/mqtt/javadsl/MqttMessageWithAck.html">MqttMessageWithAck</a></span> so you can acknowledge them by calling <code>ack()</code>.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/alpakka/tree/v1.0.0/mqtt/src/test/scala/docs/scaladsl/MqttSourceSpec.scala#L149-L153" target="_blank" title="Go to snippet source"></a><code class="language-scala">val result = mqttSource
  .via(businessLogic)
  .mapAsync(1)(messageWithAck =&gt; messageWithAck.ack().map(_ =&gt; messageWithAck.message))
  .take(input.size)
  .runWith(Sink.seq)</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/alpakka/tree/v1.0.0/mqtt/src/test/java/docs/javadsl/MqttSourceTest.java#L142-L150" target="_blank" title="Go to snippet source"></a><code class="language-java">final CompletionStage&lt;List&lt;MqttMessage&gt;&gt; result =
    mqttSource
        .via(businessLogic)
        .mapAsync(
            1,
            messageWithAck -&gt;
                messageWithAck.ack().thenApply(unused2 -&gt; messageWithAck.message()))
        .take(input.size())
        .runWith(Sink.seq(), materializer);</code></pre></dd>
</dl>
<h2><a href="#publishing-to-mqtt" name="publishing-to-mqtt" class="anchor"><span class="anchor-link"></span></a>Publishing to MQTT</h2>
<p>To publish messages to the MQTT server create a sink be specifying <code>MqttConnectionSettings</code> (<a href="https://doc.akka.io/api/alpakka/1.0.0/akka/stream/alpakka/mqtt/MqttConnectionSettings$.html">API</a>) and a default Quality of Service-level.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/alpakka/tree/v1.0.0/mqtt/src/test/scala/docs/scaladsl/MqttSourceSpec.scala#L219-L221" target="_blank" title="Go to snippet source"></a><code class="language-scala">val sink: Sink[MqttMessage, Future[Done]] =
  MqttSink(connectionSettings, MqttQoS.AtLeastOnce)
Source(messages).runWith(sink)</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/alpakka/tree/v1.0.0/mqtt/src/test/java/docs/javadsl/MqttSourceTest.java#L253-L255" target="_blank" title="Go to snippet source"></a><code class="language-java">Sink&lt;MqttMessage, CompletionStage&lt;Done&gt;&gt; mqttSink =
    MqttSink.create(connectionSettings.withClientId(&quot;source-test/sink&quot;), MqttQoS.atLeastOnce());
Source.from(messages).runWith(mqttSink, materializer);</code></pre></dd>
</dl>
<p>The Quality of Service-level and the retained flag can be configured on a per-message basis.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/alpakka/tree/v1.0.0/mqtt/src/test/scala/docs/scaladsl/MqttSourceSpec.scala#L390-L392" target="_blank" title="Go to snippet source"></a><code class="language-scala">val lastWill = MqttMessage(willTopic, ByteString(&quot;ohi&quot;))
  .withQos(MqttQoS.AtLeastOnce)
  .withRetained(true)</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/alpakka/tree/v1.0.0/mqtt/src/test/java/docs/javadsl/MqttSourceTest.java#L281-L284" target="_blank" title="Go to snippet source"></a><code class="language-java">MqttMessage lastWill =
    MqttMessage.create(willTopic, ByteString.fromString(&quot;ohi&quot;))
        .withQos(MqttQoS.atLeastOnce())
        .withRetained(true);</code></pre></dd>
</dl>
<h2><a href="#publish-and-subscribe-in-a-single-flow" name="publish-and-subscribe-in-a-single-flow" class="anchor"><span class="anchor-link"></span></a>Publish and subscribe in a single flow</h2>
<p>It is also possible to connect to the MQTT server in bidirectional fashion, using a single underlying connection (and client ID). To do that create an MQTT flow that combines the functionalities of an MQTT source and an MQTT sink.</p>
<p>The <code>bufferSize</code> sets the maximum number of messages read from MQTT before back-pressure applies.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/alpakka/tree/v1.0.0/mqtt/src/test/scala/docs/scaladsl/MqttFlowSpec.scala#L45-L51" target="_blank" title="Go to snippet source"></a><code class="language-scala">val mqttFlow: Flow[MqttMessage, MqttMessage, Future[Done]] =
  MqttFlow.atMostOnce(
    connectionSettings.withClientId(&quot;flow-spec/flow&quot;),
    MqttSubscriptions(topic, MqttQoS.AtLeastOnce),
    bufferSize = 8,
    MqttQoS.AtLeastOnce
  )</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/alpakka/tree/v1.0.0/mqtt/src/test/java/docs/javadsl/MqttFlowTest.java#L63-L68" target="_blank" title="Go to snippet source"></a><code class="language-java">final Flow&lt;MqttMessage, MqttMessage, CompletionStage&lt;Done&gt;&gt; mqttFlow =
    MqttFlow.atMostOnce(
        connectionSettings,
        MqttSubscriptions.create(&quot;flow-test/topic&quot;, MqttQoS.atMostOnce()),
        bufferSize,
        MqttQoS.atLeastOnce());</code></pre></dd>
</dl>
<p>Run the flow by connecting a source of messages to be published and a sink for received messages.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/alpakka/tree/v1.0.0/mqtt/src/test/scala/docs/scaladsl/MqttFlowSpec.scala#L57-L60" target="_blank" title="Go to snippet source"></a><code class="language-scala">val ((mqttMessagePromise, subscribed), result) = source
  .viaMat(mqttFlow)(Keep.both)
  .toMat(Sink.seq)(Keep.both)
  .run()</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/alpakka/tree/v1.0.0/mqtt/src/test/java/docs/javadsl/MqttFlowTest.java#L74-L82" target="_blank" title="Go to snippet source"></a><code class="language-java">final Pair&lt;
        Pair&lt;CompletableFuture&lt;Optional&lt;MqttMessage&gt;&gt;, CompletionStage&lt;Done&gt;&gt;,
        CompletionStage&lt;List&lt;MqttMessage&gt;&gt;&gt;
    materialized =
        source.viaMat(mqttFlow, Keep.both()).toMat(Sink.seq(), Keep.both()).run(materializer);

CompletableFuture&lt;Optional&lt;MqttMessage&gt;&gt; mqttMessagePromise = materialized.first().first();
CompletionStage&lt;Done&gt; subscribedToMqtt = materialized.first().second();
CompletionStage&lt;List&lt;MqttMessage&gt;&gt; streamResult = materialized.second();</code></pre></dd>
</dl>
<h2><a href="#capturing-mqtt-client-logging" name="capturing-mqtt-client-logging" class="anchor"><span class="anchor-link"></span></a>Capturing MQTT client logging</h2>
<p>The Paho library uses its own logging adapter and contains a default implementation to use <code>java.util.logging</code>. See <a href="https://wiki.eclipse.org/Paho/Log_and_Debug_in_the_Java_client">Paho/Log and Debug</a>.</p>
<h2><a href="#running-the-example-code" name="running-the-example-code" class="anchor"><span class="anchor-link"></span></a>Running the example code</h2>
<p>The code in this guide is part of runnable tests of this project. You are welcome to edit the code and run it in sbt.</p>
<blockquote>
  <p>Test code requires a MQTT server running in the background. You can start one quickly using docker:</p>
  <p><code>docker-compose up mqtt</code></p>
</blockquote>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre><code>sbt
&gt; mqtt/testOnly *.MqttSourceSpec
</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre><code>sbt
&gt; mqtt/testOnly *.MqttSourceTest
</code></pre></dd>
</dl>
</div>
</article>

<div class="row">
<div class="small-12 large-9 column">
<section class="nav-prev-next row">
<div class="nav-prev small-6 column">
<a href="mongodb.html"><i class="icon-prev"></i> <span class="link-prev">MongoDB</span></a>
</div>
<div class="nav-next small-6 column clearfix">
<a class="float-right" href="mqtt-streaming.html">MQTT Streaming <i class="icon-next"></i></a>
</div>
</section>
</div>
</div>

<div class="source-github row">
Found an error in this documentation? The source code for this page can be found <a href="https://github.com/akka/alpakka/tree/v1.0.0/docs/src/main/paradox/mqtt.md">here</a>.
Please feel free to edit and contribute a pull request.
</div>


<footer class="page-footer row clearfix">
<img class="akka-icon float-left show-for-medium" src="images/akka-icon.svg"/>
<section class="copyright">
<div>Alpakka is Open Source and available under the Apache 2 License.</div>
<p class="legal">
&copy; 2011-2019 <a href="https://www.lightbend.com" target="_blank">Lightbend, Inc.</a> | 
<a href="https://www.lightbend.com/legal/licenses" target="_blank">Licenses</a> | 
<a href="https://www.lightbend.com/legal/terms" target="_blank">Terms</a> | 
<a href="https://www.lightbend.com/legal/privacy" target="_blank">Privacy Policy</a> | 
<a href="https://akka.io/cookie/" target="_blank">Cookie Listing</a> | 
<a class="optanon-toggle-display">Cookie Settings</a>
</p>
</section>
</footer>

</section>
</main>

<script type="text/javascript" src="js/scrollsneak.js"></script>
<script type="text/javascript">jQuery(document).foundation();</script>
<script type="text/javascript" src="js/groups.js"></script>
<script type="text/javascript" src="js/page.js"></script>
<script type="text/javascript" src="js/magellan.js"></script>

<style type="text/css">@import "lib/prettify/prettify.css";</style>
<script type="text/javascript" src="lib/prettify/prettify.js"></script>
<script type="text/javascript" src="lib/prettify/lang-scala.js"></script>
<script type="text/javascript">//<![CDATA[
jQuery(function(){window.prettyPrint && prettyPrint()});
//]]></script>
<script type="text/javascript" src="assets/js/warnOldVersion.js"></script>
<script type="text/javascript">//<![CDATA[
jQuery(function(jq){initOldVersionWarnings(jq, '1.0.0', 'https://doc.akka.io/docs/alpakka/current/')});
//]]></script>


</body>
</html>
