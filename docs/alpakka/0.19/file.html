<!DOCTYPE html>
<html class="no-js" lang="en">

<head>
<title>Files · Alpakka</title>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<meta name="description" content="Alpakka is a Reactive Enterprise Integration library for Java and Scala, based on Reactive Streams and Akka."/><link rel="canonical" href="https://doc.akka.io/docs/alpakka/current/file.html"/>
<link href="https://fonts.googleapis.com/css?family=Roboto:100normal,100italic,300normal,300italic,400normal,400italic,500normal,500italic,700normal,700italic,900normal,900italicc" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="lib/jquery/jquery.min.js"></script>
<script type="text/javascript" src="js/page.js"></script>
<script type="text/javascript" src="js/groups.js"></script>
<link rel="stylesheet" type="text/css" href="lib/normalize.css/normalize.css"/>
<link rel="stylesheet" type="text/css" href="lib/foundation/dist/foundation.min.css"/>
<link rel="stylesheet" type="text/css" href="css/page.css"/>

<!--
<link rel="shortcut icon" href="images/favicon.ico" />
-->
</head>

<body>
<div class="off-canvas-wrapper">
<div class="off-canvas-wrapper-inner" data-off-canvas-wrapper>

<div class="off-canvas position-left" id="off-canvas-menu" data-off-canvas>
<nav class="off-canvas-nav">
<div class="nav-home">
<a href="index.html" >
<span class="home-icon">⌂</span>Alpakka
</a>
<div class="version-number">
0.19
</div>
</div>
<select class="supergroup" name="Language"><option class="group" value="group-scala">Scala</option><option class="group" value="group-java">Java</option></select>
<div class="nav-toc">
<ul>
  <li><a href="connectors.html" class="page">Connectors</a>
  <ul>
    <li><a href="amqp.html" class="page">AMQP Connector</a></li>
    <li><a href="external/apache-camel.html" class="page">Apache Camel</a></li>
    <li><a href="geode.html" class="page">Apache Geode connector</a></li>
    <li><a href="solr.html" class="page">Apache Solr Connector</a></li>
    <li><a href="dynamodb.html" class="page">AWS DynamoDB Connector</a></li>
    <li><a href="kinesis.html" class="page">AWS Kinesis Connector</a></li>
    <li><a href="awslambda.html" class="page">AWS Lambda Connector</a></li>
    <li><a href="s3.html" class="page">AWS S3 Connector</a></li>
    <li><a href="sns.html" class="page">AWS SNS Connector</a></li>
    <li><a href="sqs.html" class="page">AWS SQS Connector</a></li>
    <li><a href="external/azure-iot-hub.html" class="page">Azure IoT Hub</a></li>
    <li><a href="azure-storage-queue.html" class="page">Azure Storage Queue Connector</a></li>
    <li><a href="cassandra.html" class="page">Cassandra Connector</a></li>
    <li><a href="elasticsearch.html" class="page">Elasticsearch Connector</a></li>
    <li><a href="external/eventuate.html" class="page">Eventuate</a></li>
    <li><a href="file.html" class="active page">Files</a></li>
    <li><a href="external/fs2.html" class="page">FS2</a></li>
    <li><a href="ftp.html" class="page">FTP Connector</a></li>
    <li><a href="google-cloud-pub-sub.html" class="page">Google Cloud Pub/Sub</a></li>
    <li><a href="google-fcm.html" class="page">Google Firebase Cloud Messaging</a></li>
    <li><a href="hbase.html" class="page">HBase connector</a></li>
    <li><a href="external/http.html" class="page">HTTP</a></li>
    <li><a href="ironmq.html" class="page">IronMq Connector</a></li>
    <li><a href="jms.html" class="page">JMS Connector</a></li>
    <li><a href="kafka.html" class="page">Kafka</a></li>
    <li><a href="mongodb.html" class="page">MongoDB Connector</a></li>
    <li><a href="mqtt.html" class="page">MQTT Connector</a></li>
    <li><a href="orientdb.html" class="page">OrientDB Connector</a></li>
    <li><a href="external/pulsar.html" class="page">Pulsar</a></li>
    <li><a href="sse.html" class="page">Server-sent Events (SSE) Connector</a></li>
    <li><a href="slick.html" class="page">Slick (JDBC) Connector</a></li>
    <li><a href="spring-web.html" class="page">Spring Web</a></li>
    <li><a href="external/tcp.html" class="page">TCP</a></li>
    <li><a href="unix-domain-socket.html" class="page">Unix Domain Socket Connector</a></li>
  </ul></li>
  <li><a href="external-components.html" class="page">External Components</a></li>
  <li><a href="examples/index.html" class="page">Self-contained examples</a>
  <ul>
    <li><a href="examples/jms-samples.html" class="page">JMS examples</a></li>
    <li><a href="examples/ftp-samples.html" class="page">FTP examples</a></li>
    <li><a href="examples/csv-samples.html" class="page">CSV examples</a></li>
    <li><a href="examples/elasticsearch-samples.html" class="page">Elasticsearch examples</a></li>
  </ul></li>
  <li><a href="other-docs/index.html" class="page">Other documentation</a>
  <ul>
    <li><a href="other-docs/webinars-presentations-articles.html" class="page">Webinars, Presentations and Articles</a></li>
    <li><a href="other-docs/snapshots.html" class="page">Snapshots</a></li>
  </ul></li>
  <li><a href="patterns.html" class="page">Integration Patterns</a></li>
  <li><a href="data-transformations/index.html" class="page">Data Transformations</a>
  <ul>
    <li><a href="data-transformations/parsing-lines.html" class="page">Parsing Lines</a></li>
    <li><a href="data-transformations/json.html" class="page">JSON</a></li>
    <li><a href="data-transformations/compression.html" class="page">Compressing/decompressing</a></li>
    <li><a href="data-transformations/csv.html" class="page">Comma-Separated Values - CSV</a></li>
    <li><a href="data-transformations/recordio.html" class="page">RecordIO Framing</a></li>
    <li><a href="data-transformations/xml.html" class="page">Extensible Markup Language - XML</a></li>
  </ul></li>
</ul>
</div>

</nav>
</div>

<div class="off-canvas-content" data-off-canvas-content>

<header class="site-header expanded row">
<div class="small-12 column">
<a href="#" class="off-canvas-toggle hide-for-medium" data-toggle="off-canvas-menu"><svg class="svg-icon svg-icon-menu" version="1.1" id="Menu" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 20 20" enable-background="new 0 0 20 20" xml:space="preserve"> <path class="svg-icon-menu-path" fill="#53CDEC" d="M16.4,9H3.6C3.048,9,3,9.447,3,10c0,0.553,0.048,1,0.6,1H16.4c0.552,0,0.6-0.447,0.6-1C17,9.447,16.952,9,16.4,9z M16.4,13
H3.6C3.048,13,3,13.447,3,14c0,0.553,0.048,1,0.6,1H16.4c0.552,0,0.6-0.447,0.6-1C17,13.447,16.952,13,16.4,13z M3.6,7H16.4
C16.952,7,17,6.553,17,6c0-0.553-0.048-1-0.6-1H3.6C3.048,5,3,5.447,3,6C3,6.553,3.048,7,3.6,7z"/></svg>
</a>
<div class="title"><a href="index.html" class="logo" style="margin-top: 15px;"><svg class="svg-icon svg-icon-logo" style="height: 45px; width: 184px;" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1070 262"><title>akka-stream-alpakka</title><g id="akka-stream-alpakka" class="svg-icon-logo-text" fill="#fff"><path d="M349.6 105.5v-12.2h19.9v58.4c0 7.1 1.7 9.8 6.1 9.8 1.2 0 2.7-.2 4.1-.3v16.1c-2.2.8-5.5 1.3-9.8 1.3-4.8 0-8.6-.8-11.6-2.7-3.7-2.5-6-5.8-6.8-10.1-5.8 8.8-15.4 13.1-28.7 13.1-11.8 0-21.7-4.1-29.9-12.6-8-8.5-12-18.8-12-31.2s4-22.7 12-31c8.1-8.5 18.1-12.6 29.9-12.6 13.6 0 23.7 6 26.8 14zm-5.9 47.9c5-4.8 7.5-11 7.5-18.3s-2.5-13.4-7.5-18.3c-4.8-4.8-11-7.3-18.1-7.3-7.1 0-12.9 2.5-17.8 7.3-4.6 4.8-7 11-7 18.3s2.3 13.4 7 18.3c4.8 4.8 10.6 7.3 17.8 7.3 7.1 0 13.3-2.5 18.1-7.3zM388.5 177v-115.7h19.8v67.6l30.9-35.5h22.8l-32.7 37.4 36.2 46.3h-22.6l-26.4-33.7-8.3 9.3v24.3h-19.7zM470.8 177v-115.7h19.8v67.6l30.9-35.5h22.9l-32.7 37.4 36.2 46.3h-22.6l-26.4-33.7-8.3 9.3v24.3h-19.8zM607.9 105.5v-12.2h19.9v58.4c0 7.1 1.7 9.8 6.1 9.8 1.2 0 2.7-.2 4.1-.3v16.1c-2.2.8-5.5 1.3-9.8 1.3-4.8 0-8.6-.8-11.6-2.7-3.7-2.5-6-5.8-6.8-10.1-5.8 8.8-15.4 13.1-28.7 13.1-11.8 0-21.7-4.1-29.9-12.6-8-8.5-12-18.8-12-31.2s4-22.7 12-31c8.1-8.5 18.1-12.6 29.9-12.6 13.5 0 23.6 6 26.8 14zm-6 47.9c5-4.8 7.5-11 7.5-18.3s-2.5-13.4-7.5-18.3c-4.8-4.8-11-7.3-18.1-7.3-7.1 0-12.9 2.5-17.8 7.3-4.6 4.8-7 11-7 18.3s2.3 13.4 7 18.3c4.8 4.8 10.6 7.3 17.8 7.3 7.1 0 13.3-2.5 18.1-7.3z"/></g><path fill="#0B5567" d="M230.3 212.8c35.9 28.7 58.9-57 1.7-72.8-48-13.3-96.3 9.5-144.7 62.7 0 0 89.4-32.7 143 10.1z"/><path fill="#15A9CE" d="M88.1 202c34.4-35.7 91.6-75.5 144.9-60.8 12.4 3.5 21.2 10.7 26.9 19.3l-50.4-101.7c-7.2-11.5-25.6-9.1-36-.3l-133.2 111.6c-12.1 10.4-12.8 28.9-1.6 40.1 9.9 9.9 25.6 10.8 36.5 2l12.9-10.2z"/></g></svg>
</a></div>

<!--
<a href="https://www.example.com" class="logo show-for-medium">logo</a>
-->
</div>
</header>

<div class="expanded row">

<div class="medium-3 large-2 show-for-medium column">
<nav class="site-nav">
<div class="nav-home">
<a href="index.html" >
<span class="home-icon">⌂</span>Alpakka
</a>
<div class="version-number">
0.19
</div>
</div>
<select class="supergroup" name="Language"><option class="group" value="group-scala">Scala</option><option class="group" value="group-java">Java</option></select>
<div class="nav-toc">
<ul>
  <li><a href="connectors.html" class="page">Connectors</a>
  <ul>
    <li><a href="amqp.html" class="page">AMQP Connector</a></li>
    <li><a href="external/apache-camel.html" class="page">Apache Camel</a></li>
    <li><a href="geode.html" class="page">Apache Geode connector</a></li>
    <li><a href="solr.html" class="page">Apache Solr Connector</a></li>
    <li><a href="dynamodb.html" class="page">AWS DynamoDB Connector</a></li>
    <li><a href="kinesis.html" class="page">AWS Kinesis Connector</a></li>
    <li><a href="awslambda.html" class="page">AWS Lambda Connector</a></li>
    <li><a href="s3.html" class="page">AWS S3 Connector</a></li>
    <li><a href="sns.html" class="page">AWS SNS Connector</a></li>
    <li><a href="sqs.html" class="page">AWS SQS Connector</a></li>
    <li><a href="external/azure-iot-hub.html" class="page">Azure IoT Hub</a></li>
    <li><a href="azure-storage-queue.html" class="page">Azure Storage Queue Connector</a></li>
    <li><a href="cassandra.html" class="page">Cassandra Connector</a></li>
    <li><a href="elasticsearch.html" class="page">Elasticsearch Connector</a></li>
    <li><a href="external/eventuate.html" class="page">Eventuate</a></li>
    <li><a href="file.html" class="active page">Files</a></li>
    <li><a href="external/fs2.html" class="page">FS2</a></li>
    <li><a href="ftp.html" class="page">FTP Connector</a></li>
    <li><a href="google-cloud-pub-sub.html" class="page">Google Cloud Pub/Sub</a></li>
    <li><a href="google-fcm.html" class="page">Google Firebase Cloud Messaging</a></li>
    <li><a href="hbase.html" class="page">HBase connector</a></li>
    <li><a href="external/http.html" class="page">HTTP</a></li>
    <li><a href="ironmq.html" class="page">IronMq Connector</a></li>
    <li><a href="jms.html" class="page">JMS Connector</a></li>
    <li><a href="kafka.html" class="page">Kafka</a></li>
    <li><a href="mongodb.html" class="page">MongoDB Connector</a></li>
    <li><a href="mqtt.html" class="page">MQTT Connector</a></li>
    <li><a href="orientdb.html" class="page">OrientDB Connector</a></li>
    <li><a href="external/pulsar.html" class="page">Pulsar</a></li>
    <li><a href="sse.html" class="page">Server-sent Events (SSE) Connector</a></li>
    <li><a href="slick.html" class="page">Slick (JDBC) Connector</a></li>
    <li><a href="spring-web.html" class="page">Spring Web</a></li>
    <li><a href="external/tcp.html" class="page">TCP</a></li>
    <li><a href="unix-domain-socket.html" class="page">Unix Domain Socket Connector</a></li>
  </ul></li>
  <li><a href="external-components.html" class="page">External Components</a></li>
  <li><a href="examples/index.html" class="page">Self-contained examples</a>
  <ul>
    <li><a href="examples/jms-samples.html" class="page">JMS examples</a></li>
    <li><a href="examples/ftp-samples.html" class="page">FTP examples</a></li>
    <li><a href="examples/csv-samples.html" class="page">CSV examples</a></li>
    <li><a href="examples/elasticsearch-samples.html" class="page">Elasticsearch examples</a></li>
  </ul></li>
  <li><a href="other-docs/index.html" class="page">Other documentation</a>
  <ul>
    <li><a href="other-docs/webinars-presentations-articles.html" class="page">Webinars, Presentations and Articles</a></li>
    <li><a href="other-docs/snapshots.html" class="page">Snapshots</a></li>
  </ul></li>
  <li><a href="patterns.html" class="page">Integration Patterns</a></li>
  <li><a href="data-transformations/index.html" class="page">Data Transformations</a>
  <ul>
    <li><a href="data-transformations/parsing-lines.html" class="page">Parsing Lines</a></li>
    <li><a href="data-transformations/json.html" class="page">JSON</a></li>
    <li><a href="data-transformations/compression.html" class="page">Compressing/decompressing</a></li>
    <li><a href="data-transformations/csv.html" class="page">Comma-Separated Values - CSV</a></li>
    <li><a href="data-transformations/recordio.html" class="page">RecordIO Framing</a></li>
    <li><a href="data-transformations/xml.html" class="page">Extensible Markup Language - XML</a></li>
  </ul></li>
</ul>
</div>

</nav>
</div>

<div class="small-12 medium-9 large-10 column">
<section class="site-content">

<div class="page-header row">
<div class="medium-12 show-for-medium column">
<div class="nav-breadcrumbs">
<ul>
  <li><a href="index.html">Alpakka</a></li>
  <li><a href="connectors.html">Connectors</a></li>
  <li>Files</li>
</ul>
</div>
</div>
</div>

<div class="page-content row">
<div class="small-12 large-9 column" id="docs">
<h1><a href="#files" name="files" class="anchor"><span class="anchor-link"></span></a>Files</h1>
<p>The File connectors provide additional connectors for filesystems complementing the sources and sinks for files already included in core Akka Streams (which can be found in <span class="group-java"><a href="https://doc.akka.io/japi/akka/2.5.12/?akka/stream/javadsl/FileIO$.html">akka.stream.javadsl.FileIO</a></span><span class="group-scala"><a href="https://doc.akka.io/api/akka/2.5.12/akka/stream/scaladsl/FileIO$.html">akka.stream.scaladsl.FileIO</a></span>).</p>
<h3><a href="#reported-issues" name="reported-issues" class="anchor"><span class="anchor-link"></span></a>Reported issues</h3>
<p><a href="https://github.com/akka/alpakka/labels/p%3Afile">Tagged issues at Github</a></p>
<h2><a href="#artifacts" name="artifacts" class="anchor"><span class="anchor-link"></span></a>Artifacts</h2><dl class="dependency"><dt>sbt</dt><dd><pre class="prettyprint"><code class="language-scala">libraryDependencies += "com.lightbend.akka" %% "akka-stream-alpakka-file" % "0.19"</code></pre></dd><dt>Maven</dt><dd><pre class="prettyprint"><code class="language-xml">&lt;dependency&gt;
  &lt;groupId&gt;com.lightbend.akka&lt;/groupId&gt;
  &lt;artifactId&gt;akka-stream-alpakka-file_2.12&lt;/artifactId&gt;
  &lt;version&gt;0.19&lt;/version&gt;
&lt;/dependency&gt;</code></pre></dd><dt>Gradle</dt><dd><pre class="prettyprint"><code class="language-gradle">dependencies {
  compile group: 'com.lightbend.akka', name: 'akka-stream-alpakka-file_2.12', version: '0.19'
}</code></pre></dd></dl>
<h2><a href="#writing-to-and-reading-from-files" name="writing-to-and-reading-from-files" class="anchor"><span class="anchor-link"></span></a>Writing to and reading from files</h2>
<p>Use the <code>FileIO</code> class to create streams reading from or writing to files. It is part part of Akka streams. </p>
<p><a href="https://doc.akka.io/docs/akka/current/stream/stream-io.html#streaming-file-io">Akka Streaming File IO documentation</a></p>
<h2><a href="#tailing-a-file-into-a-stream" name="tailing-a-file-into-a-stream" class="anchor"><span class="anchor-link"></span></a>Tailing a file into a stream</h2>
<p>The <code>FileTailSource</code> starts at a given offset in a file and emits chunks of bytes until reaching the end of the file, it will then poll the file for changes and emit new changes as they are written  to the file (unless there is backpressure).</p>
<p>A very common use case is combining reading bytes with parsing the bytes into lines, therefore <code>FileTailSource</code> contains a few factory methods to create a source that parses the bytes into lines and emits those.</p>
<p>In this sample we simply tail the lines of a file and print them to standard out:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">val fs = FileSystems.getDefault
val lines: Source[String, NotUsed] = scaladsl.FileTailSource.lines(
  path = fs.getPath(path),
  maxLineSize = 8192,
  pollingInterval = 250.millis
)

lines.runForeach(line =&gt; System.out.println(line))</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><code class="language-java">final FileSystem fs = FileSystems.getDefault();
final FiniteDuration pollingInterval = FiniteDuration.create(250, TimeUnit.MILLISECONDS);
final int maxLineSize = 8192;

final Source&lt;String, NotUsed&gt; lines =
  akka.stream.alpakka.file.javadsl.FileTailSource.createLines(fs.getPath(path), maxLineSize, pollingInterval);

lines.runForeach((line) -&gt; System.out.println(line), materializer);</code></pre></dd>
</dl>
<p><span class="group-scala"><a href="https://github.com/akka/alpakka/tree/master/file/src/test/scala/akka/stream/alpakka/file/scaladsl/FileTailSourceSpec.scala#L28-L35">Source on Github</a></span> <span class="group-java"><a href="https://github.com/akka/alpakka/tree/master/file/src/test/java/akka/stream/alpakka/file/javadsl/FileTailSourceTest.java#L135-L142">Source on Github</a></span></p>
<h2><a href="#listing-directory-contents" name="listing-directory-contents" class="anchor"><span class="anchor-link"></span></a>Listing directory contents</h2>
<p><code>Directory.ls(path)</code> lists all files and directories directly in a given directory:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">val source: Source[Path, NotUsed] = Directory.ls(dir)</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><code class="language-java">final Source&lt;Path, NotUsed&gt; source = Directory.ls(dir);</code></pre></dd>
</dl>
<p><code>Directory.walk(path)</code> traverses all subdirectories and lists files and directories depth first:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">val files: Source[Path, NotUsed] = Directory.walk(root)</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><code class="language-java">final Source&lt;Path, NotUsed&gt; source = Directory.walk(root);
final Source&lt;Path, NotUsed&gt; source = Directory.walk(root, 1, FileVisitOption.FOLLOW_LINKS);</code></pre></dd>
</dl>
<p><span class="group-scala"><a href="https://github.com/akka/alpakka/tree/master/file/src/test/scala/akka/stream/alpakka/file/scaladsl/DirectorySpec.scala">Source on Github</a></span> <span class="group-java"><a href="https://github.com/akka/alpakka/tree/master/file/src/test/java/akka/stream/alpakka/file/javadsl/DirectoryTest.java">Source on Github</a></span></p>
<h2><a href="#listening-to-changes-in-a-directory" name="listening-to-changes-in-a-directory" class="anchor"><span class="anchor-link"></span></a>Listening to changes in a directory</h2>
<p>The <code>DirectoryChangesSource</code> will emit elements every time there is a change to a watched directory in the local filesystem, the emitted change concists of the path that was changed and an enumeration describing what kind of change it was.</p>
<p>In this sample we simply print each change to the directory to standard output:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">val fs = FileSystems.getDefault
val changes = DirectoryChangesSource(fs.getPath(path), pollInterval = 1.second, maxBufferSize = 1000)
changes.runForeach {
  case (path, change) =&gt; println(&quot;Path: &quot; + path + &quot;, Change: &quot; + change)
}</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><code class="language-java">final FileSystem fs = FileSystems.getDefault();
final FiniteDuration pollingInterval = FiniteDuration.create(1, TimeUnit.SECONDS);
final int maxBufferSize = 1000;
final Source&lt;Pair&lt;Path, DirectoryChange&gt;, NotUsed&gt; changes =
  DirectoryChangesSource.create(fs.getPath(path), pollingInterval, maxBufferSize);


changes.runForeach((Pair&lt;Path, DirectoryChange&gt; pair) -&gt; {
  final Path changedPath = pair.first();
  final DirectoryChange change = pair.second();
  System.out.println(&quot;Path: &quot; + changedPath + &quot;, Change: &quot; + change);
}, materializer);</code></pre></dd>
</dl>
<p><span class="group-scala"><a href="https://github.com/akka/alpakka/tree/master/file/src/test/scala/akka/stream/alpakka/file/scaladsl/DirectoryChangesSourceSpec.scala#L23-L27">Source on Github</a></span> <span class="group-java"><a href="https://github.com/akka/alpakka/tree/master/file/src/test/java/akka/stream/alpakka/file/javadsl/DirectoryChangesSourceTest.java#L146-L157">Source on Github</a></span></p>
<h2><a href="#rotating-the-file-to-stream-into" name="rotating-the-file-to-stream-into" class="anchor"><span class="anchor-link"></span></a>Rotating the file to stream into</h2>
<p>The <span class="group-scala"><a href="http://developer.lightbend.com/docs/api/alpakka/0.19/akka/stream/alpakka/file/scaladsl/LogRotatorSink$.html">LogRotatatorSink</a></span>  <span class="group-java"><a href="http://developer.lightbend.com/docs/api/alpakka/0.19/akka/stream/alpakka/file/javadsl/LogRotatorSink$.html">LogRotatatorSink</a></span> will create and  write to multiple files.<br/>This sink will takes a function as parameter which returns a  <span class="group-scala"><code>Bytestring =&gt; Option[Path]</code> function</span><span class="group-java"><code>Function&lt;ByteString, Optional&lt;Path&gt;&gt;</code></span>. If the generated function returns a path  the sink will rotate the file output to this new path and the actual <code>ByteString</code> will be  written to this new file too.  With this approach the user can define a custom stateful file generation implementation.</p>
<p>A small snippet for the usage</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">val pathGeneratorFunction: () =&gt; ByteString =&gt; Option[Path] = ???

val completion = Source(Seq(&quot;test1&quot;, &quot;test2&quot;, &quot;test3&quot;, &quot;test4&quot;, &quot;test5&quot;, &quot;test6&quot;).toList)
  .map(ByteString(_))
  .runWith(LogRotatorSink(pathGeneratorFunction))</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><code class="language-java">import akka.stream.alpakka.file.javadsl.LogRotatorSink;

Creator&lt;Function&lt;ByteString, Optional&lt;Path&gt;&gt;&gt; pathGeneratorCreator = ...;

CompletionStage&lt;Done&gt; completion = Source.from(Arrays.asList(&quot;test1&quot;, &quot;test2&quot;, &quot;test3&quot;, &quot;test4&quot;, &quot;test5&quot;, &quot;test6&quot;))
        .map(ByteString::fromString)
        .runWith(LogRotatorSink.createFromFunction(pathGeneratorCreator), materializer);</code></pre></dd>
</dl>
<p><span class="group-scala"><a href="https://github.com/akka/alpakka/tree/master/file/src/test/scala/akka/stream/alpakka/file/scaladsl/LogRotatorSinkSpec.scala#L86-L94">Source on Github</a></span> <span class="group-java"><a href="https://github.com/akka/alpakka/tree/master/file/src/test/java/akka/stream/alpakka/file/javadsl/LogRotatorSinkTest.java#L76-L86">Source on Github</a></span></p>
<h3><a href="#example-size-based-rotation" name="example-size-based-rotation" class="anchor"><span class="anchor-link"></span></a>Example: size-based rotation</h3>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">val fileSizeRotationFunction = () =&gt; {
  val max = 10 * 1024 * 1024
  var size: Long = max
  (element: ByteString) =&gt;
    {
      if (size + element.size &gt; max) {
        val path = Files.createTempFile(&quot;out-&quot;, &quot;.log&quot;)
        size = element.size
        Some(path)
      } else {
        size += element.size
        None
      }
    }
}

val sizeRotatorSink: Sink[ByteString, Future[Done]] =
  LogRotatorSink(fileSizeRotationFunction)</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><code class="language-java">Creator&lt;Function&lt;ByteString, Optional&lt;Path&gt;&gt;&gt; sizeBasedPathGenerator = () -&gt; {
    long max = 10 * 1024 * 1024;
    final long[] size = new long[]{max};
    return (element) -&gt; {
        if (size[0] + element.size() &gt; max) {
            Path path = Files.createTempFile(&quot;out-&quot;, &quot;.log&quot;);
            size[0] = element.size();
            return Optional.of(path);
        } else {
            size[0] += element.size();
            return Optional.empty();
        }
    };
};

Sink&lt;ByteString, CompletionStage&lt;Done&gt;&gt; sizeRotatorSink =
        LogRotatorSink.createFromFunction(sizeBasedPathGenerator);</code></pre></dd>
</dl>
<p><span class="group-scala"><a href="https://github.com/akka/alpakka/tree/master/file/src/test/scala/akka/stream/alpakka/file/scaladsl/LogRotatorSinkSpec.scala#L34-L51">Source on Github</a></span> <span class="group-java"><a href="https://github.com/akka/alpakka/tree/master/file/src/test/java/akka/stream/alpakka/file/javadsl/LogRotatorSinkTest.java#L34-L50">Source on Github</a></span></p>
<h3><a href="#example-time-based-rotation" name="example-time-based-rotation" class="anchor"><span class="anchor-link"></span></a>Example: time-based rotation</h3>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">val destinationDir = FileSystems.getDefault.getPath(&quot;/tmp&quot;)
val formatter = DateTimeFormatter.ofPattern(&quot;&#39;stream-&#39;yyyy-MM-dd_HH&#39;.log&#39;&quot;)

val timeBasedRotationFunction = () =&gt; {
  var currentFilename: Option[String] = None
  (_: ByteString) =&gt;
    {
      val newName = LocalDateTime.now().format(formatter)
      if (currentFilename.contains(newName)) {
        None
      } else {
        currentFilename = Some(newName)
        Some(destinationDir.resolve(newName))
      }
    }
}

val timeBasedSink: Sink[ByteString, Future[Done]] =
  LogRotatorSink(timeBasedRotationFunction)</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><code class="language-java">final Path destinationDir = FileSystems.getDefault().getPath(&quot;/tmp&quot;);
final DateTimeFormatter formatter = DateTimeFormatter.ofPattern(&quot;&#39;stream-&#39;yyyy-MM-dd_HH&#39;.log&#39;&quot;);

Creator&lt;Function&lt;ByteString, Optional&lt;Path&gt;&gt;&gt; timeBasedPathCreator = () -&gt; {
    final String[] currentFileName = new String[]{null};
    return (element) -&gt; {
        String newName = LocalDateTime.now().format(formatter);
        if (newName.equals(currentFileName[0])) {
            return Optional.empty();
        } else {
            currentFileName[0] = newName;
            return Optional.of(destinationDir.resolve(newName));
        }
    };
};

Sink&lt;ByteString, CompletionStage&lt;Done&gt;&gt; timeBaseSink =
        LogRotatorSink.createFromFunction(timeBasedPathCreator);</code></pre></dd>
</dl>
<p><span class="group-scala"><a href="https://github.com/akka/alpakka/tree/master/file/src/test/scala/akka/stream/alpakka/file/scaladsl/LogRotatorSinkSpec.scala#L59-L77">Source on Github</a></span> <span class="group-java"><a href="https://github.com/akka/alpakka/tree/master/file/src/test/java/akka/stream/alpakka/file/javadsl/LogRotatorSinkTest.java#L54-L71">Source on Github</a></span></p>
<h3><a href="#running-the-example-code" name="running-the-example-code" class="anchor"><span class="anchor-link"></span></a>Running the example code</h3>
<p>Both the samples are contained in standalone runnable mains, they can be run  from <code>sbt</code> like this:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre><code>sbt
// tail source
&gt; akka-stream-alpakka-file/test:runMain akka.stream.alpakka.file.scaladsl.FileTailSourceSpec /some/path/toa/file
// or directory changes
&gt; akka-stream-alpakka-file/test:runMain akka.stream.alpakka.file.scaladsl.DirectoryChangesSourceSpec /some/directory/path
// File rotator
&gt; akka-stream-alpakka-file/test:runMain akka.stream.alpakka.file.scaladsl.LogRotatorSinkTest
</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre><code>sbt
// tail source
&gt; akka-stream-alpakka-file/test:runMain akka.stream.alpakka.file.javadsl.FileTailSourceTest /some/path/toa/file
// or directory changes
&gt; akka-stream-alpakka-file/test:runMain akka.stream.alpakka.file.javadsl.DirectoryChangesSourceTest /some/directory/path
// File rotator
&gt; akka-stream-alpakka-file/test:runMain akka.stream.alpakka.file.javadsl.LogRotatorSinkTest
</code></pre></dd>
</dl>
<div class="source-github">
The source code for this page can be found <a href="https://github.com/akka/alpakka/tree/master/docs/src/main/paradox/file.md">here</a>.
</div>

<div class="nav-next">
<p><strong>Next:</strong> <a href="external/fs2.html">FS2</a></p>
</div>
</div>
<div class="large-3 show-for-large column" data-sticky-container>
<nav class="sidebar sticky" data-sticky data-anchor="docs" data-sticky-on="large">
<div class="page-nav">
<div class="nav-title">On this page:</div>
<div class="nav-toc">
<ul>
  <li><a href="file.html#files" class="header">Files</a>
  <ul>
    <li><a href="file.html#reported-issues" class="header">Reported issues</a></li>
    <li><a href="file.html#artifacts" class="header">Artifacts</a></li>
    <li><a href="file.html#writing-to-and-reading-from-files" class="header">Writing to and reading from files</a></li>
    <li><a href="file.html#tailing-a-file-into-a-stream" class="header">Tailing a file into a stream</a></li>
    <li><a href="file.html#listing-directory-contents" class="header">Listing directory contents</a></li>
    <li><a href="file.html#listening-to-changes-in-a-directory" class="header">Listening to changes in a directory</a></li>
    <li><a href="file.html#rotating-the-file-to-stream-into" class="header">Rotating the file to stream into</a></li>
  </ul></li>
</ul>
</div>
</div>
</nav>
</div>
</div>

</section>
</div>

</div>

<footer class="site-footer">

<section class="site-footer-nav">
<div class="expanded row">
<div class="small-12 large-offset-2 large-10 column">
<div class="row site-footer-content">

<div class="small-12 medium-4 large-3 text-center column">
<div class="nav-links">
<ul>
<!-- <li><a href="https://www.example.com/products/">Products</a> -->
</ul>
</div>
</div>

</div>
</div>
</div>
</section>

<section class="site-footer-base">
<div class="expanded row">
<div class="small-12 large-offset-2 large-10 column">
<div class="row site-footer-content">

<div class="small-12 text-center large-9 column">

<!--
<div class="copyright">
<span class="text">&copy; 2019</span>
<a href="https://www.example.com" class="logo">logo</a>
</div>
-->
</div>

</div>
</div>
</div>
</section>
</footer>

</div>
</div>
</div>
</body>

<script type="text/javascript" src="lib/foundation/dist/foundation.min.js"></script>
<script type="text/javascript">jQuery(document).foundation();</script>
<script type="text/javascript" src="js/magellan.js"></script>

<style type="text/css">@import "lib/prettify/prettify.css";</style>
<script type="text/javascript" src="lib/prettify/prettify.js"></script>
<script type="text/javascript" src="lib/prettify/lang-scala.js"></script>
<script type="text/javascript">jQuery(function(){window.prettyPrint && prettyPrint()});</script>

</html>
