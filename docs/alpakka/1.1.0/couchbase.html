<!DOCTYPE html>
<html class="no-js" lang="en">

<head>
<title>Couchbase &bull; Alpakka Documentation</title>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<meta name="description" content="Alpakka is a Reactive Enterprise Integration library for Java and Scala, based on Reactive Streams and Akka."/>
<link rel="canonical" href="https://doc.akka.io/docs/alpakka/current//couchbase.html"/>
<script type="text/javascript" src="lib/jquery/jquery.min.js"></script>
<script type="text/javascript" src="lib/foundation/dist/js/foundation.min.js"></script>
<link rel="stylesheet" type="text/css" href="lib/normalize.css/normalize.css"/>
<link rel="stylesheet" type="text/css" href="lib/foundation/dist/css/foundation.min.css"/>
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.css" />
<link rel="stylesheet" type="text/css" href="css/icons.css"/>
<link rel="stylesheet" type="text/css" href="css/page.css"/>
<link rel="shortcut icon" href="images/favicon.ico" />
<link rel="apple-touch-icon" sizes="180x180" href="images/apple-touch-icon.png"/>
<link rel="icon" type="image/png" sizes="32x32" href="images/favicon-32x32.png"/>
<link rel="icon" type="image/png" sizes="16x16" href="images/favicon-16x16.png"/>
<link rel="manifest" href="images/manifest.json"/>
<meta name="msapplication-TileImage" content="images/mstile-150x150.png"/>
<meta name="msapplication-TileColor" content="#15a9ce"/>
<meta name="theme-color" content="#15a9ce"/>
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>
<!-- OneTrust Cookies Consent Notice (Production Standard, akka.io, en-GB) start -->
<script src="https://optanon.blob.core.windows.net/consent/159bb13d-6748-4399-806e-ac28db879785.js" type="text/javascript" charset="UTF-8"></script>
<script type="text/javascript">
function OptanonWrapper() { }
</script>
<!-- OneTrust Cookies Consent Notice (Production Standard, akka.io, en-GB) end -->
<!--Google Analytics-->
<script type="text/plain" class="optanon-category-2">
var _gaq = _gaq || [];
_gaq.push(['_setAccount', '']);
_gaq.push(['_setDomainName', '']);
_gaq.push(['_trackPageview']);
(function() {
var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})()
</script>
<script type="text/plain" class="optanon-category-2">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-23127719-1', 'lightbend.com', {'allowLinker': true, 'name': 'tsTracker'});
ga('tsTracker.require', 'linker');
ga('tsTracker.linker:autoLink', ['lightbend.com','playframework.com','scala-lang.org','scaladays.org','spray.io','akka.io','scala-sbt.org','scala-ide.org']);
ga('tsTracker.send', 'pageview');
</script>
<!--Marketo-->
<script type="text/plain" class="optanon-category-3">
(function() {
var didInit = false;
function initMunchkin() {
if(didInit === false) {
didInit = true;
Munchkin.init('558-NCX-702', { 'asyncOnly': true, 'disableClickDelay': true });
}
}
var s = document.createElement('script');
s.type = 'text/javascript';
s.async = true;
s.src = '//munchkin.marketo.net/munchkin.js';
s.onreadystatechange = function() {
if (this.readyState == 'complete' || this.readyState == 'loaded') {
initMunchkin();
}
};
s.onload = initMunchkin;
document.getElementsByTagName('head')[0].appendChild(s);
})();
</script>
</head>

<body id="underlay" data-toggler="nav-open">

<header class="site-header hide-for-large">
<div class="sticky-header clearfix">
<a href="http://akka.io"><img class="logo" src="images/akka-alpakka-reverse.svg"/></a>

<button class="menu-icon float-right" type="button" data-toggle="underlay overlay"></button>
</div>
<div id="overlay" class="overlay-nav" data-toggler="nav-open">
<header class="nav-header">
<div class="nav-header-title">
<h1><a href="index.html">Alpakka Documentation</a></h1>
</div>
<div class="nav-header-version">
Version 1.1.0
</div>
<div class="nav-header-groups">
<select class="supergroup" name="Language"><option class="group" value="group-java">Java</option><option class="group" value="group-scala">Scala</option></select>
</div>
</header>
<nav class="nav-toc">
<ul>
  <li><a href="overview.html" class="page">Overview</a></li>
  <li><a href="data-transformations/index.html" class="page">Data Transformations</a></li>
  <li><a href="amqp.html" class="page">AMQP</a></li>
  <li><a href="external/apache-camel.html" class="page">Apache Camel</a></li>
  <li><a href="cassandra.html" class="page">Apache Cassandra</a></li>
  <li><a href="geode.html" class="page">Apache Geode</a></li>
  <li><a href="kafka.html" class="page">Apache Kafka</a></li>
  <li><a href="kudu.html" class="page">Apache Kudu</a></li>
  <li><a href="solr.html" class="page">Apache Solr</a></li>
  <li><a href="avroparquet.html" class="page">Avro Parquet</a></li>
  <li><a href="dynamodb.html" class="page">AWS DynamoDB</a></li>
  <li><a href="kinesis.html" class="page">AWS Kinesis</a></li>
  <li><a href="awslambda.html" class="page">AWS Lambda</a></li>
  <li><a href="s3.html" class="page">AWS S3</a></li>
  <li><a href="sns.html" class="page">AWS SNS</a></li>
  <li><a href="sqs.html" class="page">AWS SQS</a></li>
  <li><a href="external/azure-event-hubs.html" class="page">Azure Event Hubs</a></li>
  <li><a href="external/azure-iot-hub.html" class="page">Azure IoT Hub</a></li>
  <li><a href="azure-storage-queue.html" class="page">Azure Storage Queue</a></li>
  <li><a href="couchbase.html#couchbase" class="active page">Couchbase</a>
  <ul>
    <li><a href="couchbase.html#artifacts" class="header">Artifacts</a></li>
    <li><a href="couchbase.html#overview" class="header">Overview</a></li>
    <li><a href="couchbase.html#reading-from-couchbase-in-akka-streams" class="header">Reading from Couchbase in Akka Streams</a></li>
    <li><a href="couchbase.html#writing-to-couchbase-in-akka-streams" class="header">Writing to Couchbase in Akka Streams</a></li>
    <li><a href="couchbase.html#using-couchbasesession-directly" class="header">Using <code>CouchbaseSession</code> directly</a></li>
  </ul></li>
  <li><a href="elasticsearch.html" class="page">Elasticsearch</a></li>
  <li><a href="external/eventuate.html" class="page">Eventuate</a></li>
  <li><a href="file.html" class="page">File</a></li>
  <li><a href="external/fs2.html" class="page">FS2</a></li>
  <li><a href="ftp.html" class="page">FTP</a></li>
  <li><a href="google-cloud-pub-sub.html" class="page">Google Cloud Pub/Sub</a></li>
  <li><a href="google-cloud-pub-sub-grpc.html" class="page">Google Cloud Pub/Sub gRPC</a></li>
  <li><a href="google-cloud-storage.html" class="page">Google Cloud Storage</a></li>
  <li><a href="google-fcm.html" class="page">Google FCM</a></li>
  <li><a href="external/grpc.html" class="page">gRPC</a></li>
  <li><a href="hdfs.html" class="page">Hadoop Distributed File System - HDFS</a></li>
  <li><a href="hbase.html" class="page">HBase</a></li>
  <li><a href="external/http.html" class="page">HTTP</a></li>
  <li><a href="bluemix-cos.html" class="page">IBM Bluemix Cloud Object Storage</a></li>
  <li><a href="external/db2-event-store.html" class="page">IBM Db2 Event Store</a></li>
  <li><a href="influxdb.html" class="page">InfluxDB</a></li>
  <li><a href="ironmq.html" class="page">IronMQ</a></li>
  <li><a href="jms/index.html" class="page">JMS</a></li>
  <li><a href="mongodb.html" class="page">MongoDB</a></li>
  <li><a href="mqtt.html" class="page">MQTT</a></li>
  <li><a href="mqtt-streaming.html" class="page">MQTT Streaming</a></li>
  <li><a href="orientdb.html" class="page">OrientDB</a></li>
  <li><a href="external/pulsar.html" class="page">Pulsar</a></li>
  <li><a href="sse.html" class="page">Server-sent Events (SSE)</a></li>
  <li><a href="slick.html" class="page">Slick (JDBC)</a></li>
  <li><a href="spring-web.html" class="page">Spring Web</a></li>
  <li><a href="external/tcp.html" class="page">TCP</a></li>
  <li><a href="udp.html" class="page">UDP</a></li>
  <li><a href="unix-domain-socket.html" class="page">Unix Domain Socket</a></li>
</ul>
</nav>
</div>
</header>

<aside class="show-for-large">
<header class="nav-header fixed-sidebar-header">
<div class="nav-header-title">
<h1><a href="index.html">Alpakka Documentation</a></h1>
</div>
<div class="nav-header-version">
Version 1.1.0
</div>
<div class="nav-header-groups">
<select class="supergroup" name="Language"><option class="group" value="group-java">Java</option><option class="group" value="group-scala">Scala</option></select>
</div>
</header>
<nav class="site-nav fixed-sidebar-contents">
<div class="nav-toc">
<ul>
  <li><a href="overview.html" class="page">Overview</a></li>
  <li><a href="data-transformations/index.html" class="page">Data Transformations</a></li>
  <li><a href="amqp.html" class="page">AMQP</a></li>
  <li><a href="external/apache-camel.html" class="page">Apache Camel</a></li>
  <li><a href="cassandra.html" class="page">Apache Cassandra</a></li>
  <li><a href="geode.html" class="page">Apache Geode</a></li>
  <li><a href="kafka.html" class="page">Apache Kafka</a></li>
  <li><a href="kudu.html" class="page">Apache Kudu</a></li>
  <li><a href="solr.html" class="page">Apache Solr</a></li>
  <li><a href="avroparquet.html" class="page">Avro Parquet</a></li>
  <li><a href="dynamodb.html" class="page">AWS DynamoDB</a></li>
  <li><a href="kinesis.html" class="page">AWS Kinesis</a></li>
  <li><a href="awslambda.html" class="page">AWS Lambda</a></li>
  <li><a href="s3.html" class="page">AWS S3</a></li>
  <li><a href="sns.html" class="page">AWS SNS</a></li>
  <li><a href="sqs.html" class="page">AWS SQS</a></li>
  <li><a href="external/azure-event-hubs.html" class="page">Azure Event Hubs</a></li>
  <li><a href="external/azure-iot-hub.html" class="page">Azure IoT Hub</a></li>
  <li><a href="azure-storage-queue.html" class="page">Azure Storage Queue</a></li>
  <li><a href="couchbase.html#couchbase" class="active page">Couchbase</a>
  <ul>
    <li><a href="couchbase.html#artifacts" class="header">Artifacts</a></li>
    <li><a href="couchbase.html#overview" class="header">Overview</a></li>
    <li><a href="couchbase.html#reading-from-couchbase-in-akka-streams" class="header">Reading from Couchbase in Akka Streams</a></li>
    <li><a href="couchbase.html#writing-to-couchbase-in-akka-streams" class="header">Writing to Couchbase in Akka Streams</a></li>
    <li><a href="couchbase.html#using-couchbasesession-directly" class="header">Using <code>CouchbaseSession</code> directly</a></li>
  </ul></li>
  <li><a href="elasticsearch.html" class="page">Elasticsearch</a></li>
  <li><a href="external/eventuate.html" class="page">Eventuate</a></li>
  <li><a href="file.html" class="page">File</a></li>
  <li><a href="external/fs2.html" class="page">FS2</a></li>
  <li><a href="ftp.html" class="page">FTP</a></li>
  <li><a href="google-cloud-pub-sub.html" class="page">Google Cloud Pub/Sub</a></li>
  <li><a href="google-cloud-pub-sub-grpc.html" class="page">Google Cloud Pub/Sub gRPC</a></li>
  <li><a href="google-cloud-storage.html" class="page">Google Cloud Storage</a></li>
  <li><a href="google-fcm.html" class="page">Google FCM</a></li>
  <li><a href="external/grpc.html" class="page">gRPC</a></li>
  <li><a href="hdfs.html" class="page">Hadoop Distributed File System - HDFS</a></li>
  <li><a href="hbase.html" class="page">HBase</a></li>
  <li><a href="external/http.html" class="page">HTTP</a></li>
  <li><a href="bluemix-cos.html" class="page">IBM Bluemix Cloud Object Storage</a></li>
  <li><a href="external/db2-event-store.html" class="page">IBM Db2 Event Store</a></li>
  <li><a href="influxdb.html" class="page">InfluxDB</a></li>
  <li><a href="ironmq.html" class="page">IronMQ</a></li>
  <li><a href="jms/index.html" class="page">JMS</a></li>
  <li><a href="mongodb.html" class="page">MongoDB</a></li>
  <li><a href="mqtt.html" class="page">MQTT</a></li>
  <li><a href="mqtt-streaming.html" class="page">MQTT Streaming</a></li>
  <li><a href="orientdb.html" class="page">OrientDB</a></li>
  <li><a href="external/pulsar.html" class="page">Pulsar</a></li>
  <li><a href="sse.html" class="page">Server-sent Events (SSE)</a></li>
  <li><a href="slick.html" class="page">Slick (JDBC)</a></li>
  <li><a href="spring-web.html" class="page">Spring Web</a></li>
  <li><a href="external/tcp.html" class="page">TCP</a></li>
  <li><a href="udp.html" class="page">UDP</a></li>
  <li><a href="unix-domain-socket.html" class="page">Unix Domain Socket</a></li>
</ul>
</div>
</nav>
<footer class="nav-footer fixed-sidebar-footer">
<a href="http://akka.io"><img class="logo" src="images/akka-alpakka-reverse.svg"/></a>

</footer>
</aside>

<main class="fixed-shift-for-large expanded row">
<section class="site-content small-12 column">

<article class="page-content row">
<div class="small-12 large-9 column" id="docs">
<h1><a href="#couchbase" name="couchbase" class="anchor"><span class="anchor-link"></span></a>Couchbase</h1><div class="callout note "><div class="callout-title">Couchbase</div>
<p>Couchbase is an open-source, distributed (shared-nothing architecture) multi-model NoSQL document-oriented database software package that is optimized for interactive applications. These applications may serve many concurrent users by creating, storing, retrieving, aggregating, manipulating and presenting data. In support of these kinds of application needs, Couchbase Server is designed to provide easy-to-scale key-value or JSON document access with low latency and high sustained throughput. It is designed to be clustered from a single machine to very large-scale deployments spanning many machines. </p>
<p>Couchbase provides client protocol compatibility with memcached, but adds disk persistence, data replication, live cluster reconfiguration, rebalancing and multitenancy with data partitioning. </p>
<p>&ndash; <a href="https://en.wikipedia.org/wiki/Couchbase_Server">Wikipedia</a></p></div>
<p>Alpakka Couchbase allows you to read and write to Couchbase. You can query a bucket from CouchbaseSource using N1QL queries or reading by document ID. Couchbase connector uses <a href="https://docs.couchbase.com/java-sdk/2.7/start-using-sdk.html">Couchbase Java SDK</a> version 2.7.2 behind the scenes.</p>
<p>The Couchbase connector supports all document formats which are supported by the SDK. All those formats use the <span class="group-java"><code>Document&lt;T&gt;</code></span><span class="group-scala"><code>Document[T]</code></span> interface and this is the level of abstraction that this connector is using.</p>
<table class="project-info">
<tr><th colspan="2">Project Info: Alpakka Couchbase</th></tr>
  <tr><th>Artifact</th><td><div>com.lightbend.akka</div>
  <div>akka-stream-alpakka-couchbase</div>
  <div>1.1.0</div>
  <div><a href="other-docs/snapshots.html">Snapshots are available</a></div>
  </td></tr>
  <tr><th>JDK versions</th><td><div>OpenJDK 8</div></td></tr>
  <tr><th>Scala versions</th><td>2.12.7, 2.11.12, 2.13.0</td></tr>
  <tr><th>JPMS module name</th><td>akka.stream.alpakka.couchbase</td></tr>
  <tr><th>License</th><td><div><a href="http://www.apache.org/licenses/LICENSE-2.0" target="_blank" rel="noopener noreferrer">Apache-2.0</a></div>
  </td></tr>
  <tr><th>Readiness level</th><td><div class="readiness-level"><a href="https://developer.lightbend.com/docs/reactive-platform/2.0/support-terminology/index.html#supported" target="_blank" rel="noopener noreferrer">Supported</a>, <a href="https://www.lightbend.com/subscription" target="_blank">Lightbend Subscription</a> provides support</div>
  <div>Since 1.0.0, 2019-04-04</div>
  </td></tr>
  <tr><th>Home page</th><td><a href="https://doc.akka.io/docs/alpakka/current/">https://doc.akka.io/docs/alpakka/current/</a></td></tr>
  <tr><th>API documentation</th><td>
  <div><a href="https://doc.akka.io/api/alpakka/1.1.0/akka/stream/alpakka/couchbase/index.html" target="_blank" rel="noopener noreferrer">API (Scaladoc)</a></div>
  </td></tr>
  <tr><th>Forums</th><td>
  <div><a href="https://discuss.lightbend.com/c/akka/" target="_blank" rel="noopener noreferrer">Lightbend Discuss</a></div>
  <div><a href="https://gitter.im/akka/akka" target="_blank" rel="noopener noreferrer">akka/akka Gitter channel</a></div>
  </td></tr>
  <tr><th>Release notes</th><td><a href="https://doc.akka.io/docs/alpakka/current/release-notes/index.html">In the documentation</a></td></tr>
  <tr><th>Issues</th><td><a href="https://github.com/akka/alpakka/labels/p%3Acouchbase" target="_blank" rel="noopener noreferrer">Github issues</a></td></tr>
  <tr><th>Sources</th><td><a href="https://github.com/akka/alpakka" target="_blank" rel="noopener noreferrer">https://github.com/akka/alpakka</a></td></tr>
</table>

<h2><a href="#artifacts" name="artifacts" class="anchor"><span class="anchor-link"></span></a>Artifacts</h2>
<dl class="dependency"><dt>sbt</dt><dd><pre class="prettyprint"><code class="language-scala">libraryDependencies += "com.lightbend.akka" %% "akka-stream-alpakka-couchbase" % "1.1.0"</code></pre></dd><dt>Maven</dt><dd><pre class="prettyprint"><code class="language-xml">&lt;dependency&gt;
  &lt;groupId&gt;com.lightbend.akka&lt;/groupId&gt;
  &lt;artifactId&gt;akka-stream-alpakka-couchbase_2.12&lt;/artifactId&gt;
  &lt;version&gt;1.1.0&lt;/version&gt;
&lt;/dependency&gt;</code></pre></dd><dt>Gradle</dt><dd><pre class="prettyprint"><code class="language-gradle">dependencies {
  compile group: 'com.lightbend.akka', name: 'akka-stream-alpakka-couchbase_2.12', version: '1.1.0'
}</code></pre></dd></dl>
<p>The table below shows direct dependencies of this module and the second tab shows all libraries it depends on transitively.</p>
<dl class="dependencies"><dt>Direct dependencies</dt><dd><table>
  <thead><tr><th>Organization</th><th>Artifact</th><th>Version</th><th>License</th></tr></thead>
  <tbody>
    <tr><td>com.couchbase.client</td><td>java-client</td><td><a href="https://mvnrepository.com/artifact/com.couchbase.client/java-client/2.7.2" target="_blank">2.7.2</a></td><td>The Apache Software License, Version 2.0</td></tr>
    <tr><td>com.typesafe.akka</td><td>akka-stream_2.12</td><td><a href="https://mvnrepository.com/artifact/com.typesafe.akka/akka-stream_2.12/2.5.23" target="_blank">2.5.23</a></td><td>Apache License, Version 2.0</td></tr>
    <tr><td>io.reactivex</td><td>rxjava-reactive-streams</td><td><a href="https://mvnrepository.com/artifact/io.reactivex/rxjava-reactive-streams/1.2.1" target="_blank">1.2.1</a></td><td>The Apache Software License, Version 2.0</td></tr>
    <tr><td>org.scala-lang</td><td>scala-library</td><td><a href="https://mvnrepository.com/artifact/org.scala-lang/scala-library/2.12.7" target="_blank">2.12.7</a></td><td>BSD 3-Clause</td></tr>
  </tbody>
</table></dd>
<dt>Dependency tree</dt><dd><pre>
com.couchbase.client    java-client    <a href="https://mvnrepository.com/artifact/com.couchbase.client/java-client/2.7.2" target="_blank">2.7.2</a>    The Apache Software License, Version 2.0
    com.couchbase.client    core-io    <a href="https://mvnrepository.com/artifact/com.couchbase.client/core-io/1.7.2" target="_blank">1.7.2</a>    The Apache Software License, Version 2.0
        io.opentracing    opentracing-api    <a href="https://mvnrepository.com/artifact/io.opentracing/opentracing-api/0.31.0" target="_blank">0.31.0</a>    The Apache Software License, Version 2.0
        io.reactivex    rxjava    <a href="https://mvnrepository.com/artifact/io.reactivex/rxjava/1.3.8" target="_blank">1.3.8</a>    The Apache Software License, Version 2.0
com.typesafe.akka    akka-stream_2.12    <a href="https://mvnrepository.com/artifact/com.typesafe.akka/akka-stream_2.12/2.5.23" target="_blank">2.5.23</a>    Apache License, Version 2.0
    com.typesafe.akka    akka-actor_2.12    <a href="https://mvnrepository.com/artifact/com.typesafe.akka/akka-actor_2.12/2.5.23" target="_blank">2.5.23</a>    Apache License, Version 2.0
        com.typesafe    config    <a href="https://mvnrepository.com/artifact/com.typesafe/config/1.3.3" target="_blank">1.3.3</a>    Apache License, Version 2.0
        org.scala-lang.modules    scala-java8-compat_2.12    <a href="https://mvnrepository.com/artifact/org.scala-lang.modules/scala-java8-compat_2.12/0.8.0" target="_blank">0.8.0</a>    BSD 3-clause
            org.scala-lang    scala-library    <a href="https://mvnrepository.com/artifact/org.scala-lang/scala-library/2.12.7" target="_blank">2.12.7</a>    BSD 3-Clause
        org.scala-lang    scala-library    <a href="https://mvnrepository.com/artifact/org.scala-lang/scala-library/2.12.7" target="_blank">2.12.7</a>    BSD 3-Clause
    com.typesafe.akka    akka-protobuf_2.12    <a href="https://mvnrepository.com/artifact/com.typesafe.akka/akka-protobuf_2.12/2.5.23" target="_blank">2.5.23</a>    Apache License, Version 2.0
        org.scala-lang    scala-library    <a href="https://mvnrepository.com/artifact/org.scala-lang/scala-library/2.12.7" target="_blank">2.12.7</a>    BSD 3-Clause
    com.typesafe    ssl-config-core_2.12    <a href="https://mvnrepository.com/artifact/com.typesafe/ssl-config-core_2.12/0.3.7" target="_blank">0.3.7</a>    Apache-2.0
        com.typesafe    config    <a href="https://mvnrepository.com/artifact/com.typesafe/config/1.3.3" target="_blank">1.3.3</a>    Apache License, Version 2.0
        org.scala-lang.modules    scala-parser-combinators_2.12    <a href="https://mvnrepository.com/artifact/org.scala-lang.modules/scala-parser-combinators_2.12/1.1.1" target="_blank">1.1.1</a>    BSD 3-clause
            org.scala-lang    scala-library    <a href="https://mvnrepository.com/artifact/org.scala-lang/scala-library/2.12.7" target="_blank">2.12.7</a>    BSD 3-Clause
        org.scala-lang    scala-library    <a href="https://mvnrepository.com/artifact/org.scala-lang/scala-library/2.12.7" target="_blank">2.12.7</a>    BSD 3-Clause
    org.reactivestreams    reactive-streams    <a href="https://mvnrepository.com/artifact/org.reactivestreams/reactive-streams/1.0.2" target="_blank">1.0.2</a>    CC0
    org.scala-lang    scala-library    <a href="https://mvnrepository.com/artifact/org.scala-lang/scala-library/2.12.7" target="_blank">2.12.7</a>    BSD 3-Clause
io.reactivex    rxjava-reactive-streams    <a href="https://mvnrepository.com/artifact/io.reactivex/rxjava-reactive-streams/1.2.1" target="_blank">1.2.1</a>    The Apache Software License, Version 2.0
    io.reactivex    rxjava    <a href="https://mvnrepository.com/artifact/io.reactivex/rxjava/1.3.8" target="_blank">1.3.8</a>    The Apache Software License, Version 2.0
    org.reactivestreams    reactive-streams    <a href="https://mvnrepository.com/artifact/org.reactivestreams/reactive-streams/1.0.2" target="_blank">1.0.2</a>    CC0
org.scala-lang    scala-library    <a href="https://mvnrepository.com/artifact/org.scala-lang/scala-library/2.12.7" target="_blank">2.12.7</a>    BSD 3-Clause</pre></dd>
</dl>

<h1><a href="#overview" name="overview" class="anchor"><span class="anchor-link"></span></a>Overview</h1>

<p>Alpakka Couchbase offers both <a href="couchbase.html#reading-from-couchbase-in-akka-streams">Akka Streams APIs</a> and a more <a href="couchbase.html#using-couchbasesession-directly">direct API</a> to access Couchbase:</p>

<ul>
  <li><code>CouchbaseSession</code> (<span class="group-scala"><a href="/api/alpakka/1.1.0/akka/stream/alpakka/couchbase/scaladsl/CouchbaseSession.html">API</a></span><span class="group-java"><a href="/api/alpakka/1.1.0/akka/stream/alpakka/couchbase/javadsl/CouchbaseSession.html">API</a></span>) offers a direct API for one-off operations</li>
  <li><code>CouchbaseSessionRegistry</code> (<a href="/api/alpakka/1.1.0/akka/stream/alpakka/couchbase/CouchbaseSessionRegistry$.html">API</a>) is an Akka extension to keep track and share <code>CouchbaseSession</code>s within an <code>ActorSystem</code></li>
  <li><code>CouchbaseSource</code> (<span class="group-scala"><a href="/api/alpakka/1.1.0/akka/stream/alpakka/couchbase/scaladsl/CouchbaseSource$.html">API</a></span><span class="group-java"><a href="/api/alpakka/1.1.0/akka/stream/alpakka/couchbase/javadsl/CouchbaseSource$.html">API</a></span>), <code>CouchbaseFlow</code> (<span class="group-scala"><a href="/api/alpakka/1.1.0/akka/stream/alpakka/couchbase/scaladsl/CouchbaseFlow$.html">API</a></span><span class="group-java"><a href="/api/alpakka/1.1.0/akka/stream/alpakka/couchbase/javadsl/CouchbaseFlow$.html">API</a></span>), and <code>CouchbaseSink</code> (<span class="group-scala"><a href="/api/alpakka/1.1.0/akka/stream/alpakka/couchbase/scaladsl/CouchbaseSink$.html">API</a></span><span class="group-java"><a href="/api/alpakka/1.1.0/akka/stream/alpakka/couchbase/javadsl/CouchbaseSink$.html">API</a></span>) offer factory methods to create Akka Stream operators</li>
</ul>
<h2><a href="#configuration" name="configuration" class="anchor"><span class="anchor-link"></span></a>Configuration</h2>
<p>All operations use the <code>CouchbaseSession</code> internally. A session is configured with <code>CouchbaseSessionSettings</code> (<a href="/api/alpakka/1.1.0/akka/stream/alpakka/couchbase/CouchbaseSessionSettings$.html">API</a>) and a Couchbase bucket name. The Akka Stream factory methods create and access the corresponding session instance behind the scenes.</p>
<p>By default the <code>CouchbaseSessionSettings</code> are read from the <code>alpakka.couchbase.session</code> section from the configuration eg. in your <code>application.conf</code>.</p>
<dl>
  <dt>Settings</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/alpakka/tree/v1.1.0/couchbase/src/test/resources/application.conf#L8-L14" target="_blank" title="Go to snippet source"></a><code class="language-conf">alpakka.couchbase {
  session {
    nodes = [&quot;localhost&quot;]
    username = &quot;Administrator&quot;
    password = &quot;password&quot;
  }
}</code></pre></dd>
</dl>
<h2><a href="#using-akka-discovery" name="using-akka-discovery" class="anchor"><span class="anchor-link"></span></a>Using Akka Discovery</h2>
<p>To delegate the configuration of Couchbase nodes to any of <a href="https://doc.akka.io/docs/akka/current/discovery/index.html">Akka Discovery&rsquo;s lookup mechanisms</a>, specify a service name and lookup timeout in the Couchbase section, and pass in <span class="group-scala"><a href="/api/alpakka/1.1.0/akka/stream/alpakka/couchbase/scaladsl/DiscoverySupport$.html">DiscoverySupport</a></span><span class="group-java"><a href="/api/alpakka/1.1.0/akka/stream/alpakka/couchbase/javadsl/DiscoverySupport.html">DiscoverySupport</a></span> nodes lookup to <code>enrichAsync</code> and configure Akka Discovery accordingly.</p>
<p><strong>The Akka Discovery dependency has to be added explicitly</strong>.</p>
<dl>
  <dt>Discovery settings (Config discovery)
  </dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/alpakka/tree/v1.1.0/couchbase/src/test/resources/discovery.conf#L8-L26" target="_blank" title="Go to snippet source"></a><code class="language-conf">alpakka.couchbase {
  session {
    service {
      name = couchbase-service
      lookup-timeout = 1 s
    }
    username = &quot;anotherUser&quot;
    password = &quot;differentPassword&quot;
  }
}

akka.discovery.method = config
akka.discovery.config.services = {
  couchbase-service = {
    endpoints = [
      { host = &quot;akka.io&quot; }
    ]
  }
}</code></pre></dd>
</dl>
<p>To enable Akka Discovery on the <code>CouchbaseSessionSettings</code>, use <code>DiscoverySupport.nodes()</code> as enrichment function.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/alpakka/tree/v1.1.0/couchbase/src/test/scala/docs/scaladsl/DiscoverySpec.scala#L34-L41" target="_blank" title="Go to snippet source"></a><code class="language-scala">import akka.stream.alpakka.couchbase.scaladsl.{CouchbaseSession, DiscoverySupport}
import akka.stream.alpakka.couchbase.{CouchbaseSessionRegistry, CouchbaseSessionSettings}

val registry = CouchbaseSessionRegistry(actorSystem)

val sessionSettings = CouchbaseSessionSettings(actorSystem)
  .withEnrichAsync(DiscoverySupport.nodes())
val sessionFuture: Future[CouchbaseSession] = registry.sessionFor(sessionSettings, bucketName)</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/alpakka/tree/v1.1.0/couchbase/src/test/java/docs/javadsl/DiscoveryTest.java#L11-L57" target="_blank" title="Go to snippet source"></a><code class="language-java">import akka.stream.alpakka.couchbase.CouchbaseSessionRegistry;
import akka.stream.alpakka.couchbase.CouchbaseSessionSettings;
import akka.stream.alpakka.couchbase.javadsl.DiscoverySupport;
import akka.stream.alpakka.couchbase.javadsl.CouchbaseSession;

CouchbaseSessionRegistry registry = CouchbaseSessionRegistry.get(actorSystem);

CouchbaseSessionSettings sessionSettings =
    CouchbaseSessionSettings.create(actorSystem)
        .withEnrichAsyncCs(DiscoverySupport.getNodes(actorSystem));
CompletionStage&lt;CouchbaseSession&gt; session = registry.getSessionFor(sessionSettings, bucketName);</code></pre></dd>
</dl>
<h1><a href="#reading-from-couchbase-in-akka-streams" name="reading-from-couchbase-in-akka-streams" class="anchor"><span class="anchor-link"></span></a>Reading from Couchbase in Akka Streams</h1>
<h2><a href="#using-statements" name="using-statements" class="anchor"><span class="anchor-link"></span></a>Using statements</h2>
<p>To query Couchbase using the statement DSL use <code>CouchbaseSource.fromStatement</code>. </p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/alpakka/tree/v1.1.0/couchbase/src/test/scala/docs/scaladsl/CouchbaseSourceSpec.scala#L34-L40" target="_blank" title="Go to snippet source"></a><code class="language-scala">import com.couchbase.client.java.query.Select.select
import com.couchbase.client.java.query.dsl.Expression._

val resultAsFuture: Future[Seq[JsonObject]] =
  CouchbaseSource
    .fromStatement(sessionSettings, select(&quot;*&quot;).from(i(queryBucketName)).limit(10), bucketName)
    .runWith(Sink.seq)</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/alpakka/tree/v1.1.0/couchbase/src/test/java/docs/javadsl/CouchbaseExamplesTest.java#L63-L184" target="_blank" title="Go to snippet source"></a><code class="language-java">import static com.couchbase.client.java.query.Select.select;
import static com.couchbase.client.java.query.dsl.Expression.*;

CompletionStage&lt;List&lt;JsonObject&gt;&gt; resultCompletionStage =
    CouchbaseSource.fromStatement(
            sessionSettings, select(&quot;*&quot;).from(i(queryBucketName)).limit(10), bucketName)
        .runWith(Sink.seq(), materializer);</code></pre></dd>
</dl>
<h2><a href="#using-n1ql-queries" name="using-n1ql-queries" class="anchor"><span class="anchor-link"></span></a>Using N1QL queries</h2>
<p>To query Couchbase using the <a href="https://docs.couchbase.com/java-sdk/2.7/n1ql-query.html">&ldquo;N1QL&rdquo; queries</a> use <code>CouchbaseSource.fromN1qlQuery</code>. </p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/alpakka/tree/v1.1.0/couchbase/src/test/scala/docs/scaladsl/CouchbaseSourceSpec.scala#L70-L78" target="_blank" title="Go to snippet source"></a><code class="language-scala">import com.couchbase.client.java.query.{N1qlParams, N1qlQuery}

val params = N1qlParams.build.adhoc(false)
val query = N1qlQuery.simple(s&quot;select count(*) from $queryBucketName&quot;, params)

val resultAsFuture: Future[Seq[JsonObject]] =
  CouchbaseSource
    .fromN1qlQuery(sessionSettings, query, bucketName)
    .runWith(Sink.seq)</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/alpakka/tree/v1.1.0/couchbase/src/test/java/docs/javadsl/CouchbaseExamplesTest.java#L35-L201" target="_blank" title="Go to snippet source"></a><code class="language-java">import com.couchbase.client.java.query.N1qlParams;
import com.couchbase.client.java.query.N1qlQuery;

N1qlParams params = N1qlParams.build().adhoc(false);
SimpleN1qlQuery query = N1qlQuery.simple(&quot;select count(*) from &quot; + queryBucketName, params);

CompletionStage&lt;JsonObject&gt; resultCompletionStage =
    CouchbaseSource.fromN1qlQuery(sessionSettings, query, bucketName)
        .runWith(Sink.head(), materializer);</code></pre></dd>
</dl>
<h2><a href="#get-by-id" name="get-by-id" class="anchor"><span class="anchor-link"></span></a>Get by ID</h2>
<p><code>CouchbaseFlow.fromId</code> methods allow to read documents specified by the document ID in the Akka Stream.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/alpakka/tree/v1.1.0/couchbase/src/test/scala/docs/scaladsl/CouchbaseFlowSpec.scala#L188-L198" target="_blank" title="Go to snippet source"></a><code class="language-scala">val ids = immutable.Seq(&quot;First&quot;, &quot;Second&quot;, &quot;Third&quot;, &quot;Fourth&quot;)

val futureResult: Future[immutable.Seq[JsonDocument]] =
  Source(ids)
    .via(
      CouchbaseFlow.fromId(
        sessionSettings,
        bucketName
      )
    )
    .runWith(Sink.seq)</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/alpakka/tree/v1.1.0/couchbase/src/test/java/docs/javadsl/CouchbaseExamplesTest.java#L225-L230" target="_blank" title="Go to snippet source"></a><code class="language-java">List&lt;String&gt; ids = Arrays.asList(&quot;First&quot;, &quot;Second&quot;, &quot;Third&quot;, &quot;Fourth&quot;);

CompletionStage&lt;List&lt;JsonDocument&gt;&gt; result =
    Source.from(ids)
        .via(CouchbaseFlow.fromId(sessionSettings, queryBucketName))
        .runWith(Sink.seq(), materializer);</code></pre></dd>
</dl>
<h1><a href="#writing-to-couchbase-in-akka-streams" name="writing-to-couchbase-in-akka-streams" class="anchor"><span class="anchor-link"></span></a>Writing to Couchbase in Akka Streams</h1>
<p>For each mutation operation we need to create <code>CouchbaseWriteSettings</code> instance which consists of the following parameters</p>
<ul>
  <li>Parallelism in access to Couchbase (default 1)</li>
  <li>Couchbase Replication Factor (default <code>ReplicateTo.NONE</code>)</li>
  <li>Couchbase Persistence Level for Write Operation (default <code>PersistTo.NONE</code>)</li>
  <li>2 seconds operation timeout</li>
</ul>
<p>These default values are not recommended for production use, as they do not persist to disk for any node. </p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/alpakka/tree/v1.1.0/couchbase/src/test/scala/docs/scaladsl/CouchbaseFlowSpec.scala#L17-L64" target="_blank" title="Go to snippet source"></a><code class="language-scala">import akka.stream.alpakka.couchbase.CouchbaseWriteSettings
import com.couchbase.client.java.{PersistTo, ReplicateTo}
val writeSettings = CouchbaseWriteSettings()
  .withParallelism(3)
  .withPersistTo(PersistTo.FOUR)
  .withReplicateTo(ReplicateTo.THREE)
  .withTimeout(5.seconds)</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/alpakka/tree/v1.1.0/couchbase/src/test/java/docs/javadsl/CouchbaseExamplesTest.java#L210-L215" target="_blank" title="Go to snippet source"></a><code class="language-java">CouchbaseWriteSettings writeSettings =
    CouchbaseWriteSettings.create()
        .withParallelism(3)
        .withPersistTo(PersistTo.FOUR)
        .withReplicateTo(ReplicateTo.THREE)
        .withTimeout(Duration.ofSeconds(5));</code></pre></dd>
</dl>
<p>Read more about durability settings in the <a href="https://docs.couchbase.com/java-sdk/2.7/durability.html#configuring-durability">Couchbase documentation</a>. </p>
<h2><a href="#upsert" name="upsert" class="anchor"><span class="anchor-link"></span></a>Upsert</h2>
<p>The <code>CouchbaseFlow</code> and <code>CouchbaseSink</code> offer factories for upserting documents (insert or update) in Couchbase. <code>upsert</code> is used for the most commonly used <code>JsonDocument</code>, and <code>upsertDoc</code> has as type parameter to support any variants of <span class="group-scala"><code>Document[T]</code></span><span class="group-java"><code>Document&lt;T&gt;</code></span> which may be <code>RawJsonDocument</code>, <code>StringDocument</code> or <code>BinaryDocument</code>.</p>
<p>The <code>upsert</code> and <code>upsertDoc</code> operators fail the stream on any error when writing to Couchbase. To handle failures in-stream use <code>upsertDocWithResult</code> shown below. </p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/alpakka/tree/v1.1.0/couchbase/src/test/scala/docs/scaladsl/CouchbaseFlowSpec.scala#L97-L134" target="_blank" title="Go to snippet source"></a><code class="language-scala">val obj = TestObject(id = &quot;First&quot;, &quot;First&quot;)

val writeSettings = CouchbaseWriteSettings()

val jsonDocumentUpsert: Future[Done] =
  Source
    .single(obj)
    .map(toJsonDocument)
    .via(
      CouchbaseFlow.upsert(
        sessionSettings,
        writeSettings,
        bucketName
      )
    )
    .runWith(Sink.ignore)

val stringDocumentUpsert: Future[Done] =
  Source
    .single(sampleData)
    .map(toStringDocument)
    .via(
      CouchbaseFlow.upsertDoc(
        sessionSettings,
        writeSettings,
        bucketName
      )
    )
    .runWith(Sink.ignore)</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/alpakka/tree/v1.1.0/couchbase/src/test/java/docs/javadsl/CouchbaseExamplesTest.java#L240-L261" target="_blank" title="Go to snippet source"></a><code class="language-java">TestObject obj = new TestObject(&quot;First&quot;, &quot;First&quot;);

CouchbaseWriteSettings writeSettings = CouchbaseWriteSettings.create();

CompletionStage&lt;Done&gt; jsonDocumentUpsert =
    Source.single(obj)
        .map(support::toJsonDocument)
        .via(CouchbaseFlow.upsert(sessionSettings, writeSettings, bucketName))
        .runWith(Sink.ignore(), materializer);

CompletionStage&lt;Done&gt; stringDocumentUpsert =
    Source.single(sampleData)
        .map(support::toStringDocument)
        .via(CouchbaseFlow.upsertDoc(sessionSettings, writeSettings, bucketName))
        .runWith(Sink.ignore(), materializer);</code></pre></dd>
</dl><div class="callout note "><div class="callout-title">Note</div>
<p>For single document modifications you may consider using the <code>CouchbaseSession</code> methods directly, they offer a <span class="group-scala">future-based</span><span class="group-java">CompletionStage-based</span> API which in many cases might be simpler than using Akka Streams with just one element (see <a href="#using-couchbasesession-directly">below</a>)</p></div>
<p>Couchbase writes may fail temporarily for a particular node. If you want to handle such failures without restarting the whole stream, the <code>upsertDocWithResult</code> operator captures failures from Couchbase and emits <code>CouchbaseWriteResult</code> sub-classes <code>CouchbaseWriteSuccess</code> and <code>CouchbaseWriteFailure</code> downstream.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/alpakka/tree/v1.1.0/couchbase/src/test/scala/docs/scaladsl/CouchbaseFlowSpec.scala#L397-L413" target="_blank" title="Go to snippet source"></a><code class="language-scala">import akka.stream.alpakka.couchbase.{CouchbaseWriteFailure, CouchbaseWriteResult}

val result: Future[immutable.Seq[CouchbaseWriteResult[RawJsonDocument]]] =
  Source(sampleSequence)
    .map(toRawJsonDocument)
    .via(
      CouchbaseFlow.upsertDocWithResult(
        sessionSettings,
        writeSettings,
        bucketName
      )
    )
    .runWith(Sink.seq)

val failedDocs: immutable.Seq[CouchbaseWriteFailure[RawJsonDocument]] = result.futureValue.collect {
  case res: CouchbaseWriteFailure[RawJsonDocument] =&gt; res
}</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/alpakka/tree/v1.1.0/couchbase/src/test/java/docs/javadsl/CouchbaseExamplesTest.java#L14-L282" target="_blank" title="Go to snippet source"></a><code class="language-java">import akka.stream.alpakka.couchbase.CouchbaseWriteFailure;
import akka.stream.alpakka.couchbase.CouchbaseWriteResult;

CompletionStage&lt;List&lt;CouchbaseWriteResult&lt;StringDocument&gt;&gt;&gt; upsertResults =
    Source.from(sampleSequence)
        .map(support::toStringDocument)
        .via(CouchbaseFlow.upsertDocWithResult(sessionSettings, writeSettings, bucketName))
        .runWith(Sink.seq(), materializer);

List&lt;CouchbaseWriteResult&lt;StringDocument&gt;&gt; writeResults =
    upsertResults.toCompletableFuture().get(3, TimeUnit.SECONDS);
List&lt;CouchbaseWriteFailure&lt;StringDocument&gt;&gt; failedDocs =
    writeResults.stream()
        .filter(CouchbaseWriteResult::isFailure)
        .map(res -&gt; (CouchbaseWriteFailure&lt;StringDocument&gt;) res)
        .collect(Collectors.toList());</code></pre></dd>
</dl>
<h2><a href="#delete" name="delete" class="anchor"><span class="anchor-link"></span></a>Delete</h2>
<p>The <code>CouchbaseFlow</code> and <code>CouchbaseSink</code> offer factories to delete documents in Couchbase by ID.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/alpakka/tree/v1.1.0/couchbase/src/test/scala/docs/scaladsl/CouchbaseFlowSpec.scala#L274-L284" target="_blank" title="Go to snippet source"></a><code class="language-scala">val deleteFuture: Future[Done] =
  Source
    .single(sampleData.id)
    .via(
      CouchbaseFlow.delete(
        sessionSettings,
        writeSettings,
        bucketName
      )
    )
    .runWith(Sink.ignore)</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/alpakka/tree/v1.1.0/couchbase/src/test/java/docs/javadsl/CouchbaseExamplesTest.java#L292-L295" target="_blank" title="Go to snippet source"></a><code class="language-java">CompletionStage&lt;Done&gt; result =
    Source.single(sampleData.id())
        .via(CouchbaseFlow.delete(sessionSettings, writeSettings, bucketName))
        .runWith(Sink.ignore(), materializer);</code></pre></dd>
</dl>
<p>To handle any delete failures such as non-existent documents in-stream, use the the <code>deleteWithResult</code> operator. It captures failures from Couchbase and emits <code>CouchbaseDeleteResult</code>s.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/alpakka/tree/v1.1.0/couchbase/src/test/scala/docs/scaladsl/CouchbaseFlowSpec.scala#L463-L473" target="_blank" title="Go to snippet source"></a><code class="language-scala">val deleteResult: Future[CouchbaseDeleteResult] =
  Source
    .single(&quot;non-existent&quot;)
    .via(
      CouchbaseFlow.deleteWithResult(
        sessionSettings,
        writeSettings,
        bucketName
      )
    )
    .runWith(Sink.head)</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/alpakka/tree/v1.1.0/couchbase/src/test/java/docs/javadsl/CouchbaseExamplesTest.java#L11-L306" target="_blank" title="Go to snippet source"></a><code class="language-java">import akka.stream.alpakka.couchbase.CouchbaseDeleteResult;
CompletionStage&lt;CouchbaseDeleteResult&gt; result =
    Source.single(&quot;non-existent&quot;)
        .via(CouchbaseFlow.deleteWithResult(sessionSettings, writeSettings, bucketName))
        .runWith(Sink.head(), materializer);</code></pre></dd>
</dl>
<h1><a href="#using-couchbasesession-directly" name="using-couchbasesession-directly" class="anchor"><span class="anchor-link"></span></a>Using <code>CouchbaseSession</code> directly</h1>
<h2><a href="#access-via-registry" name="access-via-registry" class="anchor"><span class="anchor-link"></span></a>Access via registry</h2>
<p>The <code>CouchbaseSesionRegistry</code> is an Akka extension to manage the life-cycle of Couchbase sessions. All underlying instances are closed upon actor system termination.</p>
<p>When accessing more than one Couchbase cluster, the <code>CouchbaseEnvironment</code> should be shared by setting a single instance for the different <code>CouchbaseSessionSettings</code>.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/alpakka/tree/v1.1.0/couchbase/src/test/scala/docs/scaladsl/CouchbaseSessionExamplesSpec.scala#L31-L47" target="_blank" title="Go to snippet source"></a><code class="language-scala">import akka.stream.alpakka.couchbase.CouchbaseSessionRegistry
import akka.stream.alpakka.couchbase.CouchbaseSessionSettings
import akka.stream.alpakka.couchbase.scaladsl.CouchbaseSession
import com.couchbase.client.java.env.{CouchbaseEnvironment, DefaultCouchbaseEnvironment}

// Akka extension (singleton per actor system)
val registry = CouchbaseSessionRegistry(actorSystem)

// If connecting to more than one Couchbase cluster, the environment should be shared
val environment: CouchbaseEnvironment = DefaultCouchbaseEnvironment.create()
actorSystem.registerOnTermination {
  environment.shutdown()
}

val sessionSettings = CouchbaseSessionSettings(actorSystem)
  .withEnvironment(environment)
val sessionFuture: Future[CouchbaseSession] = registry.sessionFor(sessionSettings, bucketName)</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/alpakka/tree/v1.1.0/couchbase/src/test/java/docs/javadsl/CouchbaseExamplesTest.java#L31-L115" target="_blank" title="Go to snippet source"></a><code class="language-java">import com.couchbase.client.java.env.CouchbaseEnvironment;
import com.couchbase.client.java.env.DefaultCouchbaseEnvironment;
import akka.stream.alpakka.couchbase.CouchbaseSessionRegistry;
import akka.stream.alpakka.couchbase.CouchbaseSessionSettings;
import akka.stream.alpakka.couchbase.javadsl.CouchbaseSession;

CouchbaseSessionRegistry registry = CouchbaseSessionRegistry.get(actorSystem);

// If connecting to more than one Couchbase cluster, the environment should be shared
CouchbaseEnvironment environment = DefaultCouchbaseEnvironment.create();
actorSystem.registerOnTermination(() -&gt; environment.shutdown());

CouchbaseSessionSettings sessionSettings =
    CouchbaseSessionSettings.create(actorSystem).withEnvironment(environment);
CompletionStage&lt;CouchbaseSession&gt; sessionCompletionStage =
    registry.getSessionFor(sessionSettings, bucketName);</code></pre></dd>
</dl>
<h2><a href="#manage-session-life-cycle" name="manage-session-life-cycle" class="anchor"><span class="anchor-link"></span></a>Manage session life-cycle</h2>
<p>Use <code>CouchbaseSessionSettings</code> to get an instance of <code>CouchbaseSession</code>. These settings may be specified in <code>application.conf</code> and complemented in code. Furthermore a session requires the bucket name and needs an <code>ExecutionContext</code> as the creation is asynchronous.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/alpakka/tree/v1.1.0/couchbase/src/test/scala/docs/scaladsl/CouchbaseSessionExamplesSpec.scala#L54-L71" target="_blank" title="Go to snippet source"></a><code class="language-scala">import akka.stream.alpakka.couchbase.CouchbaseSessionSettings
import akka.stream.alpakka.couchbase.scaladsl.CouchbaseSession

implicit val ec: ExecutionContext = actorSystem.dispatcher
val sessionSettings = CouchbaseSessionSettings(actorSystem)
val sessionFuture: Future[CouchbaseSession] = CouchbaseSession(sessionSettings, bucketName)
actorSystem.registerOnTermination(sessionFuture.flatMap(_.close()))

val documentFuture = sessionFuture.flatMap { session =&gt;
  val id = &quot;myId&quot;
  val documentFuture: Future[Option[JsonDocument]] = session.get(id)
  documentFuture.flatMap {
    case Some(jsonDocument) =&gt;
      Future.successful(jsonDocument)
    case None =&gt;
      Future.failed(new RuntimeException(s&quot;document $id wasn&#39;t found&quot;))
  }
}</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/alpakka/tree/v1.1.0/couchbase/src/test/java/docs/javadsl/CouchbaseExamplesTest.java#L53-L145" target="_blank" title="Go to snippet source"></a><code class="language-java">import akka.stream.alpakka.couchbase.CouchbaseSessionSettings;
import akka.stream.alpakka.couchbase.javadsl.CouchbaseSession;

Executor executor = Executors.newSingleThreadExecutor();
CouchbaseSessionSettings sessionSettings = CouchbaseSessionSettings.create(actorSystem);
CompletionStage&lt;CouchbaseSession&gt; sessionCompletionStage =
    CouchbaseSession.create(sessionSettings, bucketName, executor);
actorSystem.registerOnTermination(
    () -&gt; sessionCompletionStage.thenAccept(CouchbaseSession::close));

sessionCompletionStage.thenAccept(
    session -&gt; {
      String id = &quot;myId&quot;;
      CompletionStage&lt;Optional&lt;JsonDocument&gt;&gt; documentCompletionStage = session.get(id);
      documentCompletionStage.thenAccept(
          opt -&gt; {
            if (opt.isPresent()) {
              System.out.println(opt.get());
            } else {
              System.out.println(&quot;Document &quot; + id + &quot; wasn&#39;t found&quot;);
            }
          });
    });</code></pre></dd>
</dl>
<h2><a href="#manage-bucket-life-cycle" name="manage-bucket-life-cycle" class="anchor"><span class="anchor-link"></span></a>Manage bucket life-cycle</h2>
<p>For full control a <code>CouchbaseSession</code> may be created from a Couchbase <code>Bucket</code>. See <a href="https://docs.couchbase.com/java-sdk/2.7/managing-connections.html#concurrency">Scalability and Concurrency</a> in the Couchbase documentation for details.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/alpakka/tree/v1.1.0/couchbase/src/test/scala/docs/scaladsl/CouchbaseSessionExamplesSpec.scala#L79-L96" target="_blank" title="Go to snippet source"></a><code class="language-scala">import com.couchbase.client.java.auth.PasswordAuthenticator
import com.couchbase.client.java.{Bucket, CouchbaseCluster}

val cluster: CouchbaseCluster = CouchbaseCluster.create(&quot;localhost&quot;)
cluster.authenticate(new PasswordAuthenticator(&quot;Administrator&quot;, &quot;password&quot;))
val bucket: Bucket = cluster.openBucket(&quot;akka&quot;)
val session: CouchbaseSession = CouchbaseSession(bucket)
actorSystem.registerOnTermination {
  session.close()
}

val id = &quot;myId&quot;
val documentFuture = session.get(id).flatMap {
  case Some(jsonDocument) =&gt;
    Future.successful(jsonDocument)
  case None =&gt;
    Future.failed(new RuntimeException(s&quot;document $id wasn&#39;t found&quot;))
}</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/alpakka/tree/v1.1.0/couchbase/src/test/java/docs/javadsl/CouchbaseExamplesTest.java#L58-L172" target="_blank" title="Go to snippet source"></a><code class="language-java">import com.couchbase.client.java.Bucket;
import com.couchbase.client.java.CouchbaseCluster;
import com.couchbase.client.java.auth.PasswordAuthenticator;

CouchbaseCluster cluster = CouchbaseCluster.create(&quot;localhost&quot;);
cluster.authenticate(new PasswordAuthenticator(&quot;Administrator&quot;, &quot;password&quot;));
Bucket bucket = cluster.openBucket(&quot;akka&quot;);
CouchbaseSession session = CouchbaseSession.create(bucket);
actorSystem.registerOnTermination(
    () -&gt; {
      session.close();
      bucket.close();
    });

String id = &quot;First&quot;;
CompletionStage&lt;Optional&lt;JsonDocument&gt;&gt; documentCompletionStage = session.get(id);
documentCompletionStage.thenAccept(
    opt -&gt; {
      if (opt.isPresent()) {
        System.out.println(opt.get());
      } else {
        System.out.println(&quot;Document &quot; + id + &quot; wasn&#39;t found&quot;);
      }
    });</code></pre></dd>
</dl>
<p>To learn about the full range of operations on <code>CouchbaseSession</code>, read the <span class="group-scala"><a href="/api/alpakka/1.1.0/akka/stream/alpakka/couchbase/scaladsl/CouchbaseSession.html">API docs</a></span><span class="group-java"><a href="/api/alpakka/1.1.0/akka/stream/alpakka/couchbase/javadsl/CouchbaseSession.html">API docs</a></span>.</p>
</div>
</article>

<div class="row">
<div class="small-12 large-9 column">
<section class="nav-prev-next row">
<div class="nav-prev small-6 column">
<a href="azure-storage-queue.html"><i class="icon-prev"></i> <span class="link-prev">Azure Storage Queue</span></a>
</div>
<div class="nav-next small-6 column clearfix">
<a class="float-right" href="elasticsearch.html">Elasticsearch <i class="icon-next"></i></a>
</div>
</section>
</div>
</div>

<div class="source-github row">
Found an error in this documentation? The source code for this page can be found <a href="https://github.com/akka/alpakka/tree/v1.1.0/docs/src/main/paradox/couchbase.md">here</a>.
Please feel free to edit and contribute a pull request.
</div>


<footer class="page-footer row clearfix">
<img class="akka-icon float-left show-for-medium" src="images/akka-icon.svg"/>
<section class="copyright">
<div>Alpakka is Open Source and available under the Apache 2 License.</div>
<p class="legal">
&copy; 2011-2019 <a href="https://www.lightbend.com" target="_blank">Lightbend, Inc.</a> | 
<a href="https://www.lightbend.com/legal/licenses" target="_blank">Licenses</a> | 
<a href="https://www.lightbend.com/legal/terms" target="_blank">Terms</a> | 
<a href="https://www.lightbend.com/legal/privacy" target="_blank">Privacy Policy</a> | 
<a href="https://akka.io/cookie/" target="_blank">Cookie Listing</a> | 
<a class="optanon-toggle-display">Cookie Settings</a>
</p>
</section>
</footer>

</section>
</main>

<script type="text/javascript" src="js/scrollsneak.js"></script>
<script type="text/javascript">jQuery(document).foundation();</script>
<script type="text/javascript" src="js/groups.js"></script>
<script type="text/javascript" src="js/page.js"></script>
<script type="text/javascript" src="js/magellan.js"></script>

<style type="text/css">@import "lib/prettify/prettify.css";</style>
<script type="text/javascript" src="lib/prettify/prettify.js"></script>
<script type="text/javascript" src="lib/prettify/lang-scala.js"></script>
<script type="text/javascript">//<![CDATA[
jQuery(function(){window.prettyPrint && prettyPrint()});
//]]></script>
<script type="text/javascript" src="assets/js/warnOldVersion.js"></script>
<script type="text/javascript">//<![CDATA[
jQuery(function(jq){initOldVersionWarnings(jq, '1.1.0', 'https://doc.akka.io/docs/alpakka/current/')});
//]]></script>


</body>
</html>
