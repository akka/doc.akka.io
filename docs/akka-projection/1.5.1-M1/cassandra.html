<!DOCTYPE html>
<html class="no-js" lang="en">

<head>
<title>Offset in Cassandra &bull; Akka Projection</title>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<meta name="description" content="Akka Projection."/>
<link rel="canonical" href="https://doc.akka.io/docs/akka-projection/current/cassandra.html"/>
<script type="text/javascript" src="lib/jquery/jquery.min.js"></script>
<script type="text/javascript" src="lib/foundation/dist/js/foundation.min.js"></script>
<link rel="stylesheet" type="text/css" href="lib/normalize.css/normalize.css"/>
<link rel="stylesheet" type="text/css" href="lib/foundation/dist/css/foundation.min.css"/>
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.css" />
<link rel="stylesheet" type="text/css" href="css/icons.css"/>
<link rel="stylesheet" type="text/css" href="css/page-8.css"/>
<link rel="stylesheet" type="text/css" href="css/banner-2.css"/>
<link rel="shortcut icon" href="images/favicon.ico" />
<link rel="apple-touch-icon" sizes="180x180" href="images/apple-touch-icon.png"/>
<link rel="icon" type="image/png" sizes="32x32" href="images/favicon-32x32.png"/>
<link rel="icon" type="image/png" sizes="16x16" href="images/favicon-16x16.png"/>
<link rel="manifest" href="images/manifest.json"/>
<meta name="msapplication-TileImage" content="images/mstile-150x150.png"/>
<meta name="msapplication-TileColor" content="#15a9ce"/>
<meta name="theme-color" content="#15a9ce"/>
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>
<!-- OneTrust Cookies Consent Notice (Production Standard, akka.io, en-GB) start -->
<script src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js"  type="text/javascript" charset="UTF-8" data-domain-script="28b912e7-09e9-43d5-91e4-3d1897044004" ></script>
<script type="text/javascript">
function OptanonWrapper() { }
</script>
<!-- OneTrust Cookies Consent Notice (Production Standard, akka.io, en-GB) end -->
<!-- Google Tag Manager now loads Google Analytics and any other tracking scripts. GTM also performs respects a users cookie choices-->
<script type="text/javascript">
(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-KBJGH35');
</script>

</head>

<body id="underlay" data-toggler="nav-open">
<div id="lightbend-banner" class="lightbend-banner akka full-width" data-category="OSS Lightbend Banner Impression" data-label="Akka Banner Impression">
<div class="oss-wrapper">
<div class="oss-brand">
<a class="oss-track-link-label" data-category="OSS Lightbend Banner Clicks" data-label="Lightbend Logo - Akka Banner" href="https://www.lightbend.com">
<img class="lightbend-logo" src="images/banner-logos/lightbend-reverse.svg" alt="Lightbend" title="Lightbend">
</a>
</div>
<div class="oss-ad no-drop-down">
<nav id="lightbendRotator" class="lightbend-rotator">
<a class="oss-track-link-label" data-category="OSS Lightbend Banner Clicks" data-label="Promo Rotator - Introducing Akka Cloud to Edge Continuum. Build once for the Cloud. Seamlessly deploy to the Edge. [Learn more] - Akka Banner" href="https://www.lightbend.com/blog/akka-edge-unifying-the-cloud-and-edge">
Introducing Akka Cloud to Edge Continuum. Build once for the Cloud. Seamlessly deploy to the Edge. <span class="akka-btn">Learn more</span>
</a>
</nav>
</div>
</div>
</div>

<header class="site-header hide-for-large">
<div class="sticky-header clearfix">
<a href="https://akka.io"><img class="logo" src="images/akka-logo-reverse.svg"/></a>

<button class="menu-icon float-right" type="button" data-toggle="underlay overlay"></button>
</div>
<div id="overlay" class="overlay-nav" data-toggler="nav-open">
<header class="nav-header">
<div class="nav-header-title">
<h1><a href="index.html">Akka Projection</a></h1>
</div>
<div class="nav-header-version">
Version 1.5.1-M1
</div>
<div class="nav-header-groups">
<select class="supergroup" name="Language"><option class="group" value="group-java">Java</option><option class="group" value="group-scala">Scala</option></select>
</div>
</header>
<nav class="nav-toc">
<ul>
  <li><a href="overview.html" class="page">Overview</a></li>
  <li><a href="use-cases.html" class="page">Use Cases</a></li>
  <li><a href="getting-started/index.html" class="page">Getting Started Guide</a></li>
  <li><a href="eventsourced.html" class="page">Events from Akka Persistence</a></li>
  <li><a href="durable-state.html" class="page">Changes from Durable State</a></li>
  <li><a href="kafka.html" class="page">Messages from and to Kafka</a></li>
  <li><a href="r2dbc.html" class="page">Offset in a relational DB with R2DBC</a></li>
  <li><a href="cassandra.html#offset-in-cassandra" class="active page">Offset in Cassandra</a>
  <ul>
    <li><a href="cassandra.html#dependencies" class="header">Dependencies</a></li>
    <li><a href="cassandra.html#at-least-once" class="header">at-least-once</a></li>
    <li><a href="cassandra.html#at-most-once" class="header">at-most-once</a></li>
    <li><a href="cassandra.html#groupedwithin" class="header">groupedWithin</a></li>
    <li><a href="cassandra.html#handler" class="header">Handler</a></li>
    <li><a href="cassandra.html#schema" class="header">Schema</a></li>
    <li><a href="cassandra.html#offset-types" class="header">Offset types</a></li>
    <li><a href="cassandra.html#configuration" class="header">Configuration</a></li>
  </ul></li>
  <li><a href="jdbc.html" class="page">Offset in a relational DB with JDBC</a></li>
  <li><a href="slick.html" class="page">Offset in a relational DB with Slick</a></li>
  <li><a href="running.html" class="page">Running a Projection</a></li>
  <li><a href="actor.html" class="page">Processing with Actor</a></li>
  <li><a href="flow.html" class="page">Processing with Akka Streams</a></li>
  <li><a href="error.html" class="page">Error handling</a></li>
  <li><a href="projection-settings.html" class="page">Projection Settings</a></li>
  <li><a href="grpc.html" class="page">Akka Projection gRPC</a></li>
  <li><a href="grpc-producer-push.html" class="page">Akka Projection gRPC with producer push</a></li>
  <li><a href="grpc-replicated-event-sourcing-transport.html" class="page">Akka Replicated Event Sourcing over gRPC</a></li>
  <li><a href="management.html" class="page">Management of a Projection</a></li>
  <li><a href="testing.html" class="page">Testing</a></li>
  <li><a href="classic.html" class="page">Akka Classic</a></li>
  <li><a href="snapshots.html" class="page">Snapshots</a></li>
</ul>
</nav>
</div>
</header>
<div class="site-content-wrapper">
<aside class="sticky-sidebar show-for-large">
<header class="nav-header sticky-sidebar-header">
<div class="nav-header-title">
<h1><a href="index.html">Akka Projection</a></h1>
</div>
<div class="nav-header-version">
Version 1.5.1-M1
</div>
<div class="nav-header-groups">
<select class="supergroup" name="Language"><option class="group" value="group-java">Java</option><option class="group" value="group-scala">Scala</option></select>
</div>
</header>
<nav class="site-nav sticky-sidebar-contents">
<div class="nav-toc">
<ul>
  <li><a href="overview.html" class="page">Overview</a></li>
  <li><a href="use-cases.html" class="page">Use Cases</a></li>
  <li><a href="getting-started/index.html" class="page">Getting Started Guide</a></li>
  <li><a href="eventsourced.html" class="page">Events from Akka Persistence</a></li>
  <li><a href="durable-state.html" class="page">Changes from Durable State</a></li>
  <li><a href="kafka.html" class="page">Messages from and to Kafka</a></li>
  <li><a href="r2dbc.html" class="page">Offset in a relational DB with R2DBC</a></li>
  <li><a href="cassandra.html#offset-in-cassandra" class="active page">Offset in Cassandra</a>
  <ul>
    <li><a href="cassandra.html#dependencies" class="header">Dependencies</a></li>
    <li><a href="cassandra.html#at-least-once" class="header">at-least-once</a></li>
    <li><a href="cassandra.html#at-most-once" class="header">at-most-once</a></li>
    <li><a href="cassandra.html#groupedwithin" class="header">groupedWithin</a></li>
    <li><a href="cassandra.html#handler" class="header">Handler</a></li>
    <li><a href="cassandra.html#schema" class="header">Schema</a></li>
    <li><a href="cassandra.html#offset-types" class="header">Offset types</a></li>
    <li><a href="cassandra.html#configuration" class="header">Configuration</a></li>
  </ul></li>
  <li><a href="jdbc.html" class="page">Offset in a relational DB with JDBC</a></li>
  <li><a href="slick.html" class="page">Offset in a relational DB with Slick</a></li>
  <li><a href="running.html" class="page">Running a Projection</a></li>
  <li><a href="actor.html" class="page">Processing with Actor</a></li>
  <li><a href="flow.html" class="page">Processing with Akka Streams</a></li>
  <li><a href="error.html" class="page">Error handling</a></li>
  <li><a href="projection-settings.html" class="page">Projection Settings</a></li>
  <li><a href="grpc.html" class="page">Akka Projection gRPC</a></li>
  <li><a href="grpc-producer-push.html" class="page">Akka Projection gRPC with producer push</a></li>
  <li><a href="grpc-replicated-event-sourcing-transport.html" class="page">Akka Replicated Event Sourcing over gRPC</a></li>
  <li><a href="management.html" class="page">Management of a Projection</a></li>
  <li><a href="testing.html" class="page">Testing</a></li>
  <li><a href="classic.html" class="page">Akka Classic</a></li>
  <li><a href="snapshots.html" class="page">Snapshots</a></li>
</ul>
</div>
</nav>
<footer class="nav-footer sticky-sidebar-footer">
<a href="https://akka.io"><img class="logo" src="images/akka-logo-reverse.svg"/></a>

</footer>
</aside>
<main class="fixed-shift-for-large expanded row">
<section class="site-content small-12 column">
<article class="page-content row">
<div class="small-12 column" id="docs">
<h1><a href="#offset-in-cassandra" name="offset-in-cassandra" class="anchor"><span class="anchor-link"></span></a>Offset in Cassandra</h1>
<p>The <span class="group-java"><a href="/api/akka-projection/1.5.1-M1/akka/projection/cassandra/javadsl/CassandraProjection$.html" title="akka.projection.cassandra.javadsl.CassandraProjection"><code>CassandraProjection</code></a></span><span class="group-scala"><a href="/api/akka-projection/1.5.1-M1/akka/projection/cassandra/scaladsl/CassandraProjection$.html" title="akka.projection.cassandra.scaladsl.CassandraProjection"><code>CassandraProjection</code></a></span> has support for storing the offset in Cassandra.</p>
<p>The source of the envelopes can be <a href="eventsourced.html">events from Akka Persistence</a> or any other <code>SourceProvider</code> with supported <a href="cassandra.html#offset-types">offset types</a>.</p>
<p>The envelope handler can integrate with anything, such as publishing to a message broker, or updating a read model in Cassandra.</p>
<p>The <code>CassandraProjection</code> offers <a href="cassandra.html#at-least-once">at-least-once</a> and <a href="cassandra.html#at-most-once">at-most-once</a> processing semantics, but not exactly-once.</p>
<h2><a href="#dependencies" name="dependencies" class="anchor"><span class="anchor-link"></span></a>Dependencies</h2>
<p>The Akka dependencies are available from Akka&rsquo;s library repository. To access them there, you need to configure the URL for this repository.</p><dl class="repository"><dt>sbt</dt><dd><pre class="prettyprint"><code class="language-scala">resolvers += "Akka library repository".at("https://repo.akka.io/maven")
</code></pre></dd><dt>Maven</dt><dd><pre class="prettyprint"><code class="language-xml">&lt;project&gt
  ...
  &lt;repositories&gt;
    &lt;repository&gt;
      &lt;id&gt;akka-repository&lt;/id&gt;
      &lt;name>Akka library repository&lt;/name&gt;
      &lt;url>https://repo.akka.io/maven&lt;/url&gt;
    &lt;/repository&gt;
  &lt;/repositories&gt
&lt;/project&gt;
</code></pre></dd><dt>Gradle</dt><dd><pre class="prettyprint"><code class="language-gradle">repositories {
    mavenCentral()
    maven {
        url "https://repo.akka.io/maven"
    }
}
</code></pre></dd></dl>
<p>To use the Cassandra module of Akka Projections add the following dependency in your project:</p><dl class="dependency"><dt>sbt</dt><dd><pre class="prettyprint"><code class="language-scala">libraryDependencies += "com.lightbend.akka" %% "akka-projection-cassandra" % "1.5.1-M1"</code></pre></dd><dt>Maven</dt><dd><pre class="prettyprint"><code class="language-xml">&lt;properties&gt;
  &lt;scala.binary.version&gt;2.13&lt;/scala.binary.version&gt;
&lt;/properties&gt;
&lt;dependencies&gt
  &lt;dependency&gt;
    &lt;groupId&gt;com.lightbend.akka&lt;/groupId&gt;
    &lt;artifactId&gt;akka-projection-cassandra_${scala.binary.version}&lt;/artifactId&gt;
    &lt;version&gt;1.5.1-M1&lt;/version&gt;
  &lt;/dependency&gt
&lt;/dependencies&gt;</code></pre></dd><dt>Gradle</dt><dd><pre class="prettyprint"><code class="language-gradle">def versions = [
  ScalaBinary: "2.13"
]
dependencies {
  implementation "com.lightbend.akka:akka-projection-cassandra_${versions.ScalaBinary}:1.5.1-M1"
}</code></pre></dd></dl>
<p>Akka Projections requires Akka 2.9.1-M1 or later, see <a href="overview.html#akka-version">Akka version</a>.</p>
<table class="project-info">
<tr><th colspan="2">Project Info: Akka Projections Cassandra</th></tr>
  <tr><th>Artifact</th><td><div>com.lightbend.akka</div>
  <div>akka-projection-cassandra</div>
  <div>1.5.1-M1</div>
  <div><a href="snapshots.html">Snapshots are available</a></div>
  </td></tr>
  <tr><th>JDK versions</th><td><div>Eclipse Temurin JDK 11</div><div>Eclipse Temurin JDK 17</div></td></tr>
  <tr><th>Scala versions</th><td>2.13.12, 3.3.1</td></tr>
  <tr><th>JPMS module name</th><td>akka.projection.cassandra</td></tr>
  <tr><th>License</th><td><div><a href="https://raw.githubusercontent.com/akka/akka-projection/main/LICENSE" target="_blank" rel="noopener noreferrer">BUSL-1.1</a></div>
  </td></tr>
  <tr><th>Readiness level</th><td><div class="readiness-level"><a href="https://developer.lightbend.com/docs/introduction/getting-help/support-terminology.html#supported" target="_blank" rel="noopener">Supported</a>, <a href="https://www.lightbend.com/lightbend-subscription" target="_blank" rel="noopener">Lightbend Subscription</a> provides support</div>
  <div>Since 1.0.0, 2020-09-10</div>
  </td></tr>
  <tr><th>Home page</th><td><a href="https://akka.io">https://akka.io</a></td></tr>
  <tr><th>API documentation</th><td>
  <div><a href="https://doc.akka.io/api/akka-projection/1.5.1-M1/akka/projection/" target="_blank" rel="noopener noreferrer">API (Scaladoc)</a></div>
  </td></tr>
  <tr><th>Forums</th><td>
  <div><a href="https://discuss.lightbend.com/c/akka/" target="_blank" rel="noopener noreferrer">Lightbend Discuss</a></div>
  <div><a href="https://gitter.im/akka/akka" target="_blank" rel="noopener noreferrer">akka/akka Gitter channel</a></div>
  </td></tr>
  <tr><th>Release notes</th><td><a href="https://github.com/akka/akka-projection/releases" target="_blank" rel="noopener noreferrer">GitHub releases</a></td></tr>
  <tr><th>Issues</th><td><a href="https://github.com/akka/akka-projection/issues" target="_blank" rel="noopener noreferrer">GitHub issues</a></td></tr>
  <tr><th>Sources</th><td><a href="https://github.com/akka/akka-projection" target="_blank" rel="noopener noreferrer">https://github.com/akka/akka-projection</a></td></tr>
</table>

<h3><a href="#transitive-dependencies" name="transitive-dependencies" class="anchor"><span class="anchor-link"></span></a>Transitive dependencies</h3>

<p>The table below shows <code>akka-projection-cassandra</code>&rsquo;s direct dependencies and the second tab shows all libraries it depends on transitively.</p>

<dl class="dependencies"><dt>Direct dependencies</dt><dd><table>
  <thead><tr><th>Organization</th><th>Artifact</th><th>Version</th></thead>
  <tbody>
    <tr><td>com.lightbend.akka</td><td>akka-projection-core_2.13</td><td><a href="https://mvnrepository.com/artifact/com.lightbend.akka/akka-projection-core_2.13/1.5.1-M1" target="_blank">1.5.1-M1</a></td></tr>
    <tr><td>com.lightbend.akka</td><td>akka-stream-alpakka-cassandra_2.13</td><td><a href="https://mvnrepository.com/artifact/com.lightbend.akka/akka-stream-alpakka-cassandra_2.13/7.0.0" target="_blank">7.0.0</a></td></tr>
    <tr><td>com.typesafe.akka</td><td>akka-persistence-query_2.13</td><td><a href="https://mvnrepository.com/artifact/com.typesafe.akka/akka-persistence-query_2.13/2.9.1-M1" target="_blank">2.9.1-M1</a></td></tr>
    <tr><td>org.scala-lang</td><td>scala-library</td><td><a href="https://mvnrepository.com/artifact/org.scala-lang/scala-library/2.13.12" target="_blank">2.13.12</a></td></tr>
  </tbody>
</table></dd>
<dt>Dependency tree</dt><dd><pre>
com.lightbend.akka    akka-projection-core_2.13    <a href="https://mvnrepository.com/artifact/com.lightbend.akka/akka-projection-core_2.13/1.5.1-M1" target="_blank">1.5.1-M1</a>
    com.typesafe.akka    akka-actor-typed_2.13    <a href="https://mvnrepository.com/artifact/com.typesafe.akka/akka-actor-typed_2.13/2.9.1-M1" target="_blank">2.9.1-M1</a>    BUSL-1.1
        com.typesafe.akka    akka-actor_2.13    <a href="https://mvnrepository.com/artifact/com.typesafe.akka/akka-actor_2.13/2.9.1-M1" target="_blank">2.9.1-M1</a>    BUSL-1.1
            com.typesafe    config    <a href="https://mvnrepository.com/artifact/com.typesafe/config/1.4.3" target="_blank">1.4.3</a>    Apache-2.0
            org.scala-lang.modules    scala-java8-compat_2.13    <a href="https://mvnrepository.com/artifact/org.scala-lang.modules/scala-java8-compat_2.13/1.0.2" target="_blank">1.0.2</a>    Apache-2.0
                org.scala-lang    scala-library    <a href="https://mvnrepository.com/artifact/org.scala-lang/scala-library/2.13.12" target="_blank">2.13.12</a>    Apache-2.0
            org.scala-lang    scala-library    <a href="https://mvnrepository.com/artifact/org.scala-lang/scala-library/2.13.12" target="_blank">2.13.12</a>    Apache-2.0
        com.typesafe.akka    akka-slf4j_2.13    <a href="https://mvnrepository.com/artifact/com.typesafe.akka/akka-slf4j_2.13/2.9.1-M1" target="_blank">2.9.1-M1</a>    BUSL-1.1
            com.typesafe.akka    akka-actor_2.13    <a href="https://mvnrepository.com/artifact/com.typesafe.akka/akka-actor_2.13/2.9.1-M1" target="_blank">2.9.1-M1</a>    BUSL-1.1
                com.typesafe    config    <a href="https://mvnrepository.com/artifact/com.typesafe/config/1.4.3" target="_blank">1.4.3</a>    Apache-2.0
                org.scala-lang.modules    scala-java8-compat_2.13    <a href="https://mvnrepository.com/artifact/org.scala-lang.modules/scala-java8-compat_2.13/1.0.2" target="_blank">1.0.2</a>    Apache-2.0
                    org.scala-lang    scala-library    <a href="https://mvnrepository.com/artifact/org.scala-lang/scala-library/2.13.12" target="_blank">2.13.12</a>    Apache-2.0
                org.scala-lang    scala-library    <a href="https://mvnrepository.com/artifact/org.scala-lang/scala-library/2.13.12" target="_blank">2.13.12</a>    Apache-2.0
            org.scala-lang    scala-library    <a href="https://mvnrepository.com/artifact/org.scala-lang/scala-library/2.13.12" target="_blank">2.13.12</a>    Apache-2.0
            org.slf4j    slf4j-api    <a href="https://mvnrepository.com/artifact/org.slf4j/slf4j-api/1.7.36" target="_blank">1.7.36</a>
        org.scala-lang    scala-library    <a href="https://mvnrepository.com/artifact/org.scala-lang/scala-library/2.13.12" target="_blank">2.13.12</a>    Apache-2.0
        org.slf4j    slf4j-api    <a href="https://mvnrepository.com/artifact/org.slf4j/slf4j-api/1.7.36" target="_blank">1.7.36</a>
    com.typesafe.akka    akka-persistence-query_2.13    <a href="https://mvnrepository.com/artifact/com.typesafe.akka/akka-persistence-query_2.13/2.9.1-M1" target="_blank">2.9.1-M1</a>    BUSL-1.1
        com.typesafe.akka    akka-persistence_2.13    <a href="https://mvnrepository.com/artifact/com.typesafe.akka/akka-persistence_2.13/2.9.1-M1" target="_blank">2.9.1-M1</a>    BUSL-1.1
            com.typesafe.akka    akka-actor_2.13    <a href="https://mvnrepository.com/artifact/com.typesafe.akka/akka-actor_2.13/2.9.1-M1" target="_blank">2.9.1-M1</a>    BUSL-1.1
                com.typesafe    config    <a href="https://mvnrepository.com/artifact/com.typesafe/config/1.4.3" target="_blank">1.4.3</a>    Apache-2.0
                org.scala-lang.modules    scala-java8-compat_2.13    <a href="https://mvnrepository.com/artifact/org.scala-lang.modules/scala-java8-compat_2.13/1.0.2" target="_blank">1.0.2</a>    Apache-2.0
                    org.scala-lang    scala-library    <a href="https://mvnrepository.com/artifact/org.scala-lang/scala-library/2.13.12" target="_blank">2.13.12</a>    Apache-2.0
                org.scala-lang    scala-library    <a href="https://mvnrepository.com/artifact/org.scala-lang/scala-library/2.13.12" target="_blank">2.13.12</a>    Apache-2.0
            com.typesafe.akka    akka-stream_2.13    <a href="https://mvnrepository.com/artifact/com.typesafe.akka/akka-stream_2.13/2.9.1-M1" target="_blank">2.9.1-M1</a>    BUSL-1.1
                com.typesafe.akka    akka-actor_2.13    <a href="https://mvnrepository.com/artifact/com.typesafe.akka/akka-actor_2.13/2.9.1-M1" target="_blank">2.9.1-M1</a>    BUSL-1.1
                    com.typesafe    config    <a href="https://mvnrepository.com/artifact/com.typesafe/config/1.4.3" target="_blank">1.4.3</a>    Apache-2.0
                    org.scala-lang.modules    scala-java8-compat_2.13    <a href="https://mvnrepository.com/artifact/org.scala-lang.modules/scala-java8-compat_2.13/1.0.2" target="_blank">1.0.2</a>    Apache-2.0
                        org.scala-lang    scala-library    <a href="https://mvnrepository.com/artifact/org.scala-lang/scala-library/2.13.12" target="_blank">2.13.12</a>    Apache-2.0
                    org.scala-lang    scala-library    <a href="https://mvnrepository.com/artifact/org.scala-lang/scala-library/2.13.12" target="_blank">2.13.12</a>    Apache-2.0
                com.typesafe.akka    akka-protobuf-v3_2.13    <a href="https://mvnrepository.com/artifact/com.typesafe.akka/akka-protobuf-v3_2.13/2.9.1-M1" target="_blank">2.9.1-M1</a>    BUSL-1.1
                org.reactivestreams    reactive-streams    <a href="https://mvnrepository.com/artifact/org.reactivestreams/reactive-streams/1.0.4" target="_blank">1.0.4</a>    MIT-0
                org.scala-lang    scala-library    <a href="https://mvnrepository.com/artifact/org.scala-lang/scala-library/2.13.12" target="_blank">2.13.12</a>    Apache-2.0
            org.scala-lang    scala-library    <a href="https://mvnrepository.com/artifact/org.scala-lang/scala-library/2.13.12" target="_blank">2.13.12</a>    Apache-2.0
        com.typesafe.akka    akka-protobuf-v3_2.13    <a href="https://mvnrepository.com/artifact/com.typesafe.akka/akka-protobuf-v3_2.13/2.9.1-M1" target="_blank">2.9.1-M1</a>    BUSL-1.1
        com.typesafe.akka    akka-stream_2.13    <a href="https://mvnrepository.com/artifact/com.typesafe.akka/akka-stream_2.13/2.9.1-M1" target="_blank">2.9.1-M1</a>    BUSL-1.1
            com.typesafe.akka    akka-actor_2.13    <a href="https://mvnrepository.com/artifact/com.typesafe.akka/akka-actor_2.13/2.9.1-M1" target="_blank">2.9.1-M1</a>    BUSL-1.1
                com.typesafe    config    <a href="https://mvnrepository.com/artifact/com.typesafe/config/1.4.3" target="_blank">1.4.3</a>    Apache-2.0
                org.scala-lang.modules    scala-java8-compat_2.13    <a href="https://mvnrepository.com/artifact/org.scala-lang.modules/scala-java8-compat_2.13/1.0.2" target="_blank">1.0.2</a>    Apache-2.0
                    org.scala-lang    scala-library    <a href="https://mvnrepository.com/artifact/org.scala-lang/scala-library/2.13.12" target="_blank">2.13.12</a>    Apache-2.0
                org.scala-lang    scala-library    <a href="https://mvnrepository.com/artifact/org.scala-lang/scala-library/2.13.12" target="_blank">2.13.12</a>    Apache-2.0
            com.typesafe.akka    akka-protobuf-v3_2.13    <a href="https://mvnrepository.com/artifact/com.typesafe.akka/akka-protobuf-v3_2.13/2.9.1-M1" target="_blank">2.9.1-M1</a>    BUSL-1.1
            org.reactivestreams    reactive-streams    <a href="https://mvnrepository.com/artifact/org.reactivestreams/reactive-streams/1.0.4" target="_blank">1.0.4</a>    MIT-0
            org.scala-lang    scala-library    <a href="https://mvnrepository.com/artifact/org.scala-lang/scala-library/2.13.12" target="_blank">2.13.12</a>    Apache-2.0
        org.scala-lang    scala-library    <a href="https://mvnrepository.com/artifact/org.scala-lang/scala-library/2.13.12" target="_blank">2.13.12</a>    Apache-2.0
    com.typesafe.akka    akka-protobuf-v3_2.13    <a href="https://mvnrepository.com/artifact/com.typesafe.akka/akka-protobuf-v3_2.13/2.9.1-M1" target="_blank">2.9.1-M1</a>    BUSL-1.1
    com.typesafe.akka    akka-stream_2.13    <a href="https://mvnrepository.com/artifact/com.typesafe.akka/akka-stream_2.13/2.9.1-M1" target="_blank">2.9.1-M1</a>    BUSL-1.1
        com.typesafe.akka    akka-actor_2.13    <a href="https://mvnrepository.com/artifact/com.typesafe.akka/akka-actor_2.13/2.9.1-M1" target="_blank">2.9.1-M1</a>    BUSL-1.1
            com.typesafe    config    <a href="https://mvnrepository.com/artifact/com.typesafe/config/1.4.3" target="_blank">1.4.3</a>    Apache-2.0
            org.scala-lang.modules    scala-java8-compat_2.13    <a href="https://mvnrepository.com/artifact/org.scala-lang.modules/scala-java8-compat_2.13/1.0.2" target="_blank">1.0.2</a>    Apache-2.0
                org.scala-lang    scala-library    <a href="https://mvnrepository.com/artifact/org.scala-lang/scala-library/2.13.12" target="_blank">2.13.12</a>    Apache-2.0
            org.scala-lang    scala-library    <a href="https://mvnrepository.com/artifact/org.scala-lang/scala-library/2.13.12" target="_blank">2.13.12</a>    Apache-2.0
        com.typesafe.akka    akka-protobuf-v3_2.13    <a href="https://mvnrepository.com/artifact/com.typesafe.akka/akka-protobuf-v3_2.13/2.9.1-M1" target="_blank">2.9.1-M1</a>    BUSL-1.1
        org.reactivestreams    reactive-streams    <a href="https://mvnrepository.com/artifact/org.reactivestreams/reactive-streams/1.0.4" target="_blank">1.0.4</a>    MIT-0
        org.scala-lang    scala-library    <a href="https://mvnrepository.com/artifact/org.scala-lang/scala-library/2.13.12" target="_blank">2.13.12</a>    Apache-2.0
    org.scala-lang    scala-library    <a href="https://mvnrepository.com/artifact/org.scala-lang/scala-library/2.13.12" target="_blank">2.13.12</a>    Apache-2.0
com.lightbend.akka    akka-stream-alpakka-cassandra_2.13    <a href="https://mvnrepository.com/artifact/com.lightbend.akka/akka-stream-alpakka-cassandra_2.13/7.0.0" target="_blank">7.0.0</a>    BUSL-1.1
    com.datastax.oss    java-driver-core    <a href="https://mvnrepository.com/artifact/com.datastax.oss/java-driver-core/4.17.0" target="_blank">4.17.0</a>
        com.datastax.oss    java-driver-shaded-guava    <a href="https://mvnrepository.com/artifact/com.datastax.oss/java-driver-shaded-guava/25.1-jre-graal-sub-1" target="_blank">25.1-jre-graal-sub-1</a>    Apache 2
        com.datastax.oss    native-protocol    <a href="https://mvnrepository.com/artifact/com.datastax.oss/native-protocol/1.5.1" target="_blank">1.5.1</a>    Apache 2
        com.fasterxml.jackson.core    jackson-core    <a href="https://mvnrepository.com/artifact/com.fasterxml.jackson.core/jackson-core/2.15.2" target="_blank">2.15.2</a>    The Apache Software License, Version 2.0
        com.fasterxml.jackson.core    jackson-databind    <a href="https://mvnrepository.com/artifact/com.fasterxml.jackson.core/jackson-databind/2.15.2" target="_blank">2.15.2</a>    The Apache Software License, Version 2.0
            com.fasterxml.jackson.core    jackson-annotations    <a href="https://mvnrepository.com/artifact/com.fasterxml.jackson.core/jackson-annotations/2.15.2" target="_blank">2.15.2</a>    The Apache Software License, Version 2.0
            com.fasterxml.jackson.core    jackson-core    <a href="https://mvnrepository.com/artifact/com.fasterxml.jackson.core/jackson-core/2.15.2" target="_blank">2.15.2</a>    The Apache Software License, Version 2.0
        com.github.jnr    jnr-posix    <a href="https://mvnrepository.com/artifact/com.github.jnr/jnr-posix/3.1.15" target="_blank">3.1.15</a>    Eclipse Public License - v 2.0
            com.github.jnr    jnr-constants    <a href="https://mvnrepository.com/artifact/com.github.jnr/jnr-constants/0.10.3" target="_blank">0.10.3</a>    The Apache Software License, Version 2.0
            com.github.jnr    jnr-ffi    <a href="https://mvnrepository.com/artifact/com.github.jnr/jnr-ffi/2.2.11" target="_blank">2.2.11</a>    The Apache Software License, Version 2.0
                com.github.jnr    jffi    <a href="https://mvnrepository.com/artifact/com.github.jnr/jffi/1.3.9" target="_blank">1.3.9</a>    The Apache Software License, Version 2.0
                com.github.jnr    jnr-a64asm    <a href="https://mvnrepository.com/artifact/com.github.jnr/jnr-a64asm/1.0.0" target="_blank">1.0.0</a>    The Apache Software License, Version 2.0
                com.github.jnr    jnr-x86asm    <a href="https://mvnrepository.com/artifact/com.github.jnr/jnr-x86asm/1.0.2" target="_blank">1.0.2</a>    MIT License
                org.ow2.asm    asm-analysis    <a href="https://mvnrepository.com/artifact/org.ow2.asm/asm-analysis/9.2" target="_blank">9.2</a>    BSD-3-Clause
                    org.ow2.asm    asm-tree    <a href="https://mvnrepository.com/artifact/org.ow2.asm/asm-tree/9.2" target="_blank">9.2</a>    BSD-3-Clause
                        org.ow2.asm    asm    <a href="https://mvnrepository.com/artifact/org.ow2.asm/asm/9.2" target="_blank">9.2</a>    BSD-3-Clause
                org.ow2.asm    asm-commons    <a href="https://mvnrepository.com/artifact/org.ow2.asm/asm-commons/9.2" target="_blank">9.2</a>    BSD-3-Clause
                    org.ow2.asm    asm-analysis    <a href="https://mvnrepository.com/artifact/org.ow2.asm/asm-analysis/9.2" target="_blank">9.2</a>    BSD-3-Clause
                        org.ow2.asm    asm-tree    <a href="https://mvnrepository.com/artifact/org.ow2.asm/asm-tree/9.2" target="_blank">9.2</a>    BSD-3-Clause
                            org.ow2.asm    asm    <a href="https://mvnrepository.com/artifact/org.ow2.asm/asm/9.2" target="_blank">9.2</a>    BSD-3-Clause
                    org.ow2.asm    asm-tree    <a href="https://mvnrepository.com/artifact/org.ow2.asm/asm-tree/9.2" target="_blank">9.2</a>    BSD-3-Clause
                        org.ow2.asm    asm    <a href="https://mvnrepository.com/artifact/org.ow2.asm/asm/9.2" target="_blank">9.2</a>    BSD-3-Clause
                    org.ow2.asm    asm    <a href="https://mvnrepository.com/artifact/org.ow2.asm/asm/9.2" target="_blank">9.2</a>    BSD-3-Clause
                org.ow2.asm    asm-tree    <a href="https://mvnrepository.com/artifact/org.ow2.asm/asm-tree/9.2" target="_blank">9.2</a>    BSD-3-Clause
                    org.ow2.asm    asm    <a href="https://mvnrepository.com/artifact/org.ow2.asm/asm/9.2" target="_blank">9.2</a>    BSD-3-Clause
                org.ow2.asm    asm-util    <a href="https://mvnrepository.com/artifact/org.ow2.asm/asm-util/9.2" target="_blank">9.2</a>    BSD-3-Clause
                    org.ow2.asm    asm-analysis    <a href="https://mvnrepository.com/artifact/org.ow2.asm/asm-analysis/9.2" target="_blank">9.2</a>    BSD-3-Clause
                        org.ow2.asm    asm-tree    <a href="https://mvnrepository.com/artifact/org.ow2.asm/asm-tree/9.2" target="_blank">9.2</a>    BSD-3-Clause
                            org.ow2.asm    asm    <a href="https://mvnrepository.com/artifact/org.ow2.asm/asm/9.2" target="_blank">9.2</a>    BSD-3-Clause
                    org.ow2.asm    asm-tree    <a href="https://mvnrepository.com/artifact/org.ow2.asm/asm-tree/9.2" target="_blank">9.2</a>    BSD-3-Clause
                        org.ow2.asm    asm    <a href="https://mvnrepository.com/artifact/org.ow2.asm/asm/9.2" target="_blank">9.2</a>    BSD-3-Clause
                    org.ow2.asm    asm    <a href="https://mvnrepository.com/artifact/org.ow2.asm/asm/9.2" target="_blank">9.2</a>    BSD-3-Clause
                org.ow2.asm    asm    <a href="https://mvnrepository.com/artifact/org.ow2.asm/asm/9.2" target="_blank">9.2</a>    BSD-3-Clause
        com.github.stephenc.jcip    jcip-annotations    <a href="https://mvnrepository.com/artifact/com.github.stephenc.jcip/jcip-annotations/1.0-1" target="_blank">1.0-1</a>    Apache License, Version 2.0
        com.typesafe    config    <a href="https://mvnrepository.com/artifact/com.typesafe/config/1.4.3" target="_blank">1.4.3</a>    Apache-2.0
        io.dropwizard.metrics    metrics-core    <a href="https://mvnrepository.com/artifact/io.dropwizard.metrics/metrics-core/4.1.18" target="_blank">4.1.18</a>
            org.slf4j    slf4j-api    <a href="https://mvnrepository.com/artifact/org.slf4j/slf4j-api/1.7.36" target="_blank">1.7.36</a>
        io.netty    netty-handler    <a href="https://mvnrepository.com/artifact/io.netty/netty-handler/4.1.94.Final" target="_blank">4.1.94.Final</a>
            io.netty    netty-buffer    <a href="https://mvnrepository.com/artifact/io.netty/netty-buffer/4.1.94.Final" target="_blank">4.1.94.Final</a>
                io.netty    netty-common    <a href="https://mvnrepository.com/artifact/io.netty/netty-common/4.1.94.Final" target="_blank">4.1.94.Final</a>
            io.netty    netty-codec    <a href="https://mvnrepository.com/artifact/io.netty/netty-codec/4.1.94.Final" target="_blank">4.1.94.Final</a>
                io.netty    netty-buffer    <a href="https://mvnrepository.com/artifact/io.netty/netty-buffer/4.1.94.Final" target="_blank">4.1.94.Final</a>
                    io.netty    netty-common    <a href="https://mvnrepository.com/artifact/io.netty/netty-common/4.1.94.Final" target="_blank">4.1.94.Final</a>
                io.netty    netty-common    <a href="https://mvnrepository.com/artifact/io.netty/netty-common/4.1.94.Final" target="_blank">4.1.94.Final</a>
                io.netty    netty-transport    <a href="https://mvnrepository.com/artifact/io.netty/netty-transport/4.1.94.Final" target="_blank">4.1.94.Final</a>
                    io.netty    netty-buffer    <a href="https://mvnrepository.com/artifact/io.netty/netty-buffer/4.1.94.Final" target="_blank">4.1.94.Final</a>
                        io.netty    netty-common    <a href="https://mvnrepository.com/artifact/io.netty/netty-common/4.1.94.Final" target="_blank">4.1.94.Final</a>
                    io.netty    netty-common    <a href="https://mvnrepository.com/artifact/io.netty/netty-common/4.1.94.Final" target="_blank">4.1.94.Final</a>
                    io.netty    netty-resolver    <a href="https://mvnrepository.com/artifact/io.netty/netty-resolver/4.1.94.Final" target="_blank">4.1.94.Final</a>
                        io.netty    netty-common    <a href="https://mvnrepository.com/artifact/io.netty/netty-common/4.1.94.Final" target="_blank">4.1.94.Final</a>
            io.netty    netty-common    <a href="https://mvnrepository.com/artifact/io.netty/netty-common/4.1.94.Final" target="_blank">4.1.94.Final</a>
            io.netty    netty-resolver    <a href="https://mvnrepository.com/artifact/io.netty/netty-resolver/4.1.94.Final" target="_blank">4.1.94.Final</a>
                io.netty    netty-common    <a href="https://mvnrepository.com/artifact/io.netty/netty-common/4.1.94.Final" target="_blank">4.1.94.Final</a>
            io.netty    netty-transport-native-unix-common    <a href="https://mvnrepository.com/artifact/io.netty/netty-transport-native-unix-common/4.1.94.Final" target="_blank">4.1.94.Final</a>
                io.netty    netty-buffer    <a href="https://mvnrepository.com/artifact/io.netty/netty-buffer/4.1.94.Final" target="_blank">4.1.94.Final</a>
                    io.netty    netty-common    <a href="https://mvnrepository.com/artifact/io.netty/netty-common/4.1.94.Final" target="_blank">4.1.94.Final</a>
                io.netty    netty-common    <a href="https://mvnrepository.com/artifact/io.netty/netty-common/4.1.94.Final" target="_blank">4.1.94.Final</a>
                io.netty    netty-transport    <a href="https://mvnrepository.com/artifact/io.netty/netty-transport/4.1.94.Final" target="_blank">4.1.94.Final</a>
                    io.netty    netty-buffer    <a href="https://mvnrepository.com/artifact/io.netty/netty-buffer/4.1.94.Final" target="_blank">4.1.94.Final</a>
                        io.netty    netty-common    <a href="https://mvnrepository.com/artifact/io.netty/netty-common/4.1.94.Final" target="_blank">4.1.94.Final</a>
                    io.netty    netty-common    <a href="https://mvnrepository.com/artifact/io.netty/netty-common/4.1.94.Final" target="_blank">4.1.94.Final</a>
                    io.netty    netty-resolver    <a href="https://mvnrepository.com/artifact/io.netty/netty-resolver/4.1.94.Final" target="_blank">4.1.94.Final</a>
                        io.netty    netty-common    <a href="https://mvnrepository.com/artifact/io.netty/netty-common/4.1.94.Final" target="_blank">4.1.94.Final</a>
            io.netty    netty-transport    <a href="https://mvnrepository.com/artifact/io.netty/netty-transport/4.1.94.Final" target="_blank">4.1.94.Final</a>
                io.netty    netty-buffer    <a href="https://mvnrepository.com/artifact/io.netty/netty-buffer/4.1.94.Final" target="_blank">4.1.94.Final</a>
                    io.netty    netty-common    <a href="https://mvnrepository.com/artifact/io.netty/netty-common/4.1.94.Final" target="_blank">4.1.94.Final</a>
                io.netty    netty-common    <a href="https://mvnrepository.com/artifact/io.netty/netty-common/4.1.94.Final" target="_blank">4.1.94.Final</a>
                io.netty    netty-resolver    <a href="https://mvnrepository.com/artifact/io.netty/netty-resolver/4.1.94.Final" target="_blank">4.1.94.Final</a>
                    io.netty    netty-common    <a href="https://mvnrepository.com/artifact/io.netty/netty-common/4.1.94.Final" target="_blank">4.1.94.Final</a>
        org.hdrhistogram    HdrHistogram    <a href="https://mvnrepository.com/artifact/org.hdrhistogram/HdrHistogram/2.1.12" target="_blank">2.1.12</a>    Public Domain, per Creative Commons CC0
        org.reactivestreams    reactive-streams    <a href="https://mvnrepository.com/artifact/org.reactivestreams/reactive-streams/1.0.4" target="_blank">1.0.4</a>    MIT-0
        org.slf4j    slf4j-api    <a href="https://mvnrepository.com/artifact/org.slf4j/slf4j-api/1.7.36" target="_blank">1.7.36</a>
    com.fasterxml.jackson.core    jackson-core    <a href="https://mvnrepository.com/artifact/com.fasterxml.jackson.core/jackson-core/2.15.2" target="_blank">2.15.2</a>    The Apache Software License, Version 2.0
    com.fasterxml.jackson.core    jackson-databind    <a href="https://mvnrepository.com/artifact/com.fasterxml.jackson.core/jackson-databind/2.15.2" target="_blank">2.15.2</a>    The Apache Software License, Version 2.0
        com.fasterxml.jackson.core    jackson-annotations    <a href="https://mvnrepository.com/artifact/com.fasterxml.jackson.core/jackson-annotations/2.15.2" target="_blank">2.15.2</a>    The Apache Software License, Version 2.0
        com.fasterxml.jackson.core    jackson-core    <a href="https://mvnrepository.com/artifact/com.fasterxml.jackson.core/jackson-core/2.15.2" target="_blank">2.15.2</a>    The Apache Software License, Version 2.0
    com.typesafe.akka    akka-stream_2.13    <a href="https://mvnrepository.com/artifact/com.typesafe.akka/akka-stream_2.13/2.9.1-M1" target="_blank">2.9.1-M1</a>    BUSL-1.1
        com.typesafe.akka    akka-actor_2.13    <a href="https://mvnrepository.com/artifact/com.typesafe.akka/akka-actor_2.13/2.9.1-M1" target="_blank">2.9.1-M1</a>    BUSL-1.1
            com.typesafe    config    <a href="https://mvnrepository.com/artifact/com.typesafe/config/1.4.3" target="_blank">1.4.3</a>    Apache-2.0
            org.scala-lang.modules    scala-java8-compat_2.13    <a href="https://mvnrepository.com/artifact/org.scala-lang.modules/scala-java8-compat_2.13/1.0.2" target="_blank">1.0.2</a>    Apache-2.0
                org.scala-lang    scala-library    <a href="https://mvnrepository.com/artifact/org.scala-lang/scala-library/2.13.12" target="_blank">2.13.12</a>    Apache-2.0
            org.scala-lang    scala-library    <a href="https://mvnrepository.com/artifact/org.scala-lang/scala-library/2.13.12" target="_blank">2.13.12</a>    Apache-2.0
        com.typesafe.akka    akka-protobuf-v3_2.13    <a href="https://mvnrepository.com/artifact/com.typesafe.akka/akka-protobuf-v3_2.13/2.9.1-M1" target="_blank">2.9.1-M1</a>    BUSL-1.1
        org.reactivestreams    reactive-streams    <a href="https://mvnrepository.com/artifact/org.reactivestreams/reactive-streams/1.0.4" target="_blank">1.0.4</a>    MIT-0
        org.scala-lang    scala-library    <a href="https://mvnrepository.com/artifact/org.scala-lang/scala-library/2.13.12" target="_blank">2.13.12</a>    Apache-2.0
    org.scala-lang    scala-library    <a href="https://mvnrepository.com/artifact/org.scala-lang/scala-library/2.13.12" target="_blank">2.13.12</a>    Apache-2.0
com.typesafe.akka    akka-persistence-query_2.13    <a href="https://mvnrepository.com/artifact/com.typesafe.akka/akka-persistence-query_2.13/2.9.1-M1" target="_blank">2.9.1-M1</a>    BUSL-1.1
    com.typesafe.akka    akka-persistence_2.13    <a href="https://mvnrepository.com/artifact/com.typesafe.akka/akka-persistence_2.13/2.9.1-M1" target="_blank">2.9.1-M1</a>    BUSL-1.1
        com.typesafe.akka    akka-actor_2.13    <a href="https://mvnrepository.com/artifact/com.typesafe.akka/akka-actor_2.13/2.9.1-M1" target="_blank">2.9.1-M1</a>    BUSL-1.1
            com.typesafe    config    <a href="https://mvnrepository.com/artifact/com.typesafe/config/1.4.3" target="_blank">1.4.3</a>    Apache-2.0
            org.scala-lang.modules    scala-java8-compat_2.13    <a href="https://mvnrepository.com/artifact/org.scala-lang.modules/scala-java8-compat_2.13/1.0.2" target="_blank">1.0.2</a>    Apache-2.0
                org.scala-lang    scala-library    <a href="https://mvnrepository.com/artifact/org.scala-lang/scala-library/2.13.12" target="_blank">2.13.12</a>    Apache-2.0
            org.scala-lang    scala-library    <a href="https://mvnrepository.com/artifact/org.scala-lang/scala-library/2.13.12" target="_blank">2.13.12</a>    Apache-2.0
        com.typesafe.akka    akka-stream_2.13    <a href="https://mvnrepository.com/artifact/com.typesafe.akka/akka-stream_2.13/2.9.1-M1" target="_blank">2.9.1-M1</a>    BUSL-1.1
            com.typesafe.akka    akka-actor_2.13    <a href="https://mvnrepository.com/artifact/com.typesafe.akka/akka-actor_2.13/2.9.1-M1" target="_blank">2.9.1-M1</a>    BUSL-1.1
                com.typesafe    config    <a href="https://mvnrepository.com/artifact/com.typesafe/config/1.4.3" target="_blank">1.4.3</a>    Apache-2.0
                org.scala-lang.modules    scala-java8-compat_2.13    <a href="https://mvnrepository.com/artifact/org.scala-lang.modules/scala-java8-compat_2.13/1.0.2" target="_blank">1.0.2</a>    Apache-2.0
                    org.scala-lang    scala-library    <a href="https://mvnrepository.com/artifact/org.scala-lang/scala-library/2.13.12" target="_blank">2.13.12</a>    Apache-2.0
                org.scala-lang    scala-library    <a href="https://mvnrepository.com/artifact/org.scala-lang/scala-library/2.13.12" target="_blank">2.13.12</a>    Apache-2.0
            com.typesafe.akka    akka-protobuf-v3_2.13    <a href="https://mvnrepository.com/artifact/com.typesafe.akka/akka-protobuf-v3_2.13/2.9.1-M1" target="_blank">2.9.1-M1</a>    BUSL-1.1
            org.reactivestreams    reactive-streams    <a href="https://mvnrepository.com/artifact/org.reactivestreams/reactive-streams/1.0.4" target="_blank">1.0.4</a>    MIT-0
            org.scala-lang    scala-library    <a href="https://mvnrepository.com/artifact/org.scala-lang/scala-library/2.13.12" target="_blank">2.13.12</a>    Apache-2.0
        org.scala-lang    scala-library    <a href="https://mvnrepository.com/artifact/org.scala-lang/scala-library/2.13.12" target="_blank">2.13.12</a>    Apache-2.0
    com.typesafe.akka    akka-protobuf-v3_2.13    <a href="https://mvnrepository.com/artifact/com.typesafe.akka/akka-protobuf-v3_2.13/2.9.1-M1" target="_blank">2.9.1-M1</a>    BUSL-1.1
    com.typesafe.akka    akka-stream_2.13    <a href="https://mvnrepository.com/artifact/com.typesafe.akka/akka-stream_2.13/2.9.1-M1" target="_blank">2.9.1-M1</a>    BUSL-1.1
        com.typesafe.akka    akka-actor_2.13    <a href="https://mvnrepository.com/artifact/com.typesafe.akka/akka-actor_2.13/2.9.1-M1" target="_blank">2.9.1-M1</a>    BUSL-1.1
            com.typesafe    config    <a href="https://mvnrepository.com/artifact/com.typesafe/config/1.4.3" target="_blank">1.4.3</a>    Apache-2.0
            org.scala-lang.modules    scala-java8-compat_2.13    <a href="https://mvnrepository.com/artifact/org.scala-lang.modules/scala-java8-compat_2.13/1.0.2" target="_blank">1.0.2</a>    Apache-2.0
                org.scala-lang    scala-library    <a href="https://mvnrepository.com/artifact/org.scala-lang/scala-library/2.13.12" target="_blank">2.13.12</a>    Apache-2.0
            org.scala-lang    scala-library    <a href="https://mvnrepository.com/artifact/org.scala-lang/scala-library/2.13.12" target="_blank">2.13.12</a>    Apache-2.0
        com.typesafe.akka    akka-protobuf-v3_2.13    <a href="https://mvnrepository.com/artifact/com.typesafe.akka/akka-protobuf-v3_2.13/2.9.1-M1" target="_blank">2.9.1-M1</a>    BUSL-1.1
        org.reactivestreams    reactive-streams    <a href="https://mvnrepository.com/artifact/org.reactivestreams/reactive-streams/1.0.4" target="_blank">1.0.4</a>    MIT-0
        org.scala-lang    scala-library    <a href="https://mvnrepository.com/artifact/org.scala-lang/scala-library/2.13.12" target="_blank">2.13.12</a>    Apache-2.0
    org.scala-lang    scala-library    <a href="https://mvnrepository.com/artifact/org.scala-lang/scala-library/2.13.12" target="_blank">2.13.12</a>    Apache-2.0
org.scala-lang    scala-library    <a href="https://mvnrepository.com/artifact/org.scala-lang/scala-library/2.13.12" target="_blank">2.13.12</a>    Apache-2.0</pre></dd>
</dl>

<h2><a href="#at-least-once" name="at-least-once" class="anchor"><span class="anchor-link"></span></a>at-least-once</h2>

<p>The offset is stored after the envelope has been processed and giving at-least-once processing semantics. This means that if the projection is restarted from a previously stored offset some elements may be processed more than once. Therefore, the <a href="cassandra.html#handler">Handler</a> code must be idempotent.</p>

<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/akka-projection/tree/master/examples/src/it/scala/docs/cassandra/CassandraProjectionDocExample.scala#L27-L29" target="_blank" title="Go to snippet source">source</a><code class="language-scala">import akka.projection.ProjectionId
import akka.projection.cassandra.scaladsl.CassandraProjection

val projection =
  CassandraProjection
    .atLeastOnce(
      projectionId = ProjectionId(&quot;shopping-carts&quot;, &quot;carts-1&quot;),
      sourceProvider,
      handler = () =&gt; new ShoppingCartHandler)
    .withSaveOffset(afterEnvelopes = 100, afterDuration = 500.millis)</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/akka-projection/tree/master/examples/src/it/java/jdocs/cassandra/CassandraProjectionDocExample.java#L41-L44" target="_blank" title="Go to snippet source">source</a><code class="language-java">import akka.projection.cassandra.javadsl.CassandraProjection;
import akka.projection.Projection;
import akka.projection.ProjectionId;

int saveOffsetAfterEnvelopes = 100;
Duration saveOffsetAfterDuration = Duration.ofMillis(500);

Projection&lt;EventEnvelope&lt;ShoppingCart.Event&gt;&gt; projection =
    CassandraProjection.atLeastOnce(
            ProjectionId.of(&quot;shopping-carts&quot;, &quot;carts-1&quot;),
            sourceProvider,
            () -&gt; new ShoppingCartHandler())
        .withSaveOffset(saveOffsetAfterEnvelopes, saveOffsetAfterDuration);</code></pre></dd>
</dl>
<p>The offset is stored after a time window, or limited by a number of envelopes, whatever happens first. This window can be defined with <code>withSaveOffset</code> of the returned <code>AtLeastOnceProjection</code>. The default settings for the window is defined in configuration section <code>akka.projection.at-least-once</code>. There is a performance benefit of not storing the offset too often, but the drawback is that there can be more duplicates when the projection that will be processed again when the projection is restarted.</p>
<p>The <a href="cassandra.html#handler"><code>ShoppingCartHandler</code> is shown below</a>.</p>
<h2><a href="#at-most-once" name="at-most-once" class="anchor"><span class="anchor-link"></span></a>at-most-once</h2>
<p>The offset for each envelope is stored before the envelope has been processed and giving at-most-once processing semantics. This means that if the projection is restarted from previously stored offset one envelope may not have been processed.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/akka-projection/tree/master/examples/src/it/scala/docs/cassandra/CassandraProjectionDocExample.scala#L27-L29" target="_blank" title="Go to snippet source">source</a><code class="language-scala">import akka.projection.ProjectionId
import akka.projection.cassandra.scaladsl.CassandraProjection

val projection =
  CassandraProjection.atMostOnce(
    projectionId = ProjectionId(&quot;shopping-carts&quot;, &quot;carts-1&quot;),
    sourceProvider,
    handler = () =&gt; new ShoppingCartHandler)</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/akka-projection/tree/master/examples/src/it/java/jdocs/cassandra/CassandraProjectionDocExample.java#L149-L151" target="_blank" title="Go to snippet source">source</a><code class="language-java">Projection&lt;EventEnvelope&lt;ShoppingCart.Event&gt;&gt; projection =
    CassandraProjection.atMostOnce(
        ProjectionId.of(&quot;shopping-carts&quot;, &quot;carts-1&quot;), sourceProvider, ShoppingCartHandler::new);</code></pre></dd>
</dl>
<p>Since the offset must be stored for each envelope this is slower than <a href="cassandra.html#at-least-once">at-least-once</a>, which can batch offsets before storing.</p>
<p>The <a href="cassandra.html#handler"><code>ShoppingCartHandler</code> is shown below</a>.</p>
<h2><a href="#groupedwithin" name="groupedwithin" class="anchor"><span class="anchor-link"></span></a>groupedWithin</h2>
<p>The envelopes can be grouped before processing, which can be useful for batch updates.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/akka-projection/tree/master/examples/src/it/scala/docs/cassandra/CassandraProjectionDocExample.scala#L113-L119" target="_blank" title="Go to snippet source">source</a><code class="language-scala">val projection =
  CassandraProjection
    .groupedWithin(
      projectionId = ProjectionId(&quot;shopping-carts&quot;, &quot;carts-1&quot;),
      sourceProvider,
      handler = () =&gt; new GroupedShoppingCartHandler)
    .withGroup(groupAfterEnvelopes = 20, groupAfterDuration = 500.millis)</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/akka-projection/tree/master/examples/src/it/java/jdocs/cassandra/CassandraProjectionDocExample.java#L163-L171" target="_blank" title="Go to snippet source">source</a><code class="language-java">int groupAfterEnvelopes = 20;
Duration groupAfterDuration = Duration.ofMillis(500);

Projection&lt;EventEnvelope&lt;ShoppingCart.Event&gt;&gt; projection =
    CassandraProjection.groupedWithin(
            ProjectionId.of(&quot;shopping-carts&quot;, &quot;carts-1&quot;),
            sourceProvider,
            GroupedShoppingCartHandler::new)
        .withGroup(groupAfterEnvelopes, groupAfterDuration);</code></pre></dd>
</dl>
<p>The envelopes are grouped within a time window, or limited by a number of envelopes, whatever happens first. This window can be defined with <code>withGroup</code> of the returned <code>GroupedProjection</code>. The default settings for the window is defined in configuration section <code>akka.projection.grouped</code>.</p>
<p>When using <code>groupedWithin</code> the handler is a <span class="group-scala"><code>Handler[immutable.Seq[EventEnvelope[ShoppingCart.Event]]]</code></span><span class="group-java"><code>Handler&lt;List&lt;EventEnvelope&lt;ShoppingCart.Event&gt;&gt;&gt;</code></span>. The <a href="cassandra.html#grouped-handler"><code>GroupedShoppingCartHandler</code> is shown below</a>.</p>
<p>It stores the offset in Cassandra immediately after the <code>handler</code> has processed the envelopes, but that is still with at-least-once processing semantics. This means that if the projection is restarted from previously stored offset the previous group of envelopes may be processed more than once.</p>
<h2><a href="#handler" name="handler" class="anchor"><span class="anchor-link"></span></a>Handler</h2>
<p>It&rsquo;s in the <span class="group-java"><a href="/api/akka-projection/1.5.1-M1/akka/projection/javadsl/Handler.html" title="akka.projection.javadsl.Handler"><code>Handler</code></a></span><span class="group-scala"><a href="/api/akka-projection/1.5.1-M1/akka/projection/scaladsl/Handler.html" title="akka.projection.scaladsl.Handler"><code>Handler</code></a></span> that you implement the processing of each envelope. It&rsquo;s essentially a function from <code>Envelope</code> to <span class="group-scala"><code>Future[Done]</code></span><span class="group-java"><code>CompletionStage&lt;Done&gt;</code></span>. This means that the envelope handler can integrate with anything, such as publishing to a message broker, or updating a read model in Cassandra.</p>
<p>A handler that is consuming <code>ShoppingCart.Event</code> from <code>eventsByTag</code> can look like this:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/akka-projection/tree/master/examples/src/it/scala/docs/cassandra/CassandraProjectionDocExample.scala#L33-L39" target="_blank" title="Go to snippet source">source</a><code class="language-scala">import scala.concurrent.duration._
import scala.concurrent.Future

import akka.Done
import akka.projection.scaladsl.Handler
import org.slf4j.LoggerFactory

class ShoppingCartHandler extends Handler[EventEnvelope[ShoppingCart.Event]] {
  private val logger = LoggerFactory.getLogger(getClass)

  override def process(envelope: EventEnvelope[ShoppingCart.Event]): Future[Done] = {
    envelope.event match {
      case ShoppingCart.CheckedOut(cartId, time) =&gt;
        logger.info2(&quot;Shopping cart {} was checked out at {}&quot;, cartId, time)
        Future.successful(Done)

      case otherEvent =&gt;
        logger.debug2(&quot;Shopping cart {} changed by {}&quot;, otherEvent.cartId, otherEvent)
        Future.successful(Done)
    }
  }
}</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/akka-projection/tree/master/examples/src/it/java/jdocs/cassandra/CassandraProjectionDocExample.java#L48-L56" target="_blank" title="Go to snippet source">source</a><code class="language-java">import akka.projection.javadsl.Handler;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

import java.util.List;
import java.util.Optional;
import java.util.concurrent.CompletableFuture;
import java.util.concurrent.CompletionStage;

public class ShoppingCartHandler extends Handler&lt;EventEnvelope&lt;ShoppingCart.Event&gt;&gt; {
  private Logger logger = LoggerFactory.getLogger(getClass());

  @Override
  public CompletionStage&lt;Done&gt; process(EventEnvelope&lt;ShoppingCart.Event&gt; envelope) {
    ShoppingCart.Event event = envelope.event();
    if (event instanceof ShoppingCart.CheckedOut) {
      ShoppingCart.CheckedOut checkedOut = (ShoppingCart.CheckedOut) event;
      logger.info(
          &quot;Shopping cart {} was checked out at {}&quot;, checkedOut.cartId, checkedOut.eventTime);
      return CompletableFuture.completedFuture(Done.getInstance());
    } else {
      logger.debug(&quot;Shopping cart {} changed by {}&quot;, event.getCartId(), event);
      return CompletableFuture.completedFuture(Done.getInstance());
    }
  }
}</code></pre></dd>
</dl><div class="callout note "><div class="callout-title">Hint</div>
<p>Such simple handlers can also be defined as plain <span class="group-scala">functions</span><span class="group-java">lambdas</span> via the helper <span class="group-scala"><code>Handler.apply</code></span><span class="group-java"><code>Handler.fromFunction</code></span> factory method.</p></div>
<h3><a href="#grouped-handler" name="grouped-handler" class="anchor"><span class="anchor-link"></span></a>Grouped handler</h3>
<p>When using <a href="cassandra.html#groupedwithin"><code>CassandraProjection.groupedWithin</code></a> the handler is processing a <span class="group-scala"><code>Seq</code></span><span class="group-java"><code>List</code></span> of envelopes.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/akka-projection/tree/master/examples/src/it/scala/docs/cassandra/CassandraProjectionDocExample.scala#L65-L80" target="_blank" title="Go to snippet source">source</a><code class="language-scala">import scala.collection.immutable

class GroupedShoppingCartHandler extends Handler[immutable.Seq[EventEnvelope[ShoppingCart.Event]]] {
  private val logger = LoggerFactory.getLogger(getClass)

  override def process(envelopes: immutable.Seq[EventEnvelope[ShoppingCart.Event]]): Future[Done] = {
    envelopes.map(_.event).foreach {
      case ShoppingCart.CheckedOut(cartId, time) =&gt;
        logger.info2(&quot;Shopping cart {} was checked out at {}&quot;, cartId, time)

      case otherEvent =&gt;
        logger.debug2(&quot;Shopping cart {} changed by {}&quot;, otherEvent.cartId, otherEvent)
    }
    Future.successful(Done)
  }
}</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/akka-projection/tree/master/examples/src/it/java/jdocs/cassandra/CassandraProjectionDocExample.java#L97-L117" target="_blank" title="Go to snippet source">source</a><code class="language-java">public class GroupedShoppingCartHandler extends Handler&lt;List&lt;EventEnvelope&lt;ShoppingCart.Event&gt;&gt;&gt; {
  private Logger logger = LoggerFactory.getLogger(getClass());

  @Override
  public CompletionStage&lt;Done&gt; process(List&lt;EventEnvelope&lt;ShoppingCart.Event&gt;&gt; envelopes) {
    envelopes.forEach(
        env -&gt; {
          ShoppingCart.Event event = env.event();
          if (event instanceof ShoppingCart.CheckedOut) {
            ShoppingCart.CheckedOut checkedOut = (ShoppingCart.CheckedOut) event;
            logger.info(
                &quot;Shopping cart {} was checked out at {}&quot;,
                checkedOut.cartId,
                checkedOut.eventTime);
          } else {
            logger.debug(&quot;Shopping cart {} changed by {}&quot;, event.getCartId(), event);
          }
        });
    return CompletableFuture.completedFuture(Done.getInstance());
  }
}</code></pre></dd>
</dl>
<h3><a href="#stateful-handler" name="stateful-handler" class="anchor"><span class="anchor-link"></span></a>Stateful handler</h3>
<p>The <code>Handler</code> can be stateful, with variables and mutable data structures. It is invoked by the <code>Projection</code> machinery one envelope at a time and visibility guarantees between the invocations are handled automatically, i.e. no volatile or other concurrency primitives are needed for managing the state.</p>
<p>The returned <span class="group-scala"><code>Future[Done]</code></span><span class="group-java"><code>CompletionStage&lt;Done&gt;</code></span> is to be completed when the processing of the <code>envelope</code> has finished. The handler will not be invoked with the next envelope until after the returned <span class="group-scala"><code>Future[Done]</code></span><span class="group-java"><code>CompletionStage&lt;Done&gt;</code></span> has been completed.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/akka-projection/tree/master/examples/src/it/scala/docs/cassandra/WordCountDocExample.scala#L104-L115" target="_blank" title="Go to snippet source">source</a><code class="language-scala">class WordCountHandler extends Handler[WordEnvelope] {
  private val logger = LoggerFactory.getLogger(getClass)
  private var state: Map[Word, Count] = Map.empty

  override def process(envelope: WordEnvelope): Future[Done] = {
    val word = envelope.word
    val newCount = state.getOrElse(word, 0) + 1
    logger.info(&quot;Word count for {} is {}&quot;, word, newCount)
    state = state.updated(word, newCount)
    Future.successful(Done)
  }
}</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/akka-projection/tree/master/examples/src/it/java/jdocs/cassandra/WordCountDocExample.java#L172-L184" target="_blank" title="Go to snippet source">source</a><code class="language-java">public class WordCountHandler extends Handler&lt;WordEnvelope&gt; {
  private final Logger logger = LoggerFactory.getLogger(getClass());
  private final Map&lt;String, Integer&gt; state = new HashMap&lt;&gt;();

  @Override
  public CompletionStage&lt;Done&gt; process(WordEnvelope envelope) {
    String word = envelope.word;
    int newCount = state.getOrDefault(word, 0) + 1;
    logger.info(&quot;Word count for {} is {}&quot;, word, newCount);
    state.put(word, newCount);
    return CompletableFuture.completedFuture(Done.getInstance());
  }
}</code></pre></dd>
</dl><div class="callout note "><div class="callout-title">Note</div>
<p>It is important that the <code>Handler</code> instance is not shared between several <code>Projection</code> instances, because then it would be invoked concurrently, which is not how it is intended to be used. Each <code>Projection</code> instance should use a new <code>Handler</code> instance. This is the reason why the handler parameter is a factory <span class="group-scala">(<code>() =&gt;</code>)</span><span class="group-java">(<code>Supplier</code>)</span> of the handler. A new handler instance is also created when the projection is restarted. </p></div>
<p>However, the state must typically be loaded and updated by asynchronous operations and then it can be error prone to manage the state in variables of the <code>Handler</code>. For that purpose a <span class="group-java"><a href="/api/akka-projection/1.5.1-M1/akka/projection/javadsl/StatefulHandler.html" title="akka.projection.javadsl.StatefulHandler"><code>StatefulHandler</code></a></span><span class="group-scala"><a href="/api/akka-projection/1.5.1-M1/akka/projection/scaladsl/StatefulHandler.html" title="akka.projection.scaladsl.StatefulHandler"><code>StatefulHandler</code></a></span> is provided.</p>
<p>Let us look at how a <code>StatefulHandler</code> can be implemented in the context of a &ldquo;word count&rdquo; domain. The purpose is to process a stream of words and for each word keep track of how many times it has occurred. </p>
<p>Given an envelope and <code>SourceProvider</code> for this example:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/akka-projection/tree/master/examples/src/it/scala/docs/cassandra/WordCountDocExample.scala#L28-L32" target="_blank" title="Go to snippet source">source</a><code class="language-scala">type Word = String
type Count = Int

final case class WordEnvelope(offset: Long, word: Word)

class WordSource(implicit ec: ExecutionContext) extends SourceProvider[Long, WordEnvelope] {

  private val src = Source(
    List(WordEnvelope(1L, &quot;abc&quot;), WordEnvelope(2L, &quot;def&quot;), WordEnvelope(3L, &quot;ghi&quot;), WordEnvelope(4L, &quot;abc&quot;)))

  override def source(offset: () =&gt; Future[Option[Long]]): Future[Source[WordEnvelope, NotUsed]] = {
    offset().map {
      case Some(o) =&gt; src.dropWhile(_.offset &lt;= o)
      case _       =&gt; src
    }
  }

  override def extractOffset(env: WordEnvelope): Long = env.offset

  override def extractCreationTime(env: WordEnvelope): Long = 0L
}</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/akka-projection/tree/master/examples/src/it/java/jdocs/cassandra/WordCountDocExample.java#L54-L63" target="_blank" title="Go to snippet source">source</a><code class="language-java">public class WordEnvelope {
  public final Long offset;
  public final String word;

  public WordEnvelope(Long offset, String word) {
    this.offset = offset;
    this.word = word;
  }
}

class WordSource extends SourceProvider&lt;Long, WordEnvelope&gt; {

  private final Source&lt;WordEnvelope, NotUsed&gt; src =
      Source.from(
          Arrays.asList(
              new WordEnvelope(1L, &quot;abc&quot;),
              new WordEnvelope(2L, &quot;def&quot;),
              new WordEnvelope(3L, &quot;ghi&quot;),
              new WordEnvelope(4L, &quot;abc&quot;)));

  @Override
  public CompletionStage&lt;Source&lt;WordEnvelope, NotUsed&gt;&gt; source(
      Supplier&lt;CompletionStage&lt;Optional&lt;Long&gt;&gt;&gt; offset) {
    return offset
        .get()
        .thenApply(
            o -&gt; {
              if (o.isPresent()) return src.dropWhile(envelope -&gt; envelope.offset &lt;= o.get());
              else return src;
            });
  }

  @Override
  public Long extractOffset(WordEnvelope envelope) {
    return envelope.offset;
  }

  @Override
  public long extractCreationTime(WordEnvelope envelope) {
    return 0L;
  }
}</code></pre></dd>
</dl>
<p>and a repository for the interaction with the database:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/akka-projection/tree/master/examples/src/it/scala/docs/cassandra/WordCountDocExample.scala#L36-L40" target="_blank" title="Go to snippet source">source</a><code class="language-scala">trait WordCountRepository {
  def load(id: String, word: Word): Future[Count]
  def loadAll(id: String): Future[Map[Word, Count]]
  def save(id: String, word: Word, count: Count): Future[Done]
}</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/akka-projection/tree/master/examples/src/it/java/jdocs/cassandra/WordCountDocExample.java#L67-L73" target="_blank" title="Go to snippet source">source</a><code class="language-java">public interface WordCountRepository {
  CompletionStage&lt;Integer&gt; load(String id, String word);

  CompletionStage&lt;Map&lt;String, Integer&gt;&gt; loadAll(String id);

  CompletionStage&lt;Done&gt; save(String id, String word, int count);
}</code></pre></dd>
</dl>
<p>The <code>Projection</code> can be definined as:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/akka-projection/tree/master/examples/src/it/scala/docs/cassandra/WordCountDocExampleSpec.scala#L78-L83" target="_blank" title="Go to snippet source">source</a><code class="language-scala">val projection =
  CassandraProjection
    .atLeastOnce[Long, WordEnvelope](
      projectionId,
      sourceProvider = new WordSource,
      handler = () =&gt; new WordCountHandler(projectionId, repository))</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/akka-projection/tree/master/examples/src/it/java/jdocs/cassandra/WordCountDocExampleTest.java#L100-L102" target="_blank" title="Go to snippet source">source</a><code class="language-java">Projection&lt;WordEnvelope&gt; projection =
    CassandraProjection.atLeastOnce(
        projectionId, new WordSource(), () -&gt; new WordCountHandler(projectionId, repository));</code></pre></dd>
</dl>
<p>The <code>handler</code> can be implemented as follows.</p>
<p>A naive approach would be to have one row per word for storing the current count in the database. The handler could be implemented as a completely stateless handler that for each processed envelope loads the current count from the database, increment the count by 1 and saved it again. Typically there will be several instances of the <code>Projection</code> with different <code>ProjectionId.id</code>. Each <code>Projection</code> instance would be responsible for processing a subset of all words. This stateless approach wouldn&rsquo;t be very efficient and you would have to use optimistic database locking to make sure that one <code>Projection</code> instance is not overwriting the stored value from another instance without reading the right value first.</p>
<p>Better would be that each <code>Projection</code> instance is a single-writer so that it can keep the current word count in memory and only load it on startup or on demand.</p>
<p>A handler that is loading the state from the database when it&rsquo;s starting up:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/akka-projection/tree/master/examples/src/it/scala/docs/cassandra/WordCountDocExample.scala#L122-L138" target="_blank" title="Go to snippet source">source</a><code class="language-scala">import akka.projection.scaladsl.StatefulHandler

class WordCountHandler(projectionId: ProjectionId, repository: WordCountRepository)(implicit ec: ExecutionContext)
    extends StatefulHandler[Map[Word, Count], WordEnvelope] {

  override def initialState(): Future[Map[Word, Count]] = repository.loadAll(projectionId.id)

  override def process(state: Map[Word, Count], envelope: WordEnvelope): Future[Map[Word, Count]] = {
    val word = envelope.word
    val newCount = state.getOrElse(word, 0) + 1
    val newState = for {
      _ &lt;- repository.save(projectionId.id, word, newCount)
    } yield state.updated(word, newCount)

    newState
  }
}</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/akka-projection/tree/master/examples/src/it/java/jdocs/cassandra/WordCountDocExample.java#L8-L15" target="_blank" title="Go to snippet source">source</a><code class="language-java">import akka.actor.typed.ActorSystem;
import akka.actor.typed.SupervisorStrategy;
import akka.actor.typed.javadsl.AskPattern;
import akka.actor.typed.javadsl.StashBuffer;
import akka.projection.cassandra.CassandraProjectionTest;
import akka.projection.javadsl.ActorHandler;
import akka.projection.javadsl.StatefulHandler;

public class WordCountHandler extends StatefulHandler&lt;Map&lt;String, Integer&gt;, WordEnvelope&gt; {
  private final ProjectionId projectionId;
  private final WordCountRepository repository;

  public WordCountHandler(ProjectionId projectionId, WordCountRepository repository) {
    this.projectionId = projectionId;
    this.repository = repository;
  }

  @Override
  public CompletionStage&lt;Map&lt;String, Integer&gt;&gt; initialState() {
    return repository.loadAll(projectionId.id());
  }

  @Override
  public CompletionStage&lt;Map&lt;String, Integer&gt;&gt; process(
      Map&lt;String, Integer&gt; state, WordEnvelope envelope) {
    String word = envelope.word;
    int newCount = state.getOrDefault(word, 0) + 1;
    CompletionStage&lt;Map&lt;String, Integer&gt;&gt; newState =
        repository
            .save(projectionId.id(), word, newCount)
            .thenApply(
                done -&gt; {
                  state.put(word, newCount);
                  return state;
                });

    return newState;
  }
}</code></pre></dd>
</dl>
<p>The <code>StatefulHandler</code> has two methods that needs to be implemented. </p>
<ul>
  <li><code>initialState</code> - Invoked to load the initial state when the projection is started or if previous <code>process</code> failed.</li>
  <li><code>process(state, envelope)</code> - Invoked for each <code>Envelope</code>, one at a time. The <code>state</code> parameter is the completed  value of the previously returned <span class="group-scala"><code>Future[State]</code></span><span class="group-java"><code>CompletionStage&lt;State&gt;</code></span> or the <code>initialState</code>.</li>
</ul>
<p>If the previously returned <span class="group-scala"><code>Future[State]</code></span><span class="group-java"><code>CompletionStage&lt;State&gt;</code></span> failed it will call <code>initialState</code> again and use that value.</p>
<p>Another implementation would be a handler that is loading the current count for a word on demand, and thereafter caches it in the in-memory state:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/akka-projection/tree/master/examples/src/it/scala/docs/cassandra/WordCountDocExample.scala#L145-L173" target="_blank" title="Go to snippet source">source</a><code class="language-scala">import akka.projection.scaladsl.StatefulHandler

class WordCountHandler(projectionId: ProjectionId, repository: WordCountRepository)(implicit ec: ExecutionContext)
    extends StatefulHandler[Map[Word, Count], WordEnvelope] {

  override def initialState(): Future[Map[Word, Count]] =
    Future.successful(Map.empty)

  override def process(state: Map[Word, Count], envelope: WordEnvelope): Future[Map[Word, Count]] = {
    val word = envelope.word

    val currentCount =
      state.get(word) match {
        case None =&gt;
          repository.load(projectionId.id, word)
        case Some(count) =&gt;
          Future.successful(count)
      }

    val newState = for {
      c &lt;- currentCount
      newCount = c + 1
      _ &lt;- repository.save(projectionId.id, word, newCount)
    } yield state.updated(word, newCount)

    newState
  }

}</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/akka-projection/tree/master/examples/src/it/java/jdocs/cassandra/WordCountDocExample.java#L8-L15" target="_blank" title="Go to snippet source">source</a><code class="language-java">import akka.actor.typed.ActorSystem;
import akka.actor.typed.SupervisorStrategy;
import akka.actor.typed.javadsl.AskPattern;
import akka.actor.typed.javadsl.StashBuffer;
import akka.projection.cassandra.CassandraProjectionTest;
import akka.projection.javadsl.ActorHandler;
import akka.projection.javadsl.StatefulHandler;

public class WordCountHandler extends StatefulHandler&lt;Map&lt;String, Integer&gt;, WordEnvelope&gt; {
  private final ProjectionId projectionId;
  private final WordCountRepository repository;

  public WordCountHandler(ProjectionId projectionId, WordCountRepository repository) {
    this.projectionId = projectionId;
    this.repository = repository;
  }

  @Override
  public CompletionStage&lt;Map&lt;String, Integer&gt;&gt; initialState() {
    return CompletableFuture.completedFuture(new HashMap&lt;&gt;());
  }

  @Override
  public CompletionStage&lt;Map&lt;String, Integer&gt;&gt; process(
      Map&lt;String, Integer&gt; state, WordEnvelope envelope) {
    String word = envelope.word;

    CompletionStage&lt;Integer&gt; currentCount;
    if (state.containsKey(word))
      currentCount = CompletableFuture.completedFuture(state.get(word));
    else currentCount = repository.load(projectionId.id(), word);

    CompletionStage&lt;Map&lt;String, Integer&gt;&gt; newState =
        currentCount.thenCompose(
            n -&gt; {
              return repository
                  .save(projectionId.id(), word, n + 1)
                  .thenApply(
                      done -&gt; {
                        state.put(word, n + 1);
                        return state;
                      });
            });

    return newState;
  }
}</code></pre></dd>
</dl>
<h3><a href="#actor-handler" name="actor-handler" class="anchor"><span class="anchor-link"></span></a>Actor handler</h3>
<p>A good alternative for advanced state management is to implement the handler as an <a href="https://doc.akka.io/docs/akka/current/typed/actors.html">actor</a>, which is described in <a href="actor.html">Processing with Actor</a>.</p>
<h3><a href="#flow-handler" name="flow-handler" class="anchor"><span class="anchor-link"></span></a>Flow handler</h3>
<p>An Akka Streams <code>FlowWithContext</code> can be used instead of a handler for processing the envelopes, which is described in <a href="flow.html">Processing with Akka Streams</a>.</p>
<h3><a href="#handler-lifecycle" name="handler-lifecycle" class="anchor"><span class="anchor-link"></span></a>Handler lifecycle</h3>
<p>You can override the <code>start</code> and <code>stop</code> methods of the <span class="group-java"><a href="/api/akka-projection/1.5.1-M1/akka/projection/javadsl/Handler.html" title="akka.projection.javadsl.Handler"><code>Handler</code></a></span><span class="group-scala"><a href="/api/akka-projection/1.5.1-M1/akka/projection/scaladsl/Handler.html" title="akka.projection.scaladsl.Handler"><code>Handler</code></a></span> to implement initialization before first envelope is processed and resource cleanup when the projection is stopped. Those methods are also called when the <code>Projection</code> is restarted after failure.</p>
<p>See also <a href="error.html">error handling</a>.</p>
<h2><a href="#schema" name="schema" class="anchor"><span class="anchor-link"></span></a>Schema</h2>
<p>The database schema for the offset storage table.</p><div class="callout note "><div class="callout-title">Note</div>
<p>The <code>partition</code> field is used to distribute projection rows across cassandra nodes while also allowing us to query all rows for a projection name. For most offset types we return only one row that matches the provided projection key, but the <span class="group-scala"><a href="/api/akka-projection/1.5.1-M1/akka/projection/MergeableOffset.html" title="akka.projection.MergeableOffset"><code>MergeableOffset</code></a></span><span class="group-java"><a href="/api/akka-projection/1.5.1-M1/akka/projection/MergeableOffset.html" title="akka.projection.MergeableOffset"><code>MergeableOffset</code></a></span> requires all rows.</p></div>
<pre><code>CREATE TABLE IF NOT EXISTS akka_projection.offset_store (
  projection_name text,
  partition int,
  projection_key text,
  offset text,
  manifest text,
  last_updated timestamp,
  PRIMARY KEY ((projection_name, partition), projection_key));

CREATE TABLE IF NOT EXISTS akka_projection.projection_management (
  projection_name text,
  partition int,
  projection_key text,
  paused boolean,
  last_updated timestamp,
  PRIMARY KEY ((projection_name, partition), projection_key));
</code></pre>
<h2><a href="#offset-types" name="offset-types" class="anchor"><span class="anchor-link"></span></a>Offset types</h2>
<p>The supported offset types of the <code>CassandraProjection</code> are:</p>
<ul>
  <li><code>akka.persistence.query.Offset</code> types from <a href="eventsourced.html">events from Akka Persistence</a></li>
  <li><code>String</code></li>
  <li><span class="group-scala"><code>Int</code></span><span class="group-java">Integer</span></li>
  <li><code>Long</code></li>
  <li>Any other type that has a configured Akka Serializer is stored with base64 encoding of the serialized bytes.</li>
</ul><div class="callout note "><div class="callout-title">Note</div>
<p>The <span class="group-scala"><a href="/api/akka-projection/1.5.1-M1/akka/projection/MergeableOffset.html" title="akka.projection.MergeableOffset"><code>MergeableOffset</code></a></span><span class="group-java"><a href="/api/akka-projection/1.5.1-M1/akka/projection/MergeableOffset.html" title="akka.projection.MergeableOffset"><code>MergeableOffset</code></a></span> that is used for <a href="kafka.html">messages from Kafka</a> is not implemented for the <code>CassandraProjection</code> yet, see <a href="https://github.com/akka/akka-projection/issues/97">issue #97</a>.</p></div>
<p>The schema can be created using the method <code>CassandraProjection.createTablesIfNotExists</code>. This is particularly useful when writting tests. For production enviornments, we recommend creating the schema before deploying the application.</p>
<h2><a href="#configuration" name="configuration" class="anchor"><span class="anchor-link"></span></a>Configuration</h2>
<p>Make your edits/overrides in your application.conf.</p>
<p>The reference configuration file with the default values:</p>
<pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/akka-projection/tree/master/akka-projection-cassandra/src/main/resources/reference.conf#L5-L39" target="_blank" title="Go to snippet source">source</a><code class="language-conf">akka.projection.cassandra {

  session-config-path = &quot;akka.projection.cassandra.session-config&quot;

  session-config {
    # The implementation of `akka.stream.alpakka.cassandra.CqlSessionProvider`
    # used for creating the `CqlSession`.
    # It may optionally have a constructor with an `ClassicActorSystemProvider` and `Config` parameters.
    session-provider = &quot;akka.stream.alpakka.cassandra.DefaultSessionProvider&quot;

    # Configure Akka Discovery by setting a service name
    service-discovery {
      name = &quot;&quot;
      lookup-timeout = 1 s
    }

    # The ExecutionContext to use for the session tasks and future composition.
    session-dispatcher = &quot;akka.actor.default-dispatcher&quot;

    # Full config path to the Datastax Java driver&#39;s configuration section.
    # When connecting to more than one Cassandra cluster different session configuration can be
    # defined with this property.
    # and https://docs.datastax.com/en/developer/java-driver/latest/manual/core/configuration/reference/
    datastax-java-driver-config = &quot;datastax-java-driver&quot;
  }

  offset-store {
    keyspace = &quot;akka_projection&quot;
    # the database table name for the offset store
    table = &quot;offset_store&quot;
    # the database table name for the projection manangement data
    management-table = &quot;projection_management&quot;
  }
}</code></pre>
<h3><a href="#cassandra-driver-configuration" name="cassandra-driver-configuration" class="anchor"><span class="anchor-link"></span></a>Cassandra driver configuration</h3>
<p>All Cassandra driver settings are via its <a href="https://docs.datastax.com/en/developer/java-driver/latest/manual/core/configuration/">standard profile mechanism</a>.</p>
<p>One important setting is to configure the database driver to retry the initial connection:</p>
<p><code>datastax-java-driver.advanced.reconnect-on-init = true</code></p>
<p>It is not enabled automatically as it is in the driver&rsquo;s reference.conf and is not overridable in a profile.</p>
<p>It is possible to share the same Cassandra session as <a href="https://doc.akka.io/docs/akka-persistence-cassandra/current/">Akka Persistence Cassandra</a> by setting the <code>session-config-path</code>:</p>
<pre><code>akka.projection.cassandra {
  session-config-path = &quot;akka.persistence.cassandra&quot;
}
</code></pre>
<p>or share the same Cassandra session as <a href="https://doc.akka.io/docs/alpakka/2.0/cassandra.html">Alpakka Cassandra</a>:</p>
<pre><code>akka.projection.cassandra {
  session-config-path = &quot;alpakka.cassandra&quot;
}
</code></pre>
<h3><a href="#cassandra-driver-overrides" name="cassandra-driver-overrides" class="anchor"><span class="anchor-link"></span></a>Cassandra driver overrides</h3>
<pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/akka-projection/tree/master/akka-projection-cassandra/src/main/resources/reference.conf#L43-L61" target="_blank" title="Go to snippet source">source</a><code class="language-conf"># See reference configuration at
# https://docs.datastax.com/en/developer/java-driver/latest/manual/core/configuration/reference/
# (check which exact version Akka Projections uses)
datastax-java-driver {

  # always set this to allow reconnection on startup if cassandra is down
  # not overridiable profile so this plugin can&#39;t override it for you
  # advanced.reconnect-on-init = true

  profiles {
    akka-projection-cassandra-profile {
      basic.request {
        consistency = QUORUM
        # the offset store does not use any counters or collections
        default-idempotence = true
      }
    }
  }
}</code></pre>
<h3><a href="#contact-points-configuration" name="contact-points-configuration" class="anchor"><span class="anchor-link"></span></a>Contact points configuration</h3>
<p>The Cassandra server contact points can be defined with the <a href="https://docs.datastax.com/en/developer/java-driver/latest/manual/core/configuration/">Cassandra driver configuration</a></p>
<pre><code>datastax-java-driver {
  basic.contact-points = [&quot;127.0.0.1:9042&quot;]
  basic.load-balancing-policy.local-datacenter = &quot;datacenter1&quot;
}
</code></pre>
<p>Alternatively, Akka Discovery can be used for finding the Cassandra server contact points as described in the <a href="https://doc.akka.io/docs/alpakka/2.0/cassandra.html#using-akka-discovery">Alpakka Cassandra documentation</a>.</p>
<p>Without any configuration it will use <code>localhost:9042</code> as default.</p>
</div>
</article>
<div class="row">
<div class="small-12 column">
<section class="nav-prev-next row">
<div class="nav-prev small-6 column">
<a href="r2dbc.html"><i class="icon-prev"></i> <span class="link-prev">Offset in a relational DB with R2DBC</span></a>
</div>
<div class="nav-next small-6 column clearfix">
<a class="float-right" href="jdbc.html">Offset in a relational DB with JDBC <i class="icon-next"></i></a>
</div>
</section>
</div>
</div>
<div class="source-github row">
Found an error in this documentation? The source code for this page can be found <a href="https://github.com/akka/akka-projection/tree/master/docs/src/main/paradox/cassandra.md">here</a>.
Please feel free to edit and contribute a pull request.
</div>

<footer class="page-footer row clearfix">
<img class="akka-icon float-left show-for-medium" src="images/akka-icon.svg" />
<section class="copyright">
<div>Akka Projections is available under the <a href="https://www.lightbend.com/akka/license" target="_blank">Business Source License 1.1</a>.</div>
<p class="legal">
&copy; 2011-2023 <a href="https://www.lightbend.com" target="_blank">Lightbend, Inc.</a> |
<a href="https://www.lightbend.com/legal/licenses" target="_blank">Licenses</a> |
<a href="https://www.lightbend.com/legal/terms" target="_blank">Terms</a> |
<a href="https://www.lightbend.com/legal/privacy" target="_blank">Privacy Policy</a> |
<a href="https://akka.io/cookie/" target="_blank">Cookie Listing</a> |
<a class="optanon-toggle-display">Cookie Settings</a>
</p>
</section>

</footer>
</section>
</main>
</div>

<script type="text/javascript" src="js/scrollsneak.js"></script>
<script type="text/javascript">jQuery(document).foundation();</script>
<script type="text/javascript" src="js/groups.js"></script>
<script type="text/javascript" src="js/page.js"></script>
<script type="text/javascript" src="js/snippets.js"></script>
<script type="text/javascript" src="js/magellan.js"></script>
<script type="text/javascript" src="js/metadata-toggle.js"></script>
<script type="text/javascript" src="js/lbHeader.js"></script>

<style type="text/css">@import "lib/prettify/prettify.css";</style>
<script type="text/javascript" src="lib/prettify/prettify.js"></script>
<script type="text/javascript" src="lib/prettify/lang-scala.js"></script>
<script type="text/javascript">//<![CDATA[
jQuery(function(){window.prettyPrint && prettyPrint()});
//]]></script>
<script type="text/javascript" src="assets/js/warnOldVersion.js"></script>
<script type="text/javascript">//<![CDATA[
jQuery(function(jq){initOldVersionWarnings(jq, '1.5.1-M1', 'https://doc.akka.io/docs/akka-projection/current/')});
//]]></script>


</body>
</html>
