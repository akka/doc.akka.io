<!DOCTYPE html>
<html class="no-js" lang="en">

<head>
<title>Offset in relational DB with Slick &bull; Akka Projection</title>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<meta name="description" content="Akka Projection."/>
<link rel="canonical" href="https://doc.akka.io/docs/akka-projection/current/slick.html"/>
<script type="text/javascript" src="lib/jquery/jquery.min.js"></script>
<script type="text/javascript" src="lib/foundation/dist/js/foundation.min.js"></script>
<link rel="stylesheet" type="text/css" href="lib/normalize.css/normalize.css"/>
<link rel="stylesheet" type="text/css" href="lib/foundation/dist/css/foundation.min.css"/>
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.css" />
<link rel="stylesheet" type="text/css" href="css/icons.css"/>
<link rel="stylesheet" type="text/css" href="css/page-7.css"/>
<link rel="stylesheet" type="text/css" href="css/banner-1.css"/>
<link rel="shortcut icon" href="images/favicon.ico" />
<link rel="apple-touch-icon" sizes="180x180" href="images/apple-touch-icon.png"/>
<link rel="icon" type="image/png" sizes="32x32" href="images/favicon-32x32.png"/>
<link rel="icon" type="image/png" sizes="16x16" href="images/favicon-16x16.png"/>
<link rel="manifest" href="images/manifest.json"/>
<meta name="msapplication-TileImage" content="images/mstile-150x150.png"/>
<meta name="msapplication-TileColor" content="#15a9ce"/>
<meta name="theme-color" content="#15a9ce"/>
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>
<!-- OneTrust Cookies Consent Notice (Production Standard, akka.io, en-GB) start -->
<script src="https://optanon.blob.core.windows.net/consent/159bb13d-6748-4399-806e-ac28db879785.js" type="text/javascript" charset="UTF-8"></script>
<script type="text/javascript">
function OptanonWrapper() { }
</script>
<!-- OneTrust Cookies Consent Notice (Production Standard, akka.io, en-GB) end -->
<!--Google Analytics-->
<script type="text/plain" class="optanon-category-2">
var _gaq = _gaq || [];
_gaq.push(['_setAccount', '']);
_gaq.push(['_setDomainName', '']);
_gaq.push(['_trackPageview']);
(function() {
var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})()
</script>
<!-- Google Tag Manager -->
<script type="text/plain" class="optanon-category-2">
(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-KBJGH35');
</script>
<!--Marketo-->
<script type="text/plain" class="optanon-category-3">
(function() {
var didInit = false;
function initMunchkin() {
if(didInit === false) {
didInit = true;
Munchkin.init('558-NCX-702', { 'asyncOnly': true, 'disableClickDelay': true });
}
}
var s = document.createElement('script');
s.type = 'text/javascript';
s.async = true;
s.src = '//munchkin.marketo.net/munchkin.js';
s.onreadystatechange = function() {
if (this.readyState == 'complete' || this.readyState == 'loaded') {
initMunchkin();
}
};
s.onload = initMunchkin;
document.getElementsByTagName('head')[0].appendChild(s);
})();
</script>
</head>

<body id="underlay" data-toggler="nav-open">
<div id="lightbend-banner" class="lightbend-banner akka full-width" data-category="OSS Lightbend Banner Impression" data-label="Akka Banner Impression">
<div class="wrapper">
<div class="brand">
<a class="oss-track-link-label" data-category="OSS Lightbend Banner Clicks" data-label="Lightbend Logo - Akka Banner" href="https://www.lightbend.com?r=oss-banner-akka" target="_blank">
<img class="lightbend-logo" src="images/banner-logos/lightbend-reverse.svg" alt="Lightbend" title="Lightbend">
</a>
</div>
<div class="nav">
<a class="banner-btn oss-track-link-label" data-category="OSS Lightbend Banner Clicks" data-label="Enhance your Akka systems with Akka Platform [Button] - Akka Banner" href="https://www.lightbend.com/akka-core-of-lightbend?r=oss-banner-akka" target="_blank">
<span>Enhance your Akka systems with</span>
<img class="akka-platform-reverse-logo" src="images/banner-logos/akka-platform-reverse.svg" alt="Akka Platform" title="Akka Platform">
</a>
<div class="drop-down">
<svg class="svg-chevon-circle-down" version="1.1" id="Chevron_circled_down" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 20 20" enable-background="new 0 0 20 20" xml:space="preserve">
<path fill="#ffffff" d="M12.505,8.698L10,11L7.494,8.698c-0.198-0.196-0.518-0.196-0.718,0c-0.197,0.196-0.197,0.515,0,0.71l2.864,2.807
c0.199,0.196,0.52,0.196,0.717,0l2.864-2.807c0.199-0.195,0.198-0.514,0-0.71C13.024,8.502,12.704,8.502,12.505,8.698z M10,0.4
c-5.302,0-9.6,4.298-9.6,9.6c0,5.303,4.298,9.6,9.6,9.6s9.6-4.297,9.6-9.6C19.6,4.698,15.302,0.4,10,0.4z M10,18.354
c-4.615,0-8.354-3.74-8.354-8.354c0-4.614,3.739-8.354,8.354-8.354c4.613,0,8.354,3.74,8.354,8.354
C18.354,14.614,14.613,18.354,10,18.354z" />
</svg>
<div class="drop-down-content">
<div class="lightbend-family">
<a href="https://cloudflow.io" class="cloudflow oss-track-link-label" data-category="OSS Lightbend Banner Clicks" data-label="Cloudflow - Logo Tag Line - Akka Banner">
<img class="cloudflow-full-color-logo" src="images/banner-logos/cloudflow-full-color.svg" alt="Cloudflow by Lightbend" title="Cloudflow by Lightbend">
</a>
<a href="https://cloudstate.io" class="cloudstate oss-track-link-label" data-category="OSS Lightbend Banner Clicks" data-label="Cloudstate - Logo Tag Line - Akka Banner">
<img class="cloudstate-full-color-logo" src="images/banner-logos/cloudstate-full-color.svg" alt="Cloudstate by Lightbend" title="Cloudstate by Lightbend">
</a>
<a href="https://www.lagomframework.com" class="lagom oss-track-link-label" data-category="OSS Lightbend Banner Clicks" data-label="Lagom - Logo Tag Line - Akka Banner">
<img class="lagom-full-color-logo" src="images/banner-logos/lagom-full-color.svg" alt="Lagom Framework by Lightbend" title="Lagom Framework by Lightbend">
</a>
<a href="https://www.playframework.com" class="play oss-track-link-label" data-category="OSS Lightbend Banner Clicks" data-label="Play - Logo Tag Line - Akka Banner">
<img class="play-full-color-logo" src="images/banner-logos/play-full-color.svg" alt="Play Framework by Lightbend" title="Play Framework by Lightbend">
</a>
<a href="https://www.scala-lang.org" class="scala oss-track-link-label" data-category="OSS Lightbend Banner Clicks" data-label="Scala - Logo Tag Line - Akka Banner">
<img class="scala-full-color-logo" src="images/banner-logos/scala-full-color.svg" alt="Scala by Lightbend" title="Scala by Lightbend">
</a>
<div class="akka current">
<img class="akka-full-color-logo" src="images/banner-logos/akka-full-color.svg" alt="Akka by Lightbend" title="Akka by Lightbend">
<span>From the creators of <strong>Akka</strong>, get technology enhancements, monitoring, and expert support with Akka Platform from Lightbend.</span>
<a class="oss-track-link-label" data-category="OSS Lightbend Banner Clicks" data-label="Learn More [Button] - Akka Banner" href="https://www.lightbend.com/akka-core-of-lightbend?r=oss-banner-akka" target="_blank">Learn More</a>
</div>
</div>
<div class="title">The Lightbend Family</div>
</div>      
</div>
</div>
</div>
</div>
<header class="site-header hide-for-large">
<div class="sticky-header clearfix">
<a href="https://akka.io"><img class="logo" src="images/akka-logo-reverse.svg"/></a>

<button class="menu-icon float-right" type="button" data-toggle="underlay overlay"></button>
</div>
<div id="overlay" class="overlay-nav" data-toggler="nav-open">
<header class="nav-header">
<div class="nav-header-title">
<h1><a href="index.html">Akka Projection</a></h1>
</div>
<div class="nav-header-version">
Version 0.2
</div>
<div class="nav-header-groups">
<select class="supergroup" name="Language"><option class="group" value="group-java">Java</option><option class="group" value="group-scala">Scala</option></select>
</div>
</header>
<nav class="nav-toc">
<ul>
  <li><a href="overview.html" class="page">Overview</a></li>
  <li><a href="use-cases.html" class="page">Use Cases</a></li>
  <li><a href="eventsourced.html" class="page">Events from Akka Persistence</a></li>
  <li><a href="kafka.html" class="page">Messages from and to Kafka</a></li>
  <li><a href="cassandra.html" class="page">Offset in Cassandra</a></li>
  <li><a href="slick.html#offset-in-relational-db-with-slick" class="active page">Offset in relational DB with Slick</a>
  <ul>
    <li><a href="slick.html#dependencies" class="header">Dependencies</a></li>
    <li><a href="slick.html#exactly-once" class="header">exactly-once</a></li>
    <li><a href="slick.html#at-least-once" class="header">at-least-once</a></li>
    <li><a href="slick.html#groupedwithin" class="header">groupedWithin</a></li>
    <li><a href="slick.html#handler" class="header">Handler</a></li>
    <li><a href="slick.html#processing-with-akka-streams" class="header">Processing with Akka Streams</a></li>
    <li><a href="slick.html#schema" class="header">Schema</a></li>
    <li><a href="slick.html#offset-types" class="header">Offset types</a></li>
    <li><a href="slick.html#configuration" class="header">Configuration</a></li>
  </ul></li>
  <li><a href="jpa.html" class="page">Offset in relational DB with JPA</a></li>
  <li><a href="running.html" class="page">Running a Projection</a></li>
  <li><a href="projection-settings.html" class="page">Projection Settings</a></li>
  <li><a href="management.html" class="page">Management of a Projection</a></li>
  <li><a href="testing.html" class="page">Testing</a></li>
</ul>
</nav>
</div>
</header>
<div class="site-content-wrapper">
<aside class="sticky-sidebar show-for-large">
<header class="nav-header sticky-sidebar-header">
<div class="nav-header-title">
<h1><a href="index.html">Akka Projection</a></h1>
</div>
<div class="nav-header-version">
Version 0.2
</div>
<div class="nav-header-groups">
<select class="supergroup" name="Language"><option class="group" value="group-java">Java</option><option class="group" value="group-scala">Scala</option></select>
</div>
</header>
<nav class="site-nav sticky-sidebar-contents">
<div class="nav-toc">
<ul>
  <li><a href="overview.html" class="page">Overview</a></li>
  <li><a href="use-cases.html" class="page">Use Cases</a></li>
  <li><a href="eventsourced.html" class="page">Events from Akka Persistence</a></li>
  <li><a href="kafka.html" class="page">Messages from and to Kafka</a></li>
  <li><a href="cassandra.html" class="page">Offset in Cassandra</a></li>
  <li><a href="slick.html#offset-in-relational-db-with-slick" class="active page">Offset in relational DB with Slick</a>
  <ul>
    <li><a href="slick.html#dependencies" class="header">Dependencies</a></li>
    <li><a href="slick.html#exactly-once" class="header">exactly-once</a></li>
    <li><a href="slick.html#at-least-once" class="header">at-least-once</a></li>
    <li><a href="slick.html#groupedwithin" class="header">groupedWithin</a></li>
    <li><a href="slick.html#handler" class="header">Handler</a></li>
    <li><a href="slick.html#processing-with-akka-streams" class="header">Processing with Akka Streams</a></li>
    <li><a href="slick.html#schema" class="header">Schema</a></li>
    <li><a href="slick.html#offset-types" class="header">Offset types</a></li>
    <li><a href="slick.html#configuration" class="header">Configuration</a></li>
  </ul></li>
  <li><a href="jpa.html" class="page">Offset in relational DB with JPA</a></li>
  <li><a href="running.html" class="page">Running a Projection</a></li>
  <li><a href="projection-settings.html" class="page">Projection Settings</a></li>
  <li><a href="management.html" class="page">Management of a Projection</a></li>
  <li><a href="testing.html" class="page">Testing</a></li>
</ul>
</div>
</nav>
<footer class="nav-footer sticky-sidebar-footer">
<a href="https://akka.io"><img class="logo" src="images/akka-logo-reverse.svg"/></a>

</footer>
</aside>
<main class="fixed-shift-for-large expanded row">
<section class="site-content small-12 column">
<article class="page-content row">
<div class="small-12 column" id="docs">
<h1><a href="#offset-in-relational-db-with-slick" name="offset-in-relational-db-with-slick" class="anchor"><span class="anchor-link"></span></a>Offset in relational DB with Slick</h1>
<p>The <span class="group-scala"><a href="/api/akka-projection/0.2/akka/projection/slick/SlickProjection.html" title="akka.projection.slick.SlickProjection"><code>SlickProjection</code></a></span><span class="group-java"><a href="/api/akka-projection/0.2/akka/projection/slick/SlickProjection.html" title="akka.projection.slick.SlickProjection"><code>SlickProjection</code></a></span> has support for storing the offset in a relational database with <a href="http://scala-slick.org">Slick</a> (JDBC). This is only an option for Scala and for Java the <a href="jpa.html">offset can be stored in relational DB with JPA</a>.</p>
<p>The source of the envelopes can be <a href="eventsourced.html">events from Akka Persistence</a> or any other <code>SourceProvider</code> with supported <a href="slick.html#offset-types">offset types</a>.</p>
<p>The envelope handler returns a <code>DBIO</code> that will be run by the projection. This means that the target database operations can be run in the same transaction as the storage of the offset, which means that <a href="slick.html#exactly-once">exactly-once</a> processing semantics is supported. It also offers <a href="slick.html#at-least-once">at-least-once</a> semantics.</p>
<h2><a href="#dependencies" name="dependencies" class="anchor"><span class="anchor-link"></span></a>Dependencies</h2>
<p>To use the Slick module of Akka Projections add the following dependency in your project:</p><dl class="dependency"><dt>sbt</dt><dd><pre class="prettyprint"><code class="language-scala">libraryDependencies += "com.lightbend.akka" %% "akka-projection-slick" % "0.2"</code></pre></dd><dt>Maven</dt><dd><pre class="prettyprint"><code class="language-xml">&lt;dependency&gt;
  &lt;groupId&gt;com.lightbend.akka&lt;/groupId&gt;
  &lt;artifactId&gt;akka-projection-slick_2.13&lt;/artifactId&gt;
  &lt;version&gt;0.2&lt;/version&gt;
&lt;/dependency&gt;</code></pre></dd><dt>Gradle</dt><dd><pre class="prettyprint"><code class="language-gradle">dependencies {
  compile group: 'com.lightbend.akka', name: 'akka-projection-slick_2.13', version: '0.2'
}</code></pre></dd></dl>
<p>Akka Projections require Akka 2.6.5 or later, see <a href="overview.html#akka-version">Akka version</a>.</p>
<table class="project-info">
<tr><th colspan="2">Project Info: Akka Projection Slick</th></tr>
  <tr><th>Artifact</th><td><div>com.lightbend.akka</div>
  <div>akka-projection-slick</div>
  <div>0.2</div></td></tr>
  <tr><th>JDK versions</th><td><div>AdoptOpenJDK 8</div><div>AdoptOpenJDK 11</div></td></tr>
  <tr><th>Scala versions</th><td>2.13.2</td></tr>
  <tr><th>JPMS module name</th><td>akka.projection.slick</td></tr>
  <tr><th>License</th><td><div><a href="https://www.apache.org/licenses/LICENSE-2.0" target="_blank" rel="noopener noreferrer">Apache-2.0</a></div>
  </td></tr>
  <tr><th>Readiness level</th><td><div class="readiness-level"><a href="https://developer.lightbend.com/docs/lightbend-platform/introduction/getting-help/support-terminology.html#community-driven" target="_blank" rel="noopener">Community-driven</a></div>
  <div>Since 0.0, 2020-04-01</div>
  </td></tr>
  <tr><th>Home page</th><td><a href="https://akka.io">https://akka.io</a></td></tr>
  <tr><th>API documentation</th><td>
  <div><a href="https://doc.akka.io/api/akka-projection/0.2/akka/projection/" target="_blank" rel="noopener noreferrer">API (Scaladoc)</a></div>
  </td></tr>
  <tr><th>Forums</th><td>
  <div><a href="https://discuss.lightbend.com/c/akka/" target="_blank" rel="noopener noreferrer">Lightbend Discuss</a></div>
  <div><a href="https://gitter.im/akka/akka" target="_blank" rel="noopener noreferrer">akka/akka Gitter channel</a></div>
  </td></tr>
  <tr><th>Release notes</th><td><a href="https://github.com/akka/akka-projection/releases" target="_blank" rel="noopener noreferrer">GitHub releases</a></td></tr>
  <tr><th>Issues</th><td><a href="https://github.com/akka/akka-projection/issues" target="_blank" rel="noopener noreferrer">GitHub issues</a></td></tr>
  <tr><th>Sources</th><td><a href="https://github.com/akka/akka-projection" target="_blank" rel="noopener noreferrer">https://github.com/akka/akka-projection</a></td></tr>
</table>

<h3><a href="#transitive-dependencies" name="transitive-dependencies" class="anchor"><span class="anchor-link"></span></a>Transitive dependencies</h3>

<p>The table below shows <code>akka-projection-slick</code>&rsquo;s direct dependencies and the second tab shows all libraries it depends on transitively.</p>

<dl class="dependencies"><dt>Direct dependencies</dt><dd><table>
  <thead><tr><th>Organization</th><th>Artifact</th><th>Version</th></thead>
  <tbody>
    <tr><td>com.lightbend.akka</td><td>akka-projection-core_2.13</td><td><a href="https://mvnrepository.com/artifact/com.lightbend.akka/akka-projection-core_2.13/0.2" target="_blank">0.2</a></td></tr>
    <tr><td>com.typesafe.akka</td><td>akka-persistence-query_2.13</td><td><a href="https://mvnrepository.com/artifact/com.typesafe.akka/akka-persistence-query_2.13/2.6.5" target="_blank">2.6.5</a></td></tr>
    <tr><td>com.typesafe.slick</td><td>slick_2.13</td><td><a href="https://mvnrepository.com/artifact/com.typesafe.slick/slick_2.13/3.3.2" target="_blank">3.3.2</a></td></tr>
    <tr><td>org.scala-lang</td><td>scala-library</td><td><a href="https://mvnrepository.com/artifact/org.scala-lang/scala-library/2.13.2" target="_blank">2.13.2</a></td></tr>
  </tbody>
</table></dd>
<dt>Dependency tree</dt><dd><pre>
com.lightbend.akka    akka-projection-core_2.13    <a href="https://mvnrepository.com/artifact/com.lightbend.akka/akka-projection-core_2.13/0.2" target="_blank">0.2</a>
    com.typesafe.akka    akka-actor-typed_2.13    <a href="https://mvnrepository.com/artifact/com.typesafe.akka/akka-actor-typed_2.13/2.6.5" target="_blank">2.6.5</a>
        com.typesafe.akka    akka-actor_2.13    <a href="https://mvnrepository.com/artifact/com.typesafe.akka/akka-actor_2.13/2.6.5" target="_blank">2.6.5</a>
            com.typesafe    config    <a href="https://mvnrepository.com/artifact/com.typesafe/config/1.4.0" target="_blank">1.4.0</a>
            org.scala-lang.modules    scala-java8-compat_2.13    <a href="https://mvnrepository.com/artifact/org.scala-lang.modules/scala-java8-compat_2.13/0.9.0" target="_blank">0.9.0</a>
        com.typesafe.akka    akka-slf4j_2.13    <a href="https://mvnrepository.com/artifact/com.typesafe.akka/akka-slf4j_2.13/2.6.5" target="_blank">2.6.5</a>
            com.typesafe.akka    akka-actor_2.13    <a href="https://mvnrepository.com/artifact/com.typesafe.akka/akka-actor_2.13/2.6.5" target="_blank">2.6.5</a>
                com.typesafe    config    <a href="https://mvnrepository.com/artifact/com.typesafe/config/1.4.0" target="_blank">1.4.0</a>
                org.scala-lang.modules    scala-java8-compat_2.13    <a href="https://mvnrepository.com/artifact/org.scala-lang.modules/scala-java8-compat_2.13/0.9.0" target="_blank">0.9.0</a>
            org.slf4j    slf4j-api    <a href="https://mvnrepository.com/artifact/org.slf4j/slf4j-api/1.7.30" target="_blank">1.7.30</a>
        org.slf4j    slf4j-api    <a href="https://mvnrepository.com/artifact/org.slf4j/slf4j-api/1.7.30" target="_blank">1.7.30</a>
    com.typesafe.akka    akka-protobuf-v3_2.13    <a href="https://mvnrepository.com/artifact/com.typesafe.akka/akka-protobuf-v3_2.13/2.6.5" target="_blank">2.6.5</a>
    com.typesafe.akka    akka-stream_2.13    <a href="https://mvnrepository.com/artifact/com.typesafe.akka/akka-stream_2.13/2.6.5" target="_blank">2.6.5</a>
        com.typesafe.akka    akka-actor_2.13    <a href="https://mvnrepository.com/artifact/com.typesafe.akka/akka-actor_2.13/2.6.5" target="_blank">2.6.5</a>
            com.typesafe    config    <a href="https://mvnrepository.com/artifact/com.typesafe/config/1.4.0" target="_blank">1.4.0</a>
            org.scala-lang.modules    scala-java8-compat_2.13    <a href="https://mvnrepository.com/artifact/org.scala-lang.modules/scala-java8-compat_2.13/0.9.0" target="_blank">0.9.0</a>
        com.typesafe.akka    akka-protobuf-v3_2.13    <a href="https://mvnrepository.com/artifact/com.typesafe.akka/akka-protobuf-v3_2.13/2.6.5" target="_blank">2.6.5</a>
        com.typesafe    ssl-config-core_2.13    <a href="https://mvnrepository.com/artifact/com.typesafe/ssl-config-core_2.13/0.4.1" target="_blank">0.4.1</a>
            com.typesafe    config    <a href="https://mvnrepository.com/artifact/com.typesafe/config/1.4.0" target="_blank">1.4.0</a>
            org.scala-lang.modules    scala-parser-combinators_2.13    <a href="https://mvnrepository.com/artifact/org.scala-lang.modules/scala-parser-combinators_2.13/1.1.2" target="_blank">1.1.2</a>
        org.reactivestreams    reactive-streams    <a href="https://mvnrepository.com/artifact/org.reactivestreams/reactive-streams/1.0.3" target="_blank">1.0.3</a>
com.typesafe.akka    akka-persistence-query_2.13    <a href="https://mvnrepository.com/artifact/com.typesafe.akka/akka-persistence-query_2.13/2.6.5" target="_blank">2.6.5</a>
    com.typesafe.akka    akka-persistence_2.13    <a href="https://mvnrepository.com/artifact/com.typesafe.akka/akka-persistence_2.13/2.6.5" target="_blank">2.6.5</a>
        com.typesafe.akka    akka-actor_2.13    <a href="https://mvnrepository.com/artifact/com.typesafe.akka/akka-actor_2.13/2.6.5" target="_blank">2.6.5</a>
            com.typesafe    config    <a href="https://mvnrepository.com/artifact/com.typesafe/config/1.4.0" target="_blank">1.4.0</a>
            org.scala-lang.modules    scala-java8-compat_2.13    <a href="https://mvnrepository.com/artifact/org.scala-lang.modules/scala-java8-compat_2.13/0.9.0" target="_blank">0.9.0</a>
        com.typesafe.akka    akka-stream_2.13    <a href="https://mvnrepository.com/artifact/com.typesafe.akka/akka-stream_2.13/2.6.5" target="_blank">2.6.5</a>
            com.typesafe.akka    akka-actor_2.13    <a href="https://mvnrepository.com/artifact/com.typesafe.akka/akka-actor_2.13/2.6.5" target="_blank">2.6.5</a>
                com.typesafe    config    <a href="https://mvnrepository.com/artifact/com.typesafe/config/1.4.0" target="_blank">1.4.0</a>
                org.scala-lang.modules    scala-java8-compat_2.13    <a href="https://mvnrepository.com/artifact/org.scala-lang.modules/scala-java8-compat_2.13/0.9.0" target="_blank">0.9.0</a>
            com.typesafe.akka    akka-protobuf-v3_2.13    <a href="https://mvnrepository.com/artifact/com.typesafe.akka/akka-protobuf-v3_2.13/2.6.5" target="_blank">2.6.5</a>
            com.typesafe    ssl-config-core_2.13    <a href="https://mvnrepository.com/artifact/com.typesafe/ssl-config-core_2.13/0.4.1" target="_blank">0.4.1</a>
                com.typesafe    config    <a href="https://mvnrepository.com/artifact/com.typesafe/config/1.4.0" target="_blank">1.4.0</a>
                org.scala-lang.modules    scala-parser-combinators_2.13    <a href="https://mvnrepository.com/artifact/org.scala-lang.modules/scala-parser-combinators_2.13/1.1.2" target="_blank">1.1.2</a>
            org.reactivestreams    reactive-streams    <a href="https://mvnrepository.com/artifact/org.reactivestreams/reactive-streams/1.0.3" target="_blank">1.0.3</a>
    com.typesafe.akka    akka-stream_2.13    <a href="https://mvnrepository.com/artifact/com.typesafe.akka/akka-stream_2.13/2.6.5" target="_blank">2.6.5</a>
        com.typesafe.akka    akka-actor_2.13    <a href="https://mvnrepository.com/artifact/com.typesafe.akka/akka-actor_2.13/2.6.5" target="_blank">2.6.5</a>
            com.typesafe    config    <a href="https://mvnrepository.com/artifact/com.typesafe/config/1.4.0" target="_blank">1.4.0</a>
            org.scala-lang.modules    scala-java8-compat_2.13    <a href="https://mvnrepository.com/artifact/org.scala-lang.modules/scala-java8-compat_2.13/0.9.0" target="_blank">0.9.0</a>
        com.typesafe.akka    akka-protobuf-v3_2.13    <a href="https://mvnrepository.com/artifact/com.typesafe.akka/akka-protobuf-v3_2.13/2.6.5" target="_blank">2.6.5</a>
        com.typesafe    ssl-config-core_2.13    <a href="https://mvnrepository.com/artifact/com.typesafe/ssl-config-core_2.13/0.4.1" target="_blank">0.4.1</a>
            com.typesafe    config    <a href="https://mvnrepository.com/artifact/com.typesafe/config/1.4.0" target="_blank">1.4.0</a>
            org.scala-lang.modules    scala-parser-combinators_2.13    <a href="https://mvnrepository.com/artifact/org.scala-lang.modules/scala-parser-combinators_2.13/1.1.2" target="_blank">1.1.2</a>
        org.reactivestreams    reactive-streams    <a href="https://mvnrepository.com/artifact/org.reactivestreams/reactive-streams/1.0.3" target="_blank">1.0.3</a>
com.typesafe.slick    slick_2.13    <a href="https://mvnrepository.com/artifact/com.typesafe.slick/slick_2.13/3.3.2" target="_blank">3.3.2</a>
    com.typesafe    config    <a href="https://mvnrepository.com/artifact/com.typesafe/config/1.4.0" target="_blank">1.4.0</a>
    org.reactivestreams    reactive-streams    <a href="https://mvnrepository.com/artifact/org.reactivestreams/reactive-streams/1.0.3" target="_blank">1.0.3</a>
    org.scala-lang.modules    scala-collection-compat_2.13    <a href="https://mvnrepository.com/artifact/org.scala-lang.modules/scala-collection-compat_2.13/2.0.0" target="_blank">2.0.0</a>
    org.slf4j    slf4j-api    <a href="https://mvnrepository.com/artifact/org.slf4j/slf4j-api/1.7.30" target="_blank">1.7.30</a>
org.scala-lang    scala-library    <a href="https://mvnrepository.com/artifact/org.scala-lang/scala-library/2.13.2" target="_blank">2.13.2</a></pre></dd>
</dl>

<h2><a href="#exactly-once" name="exactly-once" class="anchor"><span class="anchor-link"></span></a>exactly-once</h2>

<p>The offset is stored in the same transaction as the <code>DBIO</code> returned from the <code>handler</code>, which means exactly-once processing semantics if the projection is restarted from previously stored offset.</p>

<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/akka-projection/tree/v0.2/examples/src/test/scala/docs/slick/SlickProjectionDocExample.scala#L21-L26" target="_blank" title="Go to snippet source"></a><code class="language-scala">import akka.projection.ProjectionId
import akka.projection.slick.SlickProjection
import slick.basic.DatabaseConfig
import slick.dbio.DBIO
import slick.jdbc.H2Profile

implicit val ec = system.executionContext

val projection =
  SlickProjection.exactlyOnce(
    projectionId = ProjectionId(&quot;ShoppingCarts&quot;, &quot;carts-1&quot;),
    sourceProvider,
    dbConfig,
    handler = new ShoppingCartHandler(repository))</code></pre></dd>
</dl>
<h2><a href="#at-least-once" name="at-least-once" class="anchor"><span class="anchor-link"></span></a>at-least-once</h2>
<p>The offset is stored after the envelope has been processed and giving at-least-once processing semantics. This means that if the projection is restarted from a previously stored offset some elements may be processed more than once.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/akka-projection/tree/v0.2/examples/src/test/scala/docs/slick/SlickProjectionDocExample.scala#L135-L144" target="_blank" title="Go to snippet source"></a><code class="language-scala">implicit val ec = system.executionContext

val projection =
  SlickProjection
    .atLeastOnce(
      projectionId = ProjectionId(&quot;ShoppingCarts&quot;, &quot;carts-1&quot;),
      sourceProvider,
      dbConfig,
      handler = new ShoppingCartHandler(repository))
    .withSaveOffset(afterEnvelopes = 100, afterDuration = 500.millis)</code></pre></dd>
</dl>
<p>The offset is stored after a time window, or limited by a number of envelopes, whatever happens first. This window can be defined with <code>withSaveOffset</code> of the returned <code>AtLeastOnceSlickProjection</code>. The default settings for the window is defined in configuration section <code>akka.projection.at-least-once</code>. There is a performance benefit of not storing the offset too often but the drawback is that there can be more duplicates when the projection that will be processed again when the projection is restarted.</p>
<p>The <a href="slick.html#handler"><code>ShoppingCartHandler</code> is shown below</a>.</p>
<h2><a href="#groupedwithin" name="groupedwithin" class="anchor"><span class="anchor-link"></span></a>groupedWithin</h2>
<p>The envelopes can be grouped before processing, which can be useful for batch updates.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/akka-projection/tree/v0.2/examples/src/test/scala/docs/slick/SlickProjectionDocExample.scala#L150-L159" target="_blank" title="Go to snippet source"></a><code class="language-scala">implicit val ec = system.executionContext

val projection =
  SlickProjection
    .groupedWithin(
      projectionId = ProjectionId(&quot;ShoppingCarts&quot;, &quot;carts-1&quot;),
      sourceProvider,
      dbConfig,
      handler = new GroupedShoppingCartHandler(repository))
    .withGroup(groupAfterEnvelopes = 20, groupAfterDuration = 500.millis)</code></pre></dd>
</dl>
<p>The envelopes are grouped within a time window, or limited by a number of envelopes, whatever happens first. This window can be defined with <code>withGroup</code> of the returned <code>GroupedSlickProjection</code>. The default settings for the window is defined in configuration section <code>akka.projection.grouped</code>.</p>
<p>When using <code>groupedWithin</code> the handler is a <code>SlickHandler[immutable.Seq[EventEnvelope[ShoppingCart.Event]]]</code>. The <a href="slick.html#grouped-handler"><code>GroupedShoppingCartHandler</code> is shown below</a>.</p>
<p>The offset is stored in the same transaction as the <code>DBIO</code> returned from the <code>handler</code>, which means exactly-once processing semantics if the projection is restarted from previously stored offset.</p>
<h2><a href="#handler" name="handler" class="anchor"><span class="anchor-link"></span></a>Handler</h2>
<p>It&rsquo;s in the <span class="group-scala"><a href="/api/akka-projection/0.2/akka/projection/slick/SlickHandler.html" title="akka.projection.slick.SlickHandler"><code>SlickHandler</code></a></span><span class="group-java"><a href="/api/akka-projection/0.2/akka/projection/slick/SlickHandler.html" title="akka.projection.slick.SlickHandler"><code>SlickHandler</code></a></span> that you implement the processing of each envelope. It&rsquo;s essentially a function from <code>Envelope</code> to <code>DBIO[Done]</code>. The returned <code>DBIO</code> is run by the projection.</p>
<p>A handler that is consuming <code>ShoppingCart.Event</code> from <code>eventsByTag</code> can look like this:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/akka-projection/tree/v0.2/examples/src/test/scala/docs/slick/SlickProjectionDocExample.scala#L30-L35" target="_blank" title="Go to snippet source"></a><code class="language-scala">import scala.concurrent.Future

import akka.Done
import akka.projection.slick.SlickHandler
import org.slf4j.LoggerFactory

class ShoppingCartHandler(repository: OrderRepository)(implicit ec: ExecutionContext)
    extends SlickHandler[EventEnvelope[ShoppingCart.Event]] {
  private val logger = LoggerFactory.getLogger(getClass)

  override def process(envelope: EventEnvelope[ShoppingCart.Event]): DBIO[Done] = {
    envelope.event match {
      case ShoppingCart.CheckedOut(cartId, time) =&gt;
        logger.info(&quot;Shopping cart {} was checked out at {}&quot;, cartId, time)
        repository.save(Order(cartId, time))

      case otherEvent =&gt;
        logger.debug(&quot;Shopping cart {} changed by {}&quot;, otherEvent.cartId, otherEvent)
        DBIO.successful(Done)
    }
  }
}</code></pre></dd>
</dl>
<p>where the <code>OrderRepository</code> is:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/akka-projection/tree/v0.2/examples/src/test/scala/docs/slick/SlickProjectionDocExample.scala#L41-L63" target="_blank" title="Go to snippet source"></a><code class="language-scala">case class Order(id: String, time: Instant)

class OrderRepository(val dbConfig: DatabaseConfig[H2Profile]) {

  import dbConfig.profile.api._

  private class OrdersTable(tag: Tag) extends Table[Order](tag, &quot;ORDERS&quot;) {
    def id = column[String](&quot;CART_ID&quot;, O.PrimaryKey)

    def time = column[Instant](&quot;TIME&quot;)

    def * = (id, time).mapTo[Order]
  }

  private val ordersTable = TableQuery[OrdersTable]

  def save(order: Order)(implicit ec: ExecutionContext) = {
    ordersTable.insertOrUpdate(order).map(_ =&gt; Done)
  }

  def createTable(): Future[Unit] =
    dbConfig.db.run(ordersTable.schema.createIfNotExists)
}</code></pre></dd>
</dl>
<p>with the Slick <code>DatabaseConfig</code>:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/akka-projection/tree/v0.2/examples/src/test/scala/docs/slick/SlickProjectionDocExample.scala#L109-L111" target="_blank" title="Go to snippet source"></a><code class="language-scala">val dbConfig: DatabaseConfig[H2Profile] = DatabaseConfig.forConfig(&quot;akka.projection.slick&quot;, system.settings.config)

val repository = new OrderRepository(dbConfig)</code></pre></dd>
</dl>
<p>Such simple handlers can also be defined as plain functions via the helper <code>SlickHandler.apply</code> factory method.</p>
<h3><a href="#grouped-handler" name="grouped-handler" class="anchor"><span class="anchor-link"></span></a>Grouped handler</h3>
<p>When using <a href="slick.html#groupedwithin"><code>SlickProjection.groupedWithin</code></a> the handler is processing a <code>Seq</code> of envolopes.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/akka-projection/tree/v0.2/examples/src/test/scala/docs/slick/SlickProjectionDocExample.scala#L86-L104" target="_blank" title="Go to snippet source"></a><code class="language-scala">import scala.collection.immutable

class GroupedShoppingCartHandler(repository: OrderRepository)(implicit ec: ExecutionContext)
    extends SlickHandler[immutable.Seq[EventEnvelope[ShoppingCart.Event]]] {
  private val logger = LoggerFactory.getLogger(getClass)

  override def process(envelopes: immutable.Seq[EventEnvelope[ShoppingCart.Event]]): DBIO[Done] = {
    val dbios = envelopes.map(_.event).map {
      case ShoppingCart.CheckedOut(cartId, time) =&gt;
        logger.info(&quot;Shopping cart {} was checked out at {}&quot;, cartId, time)
        repository.save(Order(cartId, time))

      case otherEvent =&gt;
        logger.debug(&quot;Shopping cart {} changed by {}&quot;, otherEvent.cartId, otherEvent)
        DBIO.successful(Done)
    }
    DBIO.sequence(dbios).map(_ =&gt; Done)
  }
}</code></pre></dd>
</dl>
<h3><a href="#stateful-handler" name="stateful-handler" class="anchor"><span class="anchor-link"></span></a>Stateful handler</h3>
<p>The <code>SlickHandler</code> can be stateful, with variables and mutable data structures. It is invoked by the <code>Projection</code> machinery one envelope at a time and visibility guarantees between the invocations are handled automatically, i.e. no volatile or other concurrency primitives are needed for managing the state as long as it&rsquo;s not accessed by other threads than the one that called <code>process</code>.</p><div class="callout note "><div class="callout-title">Note</div>
<p>It is important that the <code>Handler</code> instance is not shared between several <code>Projection</code> instances, because then it would be invoked concurrently, which is not how it is intended to be used. Each <code>Projection</code> instance should use a new <code>Handler</code> instance. </p></div>
<h3><a href="#handler-lifecycle" name="handler-lifecycle" class="anchor"><span class="anchor-link"></span></a>Handler lifecycle</h3>
<p>You can override the <code>start</code> and <code>stop</code> methods of the <span class="group-scala"><a href="/api/akka-projection/0.2/akka/projection/slick/SlickHandler.html" title="akka.projection.slick.SlickHandler"><code>SlickHandler</code></a></span><span class="group-java"><a href="/api/akka-projection/0.2/akka/projection/slick/SlickHandler.html" title="akka.projection.slick.SlickHandler"><code>SlickHandler</code></a></span> to implement initialization before first envelope is processed and resource cleanup when the projection is stopped. Those methods are also called when the <code>Projection</code> is restarted after failure.</p>
<h2><a href="#processing-with-akka-streams" name="processing-with-akka-streams" class="anchor"><span class="anchor-link"></span></a>Processing with Akka Streams</h2>
<p>An Akka Streams <code>FlowWithContext</code> can be used instead of a handler for processing the envelopes with at-least-once semantics.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/akka-projection/tree/v0.2/examples/src/test/scala/docs/slick/SlickProjectionDocExample.scala#L165-L186" target="_blank" title="Go to snippet source"></a><code class="language-scala">val logger = LoggerFactory.getLogger(getClass)

val flow = FlowWithContext[EventEnvelope[ShoppingCart.Event], EventEnvelope[ShoppingCart.Event]]
  .map(envelope =&gt; envelope.event)
  .map {
    case ShoppingCart.CheckedOut(cartId, time) =&gt;
      logger.info(&quot;Shopping cart {} was checked out at {}&quot;, cartId, time)
      Done

    case otherEvent =&gt;
      logger.debug(&quot;Shopping cart {} changed by {}&quot;, otherEvent.cartId, otherEvent)
      Done
  }

val projection =
  SlickProjection
    .atLeastOnceFlow(
      projectionId = ProjectionId(&quot;shopping-carts&quot;, &quot;carts-1&quot;),
      sourceProvider,
      dbConfig,
      handler = flow)
    .withSaveOffset(afterEnvelopes = 100, afterDuration = 500.millis)</code></pre></dd>
</dl>
<p>The flow should emit a <code>Done</code> element for each completed envelope. The offset of the envelope is carried in the context of the <code>FlowWithContext</code> and is stored in the database when corresponding <code>Done</code> is emitted. Since the offset is stored after processing the envelope it means that if the projection is restarted from previously stored offset some envelopes may be processed more than once.</p>
<p>There are a few caveats to be aware of:</p>
<ul>
  <li>If the flow filters out envelopes the corresponding offset will not be stored, and such envelope  will be processed again if the projection is restarted and no later offset was stored.</li>
  <li>The flow should not duplicate emitted envelopes (<code>mapConcat</code>) with same offset, because then it can result in  that the first offset is stored and when the projection is restarted that offset is considered completed even  though more of the duplicated enveloped were never processed.</li>
  <li>The flow must not reorder elements, because the offsets may be stored in the wrong order and  and when the projection is restarted all envelopes up to the latest stored offset are considered  completed even though some of them may not have been processed. This is the reason the flow is  restricted to <code>FlowWithContext</code> rather than ordinary <code>Flow</code>.</li>
</ul>
<h2><a href="#schema" name="schema" class="anchor"><span class="anchor-link"></span></a>Schema</h2>
<p>The database schema for the offset storage table:</p>
<pre><code>create table if not exists &quot;AKKA_PROJECTION_OFFSET_STORE&quot; (
  &quot;PROJECTION_NAME&quot; CHAR(255) NOT NULL,
  &quot;PROJECTION_KEY&quot; CHAR(255) NOT NULL,
  &quot;OFFSET&quot; CHAR(255) NOT NULL,
  &quot;MANIFEST&quot; VARCHAR(4) NOT NULL,
  &quot;MERGEABLE&quot; BOOLEAN NOT NULL,
  &quot;LAST_UPDATED&quot; TIMESTAMP(9) WITH TIME ZONE NOT NULL);

alter table &quot;AKKA_PROJECTION_OFFSET_STORE&quot; add constraint &quot;PK_PROJECTION_ID&quot; primary key(&quot;PROJECTION_NAME&quot;,&quot;PROJECTION_KEY&quot;);
</code></pre>
<h2><a href="#offset-types" name="offset-types" class="anchor"><span class="anchor-link"></span></a>Offset types</h2>
<p>The supported offset types of the <code>SlickProjection</code> are:</p>
<ul>
  <li><code>akka.persistence.query.Offset</code> types from <a href="eventsourced.html">events from Akka Persistence</a></li>
  <li><code>MergeableOffset</code> that is used for <a href="kafka.html">messages from Kafka</a></li>
  <li><code>String</code></li>
  <li><code>Int</code></li>
  <li><code>Long</code></li>
</ul>
<h2><a href="#configuration" name="configuration" class="anchor"><span class="anchor-link"></span></a>Configuration</h2>
<p>Make your edits/overrides in your application.conf.</p>
<p>The reference configuration file with the default values:</p>
<pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/akka-projection/tree/v0.2/akka-projection-slick/src/main/resources/reference.conf#L5-L26" target="_blank" title="Go to snippet source"></a><code class="language-conf">akka.projection.slick = {

  # The Slick profile to use
  # set to one of: slick.jdbc.DerbyProfile$, slick.jdbc.H2Profile$, slick.jdbc.HsqldbProfile$, slick.jdbc.MySQLProfile$,
  #                slick.jdbc.PostgresProfile$, slick.jdbc.SQLiteProfile$, slick.jdbc.OracleProfile$
  #profile = &lt;fill this with your profile of choice&gt;

  # add here your Slick db settings
  db {
    # url = &quot;jdbc:h2:mem:test1&quot;
    # driver = org.h2.Driver
    # connectionPool = disabled
    # keepAliveConnection = true
  }

  offset-store {
    # set this to your database schema if applicable, empty by default
    schema = &quot;&quot;
    # the database talbe name for the offset store
    table = &quot;AKKA_PROJECTION_OFFSET_STORE&quot;
  }
}</code></pre>
</div>
</article>
<div class="row">
<div class="small-12 column">
<section class="nav-prev-next row">
<div class="nav-prev small-6 column">
<a href="cassandra.html"><i class="icon-prev"></i> <span class="link-prev">Offset in Cassandra</span></a>
</div>
<div class="nav-next small-6 column clearfix">
<a class="float-right" href="jpa.html">Offset in relational DB with JPA <i class="icon-next"></i></a>
</div>
</section>
</div>
</div>
<div class="source-github row">
Found an error in this documentation? The source code for this page can be found <a href="https://github.com/akka/akka-projection/tree/v0.2/docs/src/main/paradox/slick.md">here</a>.
Please feel free to edit and contribute a pull request.
</div>

<footer class="page-footer row clearfix">
<img class="akka-icon float-left show-for-medium" src="images/akka-icon.svg" />
<section class="copyright">
<div>Akka Projection is Open Source and available under the Apache 2 License.</div>
<p class="legal">
&copy; 2011-2020 <a href="https://www.lightbend.com" target="_blank">Lightbend, Inc.</a> |
<a href="https://www.lightbend.com/legal/licenses" target="_blank">Licenses</a> |
<a href="https://www.lightbend.com/legal/terms" target="_blank">Terms</a> |
<a href="https://www.lightbend.com/legal/privacy" target="_blank">Privacy Policy</a> |
<a href="https://akka.io/cookie/" target="_blank">Cookie Listing</a> |
<a class="optanon-toggle-display">Cookie Settings</a>
</p>
</section>

</footer>
</section>
</main>
</div>

<script type="text/javascript" src="js/scrollsneak.js"></script>
<script type="text/javascript">jQuery(document).foundation();</script>
<script type="text/javascript" src="js/groups.js"></script>
<script type="text/javascript" src="js/page.js"></script>
<script type="text/javascript" src="js/magellan.js"></script>
<script type="text/javascript" src="js/metadata-toggle.js"></script>

<style type="text/css">@import "lib/prettify/prettify.css";</style>
<script type="text/javascript" src="lib/prettify/prettify.js"></script>
<script type="text/javascript" src="lib/prettify/lang-scala.js"></script>
<script type="text/javascript">//<![CDATA[
jQuery(function(){window.prettyPrint && prettyPrint()});
//]]></script>
<script type="text/javascript" src="assets/js/warnOldVersion.js"></script>
<script type="text/javascript">//<![CDATA[
jQuery(function(jq){initOldVersionWarnings(jq, '0.2', 'https://doc.akka.io/docs/akka-projection/current/')});
//]]></script>


</body>
</html>
