<!DOCTYPE html>
<html class="no-js" lang="en">

<head>
<title>Offset in Cassandra &bull; Akka Projection</title>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<meta name="description" content="Akka Projection."/>
<link rel="canonical" href="https://doc.akka.io/docs/akka-projection/current/cassandra.html"/>
<script type="text/javascript" src="lib/jquery/jquery.min.js"></script>
<script type="text/javascript" src="lib/foundation/dist/js/foundation.min.js"></script>
<link rel="stylesheet" type="text/css" href="lib/normalize.css/normalize.css"/>
<link rel="stylesheet" type="text/css" href="lib/foundation/dist/css/foundation.min.css"/>
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.css" />
<link rel="stylesheet" type="text/css" href="css/icons.css"/>
<link rel="stylesheet" type="text/css" href="css/page-7.css"/>
<link rel="stylesheet" type="text/css" href="css/banner-1.css"/>
<link rel="shortcut icon" href="images/favicon.ico" />
<link rel="apple-touch-icon" sizes="180x180" href="images/apple-touch-icon.png"/>
<link rel="icon" type="image/png" sizes="32x32" href="images/favicon-32x32.png"/>
<link rel="icon" type="image/png" sizes="16x16" href="images/favicon-16x16.png"/>
<link rel="manifest" href="images/manifest.json"/>
<meta name="msapplication-TileImage" content="images/mstile-150x150.png"/>
<meta name="msapplication-TileColor" content="#15a9ce"/>
<meta name="theme-color" content="#15a9ce"/>
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>
<!-- OneTrust Cookies Consent Notice (Production Standard, akka.io, en-GB) start -->
<script src="https://optanon.blob.core.windows.net/consent/159bb13d-6748-4399-806e-ac28db879785.js" type="text/javascript" charset="UTF-8"></script>
<script type="text/javascript">
function OptanonWrapper() { }
</script>
<!-- OneTrust Cookies Consent Notice (Production Standard, akka.io, en-GB) end -->
<!--Google Analytics-->
<script type="text/plain" class="optanon-category-2">
var _gaq = _gaq || [];
_gaq.push(['_setAccount', '']);
_gaq.push(['_setDomainName', '']);
_gaq.push(['_trackPageview']);
(function() {
var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})()
</script>
<!-- Google Tag Manager -->
<script type="text/plain" class="optanon-category-2">
(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-KBJGH35');
</script>
<!--Marketo-->
<script type="text/plain" class="optanon-category-3">
(function() {
var didInit = false;
function initMunchkin() {
if(didInit === false) {
didInit = true;
Munchkin.init('558-NCX-702', { 'asyncOnly': true, 'disableClickDelay': true });
}
}
var s = document.createElement('script');
s.type = 'text/javascript';
s.async = true;
s.src = '//munchkin.marketo.net/munchkin.js';
s.onreadystatechange = function() {
if (this.readyState == 'complete' || this.readyState == 'loaded') {
initMunchkin();
}
};
s.onload = initMunchkin;
document.getElementsByTagName('head')[0].appendChild(s);
})();
</script>
</head>

<body id="underlay" data-toggler="nav-open">
<div id="lightbend-banner" class="lightbend-banner akka full-width" data-category="OSS Lightbend Banner Impression" data-label="Akka Banner Impression">
<div class="wrapper">
<div class="brand">
<a class="oss-track-link-label" data-category="OSS Lightbend Banner Clicks" data-label="Lightbend Logo - Akka Banner" href="https://www.lightbend.com?r=oss-banner-akka" target="_blank">
<img class="lightbend-logo" src="images/banner-logos/lightbend-reverse.svg" alt="Lightbend" title="Lightbend">
</a>
</div>
<div class="nav">
<a class="banner-btn oss-track-link-label" data-category="OSS Lightbend Banner Clicks" data-label="Enhance your Akka systems with Akka Platform [Button] - Akka Banner" href="https://www.lightbend.com/akka-core-of-lightbend?r=oss-banner-akka" target="_blank">
<span>Enhance your Akka systems with</span>
<img class="akka-platform-reverse-logo" src="images/banner-logos/akka-platform-reverse.svg" alt="Akka Platform" title="Akka Platform">
</a>
<div class="drop-down">
<svg class="svg-chevon-circle-down" version="1.1" id="Chevron_circled_down" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 20 20" enable-background="new 0 0 20 20" xml:space="preserve">
<path fill="#ffffff" d="M12.505,8.698L10,11L7.494,8.698c-0.198-0.196-0.518-0.196-0.718,0c-0.197,0.196-0.197,0.515,0,0.71l2.864,2.807
c0.199,0.196,0.52,0.196,0.717,0l2.864-2.807c0.199-0.195,0.198-0.514,0-0.71C13.024,8.502,12.704,8.502,12.505,8.698z M10,0.4
c-5.302,0-9.6,4.298-9.6,9.6c0,5.303,4.298,9.6,9.6,9.6s9.6-4.297,9.6-9.6C19.6,4.698,15.302,0.4,10,0.4z M10,18.354
c-4.615,0-8.354-3.74-8.354-8.354c0-4.614,3.739-8.354,8.354-8.354c4.613,0,8.354,3.74,8.354,8.354
C18.354,14.614,14.613,18.354,10,18.354z" />
</svg>
<div class="drop-down-content">
<div class="lightbend-family">
<a href="https://cloudflow.io" class="cloudflow oss-track-link-label" data-category="OSS Lightbend Banner Clicks" data-label="Cloudflow - Logo Tag Line - Akka Banner">
<img class="cloudflow-full-color-logo" src="images/banner-logos/cloudflow-full-color.svg" alt="Cloudflow by Lightbend" title="Cloudflow by Lightbend">
</a>
<a href="https://cloudstate.io" class="cloudstate oss-track-link-label" data-category="OSS Lightbend Banner Clicks" data-label="Cloudstate - Logo Tag Line - Akka Banner">
<img class="cloudstate-full-color-logo" src="images/banner-logos/cloudstate-full-color.svg" alt="Cloudstate by Lightbend" title="Cloudstate by Lightbend">
</a>
<a href="https://www.lagomframework.com" class="lagom oss-track-link-label" data-category="OSS Lightbend Banner Clicks" data-label="Lagom - Logo Tag Line - Akka Banner">
<img class="lagom-full-color-logo" src="images/banner-logos/lagom-full-color.svg" alt="Lagom Framework by Lightbend" title="Lagom Framework by Lightbend">
</a>
<a href="https://www.playframework.com" class="play oss-track-link-label" data-category="OSS Lightbend Banner Clicks" data-label="Play - Logo Tag Line - Akka Banner">
<img class="play-full-color-logo" src="images/banner-logos/play-full-color.svg" alt="Play Framework by Lightbend" title="Play Framework by Lightbend">
</a>
<a href="https://www.scala-lang.org" class="scala oss-track-link-label" data-category="OSS Lightbend Banner Clicks" data-label="Scala - Logo Tag Line - Akka Banner">
<img class="scala-full-color-logo" src="images/banner-logos/scala-full-color.svg" alt="Scala by Lightbend" title="Scala by Lightbend">
</a>
<div class="akka current">
<img class="akka-full-color-logo" src="images/banner-logos/akka-full-color.svg" alt="Akka by Lightbend" title="Akka by Lightbend">
<span>From the creators of <strong>Akka</strong>, get technology enhancements, monitoring, and expert support with Akka Platform from Lightbend.</span>
<a class="oss-track-link-label" data-category="OSS Lightbend Banner Clicks" data-label="Learn More [Button] - Akka Banner" href="https://www.lightbend.com/akka-core-of-lightbend?r=oss-banner-akka" target="_blank">Learn More</a>
</div>
</div>
<div class="title">The Lightbend Family</div>
</div>      
</div>
</div>
</div>
</div>
<header class="site-header hide-for-large">
<div class="sticky-header clearfix">
<a href="https://akka.io"><img class="logo" src="images/akka-logo-reverse.svg"/></a>

<button class="menu-icon float-right" type="button" data-toggle="underlay overlay"></button>
</div>
<div id="overlay" class="overlay-nav" data-toggler="nav-open">
<header class="nav-header">
<div class="nav-header-title">
<h1><a href="index.html">Akka Projection</a></h1>
</div>
<div class="nav-header-version">
Version 0.1
</div>
<div class="nav-header-groups">
<select class="supergroup" name="Language"><option class="group" value="group-java">Java</option><option class="group" value="group-scala">Scala</option></select>
</div>
</header>
<nav class="nav-toc">
<ul>
  <li><a href="overview.html" class="page">Overview</a></li>
  <li><a href="use-cases.html" class="page">Use Cases</a></li>
  <li><a href="eventsourced.html" class="page">Events from Akka Persistence</a></li>
  <li><a href="kafka.html" class="page">Messages from and to Kafka</a></li>
  <li><a href="cassandra.html#offset-in-cassandra" class="active page">Offset in Cassandra</a>
  <ul>
    <li><a href="cassandra.html#dependencies" class="header">Dependencies</a></li>
    <li><a href="cassandra.html#at-least-once" class="header">at-least-once</a></li>
    <li><a href="cassandra.html#at-most-once" class="header">at-most-once</a></li>
    <li><a href="cassandra.html#grouping" class="header">Grouping</a></li>
    <li><a href="cassandra.html#handler" class="header">Handler</a></li>
    <li><a href="cassandra.html#processing-with-akka-streams" class="header">Processing with Akka Streams</a></li>
    <li><a href="cassandra.html#schema" class="header">Schema</a></li>
    <li><a href="cassandra.html#offset-types" class="header">Offset types</a></li>
    <li><a href="cassandra.html#configuration" class="header">Configuration</a></li>
  </ul></li>
  <li><a href="slick.html" class="page">Offset in relational DB with Slick</a></li>
  <li><a href="jpa.html" class="page">Offset in relational DB with JPA</a></li>
  <li><a href="running.html" class="page">Running a Projection</a></li>
  <li><a href="projection-settings.html" class="page">Projection Settings</a></li>
  <li><a href="testing.html" class="page">Testing</a></li>
</ul>
</nav>
</div>
</header>
<div class="site-content-wrapper">
<aside class="sticky-sidebar show-for-large">
<header class="nav-header sticky-sidebar-header">
<div class="nav-header-title">
<h1><a href="index.html">Akka Projection</a></h1>
</div>
<div class="nav-header-version">
Version 0.1
</div>
<div class="nav-header-groups">
<select class="supergroup" name="Language"><option class="group" value="group-java">Java</option><option class="group" value="group-scala">Scala</option></select>
</div>
</header>
<nav class="site-nav sticky-sidebar-contents">
<div class="nav-toc">
<ul>
  <li><a href="overview.html" class="page">Overview</a></li>
  <li><a href="use-cases.html" class="page">Use Cases</a></li>
  <li><a href="eventsourced.html" class="page">Events from Akka Persistence</a></li>
  <li><a href="kafka.html" class="page">Messages from and to Kafka</a></li>
  <li><a href="cassandra.html#offset-in-cassandra" class="active page">Offset in Cassandra</a>
  <ul>
    <li><a href="cassandra.html#dependencies" class="header">Dependencies</a></li>
    <li><a href="cassandra.html#at-least-once" class="header">at-least-once</a></li>
    <li><a href="cassandra.html#at-most-once" class="header">at-most-once</a></li>
    <li><a href="cassandra.html#grouping" class="header">Grouping</a></li>
    <li><a href="cassandra.html#handler" class="header">Handler</a></li>
    <li><a href="cassandra.html#processing-with-akka-streams" class="header">Processing with Akka Streams</a></li>
    <li><a href="cassandra.html#schema" class="header">Schema</a></li>
    <li><a href="cassandra.html#offset-types" class="header">Offset types</a></li>
    <li><a href="cassandra.html#configuration" class="header">Configuration</a></li>
  </ul></li>
  <li><a href="slick.html" class="page">Offset in relational DB with Slick</a></li>
  <li><a href="jpa.html" class="page">Offset in relational DB with JPA</a></li>
  <li><a href="running.html" class="page">Running a Projection</a></li>
  <li><a href="projection-settings.html" class="page">Projection Settings</a></li>
  <li><a href="testing.html" class="page">Testing</a></li>
</ul>
</div>
</nav>
<footer class="nav-footer sticky-sidebar-footer">
<a href="https://akka.io"><img class="logo" src="images/akka-logo-reverse.svg"/></a>

</footer>
</aside>
<main class="fixed-shift-for-large expanded row">
<section class="site-content small-12 column">
<article class="page-content row">
<div class="small-12 column" id="docs">
<h1><a href="#offset-in-cassandra" name="offset-in-cassandra" class="anchor"><span class="anchor-link"></span></a>Offset in Cassandra</h1>
<p>The <span class="group-java"><a href="/api/akka-projection/0.1/akka/projection/cassandra/javadsl/CassandraProjection.html" title="akka.projection.cassandra.javadsl.CassandraProjection"><code>CassandraProjection</code></a></span><span class="group-scala"><a href="/api/akka-projection/0.1/akka/projection/cassandra/scaladsl/CassandraProjection.html" title="akka.projection.cassandra.scaladsl.CassandraProjection"><code>CassandraProjection</code></a></span> has support for storing the offset in Cassandra. </p>
<p>The source of the envelopes can be <a href="eventsourced.html">events from Akka Persistence</a> or any other <code>SourceProvider</code> with supported <a href="cassandra.html#offset-types">offset types</a>.</p>
<p>The envelope handler can integrate with anything, such as publishing to a message broker, or updating a read model in Cassandra.</p>
<p>The <code>CassandraProjection</code> offers <a href="cassandra.html#at-least-once">at-least-once</a> and <a href="cassandra.html#at-most-once">at-most-once</a> processing semantics, but not exactly-once.</p>
<h2><a href="#dependencies" name="dependencies" class="anchor"><span class="anchor-link"></span></a>Dependencies</h2>
<p>To use the Cassandra module of Akka Projections add the following dependency in your project:</p><dl class="dependency"><dt>sbt</dt><dd><pre class="prettyprint"><code class="language-scala">libraryDependencies += "com.typesafe.akka" %% "akka-projection-cassandra" % "0.1"</code></pre></dd><dt>Maven</dt><dd><pre class="prettyprint"><code class="language-xml">&lt;dependency&gt;
  &lt;groupId&gt;com.typesafe.akka&lt;/groupId&gt;
  &lt;artifactId&gt;akka-projection-cassandra_2.13&lt;/artifactId&gt;
  &lt;version&gt;0.1&lt;/version&gt;
&lt;/dependency&gt;</code></pre></dd><dt>Gradle</dt><dd><pre class="prettyprint"><code class="language-gradle">dependencies {
  compile group: 'com.typesafe.akka', name: 'akka-projection-cassandra_2.13', version: '0.1'
}</code></pre></dd></dl>
<p>Akka Projections requires Akka 2.6.5 or later, see <a href="overview.html#akka-version">Akka version</a>.</p>
<table class="project-info">
<tr><th colspan="2">Project Info: Akka Projection Cassandra</th></tr>
  <tr><th>Artifact</th><td><div>com.lightbend.akka</div>
  <div>akka-projection-cassandra</div>
  <div>0.1</div></td></tr>
  <tr><th>JDK versions</th><td><div>AdoptOpenJDK 8</div><div>AdoptOpenJDK 11</div></td></tr>
  <tr><th>Scala versions</th><td>2.13.2</td></tr>
  <tr><th>JPMS module name</th><td>akka.projection.cassandra</td></tr>
  <tr><th>License</th><td><div><a href="https://www.apache.org/licenses/LICENSE-2.0" target="_blank" rel="noopener noreferrer">Apache-2.0</a></div>
  </td></tr>
  <tr><th>Readiness level</th><td><div class="readiness-level"><a href="https://developer.lightbend.com/docs/lightbend-platform/introduction/getting-help/support-terminology.html#community-driven" target="_blank" rel="noopener">Community-driven</a></div>
  <div>Since 0.0, 2020-04-01</div>
  </td></tr>
  <tr><th>Home page</th><td><a href="https://akka.io">https://akka.io</a></td></tr>
  <tr><th>API documentation</th><td>
  <div><a href="https://doc.akka.io/api/akka-projection/0.1/akka/projection/" target="_blank" rel="noopener noreferrer">API (Scaladoc)</a></div>
  </td></tr>
  <tr><th>Forums</th><td>
  <div><a href="https://discuss.lightbend.com/c/akka/" target="_blank" rel="noopener noreferrer">Lightbend Discuss</a></div>
  <div><a href="https://gitter.im/akka/akka" target="_blank" rel="noopener noreferrer">akka/akka Gitter channel</a></div>
  </td></tr>
  <tr><th>Release notes</th><td><a href="https://github.com/akka/akka-projection/releases" target="_blank" rel="noopener noreferrer">GitHub releases</a></td></tr>
  <tr><th>Issues</th><td><a href="https://github.com/akka/akka-projection/issues" target="_blank" rel="noopener noreferrer">GitHub issues</a></td></tr>
  <tr><th>Sources</th><td><a href="https://github.com/akka/akka-projection" target="_blank" rel="noopener noreferrer">https://github.com/akka/akka-projection</a></td></tr>
</table>

<h3><a href="#transitive-dependencies" name="transitive-dependencies" class="anchor"><span class="anchor-link"></span></a>Transitive dependencies</h3>

<p>The table below shows <code>akka-projection-cassandra</code>&rsquo;s direct dependencies and the second tab shows all libraries it depends on transitively.</p>

<dl class="dependencies"><dt>Direct dependencies</dt><dd><table>
  <thead><tr><th>Organization</th><th>Artifact</th><th>Version</th></thead>
  <tbody>
    <tr><td>com.lightbend.akka</td><td>akka-projection-core_2.13</td><td><a href="https://mvnrepository.com/artifact/com.lightbend.akka/akka-projection-core_2.13/0.1" target="_blank">0.1</a></td></tr>
    <tr><td>com.lightbend.akka</td><td>akka-stream-alpakka-cassandra_2.13</td><td><a href="https://mvnrepository.com/artifact/com.lightbend.akka/akka-stream-alpakka-cassandra_2.13/2.0.0" target="_blank">2.0.0</a></td></tr>
    <tr><td>com.typesafe.akka</td><td>akka-persistence-query_2.13</td><td><a href="https://mvnrepository.com/artifact/com.typesafe.akka/akka-persistence-query_2.13/2.6.5" target="_blank">2.6.5</a></td></tr>
    <tr><td>org.scala-lang</td><td>scala-library</td><td><a href="https://mvnrepository.com/artifact/org.scala-lang/scala-library/2.13.2" target="_blank">2.13.2</a></td></tr>
  </tbody>
</table></dd>
<dt>Dependency tree</dt><dd><pre>
com.lightbend.akka    akka-projection-core_2.13    <a href="https://mvnrepository.com/artifact/com.lightbend.akka/akka-projection-core_2.13/0.1" target="_blank">0.1</a>
    com.typesafe.akka    akka-actor-typed_2.13    <a href="https://mvnrepository.com/artifact/com.typesafe.akka/akka-actor-typed_2.13/2.6.5" target="_blank">2.6.5</a>
        com.typesafe.akka    akka-actor_2.13    <a href="https://mvnrepository.com/artifact/com.typesafe.akka/akka-actor_2.13/2.6.5" target="_blank">2.6.5</a>
            com.typesafe    config    <a href="https://mvnrepository.com/artifact/com.typesafe/config/1.4.0" target="_blank">1.4.0</a>
            org.scala-lang.modules    scala-java8-compat_2.13    <a href="https://mvnrepository.com/artifact/org.scala-lang.modules/scala-java8-compat_2.13/0.9.0" target="_blank">0.9.0</a>
        com.typesafe.akka    akka-slf4j_2.13    <a href="https://mvnrepository.com/artifact/com.typesafe.akka/akka-slf4j_2.13/2.6.5" target="_blank">2.6.5</a>
            com.typesafe.akka    akka-actor_2.13    <a href="https://mvnrepository.com/artifact/com.typesafe.akka/akka-actor_2.13/2.6.5" target="_blank">2.6.5</a>
                com.typesafe    config    <a href="https://mvnrepository.com/artifact/com.typesafe/config/1.4.0" target="_blank">1.4.0</a>
                org.scala-lang.modules    scala-java8-compat_2.13    <a href="https://mvnrepository.com/artifact/org.scala-lang.modules/scala-java8-compat_2.13/0.9.0" target="_blank">0.9.0</a>
            org.slf4j    slf4j-api    <a href="https://mvnrepository.com/artifact/org.slf4j/slf4j-api/1.7.30" target="_blank">1.7.30</a>
        org.slf4j    slf4j-api    <a href="https://mvnrepository.com/artifact/org.slf4j/slf4j-api/1.7.30" target="_blank">1.7.30</a>
    com.typesafe.akka    akka-stream_2.13    <a href="https://mvnrepository.com/artifact/com.typesafe.akka/akka-stream_2.13/2.6.5" target="_blank">2.6.5</a>
        com.typesafe.akka    akka-actor_2.13    <a href="https://mvnrepository.com/artifact/com.typesafe.akka/akka-actor_2.13/2.6.5" target="_blank">2.6.5</a>
            com.typesafe    config    <a href="https://mvnrepository.com/artifact/com.typesafe/config/1.4.0" target="_blank">1.4.0</a>
            org.scala-lang.modules    scala-java8-compat_2.13    <a href="https://mvnrepository.com/artifact/org.scala-lang.modules/scala-java8-compat_2.13/0.9.0" target="_blank">0.9.0</a>
        com.typesafe.akka    akka-protobuf-v3_2.13    <a href="https://mvnrepository.com/artifact/com.typesafe.akka/akka-protobuf-v3_2.13/2.6.5" target="_blank">2.6.5</a>
        com.typesafe    ssl-config-core_2.13    <a href="https://mvnrepository.com/artifact/com.typesafe/ssl-config-core_2.13/0.4.1" target="_blank">0.4.1</a>
            com.typesafe    config    <a href="https://mvnrepository.com/artifact/com.typesafe/config/1.4.0" target="_blank">1.4.0</a>
            org.scala-lang.modules    scala-parser-combinators_2.13    <a href="https://mvnrepository.com/artifact/org.scala-lang.modules/scala-parser-combinators_2.13/1.1.2" target="_blank">1.1.2</a>
        org.reactivestreams    reactive-streams    <a href="https://mvnrepository.com/artifact/org.reactivestreams/reactive-streams/1.0.3" target="_blank">1.0.3</a>
com.lightbend.akka    akka-stream-alpakka-cassandra_2.13    <a href="https://mvnrepository.com/artifact/com.lightbend.akka/akka-stream-alpakka-cassandra_2.13/2.0.0" target="_blank">2.0.0</a>
    com.datastax.oss    java-driver-core    <a href="https://mvnrepository.com/artifact/com.datastax.oss/java-driver-core/4.5.1" target="_blank">4.5.1</a>
        com.datastax.oss    java-driver-shaded-guava    <a href="https://mvnrepository.com/artifact/com.datastax.oss/java-driver-shaded-guava/25.1-jre" target="_blank">25.1-jre</a>
        com.datastax.oss    native-protocol    <a href="https://mvnrepository.com/artifact/com.datastax.oss/native-protocol/1.4.9" target="_blank">1.4.9</a>
        com.fasterxml.jackson.core    jackson-core    <a href="https://mvnrepository.com/artifact/com.fasterxml.jackson.core/jackson-core/2.10.3" target="_blank">2.10.3</a>
        com.fasterxml.jackson.core    jackson-databind    <a href="https://mvnrepository.com/artifact/com.fasterxml.jackson.core/jackson-databind/2.10.3" target="_blank">2.10.3</a>
            com.fasterxml.jackson.core    jackson-annotations    <a href="https://mvnrepository.com/artifact/com.fasterxml.jackson.core/jackson-annotations/2.10.3" target="_blank">2.10.3</a>
            com.fasterxml.jackson.core    jackson-core    <a href="https://mvnrepository.com/artifact/com.fasterxml.jackson.core/jackson-core/2.10.3" target="_blank">2.10.3</a>
        com.github.jnr    jnr-ffi    <a href="https://mvnrepository.com/artifact/com.github.jnr/jnr-ffi/2.1.10" target="_blank">2.1.10</a>
            com.github.jnr    jffi    <a href="https://mvnrepository.com/artifact/com.github.jnr/jffi/1.2.19" target="_blank">1.2.19</a>
            com.github.jnr    jnr-a64asm    <a href="https://mvnrepository.com/artifact/com.github.jnr/jnr-a64asm/1.0.0" target="_blank">1.0.0</a>
            com.github.jnr    jnr-x86asm    <a href="https://mvnrepository.com/artifact/com.github.jnr/jnr-x86asm/1.0.2" target="_blank">1.0.2</a>
            org.ow2.asm    asm-analysis    <a href="https://mvnrepository.com/artifact/org.ow2.asm/asm-analysis/7.1" target="_blank">7.1</a>
                org.ow2.asm    asm-tree    <a href="https://mvnrepository.com/artifact/org.ow2.asm/asm-tree/7.1" target="_blank">7.1</a>
                    org.ow2.asm    asm    <a href="https://mvnrepository.com/artifact/org.ow2.asm/asm/7.1" target="_blank">7.1</a>
            org.ow2.asm    asm-commons    <a href="https://mvnrepository.com/artifact/org.ow2.asm/asm-commons/7.1" target="_blank">7.1</a>
                org.ow2.asm    asm-analysis    <a href="https://mvnrepository.com/artifact/org.ow2.asm/asm-analysis/7.1" target="_blank">7.1</a>
                    org.ow2.asm    asm-tree    <a href="https://mvnrepository.com/artifact/org.ow2.asm/asm-tree/7.1" target="_blank">7.1</a>
                        org.ow2.asm    asm    <a href="https://mvnrepository.com/artifact/org.ow2.asm/asm/7.1" target="_blank">7.1</a>
                org.ow2.asm    asm-tree    <a href="https://mvnrepository.com/artifact/org.ow2.asm/asm-tree/7.1" target="_blank">7.1</a>
                    org.ow2.asm    asm    <a href="https://mvnrepository.com/artifact/org.ow2.asm/asm/7.1" target="_blank">7.1</a>
                org.ow2.asm    asm    <a href="https://mvnrepository.com/artifact/org.ow2.asm/asm/7.1" target="_blank">7.1</a>
            org.ow2.asm    asm-tree    <a href="https://mvnrepository.com/artifact/org.ow2.asm/asm-tree/7.1" target="_blank">7.1</a>
                org.ow2.asm    asm    <a href="https://mvnrepository.com/artifact/org.ow2.asm/asm/7.1" target="_blank">7.1</a>
            org.ow2.asm    asm-util    <a href="https://mvnrepository.com/artifact/org.ow2.asm/asm-util/7.1" target="_blank">7.1</a>
                org.ow2.asm    asm-analysis    <a href="https://mvnrepository.com/artifact/org.ow2.asm/asm-analysis/7.1" target="_blank">7.1</a>
                    org.ow2.asm    asm-tree    <a href="https://mvnrepository.com/artifact/org.ow2.asm/asm-tree/7.1" target="_blank">7.1</a>
                        org.ow2.asm    asm    <a href="https://mvnrepository.com/artifact/org.ow2.asm/asm/7.1" target="_blank">7.1</a>
                org.ow2.asm    asm-tree    <a href="https://mvnrepository.com/artifact/org.ow2.asm/asm-tree/7.1" target="_blank">7.1</a>
                    org.ow2.asm    asm    <a href="https://mvnrepository.com/artifact/org.ow2.asm/asm/7.1" target="_blank">7.1</a>
                org.ow2.asm    asm    <a href="https://mvnrepository.com/artifact/org.ow2.asm/asm/7.1" target="_blank">7.1</a>
            org.ow2.asm    asm    <a href="https://mvnrepository.com/artifact/org.ow2.asm/asm/7.1" target="_blank">7.1</a>
        com.github.jnr    jnr-posix    <a href="https://mvnrepository.com/artifact/com.github.jnr/jnr-posix/3.0.50" target="_blank">3.0.50</a>
            com.github.jnr    jnr-constants    <a href="https://mvnrepository.com/artifact/com.github.jnr/jnr-constants/0.9.12" target="_blank">0.9.12</a>
            com.github.jnr    jnr-ffi    <a href="https://mvnrepository.com/artifact/com.github.jnr/jnr-ffi/2.1.10" target="_blank">2.1.10</a>
                com.github.jnr    jffi    <a href="https://mvnrepository.com/artifact/com.github.jnr/jffi/1.2.19" target="_blank">1.2.19</a>
                com.github.jnr    jnr-a64asm    <a href="https://mvnrepository.com/artifact/com.github.jnr/jnr-a64asm/1.0.0" target="_blank">1.0.0</a>
                com.github.jnr    jnr-x86asm    <a href="https://mvnrepository.com/artifact/com.github.jnr/jnr-x86asm/1.0.2" target="_blank">1.0.2</a>
                org.ow2.asm    asm-analysis    <a href="https://mvnrepository.com/artifact/org.ow2.asm/asm-analysis/7.1" target="_blank">7.1</a>
                    org.ow2.asm    asm-tree    <a href="https://mvnrepository.com/artifact/org.ow2.asm/asm-tree/7.1" target="_blank">7.1</a>
                        org.ow2.asm    asm    <a href="https://mvnrepository.com/artifact/org.ow2.asm/asm/7.1" target="_blank">7.1</a>
                org.ow2.asm    asm-commons    <a href="https://mvnrepository.com/artifact/org.ow2.asm/asm-commons/7.1" target="_blank">7.1</a>
                    org.ow2.asm    asm-analysis    <a href="https://mvnrepository.com/artifact/org.ow2.asm/asm-analysis/7.1" target="_blank">7.1</a>
                        org.ow2.asm    asm-tree    <a href="https://mvnrepository.com/artifact/org.ow2.asm/asm-tree/7.1" target="_blank">7.1</a>
                            org.ow2.asm    asm    <a href="https://mvnrepository.com/artifact/org.ow2.asm/asm/7.1" target="_blank">7.1</a>
                    org.ow2.asm    asm-tree    <a href="https://mvnrepository.com/artifact/org.ow2.asm/asm-tree/7.1" target="_blank">7.1</a>
                        org.ow2.asm    asm    <a href="https://mvnrepository.com/artifact/org.ow2.asm/asm/7.1" target="_blank">7.1</a>
                    org.ow2.asm    asm    <a href="https://mvnrepository.com/artifact/org.ow2.asm/asm/7.1" target="_blank">7.1</a>
                org.ow2.asm    asm-tree    <a href="https://mvnrepository.com/artifact/org.ow2.asm/asm-tree/7.1" target="_blank">7.1</a>
                    org.ow2.asm    asm    <a href="https://mvnrepository.com/artifact/org.ow2.asm/asm/7.1" target="_blank">7.1</a>
                org.ow2.asm    asm-util    <a href="https://mvnrepository.com/artifact/org.ow2.asm/asm-util/7.1" target="_blank">7.1</a>
                    org.ow2.asm    asm-analysis    <a href="https://mvnrepository.com/artifact/org.ow2.asm/asm-analysis/7.1" target="_blank">7.1</a>
                        org.ow2.asm    asm-tree    <a href="https://mvnrepository.com/artifact/org.ow2.asm/asm-tree/7.1" target="_blank">7.1</a>
                            org.ow2.asm    asm    <a href="https://mvnrepository.com/artifact/org.ow2.asm/asm/7.1" target="_blank">7.1</a>
                    org.ow2.asm    asm-tree    <a href="https://mvnrepository.com/artifact/org.ow2.asm/asm-tree/7.1" target="_blank">7.1</a>
                        org.ow2.asm    asm    <a href="https://mvnrepository.com/artifact/org.ow2.asm/asm/7.1" target="_blank">7.1</a>
                    org.ow2.asm    asm    <a href="https://mvnrepository.com/artifact/org.ow2.asm/asm/7.1" target="_blank">7.1</a>
                org.ow2.asm    asm    <a href="https://mvnrepository.com/artifact/org.ow2.asm/asm/7.1" target="_blank">7.1</a>
        com.github.stephenc.jcip    jcip-annotations    <a href="https://mvnrepository.com/artifact/com.github.stephenc.jcip/jcip-annotations/1.0-1" target="_blank">1.0-1</a>
        com.typesafe    config    <a href="https://mvnrepository.com/artifact/com.typesafe/config/1.4.0" target="_blank">1.4.0</a>
        io.dropwizard.metrics    metrics-core    <a href="https://mvnrepository.com/artifact/io.dropwizard.metrics/metrics-core/4.0.5" target="_blank">4.0.5</a>
            org.slf4j    slf4j-api    <a href="https://mvnrepository.com/artifact/org.slf4j/slf4j-api/1.7.30" target="_blank">1.7.30</a>
        org.hdrhistogram    HdrHistogram    <a href="https://mvnrepository.com/artifact/org.hdrhistogram/HdrHistogram/2.1.11" target="_blank">2.1.11</a>
        org.javatuples    javatuples    <a href="https://mvnrepository.com/artifact/org.javatuples/javatuples/1.2" target="_blank">1.2</a>
        org.reactivestreams    reactive-streams    <a href="https://mvnrepository.com/artifact/org.reactivestreams/reactive-streams/1.0.3" target="_blank">1.0.3</a>
        org.slf4j    slf4j-api    <a href="https://mvnrepository.com/artifact/org.slf4j/slf4j-api/1.7.30" target="_blank">1.7.30</a>
    com.fasterxml.jackson.core    jackson-core    <a href="https://mvnrepository.com/artifact/com.fasterxml.jackson.core/jackson-core/2.10.3" target="_blank">2.10.3</a>
    com.fasterxml.jackson.core    jackson-databind    <a href="https://mvnrepository.com/artifact/com.fasterxml.jackson.core/jackson-databind/2.10.3" target="_blank">2.10.3</a>
        com.fasterxml.jackson.core    jackson-annotations    <a href="https://mvnrepository.com/artifact/com.fasterxml.jackson.core/jackson-annotations/2.10.3" target="_blank">2.10.3</a>
        com.fasterxml.jackson.core    jackson-core    <a href="https://mvnrepository.com/artifact/com.fasterxml.jackson.core/jackson-core/2.10.3" target="_blank">2.10.3</a>
    com.typesafe.akka    akka-stream_2.13    <a href="https://mvnrepository.com/artifact/com.typesafe.akka/akka-stream_2.13/2.6.5" target="_blank">2.6.5</a>
        com.typesafe.akka    akka-actor_2.13    <a href="https://mvnrepository.com/artifact/com.typesafe.akka/akka-actor_2.13/2.6.5" target="_blank">2.6.5</a>
            com.typesafe    config    <a href="https://mvnrepository.com/artifact/com.typesafe/config/1.4.0" target="_blank">1.4.0</a>
            org.scala-lang.modules    scala-java8-compat_2.13    <a href="https://mvnrepository.com/artifact/org.scala-lang.modules/scala-java8-compat_2.13/0.9.0" target="_blank">0.9.0</a>
        com.typesafe.akka    akka-protobuf-v3_2.13    <a href="https://mvnrepository.com/artifact/com.typesafe.akka/akka-protobuf-v3_2.13/2.6.5" target="_blank">2.6.5</a>
        com.typesafe    ssl-config-core_2.13    <a href="https://mvnrepository.com/artifact/com.typesafe/ssl-config-core_2.13/0.4.1" target="_blank">0.4.1</a>
            com.typesafe    config    <a href="https://mvnrepository.com/artifact/com.typesafe/config/1.4.0" target="_blank">1.4.0</a>
            org.scala-lang.modules    scala-parser-combinators_2.13    <a href="https://mvnrepository.com/artifact/org.scala-lang.modules/scala-parser-combinators_2.13/1.1.2" target="_blank">1.1.2</a>
        org.reactivestreams    reactive-streams    <a href="https://mvnrepository.com/artifact/org.reactivestreams/reactive-streams/1.0.3" target="_blank">1.0.3</a>
    io.netty    netty-handler    <a href="https://mvnrepository.com/artifact/io.netty/netty-handler/4.1.39.Final" target="_blank">4.1.39.Final</a>
        io.netty    netty-buffer    <a href="https://mvnrepository.com/artifact/io.netty/netty-buffer/4.1.39.Final" target="_blank">4.1.39.Final</a>
            io.netty    netty-common    <a href="https://mvnrepository.com/artifact/io.netty/netty-common/4.1.39.Final" target="_blank">4.1.39.Final</a>
        io.netty    netty-codec    <a href="https://mvnrepository.com/artifact/io.netty/netty-codec/4.1.39.Final" target="_blank">4.1.39.Final</a>
            io.netty    netty-buffer    <a href="https://mvnrepository.com/artifact/io.netty/netty-buffer/4.1.39.Final" target="_blank">4.1.39.Final</a>
                io.netty    netty-common    <a href="https://mvnrepository.com/artifact/io.netty/netty-common/4.1.39.Final" target="_blank">4.1.39.Final</a>
            io.netty    netty-common    <a href="https://mvnrepository.com/artifact/io.netty/netty-common/4.1.39.Final" target="_blank">4.1.39.Final</a>
            io.netty    netty-transport    <a href="https://mvnrepository.com/artifact/io.netty/netty-transport/4.1.39.Final" target="_blank">4.1.39.Final</a>
                io.netty    netty-buffer    <a href="https://mvnrepository.com/artifact/io.netty/netty-buffer/4.1.39.Final" target="_blank">4.1.39.Final</a>
                    io.netty    netty-common    <a href="https://mvnrepository.com/artifact/io.netty/netty-common/4.1.39.Final" target="_blank">4.1.39.Final</a>
                io.netty    netty-common    <a href="https://mvnrepository.com/artifact/io.netty/netty-common/4.1.39.Final" target="_blank">4.1.39.Final</a>
                io.netty    netty-resolver    <a href="https://mvnrepository.com/artifact/io.netty/netty-resolver/4.1.39.Final" target="_blank">4.1.39.Final</a>
                    io.netty    netty-common    <a href="https://mvnrepository.com/artifact/io.netty/netty-common/4.1.39.Final" target="_blank">4.1.39.Final</a>
        io.netty    netty-common    <a href="https://mvnrepository.com/artifact/io.netty/netty-common/4.1.39.Final" target="_blank">4.1.39.Final</a>
        io.netty    netty-transport    <a href="https://mvnrepository.com/artifact/io.netty/netty-transport/4.1.39.Final" target="_blank">4.1.39.Final</a>
            io.netty    netty-buffer    <a href="https://mvnrepository.com/artifact/io.netty/netty-buffer/4.1.39.Final" target="_blank">4.1.39.Final</a>
                io.netty    netty-common    <a href="https://mvnrepository.com/artifact/io.netty/netty-common/4.1.39.Final" target="_blank">4.1.39.Final</a>
            io.netty    netty-common    <a href="https://mvnrepository.com/artifact/io.netty/netty-common/4.1.39.Final" target="_blank">4.1.39.Final</a>
            io.netty    netty-resolver    <a href="https://mvnrepository.com/artifact/io.netty/netty-resolver/4.1.39.Final" target="_blank">4.1.39.Final</a>
                io.netty    netty-common    <a href="https://mvnrepository.com/artifact/io.netty/netty-common/4.1.39.Final" target="_blank">4.1.39.Final</a>
com.typesafe.akka    akka-persistence-query_2.13    <a href="https://mvnrepository.com/artifact/com.typesafe.akka/akka-persistence-query_2.13/2.6.5" target="_blank">2.6.5</a>
    com.typesafe.akka    akka-persistence_2.13    <a href="https://mvnrepository.com/artifact/com.typesafe.akka/akka-persistence_2.13/2.6.5" target="_blank">2.6.5</a>
        com.typesafe.akka    akka-actor_2.13    <a href="https://mvnrepository.com/artifact/com.typesafe.akka/akka-actor_2.13/2.6.5" target="_blank">2.6.5</a>
            com.typesafe    config    <a href="https://mvnrepository.com/artifact/com.typesafe/config/1.4.0" target="_blank">1.4.0</a>
            org.scala-lang.modules    scala-java8-compat_2.13    <a href="https://mvnrepository.com/artifact/org.scala-lang.modules/scala-java8-compat_2.13/0.9.0" target="_blank">0.9.0</a>
        com.typesafe.akka    akka-stream_2.13    <a href="https://mvnrepository.com/artifact/com.typesafe.akka/akka-stream_2.13/2.6.5" target="_blank">2.6.5</a>
            com.typesafe.akka    akka-actor_2.13    <a href="https://mvnrepository.com/artifact/com.typesafe.akka/akka-actor_2.13/2.6.5" target="_blank">2.6.5</a>
                com.typesafe    config    <a href="https://mvnrepository.com/artifact/com.typesafe/config/1.4.0" target="_blank">1.4.0</a>
                org.scala-lang.modules    scala-java8-compat_2.13    <a href="https://mvnrepository.com/artifact/org.scala-lang.modules/scala-java8-compat_2.13/0.9.0" target="_blank">0.9.0</a>
            com.typesafe.akka    akka-protobuf-v3_2.13    <a href="https://mvnrepository.com/artifact/com.typesafe.akka/akka-protobuf-v3_2.13/2.6.5" target="_blank">2.6.5</a>
            com.typesafe    ssl-config-core_2.13    <a href="https://mvnrepository.com/artifact/com.typesafe/ssl-config-core_2.13/0.4.1" target="_blank">0.4.1</a>
                com.typesafe    config    <a href="https://mvnrepository.com/artifact/com.typesafe/config/1.4.0" target="_blank">1.4.0</a>
                org.scala-lang.modules    scala-parser-combinators_2.13    <a href="https://mvnrepository.com/artifact/org.scala-lang.modules/scala-parser-combinators_2.13/1.1.2" target="_blank">1.1.2</a>
            org.reactivestreams    reactive-streams    <a href="https://mvnrepository.com/artifact/org.reactivestreams/reactive-streams/1.0.3" target="_blank">1.0.3</a>
    com.typesafe.akka    akka-stream_2.13    <a href="https://mvnrepository.com/artifact/com.typesafe.akka/akka-stream_2.13/2.6.5" target="_blank">2.6.5</a>
        com.typesafe.akka    akka-actor_2.13    <a href="https://mvnrepository.com/artifact/com.typesafe.akka/akka-actor_2.13/2.6.5" target="_blank">2.6.5</a>
            com.typesafe    config    <a href="https://mvnrepository.com/artifact/com.typesafe/config/1.4.0" target="_blank">1.4.0</a>
            org.scala-lang.modules    scala-java8-compat_2.13    <a href="https://mvnrepository.com/artifact/org.scala-lang.modules/scala-java8-compat_2.13/0.9.0" target="_blank">0.9.0</a>
        com.typesafe.akka    akka-protobuf-v3_2.13    <a href="https://mvnrepository.com/artifact/com.typesafe.akka/akka-protobuf-v3_2.13/2.6.5" target="_blank">2.6.5</a>
        com.typesafe    ssl-config-core_2.13    <a href="https://mvnrepository.com/artifact/com.typesafe/ssl-config-core_2.13/0.4.1" target="_blank">0.4.1</a>
            com.typesafe    config    <a href="https://mvnrepository.com/artifact/com.typesafe/config/1.4.0" target="_blank">1.4.0</a>
            org.scala-lang.modules    scala-parser-combinators_2.13    <a href="https://mvnrepository.com/artifact/org.scala-lang.modules/scala-parser-combinators_2.13/1.1.2" target="_blank">1.1.2</a>
        org.reactivestreams    reactive-streams    <a href="https://mvnrepository.com/artifact/org.reactivestreams/reactive-streams/1.0.3" target="_blank">1.0.3</a>
org.scala-lang    scala-library    <a href="https://mvnrepository.com/artifact/org.scala-lang/scala-library/2.13.2" target="_blank">2.13.2</a></pre></dd>
</dl>

<h2><a href="#at-least-once" name="at-least-once" class="anchor"><span class="anchor-link"></span></a>at-least-once</h2>

<p>The offset is stored after the envelope has been processed and giving at-least-once processing semantics. This means that if the projection is restarted from a previously stored offset some elements may be processed more than once.</p>

<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/akka-projection/tree/v0.1/examples/src/test/scala/docs/cassandra/CassandraProjectionDocExample.scala#L73-L79" target="_blank" title="Go to snippet source"></a><code class="language-scala">val projection =
  CassandraProjection.atLeastOnce(
    projectionId = ProjectionId(&quot;shopping-carts&quot;, &quot;carts-1&quot;),
    sourceProvider,
    saveOffsetAfterEnvelopes = 100,
    saveOffsetAfterDuration = 500.millis,
    handler = new ShoppingCartHandler)</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/akka-projection/tree/v0.1/examples/src/test/java/jdocs/cassandra/CassandraProjectionDocExample.java#L82-L91" target="_blank" title="Go to snippet source"></a><code class="language-java">int saveOffsetAfterEnvelopes = 100;
Duration saveOffsetAfterDuration = Duration.ofMillis(500);

Projection&lt;EventEnvelope&lt;ShoppingCart.Event&gt;&gt; projection =
  CassandraProjection.atLeastOnce(
    ProjectionId.of(&quot;shopping-carts&quot;, &quot;carts-1&quot;),
    sourceProvider,
    saveOffsetAfterEnvelopes,
    saveOffsetAfterDuration,
    new ShoppingCartHandler());</code></pre></dd>
</dl>
<p>The <code>saveOffsetAfterEnvelopes</code> and <code>saveOffsetAfterDuration</code> parameters control how often the offset is stored. There is a performance benefit of not storing the offset too often but the drawback is that there can be more duplicates when the projection that will be processed again when the projection is restarted.</p>
<p>The <a href="cassandra.html#handler"><code>ShoppingCartHandler</code> is shown below</a>.</p>
<h2><a href="#at-most-once" name="at-most-once" class="anchor"><span class="anchor-link"></span></a>at-most-once</h2>
<p>The offset for each envelope is stored before the envelope has been processed and giving at-most-once processing semantics. This means that if the projection is restarted from previously stored offset one envelope may not have been processed.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/akka-projection/tree/v0.1/examples/src/test/scala/docs/cassandra/CassandraProjectionDocExample.scala#L25-L27" target="_blank" title="Go to snippet source"></a><code class="language-scala">import akka.projection.cassandra.scaladsl.CassandraProjection
import akka.projection.ProjectionId

val projection =
  CassandraProjection.atLeastOnce(
    projectionId = ProjectionId(&quot;shopping-carts&quot;, &quot;carts-1&quot;),
    sourceProvider,
    saveOffsetAfterEnvelopes = 100,
    saveOffsetAfterDuration = 500.millis,
    handler = new ShoppingCartHandler)</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/akka-projection/tree/v0.1/examples/src/test/java/jdocs/cassandra/CassandraProjectionDocExample.java#L31-L34" target="_blank" title="Go to snippet source"></a><code class="language-java">import akka.projection.cassandra.javadsl.CassandraProjection;
import akka.projection.Projection;
import akka.projection.ProjectionId;

int saveOffsetAfterEnvelopes = 100;
Duration saveOffsetAfterDuration = Duration.ofMillis(500);

Projection&lt;EventEnvelope&lt;ShoppingCart.Event&gt;&gt; projection =
  CassandraProjection.atLeastOnce(
    ProjectionId.of(&quot;shopping-carts&quot;, &quot;carts-1&quot;),
    sourceProvider,
    saveOffsetAfterEnvelopes,
    saveOffsetAfterDuration,
    new ShoppingCartHandler());</code></pre></dd>
</dl>
<p>Since the offset must be stored for each envelope this is slower than <a href="cassandra.html#at-least-once">at-least-once</a>, which can batch offsets before storing.</p>
<p>The <a href="cassandra.html#handler"><code>ShoppingCartHandler</code> is shown below</a>.</p>
<h2><a href="#grouping" name="grouping" class="anchor"><span class="anchor-link"></span></a>Grouping</h2>
<p>The envelopes can be grouped before processing, which can be useful for batch updates.</p>
<p>TODO: Implementation in progress, see <a href="https://github.com/akka/akka-projection/pull/118">PR #118</a></p>
<h2><a href="#handler" name="handler" class="anchor"><span class="anchor-link"></span></a>Handler</h2>
<p>It&rsquo;s in the <span class="group-java"><a href="/api/akka-projection/0.1/akka/projection/javadsl/Handler.html" title="akka.projection.javadsl.Handler"><code>Handler</code></a></span><span class="group-scala"><a href="/api/akka-projection/0.1/akka/projection/scaladsl/Handler.html" title="akka.projection.scaladsl.Handler"><code>Handler</code></a></span> that you implement the processing of each envelope. It&rsquo;s essentially a function from <code>Envelope</code> to <span class="group-scala"><code>Future[Done]</code></span><span class="group-java"><code>CompletionStage&lt;Done&gt;</code></span>. This means that the envelope handler can integrate with anything, such as publishing to a message broker, or updating a read model in Cassandra.</p>
<p>A handler that is consuming <code>ShoppingCart.Event</code> from <code>eventsByTag</code> can look like this:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/akka-projection/tree/v0.1/examples/src/test/scala/docs/cassandra/CassandraProjectionDocExample.scala#L36-L40" target="_blank" title="Go to snippet source"></a><code class="language-scala">import akka.projection.scaladsl.Handler
import akka.Done
import org.slf4j.LoggerFactory
import scala.concurrent.Future

class ShoppingCartHandler extends Handler[EventEnvelope[ShoppingCart.Event]] {
  private val logger = LoggerFactory.getLogger(getClass)

  override def process(envelope: EventEnvelope[ShoppingCart.Event]): Future[Done] = {
    envelope.event match {
      case ShoppingCart.CheckedOut(cartId, time) =&gt;
        logger.info(&quot;Shopping cart {} was checked out at {}&quot;, cartId, time)
        Future.successful(Done)

      case otherEvent =&gt;
        logger.debug(&quot;Shopping cart {} changed by {}&quot;, otherEvent.cartId, otherEvent)
        Future.successful(Done)
    }
  }
}</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/akka-projection/tree/v0.1/examples/src/test/java/jdocs/cassandra/CassandraProjectionDocExample.java#L38-L45" target="_blank" title="Go to snippet source"></a><code class="language-java">import akka.projection.javadsl.Handler;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

import java.util.Optional;
import java.util.concurrent.CompletableFuture;
import java.util.concurrent.CompletionStage;

public class ShoppingCartHandler extends Handler&lt;EventEnvelope&lt;ShoppingCart.Event&gt;&gt; {
  private Logger logger = LoggerFactory.getLogger(getClass());

  @Override
  public CompletionStage&lt;Done&gt; process(EventEnvelope&lt;ShoppingCart.Event&gt; envelope) {
    ShoppingCart.Event event = envelope.event();
    if (event instanceof ShoppingCart.CheckedOut) {
      ShoppingCart.CheckedOut checkedOut = (ShoppingCart.CheckedOut) event;
      logger.info(&quot;Shopping cart {} was checked out at {}&quot;, checkedOut.cartId, checkedOut.eventTime);
      return CompletableFuture.completedFuture(Done.getInstance());
    } else {
      logger.debug(&quot;Shopping cart {} changed by {}&quot;, event.getCartId(), event);
      return CompletableFuture.completedFuture(Done.getInstance());
    }
  }
}</code></pre></dd>
</dl>
<p>Such simple handlers can also be defined as plain <span class="group-scala">functions</span><span class="group-java">lambdas</span> via the helper <span class="group-scala"><code>Handler.apply</code></span><span class="group-java"><code>Handler.fromFunction</code></span> factory method.</p>
<h3><a href="#stateful-handler" name="stateful-handler" class="anchor"><span class="anchor-link"></span></a>Stateful handler</h3>
<p>The <code>Handler</code> can be stateful, with variables and mutable data structures. It is invoked by the <code>Projection</code> machinery one envelope at a time and visibility guarantees between the invocations are handled automatically, i.e. no volatile or other concurrency primitives are needed for managing the state.</p>
<p>The returned <span class="group-scala"><code>Future[Done]</code></span><span class="group-java"><code>CompletionStage&lt;Done&gt;</code></span> is to be completed when the processing of the <code>envelope</code> has finished. The handler will not be invoked with the next envelope until after the returned <span class="group-scala"><code>Future[Done]</code></span><span class="group-java"><code>CompletionStage&lt;Done&gt;</code></span> has been completed.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/akka-projection/tree/v0.1/examples/src/test/scala/docs/cassandra/WordCountDocExample.scala#L96-L107" target="_blank" title="Go to snippet source"></a><code class="language-scala">class WordCountHandler extends Handler[WordEnvelope] {
  private val logger = LoggerFactory.getLogger(getClass)
  private var state: Map[Word, Count] = Map.empty

  override def process(envelope: WordEnvelope): Future[Done] = {
    val word = envelope.word
    val newCount = state.getOrElse(word, 0) + 1
    logger.info(&quot;Word count for {} is {}&quot;, word, newCount)
    state = state.updated(word, newCount)
    Future.successful(Done)
  }
}</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/akka-projection/tree/v0.1/examples/src/test/java/jdocs/cassandra/WordCountDocExample.java#L9" target="_blank" title="Go to snippet source"></a><code class="language-java">// TODO</code></pre></dd>
</dl><div class="callout note "><div class="callout-title">Note</div>
<p>It is important that the <code>Handler</code> instance is not shared between several <code>Projection</code> instances, because then it would be invoked concurrently, which is not how it is intended to be used. Each <code>Projection</code> instance should use a new <code>Handler</code> instance. </p></div>
<p>However, the state must typically be loaded and updated by asynchronous operations and then it can be error prone to manage the state in variables of the <code>Handler</code>. For that purpose a <span class="group-java"><a href="/api/akka-projection/0.1/akka/projection/javadsl/StatefulHandler.html" title="akka.projection.javadsl.StatefulHandler"><code>StatefulHandler</code></a></span><span class="group-scala"><a href="/api/akka-projection/0.1/akka/projection/scaladsl/StatefulHandler.html" title="akka.projection.scaladsl.StatefulHandler"><code>StatefulHandler</code></a></span> is provided.</p>
<p>Let us look at how a <code>StatefulHandler</code> can be implemented in the context of a &ldquo;word count&rdquo; domain. The purpose is to process a stream of words and for each word keep track of how many times it has occurred. </p>
<p>Given an envelope and <code>SourceProvider</code> for this example:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/akka-projection/tree/v0.1/examples/src/test/scala/docs/cassandra/WordCountDocExample.scala#L22-L26" target="_blank" title="Go to snippet source"></a><code class="language-scala">type Word = String
type Count = Int

final case class WordEnvelope(offset: Long, word: Word)

class WordSource(implicit ec: ExecutionContext) extends SourceProvider[Long, WordEnvelope] {

  private val src = Source(
    List(WordEnvelope(1L, &quot;abc&quot;), WordEnvelope(2L, &quot;def&quot;), WordEnvelope(3L, &quot;ghi&quot;), WordEnvelope(4L, &quot;abc&quot;)))

  override def source(offset: () =&gt; Future[Option[Long]]): Future[Source[WordEnvelope, _]] = {
    offset().map {
      case Some(o) =&gt; src.dropWhile(_.offset &lt;= o)
      case _       =&gt; src
    }
  }

  override def extractOffset(env: WordEnvelope): Long = env.offset
}</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/akka-projection/tree/v0.1/examples/src/test/java/jdocs/cassandra/WordCountDocExample.java#L9" target="_blank" title="Go to snippet source"></a><code class="language-java">// TODO</code></pre></dd>
</dl>
<p>and a repository for the interaction with the database:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/akka-projection/tree/v0.1/examples/src/test/scala/docs/cassandra/WordCountDocExample.scala#L30-L34" target="_blank" title="Go to snippet source"></a><code class="language-scala">trait WordCountRepository {
  def load(id: String, word: Word): Future[Count]
  def loadAll(id: String): Future[Map[Word, Count]]
  def save(id: String, word: Word, count: Count): Future[Done]
}</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/akka-projection/tree/v0.1/examples/src/test/java/jdocs/cassandra/WordCountDocExample.java#L9" target="_blank" title="Go to snippet source"></a><code class="language-java">// TODO</code></pre></dd>
</dl>
<p>The <code>Projection</code> can be definined as:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/akka-projection/tree/v0.1/examples/src/test/scala/akka/projection/cassandra/scaladsl/WordCountDocExampleSpec.scala#L94-L101" target="_blank" title="Go to snippet source"></a><code class="language-scala">val projection =
  CassandraProjection
    .atLeastOnce[Long, WordEnvelope](
      projectionId,
      new WordSource,
      saveOffsetAfterEnvelopes = 1,
      saveOffsetAfterDuration = Duration.Zero,
      new WordCountHandler(projectionId, repository))</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/akka-projection/tree/v0.1/examples/src/test/java/jdocs/cassandra/WordCountDocExample.java#L9" target="_blank" title="Go to snippet source"></a><code class="language-java">// TODO</code></pre></dd>
</dl>
<p>The <code>handler</code> can be implemented as follows.</p>
<p>A naive approach would be to have one row per word for storing the current count in the database. The handler could be implemented as a completely stateless handler that for each processed envelope loads the current count from the database, increment the count by 1 and saved it again. Typically there will be several instances of the <code>Projection</code> with different <code>ProjectionId.id</code>. Each <code>Projection</code> instance would be responsible for processing a subset of all words. This stateless approach wouldn&rsquo;t be very efficient and you would have to use optimistic database locking to make sure that one <code>Projection</code> instance is not overwriting the stored value from another instance without reading the right value first.</p>
<p>Better would be that each <code>Projection</code> instance is a single-writer so that it can keep the current word count in memory and only load it on startup or on demand.</p>
<p>A handler that is loading the state from the database when it&rsquo;s starting up:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/akka-projection/tree/v0.1/examples/src/test/scala/docs/cassandra/WordCountDocExample.scala#L114-L128" target="_blank" title="Go to snippet source"></a><code class="language-scala">class WordCountHandler(projectionId: ProjectionId, repository: WordCountRepository)(implicit ec: ExecutionContext)
    extends StatefulHandler[Map[Word, Count], WordEnvelope] {

  override def initialState(): Future[Map[Word, Count]] = repository.loadAll(projectionId.id)

  override def process(state: Map[Word, Count], envelope: WordEnvelope): Future[Map[Word, Count]] = {
    val word = envelope.word
    val newCount = state.getOrElse(word, 0) + 1
    val newState = for {
      _ &lt;- repository.save(projectionId.id, word, newCount)
    } yield state.updated(word, newCount)

    newState
  }
}</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/akka-projection/tree/v0.1/examples/src/test/java/jdocs/cassandra/WordCountDocExample.java#L9" target="_blank" title="Go to snippet source"></a><code class="language-java">// TODO</code></pre></dd>
</dl>
<p>The <code>StatefulHandler</code> has two methods that needs to be implemented. </p>
<ul>
  <li><code>initialState</code> - Invoked to load the initial state when the projection is started or if previous <code>process</code> failed.</li>
  <li><code>process(state, envelope)</code> - Invoked for each <code>Envelope</code>, one at a time. The <code>state</code> parameter is the completed  value of the previously returned <code>Future[State]</code> or the <code>initialState</code>.</li>
</ul>
<p>If the previously returned <code>Future[State]</code> failed it will call <code>initialState</code> again and use that value.</p>
<p>Another implementation would be a handler that is loading the current count for a word on demand, and thereafter caches it in the in-memory state:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/akka-projection/tree/v0.1/examples/src/test/scala/docs/cassandra/WordCountDocExample.scala#L135-L161" target="_blank" title="Go to snippet source"></a><code class="language-scala">class WordCountHandler(projectionId: ProjectionId, repository: WordCountRepository)(implicit ec: ExecutionContext)
    extends StatefulHandler[Map[Word, Count], WordEnvelope] {

  override def initialState(): Future[Map[Word, Count]] =
    Future.successful(Map.empty)

  override def process(state: Map[Word, Count], envelope: WordEnvelope): Future[Map[Word, Count]] = {
    val word = envelope.word

    val currentCount =
      state.get(word) match {
        case None =&gt;
          repository.load(projectionId.id, word)
        case Some(count) =&gt;
          Future.successful(count)
      }

    val newState = for {
      c &lt;- currentCount
      newCount = c + 1
      _ &lt;- repository.save(projectionId.id, word, newCount)
    } yield state.updated(word, newCount)

    newState
  }

}</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/akka-projection/tree/v0.1/examples/src/test/java/jdocs/cassandra/WordCountDocExample.java#L9" target="_blank" title="Go to snippet source"></a><code class="language-java">// TODO</code></pre></dd>
</dl>
<h3><a href="#handler-as-an-actor" name="handler-as-an-actor" class="anchor"><span class="anchor-link"></span></a>Handler as an actor</h3>
<p>A good alternative for advanced state management is to implement the handler as an <a href="https://doc.akka.io/docs/akka/current/typed/actors.html">actor</a>.</p>
<p>TODO: Documentation pending, see <a href="https://github.com/akka/akka-projection/pull/116">PR #116</a></p>
<h3><a href="#handler-lifecycle" name="handler-lifecycle" class="anchor"><span class="anchor-link"></span></a>Handler lifecycle</h3>
<p>You can override the <code>start</code> and <code>stop</code> methods of the <span class="group-java"><a href="/api/akka-projection/0.1/akka/projection/javadsl/Handler.html" title="akka.projection.javadsl.Handler"><code>Handler</code></a></span><span class="group-scala"><a href="/api/akka-projection/0.1/akka/projection/scaladsl/Handler.html" title="akka.projection.scaladsl.Handler"><code>Handler</code></a></span> to implement initialization before first envelope is processed and resource cleanup when the projection is stopped. Those methods are also called when the <code>Projection</code> is restarted after failure.</p>
<h2><a href="#processing-with-akka-streams" name="processing-with-akka-streams" class="anchor"><span class="anchor-link"></span></a>Processing with Akka Streams</h2>
<p>An Akka Streams <code>Flow</code> can be used instead of a handler for processing the envelopes with at-least-once semantics.</p>
<p>TODO: Implementation in progress, see <a href="https://github.com/akka/akka-projection/pull/119">PR #119</a></p>
<h2><a href="#schema" name="schema" class="anchor"><span class="anchor-link"></span></a>Schema</h2>
<p>The database schema for the offset storage table:</p>
<pre><code>CREATE TABLE IF NOT EXISTS akka_projection.offset_store (
  projection_id text,
  offset text,
  manifest text,
  last_updated timestamp,
  PRIMARY KEY (projection_id))
</code></pre>
<h2><a href="#offset-types" name="offset-types" class="anchor"><span class="anchor-link"></span></a>Offset types</h2>
<p>The supported offset types of the <code>CassandraProjection</code> are:</p>
<ul>
  <li><code>akka.persistence.query.Offset</code> types from <a href="eventsourced.html">events from Akka Persistence</a></li>
  <li><code>String</code></li>
  <li><span class="group-scala"><code>Int</code></span><span class="group-java">Integer</span></li>
  <li><code>Long</code></li>
</ul><div class="callout note "><div class="callout-title">Note</div>
<p>The <span class="group-scala"><a href="/api/akka-projection/0.1/akka/projection/MergeableOffset.html" title="akka.projection.MergeableOffset"><code>MergeableOffset</code></a></span><span class="group-java"><a href="/api/akka-projection/0.1/akka/projection/MergeableOffset.html" title="akka.projection.MergeableOffset"><code>MergeableOffset</code></a></span> that is used for <a href="kafka.html">messages from Kafka</a> is not implemented for the <code>CassandraProjection</code> yet, see <a href="https://github.com/akka/akka-projection/issues/97">issue #97</a>.</p></div>
<h2><a href="#configuration" name="configuration" class="anchor"><span class="anchor-link"></span></a>Configuration</h2>
<pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/akka-projection/tree/v0.1/akka-projection-cassandra/src/main/resources/reference.conf" target="_blank" title="Go to snippet source"></a><code class="language-conf"># This defines the default configuration for akka-projection-cassandra.
# Make your edits/overrides in your application.conf.

//#config
akka.projection.cassandra {
  # The implementation of `akka.stream.alpakka.cassandra.CqlSessionProvider`
  # used for creating the `CqlSession`.
  # It may optionally have a constructor with an `ClassicActorSystemProvider` and `Config` parameters.
  session-provider = &quot;akka.stream.alpakka.cassandra.DefaultSessionProvider&quot;

  # Configure Akka Discovery by setting a service name
  service-discovery {
    name = &quot;&quot;
    lookup-timeout = 1 s
  }

  # The ExecutionContext to use for the session tasks and future composition.
  session-dispatcher = &quot;akka.actor.default-dispatcher&quot;

  # Full config path to the Datastax Java driver&#39;s configuration section.
  # When connecting to more than one Cassandra cluster different session configuration can be
  # defined with this property.
  # See https://docs.datastax.com/en/developer/java-driver/latest/manual/core/configuration/#quick-overview
  # and https://docs.datastax.com/en/developer/java-driver/latest/manual/core/configuration/reference/
  datastax-java-driver-config = &quot;datastax-java-driver&quot;
}
//#config</code></pre>
</div>
</article>
<div class="row">
<div class="small-12 column">
<section class="nav-prev-next row">
<div class="nav-prev small-6 column">
<a href="kafka.html"><i class="icon-prev"></i> <span class="link-prev">Messages from and to Kafka</span></a>
</div>
<div class="nav-next small-6 column clearfix">
<a class="float-right" href="slick.html">Offset in relational DB with Slick <i class="icon-next"></i></a>
</div>
</section>
</div>
</div>
<div class="source-github row">
Found an error in this documentation? The source code for this page can be found <a href="https://github.com/akka/akka-projection/tree/v0.1/docs/src/main/paradox/cassandra.md">here</a>.
Please feel free to edit and contribute a pull request.
</div>

<footer class="page-footer row clearfix">
<img class="akka-icon float-left show-for-medium" src="images/akka-icon.svg" />
<section class="copyright">
<div>Akka Projection is Open Source and available under the Apache 2 License.</div>
<p class="legal">
&copy; 2011-2020 <a href="https://www.lightbend.com" target="_blank">Lightbend, Inc.</a> |
<a href="https://www.lightbend.com/legal/licenses" target="_blank">Licenses</a> |
<a href="https://www.lightbend.com/legal/terms" target="_blank">Terms</a> |
<a href="https://www.lightbend.com/legal/privacy" target="_blank">Privacy Policy</a> |
<a href="https://akka.io/cookie/" target="_blank">Cookie Listing</a> |
<a class="optanon-toggle-display">Cookie Settings</a>
</p>
</section>

</footer>
</section>
</main>
</div>

<script type="text/javascript" src="js/scrollsneak.js"></script>
<script type="text/javascript">jQuery(document).foundation();</script>
<script type="text/javascript" src="js/groups.js"></script>
<script type="text/javascript" src="js/page.js"></script>
<script type="text/javascript" src="js/magellan.js"></script>
<script type="text/javascript" src="js/metadata-toggle.js"></script>

<style type="text/css">@import "lib/prettify/prettify.css";</style>
<script type="text/javascript" src="lib/prettify/prettify.js"></script>
<script type="text/javascript" src="lib/prettify/lang-scala.js"></script>
<script type="text/javascript">//<![CDATA[
jQuery(function(){window.prettyPrint && prettyPrint()});
//]]></script>
<script type="text/javascript" src="assets/js/warnOldVersion.js"></script>
<script type="text/javascript">//<![CDATA[
jQuery(function(jq){initOldVersionWarnings(jq, '0.1', 'https://doc.akka.io/docs/akka-projection/current/')});
//]]></script>


</body>
</html>
