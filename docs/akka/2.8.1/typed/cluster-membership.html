<!DOCTYPE html>
<html class="no-js" lang="en">

<head>
<title>Cluster Membership Service &bull; Akka Documentation</title>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<meta name="description" content="The Akka Cluster node membership service, manages dynamic member states and lifecycle with no external infrastructure needed."/>
<link rel="canonical" href="https://doc.akka.io/docs/akka/current/typed/cluster-membership.html"/>
<script type="text/javascript" src="../lib/jquery/jquery.min.js"></script>
<script type="text/javascript" src="../lib/foundation/dist/js/foundation.min.js"></script>
<link rel="stylesheet" type="text/css" href="../lib/normalize.css/normalize.css"/>
<link rel="stylesheet" type="text/css" href="../lib/foundation/dist/css/foundation.min.css"/>
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.css" />
<link rel="stylesheet" type="text/css" href="../css/icons.css"/>
<link rel="stylesheet" type="text/css" href="../css/page-8.css"/>
<link rel="stylesheet" type="text/css" href="../css/banner-2.css"/>
<link rel="shortcut icon" href="../images/favicon.ico" />
<link rel="apple-touch-icon" sizes="180x180" href="../images/apple-touch-icon.png"/>
<link rel="icon" type="image/png" sizes="32x32" href="../images/favicon-32x32.png"/>
<link rel="icon" type="image/png" sizes="16x16" href="../images/favicon-16x16.png"/>
<link rel="manifest" href="../images/manifest.json"/>
<meta name="msapplication-TileImage" content="../images/mstile-150x150.png"/>
<meta name="msapplication-TileColor" content="#15a9ce"/>
<meta name="theme-color" content="#15a9ce"/>
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>
<!-- OneTrust Cookies Consent Notice (Production Standard, akka.io, en-GB) start -->
<script src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js"  type="text/javascript" charset="UTF-8" data-domain-script="28b912e7-09e9-43d5-91e4-3d1897044004" ></script>
<script type="text/javascript">
function OptanonWrapper() { }
</script>
<!-- OneTrust Cookies Consent Notice (Production Standard, akka.io, en-GB) end -->
<!--Google Analytics-->
<script type="text/plain" class="optanon-category-2">
var _gaq = _gaq || [];
_gaq.push(['_setAccount', 'UA-21117439-1']);
_gaq.push(['_setDomainName', 'akka.io']);
_gaq.push(['_trackPageview']);
(function() {
var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})()
</script>
<!-- Google Tag Manager -->
<script type="text/plain" class="optanon-category-2">
(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-KBJGH35');
</script>
<!--Marketo-->
<script type="text/plain" class="optanon-category-3">
(function() {
var didInit = false;
function initMunchkin() {
if(didInit === false) {
didInit = true;
Munchkin.init('558-NCX-702', { 'asyncOnly': true, 'disableClickDelay': true });
}
}
var s = document.createElement('script');
s.type = 'text/javascript';
s.async = true;
s.src = '//munchkin.marketo.net/munchkin.js';
s.onreadystatechange = function() {
if (this.readyState == 'complete' || this.readyState == 'loaded') {
initMunchkin();
}
};
s.onload = initMunchkin;
document.getElementsByTagName('head')[0].appendChild(s);
})();
</script>
</head>

<body id="underlay" data-toggler="nav-open">
<div id="lightbend-banner" class="lightbend-banner akka full-width" data-category="OSS Lightbend Banner Impression" data-label="Akka Banner Impression">
<div class="oss-wrapper">
<div class="oss-brand">
<a class="oss-track-link-label" data-category="OSS Lightbend Banner Clicks" data-label="Lightbend Logo - Akka Banner" href="https://www.lightbend.com">
<img class="lightbend-logo" src="../images/banner-logos/lightbend-reverse.svg" alt="Lightbend" title="Lightbend">
</a>
</div>
<div class="oss-ad no-drop-down">
<nav id="lightbendRotator" class="lightbend-rotator">
<a class="oss-track-link-label" data-category="OSS Lightbend Banner Clicks" data-label="Promo Rotator - Lightbend Changed its Software Licensing Model for Akka Technology. [License FAQ] - Akka Banner" href="https://www.lightbend.com/akka/license-faq">
<strong>Lightbend</strong> Changed its Software Licensing Model for Akka Technology. <span class="akka-btn">License FAQ</span>
</a>
</nav>
</div>
</div>
</div>

<header class="site-header hide-for-large">
<div class="sticky-header clearfix">
<a href="https://akka.io"><img class="logo" src="../images/akka-logo-reverse.svg"/></a>

<button class="menu-icon float-right" type="button" data-toggle="underlay overlay"></button>
</div>
<div id="overlay" class="overlay-nav" data-toggler="nav-open">
<header class="nav-header">
<div class="nav-header-title">
<h1><a href="../index.html">Akka Documentation</a></h1>
</div>
<div class="nav-header-version">
Version 2.8.1
</div>
<div class="nav-header-groups">
<select class="supergroup" name="Language"><option class="group" value="group-scala">Scala</option><option class="group" value="group-java">Java</option></select>
</div>
<div id="overlay-search-container" class="nav-header-search">
<input id="overlay-search" type="search" class="search" placeholder="Search" />
</div>
</header>
<nav class="nav-toc">
<ul>
  <li><a href="../security/index.html" class="page">Security Announcements</a></li>
  <li><a href="../typed/guide/index.html" class="page">Getting Started Guide</a></li>
  <li><a href="../general/index.html" class="page">General Concepts</a></li>
  <li><a href="../typed/index.html" class="page">Actors</a></li>
  <li><a href="../typed/index-cluster.html" class="page">Cluster</a>
  <ul>
    <li><a href="../typed/cluster.html" class="page">Cluster Usage</a></li>
    <li><a href="../typed/cluster-concepts.html" class="page">Cluster Specification</a></li>
    <li><a href="../typed/cluster-membership.html#cluster-membership-service" class="active page">Cluster Membership Service</a>
    <ul>
      <li><a href="../typed/cluster-membership.html#introduction" class="header">Introduction</a></li>
      <li><a href="../typed/cluster-membership.html#member-states" class="header">Member States</a></li>
      <li><a href="../typed/cluster-membership.html#member-events" class="header">Member Events</a></li>
      <li><a href="../typed/cluster-membership.html#membership-lifecycle" class="header">Membership Lifecycle</a></li>
      <li><a href="../typed/cluster-membership.html#leader" class="header">Leader</a></li>
      <li><a href="../typed/cluster-membership.html#weaklyup-members" class="header">WeaklyUp Members</a></li>
      <li><a href="../typed/cluster-membership.html#full-cluster-shutdown" class="header">Full cluster shutdown</a></li>
      <li><a href="../typed/cluster-membership.html#state-diagrams" class="header">State Diagrams</a></li>
    </ul></li>
    <li><a href="../typed/failure-detector.html" class="page">Phi Accrual Failure Detector</a></li>
    <li><a href="../typed/distributed-data.html" class="page">Distributed Data</a></li>
    <li><a href="../typed/cluster-singleton.html" class="page">Cluster Singleton</a></li>
    <li><a href="../typed/cluster-sharding.html" class="page">Cluster Sharding</a></li>
    <li><a href="../typed/cluster-sharding-concepts.html" class="page">Cluster Sharding concepts</a></li>
    <li><a href="../typed/cluster-sharded-daemon-process.html" class="page">Sharded Daemon Process</a></li>
    <li><a href="../typed/cluster-dc.html" class="page">Multi-DC Cluster</a></li>
    <li><a href="../typed/distributed-pub-sub.html" class="page">Distributed Publish Subscribe in Cluster</a></li>
    <li><a href="../typed/reliable-delivery.html" class="page">Reliable delivery</a></li>
    <li><a href="../serialization.html" class="page">Serialization</a></li>
    <li><a href="../serialization-jackson.html" class="page">Serialization with Jackson</a></li>
    <li><a href="../multi-jvm-testing.html" class="page">Multi JVM Testing</a></li>
    <li><a href="../multi-node-testing.html" class="page">Multi Node Testing</a></li>
    <li><a href="../remoting-artery.html" class="page">Remoting</a></li>
    <li><a href="../remote-security.html" class="page">Remote Security</a></li>
    <li><a href="../split-brain-resolver.html" class="page">Split Brain Resolver</a></li>
    <li><a href="../coordination.html" class="page">Coordination</a></li>
    <li><a href="../typed/choosing-cluster.html" class="page">Choosing Akka Cluster</a></li>
  </ul></li>
  <li><a href="../typed/index-persistence.html" class="page">Persistence (Event Sourcing)</a></li>
  <li><a href="../typed/index-persistence-durable-state.html" class="page">Persistence (Durable State)</a></li>
  <li><a href="../stream/index.html" class="page">Streams</a></li>
  <li><a href="../discovery/index.html" class="page">Discovery</a></li>
  <li><a href="../index-utilities.html" class="page">Utilities</a></li>
  <li><a href="../common/other-modules.html" class="page">Other Akka modules</a></li>
  <li><a href="../additional/deploy.html" class="page">Package, Deploy and Run</a></li>
  <li><a href="../project/index.html" class="page">Project Information</a></li>
  <li><a href="../index-classic.html" class="page">Akka Classic</a></li>
</ul>
</nav>
</div>
</header>
<div class="site-content-wrapper">
<aside class="sticky-sidebar show-for-large">
<header class="nav-header sticky-sidebar-header">
<div class="nav-header-title">
<h1><a href="../index.html">Akka Documentation</a></h1>
</div>
<div class="nav-header-version">
Version 2.8.1
</div>
<div class="nav-header-groups">
<select class="supergroup" name="Language"><option class="group" value="group-scala">Scala</option><option class="group" value="group-java">Java</option></select>
</div>
<div class="nav-header-search">
<input id="search" type="search" class="search" placeholder="Search" />
</div>
</header>
<nav class="site-nav sticky-sidebar-contents">
<div class="nav-toc">
<ul>
  <li><a href="../security/index.html" class="page">Security Announcements</a></li>
  <li><a href="../typed/guide/index.html" class="page">Getting Started Guide</a></li>
  <li><a href="../general/index.html" class="page">General Concepts</a></li>
  <li><a href="../typed/index.html" class="page">Actors</a></li>
  <li><a href="../typed/index-cluster.html" class="page">Cluster</a>
  <ul>
    <li><a href="../typed/cluster.html" class="page">Cluster Usage</a></li>
    <li><a href="../typed/cluster-concepts.html" class="page">Cluster Specification</a></li>
    <li><a href="../typed/cluster-membership.html#cluster-membership-service" class="active page">Cluster Membership Service</a>
    <ul>
      <li><a href="../typed/cluster-membership.html#introduction" class="header">Introduction</a></li>
      <li><a href="../typed/cluster-membership.html#member-states" class="header">Member States</a></li>
      <li><a href="../typed/cluster-membership.html#member-events" class="header">Member Events</a></li>
      <li><a href="../typed/cluster-membership.html#membership-lifecycle" class="header">Membership Lifecycle</a></li>
      <li><a href="../typed/cluster-membership.html#leader" class="header">Leader</a></li>
      <li><a href="../typed/cluster-membership.html#weaklyup-members" class="header">WeaklyUp Members</a></li>
      <li><a href="../typed/cluster-membership.html#full-cluster-shutdown" class="header">Full cluster shutdown</a></li>
      <li><a href="../typed/cluster-membership.html#state-diagrams" class="header">State Diagrams</a></li>
    </ul></li>
    <li><a href="../typed/failure-detector.html" class="page">Phi Accrual Failure Detector</a></li>
    <li><a href="../typed/distributed-data.html" class="page">Distributed Data</a></li>
    <li><a href="../typed/cluster-singleton.html" class="page">Cluster Singleton</a></li>
    <li><a href="../typed/cluster-sharding.html" class="page">Cluster Sharding</a></li>
    <li><a href="../typed/cluster-sharding-concepts.html" class="page">Cluster Sharding concepts</a></li>
    <li><a href="../typed/cluster-sharded-daemon-process.html" class="page">Sharded Daemon Process</a></li>
    <li><a href="../typed/cluster-dc.html" class="page">Multi-DC Cluster</a></li>
    <li><a href="../typed/distributed-pub-sub.html" class="page">Distributed Publish Subscribe in Cluster</a></li>
    <li><a href="../typed/reliable-delivery.html" class="page">Reliable delivery</a></li>
    <li><a href="../serialization.html" class="page">Serialization</a></li>
    <li><a href="../serialization-jackson.html" class="page">Serialization with Jackson</a></li>
    <li><a href="../multi-jvm-testing.html" class="page">Multi JVM Testing</a></li>
    <li><a href="../multi-node-testing.html" class="page">Multi Node Testing</a></li>
    <li><a href="../remoting-artery.html" class="page">Remoting</a></li>
    <li><a href="../remote-security.html" class="page">Remote Security</a></li>
    <li><a href="../split-brain-resolver.html" class="page">Split Brain Resolver</a></li>
    <li><a href="../coordination.html" class="page">Coordination</a></li>
    <li><a href="../typed/choosing-cluster.html" class="page">Choosing Akka Cluster</a></li>
  </ul></li>
  <li><a href="../typed/index-persistence.html" class="page">Persistence (Event Sourcing)</a></li>
  <li><a href="../typed/index-persistence-durable-state.html" class="page">Persistence (Durable State)</a></li>
  <li><a href="../stream/index.html" class="page">Streams</a></li>
  <li><a href="../discovery/index.html" class="page">Discovery</a></li>
  <li><a href="../index-utilities.html" class="page">Utilities</a></li>
  <li><a href="../common/other-modules.html" class="page">Other Akka modules</a></li>
  <li><a href="../additional/deploy.html" class="page">Package, Deploy and Run</a></li>
  <li><a href="../project/index.html" class="page">Project Information</a></li>
  <li><a href="../index-classic.html" class="page">Akka Classic</a></li>
</ul>
</div>
</nav>
<footer class="nav-footer sticky-sidebar-footer">
<a href="https://akka.io"><img class="logo" src="../images/akka-logo-reverse.svg"/></a>

</footer>
</aside>
<main class="fixed-shift-for-large expanded row">
<section class="site-content small-12 column">
<article class="page-content row">
<div class="small-12 column" id="docs">
<h1><a href="#cluster-membership-service" name="cluster-membership-service" class="anchor"><span class="anchor-link"></span></a>Cluster Membership Service</h1>
<p>The core of Akka Cluster is the cluster membership, to keep track of what nodes are part of the cluster and their health. Cluster membership is communicated using <a href="cluster-concepts.html#gossip">gossip</a> and <a href="cluster-concepts.html#failure-detector">failure detection</a>.</p>
<p>There are several <a href="cluster.html#higher-level-cluster-tools">Higher level Cluster tools</a> that are built on top of the cluster membership service.</p>
<h2><a href="#introduction" name="introduction" class="anchor"><span class="anchor-link"></span></a>Introduction</h2>
<p>A cluster is made up of a set of member nodes. The identifier for each node is a <code>hostname:port:uid</code> tuple. An Akka application can be distributed over a cluster with each node hosting some part of the application. Cluster membership and the actors running on that node of the application are decoupled. A node could be a member of a cluster without hosting any actors. Joining a cluster is initiated by issuing a <code>Join</code> command to one of the nodes in the cluster to join.</p>
<p>The node identifier internally also contains a UID that uniquely identifies this actor system instance at that <code>hostname:port</code>. Akka uses the UID to be able to reliably trigger remote death watch. This means that the same actor system can never join a cluster again once it&rsquo;s been removed from that cluster. To re-join an actor system with the same <code>hostname:port</code> to a cluster you have to stop the actor system and start a new one with the same <code>hostname:port</code> which will then receive a different UID.</p>
<h2><a href="#member-states" name="member-states" class="anchor"><span class="anchor-link"></span></a>Member States</h2>
<p>The cluster membership state is a specialized <a href="https://hal.inria.fr/file/index/docid/555588/filename/techreport.pdf">CRDT</a>, which means that it has a monotonic merge function. When concurrent changes occur on different nodes the updates can always be merged and converge to the same end result.</p>
<ul>
  <li>
  <p><strong>joining</strong> - transient state when joining a cluster</p></li>
  <li>
  <p><strong>weakly up</strong> - transient state while network split (only if <code>akka.cluster.allow-weakly-up-members=on</code>)</p></li>
  <li>
  <p><strong>up</strong> - normal operating state</p></li>
  <li>
  <p><strong>preparing for shutdown</strong> / <strong>ready for shutdown</strong> - an optional state that can be moved to before doing a full cluster shut down</p></li>
  <li>
  <p><strong>leaving</strong> / <strong>exiting</strong> - states during graceful removal</p></li>
  <li>
  <p><strong>down</strong> - marked as down (no longer part of cluster decisions)</p></li>
  <li>
  <p><strong>removed</strong> - tombstone state (no longer a member)</p></li>
</ul>
<h2><a href="#member-events" name="member-events" class="anchor"><span class="anchor-link"></span></a>Member Events</h2>
<p>The events to track the life-cycle of members are:</p>
<ul>
  <li><code>ClusterEvent.MemberJoined</code> - A new member has joined the cluster and its status has been changed to <code>Joining</code></li>
  <li><code>ClusterEvent.MemberUp</code> - A new member has joined the cluster and its status has been changed to <code>Up</code></li>
  <li><code>ClusterEvent.MemberExited</code> - A member is leaving the cluster and its status has been changed to <code>Exiting</code> Note that the node might already have been shutdown when this event is published on another node.</li>
  <li><code>ClusterEvent.MemberRemoved</code> - Member completely removed from the cluster.</li>
  <li><code>ClusterEvent.UnreachableMember</code> - A member is considered as unreachable, detected by the failure detector of at least one other node.</li>
  <li><code>ClusterEvent.ReachableMember</code> - A member is considered as reachable again, after having been unreachable. All nodes that previously detected it as unreachable has detected it as reachable again.</li>
  <li><code>ClusterEvent.MemberPreparingForShutdown</code> - A member is preparing for a full cluster shutdown</li>
  <li><code>ClusterEvent.MemberReadyForShutdown</code> - A member is ready for a full cluster shutdown</li>
</ul>
<h2><a href="#membership-lifecycle" name="membership-lifecycle" class="anchor"><span class="anchor-link"></span></a>Membership Lifecycle</h2>
<p>A node is introduced to the cluster by invoking the <code>join</code> action which puts the node in the <code>joining</code> state. Once all nodes have seen that the new node is joining (through <a href="cluster-concepts.html#gossip-convergence">gossip convergence</a>) the <a href="cluster-concepts.html#leader"><code>leader</code></a> will set the member state to <code>up</code>.</p>
<p>If a node is leaving the cluster in a safe, expected manner, for example through <a href="../coordinated-shutdown.html">coordinated shutdown</a>, it invokes the <code>leave</code> action which switches it to the <code>leaving</code> state. Once the leader sees the convergence on the node in the <code>leaving</code> state, the leader will then move it to <code>exiting</code>. Once all nodes have seen the exiting state (convergence) the <code>leader</code> will remove the node from the cluster, marking it as <code>removed</code>.</p>
<p>If a node is <code>unreachable</code> then gossip convergence is not possible and therefore most <code>leader</code> actions are impossible (for instance, allowing a node to become a part of the cluster). To be able to move forward, the node must become <code>reachable</code> again or the node must be explicitly &ldquo;downed&rdquo;. This is required because the state of an unreachable node is unknown and the cluster cannot know if the node has crashed or is only temporarily unreachable because of network issues or GC pauses. See the section about <a href="#user-actions">User Actions</a> below for ways a node can be downed.</p>
<p>The actor system on a node that exited or was downed cannot join the cluster again. In particular, a node that was downed while being unreachable and then regains connectivity cannot rejoin the cluster. Instead, the process has to be restarted on the node, creating a new actor system that can go through the joining process again.</p>
<p>A special case is a node that was restarted without going through the leaving or downing process e.g. because the machine hosting the node was unexpectedly restarted. When the new instance of the node tries to rejoin the cluster, the cluster might still track the old instance as unreachable. In this case, however, it is clear that the old node is gone because the new instance will have the same address (host and port) as its old instance. In this case, the previous instance will be automatically marked as <code>down</code> and the new instance can rejoin the cluster without manual intervention.</p>
<h2><a href="#leader" name="leader" class="anchor"><span class="anchor-link"></span></a>Leader</h2>
<p>The purpose of the <code>leader</code> is to confirm state changes when convergence is reached. The <code>leader</code> can be determined by each node unambiguously after gossip convergence. Any node might be required to take the role of the <code>leader</code> depending on the current cluster composition.</p>
<p>Without convergence, different nodes might have different views about which node is the leader. Therefore, most leader actions are only allowed if there is convergence to ensure that all nodes agree about the current state of the cluster and state changes are originated from a single node. Most regular state changes like changing a node from <code>joining</code> to <code>up</code> are of that kind.</p>
<p>Other situations require that an action is taken even if convergence cannot be reached currently. Notably, convergence cannot be reached if one or more nodes in the cluster are currently unreachable as determined by the <a href="cluster-concepts.html#failure-detector">failure detector</a>. In such a case, the cluster might be partitioned (a split brain scenario) and each partition might have its own view about which nodes are reachable and which are not. In this case, a node on each side of the partition might view itself as the leader of the reachable nodes. Any action that the leader performs in such a case must be designed in a way that all concurrent leaders would come to the same conclusion (which might be impossible in general and only feasible under additional constraints). The most important case of that kind is a split brain scenario where nodes need to be downed, either manually or automatically, to bring the cluster back to convergence.</p>
<p>The <a href="../split-brain-resolver.html">Split Brain Resolver</a> is the built-in implementation of that.</p>
<p>Another transition that is possible without convergence is marking members as <code>WeaklyUp</code> as described in the next section.</p>
<a id="weakly-up"></a>
<h2><a href="#weaklyup-members" name="weaklyup-members" class="anchor"><span class="anchor-link"></span></a>WeaklyUp Members</h2>
<p>If a node is <code>unreachable</code> then gossip convergence is not possible and therefore most <code>leader</code> actions are impossible. By enabling <code>akka.cluster.allow-weakly-up-members</code> (which is enabled by default), joining nodes can be promoted to <code>WeaklyUp</code> even while convergence is not yet reached. Once gossip convergence can be established again, the leader will move <code>WeaklyUp</code> members to <code>Up</code>.</p>
<p>You can subscribe to the <code>WeaklyUp</code> membership event to make use of the members that are in this state, but you should be aware of that members on the other side of a network partition have no knowledge about the existence of the new members. You should for example not count <code>WeaklyUp</code> members in quorum decisions.</p>
<h2><a href="#full-cluster-shutdown" name="full-cluster-shutdown" class="anchor"><span class="anchor-link"></span></a>Full cluster shutdown</h2>
<p>In some rare cases it may be desirable to do a full cluster shutdown rather than a rolling deploy. For example, a protocol change where it is simpler to restart the cluster than to make the protocol change backward compatible.</p>
<p>As of Akka <code>2.6.13</code> it can be signalled that a full cluster shutdown is about to happen and any expensive actions such as:</p>
<ul>
  <li>Cluster sharding rebalances</li>
  <li>Moving of Cluster singletons</li>
</ul>
<p>Won&rsquo;t happen. That way the shutdown will be as quick as possible and a new version can be started up without delay.</p>
<p>If a cluster isn&rsquo;t to be restarted right away then there is no need to prepare it for shutdown.</p>
<p>To use this feature use <code>Cluster(system).prepareForFullClusterShutdown()</code> in classic or <span class="group-scala"><a href="https://doc.akka.io/api/akka/2.8/akka/cluster/typed/PrepareForFullClusterShutdown.html" title="akka.cluster.typed.PrepareForFullClusterShutdown"><code>PrepareForFullClusterShutdown</code></a></span><span class="group-java"><a href="https://doc.akka.io/japi/akka/2.8/akka/cluster/typed/PrepareForFullClusterShutdown.html" title="akka.cluster.typed.PrepareForFullClusterShutdown"><code>PrepareForFullClusterShutdown</code></a></span> in typed.</p>
<p>Wait for all <code>Up</code> members to become <code>ReadyForShutdown</code> and then all nodes can be shutdown and restarted. Members that aren&rsquo;t <code>Up</code> yet will remain in the <code>Joining</code> or <code>WeaklyUp</code> states. Any node that is already leaving the cluster i.e. in the <code>Leaving</code> or <code>Exiting</code> states will continue to leave the cluster via the normal path.</p>
<h2><a href="#state-diagrams" name="state-diagrams" class="anchor"><span class="anchor-link"></span></a>State Diagrams</h2>
<h3><a href="#state-diagram-for-the-member-states" name="state-diagram-for-the-member-states" class="anchor"><span class="anchor-link"></span></a>State Diagram for the Member States</h3>
<p><img src="../images/member-state-diagram.png" alt="member-states.png" /></p>
<h4><a href="#user-actions" name="user-actions" class="anchor"><span class="anchor-link"></span></a>User Actions</h4>
<ul>
  <li>
  <p><strong>join</strong> - join a single node to a cluster - can be explicit or automatic on startup if a node to join have been specified in the configuration</p></li>
  <li>
  <p><strong>leave</strong> - tell a node to leave the cluster gracefully, normally triggered by ActorSystem or JVM shutdown through <a href="../coordinated-shutdown.html">coordinated shutdown</a></p></li>
  <li>
  <p><strong>down</strong> - mark a node as down. This action is required to remove crashed nodes (that did not &lsquo;leave&rsquo;) from the cluster. It can be triggered manually, through <a href="https://doc.akka.io/docs/akka-management/current/cluster-http-management.html#put-cluster-members-address-responses">Cluster HTTP Management</a>, or automatically by a <a href="cluster.html#downing">downing provider</a> like <a href="../split-brain-resolver.html">Split Brain Resolver</a></p></li>
</ul>
<h4><a href="#leader-actions" name="leader-actions" class="anchor"><span class="anchor-link"></span></a>Leader Actions</h4>
<p>The <code>leader</code> has the duty of confirming user actions to shift members in and out of the cluster:</p>
<ul>
  <li>joining ⭢ up</li>
  <li>joining ⭢ weakly up <em>(no convergence is needed for this leader action to be performed which works even if there are unreachable nodes)</em></li>
  <li>weakly up ⭢ up <em>(after full convergence is reached again)</em></li>
  <li>leaving ⭢ exiting</li>
  <li>exiting ⭢ removed</li>
  <li>down ⭢ removed</li>
</ul>
<h4><a href="#failure-detection-and-unreachability" name="failure-detection-and-unreachability" class="anchor"><span class="anchor-link"></span></a>Failure Detection and Unreachability</h4>
<p>Being unreachable is not a separate member state but rather a flag in addition to the state. A failure detector on each node that monitors another node can mark the monitored node as unreachable independent of its state. Afterwards the failure detector continues monitoring the node until it detects it as reachable again and removes the flag. A node is considered reachable again only after all monitoring nodes see it as reachable again.</p>
</div>
</article>
<div class="row">
<div class="small-12 column">
<section class="nav-prev-next row">
<div class="nav-prev small-6 column">
<a href="../typed/cluster-concepts.html"><i class="icon-prev"></i> <span class="link-prev">Cluster Specification</span></a>
</div>
<div class="nav-next small-6 column clearfix">
<a class="float-right" href="../typed/failure-detector.html">Phi Accrual Failure Detector <i class="icon-next"></i></a>
</div>
</section>
</div>
</div>
<div class="source-github row">
Found an error in this documentation? The source code for this page can be found <a href="https://github.com/akka/akka/tree/v2.8.1/akka-docs/src/main/paradox/typed/cluster-membership.md">here</a>.
Please feel free to edit and contribute a pull request.
</div>

<footer class="page-footer row clearfix">
<img class="akka-icon float-left show-for-medium" src="../images/akka-icon.svg" />
<section class="copyright">
<div>Akka is available under the <a href="https://www.lightbend.com/akka/license" target="_blank">Business Source License 1.1</a>.</div>
<p class="legal">
&copy; 2011-2023 <a href="https://www.lightbend.com" target="_blank">Lightbend, Inc.</a> |
<a href="https://www.lightbend.com/legal/licenses" target="_blank">Licenses</a> |
<a href="https://www.lightbend.com/legal/terms" target="_blank">Terms</a> |
<a href="https://www.lightbend.com/legal/privacy" target="_blank">Privacy Policy</a> |
<a href="https://akka.io/cookie/" target="_blank">Cookie Listing</a> |
<a class="optanon-toggle-display">Cookie Settings</a>
</p>
</section>

</footer>
</section>
</main>
</div>

<script type="text/javascript" src="../js/scrollsneak.js"></script>
<script type="text/javascript">jQuery(document).foundation();</script>
<script type="text/javascript" src="../js/groups.js"></script>
<script type="text/javascript" src="../js/page.js"></script>
<script type="text/javascript" src="../js/snippets.js"></script>
<script type="text/javascript" src="../js/magellan.js"></script>
<script type="text/javascript" src="../js/metadata-toggle.js"></script>
<script type="text/javascript" src="../js/lbHeader.js"></script>

<style type="text/css">@import "../lib/prettify/prettify.css";</style>
<script type="text/javascript" src="../lib/prettify/prettify.js"></script>
<script type="text/javascript" src="../lib/prettify/lang-scala.js"></script>
<script type="text/javascript">//<![CDATA[
jQuery(function(){window.prettyPrint && prettyPrint()});
//]]></script>
<!-- Algolia docs search -->
<script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.js"></script>
<style>.algolia-autocomplete { display: block !important }</style>
<script type="text/javascript">
docsearch({
appId: 'XUXZ6LW9B1',
apiKey: '5b6260148e92f7c5e38338fcf7eaa3e0',
indexName: 'akka_docs',
inputSelector: '#search',
algoliaOptions: {
hitsPerPage: 5
}
});

docsearch({
appId: 'XUXZ6LW9B1',
apiKey: '5b6260148e92f7c5e38338fcf7eaa3e0',
indexName: 'akka_docs',
inputSelector: '#overlay-search',
algoliaOptions: {
hitsPerPage: 5
}
});

// set up "/" as global shortcut for focusing on search
jQuery(document).keypress(function (event) {
if (event.keyCode == 47) {
jQuery("#search").focus();
return false; // swallow key event, otherwise the / char would be input into the search box
}
});
</script>

<script type="text/javascript" src="../assets/js/warnOldDocs.js"></script>
<script type="text/javascript" src="../assets/js/scalafiddle.js"></script>


</body>
</html>
