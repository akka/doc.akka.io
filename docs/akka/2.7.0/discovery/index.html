<!DOCTYPE html>
<html class="no-js" lang="en">

<head>
<title>Discovery &bull; Akka Documentation</title>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<meta name="description" content="Service discovery with Akka using DNS, Kubernetes, AWS, Consul or Marathon."/>
<link rel="canonical" href="https://doc.akka.io/docs/akka/current/discovery/index.html"/>
<script type="text/javascript" src="../lib/jquery/jquery.min.js"></script>
<script type="text/javascript" src="../lib/foundation/dist/js/foundation.min.js"></script>
<link rel="stylesheet" type="text/css" href="../lib/normalize.css/normalize.css"/>
<link rel="stylesheet" type="text/css" href="../lib/foundation/dist/css/foundation.min.css"/>
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.css" />
<link rel="stylesheet" type="text/css" href="../css/icons.css"/>
<link rel="stylesheet" type="text/css" href="../css/page-8.css"/>
<link rel="stylesheet" type="text/css" href="../css/banner-2.css"/>
<link rel="shortcut icon" href="../images/favicon.ico" />
<link rel="apple-touch-icon" sizes="180x180" href="../images/apple-touch-icon.png"/>
<link rel="icon" type="image/png" sizes="32x32" href="../images/favicon-32x32.png"/>
<link rel="icon" type="image/png" sizes="16x16" href="../images/favicon-16x16.png"/>
<link rel="manifest" href="../images/manifest.json"/>
<meta name="msapplication-TileImage" content="../images/mstile-150x150.png"/>
<meta name="msapplication-TileColor" content="#15a9ce"/>
<meta name="theme-color" content="#15a9ce"/>
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>
<!-- OneTrust Cookies Consent Notice (Production Standard, akka.io, en-GB) start -->
<script src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js"  type="text/javascript" charset="UTF-8" data-domain-script="28b912e7-09e9-43d5-91e4-3d1897044004" ></script>
<script type="text/javascript">
function OptanonWrapper() { }
</script>
<!-- OneTrust Cookies Consent Notice (Production Standard, akka.io, en-GB) end -->
<!--Google Analytics-->
<script type="text/plain" class="optanon-category-2">
var _gaq = _gaq || [];
_gaq.push(['_setAccount', 'UA-21117439-1']);
_gaq.push(['_setDomainName', 'akka.io']);
_gaq.push(['_trackPageview']);
(function() {
var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})()
</script>
<!-- Google Tag Manager -->
<script type="text/plain" class="optanon-category-2">
(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-KBJGH35');
</script>
<!--Marketo-->
<script type="text/plain" class="optanon-category-3">
(function() {
var didInit = false;
function initMunchkin() {
if(didInit === false) {
didInit = true;
Munchkin.init('558-NCX-702', { 'asyncOnly': true, 'disableClickDelay': true });
}
}
var s = document.createElement('script');
s.type = 'text/javascript';
s.async = true;
s.src = '//munchkin.marketo.net/munchkin.js';
s.onreadystatechange = function() {
if (this.readyState == 'complete' || this.readyState == 'loaded') {
initMunchkin();
}
};
s.onload = initMunchkin;
document.getElementsByTagName('head')[0].appendChild(s);
})();
</script>
</head>

<body id="underlay" data-toggler="nav-open">
<div id="lightbend-banner" class="lightbend-banner akka full-width" data-category="OSS Lightbend Banner Impression" data-label="Akka Banner Impression">
<div class="oss-wrapper">
<div class="oss-brand">
<a class="oss-track-link-label" data-category="OSS Lightbend Banner Clicks" data-label="Lightbend Logo - Akka Banner" href="https://www.lightbend.com">
<img class="lightbend-logo" src="../images/banner-logos/lightbend-reverse.svg" alt="Lightbend" title="Lightbend">
</a>
</div>
<div class="oss-ad no-drop-down">
<nav id="lightbendRotator" class="lightbend-rotator">
<a class="oss-track-link-label" data-category="OSS Lightbend Banner Clicks" data-label="Promo Rotator - Lightbend is Changing its Software Licensing Model for Akka Technology. [License FAQ] - Akka Banner" href="https://www.lightbend.com/akka/license-faq">
<strong>Lightbend</strong> is Changing its Software Licensing Model for Akka Technology. <span class="akka-btn">License FAQ</span>
</a>
</nav>
</div>
</div>
</div>

<header class="site-header hide-for-large">
<div class="sticky-header clearfix">
<a href="https://akka.io"><img class="logo" src="../images/akka-logo-reverse.svg"/></a>

<button class="menu-icon float-right" type="button" data-toggle="underlay overlay"></button>
</div>
<div id="overlay" class="overlay-nav" data-toggler="nav-open">
<header class="nav-header">
<div class="nav-header-title">
<h1><a href="../index.html">Akka Documentation</a></h1>
</div>
<div class="nav-header-version">
Version 2.7.0
</div>
<div class="nav-header-groups">
<select class="supergroup" name="Language"><option class="group" value="group-scala">Scala</option><option class="group" value="group-java">Java</option></select>
</div>
<div id="overlay-search-container" class="nav-header-search">
<input id="overlay-search" type="search" class="search" placeholder="Search" />
</div>
</header>
<nav class="nav-toc">
<ul>
  <li><a href="../security/index.html" class="page">Security Announcements</a></li>
  <li><a href="../typed/guide/index.html" class="page">Getting Started Guide</a></li>
  <li><a href="../general/index.html" class="page">General Concepts</a></li>
  <li><a href="../typed/index.html" class="page">Actors</a></li>
  <li><a href="../typed/index-cluster.html" class="page">Cluster</a></li>
  <li><a href="../typed/index-persistence.html" class="page">Persistence (Event Sourcing)</a></li>
  <li><a href="../typed/index-persistence-durable-state.html" class="page">Persistence (Durable State)</a></li>
  <li><a href="../stream/index.html" class="page">Streams</a></li>
  <li><a href="../discovery/index.html#discovery" class="active page">Discovery</a>
  <ul>
    <li><a href="../discovery/index.html#module-info" class="header">Module info</a></li>
    <li><a href="../discovery/index.html#how-it-works" class="header">How it works</a></li>
    <li><a href="../discovery/index.html#discovery-method-dns" class="header">Discovery Method: DNS</a></li>
    <li><a href="../discovery/index.html#discovery-method-configuration" class="header">Discovery Method: Configuration</a></li>
    <li><a href="../discovery/index.html#discovery-method-aggregate-multiple-discovery-methods" class="header">Discovery Method: Aggregate multiple discovery methods</a></li>
    <li><a href="../discovery/index.html#migrating-from-akka-management-discovery-before-1-0-0-" class="header">Migrating from Akka Management Discovery (before 1.0.0)</a></li>
  </ul></li>
  <li><a href="../index-utilities.html" class="page">Utilities</a></li>
  <li><a href="../common/other-modules.html" class="page">Other Akka modules</a></li>
  <li><a href="../additional/deploy.html" class="page">Package, Deploy and Run</a></li>
  <li><a href="../project/index.html" class="page">Project Information</a></li>
  <li><a href="../index-classic.html" class="page">Akka Classic</a></li>
</ul>
</nav>
</div>
</header>
<div class="site-content-wrapper">
<aside class="sticky-sidebar show-for-large">
<header class="nav-header sticky-sidebar-header">
<div class="nav-header-title">
<h1><a href="../index.html">Akka Documentation</a></h1>
</div>
<div class="nav-header-version">
Version 2.7.0
</div>
<div class="nav-header-groups">
<select class="supergroup" name="Language"><option class="group" value="group-scala">Scala</option><option class="group" value="group-java">Java</option></select>
</div>
<div class="nav-header-search">
<input id="search" type="search" class="search" placeholder="Search" />
</div>
</header>
<nav class="site-nav sticky-sidebar-contents">
<div class="nav-toc">
<ul>
  <li><a href="../security/index.html" class="page">Security Announcements</a></li>
  <li><a href="../typed/guide/index.html" class="page">Getting Started Guide</a></li>
  <li><a href="../general/index.html" class="page">General Concepts</a></li>
  <li><a href="../typed/index.html" class="page">Actors</a></li>
  <li><a href="../typed/index-cluster.html" class="page">Cluster</a></li>
  <li><a href="../typed/index-persistence.html" class="page">Persistence (Event Sourcing)</a></li>
  <li><a href="../typed/index-persistence-durable-state.html" class="page">Persistence (Durable State)</a></li>
  <li><a href="../stream/index.html" class="page">Streams</a></li>
  <li><a href="../discovery/index.html#discovery" class="active page">Discovery</a>
  <ul>
    <li><a href="../discovery/index.html#module-info" class="header">Module info</a></li>
    <li><a href="../discovery/index.html#how-it-works" class="header">How it works</a></li>
    <li><a href="../discovery/index.html#discovery-method-dns" class="header">Discovery Method: DNS</a></li>
    <li><a href="../discovery/index.html#discovery-method-configuration" class="header">Discovery Method: Configuration</a></li>
    <li><a href="../discovery/index.html#discovery-method-aggregate-multiple-discovery-methods" class="header">Discovery Method: Aggregate multiple discovery methods</a></li>
    <li><a href="../discovery/index.html#migrating-from-akka-management-discovery-before-1-0-0-" class="header">Migrating from Akka Management Discovery (before 1.0.0)</a></li>
  </ul></li>
  <li><a href="../index-utilities.html" class="page">Utilities</a></li>
  <li><a href="../common/other-modules.html" class="page">Other Akka modules</a></li>
  <li><a href="../additional/deploy.html" class="page">Package, Deploy and Run</a></li>
  <li><a href="../project/index.html" class="page">Project Information</a></li>
  <li><a href="../index-classic.html" class="page">Akka Classic</a></li>
</ul>
</div>
</nav>
<footer class="nav-footer sticky-sidebar-footer">
<a href="https://akka.io"><img class="logo" src="../images/akka-logo-reverse.svg"/></a>

</footer>
</aside>
<main class="fixed-shift-for-large expanded row">
<section class="site-content small-12 column">
<article class="page-content row">
<div class="small-12 column" id="docs">
<h1><a href="#discovery" name="discovery" class="anchor"><span class="anchor-link"></span></a>Discovery</h1>
<p>The Akka Discovery API enables <strong>service discovery</strong> to be provided by different technologies. It allows to delegate endpoint lookup so that services can be configured depending on the environment by other means than configuration files. </p>
<p>Implementations provided by the Akka Discovery module are </p>
<ul>
  <li><a href="index.html#discovery-method-configuration">Configuration</a> (HOCON)</li>
  <li><a href="index.html#discovery-method-dns">DNS</a> (SRV records)</li>
  <li><a href="index.html#discovery-method-aggregate-multiple-discovery-methods">Aggregate</a> multiple discovery methods</li>
</ul>
<p>In addition the <a href="https://doc.akka.io/docs/akka-management/current/">Akka Management</a> toolbox contains Akka Discovery implementations for</p>
<ul>
  <li><a href="https://doc.akka.io/docs/akka-management/current/discovery/kubernetes.html">Kubernetes API</a></li>
  <li><a href="https://doc.akka.io/docs/akka-management/current/discovery/aws.html#discovery-method-aws-api-ec2-tag-based-discovery">AWS API: EC2 Tag-Based Discovery</a></li>
  <li><a href="https://doc.akka.io/docs/akka-management/current/discovery/aws.html#discovery-method-aws-api-ecs-discovery">AWS API: ECS Discovery</a></li>
  <li><a href="https://doc.akka.io/docs/akka-management/current/discovery/consul.html">Consul</a></li>
  <li><a href="https://doc.akka.io/docs/akka-management/current/discovery/marathon.html">Marathon API</a></li>
</ul><div class="callout note "><div class="callout-title">Note</div>
<p>Discovery used to be part of Akka Management but has become an Akka module as of <code>2.5.19</code> of Akka and version <code>1.0.0</code> of Akka Management. If you&rsquo;re also using Akka Management for other service discovery methods or bootstrap make sure you are using at least version <code>1.0.0</code> of Akka Management.</p>
<p>See <a href="index.html#migrating-from-akka-management-discovery-before-1-0-0-">Migration hints</a></p></div>
<h2><a href="#module-info" name="module-info" class="anchor"><span class="anchor-link"></span></a>Module info</h2><dl class="dependency"><dt>sbt</dt><dd><pre class="prettyprint"><code class="language-scala">val AkkaVersion = "2.7.0"
libraryDependencies += "com.typesafe.akka" %% "akka-discovery" % AkkaVersion</code></pre></dd><dt>Gradle</dt><dd><pre class="prettyprint"><code class="language-gradle">def versions = [
  ScalaBinary: "2.13"
]
dependencies {
  implementation platform("com.typesafe.akka:akka-bom_${versions.ScalaBinary}:2.7.0")

  implementation "com.typesafe.akka:akka-discovery_${versions.ScalaBinary}"
}</code></pre></dd><dt>Maven</dt><dd><pre class="prettyprint"><code class="language-xml">&lt;properties&gt;
  &lt;scala.binary.version&gt;2.13&lt;/scala.binary.version&gt;
&lt;/properties&gt;
&lt;dependencyManagement&gt;
  &lt;dependencies&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;com.typesafe.akka&lt;/groupId&gt;
      &lt;artifactId&gt;akka-bom_${scala.binary.version}&lt;/artifactId&gt;
      &lt;version&gt;2.7.0&lt;/version&gt;
      &lt;type&gt;pom&lt;/type&gt;
      &lt;scope&gt;import&lt;/scope&gt;
    &lt;/dependency&gt
  &lt;/dependencies&gt;
&lt;/dependencyManagement&gt;
&lt;dependencies&gt
  &lt;dependency&gt;
    &lt;groupId&gt;com.typesafe.akka&lt;/groupId&gt;
    &lt;artifactId&gt;akka-discovery_${scala.binary.version}&lt;/artifactId&gt;
  &lt;/dependency&gt
&lt;/dependencies&gt;</code></pre></dd></dl>
<table class="project-info">
<tr><th colspan="2">Project Info: Akka Discovery</th></tr>
  <tr><th>Artifact</th><td><div>com.typesafe.akka</div>
  <div>akka-discovery</div>
  <div>2.7.0</div>
  <div><a href="project/links.html#snapshots-repository">Snapshots are available</a></div>
  </td></tr>
  <tr><th>JDK versions</th><td><div>Adopt OpenJDK 8</div><div>Adopt OpenJDK 11</div></td></tr>
  <tr><th>Scala versions</th><td>2.13.10, 2.12.17, 3.1.3</td></tr>
  <tr><th>JPMS module name</th><td>akka.discovery</td></tr>
  <tr><th>License</th><td><div><a href="https://raw.githubusercontent.com/akka/akka/main/LICENSE" target="_blank" rel="noopener noreferrer">BUSL-1.1</a></div>
  </td></tr>
  <tr><th>Readiness level</th><td><div class="readiness-level"><a href="https://developer.lightbend.com/docs/introduction/getting-help/support-terminology.html#supported" target="_blank" rel="noopener">Supported</a>, <a href="https://www.lightbend.com/lightbend-subscription" target="_blank" rel="noopener">Lightbend Subscription</a> provides support</div>
  <div>Since 2.5.19, 2018-12-07</div>
  </td></tr>
  <tr><th>Home page</th><td><a href="https://akka.io/">https://akka.io/</a></td></tr>
  <tr><th>API documentation</th><td>
  <div><a href="https://doc.akka.io/api/akka/2.7.0/akka/discovery/index.html" target="_blank" rel="noopener noreferrer">API (Scaladoc)</a></div>
  <div><a href="https://doc.akka.io/japi/akka/2.7.0/akka/discovery/package-summary.html" target="_blank" rel="noopener noreferrer">API (Javadoc)</a></div>
  </td></tr>
  <tr><th>Forums</th><td>
  <div><a href="https://discuss.akka.io" target="_blank" rel="noopener noreferrer">Lightbend Discuss</a></div>
  <div><a href="https://gitter.im/akka/akka" target="_blank" rel="noopener noreferrer">akka/akka Gitter channel</a></div>
  </td></tr>
  <tr><th>Release notes</th><td><a href="https://akka.io/blog/news-archive.html">akka.io blog</a></td></tr>
  <tr><th>Issues</th><td><a href="https://github.com/akka/akka/issues" target="_blank" rel="noopener noreferrer">Github issues</a></td></tr>
  <tr><th>Sources</th><td><a href="https://github.com/akka/akka" target="_blank" rel="noopener noreferrer">https://github.com/akka/akka</a></td></tr>
</table>

<h2><a href="#how-it-works" name="how-it-works" class="anchor"><span class="anchor-link"></span></a>How it works</h2>

<p>Loading the extension:</p>

<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/akka/tree/v2.7.0/akka-discovery/src/test/scala/doc/akka/discovery/CompileOnlySpec.scala#L16-L19" target="_blank" title="Go to snippet source">source</a><code class="language-scala">import akka.discovery.Discovery

val system = ActorSystem()
val serviceDiscovery = Discovery(system).discovery</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/akka/tree/v2.7.0/akka-discovery/src/test/java/jdoc/akka/discovery/CompileOnlyTest.java#L18-L19" target="_blank" title="Go to snippet source">source</a><code class="language-java">ActorSystem as = ActorSystem.create();
ServiceDiscovery serviceDiscovery = Discovery.get(as).discovery();</code></pre></dd>
</dl>
<p>A <code>Lookup</code> contains a mandatory <code>serviceName</code> and an optional <code>portName</code> and <code>protocol</code>. How these are interpreted is discovery method dependent e.g.DNS does an A/AAAA record query if any of the fields are missing and an SRV query for a full look up:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/akka/tree/v2.7.0/akka-discovery/src/test/scala/doc/akka/discovery/CompileOnlySpec.scala#L23-L27" target="_blank" title="Go to snippet source">source</a><code class="language-scala">import akka.discovery.Lookup

serviceDiscovery.lookup(Lookup(&quot;akka.io&quot;), 1.second)
// Convenience for a Lookup with only a serviceName
serviceDiscovery.lookup(&quot;akka.io&quot;, 1.second)</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/akka/tree/v2.7.0/akka-discovery/src/test/java/jdoc/akka/discovery/CompileOnlyTest.java#L23-L25" target="_blank" title="Go to snippet source">source</a><code class="language-java">serviceDiscovery.lookup(Lookup.create(&quot;akka.io&quot;), Duration.ofSeconds(1));
// convenience for a Lookup with only a serviceName
serviceDiscovery.lookup(&quot;akka.io&quot;, Duration.ofSeconds(1));</code></pre></dd>
</dl>
<p><code>portName</code> and <code>protocol</code> are optional and their meaning is interpreted by the method.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/akka/tree/v2.7.0/akka-discovery/src/test/scala/doc/akka/discovery/CompileOnlySpec.scala#L31-L35" target="_blank" title="Go to snippet source">source</a><code class="language-scala">import akka.discovery.Lookup
import akka.discovery.ServiceDiscovery.Resolved

val lookup: Future[Resolved] =
  serviceDiscovery.lookup(Lookup(&quot;akka.io&quot;).withPortName(&quot;remoting&quot;).withProtocol(&quot;tcp&quot;), 1.second)</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/akka/tree/v2.7.0/akka-discovery/src/test/java/jdoc/akka/discovery/CompileOnlyTest.java#L29-L32" target="_blank" title="Go to snippet source">source</a><code class="language-java">CompletionStage&lt;ServiceDiscovery.Resolved&gt; lookup =
    serviceDiscovery.lookup(
        Lookup.create(&quot;akka.io&quot;).withPortName(&quot;remoting&quot;).withProtocol(&quot;tcp&quot;),
        Duration.ofSeconds(1));</code></pre></dd>
</dl>
<p>Port can be used when a service opens multiple ports e.g. a HTTP port and an Akka remoting port.</p>
<h2><a href="#discovery-method-dns" name="discovery-method-dns" class="anchor"><span class="anchor-link"></span></a>Discovery Method: DNS</h2><div class="callout note "><div class="callout-title">Async DNS</div>
<p>Akka Discovery with DNS does always use the <a href="../io-dns.html">Akka-native &ldquo;async-dns&rdquo; implementation</a> (it is independent of the <code>akka.io.dns.resolver</code> setting).</p></div>
<p>DNS discovery maps <code>Lookup</code> queries as follows:</p>
<ul>
  <li><code>serviceName</code>, <code>portName</code> and <code>protocol</code> set: SRV query in the form: <code>_port._protocol.name</code> Where the <code>_</code>s are added.</li>
  <li>Any query missing any of the fields is mapped to a A/AAAA query for the <code>serviceName</code></li>
</ul>
<p>The mapping between Akka service discovery terminology and SRV terminology:</p>
<ul>
  <li>SRV service = port</li>
  <li>SRV name = serviceName</li>
  <li>SRV protocol = protocol</li>
</ul>
<p>Configure <code>akka-dns</code> to be used as the discovery implementation in your <code>application.conf</code>:</p>
<pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/akka/tree/v2.7.0/akka-docs/src/test/scala/docs/discovery/DnsDiscoveryDocSpec.scala#L16-L20" target="_blank" title="Go to snippet source">source</a><code class="language-scala">akka {
  discovery {
    method = akka-dns
  }
}</code></pre>
<p>From there on, you can use the generic API that hides the fact which discovery method is being used by calling:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/akka/tree/v2.7.0/akka-docs/src/test/scala/docs/discovery/DnsDiscoveryDocSpec.scala#L30-L35" target="_blank" title="Go to snippet source">source</a><code class="language-scala">import akka.discovery.Discovery
import akka.discovery.ServiceDiscovery

val discovery: ServiceDiscovery = Discovery(system).discovery
// ...
val result: Future[ServiceDiscovery.Resolved] = discovery.lookup(&quot;akka.io&quot;, resolveTimeout = 3.seconds)</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/akka/tree/v2.7.0/akka-docs/src/test/java/jdocs/discovery/DnsDiscoveryDocTest.java#L9-L47" target="_blank" title="Go to snippet source">source</a><code class="language-java">import akka.discovery.Discovery;
import akka.discovery.ServiceDiscovery;

ServiceDiscovery discovery = Discovery.get(system).discovery();
// ...
CompletionStage&lt;ServiceDiscovery.Resolved&gt; result =
    discovery.lookup(&quot;foo&quot;, Duration.ofSeconds(3));</code></pre></dd>
</dl>
<h3><a href="#dns-records-used" name="dns-records-used" class="anchor"><span class="anchor-link"></span></a>DNS records used</h3>
<p>DNS discovery will use either A/AAAA records or SRV records depending on whether a <code>Simple</code> or <code>Full</code> lookup is issued. The advantage of SRV records is that they can include a port.</p>
<h4><a href="#srv-records" name="srv-records" class="anchor"><span class="anchor-link"></span></a>SRV records</h4>
<p>Lookups with all the fields set become SRV queries. For example:</p>
<pre><code>dig srv _service._tcp.akka.test

; &lt;&lt;&gt;&gt; DiG 9.11.3-RedHat-9.11.3-6.fc28 &lt;&lt;&gt;&gt; srv service.tcp.akka.test
;; global options: +cmd
;; Got answer:
;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 60023
;; flags: qr aa rd ra; QUERY: 1, ANSWER: 2, AUTHORITY: 1, ADDITIONAL: 5

;; OPT PSEUDOSECTION:
; EDNS: version: 0, flags:; udp: 4096
; COOKIE: 5ab8dd4622e632f6190f54de5b28bb8fb1b930a5333c3862 (good)
;; QUESTION SECTION:
;service.tcp.akka.test.         IN      SRV

;; ANSWER SECTION:
_service._tcp.akka.test.  86400   IN      SRV     10 60 5060 a-single.akka.test.
_service._tcp.akka.test.  86400   IN      SRV     10 40 5070 a-double.akka.test.

</code></pre>
<p>In this case <code>service.tcp.akka.test</code> resolves to <code>a-single.akka.test</code> on port <code>5060</code> and <code>a-double.akka.test</code> on port <code>5070</code>. Currently discovery does not support the weightings.</p>
<h4><a href="#a-aaaa-records" name="a-aaaa-records" class="anchor"><span class="anchor-link"></span></a>A/AAAA records</h4>
<p>Lookups with any fields missing become A/AAAA record queries. For example:</p>
<pre><code>dig a-double.akka.test

; &lt;&lt;&gt;&gt; DiG 9.11.3-RedHat-9.11.3-6.fc28 &lt;&lt;&gt;&gt; a-double.akka.test
;; global options: +cmd
;; Got answer:
;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 11983
;; flags: qr aa rd ra; QUERY: 1, ANSWER: 2, AUTHORITY: 1, ADDITIONAL: 2

;; OPT PSEUDOSECTION:
; EDNS: version: 0, flags:; udp: 4096
; COOKIE: 16e9815d9ca2514d2f3879265b28bad05ff7b4a82721edd0 (good)
;; QUESTION SECTION:
;a-double.akka.test.            IN      A

;; ANSWER SECTION:
a-double.akka.test.     86400   IN      A       192.168.1.21
a-double.akka.test.     86400   IN      A       192.168.1.22

</code></pre>
<p>In this case <code>a-double.akka.test</code> would resolve to <code>192.168.1.21</code> and <code>192.168.1.22</code>.</p>
<h2><a href="#discovery-method-configuration" name="discovery-method-configuration" class="anchor"><span class="anchor-link"></span></a>Discovery Method: Configuration</h2>
<p>Configuration currently ignores all fields apart from service name.</p>
<p>For simple use cases configuration can be used for service discovery. The advantage of using Akka Discovery with configuration rather than your own configuration values is that applications can be migrated to a more sophisticated discovery method without any code changes.</p>
<p>Configure it to be used as discovery method in your <code>application.conf</code></p>
<pre><code>akka {
  discovery.method = config
}
</code></pre>
<p>By default the services discoverable are defined in <code>akka.discovery.config.services</code> and have the following format:</p>
<pre><code>akka.discovery.config.services = {
  service1 = {
    endpoints = [
      {
        host = &quot;cat&quot;
        port = 1233
      },
      {
        host = &quot;dog&quot;
        port = 1234
      }
    ]
  },
  service2 = {
    endpoints = []
  }
}
</code></pre>
<p>Where the above block defines two services, <code>service1</code> and <code>service2</code>. Each service can have multiple endpoints.</p>
<h2><a href="#discovery-method-aggregate-multiple-discovery-methods" name="discovery-method-aggregate-multiple-discovery-methods" class="anchor"><span class="anchor-link"></span></a>Discovery Method: Aggregate multiple discovery methods</h2>
<p>Aggregate discovery allows multiple discovery methods to be aggregated e.g. try and resolve via DNS and fall back to configuration.</p>
<p>To use aggregate discovery add its dependency as well as all of the discovery that you want to aggregate.</p>
<p>Configure <code>aggregate</code> as <code>akka.discovery.method</code> and which discovery methods are tried and in which order.</p>
<pre><code>akka {
  discovery {
    method = aggregate
    aggregate {
      discovery-methods = [&quot;akka-dns&quot;, &quot;config&quot;]
    }
    config {
      services {
        service1 {
          endpoints = [
            {
              host = &quot;host1&quot;
              port = 1233
            },
            {
              host = &quot;host2&quot;
              port = 1234
            }
          ]
        }
      }
    }
  }
}

</code></pre>
<p>The above configuration will result in <code>akka-dns</code> first being checked and if it fails or returns no targets for the given service name then <code>config</code> is queried which i configured with one service called <code>service1</code> which two hosts <code>host1</code> and <code>host2</code>.</p>
<h2><a href="#migrating-from-akka-management-discovery-before-1-0-0-" name="migrating-from-akka-management-discovery-before-1-0-0-" class="anchor"><span class="anchor-link"></span></a>Migrating from Akka Management Discovery (before 1.0.0)</h2>
<p>Akka Discovery started out as a submodule of Akka Management, before 1.0.0 of Akka Management. Akka Discovery is not compatible with those versions of Akka Management Discovery.</p>
<p>At least version <code>1.0.0</code> of any Akka Management module should be used if also using Akka Discovery.</p>
<p>Migration steps:</p>
<ul>
  <li>Any custom discovery method should now implement <code>akka.discovery.ServiceDiscovery</code></li>
  <li><code>discovery-method</code> now has to be a configuration location under <code>akka.discovery</code> with at minimum a property <code>class</code> specifying the fully qualified name of the implementation of <code>akka.discovery.ServiceDiscovery</code>.  Previous versions allowed this to be a class name or a fully qualified config location e.g. <code>akka.discovery.kubernetes-api</code> rather than just <code>kubernetes-api</code></li>
</ul>
</div>
</article>
<div class="row">
<div class="small-12 column">
<section class="nav-prev-next row">
<div class="nav-prev small-6 column">
<a href="../stream/operators/Source/zipWithN.html"><i class="icon-prev"></i> <span class="link-prev">Source.zipWithN</span></a>
</div>
<div class="nav-next small-6 column clearfix">
<a class="float-right" href="../index-utilities.html">Utilities <i class="icon-next"></i></a>
</div>
</section>
</div>
</div>
<div class="source-github row">
Found an error in this documentation? The source code for this page can be found <a href="https://github.com/akka/akka/tree/v2.7.0/akka-docs/src/main/paradox/discovery/index.md">here</a>.
Please feel free to edit and contribute a pull request.
</div>

<footer class="page-footer row clearfix">
<img class="akka-icon float-left show-for-medium" src="../images/akka-icon.svg" />
<section class="copyright">
<div>Akka is available under the <a href="https://www.lightbend.com/akka/license" target="_blank">Business Source License 1.1</a>.</div>
<p class="legal">
&copy; 2011-2022 <a href="https://www.lightbend.com" target="_blank">Lightbend, Inc.</a> |
<a href="https://www.lightbend.com/legal/licenses" target="_blank">Licenses</a> |
<a href="https://www.lightbend.com/legal/terms" target="_blank">Terms</a> |
<a href="https://www.lightbend.com/legal/privacy" target="_blank">Privacy Policy</a> |
<a href="https://akka.io/cookie/" target="_blank">Cookie Listing</a> |
<a class="optanon-toggle-display">Cookie Settings</a>
</p>
</section>

</footer>
</section>
</main>
</div>

<script type="text/javascript" src="../js/scrollsneak.js"></script>
<script type="text/javascript">jQuery(document).foundation();</script>
<script type="text/javascript" src="../js/groups.js"></script>
<script type="text/javascript" src="../js/page.js"></script>
<script type="text/javascript" src="../js/snippets.js"></script>
<script type="text/javascript" src="../js/magellan.js"></script>
<script type="text/javascript" src="../js/metadata-toggle.js"></script>
<script type="text/javascript" src="../js/lbHeader.js"></script>

<style type="text/css">@import "../lib/prettify/prettify.css";</style>
<script type="text/javascript" src="../lib/prettify/prettify.js"></script>
<script type="text/javascript" src="../lib/prettify/lang-scala.js"></script>
<script type="text/javascript">//<![CDATA[
jQuery(function(){window.prettyPrint && prettyPrint()});
//]]></script>
<!-- Algolia docs search -->
<script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.js"></script>
<style>.algolia-autocomplete { display: block !important }</style>
<script type="text/javascript">
docsearch({
apiKey: '543bad5ad786495d9ccd445ed34ed082',
indexName: 'akka_io',
inputSelector: '#search',
algoliaOptions: {
hitsPerPage: 5
}
});

docsearch({
apiKey: '543bad5ad786495d9ccd445ed34ed082',
indexName: 'akka_io',
inputSelector: '#overlay-search',
algoliaOptions: {
hitsPerPage: 5
}
});

// set up "/" as global shortcut for focusing on search
jQuery(document).keypress(function (event) {
if (event.keyCode == 47) {
jQuery("#search").focus();
return false; // swallow key event, otherwise the / char would be input into the search box
}
});
</script>

<script type="text/javascript" src="../assets/js/warnOldDocs.js"></script>
<script type="text/javascript" src="../assets/js/scalafiddle.js"></script>


</body>
</html>
