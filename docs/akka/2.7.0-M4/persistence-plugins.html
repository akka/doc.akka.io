<!DOCTYPE html>
<html class="no-js" lang="en">

<head>
<title>Persistence Plugins &bull; Akka Documentation</title>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<meta name="description" content="Akka is a toolkit for building highly concurrent, distributed, and resilient message-driven applications for Java and Scala."/>
<link rel="canonical" href="https://doc.akka.io/docs/akka/current/persistence-plugins.html"/>
<script type="text/javascript" src="lib/jquery/jquery.min.js"></script>
<script type="text/javascript" src="lib/foundation/dist/js/foundation.min.js"></script>
<link rel="stylesheet" type="text/css" href="lib/normalize.css/normalize.css"/>
<link rel="stylesheet" type="text/css" href="lib/foundation/dist/css/foundation.min.css"/>
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.css" />
<link rel="stylesheet" type="text/css" href="css/icons.css"/>
<link rel="stylesheet" type="text/css" href="css/page-8.css"/>
<link rel="stylesheet" type="text/css" href="css/banner-2.css"/>
<link rel="shortcut icon" href="images/favicon.ico" />
<link rel="apple-touch-icon" sizes="180x180" href="images/apple-touch-icon.png"/>
<link rel="icon" type="image/png" sizes="32x32" href="images/favicon-32x32.png"/>
<link rel="icon" type="image/png" sizes="16x16" href="images/favicon-16x16.png"/>
<link rel="manifest" href="images/manifest.json"/>
<meta name="msapplication-TileImage" content="images/mstile-150x150.png"/>
<meta name="msapplication-TileColor" content="#15a9ce"/>
<meta name="theme-color" content="#15a9ce"/>
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>
<!-- OneTrust Cookies Consent Notice (Production Standard, akka.io, en-GB) start -->
<script src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js"  type="text/javascript" charset="UTF-8" data-domain-script="28b912e7-09e9-43d5-91e4-3d1897044004" ></script>
<script type="text/javascript">
function OptanonWrapper() { }
</script>
<!-- OneTrust Cookies Consent Notice (Production Standard, akka.io, en-GB) end -->
<!--Google Analytics-->
<script type="text/plain" class="optanon-category-2">
var _gaq = _gaq || [];
_gaq.push(['_setAccount', 'UA-21117439-1']);
_gaq.push(['_setDomainName', 'akka.io']);
_gaq.push(['_trackPageview']);
(function() {
var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})()
</script>
<!-- Google Tag Manager -->
<script type="text/plain" class="optanon-category-2">
(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-KBJGH35');
</script>
<!--Marketo-->
<script type="text/plain" class="optanon-category-3">
(function() {
var didInit = false;
function initMunchkin() {
if(didInit === false) {
didInit = true;
Munchkin.init('558-NCX-702', { 'asyncOnly': true, 'disableClickDelay': true });
}
}
var s = document.createElement('script');
s.type = 'text/javascript';
s.async = true;
s.src = '//munchkin.marketo.net/munchkin.js';
s.onreadystatechange = function() {
if (this.readyState == 'complete' || this.readyState == 'loaded') {
initMunchkin();
}
};
s.onload = initMunchkin;
document.getElementsByTagName('head')[0].appendChild(s);
})();
</script>
</head>

<body id="underlay" data-toggler="nav-open">
<div id="lightbend-banner" class="lightbend-banner akka full-width" data-category="OSS Lightbend Banner Impression" data-label="Akka Banner Impression">
<div class="oss-wrapper">
<div class="oss-brand">
<a class="oss-track-link-label" data-category="OSS Lightbend Banner Clicks" data-label="Lightbend Logo - Akka Banner" href="https://www.lightbend.com">
<img class="lightbend-logo" src="images/banner-logos/lightbend-reverse.svg" alt="Lightbend" title="Lightbend">
</a>
</div>
<div class="oss-ad no-drop-down">
<nav id="lightbendRotator" class="lightbend-rotator">
<a class="oss-track-link-label" data-category="OSS Lightbend Banner Clicks" data-label="Promo Rotator - Lightbend is Changing its Software Licensing Model for Akka Technology. [License FAQ] - Akka Banner" href="https://www.lightbend.com/akka/license-faq">
<strong>Lightbend</strong> is Changing its Software Licensing Model for Akka Technology. <span class="akka-btn">License FAQ</span>
</a>
</nav>
</div>
</div>
</div>

<header class="site-header hide-for-large">
<div class="sticky-header clearfix">
<a href="https://akka.io"><img class="logo" src="images/akka-logo-reverse.svg"/></a>

<button class="menu-icon float-right" type="button" data-toggle="underlay overlay"></button>
</div>
<div id="overlay" class="overlay-nav" data-toggler="nav-open">
<header class="nav-header">
<div class="nav-header-title">
<h1><a href="index.html">Akka Documentation</a></h1>
</div>
<div class="nav-header-version">
Version 2.7.0-M4
</div>
<div class="nav-header-groups">
<select class="supergroup" name="Language"><option class="group" value="group-scala">Scala</option><option class="group" value="group-java">Java</option></select>
</div>
<div id="overlay-search-container" class="nav-header-search">
<input id="overlay-search" type="search" class="search" placeholder="Search" />
</div>
</header>
<nav class="nav-toc">
<ul>
  <li><a href="security/index.html" class="page">Security Announcements</a></li>
  <li><a href="typed/guide/index.html" class="page">Getting Started Guide</a></li>
  <li><a href="general/index.html" class="page">General Concepts</a></li>
  <li><a href="typed/index.html" class="page">Actors</a></li>
  <li><a href="typed/index-cluster.html" class="page">Cluster</a></li>
  <li><a href="typed/index-persistence.html" class="page">Persistence (Event Sourcing)</a>
  <ul>
    <li><a href="typed/persistence.html" class="page">Event Sourcing</a></li>
    <li><a href="typed/replicated-eventsourcing.html" class="page">Replicated Event Sourcing</a></li>
    <li><a href="typed/cqrs.html" class="page">CQRS</a></li>
    <li><a href="typed/persistence-style.html" class="page">Style Guide</a></li>
    <li><a href="typed/persistence-snapshot.html" class="page">Snapshotting</a></li>
    <li><a href="typed/persistence-testing.html" class="page">Testing</a></li>
    <li><a href="typed/persistence-fsm.html" class="page">EventSourced behaviors as finite state machines</a></li>
    <li><a href="persistence-schema-evolution.html" class="page">Schema Evolution for Event Sourced Actors</a></li>
    <li><a href="persistence-query.html" class="page">Persistence Query</a></li>
    <li><a href="persistence-query-leveldb.html" class="page">Persistence Query for LevelDB</a></li>
    <li><a href="persistence-plugins.html#persistence-plugins" class="active page">Persistence Plugins</a>
    <ul>
      <li><a href="persistence-plugins.html#eager-initialization-of-persistence-plugin" class="header">Eager initialization of persistence plugin</a></li>
      <li><a href="persistence-plugins.html#pre-packaged-plugins" class="header">Pre-packaged plugins</a></li>
    </ul></li>
    <li><a href="persistence-journals.html" class="page">Persistence - Building a storage backend</a></li>
    <li><a href="typed/replicated-eventsourcing-examples.html" class="page">Replicated Event Sourcing Examples</a></li>
  </ul></li>
  <li><a href="typed/index-persistence-durable-state.html" class="page">Persistence (Durable State)</a></li>
  <li><a href="stream/index.html" class="page">Streams</a></li>
  <li><a href="discovery/index.html" class="page">Discovery</a></li>
  <li><a href="index-utilities.html" class="page">Utilities</a></li>
  <li><a href="common/other-modules.html" class="page">Other Akka modules</a></li>
  <li><a href="additional/deploy.html" class="page">Package, Deploy and Run</a></li>
  <li><a href="project/index.html" class="page">Project Information</a></li>
  <li><a href="index-classic.html" class="page">Akka Classic</a></li>
</ul>
</nav>
</div>
</header>
<div class="site-content-wrapper">
<aside class="sticky-sidebar show-for-large">
<header class="nav-header sticky-sidebar-header">
<div class="nav-header-title">
<h1><a href="index.html">Akka Documentation</a></h1>
</div>
<div class="nav-header-version">
Version 2.7.0-M4
</div>
<div class="nav-header-groups">
<select class="supergroup" name="Language"><option class="group" value="group-scala">Scala</option><option class="group" value="group-java">Java</option></select>
</div>
<div class="nav-header-search">
<input id="search" type="search" class="search" placeholder="Search" />
</div>
</header>
<nav class="site-nav sticky-sidebar-contents">
<div class="nav-toc">
<ul>
  <li><a href="security/index.html" class="page">Security Announcements</a></li>
  <li><a href="typed/guide/index.html" class="page">Getting Started Guide</a></li>
  <li><a href="general/index.html" class="page">General Concepts</a></li>
  <li><a href="typed/index.html" class="page">Actors</a></li>
  <li><a href="typed/index-cluster.html" class="page">Cluster</a></li>
  <li><a href="typed/index-persistence.html" class="page">Persistence (Event Sourcing)</a>
  <ul>
    <li><a href="typed/persistence.html" class="page">Event Sourcing</a></li>
    <li><a href="typed/replicated-eventsourcing.html" class="page">Replicated Event Sourcing</a></li>
    <li><a href="typed/cqrs.html" class="page">CQRS</a></li>
    <li><a href="typed/persistence-style.html" class="page">Style Guide</a></li>
    <li><a href="typed/persistence-snapshot.html" class="page">Snapshotting</a></li>
    <li><a href="typed/persistence-testing.html" class="page">Testing</a></li>
    <li><a href="typed/persistence-fsm.html" class="page">EventSourced behaviors as finite state machines</a></li>
    <li><a href="persistence-schema-evolution.html" class="page">Schema Evolution for Event Sourced Actors</a></li>
    <li><a href="persistence-query.html" class="page">Persistence Query</a></li>
    <li><a href="persistence-query-leveldb.html" class="page">Persistence Query for LevelDB</a></li>
    <li><a href="persistence-plugins.html#persistence-plugins" class="active page">Persistence Plugins</a>
    <ul>
      <li><a href="persistence-plugins.html#eager-initialization-of-persistence-plugin" class="header">Eager initialization of persistence plugin</a></li>
      <li><a href="persistence-plugins.html#pre-packaged-plugins" class="header">Pre-packaged plugins</a></li>
    </ul></li>
    <li><a href="persistence-journals.html" class="page">Persistence - Building a storage backend</a></li>
    <li><a href="typed/replicated-eventsourcing-examples.html" class="page">Replicated Event Sourcing Examples</a></li>
  </ul></li>
  <li><a href="typed/index-persistence-durable-state.html" class="page">Persistence (Durable State)</a></li>
  <li><a href="stream/index.html" class="page">Streams</a></li>
  <li><a href="discovery/index.html" class="page">Discovery</a></li>
  <li><a href="index-utilities.html" class="page">Utilities</a></li>
  <li><a href="common/other-modules.html" class="page">Other Akka modules</a></li>
  <li><a href="additional/deploy.html" class="page">Package, Deploy and Run</a></li>
  <li><a href="project/index.html" class="page">Project Information</a></li>
  <li><a href="index-classic.html" class="page">Akka Classic</a></li>
</ul>
</div>
</nav>
<footer class="nav-footer sticky-sidebar-footer">
<a href="https://akka.io"><img class="logo" src="images/akka-logo-reverse.svg"/></a>

</footer>
</aside>
<main class="fixed-shift-for-large expanded row">
<section class="site-content small-12 column">
<article class="page-content row">
<div class="small-12 column" id="docs">
<h1><a href="#persistence-plugins" name="persistence-plugins" class="anchor"><span class="anchor-link"></span></a>Persistence Plugins</h1>
<p>Storage backends for journals and snapshot stores are pluggable in the Akka persistence extension.</p>
<p>A directory of persistence journal and snapshot store plugins is available at the Akka Community Projects page, see <a href="https://akka.io/community/">Community plugins</a></p>
<p>Plugins maintained within the Akka organization are:</p>
<ul>
  <li><a href="https://doc.akka.io/docs/akka-persistence-cassandra/current/">akka-persistence-cassandra</a> (no Durable State support)</li>
  <li><a href="https://doc.akka.io/docs/akka-persistence-jdbc/current/">akka-persistence-jdbc</a></li>
  <li><a href="https://doc.akka.io/docs/akka-persistence-r2dbc/current/">akka-persistence-r2dbc</a></li>
  <li><a href="https://doc.akka.io/docs/akka-persistence-spanner/current/">akka-persistence-spanner</a></li>
</ul>
<p>Plugins can be selected either by &ldquo;default&rdquo; for all persistent actors, or &ldquo;individually&rdquo;, when a persistent actor defines its own set of plugins.</p>
<p>When a persistent actor does NOT override the <code>journalPluginId</code> and <code>snapshotPluginId</code> methods, the persistence extension will use the &ldquo;default&rdquo; journal, snapshot-store and durable-state plugins configured in <code>reference.conf</code>:</p>
<pre><code>akka.persistence.journal.plugin = &quot;&quot;
akka.persistence.snapshot-store.plugin = &quot;&quot;
akka.persistence.state.plugin = &quot;&quot;
</code></pre>
<p>However, these entries are provided as empty &quot;&quot;, and require explicit user configuration via override in the user <code>application.conf</code>.</p>
<ul>
  <li>For an example of a journal plugin which writes messages to LevelDB see <a href="persistence-plugins.html#local-leveldb-journal">Local LevelDB journal</a>.</li>
  <li>For an example of a snapshot store plugin which writes snapshots as individual files to the local filesystem see <a href="persistence-plugins.html#local-snapshot-store">Local snapshot store</a>.</li>
  <li>The state store is relatively new, one available implementation is the <a href="https://doc.akka.io/docs/akka-persistence-jdbc/current/">akka-persistence-jdbc-plugin</a>.</li>
</ul>
<h2><a href="#eager-initialization-of-persistence-plugin" name="eager-initialization-of-persistence-plugin" class="anchor"><span class="anchor-link"></span></a>Eager initialization of persistence plugin</h2>
<p>By default, persistence plugins are started on-demand, as they are used. In some case, however, it might be beneficial to start a certain plugin eagerly. In order to do that, you should first add <code>akka.persistence.Persistence</code> under the <code>akka.extensions</code> key. Then, specify the IDs of plugins you wish to start automatically under <code>akka.persistence.journal.auto-start-journals</code> and <code>akka.persistence.snapshot-store.auto-start-snapshot-stores</code>.</p>
<p>For example, if you want eager initialization for the leveldb journal plugin and the local snapshot store plugin, your configuration should look like this: </p>
<pre><code>akka {

  extensions = [akka.persistence.Persistence]

  persistence {

    journal {
      plugin = &quot;akka.persistence.journal.leveldb&quot;
      auto-start-journals = [&quot;akka.persistence.journal.leveldb&quot;]
    }

    snapshot-store {
      plugin = &quot;akka.persistence.snapshot-store.local&quot;
      auto-start-snapshot-stores = [&quot;akka.persistence.snapshot-store.local&quot;]
    }

  }

}
</code></pre>
<h2><a href="#pre-packaged-plugins" name="pre-packaged-plugins" class="anchor"><span class="anchor-link"></span></a>Pre-packaged plugins</h2>
<p>The Akka Persistence module comes with few built-in persistence plugins, but none of these are suitable for production usage in an Akka Cluster. </p>
<h3><a href="#local-leveldb-journal" name="local-leveldb-journal" class="anchor"><span class="anchor-link"></span></a>Local LevelDB journal</h3>
<p>This plugin writes events to a local LevelDB instance.</p><div class="callout warning "><div class="callout-title">Warning</div>
<p>The LevelDB plugin cannot be used in an Akka Cluster since the storage is in a local file system.</p></div>
<p>The LevelDB journal is deprecated and it is not advised to build new applications with it. As a replacement we recommend using <a href="https://doc.akka.io/docs/akka-persistence-jdbc/current/index.html">Akka Persistence JDBC</a>.</p>
<p>The LevelDB journal plugin config entry is <code>akka.persistence.journal.leveldb</code>. Enable this plugin by defining config property:</p>
<pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/akka/tree/v2.7.0-M4/akka-docs/src/test/scala/docs/persistence/PersistencePluginDocSpec.scala#L28-L29" target="_blank" title="Go to snippet source">source</a><code class="language-scala"># Path to the journal plugin to be used
akka.persistence.journal.plugin = &quot;akka.persistence.journal.leveldb&quot;</code></pre>
<p>LevelDB based plugins will also require the following additional dependency declaration:</p><dl class="dependency"><dt>sbt</dt><dd><pre class="prettyprint"><code class="language-scala">libraryDependencies += "org.fusesource.leveldbjni" % "leveldbjni-all" % "1.8"</code></pre></dd><dt>Maven</dt><dd><pre class="prettyprint"><code class="language-xml">&lt;dependencies&gt
  &lt;dependency&gt;
    &lt;groupId&gt;org.fusesource.leveldbjni&lt;/groupId&gt;
    &lt;artifactId&gt;leveldbjni-all&lt;/artifactId&gt;
    &lt;version&gt;1.8&lt;/version&gt;
  &lt;/dependency&gt
&lt;/dependencies&gt;</code></pre></dd><dt>Gradle</dt><dd><pre class="prettyprint"><code class="language-gradle">dependencies {
  implementation "org.fusesource.leveldbjni:leveldbjni-all:1.8"
}</code></pre></dd></dl>
<p>The default location of LevelDB files is a directory named <code>journal</code> in the current working directory. This location can be changed by configuration where the specified path can be relative or absolute:</p>
<pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/akka/tree/v2.7.0-M4/akka-docs/src/test/scala/docs/persistence/PersistencePluginDocSpec.scala#L41" target="_blank" title="Go to snippet source">source</a><code class="language-scala">akka.persistence.journal.leveldb.dir = &quot;target/journal&quot;</code></pre>
<p>With this plugin, each actor system runs its own private LevelDB instance.</p>
<p>One peculiarity of LevelDB is that the deletion operation does not remove messages from the journal, but adds a &ldquo;tombstone&rdquo; for each deleted message instead. In the case of heavy journal usage, especially one including frequent deletes, this may be an issue as users may find themselves dealing with continuously increasing journal sizes. To this end, LevelDB offers a special journal compaction function that is exposed via the following configuration:</p>
<pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/akka/tree/v2.7.0-M4/akka-docs/src/test/scala/docs/persistence/PersistencePluginDocSpec.scala#L51-L59" target="_blank" title="Go to snippet source">source</a><code class="language-scala"># Number of deleted messages per persistence id that will trigger journal compaction
akka.persistence.journal.leveldb.compaction-intervals {
  persistence-id-1 = 100
  persistence-id-2 = 200
  # ...
  persistence-id-N = 1000
  # use wildcards to match unspecified persistence ids, if any
  &quot;*&quot; = 250
}</code></pre>
<h3><a href="#shared-leveldb-journal" name="shared-leveldb-journal" class="anchor"><span class="anchor-link"></span></a>Shared LevelDB journal</h3>
<p>The LevelDB journal is deprecated and will be removed from a future Akka version, it is not advised to build new applications with it. For testing in a multi node environment the &ldquo;inmem&rdquo; journal together with the <a href="persistence-plugins.html#persistence-plugin-proxy">proxy plugin</a> can be used, but the actual journal used in production of applications is also a good choice.</p><div class="callout note "><div class="callout-title">Note</div>
<p>This plugin has been supplanted by <a href="persistence-plugins.html#persistence-plugin-proxy">Persistence Plugin Proxy</a>.</p></div>
<p>A shared LevelDB instance is started by instantiating the <code>SharedLeveldbStore</code> actor.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/akka/tree/v2.7.0-M4/akka-docs/src/test/scala/docs/persistence/PersistencePluginDocSpec.scala#L148-L150" target="_blank" title="Go to snippet source">source</a><code class="language-scala">import akka.persistence.journal.leveldb.SharedLeveldbStore

val store = system.actorOf(Props[SharedLeveldbStore](), &quot;store&quot;)</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/akka/tree/v2.7.0-M4/akka-docs/src/test/java/jdocs/persistence/LambdaPersistencePluginDocTest.java#L40" target="_blank" title="Go to snippet source">source</a><code class="language-java">final ActorRef store = system.actorOf(Props.create(SharedLeveldbStore.class), &quot;store&quot;);</code></pre></dd>
</dl>
<p>By default, the shared instance writes journaled messages to a local directory named <code>journal</code> in the current working directory. The storage location can be changed by configuration:</p>
<pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/akka/tree/v2.7.0-M4/akka-docs/src/test/scala/docs/persistence/PersistencePluginDocSpec.scala#L121" target="_blank" title="Go to snippet source">source</a><code class="language-scala">akka.persistence.journal.leveldb-shared.store.dir = &quot;target/shared&quot;</code></pre>
<p>Actor systems that use a shared LevelDB store must activate the <code>akka.persistence.journal.leveldb-shared</code> plugin.</p>
<pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/akka/tree/v2.7.0-M4/akka-docs/src/test/scala/docs/persistence/PersistencePluginDocSpec.scala#L115" target="_blank" title="Go to snippet source">source</a><code class="language-scala">akka.persistence.journal.plugin = &quot;akka.persistence.journal.leveldb-shared&quot;</code></pre>
<p>This plugin must be initialized by injecting the (remote) <code>SharedLeveldbStore</code> actor reference. Injection is done by calling the <code>SharedLeveldbJournal.setStore</code> method with the actor reference as argument.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/akka/tree/v2.7.0-M4/akka-docs/src/test/scala/docs/persistence/PersistencePluginDocSpec.scala#L129-L138" target="_blank" title="Go to snippet source">source</a><code class="language-scala">trait SharedStoreUsage extends Actor {
  override def preStart(): Unit = {
    context.actorSelection(&quot;akka://example@127.0.0.1:2552/user/store&quot;) ! Identify(1)
  }

  def receive = {
    case ActorIdentity(1, Some(store)) =&gt;
      SharedLeveldbJournal.setStore(store, context.system)
  }
}</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/akka/tree/v2.7.0-M4/akka-docs/src/test/java/jdocs/persistence/LambdaPersistencePluginDocTest.java#L44-L69" target="_blank" title="Go to snippet source">source</a><code class="language-java">class SharedStorageUsage extends AbstractActor {
  @Override
  public void preStart() throws Exception {
    String path = &quot;akka://example@127.0.0.1:2552/user/store&quot;;
    ActorSelection selection = getContext().actorSelection(path);
    selection.tell(new Identify(1), getSelf());
  }

  @Override
  public Receive createReceive() {
    return receiveBuilder()
        .match(
            ActorIdentity.class,
            ai -&gt; {
              if (ai.correlationId().equals(1)) {
                Optional&lt;ActorRef&gt; store = ai.getActorRef();
                if (store.isPresent()) {
                  SharedLeveldbJournal.setStore(store.get(), getContext().getSystem());
                } else {
                  throw new RuntimeException(&quot;Couldn&#39;t identify store&quot;);
                }
              }
            })
        .build();
  }
}</code></pre></dd>
</dl>
<p>Internal journal commands (sent by persistent actors) are buffered until injection completes. Injection is idempotent i.e. only the first injection is used.</p>
<h3><a href="#local-snapshot-store" name="local-snapshot-store" class="anchor"><span class="anchor-link"></span></a>Local snapshot store</h3>
<p>This plugin writes snapshot files to the local filesystem.</p><div class="callout warning "><div class="callout-title">Warning</div>
<p>The local snapshot store plugin cannot be used in an Akka Cluster since the storage is in a local file system.</p></div>
<p>The local snapshot store plugin config entry is <code>akka.persistence.snapshot-store.local</code>. Enable this plugin by defining config property:</p>
<pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/akka/tree/v2.7.0-M4/akka-docs/src/test/scala/docs/persistence/PersistencePluginDocSpec.scala#L33-L34" target="_blank" title="Go to snippet source">source</a><code class="language-scala"># Path to the snapshot store plugin to be used
akka.persistence.snapshot-store.plugin = &quot;akka.persistence.snapshot-store.local&quot;</code></pre>
<p>The default storage location is a directory named <code>snapshots</code> in the current working directory. This can be changed by configuration where the specified path can be relative or absolute:</p>
<pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/akka/tree/v2.7.0-M4/akka-docs/src/test/scala/docs/persistence/PersistencePluginDocSpec.scala#L44" target="_blank" title="Go to snippet source">source</a><code class="language-scala">akka.persistence.snapshot-store.local.dir = &quot;target/snapshots&quot;</code></pre>
<p>Note that it is not mandatory to specify a snapshot store plugin. If you don&rsquo;t use snapshots you don&rsquo;t have to configure it.</p>
<h3><a href="#persistence-plugin-proxy" name="persistence-plugin-proxy" class="anchor"><span class="anchor-link"></span></a>Persistence Plugin Proxy</h3>
<p>For testing purposes a persistence plugin proxy allows sharing of a journal and snapshot store on a single node across multiple actor systems (on the same or on different nodes). This, for example, allows persistent actors to failover to a backup node and continue using the shared journal instance from the backup node. The proxy works by forwarding all the journal/snapshot store messages to a single, shared, persistence plugin instance, and therefore supports any use case supported by the proxied plugin.</p><div class="callout warning "><div class="callout-title">Warning</div>
<p>A shared journal/snapshot store is a single point of failure and should only be used for testing purposes.</p></div>
<p>The journal and snapshot store proxies are controlled via the <code>akka.persistence.journal.proxy</code> and <code>akka.persistence.snapshot-store.proxy</code> configuration entries, respectively. Set the <code>target-journal-plugin</code> or <code>target-snapshot-store-plugin</code> keys to the underlying plugin you wish to use (for example: <code>akka.persistence.journal.inmem</code>). The <code>start-target-journal</code> and <code>start-target-snapshot-store</code> keys should be set to <code>on</code> in exactly one actor system - this is the system that will instantiate the shared persistence plugin. Next, the proxy needs to be told how to find the shared plugin. This can be done by setting the <code>target-journal-address</code> and <code>target-snapshot-store-address</code> configuration keys, or programmatically by calling the <code>PersistencePluginProxy.setTargetLocation</code> method.</p><div class="callout note "><div class="callout-title">Note</div>
<p>Akka starts extensions lazily when they are required, and this includes the proxy. This means that in order for the proxy to work, the persistence plugin on the target node must be instantiated. This can be done by instantiating the <code>PersistencePluginProxyExtension</code> <a href="extending-akka.html">extension</a>, or by calling the <code>PersistencePluginProxy.start</code> method.</p></div><div class="callout note "><div class="callout-title">Note</div>
<p>The proxied persistence plugin can (and should) be configured using its original configuration keys.</p></div>
</div>
</article>
<div class="row">
<div class="small-12 column">
<section class="nav-prev-next row">
<div class="nav-prev small-6 column">
<a href="persistence-query-leveldb.html"><i class="icon-prev"></i> <span class="link-prev">Persistence Query for LevelDB</span></a>
</div>
<div class="nav-next small-6 column clearfix">
<a class="float-right" href="persistence-journals.html">Persistence - Building a storage backend <i class="icon-next"></i></a>
</div>
</section>
</div>
</div>
<div class="source-github row">
Found an error in this documentation? The source code for this page can be found <a href="https://github.com/akka/akka/tree/v2.7.0-M4/akka-docs/src/main/paradox/persistence-plugins.md">here</a>.
Please feel free to edit and contribute a pull request.
</div>

<footer class="page-footer row clearfix">
<img class="akka-icon float-left show-for-medium" src="images/akka-icon.svg" />
<section class="copyright">
<div>Akka is available under the <a href="https://www.lightbend.com/akka/license" target="_blank">Business Source License 1.1</a>.</div>
<p class="legal">
&copy; 2011-2022 <a href="https://www.lightbend.com" target="_blank">Lightbend, Inc.</a> |
<a href="https://www.lightbend.com/legal/licenses" target="_blank">Licenses</a> |
<a href="https://www.lightbend.com/legal/terms" target="_blank">Terms</a> |
<a href="https://www.lightbend.com/legal/privacy" target="_blank">Privacy Policy</a> |
<a href="https://akka.io/cookie/" target="_blank">Cookie Listing</a> |
<a class="optanon-toggle-display">Cookie Settings</a>
</p>
</section>

</footer>
</section>
</main>
</div>

<script type="text/javascript" src="js/scrollsneak.js"></script>
<script type="text/javascript">jQuery(document).foundation();</script>
<script type="text/javascript" src="js/groups.js"></script>
<script type="text/javascript" src="js/page.js"></script>
<script type="text/javascript" src="js/snippets.js"></script>
<script type="text/javascript" src="js/magellan.js"></script>
<script type="text/javascript" src="js/metadata-toggle.js"></script>
<script type="text/javascript" src="js/lbHeader.js"></script>

<style type="text/css">@import "lib/prettify/prettify.css";</style>
<script type="text/javascript" src="lib/prettify/prettify.js"></script>
<script type="text/javascript" src="lib/prettify/lang-scala.js"></script>
<script type="text/javascript">//<![CDATA[
jQuery(function(){window.prettyPrint && prettyPrint()});
//]]></script>
<!-- Algolia docs search -->
<script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.js"></script>
<style>.algolia-autocomplete { display: block !important }</style>
<script type="text/javascript">
docsearch({
apiKey: '543bad5ad786495d9ccd445ed34ed082',
indexName: 'akka_io',
inputSelector: '#search',
algoliaOptions: {
hitsPerPage: 5
}
});

docsearch({
apiKey: '543bad5ad786495d9ccd445ed34ed082',
indexName: 'akka_io',
inputSelector: '#overlay-search',
algoliaOptions: {
hitsPerPage: 5
}
});

// set up "/" as global shortcut for focusing on search
jQuery(document).keypress(function (event) {
if (event.keyCode == 47) {
jQuery("#search").focus();
return false; // swallow key event, otherwise the / char would be input into the search box
}
});
</script>

<script type="text/javascript" src="assets/js/warnOldDocs.js"></script>
<script type="text/javascript" src="assets/js/scalafiddle.js"></script>


</body>
</html>
