<!DOCTYPE html>
<html class="no-js" lang="en">

<head>
<title>Persistence &bull; Akka Documentation</title>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<meta name="description" content="Akka is a toolkit for building highly concurrent, distributed, and resilient message-driven applications for Java and Scala."/>
<link rel="canonical" href="https://doc.akka.io/docs/akka/current/typed/persistence.html"/>
<script type="text/javascript" src="../lib/jquery/jquery.min.js"></script>
<script type="text/javascript" src="../lib/foundation/dist/js/foundation.min.js"></script>
<link rel="stylesheet" type="text/css" href="../lib/normalize.css/normalize.css"/>
<link rel="stylesheet" type="text/css" href="../lib/foundation/dist/css/foundation.min.css"/>
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.css" />
<link rel="stylesheet" type="text/css" href="../css/icons.css"/>
<link rel="stylesheet" type="text/css" href="../css/page-3.css"/>
<link rel="stylesheet" type="text/css" href="../css/banner.css"/>
<link rel="shortcut icon" href="../images/favicon.ico" />
<link rel="apple-touch-icon" sizes="180x180" href="../images/apple-touch-icon.png"/>
<link rel="icon" type="image/png" sizes="32x32" href="../images/favicon-32x32.png"/>
<link rel="icon" type="image/png" sizes="16x16" href="../images/favicon-16x16.png"/>
<link rel="manifest" href="../images/manifest.json"/>
<meta name="msapplication-TileImage" content="../images/mstile-150x150.png"/>
<meta name="msapplication-TileColor" content="#15a9ce"/>
<meta name="theme-color" content="#15a9ce"/>
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>
<!-- OneTrust Cookies Consent Notice (Production Standard, akka.io, en-GB) start -->
<script src="https://optanon.blob.core.windows.net/consent/159bb13d-6748-4399-806e-ac28db879785.js" type="text/javascript" charset="UTF-8"></script>
<script type="text/javascript">
function OptanonWrapper() { }
</script>
<!-- OneTrust Cookies Consent Notice (Production Standard, akka.io, en-GB) end -->
<!--Google Analytics-->
<script type="text/plain" class="optanon-category-2">
var _gaq = _gaq || [];
_gaq.push(['_setAccount', 'UA-21117439-1']);
_gaq.push(['_setDomainName', 'akka.io']);
_gaq.push(['_trackPageview']);
(function() {
var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})()
</script>
<!-- Google Tag Manager -->
<script type="text/plain" class="optanon-category-2">
(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-KBJGH35');
</script>
<!--Marketo-->
<script type="text/plain" class="optanon-category-3">
(function() {
var didInit = false;
function initMunchkin() {
if(didInit === false) {
didInit = true;
Munchkin.init('558-NCX-702', { 'asyncOnly': true, 'disableClickDelay': true });
}
}
var s = document.createElement('script');
s.type = 'text/javascript';
s.async = true;
s.src = '//munchkin.marketo.net/munchkin.js';
s.onreadystatechange = function() {
if (this.readyState == 'complete' || this.readyState == 'loaded') {
initMunchkin();
}
};
s.onload = initMunchkin;
document.getElementsByTagName('head')[0].appendChild(s);
})();
</script>
</head>

<body id="underlay" data-toggler="nav-open">
<div id="lightbend-banner" class="lightbend-banner akka full-width" data-category="OSS Lightbend Banner Impression" data-label="Akka Banner Impression">
<div class="wrapper">
<div class="brand">
<a class="oss-track-link-label" data-category="OSS Lightbend Banner Clicks" data-label="Lightbend Logo - Akka Banner" href="https://www.lightbend.com/lightbend-platform" target="_blank">
<svg class="lightbend-logo" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 372 80">
<title>Lightbend</title>
<g id="lightbend-reverse">
<path d="M1,59V76a3,3,0,0,0,3,3H88a3,3,0,0,0,3-3V59a167.38,167.38,0,0,1-45,6A167.38,167.38,0,0,1,1,59Z" fill="#fff" />
<path d="M88,1H4A3,3,0,0,0,1,4V53c14.57,4.2,29.65,7,45,7s30.43-2.8,45-7V4A3,3,0,0,0,88,1Z" fill="#fff" />
<g id="original_weight" data-name="original weight">
<path d="M107.2,20.08a2.14,2.14,0,1,1,4.27,0v32h13.6A2,2,0,0,1,127,54a1.94,1.94,0,0,1-1.94,2H109.31a2.15,2.15,0,0,1-2.11-2.16Z" fill="#fff" />
<path d="M135,19.32a2.47,2.47,0,0,1,4.91,0V20A2.47,2.47,0,0,1,135,20Zm.38,10.59a2.08,2.08,0,1,1,4.16,0V54.15a2,2,0,0,1-2.06,2.11,2.08,2.08,0,0,1-2.1-2.11Z" fill="#fff" />
<path d="M150.8,61.44a1.91,1.91,0,0,1-1.08-1.73,2,2,0,0,1,1.89-1.83,1.69,1.69,0,0,1,.92.27,17.63,17.63,0,0,0,9.88,3c6.15,0,10.15-3.4,10.15-9.93v-3.3c-2.43,3.24-5.83,5.89-11,5.89a12.9,12.9,0,0,1-13.12-13.07v-.11a13.21,13.21,0,0,1,24-7.56V29.91a2.07,2.07,0,0,1,2.06-2.11,2.11,2.11,0,0,1,2.1,2.11V51.13c0,4.32-1.29,7.61-3.56,9.88-2.49,2.48-6.21,3.73-10.64,3.73A21.87,21.87,0,0,1,150.8,61.44Zm21.87-20.73V40.6c0-5.72-5-9.45-10.26-9.45s-9.67,3.67-9.67,9.4v.1a9.45,9.45,0,0,0,9.67,9.51C167.7,50.16,172.67,46.32,172.67,40.71Z" fill="#fff" />
<path d="M186.22,18.41a2.08,2.08,0,1,1,4.16,0V32.93a10.57,10.57,0,0,1,9.56-5.45c6.75,0,10.69,4.53,10.69,11.18V54.15a2.08,2.08,0,1,1-4.16,0V39.68c0-5.18-2.81-8.42-7.72-8.42s-8.37,3.51-8.37,8.75V54.15a2,2,0,0,1-2,2.11,2.08,2.08,0,0,1-2.11-2.11Z" fill="#fff" />
<path d="M220.46,48.59V31.74h-2.27a1.89,1.89,0,0,1-1.84-1.83,1.86,1.86,0,0,1,1.84-1.84h2.27V21.48a2.06,2.06,0,0,1,2-2.1,2.14,2.14,0,0,1,2.1,2.1v6.59h7.24a1.91,1.91,0,0,1,1.89,1.84,1.86,1.86,0,0,1-1.89,1.83h-7.24V48.05c0,3.4,1.89,4.64,4.7,4.64a12,12,0,0,0,2.54-.37,1.8,1.8,0,0,1,1.78,1.78,1.73,1.73,0,0,1-1.19,1.62,10.57,10.57,0,0,1-4.1.75C223.86,56.47,220.46,54.26,220.46,48.59Z" fill="#fff" />
<path d="M242.65,18.41a2.08,2.08,0,1,1,4.16,0V33.69c2.27-3.35,5.56-6.21,10.69-6.21,6.7,0,13.34,5.29,13.34,14.47v.11c0,9.12-6.59,14.52-13.34,14.52a12.6,12.6,0,0,1-10.69-5.94v3.51a2.07,2.07,0,0,1-2.05,2.11,2.11,2.11,0,0,1-2.11-2.11Zm23.92,23.7V42c0-6.58-4.53-10.8-9.83-10.8A10.41,10.41,0,0,0,246.65,42v.11c0,6.48,4.91,10.8,10.09,10.8C262.14,52.86,266.57,48.86,266.57,42.11Z" fill="#fff" />
<path d="M290.17,56.64c-7.67,0-13.93-5.89-13.93-14.53V42c0-8,5.67-14.52,13.39-14.52,8.26,0,13,6.75,13,14.15a1.94,1.94,0,0,1-1.95,1.94H280.45c.59,6,4.86,9.45,9.83,9.45a11.4,11.4,0,0,0,8-3.24,1.83,1.83,0,0,1,1.19-.49,1.81,1.81,0,0,1,1.84,1.78,1.78,1.78,0,0,1-.65,1.35A14.2,14.2,0,0,1,290.17,56.64Zm8.26-16.15c-.43-5.07-3.35-9.5-8.91-9.5-4.86,0-8.53,4.05-9.07,9.5Z" fill="#fff" />
<path d="M309.5,29.91a2.08,2.08,0,1,1,4.16,0v3a10.57,10.57,0,0,1,9.56-5.45c6.75,0,10.69,4.53,10.69,11.18V54.15a2.08,2.08,0,1,1-4.16,0V39.68c0-5.18-2.81-8.42-7.72-8.42s-8.37,3.51-8.37,8.75V54.15a2,2,0,0,1-2.05,2.11,2.08,2.08,0,0,1-2.11-2.11Z" fill="#fff" />
<path d="M368.68,54.15a2.08,2.08,0,1,1-4.15,0V50.37c-2.27,3.35-5.57,6.21-10.7,6.21-6.69,0-13.33-5.29-13.33-14.47V42c0-9.12,6.64-14.52,13.33-14.52a12.61,12.61,0,0,1,10.7,5.94v-15a2,2,0,0,1,2.05-2.11,2.07,2.07,0,0,1,2.1,2.11ZM344.76,42v.11c0,6.58,4.59,10.8,9.83,10.8a10.43,10.43,0,0,0,10.1-10.8V42a10.38,10.38,0,0,0-10.1-10.75C349.19,31.2,344.76,35.2,344.76,42Z" fill="#fff" />
</g>
</g>
</svg>
</a>
</div>
<div class="nav">
<a class="banner-btn oss-track-link-label" data-category="OSS Lightbend Banner Clicks" data-label="See how Akka fits into Lightbend Platform [Button]" href="https://www.lightbend.com/akka-part-of-lightbend-platform" target="_blank">
<span>See how Akka fits into</span>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 274 80">
<title>Lightbend Platform</title>
<g id="lightbend-platform-reverse">
<g id="icon">
<path d="M1,59V76a3,3,0,0,0,3,3H88a3,3,0,0,0,3-3V59a167.38,167.38,0,0,1-45,6A167.38,167.38,0,0,1,1,59Z" fill="#fff" />
<path d="M88,1H4A3,3,0,0,0,1,4V53c14.57,4.2,29.65,7,45,7s30.43-2.8,45-7V4A3,3,0,0,0,88,1Z" fill="#fff" />
</g>
<g id="lightbend">
<path d="M104,14.73a1,1,0,1,1,2,0V29.4h6.24a.91.91,0,0,1,.89.92.88.88,0,0,1-.89.89H105a1,1,0,0,1-1-1Z" fill="#fff" />
<path d="M116.77,14.39a1.14,1.14,0,0,1,2.26,0v.32a1.14,1.14,0,0,1-2.26,0Zm.18,4.85a1,1,0,1,1,1.9,0V30.37a.93.93,0,0,1-.94,1,1,1,0,0,1-1-1Z" fill="#fff" />
<path d="M124,33.72a.89.89,0,0,1-.5-.8.91.91,0,0,1,.87-.84.8.8,0,0,1,.42.12,8.05,8.05,0,0,0,4.54,1.39C132.16,33.59,134,32,134,29V27.52a6,6,0,0,1-5,2.7,5.92,5.92,0,0,1-6-6v-.05a6.07,6.07,0,0,1,11-3.47V19.24a.94.94,0,0,1,.94-1,1,1,0,0,1,1,1V29a6.18,6.18,0,0,1-1.64,4.54,6.73,6.73,0,0,1-4.88,1.71A10,10,0,0,1,124,33.72Zm10-9.52v-.05a4.49,4.49,0,0,0-4.7-4.34,4.24,4.24,0,0,0-4.44,4.32v.05a4.34,4.34,0,0,0,4.44,4.36A4.52,4.52,0,0,0,134,24.2Z" fill="#fff" />
<path d="M140.26,14a1,1,0,1,1,1.91,0v6.66a4.84,4.84,0,0,1,4.39-2.5c3.1,0,4.9,2.08,4.9,5.13v7.11a1,1,0,1,1-1.9,0V23.73c0-2.38-1.29-3.87-3.55-3.87a3.77,3.77,0,0,0-3.84,4v6.49a.93.93,0,0,1-.94,1,1,1,0,0,1-1-1Z" fill="#fff" />
<path d="M156,27.82V20.09h-1a.87.87,0,0,1-.84-.85.85.85,0,0,1,.84-.84h1v-3a1,1,0,0,1,.94-1,1,1,0,0,1,1,1v3h3.32a.87.87,0,0,1,.87.84.85.85,0,0,1-.87.85h-3.32v7.48A1.9,1.9,0,0,0,160,29.7a5.31,5.31,0,0,0,1.16-.17.82.82,0,0,1,.82.82.79.79,0,0,1-.54.74,4.9,4.9,0,0,1-1.89.35A3.26,3.26,0,0,1,156,27.82Z" fill="#fff" />
<path d="M166.16,14a1,1,0,1,1,1.91,0v7A5.75,5.75,0,0,1,173,18.13c3.07,0,6.12,2.43,6.12,6.64v.05c0,4.19-3,6.67-6.12,6.67a5.78,5.78,0,0,1-4.91-2.73v1.61a1,1,0,0,1-.94,1,1,1,0,0,1-1-1Zm11,10.88V24.8c0-3-2.08-5-4.51-5A4.78,4.78,0,0,0,168,24.77v.05a4.78,4.78,0,0,0,4.64,5C175.11,29.78,177.14,27.94,177.14,24.85Z" fill="#fff" />
<path d="M188,31.51a6.37,6.37,0,0,1-6.4-6.66V24.8c0-3.7,2.61-6.67,6.15-6.67,3.79,0,5.95,3.1,5.95,6.49a.89.89,0,0,1-.89.89h-9.27A4.47,4.47,0,0,0,188,29.85a5.23,5.23,0,0,0,3.69-1.49.85.85,0,0,1,.54-.22.81.81,0,0,1,.55,1.44A6.52,6.52,0,0,1,188,31.51Zm3.79-7.41c-.2-2.33-1.54-4.36-4.09-4.36-2.23,0-3.91,1.86-4.16,4.36Z" fill="#fff" />
<path d="M196.84,19.24a1,1,0,1,1,1.91,0v1.39a4.84,4.84,0,0,1,4.38-2.5c3.1,0,4.91,2.08,4.91,5.13v7.11a1,1,0,1,1-1.91,0V23.73c0-2.38-1.29-3.87-3.54-3.87a3.77,3.77,0,0,0-3.84,4v6.49a.93.93,0,0,1-.94,1,1,1,0,0,1-1-1Z" fill="#fff" />
<path d="M224,30.37a1,1,0,1,1-1.91,0V28.64a5.77,5.77,0,0,1-4.9,2.85,6.25,6.25,0,0,1-6.13-6.64V24.8a6.29,6.29,0,0,1,6.13-6.67,5.78,5.78,0,0,1,4.9,2.73V14a.93.93,0,0,1,.94-1,1,1,0,0,1,1,1Zm-11-5.6v.05a4.64,4.64,0,0,0,4.51,5,4.79,4.79,0,0,0,4.64-5v-.05a4.76,4.76,0,0,0-4.64-4.93C215.05,19.84,213,21.67,213,24.77Z" fill="#fff" />
</g>
<path d="M103.36,41H114.8c6.68,0,10.72,4,10.72,9.68v.08c0,6.48-5,9.84-11.32,9.84h-4.68V69h-6.16Zm11,14.12c3.08,0,4.88-1.84,4.88-4.24V50.8c0-2.76-1.92-4.24-5-4.24h-4.76v8.56Z" fill="#fff" />
<path d="M128.89,39.8H135V69h-6.08Z" fill="#fff" />
<path d="M138.75,62.84v-.08c0-4.68,3.56-6.84,8.64-6.84a15.23,15.23,0,0,1,5.24.88v-.36c0-2.52-1.56-3.92-4.6-3.92a15.77,15.77,0,0,0-5.92,1.16L140.59,49a18.92,18.92,0,0,1,8.32-1.72c3.32,0,5.72.88,7.24,2.4s2.32,4,2.32,6.84V69h-5.88V66.68a8.24,8.24,0,0,1-6.48,2.72C142.07,69.4,138.75,67.08,138.75,62.84Zm14-1.4V60.36a9.43,9.43,0,0,0-3.88-.8c-2.6,0-4.2,1-4.2,3v.08c0,1.64,1.36,2.6,3.32,2.6C150.79,65.2,152.71,63.64,152.71,61.44Z" fill="#fff" />
<path d="M164,62.92V52.76h-2.56v-5.2H164V42.08h6.08v5.48h5v5.2h-5v9.16c0,1.4.6,2.08,2,2.08a6.18,6.18,0,0,0,3-.76v4.88a9,9,0,0,1-4.8,1.24C166.51,69.36,164,67.88,164,62.92Z" fill="#fff" />
<path d="M180.43,52.76h-2.52v-5h2.52V46.4a7,7,0,0,1,1.72-5.19,6.63,6.63,0,0,1,4.92-1.68,13.5,13.5,0,0,1,4.32.59v5a7.7,7.7,0,0,0-2.76-.52c-1.4,0-2.2.72-2.2,2.32v.84h4.92v5h-4.84V69h-6.08Z" fill="#fff" />
<path d="M192.84,58.4v-.08c0-6.16,5-11.16,11.64-11.16S216,52.08,216,58.24v.08c0,6.16-5,11.16-11.64,11.16S192.84,64.56,192.84,58.4Zm17.2,0v-.08a5.7,5.7,0,0,0-5.64-5.92c-3.48,0-5.56,2.68-5.56,5.84v.08a5.7,5.7,0,0,0,5.64,5.92C208,64.24,210,61.56,210,58.4Z" fill="#fff" />
<path d="M219.89,47.56H226v4.32c1.24-3,3.24-4.88,6.84-4.72v6.36h-.32c-4,0-6.52,2.44-6.52,7.56V69h-6.08Z" fill="#fff" />
<path d="M235.8,47.56h6.08v3a7.66,7.66,0,0,1,6.32-3.44,6.42,6.42,0,0,1,6,3.4,8.83,8.83,0,0,1,7-3.4c4.52,0,7.24,2.72,7.24,7.88V69h-6.08V57c0-2.88-1.28-4.36-3.56-4.36S255.2,54.16,255.2,57V69h-6.08V57c0-2.88-1.28-4.36-3.56-4.36s-3.68,1.48-3.68,4.36V69H235.8Z" fill="#fff" />
</g>
</svg>
</a>
<div class="drop-down">
<svg class="svg-chevon-circle-down" version="1.1" id="Chevron_circled_down" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 20 20" enable-background="new 0 0 20 20" xml:space="preserve">
<path fill="#ffffff" d="M12.505,8.698L10,11L7.494,8.698c-0.198-0.196-0.518-0.196-0.718,0c-0.197,0.196-0.197,0.515,0,0.71l2.864,2.807
c0.199,0.196,0.52,0.196,0.717,0l2.864-2.807c0.199-0.195,0.198-0.514,0-0.71C13.024,8.502,12.704,8.502,12.505,8.698z M10,0.4
c-5.302,0-9.6,4.298-9.6,9.6c0,5.303,4.298,9.6,9.6,9.6s9.6-4.297,9.6-9.6C19.6,4.698,15.302,0.4,10,0.4z M10,18.354
c-4.615,0-8.354-3.74-8.354-8.354c0-4.614,3.739-8.354,8.354-8.354c4.613,0,8.354,3.74,8.354,8.354
C18.354,14.614,14.613,18.354,10,18.354z" />
</svg>
<div class="drop-down-content">
<div class="lightbend-family">
<a href="https://www.lagomframework.com" class="lagom oss-track-link-label" data-category="OSS Lightbend Banner Clicks" data-label="Lagom - Logo Tag Line - Akka Banner">
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 752 192">
<title>Lagom Framework</title>
<g>
<g id="Lagom">
<path d="M291.58,31.79h19.83v87.92c0,8.1,2.65,11.57,9.92,11.57a21.37,21.37,0,0,0,5.95-.66V148.3a35.73,35.73,0,0,1-9.42,1c-17.52,0-26.28-8.92-26.28-26.94Z" fill="#652b7c" />
<path d="M398.34,75.75V63.69h19.83v58.17c0,7.1,1.65,9.75,6.11,9.75,1.16,0,2.64-.17,4.13-.33v16a28.83,28.83,0,0,1-9.75,1.32c-4.79,0-8.59-.83-11.57-2.65a15.32,15.32,0,0,1-6.77-10.08C394.53,144.66,385,149,371.73,149A39.59,39.59,0,0,1,342,136.4c-7.93-8.43-11.89-18.67-11.89-31.07s4-22.64,11.89-30.9a39.59,39.59,0,0,1,29.75-12.56C385.12,61.87,395.2,67.82,398.34,75.75Zm-5.95,47.76a24.32,24.32,0,0,0,7.43-18.18,24.34,24.34,0,0,0-7.43-18.18,24.71,24.71,0,0,0-18-7.27,23.94,23.94,0,0,0-17.68,7.27c-4.63,4.8-6.94,10.91-6.94,18.18s2.31,13.39,6.94,18.18a23.94,23.94,0,0,0,17.68,7.27A24.71,24.71,0,0,0,392.39,123.51Z" fill="#652b7c" />
<path d="M495.67,63.69H515.5v69.4c0,20-2.81,32.23-14.05,41-7.93,6.11-17.68,9.25-29.41,9.25-15.54,0-28.92-4-40.32-12.06l9.58-14.71a50.5,50.5,0,0,0,28.59,9.09q11.66,0,18.34-5c5.29-3.8,7.94-10.91,7.94-21.15v-4.13c-4,7.1-13.89,12.23-27.11,12.23a40.51,40.51,0,0,1-29.74-12.23c-7.93-8.1-11.9-18.35-11.9-30.41s4-22.31,12.06-30.57a39.23,39.23,0,0,1,29.58-12.56c13.72,0,23.8,5.78,26.61,13.88ZM489.72,123a24.16,24.16,0,0,0,7.44-18,23.84,23.84,0,0,0-7.44-17.85,24.69,24.69,0,0,0-18-7.27A23.92,23.92,0,0,0,454,87.15,24.7,24.7,0,0,0,447.09,105,25,25,0,0,0,454,123a23.75,23.75,0,0,0,17.68,7.11C478.81,130.12,484.93,127.81,489.72,123Z" fill="#652b7c" />
<path d="M522.44,105.33a42.06,42.06,0,0,1,13.22-31.4c8.76-8.43,19.5-12.72,32.22-12.72s23.47,4.29,32.23,12.72a42.06,42.06,0,0,1,13.22,31.4,42,42,0,0,1-13.22,31.4c-8.76,8.43-19.5,12.72-32.23,12.72s-23.46-4.29-32.22-12.72A42,42,0,0,1,522.44,105.33ZM586.23,124a25.68,25.68,0,0,0,7.43-18.68,25,25,0,0,0-7.43-18.51,26.13,26.13,0,0,0-36.85,0,25.58,25.58,0,0,0-7.27,18.51A26.25,26.25,0,0,0,549.38,124a26.56,26.56,0,0,0,36.85,0Z" fill="#652b7c" />
<path d="M620.6,147V63.69h19.67v11.9C643.74,67.49,652,62,662.58,62,674,62,681.91,66.83,686,76.58,690.84,66.83,699.76,62,712.81,62c18,0,28.43,12.72,28.43,33.38v26.27c0,6.45,1.15,8.76,5.62,8.76a15,15,0,0,0,2.81-.33v16.69a28.48,28.48,0,0,1-8.6,1c-13.05,0-19.5-7.27-19.5-21.81V98.23c0-11.41-5.28-18.51-14.54-18.51s-16,8.09-16,19.33V147H671.34V98.23c0-11.41-5.46-18.51-14.88-18.51-9.25,0-16.19,8.09-16.19,19.33V147Z" fill="#652b7c" />
</g>
<g id="Icon">
<path d="M261,84l-70,34,70,34S260.78,84.27,261,84Z" fill="#652b7c" />
<polygon points="121 152 191 118 121 84 121 152" fill="#652b7c" />
<path d="M191,118l70,34c-.27,0-41.76,25-60.63,36.24a17.63,17.63,0,0,1-18,0C163.47,177,121,152,121,152Z" fill="#421540" />
<path d="M200.23,47.65C219.09,58.88,261,84,261,84l-70,34L121,84c.27,0,42.31-25.12,61.18-36.36A17.67,17.67,0,0,1,200.23,47.65Z" fill="#bf97c6" />
<path d="M145,20.58l-35,17,35,17S144.89,20.72,145,20.58Z" fill="#652b7c" />
<polygon points="75 54.58 110 37.58 75 20.58 75 54.58" fill="#652b7c" />
<path d="M110,37.58l35,17c-.14,0-20.88,12.5-30.31,18.12a8.81,8.81,0,0,1-9,0C96.23,67.08,75,54.58,75,54.58Z" fill="#421540" />
<path d="M114.61,2.4C124,8,145,20.58,145,20.58l-35,17-35-17c.14,0,21.16-12.56,30.59-18.18A8.84,8.84,0,0,1,114.61,2.4Z" fill="#bf97c6" />
<path d="M101,91,51,115.54l50,24.53S100.84,91.21,101,91Z" fill="#652b7c" />
<polygon points="1 140.07 51 115.54 1 91.02 1 140.07" fill="#652b7c" />
<path d="M51,115.54l50,24.53c-.19,0-29.83,18-43.3,26.14a12.48,12.48,0,0,1-12.89,0C31.34,158.1,1,140.07,1,140.07Z" fill="#421540" />
<path d="M57.59,64.79C71.06,72.9,101,91,101,91L51,115.54,1,91c.19,0,30.22-18.12,43.7-26.23A12.48,12.48,0,0,1,57.59,64.79Z" fill="#bf97c6" />
</g>
</g>
</svg>
<span>Opinionated Microservices Framework</span>
</a>
<a href="https://www.playframework.com" class="play oss-track-link-label" data-category="OSS Lightbend Banner Clicks" data-label="Play - Logo Tag Line - Akka Banner">
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 517 270">
<title>Play Framework</title>
<path d="M36.92,26.44l6.19-6.16a23,23,0,0,1,33.68,1.3l85.77,100a23,23,0,0,1-.22,30.17l-85.5,96.91a23,23,0,0,1-33.49,1.05l-6.17-6.17a23,23,0,0,1-1.4-31l51.16-61.39a23,23,0,0,0,.29-29.08l-52-65A23,23,0,0,1,36.92,26.44Z" fill="#92d13d" />
<path d="M86.94,151.18,35.78,212.57a23,23,0,0,0,1.4,31l6.17,6.17a23,23,0,0,0,33.49-1.05l18.51-21a101.68,101.68,0,0,0,10.89-45.91A101.62,101.62,0,0,0,90,126.54,23,23,0,0,1,86.94,151.18Z" fill="#49691f" />
<path d="M206.64,209.51H186.72V93.81h19.92v12.12c2.82-8.13,13-13.94,26.72-13.94,11.79,0,21.75,4.15,29.72,12.61,8.13,8.3,12.12,18.59,12.12,31s-4,22.75-12.12,31.21c-8,8.3-17.93,12.45-29.72,12.45-13.77,0-23.9-5.81-26.72-13.94Zm5.81-92.13a26.46,26.46,0,0,0,0,36.52,25.42,25.42,0,0,0,18.26,7.31,23.36,23.36,0,0,0,17.59-7.31c4.82-4.81,7.14-11,7.14-18.26s-2.32-13.44-7.14-18.26a23.39,23.39,0,0,0-17.59-7.3A25.46,25.46,0,0,0,212.45,117.38Z" fill="#49691f" />
<path d="M282,61.77h19.92v88.32c0,8.13,2.66,11.62,10,11.62a21.11,21.11,0,0,0,6-.67V178.8a35.53,35.53,0,0,1-9.46,1c-17.6,0-26.4-9-26.4-27.06Z" fill="#49691f" />
<path d="M385.25,105.93V93.81h19.92v58.43c0,7.14,1.66,9.8,6.14,9.8,1.17,0,2.66-.17,4.16-.33v16.1a28.82,28.82,0,0,1-9.8,1.33c-4.81,0-8.63-.83-11.62-2.66a15.41,15.41,0,0,1-6.81-10.13c-5.8,8.8-15.43,13.12-28.71,13.12a39.74,39.74,0,0,1-29.88-12.62c-8-8.46-12-18.76-12-31.21s4-22.74,12-31A39.77,39.77,0,0,1,358.53,92C372,92,382.1,98,385.25,105.93Zm-6,48a24.39,24.39,0,0,0,7.47-18.26,24.42,24.42,0,0,0-7.47-18.26,24.82,24.82,0,0,0-18.1-7.3,24.05,24.05,0,0,0-17.76,7.3c-4.65,4.82-7,11-7,18.26s2.32,13.45,7,18.26a24,24,0,0,0,17.76,7.31A24.79,24.79,0,0,0,379.28,153.9Z" fill="#49691f" />
<path d="M422.36,194.24a29.76,29.76,0,0,0,9.29,1.33,13.13,13.13,0,0,0,7.31-1.83c1.82-1.16,3.48-3.65,4.81-7.13l2.16-6-35-86.82H431l24.57,63.08,23.07-63.08h20.09L461.2,191.09q-3.74,9.71-9,14.94c-5,4.65-11.62,7-20.09,7a34.91,34.91,0,0,1-9.79-1.33Z" fill="#49691f" />
</svg>
<span>High velocity<br> web framework</span>
</a>
<a href="https://www.scala-lang.org" class="scala oss-track-link-label" data-category="OSS Lightbend Banner Clicks" data-label="Scala - Logo Tag Line - Akka Banner">
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 590 270">
<title>Scala</title>
<path d="M200.7,142.39c6,11.79,15.6,17.6,29.05,17.6,14.44,0,19.59-7.64,19.59-15.11,0-5.15-1.83-8.63-6.64-11.79-4.82-3.32-8.3-4.81-16.93-8-10.63-4-16.77-7-23.41-12.29-6.64-5.48-9.79-13-9.79-22.74a28.28,28.28,0,0,1,10.29-22.58c7-5.81,15.44-8.63,25.56-8.63,15.77,0,27.72,6.31,35.69,18.76L249.34,87.78c-4.48-6.81-11.29-10.3-20.59-10.3-9.13,0-15.77,5.15-15.77,12.29,0,4.81,2,7.14,4.82,10,1.82,1.33,6.47,3.32,8.63,4.48l6,2.32,6.8,2.66c11,4.48,18.76,9.3,23.57,14.44s7.31,12.12,7.31,20.75c0,20.42-14.11,34.2-40.51,34.2-21.41,0-37.18-10-44.48-26.4Z" fill="#380d09" />
<path d="M354.25,104.71,342,117.49a28.14,28.14,0,0,0-21.24-9.13,25,25,0,0,0-18.43,7.47,27.76,27.76,0,0,0,0,37.52,25,25,0,0,0,18.43,7.47A28.14,28.14,0,0,0,342,151.69l12.29,12.78c-9,9.63-20.09,14.44-33.53,14.44-12.79,0-23.58-4.15-32.37-12.62s-13.12-19.09-13.12-31.7,4.32-23.08,13.12-31.54,19.58-12.78,32.37-12.78C334.16,90.27,345.28,95.08,354.25,104.71Z" fill="#380d09" />
<path d="M393.88,125.62C408,124.3,413,122.47,413,116c0-5.15-4.64-9.13-13.94-9.13q-13.44,0-22.41,10.95l-12.28-10.46c8.13-11.45,19.58-17.09,34.36-17.09,20.75,0,33.7,10,33.7,27.05v37c0,5.81,2.15,6.48,7,6.48h.5v15.43c-2,1.17-5.15,1.83-9.3,1.83-4.48,0-8-1.33-10.62-4a14.06,14.06,0,0,1-3-5.48c-5.81,6.8-15.27,10.29-28.39,10.29-18.42,0-30.87-10.13-30.87-25.4C357.7,136.41,369.15,127.78,393.88,125.62ZM391.56,162c13.28,0,21.41-6,21.41-16.6v-9.3a9.75,9.75,0,0,1-4.14,2.49c-3.82,1.33-6.31,1.66-14.28,2.49-11.62,1.33-17.43,5-17.43,10.79C377.12,158.33,382.43,162,391.56,162Z" fill="#380d09" />
<path d="M444.84,60.88h19.92V149.2c0,8.13,2.66,11.62,10,11.62a21.15,21.15,0,0,0,6-.67v17.76a35.56,35.56,0,0,1-9.47,1c-17.59,0-26.39-9-26.39-27.06Z" fill="#380d09" />
<path d="M521.71,125.62c14.11-1.32,19.09-3.15,19.09-9.62,0-5.15-4.64-9.13-13.94-9.13q-13.44,0-22.41,10.95l-12.28-10.46c8.13-11.45,19.58-17.09,34.36-17.09,20.75,0,33.7,10,33.7,27.05v37c0,5.81,2.15,6.48,7,6.48h.5v15.43c-2,1.17-5.15,1.83-9.3,1.83-4.48,0-8-1.33-10.62-4a13.94,13.94,0,0,1-3-5.48c-5.81,6.8-15.27,10.29-28.39,10.29-18.42,0-30.87-10.13-30.87-25.4C485.53,136.41,497,127.78,521.71,125.62ZM519.39,162c13.28,0,21.41-6,21.41-16.6v-9.3a9.73,9.73,0,0,1-4.15,2.49c-3.81,1.33-6.3,1.66-14.27,2.49-11.62,1.33-17.43,5-17.43,10.79C505,158.33,510.26,162,519.39,162Z" fill="#380d09" />
<path d="M30.55,94.83C32.4,97.38,48,102.19,71.27,107.2c23.27,4.46,47.47,22.07,66.29,16.64,12.73-3.68,26.54-36.47,26.54-41.34V82c0-3.4-2.55-6.13-6.88-8.4-17.75-9.07-21.11-12.41-27.69-10.6C95.37,72.43,35.06,67.61,30.55,94.83Z" fill="#380d09" fill-rule="evenodd" />
<path d="M30.55,161.41C32.4,164,48,168.77,71.27,173.79c26,4.74,48.61,20.19,67.44,14.75,12.73-3.68,25.39-34.58,25.39-39.46v-.48c0-3.39-2.55-6.13-6.88-8.39-13.54-7.2-31.43-15.13-38-13.32C85,136.3,39.26,138.37,30.55,161.41Z" fill="#380d09" fill-rule="evenodd" />
<path d="M30.36,109.14v.48h0A3.73,3.73,0,0,1,30.36,109.14Z" fill="#555" fill-rule="evenodd" />
<path d="M138.66,28.78C107.2,37.87,57.29,43,30.4,43h0V94.35a.8.8,0,0,0,.19.48c18.35,0,75-6,109.18-15.4a129,129,0,0,0,17.49-5.81c4.18-1.88,6.88-3.86,6.88-5.92V15.91C164.1,20.79,151.39,25.11,138.66,28.78Z" fill="#de3423" fill-rule="evenodd" />
<path d="M138.66,95.37c-18.83,5.43-44.24,9.47-67.39,11.83-15.54,1.59-30.06,2.42-40.87,2.42h0v51.31a.8.8,0,0,0,.19.48c18.35,0,75-6,109.18-15.39a130.38,130.38,0,0,0,17.49-5.81c4.18-1.89,6.88-3.86,6.88-5.92V82.5C164.1,87.37,151.39,91.69,138.66,95.37Z" fill="#de3423" fill-rule="evenodd" />
<path d="M138.66,162c-18.83,5.43-44.24,9.46-67.39,11.83-15.56,1.59-30.1,2.42-40.91,2.42V228c18.16,0,75.1-5.95,109.37-15.39,12.63-3.48,24.37-7.44,24.37-11.74V149.08C164.1,154,151.39,158.28,138.66,162Z" fill="#de3423" fill-rule="evenodd" />
</svg>
<span>The JVM language<br> of pragmatism</span>
</a>
<div class="akka">
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 658 270">
<title>Akka</title>
<g id="akka-full-color">
<path d="M349.64,105.46V93.34h19.92v58.44c0,7.13,1.66,9.79,6.14,9.79,1.17,0,2.66-.17,4.15-.33v16.1a28.71,28.71,0,0,1-9.79,1.33c-4.81,0-8.63-.83-11.62-2.66a15.41,15.41,0,0,1-6.81-10.12C345.82,174.68,336.2,179,322.92,179A39.74,39.74,0,0,1,293,166.38c-8-8.46-12-18.75-12-31.2s4-22.75,12-31.05a39.77,39.77,0,0,1,29.88-12.61C336.36,91.52,346.49,97.49,349.64,105.46Zm-6,48a24.42,24.42,0,0,0,7.47-18.26,24.39,24.39,0,0,0-7.47-18.26,24.79,24.79,0,0,0-18.1-7.31,24,24,0,0,0-17.76,7.31c-4.65,4.81-7,11-7,18.26s2.32,13.44,7,18.26a24,24,0,0,0,17.76,7.3A24.82,24.82,0,0,0,343.67,153.44Z" fill="#0b5567" />
<path d="M388.48,177V61.31h19.76v67.56l30.87-35.53H462l-32.7,37.35L465.51,177H442.93l-26.39-33.7-8.3,9.3V177Z" fill="#0b5567" />
<path d="M470.82,177V61.31h19.75v67.56l30.88-35.53h22.91l-32.7,37.35L547.84,177H525.27l-26.4-33.7-8.3,9.3V177Z" fill="#0b5567" />
<path d="M607.87,105.46V93.34h19.92v58.44c0,7.13,1.66,9.79,6.14,9.79,1.17,0,2.66-.17,4.15-.33v16.1a28.71,28.71,0,0,1-9.79,1.33c-4.81,0-8.63-.83-11.62-2.66a15.41,15.41,0,0,1-6.81-10.12c-5.81,8.79-15.43,13.11-28.71,13.11a39.74,39.74,0,0,1-29.88-12.62c-8-8.46-12-18.75-12-31.2s4-22.75,12-31.05a39.77,39.77,0,0,1,29.88-12.61C594.59,91.52,604.72,97.49,607.87,105.46Zm-6,48a24.42,24.42,0,0,0,7.47-18.26,24.39,24.39,0,0,0-7.47-18.26,24.79,24.79,0,0,0-18.1-7.31A24,24,0,0,0,566,116.92c-4.65,4.81-7,11-7,18.26s2.32,13.44,7,18.26a24,24,0,0,0,17.76,7.3A24.82,24.82,0,0,0,601.9,153.44Z" fill="#0b5567" />
<path d="M230.26,212.82c35.88,28.67,58.91-57,1.74-72.82-48-13.29-96.33,9.5-144.66,62.74C87.34,202.74,176.67,170,230.26,212.82Z" fill="#0b5567" />
<path d="M88.08,202c34.41-35.69,91.64-75.53,144.9-60.75A46.09,46.09,0,0,1,259.9,160.6L209.48,58.78c-7.2-11.46-25.58-9.15-35.95-.26L40.29,170.07a27.4,27.4,0,0,0-1.56,40.15l0,0a27.4,27.4,0,0,0,36.51,2L88.14,202Z" fill="#15a9ce" />
</g>
</svg>
<span>Actor-based,<br> cloud native toolkit</span>
</div>
<div class="platform">
<span>From the creators of <strong>Akka</strong>, get technology enhancements, monitoring, and expert support with Lightbend Platform.</span>
<a class="oss-track-link-label" data-category="OSS Lightbend Banner Clicks" data-label="See Akka In Lightbend Platform [Button]" href="https://www.lightbend.com/akka-part-of-lightbend-platform" target="_blank">See Akka In Lightbend Platform</a>
</div>
</div>
<div class="title">The Lightbend Family</div>
</div>
</div>
</div>
</div>
</div>
<header class="site-header hide-for-large">
<div class="sticky-header clearfix">
<a href="https://akka.io"><img class="logo" src="../images/akka-logo-reverse.svg"/></a>

<button class="menu-icon float-right" type="button" data-toggle="underlay overlay"></button>
</div>
<div id="overlay" class="overlay-nav" data-toggler="nav-open">
<header class="nav-header">
<div class="nav-header-title">
<h1><a href="../index.html">Akka Documentation</a></h1>
</div>
<div class="nav-header-version">
Version 2.5.32
</div>
<div class="nav-header-groups">
<select class="supergroup" name="Language"><option class="group" value="group-scala">Scala</option><option class="group" value="group-java">Java</option></select>
</div>
<div id="overlay-search-container" class="nav-header-search">
<input id="overlay-search" type="search" class="search" placeholder="Search" />
</div>
</header>
<nav class="nav-toc">
<ul>
  <li><a href="../security/index.html" class="page">Security Announcements</a></li>
  <li><a href="../guide/index.html" class="page">Getting Started Guide</a></li>
  <li><a href="../general/index.html" class="page">General Concepts</a></li>
  <li><a href="../index-actors.html" class="page">Actors</a></li>
  <li><a href="../typed/index.html" class="page">Akka Typed</a>
  <ul>
    <li><a href="../typed/guide/index.html" class="page">Getting Started Guide</a></li>
    <li><a href="../typed/actors.html" class="page">Actors</a></li>
    <li><a href="../typed/dispatchers.html" class="page">Dispatchers</a></li>
    <li><a href="../typed/coexisting.html" class="page">Coexistence</a></li>
    <li><a href="../typed/actor-lifecycle.html" class="page">Actor lifecycle</a></li>
    <li><a href="../typed/interaction-patterns.html" class="page">Interaction Patterns</a></li>
    <li><a href="../typed/fault-tolerance.html" class="page">Fault Tolerance</a></li>
    <li><a href="../typed/actor-discovery.html" class="page">Actor discovery</a></li>
    <li><a href="../typed/routers.html" class="page">Routers</a></li>
    <li><a href="../typed/stash.html" class="page">Stash</a></li>
    <li><a href="../typed/stream.html" class="page">Streams</a></li>
    <li><a href="../typed/cluster.html" class="page">Cluster</a></li>
    <li><a href="../typed/distributed-data.html" class="page">Distributed Data</a></li>
    <li><a href="../typed/cluster-singleton.html" class="page">Cluster Singleton</a></li>
    <li><a href="../typed/cluster-sharding.html" class="page">Cluster Sharding</a></li>
    <li><a href="../typed/persistence.html#persistence" class="active page">Persistence</a>
    <ul>
      <li><a href="../typed/persistence.html#dependency" class="header">Dependency</a></li>
      <li><a href="../typed/persistence.html#introduction" class="header">Introduction</a></li>
      <li><a href="../typed/persistence.html#example" class="header">Example</a></li>
      <li><a href="../typed/persistence.html#cluster-sharding-and-persistence" class="header">Cluster Sharding and persistence</a></li>
      <li><a href="../typed/persistence.html#accessing-the-actorcontext" class="header">Accessing the ActorContext</a></li>
      <li><a href="../typed/persistence.html#changing-behavior" class="header">Changing Behavior</a></li>
      <li><a href="../typed/persistence.html#effects-and-side-effects" class="header">Effects and Side Effects</a></li>
      <li><a href="../typed/persistence.html#replies" class="header">Replies</a></li>
      <li><a href="../typed/persistence.html#serialization" class="header">Serialization</a></li>
      <li><a href="../typed/persistence.html#recovery" class="header">Recovery</a></li>
      <li><a href="../typed/persistence.html#tagging" class="header">Tagging</a></li>
      <li><a href="../typed/persistence.html#event-adapters" class="header">Event adapters</a></li>
      <li><a href="../typed/persistence.html#wrapping-persistent-behaviors" class="header">Wrapping Persistent Behaviors</a></li>
      <li><a href="../typed/persistence.html#journal-failures" class="header">Journal failures</a></li>
      <li><a href="../typed/persistence.html#journal-rejections" class="header">Journal rejections</a></li>
      <li><a href="../typed/persistence.html#stash" class="header">Stash</a></li>
      <li><a href="../typed/persistence-style.html" class="page">Persistence - coding style</a></li>
      <li><a href="../typed/persistence-snapshot.html" class="page">Persistence - snapshotting</a></li>
    </ul></li>
    <li><a href="../typed/fsm.html" class="page">Behaviors as Finite state machines</a></li>
    <li><a href="../typed/testing.html" class="page">Testing</a></li>
  </ul></li>
  <li><a href="../index-cluster.html" class="page">Clustering</a></li>
  <li><a href="../stream/index.html" class="page">Streams</a></li>
  <li><a href="../index-network.html" class="page">Networking</a></li>
  <li><a href="../discovery/index.html" class="page">Discovery</a></li>
  <li><a href="../coordination.html" class="page">Coordination</a></li>
  <li><a href="../index-futures.html" class="page">Futures and Agents</a></li>
  <li><a href="../index-utilities.html" class="page">Utilities</a></li>
  <li><a href="../common/other-modules.html" class="page">Other Akka modules</a></li>
  <li><a href="../howto.html" class="page">HowTo: Common Patterns</a></li>
  <li><a href="../project/index.html" class="page">Project Information</a></li>
  <li><a href="../additional/index.html" class="page">Additional Information</a></li>
</ul>
</nav>
</div>
</header>
<div class="site-content-wrapper">
<aside class="sticky-sidebar show-for-large">
<header class="nav-header sticky-sidebar-header">
<div class="nav-header-title">
<h1><a href="../index.html">Akka Documentation</a></h1>
</div>
<div class="nav-header-version">
Version 2.5.32
</div>
<div class="nav-header-groups">
<select class="supergroup" name="Language"><option class="group" value="group-scala">Scala</option><option class="group" value="group-java">Java</option></select>
</div>
<div class="nav-header-search">
<input id="search" type="search" class="search" placeholder="Search" />
</div>
</header>
<nav class="site-nav sticky-sidebar-contents">
<div class="nav-toc">
<ul>
  <li><a href="../security/index.html" class="page">Security Announcements</a></li>
  <li><a href="../guide/index.html" class="page">Getting Started Guide</a></li>
  <li><a href="../general/index.html" class="page">General Concepts</a></li>
  <li><a href="../index-actors.html" class="page">Actors</a></li>
  <li><a href="../typed/index.html" class="page">Akka Typed</a>
  <ul>
    <li><a href="../typed/guide/index.html" class="page">Getting Started Guide</a></li>
    <li><a href="../typed/actors.html" class="page">Actors</a></li>
    <li><a href="../typed/dispatchers.html" class="page">Dispatchers</a></li>
    <li><a href="../typed/coexisting.html" class="page">Coexistence</a></li>
    <li><a href="../typed/actor-lifecycle.html" class="page">Actor lifecycle</a></li>
    <li><a href="../typed/interaction-patterns.html" class="page">Interaction Patterns</a></li>
    <li><a href="../typed/fault-tolerance.html" class="page">Fault Tolerance</a></li>
    <li><a href="../typed/actor-discovery.html" class="page">Actor discovery</a></li>
    <li><a href="../typed/routers.html" class="page">Routers</a></li>
    <li><a href="../typed/stash.html" class="page">Stash</a></li>
    <li><a href="../typed/stream.html" class="page">Streams</a></li>
    <li><a href="../typed/cluster.html" class="page">Cluster</a></li>
    <li><a href="../typed/distributed-data.html" class="page">Distributed Data</a></li>
    <li><a href="../typed/cluster-singleton.html" class="page">Cluster Singleton</a></li>
    <li><a href="../typed/cluster-sharding.html" class="page">Cluster Sharding</a></li>
    <li><a href="../typed/persistence.html#persistence" class="active page">Persistence</a>
    <ul>
      <li><a href="../typed/persistence.html#dependency" class="header">Dependency</a></li>
      <li><a href="../typed/persistence.html#introduction" class="header">Introduction</a></li>
      <li><a href="../typed/persistence.html#example" class="header">Example</a></li>
      <li><a href="../typed/persistence.html#cluster-sharding-and-persistence" class="header">Cluster Sharding and persistence</a></li>
      <li><a href="../typed/persistence.html#accessing-the-actorcontext" class="header">Accessing the ActorContext</a></li>
      <li><a href="../typed/persistence.html#changing-behavior" class="header">Changing Behavior</a></li>
      <li><a href="../typed/persistence.html#effects-and-side-effects" class="header">Effects and Side Effects</a></li>
      <li><a href="../typed/persistence.html#replies" class="header">Replies</a></li>
      <li><a href="../typed/persistence.html#serialization" class="header">Serialization</a></li>
      <li><a href="../typed/persistence.html#recovery" class="header">Recovery</a></li>
      <li><a href="../typed/persistence.html#tagging" class="header">Tagging</a></li>
      <li><a href="../typed/persistence.html#event-adapters" class="header">Event adapters</a></li>
      <li><a href="../typed/persistence.html#wrapping-persistent-behaviors" class="header">Wrapping Persistent Behaviors</a></li>
      <li><a href="../typed/persistence.html#journal-failures" class="header">Journal failures</a></li>
      <li><a href="../typed/persistence.html#journal-rejections" class="header">Journal rejections</a></li>
      <li><a href="../typed/persistence.html#stash" class="header">Stash</a></li>
      <li><a href="../typed/persistence-style.html" class="page">Persistence - coding style</a></li>
      <li><a href="../typed/persistence-snapshot.html" class="page">Persistence - snapshotting</a></li>
    </ul></li>
    <li><a href="../typed/fsm.html" class="page">Behaviors as Finite state machines</a></li>
    <li><a href="../typed/testing.html" class="page">Testing</a></li>
  </ul></li>
  <li><a href="../index-cluster.html" class="page">Clustering</a></li>
  <li><a href="../stream/index.html" class="page">Streams</a></li>
  <li><a href="../index-network.html" class="page">Networking</a></li>
  <li><a href="../discovery/index.html" class="page">Discovery</a></li>
  <li><a href="../coordination.html" class="page">Coordination</a></li>
  <li><a href="../index-futures.html" class="page">Futures and Agents</a></li>
  <li><a href="../index-utilities.html" class="page">Utilities</a></li>
  <li><a href="../common/other-modules.html" class="page">Other Akka modules</a></li>
  <li><a href="../howto.html" class="page">HowTo: Common Patterns</a></li>
  <li><a href="../project/index.html" class="page">Project Information</a></li>
  <li><a href="../additional/index.html" class="page">Additional Information</a></li>
</ul>
</div>
</nav>
<footer class="nav-footer sticky-sidebar-footer">
<a href="https://akka.io"><img class="logo" src="../images/akka-logo-reverse.svg"/></a>

</footer>
</aside>
<main class="fixed-shift-for-large expanded row">
<section class="site-content small-12 column">
<article class="page-content row">
<div class="small-12 column" id="docs">
<h1><a href="#persistence" name="persistence" class="anchor"><span class="anchor-link"></span></a>Persistence</h1>
<h2><a href="#dependency" name="dependency" class="anchor"><span class="anchor-link"></span></a>Dependency</h2>
<p>To use Akka Persistence Typed, add the module to your project:</p><dl class="dependency"><dt>sbt</dt><dd><pre class="prettyprint"><code class="language-scala">libraryDependencies += "com.typesafe.akka" %% "akka-persistence-typed" % "2.5.32"</code></pre></dd><dt>Maven</dt><dd><pre class="prettyprint"><code class="language-xml">&lt;dependency&gt;
  &lt;groupId&gt;com.typesafe.akka&lt;/groupId&gt;
  &lt;artifactId&gt;akka-persistence-typed_2.12&lt;/artifactId&gt;
  &lt;version&gt;2.5.32&lt;/version&gt;
&lt;/dependency&gt;</code></pre></dd><dt>Gradle</dt><dd><pre class="prettyprint"><code class="language-gradle">dependencies {
  compile group: 'com.typesafe.akka', name: 'akka-persistence-typed_2.12', version: '2.5.32'
}</code></pre></dd></dl>
<h2><a href="#introduction" name="introduction" class="anchor"><span class="anchor-link"></span></a>Introduction</h2>
<p>Akka Persistence is a library for building event sourced actors. For background about how it works see the <a href="../persistence.html">untyped Akka Persistence section</a>. This documentation shows how the typed API for persistence works and assumes you know what is meant by <code>Command</code>, <code>Event</code> and <code>State</code>.</p><div class="callout note "><div class="callout-title">Note</div>
<p>This module is ready to be used in production, but it is still marked as <a href="../common/may-change.html">may change</a>. This means that API or semantics can change without warning or deprecation period, but such changes will be collected and be performed in Akka 2.6.0 rather than in 2.5.x patch releases.</p></div>
<h2><a href="#example" name="example" class="anchor"><span class="anchor-link"></span></a>Example</h2>
<p>Let&rsquo;s start with a simple example. The minimum required for a <code>EventSourcedBehavior</code> is:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/akka/tree/v2.5.32/akka-persistence-typed/src/test/scala/docs/akka/persistence/typed/BasicPersistentBehaviorCompileOnly.scala#L72-L81" target="_blank" title="Go to snippet source"></a><code class="language-scala">sealed trait Command
sealed trait Event
final case class State()

val behavior: Behavior[Command] =
  EventSourcedBehavior[Command, Event, State](
    persistenceId = PersistenceId(&quot;abc&quot;),
    emptyState = State(),
    commandHandler = (state, cmd) =&gt; throw new RuntimeException(&quot;TODO: process the command &amp; return an Effect&quot;),
    eventHandler = (state, evt) =&gt; throw new RuntimeException(&quot;TODO: process the event return the next state&quot;))</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/akka/tree/v2.5.32/akka-persistence-typed/src/test/java/jdocs/akka/persistence/typed/BasicPersistentBehaviorTest.java#L31-L66" target="_blank" title="Go to snippet source"></a><code class="language-java">public class MyPersistentBehavior
    extends EventSourcedBehavior&lt;
        MyPersistentBehavior.Command, MyPersistentBehavior.Event, MyPersistentBehavior.State&gt; {

  static EventSourcedBehavior&lt;Command, Event, State&gt; eventSourcedBehavior =
      new MyPersistentBehavior(new PersistenceId(&quot;pid&quot;));

  interface Command {}

  interface Event {}

  public static class State {}

  public MyPersistentBehavior(PersistenceId persistenceId) {
    super(persistenceId);
  }

  @Override
  public State emptyState() {
    return new State();
  }

  @Override
  public CommandHandler&lt;Command, Event, State&gt; commandHandler() {
    return (state, command) -&gt; {
      throw new RuntimeException(&quot;TODO: process the command &amp; return an Effect&quot;);
    };
  }

  @Override
  public EventHandler&lt;State, Event&gt; eventHandler() {
    return (state, event) -&gt; {
      throw new RuntimeException(&quot;TODO: process the event return the next state&quot;);
    };
  }
}</code></pre></dd>
</dl>
<p>The first important thing to notice is the <code>Behavior</code> of a persistent actor is typed to the type of the <code>Command</code> because this is the type of message a persistent actor should receive. In Akka Typed this is now enforced by the type system. The event and state are only used internally.</p>
<p>The components that make up a EventSourcedBehavior are:</p>
<ul>
  <li><code>persistenceId</code> is the stable unique identifier for the persistent actor.</li>
  <li><code>emptyState</code> defines the <code>State</code> when the entity is first created e.g. a Counter would start with 0 as state.</li>
  <li><code>commandHandler</code> defines how to handle command by producing Effects e.g. persisting events, stopping the persistent actor.</li>
  <li><code>eventHandler</code> returns the new state given the current state when an event has been persisted.</li>
</ul>
<p>Next we&rsquo;ll discuss each of these in detail.</p>
<h3><a href="#command-handler" name="command-handler" class="anchor"><span class="anchor-link"></span></a>Command handler</h3>
<p>The command handler is a function with 2 parameters, the current <code>State</code> and the incoming <code>Command</code>.</p>
<p>A command handler returns an <code>Effect</code> directive that defines what event or events, if any, to persist. Effects are created using <span class="group-java">a factory that is returned via the <code>Effect()</code> method</span> <span class="group-scala">the <code>Effect</code> factory</span> and can be one of: </p>
<ul>
  <li><code>persist</code> will persist one single event or several events atomically, i.e. all events  are stored or none of them are stored if there is an error</li>
  <li><code>none</code> no events are to be persisted, for example a read-only command</li>
  <li><code>unhandled</code> the command is unhandled (not supported) in current state</li>
  <li><code>stop</code> stop this actor</li>
</ul>
<p>In addition to returning the primary <code>Effect</code> for the command <code>EventSourcedBehavior</code>s can also chain side effects (<code>SideEffect</code>s) are to be performed after successful persist which is achieved with the <code>andThen</code> and <code>thenRun</code> function e.g <span class="group-scala"><code>Effect.persist(..).andThen</code></span><span class="group-java"><code>Effect().persist(..).andThen</code></span>. The <code>thenRun</code> function is a convenience around creating a <code>SideEffect</code>.</p>
<p>In the example below a reply is sent to the <code>replyTo</code> ActorRef. Note that the new state after applying the event is passed as parameter to the <code>thenRun</code> function. All <code>thenRun</code> registered callbacks are executed sequentially after successful execution of the persist statement (or immediately, in case of <code>none</code> and <code>unhandled</code>).</p>
<h3><a href="#event-handler" name="event-handler" class="anchor"><span class="anchor-link"></span></a>Event handler</h3>
<p>When an event has been persisted successfully the new state is created by applying the event to the current state with the <code>eventHandler</code>.</p>
<p>The state is typically defined as an immutable class and then the event handler returns a new instance of the state. You may choose to use a mutable class for the state, and then the event handler may update the state instance and return the same instance. Both immutable and mutable state is supported.</p>
<p>The same event handler is also used when the entity is started up to recover its state from the stored events.</p>
<p>The event handler should only update the state and never perform side effects, as those would also be executed during recovery of the persistent actor.</p>
<h3><a href="#completing-the-example" name="completing-the-example" class="anchor"><span class="anchor-link"></span></a>Completing the example</h3>
<p>Let&rsquo;s fill in the details of the example.</p>
<p>Command and event:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/akka/tree/v2.5.32/akka-persistence-typed/src/test/scala/docs/akka/persistence/typed/BasicPersistentBehaviorCompileOnly.scala#L27-L33" target="_blank" title="Go to snippet source"></a><code class="language-scala">sealed trait Command
final case class Add(data: String) extends Command
case object Clear extends Command

sealed trait Event
final case class Added(data: String) extends Event
case object Cleared extends Event</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/akka/tree/v2.5.32/akka-persistence-typed/src/test/java/jdocs/akka/persistence/typed/BasicPersistentBehaviorTest.java#L79-L105" target="_blank" title="Go to snippet source"></a><code class="language-java">interface Command {}

public static class Add implements Command {
  public final String data;

  public Add(String data) {
    this.data = data;
  }
}

public enum Clear implements Command {
  INSTANCE
}

interface Event {}

public static class Added implements Event {
  public final String data;

  public Added(String data) {
    this.data = data;
  }
}

public enum Cleared implements Event {
  INSTANCE
}</code></pre></dd>
</dl>
<p>State is a List containing the 5 latest items:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/akka/tree/v2.5.32/akka-persistence-typed/src/test/scala/docs/akka/persistence/typed/BasicPersistentBehaviorCompileOnly.scala#L37" target="_blank" title="Go to snippet source"></a><code class="language-scala">final case class State(history: List[String] = Nil)</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/akka/tree/v2.5.32/akka-persistence-typed/src/test/java/jdocs/akka/persistence/typed/BasicPersistentBehaviorTest.java#L109-L127" target="_blank" title="Go to snippet source"></a><code class="language-java">public static class State {
  private final List&lt;String&gt; items;

  private State(List&lt;String&gt; items) {
    this.items = items;
  }

  public State() {
    this.items = new ArrayList&lt;&gt;();
  }

  public State addItem(String data) {
    List&lt;String&gt; newItems = new ArrayList&lt;&gt;(items);
    newItems.add(0, data);
    // keep 5 items
    List&lt;String&gt; latest = newItems.subList(0, Math.min(4, newItems.size() - 1));
    return new State(latest);
  }
}</code></pre></dd>
</dl>
<p>The command handler persists the <code>Add</code> payload in an <code>Added</code> event:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/akka/tree/v2.5.32/akka-persistence-typed/src/test/scala/docs/akka/persistence/typed/BasicPersistentBehaviorCompileOnly.scala#L41-L48" target="_blank" title="Go to snippet source"></a><code class="language-scala">import akka.persistence.typed.scaladsl.Effect

val commandHandler: (State, Command) =&gt; Effect[Event, State] = { (state, command) =&gt;
  command match {
    case Add(data) =&gt; Effect.persist(Added(data))
    case Clear     =&gt; Effect.persist(Cleared)
  }
}</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/akka/tree/v2.5.32/akka-persistence-typed/src/test/java/jdocs/akka/persistence/typed/BasicPersistentBehaviorTest.java#L141-L148" target="_blank" title="Go to snippet source"></a><code class="language-java">@Override
public CommandHandler&lt;Command, Event, State&gt; commandHandler() {
  return newCommandHandlerBuilder()
      .forAnyState()
      .onCommand(Add.class, command -&gt; Effect().persist(new Added(command.data)))
      .onCommand(Clear.class, command -&gt; Effect().persist(Cleared.INSTANCE))
      .build();
}</code></pre></dd>
</dl>
<p>The event handler appends the item to the state and keeps 5 items. This is called after successfully persisting the event in the database:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/akka/tree/v2.5.32/akka-persistence-typed/src/test/scala/docs/akka/persistence/typed/BasicPersistentBehaviorCompileOnly.scala#L52-L57" target="_blank" title="Go to snippet source"></a><code class="language-scala">val eventHandler: (State, Event) =&gt; State = { (state, event) =&gt;
  event match {
    case Added(data) =&gt; state.copy((data :: state.history).take(5))
    case Cleared     =&gt; State(Nil)
  }
}</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/akka/tree/v2.5.32/akka-persistence-typed/src/test/java/jdocs/akka/persistence/typed/BasicPersistentBehaviorTest.java#L152-L159" target="_blank" title="Go to snippet source"></a><code class="language-java">@Override
public EventHandler&lt;State, Event&gt; eventHandler() {
  return newEventHandlerBuilder()
      .forAnyState()
      .onEvent(Added.class, (state, event) -&gt; state.addItem(event.data))
      .onEvent(Cleared.class, () -&gt; new State())
      .build();
}</code></pre></dd>
</dl>
<p><span class="group-scala">These are used to create a <code>EventSourcedBehavior</code>:</span> <span class="group-java">These are defined in an <code>EventSourcedBehavior</code>:</span></p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/akka/tree/v2.5.32/akka-persistence-typed/src/test/scala/docs/akka/persistence/typed/BasicPersistentBehaviorCompileOnly.scala#L61-L66" target="_blank" title="Go to snippet source"></a><code class="language-scala">def behavior(id: String): EventSourcedBehavior[Command, Event, State] =
  EventSourcedBehavior[Command, Event, State](
    persistenceId = PersistenceId(id),
    emptyState = State(Nil),
    commandHandler = commandHandler,
    eventHandler = eventHandler)</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/akka/tree/v2.5.32/akka-persistence-typed/src/test/java/jdocs/akka/persistence/typed/BasicPersistentBehaviorTest.java#L72-L161" target="_blank" title="Go to snippet source"></a><code class="language-java">public class MyPersistentBehavior
    extends EventSourcedBehavior&lt;
        MyPersistentBehavior.Command, MyPersistentBehavior.Event, MyPersistentBehavior.State&gt; {

  public MyPersistentBehavior(PersistenceId persistenceId) {
    super(persistenceId);
  }

  @Override
  public State emptyState() {
    return new State();
  }

  @Override
  public CommandHandler&lt;Command, Event, State&gt; commandHandler() {
    return newCommandHandlerBuilder()
        .forAnyState()
        .onCommand(Add.class, command -&gt; Effect().persist(new Added(command.data)))
        .onCommand(Clear.class, command -&gt; Effect().persist(Cleared.INSTANCE))
        .build();
  }

  @Override
  public EventHandler&lt;State, Event&gt; eventHandler() {
    return newEventHandlerBuilder()
        .forAnyState()
        .onEvent(Added.class, (state, event) -&gt; state.addItem(event.data))
        .onEvent(Cleared.class, () -&gt; new State())
        .build();
  }
}</code></pre></dd>
</dl>
<h2><a href="#cluster-sharding-and-persistence" name="cluster-sharding-and-persistence" class="anchor"><span class="anchor-link"></span></a>Cluster Sharding and persistence</h2>
<p>In a use case where the number of persistent actors needed are higher than what would fit in the memory of one node or where resilience is important so that if a node crashes the persistent actors are quickly started on a new node and can resume operations <a href="cluster-sharding.html">Cluster Sharding</a> is an excellent fit to spread persistent actors over a cluster and address them by id.</p>
<p>The <code>EventSourcedBehavior</code> can then be run as with any plain typed actor as described in <a href="actors.html">actors documentation</a>, but since Akka Persistence is based on the single-writer principle the persistent actors are typically used together with Cluster Sharding. For a particular <code>persistenceId</code> only one persistent actor instance should be active at one time. If multiple instances were to persist events at the same time, the events would be interleaved and might not be interpreted correctly on replay. Cluster Sharding ensures that there is only one active entity for each id. The <a href="cluster-sharding.html#persistence-example">Cluster Sharding example</a> illustrates this common combination.</p>
<h2><a href="#accessing-the-actorcontext" name="accessing-the-actorcontext" class="anchor"><span class="anchor-link"></span></a>Accessing the ActorContext</h2>
<p>If the persistent behavior needs to use the <code>ActorContext</code>, for example to spawn child actors, it can be obtained by wrapping construction with <code>Behaviors.setup</code>:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/akka/tree/v2.5.32/akka-persistence-typed/src/test/scala/docs/akka/persistence/typed/BasicPersistentBehaviorCompileOnly.scala#L132-L149" target="_blank" title="Go to snippet source"></a><code class="language-scala">import akka.persistence.typed.scaladsl.Effect
import akka.persistence.typed.scaladsl.EventSourcedBehavior.CommandHandler

val behaviorWithContext: Behavior[String] =
  Behaviors.setup { context =&gt;
    EventSourcedBehavior[String, String, State](
      persistenceId = PersistenceId(&quot;myPersistenceId&quot;),
      emptyState = new State,
      commandHandler = CommandHandler.command { cmd =&gt;
        context.log.info(&quot;Got command {}&quot;, cmd)
        Effect.persist(cmd).thenRun { state =&gt;
          context.log.info(&quot;event persisted, new state {}&quot;, state)
        }
      },
      eventHandler = {
        case (state, _) =&gt; state
      })
  }</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/akka/tree/v2.5.32/akka-persistence-typed/src/test/java/jdocs/akka/persistence/typed/BasicPersistentBehaviorTest.java#L332-L362" target="_blank" title="Go to snippet source"></a><code class="language-java">public class MyPersistentBehavior extends EventSourcedBehavior&lt;Command, Event, State&gt; {

  public static Behavior&lt;Command&gt; behavior(PersistenceId persistenceId) {
    return Behaviors.setup(ctx -&gt; new MyPersistentBehavior(persistenceId, ctx));
  }

  // this makes the context available to the command handler etc.
  private final ActorContext&lt;Command&gt; ctx;

  public MyPersistentBehavior(PersistenceId persistenceId, ActorContext&lt;Command&gt; ctx) {
    super(persistenceId);
    this.ctx = ctx;
  }

}</code></pre></dd>
</dl>
<h2><a href="#changing-behavior" name="changing-behavior" class="anchor"><span class="anchor-link"></span></a>Changing Behavior</h2>
<p>After processing a message, plain typed actors are able to return the <code>Behavior</code> that is used for next message.</p>
<p>As you can see in the above examples this is not supported by typed persistent actors. Instead, the state is returned by <code>eventHandler</code>. The reason a new behavior can&rsquo;t be returned is that behavior is part of the actor&rsquo;s state and must also carefully be reconstructed during recovery. If it would have been supported it would mean that the behavior must be restored when replaying events and also encoded in the state anyway when snapshots are used. That would be very prone to mistakes and thus not allowed in Typed Persistence.</p>
<p>For basic actors you can use the same set of command handlers independent of what state the entity is in, as shown in above example. For more complex actors it&rsquo;s useful to be able to change the behavior in the sense that different functions for processing commands may be defined depending on what state the actor is in. This is useful when implementing finite state machine (FSM) like entities.</p>
<p>The next example shows how to define different behavior based on the current <code>State</code>. It is an actor that represents the state of a blog post. Before a post is started the only command it can process is to <code>AddPost</code>. Once it is started then it we can look it up with <code>GetPost</code>, modify it with <code>ChangeBody</code> or publish it with <code>Publish</code>.</p>
<p>The state is captured by:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/akka/tree/v2.5.32/akka-persistence-typed/src/test/scala/docs/akka/persistence/typed/BlogPostExample.scala#L25-L38" target="_blank" title="Go to snippet source"></a><code class="language-scala">sealed trait BlogState

case object BlankState extends BlogState

final case class DraftState(content: PostContent) extends BlogState {
  def withBody(newBody: String): DraftState =
    copy(content = content.copy(body = newBody))

  def postId: String = content.postId
}

final case class PublishedState(content: PostContent) extends BlogState {
  def postId: String = content.postId
}</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/akka/tree/v2.5.32/akka-persistence-typed/src/test/java/jdocs/akka/persistence/typed/BlogPostExample.java#L49-L93" target="_blank" title="Go to snippet source"></a><code class="language-java">interface BlogState {}

public enum BlankState implements BlogState {
  INSTANCE
}

public class DraftState implements BlogState {
  final PostContent content;

  DraftState(PostContent content) {
    this.content = content;
  }

  public DraftState withContent(PostContent newContent) {
    return new DraftState(newContent);
  }

  public DraftState withBody(String newBody) {
    return withContent(new PostContent(postId(), content.title, newBody));
  }

  public String postId() {
    return content.postId;
  }
}

public class PublishedState implements BlogState {
  final PostContent content;

  PublishedState(PostContent content) {
    this.content = content;
  }

  public PublishedState withContent(PostContent newContent) {
    return new PublishedState(newContent);
  }

  public PublishedState withBody(String newBody) {
    return withContent(new PostContent(postId(), content.title, newBody));
  }

  public String postId() {
    return content.postId;
  }
}</code></pre></dd>
</dl>
<p>The commands, of which only a subset are valid depending on the state:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/akka/tree/v2.5.32/akka-persistence-typed/src/test/scala/docs/akka/persistence/typed/BlogPostExample.scala#L42-L50" target="_blank" title="Go to snippet source"></a><code class="language-scala">sealed trait BlogCommand
final case class AddPost(content: PostContent, replyTo: ActorRef[AddPostDone]) extends BlogCommand
final case class AddPostDone(postId: String)
final case class GetPost(replyTo: ActorRef[PostContent]) extends BlogCommand
final case class ChangeBody(newBody: String, replyTo: ActorRef[Done]) extends BlogCommand
final case class Publish(replyTo: ActorRef[Done]) extends BlogCommand
final case class PostContent(postId: String, title: String, body: String)</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/akka/tree/v2.5.32/akka-persistence-typed/src/test/java/jdocs/akka/persistence/typed/BlogPostExample.java#L97-L153" target="_blank" title="Go to snippet source"></a><code class="language-java">public interface BlogCommand {}
public class AddPost implements BlogCommand {
  final PostContent content;
  final ActorRef&lt;AddPostDone&gt; replyTo;

  public AddPost(PostContent content, ActorRef&lt;AddPostDone&gt; replyTo) {
    this.content = content;
    this.replyTo = replyTo;
  }
}

public class AddPostDone implements BlogCommand {
  final String postId;

  public AddPostDone(String postId) {
    this.postId = postId;
  }
}
public class GetPost implements BlogCommand {
  final ActorRef&lt;PostContent&gt; replyTo;

  public GetPost(ActorRef&lt;PostContent&gt; replyTo) {
    this.replyTo = replyTo;
  }
}

public class ChangeBody implements BlogCommand {
  final String newBody;
  final ActorRef&lt;Done&gt; replyTo;

  public ChangeBody(String newBody, ActorRef&lt;Done&gt; replyTo) {
    this.newBody = newBody;
    this.replyTo = replyTo;
  }
}

public class Publish implements BlogCommand {
  final ActorRef&lt;Done&gt; replyTo;

  public Publish(ActorRef&lt;Done&gt; replyTo) {
    this.replyTo = replyTo;
  }
}

public class PostContent implements BlogCommand {
  final String postId;
  final String title;
  final String body;

  public PostContent(String postId, String title, String body) {
    this.postId = postId;
    this.title = title;
    this.body = body;
  }
}</code></pre></dd>
</dl>
<p><span class="group-java">The commandler handler to process each command is decided by the state class (or state predicate) that is given to the <code>forStateType</code> of the <code>CommandHandlerBuilder</code> and the match cases in the builders.</span> <span class="group-scala">The command handler to process each command is decided by first looking at the state and then the command. It typically becomes two levels of pattern matching, first on the state and then on the command.</span> Delegating to methods is a good practice because the one-line cases give a nice overview of the message dispatch.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/akka/tree/v2.5.32/akka-persistence-typed/src/test/scala/docs/akka/persistence/typed/BlogPostExample.scala#L63-L120" target="_blank" title="Go to snippet source"></a><code class="language-scala">private val commandHandler: (BlogState, BlogCommand) =&gt; Effect[BlogEvent, BlogState] = { (state, command) =&gt;
  state match {

    case BlankState =&gt;
      command match {
        case cmd: AddPost =&gt; addPost(cmd)
        case _            =&gt; Effect.unhandled
      }

    case draftState: DraftState =&gt;
      command match {
        case cmd: ChangeBody  =&gt; changeBody(draftState, cmd)
        case Publish(replyTo) =&gt; publish(draftState, replyTo)
        case GetPost(replyTo) =&gt; getPost(draftState, replyTo)
        case _: AddPost       =&gt; Effect.unhandled
      }

    case publishedState: PublishedState =&gt;
      command match {
        case GetPost(replyTo) =&gt; getPost(publishedState, replyTo)
        case _                =&gt; Effect.unhandled
      }
  }
}

private def addPost(cmd: AddPost): Effect[BlogEvent, BlogState] = {
  val evt = PostAdded(cmd.content.postId, cmd.content)
  Effect.persist(evt).thenRun { _ =&gt;
    // After persist is done additional side effects can be performed
    cmd.replyTo ! AddPostDone(cmd.content.postId)
  }
}

private def changeBody(state: DraftState, cmd: ChangeBody): Effect[BlogEvent, BlogState] = {
  val evt = BodyChanged(state.postId, cmd.newBody)
  Effect.persist(evt).thenRun { _ =&gt;
    cmd.replyTo ! Done
  }
}

private def publish(state: DraftState, replyTo: ActorRef[Done]): Effect[BlogEvent, BlogState] = {
  Effect.persist(Published(state.postId)).thenRun { _ =&gt;
    println(s&quot;Blog post ${state.postId} was published&quot;)
    replyTo ! Done
  }
}

private def getPost(state: DraftState, replyTo: ActorRef[PostContent]): Effect[BlogEvent, BlogState] = {
  replyTo ! state.content
  Effect.none
}

private def getPost(state: PublishedState, replyTo: ActorRef[PostContent]): Effect[BlogEvent, BlogState] = {
  replyTo ! state.content
  Effect.none
}</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/akka/tree/v2.5.32/akka-persistence-typed/src/test/java/jdocs/akka/persistence/typed/BlogPostExample.java#L166-L225" target="_blank" title="Go to snippet source"></a><code class="language-java">@Override
public CommandHandler&lt;BlogCommand, BlogEvent, BlogState&gt; commandHandler() {
  CommandHandlerBuilder&lt;BlogCommand, BlogEvent, BlogState&gt; builder = newCommandHandlerBuilder();

  builder.forStateType(BlankState.class).onCommand(AddPost.class, this::addPost);

  builder
      .forStateType(DraftState.class)
      .onCommand(ChangeBody.class, this::changeBody)
      .onCommand(Publish.class, this::publish)
      .onCommand(GetPost.class, this::getPost);

  builder
      .forStateType(PublishedState.class)
      .onCommand(ChangeBody.class, this::changeBody)
      .onCommand(GetPost.class, this::getPost);

  builder.forAnyState().onCommand(AddPost.class, (state, cmd) -&gt; Effect().unhandled());

  return builder.build();
}

private Effect&lt;BlogEvent, BlogState&gt; addPost(AddPost cmd) {
  PostAdded event = new PostAdded(cmd.content.postId, cmd.content);
  return Effect()
      .persist(event)
      .thenRun(() -&gt; cmd.replyTo.tell(new AddPostDone(cmd.content.postId)));
}

private Effect&lt;BlogEvent, BlogState&gt; changeBody(DraftState state, ChangeBody cmd) {
  BodyChanged event = new BodyChanged(state.postId(), cmd.newBody);
  return Effect().persist(event).thenRun(() -&gt; cmd.replyTo.tell(Done.getInstance()));
}

private Effect&lt;BlogEvent, BlogState&gt; changeBody(PublishedState state, ChangeBody cmd) {
  BodyChanged event = new BodyChanged(state.postId(), cmd.newBody);
  return Effect().persist(event).thenRun(() -&gt; cmd.replyTo.tell(Done.getInstance()));
}

private Effect&lt;BlogEvent, BlogState&gt; publish(DraftState state, Publish cmd) {
  return Effect()
      .persist(new Published(state.postId()))
      .thenRun(
          () -&gt; {
            System.out.println(&quot;Blog post published: &quot; + state.postId());
            cmd.replyTo.tell(Done.getInstance());
          });
}

private Effect&lt;BlogEvent, BlogState&gt; getPost(DraftState state, GetPost cmd) {
  cmd.replyTo.tell(state.content);
  return Effect().none();
}

private Effect&lt;BlogEvent, BlogState&gt; getPost(PublishedState state, GetPost cmd) {
  cmd.replyTo.tell(state.content);
  return Effect().none();
}</code></pre></dd>
</dl>
<p>The event handler:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/akka/tree/v2.5.32/akka-persistence-typed/src/test/scala/docs/akka/persistence/typed/BlogPostExample.scala#L124-L150" target="_blank" title="Go to snippet source"></a><code class="language-scala">private val eventHandler: (BlogState, BlogEvent) =&gt; BlogState = { (state, event) =&gt;
  state match {

    case BlankState =&gt;
      event match {
        case PostAdded(_, content) =&gt;
          DraftState(content)
        case _ =&gt; throw new IllegalStateException(s&quot;unexpected event [$event] in state [$state]&quot;)
      }

    case draftState: DraftState =&gt;
      event match {

        case BodyChanged(_, newBody) =&gt;
          draftState.withBody(newBody)

        case Published(_) =&gt;
          PublishedState(draftState.content)

        case _ =&gt; throw new IllegalStateException(s&quot;unexpected event [$event] in state [$state]&quot;)
      }

    case _: PublishedState =&gt;
      // no more changes after published
      throw new IllegalStateException(s&quot;unexpected event [$event] in state [$state]&quot;)
  }
}</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/akka/tree/v2.5.32/akka-persistence-typed/src/test/java/jdocs/akka/persistence/typed/BlogPostExample.java#L229-L248" target="_blank" title="Go to snippet source"></a><code class="language-java">@Override
public EventHandler&lt;BlogState, BlogEvent&gt; eventHandler() {

  EventHandlerBuilder&lt;BlogState, BlogEvent&gt; builder = newEventHandlerBuilder();

  builder
      .forStateType(BlankState.class)
      .onEvent(PostAdded.class, event -&gt; new DraftState(event.content));

  builder
      .forStateType(DraftState.class)
      .onEvent(BodyChanged.class, (state, chg) -&gt; state.withBody(chg.newBody))
      .onEvent(Published.class, (state, event) -&gt; new PublishedState(state.content));

  builder
      .forStateType(PublishedState.class)
      .onEvent(BodyChanged.class, (state, chg) -&gt; state.withBody(chg.newBody));

  return builder.build();
}</code></pre></dd>
</dl>
<p>And finally the behavior is created <span class="group-scala">from the <code>EventSourcedBehavior.apply</code></span>:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/akka/tree/v2.5.32/akka-persistence-typed/src/test/scala/docs/akka/persistence/typed/BlogPostExample.scala#L54-L59" target="_blank" title="Go to snippet source"></a><code class="language-scala">def behavior(entityId: String): Behavior[BlogCommand] =
  EventSourcedBehavior[BlogCommand, BlogEvent, BlogState](
    persistenceId = PersistenceId(s&quot;Blog-$entityId&quot;),
    emptyState = BlankState,
    commandHandler,
    eventHandler)</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/akka/tree/v2.5.32/akka-persistence-typed/src/test/java/jdocs/akka/persistence/typed/BlogPostExample.java#L157-L262" target="_blank" title="Go to snippet source"></a><code class="language-java">public class BlogBehavior extends EventSourcedBehavior&lt;BlogCommand, BlogEvent, BlogState&gt; {

  public BlogBehavior(PersistenceId persistenceId) {
    super(persistenceId);
  }

  public static Behavior&lt;BlogCommand&gt; behavior(String entityId) {
    return Behaviors.setup(ctx -&gt; new BlogBehavior(new PersistenceId(&quot;Blog-&quot; + entityId)));
  }

  @Override
  public BlogState emptyState() {
    return BlankState.INSTANCE;
  }

  // commandHandler, eventHandler as in above snippets
}</code></pre></dd>
</dl>
<p>This can be taken one or two steps further by defining the event and command handlers in the state class as illustrated in <a href="persistence-style.html#event-handlers-in-the-state">event handlers in the state</a> and <a href="persistence-style.html#command-handlers-in-the-state">command handlers in the state</a>.</p>
<p>There is also an example illustrating an <a href="persistence-style.html#optional-initial-state">optional initial state</a>.</p>
<h2><a href="#effects-and-side-effects" name="effects-and-side-effects" class="anchor"><span class="anchor-link"></span></a>Effects and Side Effects</h2>
<p>Each command has a single <code>Effect</code> which can be:</p>
<ul>
  <li>Persist events</li>
  <li>None: Accept the command but no effects</li>
  <li>Unhandled: Don&rsquo;t handle this command</li>
  <li>Stash: the current command is placed in a buffer and can be unstashed and processed later</li>
</ul>
<p>Note that there is only one of these. It is not possible to both persist and say none/unhandled. These are created using <span class="group-java">a factory that is returned via the <code>Effect()</code> method</span> <span class="group-scala">the <code>Effect</code> factory</span> and once created additional <code>SideEffects</code> can be added.</p>
<p>Most of them time this will be done with the <code>thenRun</code> method on the <code>Effect</code> above. You can factor out common side effects into functions and reuse for several commands. For example:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/akka/tree/v2.5.32/akka-persistence-typed/src/test/scala/akka/persistence/typed/scaladsl/PersistentActorCompileOnlyTest.scala#L321-L326" target="_blank" title="Go to snippet source"></a><code class="language-scala">// Example factoring out a chained effect to use in several places with `thenRun`
val commonChainedEffects: Mood =&gt; Unit = _ =&gt; println(&quot;Command processed&quot;)
// Then in a command handler:
Effect
  .persist(Remembered(&quot;Yep&quot;)) // persist event
  .thenRun(commonChainedEffects) // add on common chained effect</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/akka/tree/v2.5.32/akka-persistence-typed/src/test/java/akka/persistence/typed/javadsl/PersistentActorCompileOnlyTest.java#L184-L211" target="_blank" title="Go to snippet source"></a><code class="language-java">// Example factoring out a chained effect to use in several places with `thenRun`
static final Procedure&lt;ExampleState&gt; commonChainedEffect =
    state -&gt; System.out.println(&quot;Command handled!&quot;);

        return newCommandHandlerBuilder()
            .forStateType(ExampleState.class)
            .onCommand(
                Cmd.class,
                (state, cmd) -&gt;
                    Effect()
                        .persist(new Evt(cmd.data))
                        .thenRun(() -&gt; cmd.sender.tell(new Ack()))
                        .thenRun(commonChainedEffect))
            .build();</code></pre></dd>
</dl>
<h3><a href="#side-effects-ordering-and-guarantees" name="side-effects-ordering-and-guarantees" class="anchor"><span class="anchor-link"></span></a>Side effects ordering and guarantees</h3>
<p>Any <code>SideEffect</code>s are executed on an at-once basis and will not be executed if the persist fails. The <code>SideEffect</code>s are executed sequentially, it is not possible to execute <code>SideEffect</code>s in parallel.</p>
<h2><a href="#replies" name="replies" class="anchor"><span class="anchor-link"></span></a>Replies</h2>
<p>The <a href="interaction-patterns.html#request-response">Request-Response interaction pattern</a> is very common for persistent actors, because you typically want to know if the command was rejected due to validation errors and when accepted you want a confirmation when the events have been successfully stored.</p>
<p>Therefore you typically include a <span class="group-scala"><code>ActorRef[ReplyMessageType]</code></span><span class="group-java"><code>ActorRef&lt;ReplyMessageType&gt;</code></span> in the commands. After validation errors or after persisting events, using a <code>thenRun</code> side effect, the reply message can be sent to the <code>ActorRef</code>.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/akka/tree/v2.5.32/akka-persistence-typed/src/test/scala/docs/akka/persistence/typed/BlogPostExample.scala#L44-L45" target="_blank" title="Go to snippet source"></a><code class="language-scala">final case class AddPost(content: PostContent, replyTo: ActorRef[AddPostDone]) extends BlogCommand
final case class AddPostDone(postId: String)</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/akka/tree/v2.5.32/akka-persistence-typed/src/test/java/jdocs/akka/persistence/typed/BlogPostExample.java#L99-L115" target="_blank" title="Go to snippet source"></a><code class="language-java">public class AddPost implements BlogCommand {
  final PostContent content;
  final ActorRef&lt;AddPostDone&gt; replyTo;

  public AddPost(PostContent content, ActorRef&lt;AddPostDone&gt; replyTo) {
    this.content = content;
    this.replyTo = replyTo;
  }
}

public class AddPostDone implements BlogCommand {
  final String postId;

  public AddPostDone(String postId) {
    this.postId = postId;
  }
}</code></pre></dd>
</dl>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/akka/tree/v2.5.32/akka-persistence-typed/src/test/scala/docs/akka/persistence/typed/BlogPostExample.scala#L90-L94" target="_blank" title="Go to snippet source"></a><code class="language-scala">val evt = PostAdded(cmd.content.postId, cmd.content)
Effect.persist(evt).thenRun { _ =&gt;
  // After persist is done additional side effects can be performed
  cmd.replyTo ! AddPostDone(cmd.content.postId)
}</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/akka/tree/v2.5.32/akka-persistence-typed/src/test/java/jdocs/akka/persistence/typed/BlogPostExample.java#L190-L193" target="_blank" title="Go to snippet source"></a><code class="language-java">PostAdded event = new PostAdded(cmd.content.postId, cmd.content);
return Effect()
    .persist(event)
    .thenRun(() -&gt; cmd.replyTo.tell(new AddPostDone(cmd.content.postId)));</code></pre></dd>
</dl>
<p>Since this is such a common pattern there is a reply effect for this purpose. It has the nice property that it can be used to enforce that replies are not forgotten when implementing the <code>EventSourcedBehavior</code>. If it&rsquo;s defined with <span class="group-scala"><code>EventSourcedBehavior.withEnforcedReplies</code></span><span class="group-java"><code>EventSourcedBehaviorWithEnforcedReplies</code></span> there will be compilation errors if the returned effect isn&rsquo;t a <code>ReplyEffect</code>, which can be created with <span class="group-scala"><code>Effect.reply</code></span><span class="group-java"><code>Effects().reply</code></span>, <span class="group-scala"><code>Effect.noReply</code></span><span class="group-java"><code>Effects().noReply</code></span>, <span class="group-scala"><code>Effect.thenReply</code></span><span class="group-java"><code>Effects().thenReply</code></span>, or <span class="group-scala"><code>Effect.thenNoReply</code></span><span class="group-java"><code>Effects().thenNoReply</code></span>.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/akka/tree/v2.5.32/akka-persistence-typed/src/test/scala/docs/akka/persistence/typed/AccountExampleWithEventHandlersInState.scala#L97-L103" target="_blank" title="Go to snippet source"></a><code class="language-scala">def behavior(accountNumber: String): Behavior[AccountCommand[AccountCommandReply]] = {
  EventSourcedBehavior.withEnforcedReplies(
    PersistenceId(s&quot;Account|$accountNumber&quot;),
    EmptyAccount,
    commandHandler,
    eventHandler)
}</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/akka/tree/v2.5.32/akka-persistence-typed/src/test/java/jdocs/akka/persistence/typed/AccountExampleWithEventHandlersInState.java#L32-L34" target="_blank" title="Go to snippet source"></a><code class="language-java">public class AccountEntity
    extends EventSourcedBehaviorWithEnforcedReplies&lt;
        AccountEntity.AccountCommand, AccountEntity.AccountEvent, AccountEntity.Account&gt; {</code></pre></dd>
</dl>
<p>The commands must implement <code>ExpectingReply</code> to include the <span class="group-scala"><code>ActorRef[ReplyMessageType]</code></span><span class="group-java"><code>ActorRef&lt;ReplyMessageType&gt;</code></span> in a standardized way.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/akka/tree/v2.5.32/akka-persistence-typed/src/test/scala/docs/akka/persistence/typed/AccountExampleWithEventHandlersInState.scala#L29-L48" target="_blank" title="Go to snippet source"></a><code class="language-scala">sealed trait AccountCommand[Reply] extends ExpectingReply[Reply]
final case class Withdraw(amount: BigDecimal)(override val replyTo: ActorRef[OperationResult])
    extends AccountCommand[OperationResult]
sealed trait AccountCommandReply
sealed trait OperationResult extends AccountCommandReply
case object Confirmed extends OperationResult
final case class Rejected(reason: String) extends OperationResult</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/akka/tree/v2.5.32/akka-persistence-typed/src/test/java/jdocs/akka/persistence/typed/AccountExampleWithEventHandlersInState.java#L39-L127" target="_blank" title="Go to snippet source"></a><code class="language-java">interface AccountCommand&lt;Reply&gt; extends ExpectingReply&lt;Reply&gt; {}
interface AccountCommandReply {}

interface OperationResult extends AccountCommandReply {}

enum Confirmed implements OperationResult {
  INSTANCE
}

public static class Rejected implements OperationResult {
  public final String reason;

  public Rejected(String reason) {
    this.reason = reason;
  }
}</code></pre></dd>
</dl>
<p>The <code>ReplyEffect</code> is created with <span class="group-scala"><code>Effect.reply</code></span><span class="group-java"><code>Effects().reply</code></span>, <span class="group-scala"><code>Effect.noReply</code></span><span class="group-java"><code>Effects().noReply</code></span>, <span class="group-scala"><code>Effect.thenReply</code></span><span class="group-java"><code>Effects().thenReply</code></span>, or <span class="group-scala"><code>Effect.thenNoReply</code></span><span class="group-java"><code>Effects().thenNoReply</code></span>.</p>
<p><span class="group-java">Note that command handlers are defined with <code>newCommandHandlerWithReplyBuilder</code> when using <code>EventSourcedBehaviorWithEnforcedReplies</code></span>, as opposed to newCommandHandlerBuilder when using <code>EventSourcedBehavior</code>.]</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/akka/tree/v2.5.32/akka-persistence-typed/src/test/scala/docs/akka/persistence/typed/AccountExampleWithEventHandlersInState.scala#L150-L157" target="_blank" title="Go to snippet source"></a><code class="language-scala">private def withdraw(acc: OpenedAccount, cmd: Withdraw): ReplyEffect[AccountEvent, Account] = {
  if (acc.canWithdraw(cmd.amount)) {
    Effect.persist(Withdrawn(cmd.amount)).thenReply(cmd)(_ =&gt; Confirmed)

  } else {
    Effect.reply(cmd)(Rejected(s&quot;Insufficient balance ${acc.balance} to be able to withdraw ${cmd.amount}&quot;))
  }
}</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/akka/tree/v2.5.32/akka-persistence-typed/src/test/java/jdocs/akka/persistence/typed/AccountExampleWithEventHandlersInState.java#L246-L255" target="_blank" title="Go to snippet source"></a><code class="language-java">private ReplyEffect&lt;AccountEvent, Account&gt; withdraw(OpenedAccount account, Withdraw command) {
  if (!account.canWithdraw(command.amount)) {
    return Effect()
        .reply(command, new Rejected(&quot;not enough funds to withdraw &quot; + command.amount));
  } else {
    return Effect()
        .persist(new Withdrawn(command.amount))
        .thenReply(command, account2 -&gt; Confirmed.INSTANCE);
  }
}</code></pre></dd>
</dl>
<p>These effects will send the reply message even when <span class="group-scala"><code>EventSourcedBehavior.withEnforcedReplies</code></span><span class="group-java"><code>EventSourcedBehaviorWithEnforcedReplies</code></span> is not used, but then there will be no compilation errors if the reply decision is left out.</p>
<p>Note that the <code>noReply</code> is a way of making conscious decision that a reply shouldn&rsquo;t be sent for a specific command or the reply will be sent later, perhaps after some asynchronous interaction with other actors or services.</p>
<h2><a href="#serialization" name="serialization" class="anchor"><span class="anchor-link"></span></a>Serialization</h2>
<p>The same <a href="../serialization.html">serialization</a> mechanism as for untyped actors is also used in Akka Typed, also for persistent actors. When picking serialization solution for the events you should also consider that it must be possible read old events when the application has evolved. Strategies for that can be found in the <a href="../persistence-schema-evolution.html">schema evolution</a>.</p>
<h2><a href="#recovery" name="recovery" class="anchor"><span class="anchor-link"></span></a>Recovery</h2>
<p>It is strongly discouraged to perform side effects in <code>applyEvent</code>, so side effects should be performed once recovery has completed as a reaction to the <code>RecoveryCompleted</code> signal <span class="group-scala"><code>receiveSignal</code> handler</span> <span class="group-java">by overriding <code>receiveSignal</code></span></p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/akka/tree/v2.5.32/akka-persistence-typed/src/test/scala/docs/akka/persistence/typed/BasicPersistentBehaviorCompileOnly.scala#L85-L94" target="_blank" title="Go to snippet source"></a><code class="language-scala">val recoveryBehavior: Behavior[Command] =
  EventSourcedBehavior[Command, Event, State](
    persistenceId = PersistenceId(&quot;abc&quot;),
    emptyState = State(),
    commandHandler = (state, cmd) =&gt; throw new RuntimeException(&quot;TODO: process the command &amp; return an Effect&quot;),
    eventHandler = (state, evt) =&gt; throw new RuntimeException(&quot;TODO: process the event return the next state&quot;))
    .receiveSignal {
      case (state, RecoveryCompleted) =&gt;
        throw new RuntimeException(&quot;TODO: add some end-of-recovery side-effect here&quot;)
    }</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/akka/tree/v2.5.32/akka-persistence-typed/src/test/java/jdocs/akka/persistence/typed/BasicPersistentBehaviorTest.java#L203-L213" target="_blank" title="Go to snippet source"></a><code class="language-java"><br/>@Override
public SignalHandler signalHandler() {
  return newSignalHandlerBuilder()
      .onSignal(
          RecoveryCompleted.instance(),
          state -&gt; {
            throw new RuntimeException(&quot;TODO: add some end-of-recovery side-effect here&quot;);
          })
      .build();
}</code></pre></dd>
</dl>
<p>The <code>RecoveryCompleted</code> contains the current <code>State</code>.</p>
<p>@ref[Snapshots)[persistence-snapshot.md] can be used for optimizing recovery times.</p>
<h2><a href="#tagging" name="tagging" class="anchor"><span class="anchor-link"></span></a>Tagging</h2>
<p>Persistence typed allows you to use event tags without using <a href="../persistence.html#event-adapters"><code>EventAdapter</code></a>:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/akka/tree/v2.5.32/akka-persistence-typed/src/test/scala/docs/akka/persistence/typed/BasicPersistentBehaviorCompileOnly.scala#L98-L104" target="_blank" title="Go to snippet source"></a><code class="language-scala">val taggingBehavior: Behavior[Command] =
  EventSourcedBehavior[Command, Event, State](
    persistenceId = PersistenceId(&quot;abc&quot;),
    emptyState = State(),
    commandHandler = (state, cmd) =&gt; throw new RuntimeException(&quot;TODO: process the command &amp; return an Effect&quot;),
    eventHandler = (state, evt) =&gt; throw new RuntimeException(&quot;TODO: process the event return the next state&quot;))
    .withTagger(_ =&gt; Set(&quot;tag1&quot;, &quot;tag2&quot;))</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/akka/tree/v2.5.32/akka-persistence-typed/src/test/java/jdocs/akka/persistence/typed/BasicPersistentBehaviorTest.java#L217-L220" target="_blank" title="Go to snippet source"></a><code class="language-java">@Override
public Set&lt;String&gt; tagsFor(Event event) {
  throw new RuntimeException(&quot;TODO: inspect the event and return any tags it should have&quot;);
}</code></pre></dd>
</dl>
<h2><a href="#event-adapters" name="event-adapters" class="anchor"><span class="anchor-link"></span></a>Event adapters</h2>
<p>Event adapters can be programmatically added to your <code>EventSourcedBehavior</code>s that can convert from your <code>Event</code> type to another type that is then passed to the journal.</p>
<p>Defining an event adapter is done by extending an EventAdapter:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/akka/tree/v2.5.32/akka-persistence-typed/src/test/scala/akka/persistence/typed/scaladsl/EventSourcedBehaviorSpec.scala#L55-L59" target="_blank" title="Go to snippet source"></a><code class="language-scala">case class Wrapper[T](t: T)
class WrapperEventAdapter[T] extends EventAdapter[T, Wrapper[T]] {
  override def toJournal(e: T): Wrapper[T] = Wrapper(e)
  override def fromJournal(p: Wrapper[T]): T = p.t
}</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/akka/tree/v2.5.32/akka-persistence-typed/src/test/java/akka/persistence/typed/javadsl/PersistentActorCompileOnlyTest.java#L29-L52" target="_blank" title="Go to snippet source"></a><code class="language-java">public static class Wrapper&lt;T&gt; {
  private final T t;

  public Wrapper(T t) {
    this.t = t;
  }

  public T getT() {
    return t;
  }
}

public static class EventAdapterExample
    extends EventAdapter&lt;SimpleEvent, Wrapper&lt;SimpleEvent&gt;&gt; {
  @Override
  public Wrapper&lt;SimpleEvent&gt; toJournal(SimpleEvent simpleEvent) {
    return new Wrapper&lt;&gt;(simpleEvent);
  }

  @Override
  public SimpleEvent fromJournal(Wrapper&lt;SimpleEvent&gt; simpleEventWrapper) {
    return simpleEventWrapper.getT();
  }
}</code></pre></dd>
</dl>
<p>Then install it on a persistent behavior:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/akka/tree/v2.5.32/akka-persistence-typed/src/test/scala/akka/persistence/typed/scaladsl/EventSourcedBehaviorSpec.scala#L493" target="_blank" title="Go to snippet source"></a><code class="language-scala">persistentBehavior.eventAdapter(new WrapperEventAdapter[Event])</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/akka/tree/v2.5.32/akka-persistence-typed/src/test/java/akka/persistence/typed/javadsl/PersistentActorCompileOnlyTest.java#L108-L111" target="_blank" title="Go to snippet source"></a><code class="language-java">@Override
public EventAdapter&lt;SimpleEvent, Wrapper&lt;SimpleEvent&gt;&gt; eventAdapter() {
  return new EventAdapterExample();
}</code></pre></dd>
</dl>
<h2><a href="#wrapping-persistent-behaviors" name="wrapping-persistent-behaviors" class="anchor"><span class="anchor-link"></span></a>Wrapping Persistent Behaviors</h2>
<p>When creating a <code>EventSourcedBehavior</code>, it is possible to wrap <code>EventSourcedBehavior</code> in other behaviors such as <code>Behaviors.setup</code> in order to access the <code>ActorContext</code> object. For instance to access the actor logging upon taking snapshots for debug purpose.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/akka/tree/v2.5.32/akka-persistence-typed/src/test/scala/docs/akka/persistence/typed/BasicPersistentBehaviorCompileOnly.scala#L108-L123" target="_blank" title="Go to snippet source"></a><code class="language-scala">val samplePersistentBehavior = EventSourcedBehavior[Command, Event, State](
  persistenceId = PersistenceId(&quot;abc&quot;),
  emptyState = State(),
  commandHandler = (state, cmd) =&gt; throw new RuntimeException(&quot;TODO: process the command &amp; return an Effect&quot;),
  eventHandler = (state, evt) =&gt; throw new RuntimeException(&quot;TODO: process the event return the next state&quot;))
  .receiveSignal {
    case (state, RecoveryCompleted) =&gt;
      throw new RuntimeException(&quot;TODO: add some end-of-recovery side-effect here&quot;)
  }

val debugAlwaysSnapshot: Behavior[Command] = Behaviors.setup { context =&gt;
  samplePersistentBehavior.snapshotWhen((state, _, _) =&gt; {
    context.log.info(&quot;Snapshot actor {} =&gt; state: {}&quot;, context.self.path.name, state)
    true
  })
}</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/akka/tree/v2.5.32/akka-persistence-typed/src/test/java/jdocs/akka/persistence/typed/BasicPersistentBehaviorTest.java#L228-L241" target="_blank" title="Go to snippet source"></a><code class="language-java">Behavior&lt;Command&gt; debugAlwaysSnapshot =
    Behaviors.setup(
        (context) -&gt; {
          return new MyPersistentBehavior(new PersistenceId(&quot;pid&quot;)) {
            @Override
            public boolean shouldSnapshot(State state, Event event, long sequenceNr) {
              context
                  .getLog()
                  .info(
                      &quot;Snapshot actor {} =&gt; state: {}&quot;, context.getSelf().path().name(), state);
              return true;
            }
          };
        });</code></pre></dd>
</dl>
<h2><a href="#journal-failures" name="journal-failures" class="anchor"><span class="anchor-link"></span></a>Journal failures</h2>
<p>By default a <code>EventSourcedBehavior</code> will stop if an exception is thrown from the journal. It is possible to override this with any <code>BackoffSupervisorStrategy</code>. It is not possible to use the normal supervision wrapping for this as it isn&rsquo;t valid to <code>resume</code> a behavior on a journal failure as it is not known if the event was persisted.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/akka/tree/v2.5.32/akka-persistence-typed/src/test/scala/docs/akka/persistence/typed/BasicPersistentBehaviorCompileOnly.scala#L127-L128" target="_blank" title="Go to snippet source"></a><code class="language-scala">val supervisedBehavior = samplePersistentBehavior.onPersistFailure(
  SupervisorStrategy.restartWithBackoff(minBackoff = 10.seconds, maxBackoff = 60.seconds, randomFactor = 0.1))</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/akka/tree/v2.5.32/akka-persistence-typed/src/test/java/jdocs/akka/persistence/typed/BasicPersistentBehaviorTest.java#L174-L180" target="_blank" title="Go to snippet source"></a><code class="language-java">public class MyPersistentBehavior extends EventSourcedBehavior&lt;Command, Event, State&gt; {
  public MyPersistentBehavior(PersistenceId persistenceId) {
    super(
        persistenceId,
        SupervisorStrategy.restartWithBackoff(
            Duration.ofSeconds(10), Duration.ofSeconds(30), 0.2));
  }</code></pre></dd>
</dl>
<h2><a href="#journal-rejections" name="journal-rejections" class="anchor"><span class="anchor-link"></span></a>Journal rejections</h2>
<p>Journals can reject events. The difference from a failure is that the journal must decide to reject an event before trying to persist it e.g. because of a serialization exception. If an event is rejected it definitely won&rsquo;t be in the journal. This is signalled to a <code>EventSourcedBehavior</code> via a <code>EventRejectedException</code> and can be handled with a <a href="fault-tolerance.html">supervisor</a>. </p>
<h2><a href="#stash" name="stash" class="anchor"><span class="anchor-link"></span></a>Stash</h2>
<p>When persisting events with <code>persist</code> or <code>persistAll</code> it is guaranteed that the persistent actor will not receive further commands until after the events have been confirmed to be persisted and additional side effects have been run. Incoming messages are stashed automatically until the <code>persist</code> is completed.</p>
<p>Commands are also stashed during recovery and will not interfere with replayed events. Commands will be received when recovery has been completed.</p>
<p>The stashing described above is handled automatically, but there is also a possibility to stash commands when they are received to defer processing of them until later. One example could be waiting for some external condition or interaction to complete before processing additional commands. That is accomplished by returning a <code>stash</code> effect and later use <code>thenUnstashAll</code>.</p>
<p>Let&rsquo;s use an example of a task manager to illustrate how the stashing effects can be used. It handles three commands; <code>StartTask</code>, <code>NextStep</code> and <code>EndTask</code>. Those commands are associated with a given <code>taskId</code> and the manager process one <code>taskId</code> at a time. A task is started when receiving <code>StartTask</code>, and continues when receiving <code>NextStep</code> commands until the final <code>EndTask</code> is received. Commands with another <code>taskId</code> than the one in progress are deferred by stashing them. When <code>EndTask</code> is processed a new task can start and the stashed commands are processed.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/akka/tree/v2.5.32/akka-persistence-typed/src/test/scala/docs/akka/persistence/typed/StashingExample.scala#L18-L83" target="_blank" title="Go to snippet source"></a><code class="language-scala">object TaskManager {

  sealed trait Command
  final case class StartTask(taskId: String) extends Command
  final case class NextStep(taskId: String, instruction: String) extends Command
  final case class EndTask(taskId: String) extends Command

  sealed trait Event
  final case class TaskStarted(taskId: String) extends Event
  final case class TaskStep(taskId: String, instruction: String) extends Event
  final case class TaskCompleted(taskId: String) extends Event

  final case class State(taskIdInProgress: Option[String])

  def apply(persistenceId: PersistenceId): Behavior[Command] =
    EventSourcedBehavior[Command, Event, State](
      persistenceId = persistenceId,
      emptyState = State(None),
      commandHandler = (state, command) =&gt; onCommand(state, command),
      eventHandler = (state, event) =&gt; applyEvent(state, event))
      .onPersistFailure(SupervisorStrategy.restartWithBackoff(1.second, 30.seconds, 0.2))

  private def onCommand(state: State, command: Command): Effect[Event, State] = {
    state.taskIdInProgress match {
      case None =&gt;
        command match {
          case StartTask(taskId) =&gt;
            Effect.persist(TaskStarted(taskId))
          case _ =&gt;
            Effect.unhandled
        }

      case Some(inProgress) =&gt;
        command match {
          case StartTask(taskId) =&gt;
            if (inProgress == taskId)
              Effect.none // duplicate, already in progress
            else
              // other task in progress, wait with new task until later
              Effect.stash()

          case NextStep(taskId, instruction) =&gt;
            if (inProgress == taskId)
              Effect.persist(TaskStep(taskId, instruction))
            else
              // other task in progress, wait with new task until later
              Effect.stash()

          case EndTask(taskId) =&gt;
            if (inProgress == taskId)
              Effect.persist(TaskCompleted(taskId)).thenUnstashAll() // continue with next task
            else
              // other task in progress, wait with new task until later
              Effect.stash()
        }
    }
  }

  private def applyEvent(state: State, event: Event): State = {
    event match {
      case TaskStarted(taskId) =&gt; State(Option(taskId))
      case TaskStep(_, _)      =&gt; state
      case TaskCompleted(_)    =&gt; State(None)
    }
  }
}</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/akka/akka/tree/v2.5.32/akka-persistence-typed/src/test/java/jdocs/akka/persistence/typed/StashingExample.java#L21-L153" target="_blank" title="Go to snippet source"></a><code class="language-java">public static class TaskManager
    extends EventSourcedBehavior&lt;TaskManager.Command, TaskManager.Event, TaskManager.State&gt; {

  public interface Command {}

  public static final class StartTask implements Command {
    public final String taskId;

    public StartTask(String taskId) {
      this.taskId = taskId;
    }
  }

  public static final class NextStep implements Command {
    public final String taskId;
    public final String instruction;

    public NextStep(String taskId, String instruction) {
      this.taskId = taskId;
      this.instruction = instruction;
    }
  }

  public static final class EndTask implements Command {
    public final String taskId;

    public EndTask(String taskId) {
      this.taskId = taskId;
    }
  }

  public interface Event {}

  public static final class TaskStarted implements Event {
    public final String taskId;

    public TaskStarted(String taskId) {
      this.taskId = taskId;
    }
  }

  public static final class TaskStep implements Event {
    public final String taskId;
    public final String instruction;

    public TaskStep(String taskId, String instruction) {
      this.taskId = taskId;
      this.instruction = instruction;
    }
  }

  public static final class TaskCompleted implements Event {
    public final String taskId;

    public TaskCompleted(String taskId) {
      this.taskId = taskId;
    }
  }

  public static class State {
    public final Optional&lt;String&gt; taskIdInProgress;

    public State(Optional&lt;String&gt; taskIdInProgress) {
      this.taskIdInProgress = taskIdInProgress;
    }
  }

  public static Behavior&lt;Command&gt; createBehavior(PersistenceId persistenceId) {
    return new TaskManager(persistenceId);
  }

  public TaskManager(PersistenceId persistenceId) {
    super(
        persistenceId,
        SupervisorStrategy.restartWithBackoff(
            Duration.ofSeconds(1), Duration.ofSeconds(30), 0.2));
  }

  @Override
  public State emptyState() {
    return new State(Optional.empty());
  }

  @Override
  public CommandHandler&lt;Command, Event, State&gt; commandHandler() {
    return newCommandHandlerBuilder()
        .forAnyState()
        .onCommand(StartTask.class, this::onStartTask)
        .onCommand(NextStep.class, this::onNextStep)
        .onCommand(EndTask.class, this::onEndTask)
        .build();
  }

  private Effect&lt;Event, State&gt; onStartTask(State state, StartTask command) {
    if (state.taskIdInProgress.isPresent()) {
      if (state.taskIdInProgress.get().equals(command.taskId))
        return Effect().none(); // duplicate, already in progress
      else return Effect().stash(); // other task in progress, wait with new task until later
    } else {
      return Effect().persist(new TaskStarted(command.taskId));
    }
  }

  private Effect&lt;Event, State&gt; onNextStep(State state, NextStep command) {
    if (state.taskIdInProgress.isPresent()) {
      if (state.taskIdInProgress.get().equals(command.taskId))
        return Effect().persist(new TaskStep(command.taskId, command.instruction));
      else return Effect().stash(); // other task in progress, wait with new task until later
    } else {
      return Effect().unhandled();
    }
  }

  private Effect&lt;Event, State&gt; onEndTask(State state, EndTask command) {
    if (state.taskIdInProgress.isPresent()) {
      if (state.taskIdInProgress.get().equals(command.taskId))
        return Effect().persist(new TaskCompleted(command.taskId));
      else return Effect().stash(); // other task in progress, wait with new task until later
    } else {
      return Effect().unhandled();
    }
  }

  @Override
  public EventHandler&lt;State, Event&gt; eventHandler() {
    return newEventHandlerBuilder()
        .forAnyState()
        .onEvent(TaskStarted.class, (state, event) -&gt; new State(Optional.of(event.taskId)))
        .onEvent(TaskStep.class, (state, event) -&gt; state)
        .onEvent(TaskCompleted.class, (state, event) -&gt; new State(Optional.empty()))
        .build();
  }
}</code></pre></dd>
</dl>
<p>You should be careful to not send more messages to a persistent actor than it can keep up with, otherwise the stash buffer will fill up and when reaching its maximum capacity the commands will be dropped. The capacity can be configured with:</p>
<pre><code>akka.persistence.typed.stash-capacity = 10000
</code></pre>
<p>Note that the stashed commands are kept in an in-memory buffer, so in case of a crash they will not be processed.</p>
<ul>
  <li>Stashed commands are discarded if the actor (entity) is passivated or rebalanced by Cluster Sharding.</li>
  <li>Stashed commands are discarded if the actor is restarted (or stopped) due to that an exception was thrown from processing a command or side effect after persisting.</li>
  <li>Stashed commands are preserved and processed later in case of failure in storing events if an <code>onPersistFailure</code> backoff supervisor strategy is defined.</li>
</ul>
<p>It&rsquo;s allowed to stash messages while unstashing. Those newly added commands will not be processed by the <code>unstashAll</code> effect that was in progress and have to be unstashed by another <code>unstashAll</code>.</p>
</div>
</article>
<div class="row">
<div class="small-12 column">
<section class="nav-prev-next row">
<div class="nav-prev small-6 column">
<a href="../typed/cluster-sharding.html"><i class="icon-prev"></i> <span class="link-prev">Cluster Sharding</span></a>
</div>
<div class="nav-next small-6 column clearfix">
<a class="float-right" href="../typed/persistence-style.html">Persistence - coding style <i class="icon-next"></i></a>
</div>
</section>
</div>
</div>
<div class="source-github row">
Found an error in this documentation? The source code for this page can be found <a href="https://github.com/akka/akka/tree/v2.5.32/akka-docs/src/main/paradox/typed/persistence.md">here</a>.
Please feel free to edit and contribute a pull request.
</div>

<footer class="page-footer row clearfix">
<img class="akka-icon float-left show-for-medium" src="../images/akka-icon.svg" />
<section class="copyright">
<p class="legal">
&copy; 2011-2020 <a href="https://www.lightbend.com" target="_blank">Lightbend, Inc.</a> |
<a href="https://www.lightbend.com/legal/licenses" target="_blank">Licenses</a> |
<a href="https://www.lightbend.com/legal/terms" target="_blank">Terms</a> |
<a href="https://www.lightbend.com/legal/privacy" target="_blank">Privacy Policy</a> |
<a href="https://akka.io/cookie/" target="_blank">Cookie Listing</a> |
<a class="optanon-toggle-display">Cookie Settings</a>
</p>
</section>

</footer>
</section>
</main>
</div>

<script type="text/javascript" src="../js/scrollsneak.js"></script>
<script type="text/javascript">jQuery(document).foundation();</script>
<script type="text/javascript" src="../js/groups.js"></script>
<script type="text/javascript" src="../js/page.js"></script>
<script type="text/javascript" src="../js/magellan.js"></script>

<style type="text/css">@import "../lib/prettify/prettify.css";</style>
<script type="text/javascript" src="../lib/prettify/prettify.js"></script>
<script type="text/javascript" src="../lib/prettify/lang-scala.js"></script>
<script type="text/javascript">//<![CDATA[
jQuery(function(){window.prettyPrint && prettyPrint()});
//]]></script>
<!-- Algolia docs search -->
<script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.js"></script>
<style>.algolia-autocomplete { display: block !important }</style>
<script type="text/javascript">
docsearch({
apiKey: '543bad5ad786495d9ccd445ed34ed082',
indexName: 'akka_io',
inputSelector: '#search',
algoliaOptions: {
hitsPerPage: 5
}
});

docsearch({
apiKey: '543bad5ad786495d9ccd445ed34ed082',
indexName: 'akka_io',
inputSelector: '#overlay-search',
algoliaOptions: {
hitsPerPage: 5
}
});

// set up "/" as global shortcut for focusing on search
jQuery(document).keypress(function (event) {
if (event.keyCode == 47) {
jQuery("#search").focus();
return false; // swallow key event, otherwise the / char would be input into the search box
}
});
</script>

<script type="text/javascript" src="../assets/js/warnOldDocs.js"></script>
<script type="text/javascript" src="../assets/js/scalafiddle.js"></script>


</body>
</html>
