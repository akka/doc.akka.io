<!DOCTYPE html>
<html class="no-js" lang="en">

<head>
<title>Context Propagation &bull; Akka Documentation</title>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<meta name="description" content="Akka is a toolkit for building highly concurrent, distributed, and resilient message-driven applications for Java and Scala."/>
<link rel="canonical" href="https://doc.akka.io/docs/akka/current/stream/stream-context.html"/>
<script type="text/javascript" src="../lib/jquery/jquery.min.js"></script>
<script type="text/javascript" src="../lib/foundation/dist/js/foundation.min.js"></script>
<link rel="stylesheet" type="text/css" href="../lib/normalize.css/normalize.css"/>
<link rel="stylesheet" type="text/css" href="../lib/foundation/dist/css/foundation.min.css"/>
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.css" />
<link rel="stylesheet" type="text/css" href="../css/icons.css"/>
<link rel="stylesheet" type="text/css" href="../css/page-8.css"/>
<link rel="stylesheet" type="text/css" href="../css/banner-2.css"/>
<link rel="shortcut icon" href="../images/favicon.ico" />
<link rel="apple-touch-icon" sizes="180x180" href="../images/apple-touch-icon.png"/>
<link rel="icon" type="image/png" sizes="32x32" href="../images/favicon-32x32.png"/>
<link rel="icon" type="image/png" sizes="16x16" href="../images/favicon-16x16.png"/>
<link rel="manifest" href="../images/manifest.json"/>
<meta name="msapplication-TileImage" content="../images/mstile-150x150.png"/>
<meta name="msapplication-TileColor" content="#15a9ce"/>
<meta name="theme-color" content="#15a9ce"/>
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>
<!-- OneTrust Cookies Consent Notice (Production Standard, akka.io, en-GB) start -->
<script src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js"  type="text/javascript" charset="UTF-8" data-domain-script="28b912e7-09e9-43d5-91e4-3d1897044004" ></script>
<script type="text/javascript">
function OptanonWrapper() { }
</script>
<!-- OneTrust Cookies Consent Notice (Production Standard, akka.io, en-GB) end -->
<!--Google Analytics-->
<script type="text/plain" class="optanon-category-2">
var _gaq = _gaq || [];
_gaq.push(['_setAccount', 'UA-21117439-1']);
_gaq.push(['_setDomainName', 'akka.io']);
_gaq.push(['_trackPageview']);
(function() {
var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})()
</script>
<!-- Google Tag Manager -->
<script type="text/plain" class="optanon-category-2">
(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-KBJGH35');
</script>
<!--Marketo-->
<script type="text/plain" class="optanon-category-3">
(function() {
var didInit = false;
function initMunchkin() {
if(didInit === false) {
didInit = true;
Munchkin.init('558-NCX-702', { 'asyncOnly': true, 'disableClickDelay': true });
}
}
var s = document.createElement('script');
s.type = 'text/javascript';
s.async = true;
s.src = '//munchkin.marketo.net/munchkin.js';
s.onreadystatechange = function() {
if (this.readyState == 'complete' || this.readyState == 'loaded') {
initMunchkin();
}
};
s.onload = initMunchkin;
document.getElementsByTagName('head')[0].appendChild(s);
})();
</script>
</head>

<body id="underlay" data-toggler="nav-open">
<div id="lightbend-banner" class="lightbend-banner akka full-width" data-category="OSS Lightbend Banner Impression" data-label="Akka Banner Impression">
<div class="oss-wrapper">
<div class="oss-brand">
<a class="oss-track-link-label" data-category="OSS Lightbend Banner Clicks" data-label="Lightbend Logo - Akka Banner" href="https://www.lightbend.com">
<img class="lightbend-logo" src="../images/banner-logos/lightbend-reverse.svg" alt="Lightbend" title="Lightbend">
</a>
</div>
<div class="oss-ad no-drop-down">
<nav id="lightbendRotator" class="lightbend-rotator">
<a class="oss-track-link-label" data-category="OSS Lightbend Banner Clicks" data-label="Promo Rotator - Lightbend is Changing its Software Licensing Model for Akka Technology. [License FAQ] - Akka Banner" href="https://www.lightbend.com/akka/license-faq">
<strong>Lightbend</strong> is Changing its Software Licensing Model for Akka Technology. <span class="akka-btn">License FAQ</span>
</a>
</nav>
</div>
</div>
</div>

<header class="site-header hide-for-large">
<div class="sticky-header clearfix">
<a href="https://akka.io"><img class="logo" src="../images/akka-logo-reverse.svg"/></a>

<button class="menu-icon float-right" type="button" data-toggle="underlay overlay"></button>
</div>
<div id="overlay" class="overlay-nav" data-toggler="nav-open">
<header class="nav-header">
<div class="nav-header-title">
<h1><a href="../index.html">Akka Documentation</a></h1>
</div>
<div class="nav-header-version">
Version 2.7.0-M3
</div>
<div class="nav-header-groups">
<select class="supergroup" name="Language"><option class="group" value="group-scala">Scala</option><option class="group" value="group-java">Java</option></select>
</div>
<div id="overlay-search-container" class="nav-header-search">
<input id="overlay-search" type="search" class="search" placeholder="Search" />
</div>
</header>
<nav class="nav-toc">
<ul>
  <li><a href="../security/index.html" class="page">Security Announcements</a></li>
  <li><a href="../typed/guide/index.html" class="page">Getting Started Guide</a></li>
  <li><a href="../general/index.html" class="page">General Concepts</a></li>
  <li><a href="../typed/index.html" class="page">Actors</a></li>
  <li><a href="../typed/index-cluster.html" class="page">Cluster</a></li>
  <li><a href="../typed/index-persistence.html" class="page">Persistence (Event Sourcing)</a></li>
  <li><a href="../typed/index-persistence-durable-state.html" class="page">Persistence (Durable State)</a></li>
  <li><a href="../stream/index.html" class="page">Streams</a>
  <ul>
    <li><a href="../stream/index.html#module-info" class="header">Module info</a></li>
    <li><a href="../stream/stream-introduction.html" class="page">Introduction</a></li>
    <li><a href="../stream/stream-quickstart.html" class="page">Streams Quickstart Guide</a></li>
    <li><a href="../general/stream/stream-design.html" class="page">Design Principles behind Akka Streams</a></li>
    <li><a href="../stream/stream-flows-and-basics.html" class="page">Basics and working with Flows</a></li>
    <li><a href="../stream/stream-graphs.html" class="page">Working with Graphs</a></li>
    <li><a href="../stream/stream-composition.html" class="page">Modularity, Composition and Hierarchy</a></li>
    <li><a href="../stream/stream-rate.html" class="page">Buffers and working with rate</a></li>
    <li><a href="../stream/stream-context.html#context-propagation" class="active page">Context Propagation</a>
    <ul>
      <li><a href="../stream/stream-context.html#restrictions" class="header">Restrictions</a></li>
      <li><a href="../stream/stream-context.html#creation" class="header">Creation</a></li>
      <li><a href="../stream/stream-context.html#composition" class="header">Composition</a></li>
    </ul></li>
    <li><a href="../stream/stream-dynamic.html" class="page">Dynamic stream handling</a></li>
    <li><a href="../stream/stream-customize.html" class="page">Custom stream processing</a></li>
    <li><a href="../stream/futures-interop.html" class="page">Futures interop</a></li>
    <li><a href="../stream/actor-interop.html" class="page">Actors interop</a></li>
    <li><a href="../stream/reactive-streams-interop.html" class="page">Reactive Streams Interop</a></li>
    <li><a href="../stream/stream-error.html" class="page">Error Handling in Streams</a></li>
    <li><a href="../stream/stream-io.html" class="page">Working with streaming IO</a></li>
    <li><a href="../stream/stream-refs.html" class="page">StreamRefs - Reactive Streams over the network</a></li>
    <li><a href="../stream/stream-parallelism.html" class="page">Pipelining and Parallelism</a></li>
    <li><a href="../stream/stream-testkit.html" class="page">Testing streams</a></li>
    <li><a href="../stream/stream-substream.html" class="page">Substreams</a></li>
    <li><a href="../stream/stream-cookbook.html" class="page">Streams Cookbook</a></li>
    <li><a href="../general/stream/stream-configuration.html" class="page">Configuration</a></li>
    <li><a href="../stream/operators/index.html" class="page">Operators</a></li>
  </ul></li>
  <li><a href="../discovery/index.html" class="page">Discovery</a></li>
  <li><a href="../index-utilities.html" class="page">Utilities</a></li>
  <li><a href="../common/other-modules.html" class="page">Other Akka modules</a></li>
  <li><a href="../additional/deploy.html" class="page">Package, Deploy and Run</a></li>
  <li><a href="../project/index.html" class="page">Project Information</a></li>
  <li><a href="../index-classic.html" class="page">Akka Classic</a></li>
</ul>
</nav>
</div>
</header>
<div class="site-content-wrapper">
<aside class="sticky-sidebar show-for-large">
<header class="nav-header sticky-sidebar-header">
<div class="nav-header-title">
<h1><a href="../index.html">Akka Documentation</a></h1>
</div>
<div class="nav-header-version">
Version 2.7.0-M3
</div>
<div class="nav-header-groups">
<select class="supergroup" name="Language"><option class="group" value="group-scala">Scala</option><option class="group" value="group-java">Java</option></select>
</div>
<div class="nav-header-search">
<input id="search" type="search" class="search" placeholder="Search" />
</div>
</header>
<nav class="site-nav sticky-sidebar-contents">
<div class="nav-toc">
<ul>
  <li><a href="../security/index.html" class="page">Security Announcements</a></li>
  <li><a href="../typed/guide/index.html" class="page">Getting Started Guide</a></li>
  <li><a href="../general/index.html" class="page">General Concepts</a></li>
  <li><a href="../typed/index.html" class="page">Actors</a></li>
  <li><a href="../typed/index-cluster.html" class="page">Cluster</a></li>
  <li><a href="../typed/index-persistence.html" class="page">Persistence (Event Sourcing)</a></li>
  <li><a href="../typed/index-persistence-durable-state.html" class="page">Persistence (Durable State)</a></li>
  <li><a href="../stream/index.html" class="page">Streams</a>
  <ul>
    <li><a href="../stream/index.html#module-info" class="header">Module info</a></li>
    <li><a href="../stream/stream-introduction.html" class="page">Introduction</a></li>
    <li><a href="../stream/stream-quickstart.html" class="page">Streams Quickstart Guide</a></li>
    <li><a href="../general/stream/stream-design.html" class="page">Design Principles behind Akka Streams</a></li>
    <li><a href="../stream/stream-flows-and-basics.html" class="page">Basics and working with Flows</a></li>
    <li><a href="../stream/stream-graphs.html" class="page">Working with Graphs</a></li>
    <li><a href="../stream/stream-composition.html" class="page">Modularity, Composition and Hierarchy</a></li>
    <li><a href="../stream/stream-rate.html" class="page">Buffers and working with rate</a></li>
    <li><a href="../stream/stream-context.html#context-propagation" class="active page">Context Propagation</a>
    <ul>
      <li><a href="../stream/stream-context.html#restrictions" class="header">Restrictions</a></li>
      <li><a href="../stream/stream-context.html#creation" class="header">Creation</a></li>
      <li><a href="../stream/stream-context.html#composition" class="header">Composition</a></li>
    </ul></li>
    <li><a href="../stream/stream-dynamic.html" class="page">Dynamic stream handling</a></li>
    <li><a href="../stream/stream-customize.html" class="page">Custom stream processing</a></li>
    <li><a href="../stream/futures-interop.html" class="page">Futures interop</a></li>
    <li><a href="../stream/actor-interop.html" class="page">Actors interop</a></li>
    <li><a href="../stream/reactive-streams-interop.html" class="page">Reactive Streams Interop</a></li>
    <li><a href="../stream/stream-error.html" class="page">Error Handling in Streams</a></li>
    <li><a href="../stream/stream-io.html" class="page">Working with streaming IO</a></li>
    <li><a href="../stream/stream-refs.html" class="page">StreamRefs - Reactive Streams over the network</a></li>
    <li><a href="../stream/stream-parallelism.html" class="page">Pipelining and Parallelism</a></li>
    <li><a href="../stream/stream-testkit.html" class="page">Testing streams</a></li>
    <li><a href="../stream/stream-substream.html" class="page">Substreams</a></li>
    <li><a href="../stream/stream-cookbook.html" class="page">Streams Cookbook</a></li>
    <li><a href="../general/stream/stream-configuration.html" class="page">Configuration</a></li>
    <li><a href="../stream/operators/index.html" class="page">Operators</a></li>
  </ul></li>
  <li><a href="../discovery/index.html" class="page">Discovery</a></li>
  <li><a href="../index-utilities.html" class="page">Utilities</a></li>
  <li><a href="../common/other-modules.html" class="page">Other Akka modules</a></li>
  <li><a href="../additional/deploy.html" class="page">Package, Deploy and Run</a></li>
  <li><a href="../project/index.html" class="page">Project Information</a></li>
  <li><a href="../index-classic.html" class="page">Akka Classic</a></li>
</ul>
</div>
</nav>
<footer class="nav-footer sticky-sidebar-footer">
<a href="https://akka.io"><img class="logo" src="../images/akka-logo-reverse.svg"/></a>

</footer>
</aside>
<main class="fixed-shift-for-large expanded row">
<section class="site-content small-12 column">
<article class="page-content row">
<div class="small-12 column" id="docs">
<h1><a href="#context-propagation" name="context-propagation" class="anchor"><span class="anchor-link"></span></a>Context Propagation</h1>
<p>It can be convenient to attach metadata to each element in the stream.</p>
<p>For example, when reading from an external data source it can be useful to keep track of the read offset, so it can be marked as processed when the element reaches the <span class="group-java"><a href="https://doc.akka.io/japi/akka/2.7/akka/stream/javadsl/Sink.html" title="akka.stream.javadsl.Sink"><code>Sink</code></a></span><span class="group-scala"><a href="https://doc.akka.io/api/akka/2.7/akka/stream/scaladsl/Sink.html" title="akka.stream.scaladsl.Sink"><code>Sink</code></a></span>.</p>
<p>For this use case we provide the <span class="group-java"><a href="https://doc.akka.io/japi/akka/2.7/akka/stream/javadsl/SourceWithContext.html" title="akka.stream.javadsl.SourceWithContext"><code>SourceWithContext</code></a></span><span class="group-scala"><a href="https://doc.akka.io/api/akka/2.7/akka/stream/scaladsl/SourceWithContext.html" title="akka.stream.scaladsl.SourceWithContext"><code>SourceWithContext</code></a></span> and <span class="group-java"><a href="https://doc.akka.io/japi/akka/2.7/akka/stream/javadsl/FlowWithContext.html" title="akka.stream.javadsl.FlowWithContext"><code>FlowWithContext</code></a></span><span class="group-scala"><a href="https://doc.akka.io/api/akka/2.7/akka/stream/scaladsl/FlowWithContext.html" title="akka.stream.scaladsl.FlowWithContext"><code>FlowWithContext</code></a></span> variations on <span class="group-java"><a href="https://doc.akka.io/japi/akka/2.7/akka/stream/javadsl/Source.html" title="akka.stream.javadsl.Source"><code>Source</code></a></span><span class="group-scala"><a href="https://doc.akka.io/api/akka/2.7/akka/stream/scaladsl/Source.html" title="akka.stream.scaladsl.Source"><code>Source</code></a></span> and <span class="group-java"><a href="https://doc.akka.io/japi/akka/2.7/akka/stream/javadsl/Flow.html" title="akka.stream.javadsl.Flow"><code>Flow</code></a></span><span class="group-scala"><a href="https://doc.akka.io/api/akka/2.7/akka/stream/scaladsl/Flow.html" title="akka.stream.scaladsl.Flow"><code>Flow</code></a></span>.</p>
<p>Essentially, a <span class="group-java"><a href="https://doc.akka.io/japi/akka/2.7/akka/stream/javadsl/FlowWithContext.html" title="akka.stream.javadsl.FlowWithContext"><code>FlowWithContext</code></a></span><span class="group-scala"><a href="https://doc.akka.io/api/akka/2.7/akka/stream/scaladsl/FlowWithContext.html" title="akka.stream.scaladsl.FlowWithContext"><code>FlowWithContext</code></a></span> is just a <span class="group-java"><a href="https://doc.akka.io/japi/akka/2.7/akka/stream/javadsl/Flow.html" title="akka.stream.javadsl.Flow"><code>Flow</code></a></span><span class="group-scala"><a href="https://doc.akka.io/api/akka/2.7/akka/stream/scaladsl/Flow.html" title="akka.stream.scaladsl.Flow"><code>Flow</code></a></span> that contains <span class="group-scala">tuples</span><span class="group-java">pairs</span> of element and context, but the advantage is in the operators: most operators on <span class="group-java"><a href="https://doc.akka.io/japi/akka/2.7/akka/stream/javadsl/FlowWithContext.html" title="akka.stream.javadsl.FlowWithContext"><code>FlowWithContext</code></a></span><span class="group-scala"><a href="https://doc.akka.io/api/akka/2.7/akka/stream/scaladsl/FlowWithContext.html" title="akka.stream.scaladsl.FlowWithContext"><code>FlowWithContext</code></a></span> will work on the element rather than on the <span class="group-scala">tuple</span><span class="group-java">pair</span>, allowing you to focus on your application logic rather without worrying about the context.</p>
<h2><a href="#restrictions" name="restrictions" class="anchor"><span class="anchor-link"></span></a>Restrictions</h2>
<p>Not all operations that are available on <span class="group-java"><a href="https://doc.akka.io/japi/akka/2.7/akka/stream/javadsl/Flow.html" title="akka.stream.javadsl.Flow"><code>Flow</code></a></span><span class="group-scala"><a href="https://doc.akka.io/api/akka/2.7/akka/stream/scaladsl/Flow.html" title="akka.stream.scaladsl.Flow"><code>Flow</code></a></span> are also available on <span class="group-java"><a href="https://doc.akka.io/japi/akka/2.7/akka/stream/javadsl/FlowWithContext.html" title="akka.stream.javadsl.FlowWithContext"><code>FlowWithContext</code></a></span><span class="group-scala"><a href="https://doc.akka.io/api/akka/2.7/akka/stream/scaladsl/FlowWithContext.html" title="akka.stream.scaladsl.FlowWithContext"><code>FlowWithContext</code></a></span>. This is intentional: in the use case of keeping track of a read offset, if the <span class="group-java"><a href="https://doc.akka.io/japi/akka/2.7/akka/stream/javadsl/FlowWithContext.html" title="akka.stream.javadsl.FlowWithContext"><code>FlowWithContext</code></a></span><span class="group-scala"><a href="https://doc.akka.io/api/akka/2.7/akka/stream/scaladsl/FlowWithContext.html" title="akka.stream.scaladsl.FlowWithContext"><code>FlowWithContext</code></a></span> was allowed to arbitrarily filter and reorder the stream, the <span class="group-java"><a href="https://doc.akka.io/japi/akka/2.7/akka/stream/javadsl/Sink.html" title="akka.stream.javadsl.Sink"><code>Sink</code></a></span><span class="group-scala"><a href="https://doc.akka.io/api/akka/2.7/akka/stream/scaladsl/Sink.html" title="akka.stream.scaladsl.Sink"><code>Sink</code></a></span> would have no way to determine whether an element was skipped or merely reordered and still in flight.</p>
<p>For this reason, <span class="group-java"><a href="https://doc.akka.io/japi/akka/2.7/akka/stream/javadsl/FlowWithContext.html" title="akka.stream.javadsl.FlowWithContext"><code>FlowWithContext</code></a></span><span class="group-scala"><a href="https://doc.akka.io/api/akka/2.7/akka/stream/scaladsl/FlowWithContext.html" title="akka.stream.scaladsl.FlowWithContext"><code>FlowWithContext</code></a></span> allows filtering operations (such as <code>filter</code>, <code>filterNot</code>, <code>collect</code>, etc.) and grouping operations (such as <code>grouped</code>, <code>sliding</code>, etc.) but not reordering operations (such as <code>mapAsyncUnordered</code> and <code>statefulMapConcat</code>). Finally, also &lsquo;one-to-n&rsquo; operations such as <code>mapConcat</code> are allowed.</p>
<p>Filtering operations will drop the context along with dropped elements, while grouping operations will keep all contexts from the elements in the group. Streaming one-to-many operations such as <code>mapConcat</code> associate the original context with each of the produced elements.</p>
<p>As an escape hatch, there is a <code>via</code> operator that allows you to insert an arbitrary <span class="group-java"><a href="https://doc.akka.io/japi/akka/2.7/akka/stream/javadsl/Flow.html" title="akka.stream.javadsl.Flow"><code>Flow</code></a></span><span class="group-scala"><a href="https://doc.akka.io/api/akka/2.7/akka/stream/scaladsl/Flow.html" title="akka.stream.scaladsl.Flow"><code>Flow</code></a></span> that can process the <span class="group-scala">tuples</span><span class="group-java">pairs</span> of elements and context in any way desired. When using this operator, it is the responsibility of the implementor to make sure this <span class="group-java"><a href="https://doc.akka.io/japi/akka/2.7/akka/stream/javadsl/Flow.html" title="akka.stream.javadsl.Flow"><code>Flow</code></a></span><span class="group-scala"><a href="https://doc.akka.io/api/akka/2.7/akka/stream/scaladsl/Flow.html" title="akka.stream.scaladsl.Flow"><code>Flow</code></a></span> does not perform any operations (such as reordering) that might break assumptions made by the <span class="group-java"><a href="https://doc.akka.io/japi/akka/2.7/akka/stream/javadsl/Sink.html" title="akka.stream.javadsl.Sink"><code>Sink</code></a></span><span class="group-scala"><a href="https://doc.akka.io/api/akka/2.7/akka/stream/scaladsl/Sink.html" title="akka.stream.scaladsl.Sink"><code>Sink</code></a></span> consuming the context elements.</p>
<h2><a href="#creation" name="creation" class="anchor"><span class="anchor-link"></span></a>Creation</h2>
<p>The simplest way to create a <span class="group-java"><a href="https://doc.akka.io/japi/akka/2.7/akka/stream/javadsl/SourceWithContext.html" title="akka.stream.javadsl.SourceWithContext"><code>SourceWithContext</code></a></span><span class="group-scala"><a href="https://doc.akka.io/api/akka/2.7/akka/stream/scaladsl/SourceWithContext.html" title="akka.stream.scaladsl.SourceWithContext"><code>SourceWithContext</code></a></span> is to first create a regular <span class="group-java"><a href="https://doc.akka.io/japi/akka/2.7/akka/stream/javadsl/Source.html" title="akka.stream.javadsl.Source"><code>Source</code></a></span><span class="group-scala"><a href="https://doc.akka.io/api/akka/2.7/akka/stream/scaladsl/Source.html" title="akka.stream.scaladsl.Source"><code>Source</code></a></span> with elements from which the context can be extracted, and then use <a href="operators/Source/asSourceWithContext.html">Source.asSourceWithContext</a>.</p>
<h2><a href="#composition" name="composition" class="anchor"><span class="anchor-link"></span></a>Composition</h2>
<p>When you have a <span class="group-java"><a href="https://doc.akka.io/japi/akka/2.7/akka/stream/javadsl/SourceWithContext.html" title="akka.stream.javadsl.SourceWithContext"><code>SourceWithContext</code></a></span><span class="group-scala"><a href="https://doc.akka.io/api/akka/2.7/akka/stream/scaladsl/SourceWithContext.html" title="akka.stream.scaladsl.SourceWithContext"><code>SourceWithContext</code></a></span> <code>source</code> that produces elements of type <code>Foo</code> with a context of type <code>Ctx</code>, and a <span class="group-java"><a href="https://doc.akka.io/japi/akka/2.7/akka/stream/javadsl/Flow.html" title="akka.stream.javadsl.Flow"><code>Flow</code></a></span><span class="group-scala"><a href="https://doc.akka.io/api/akka/2.7/akka/stream/scaladsl/Flow.html" title="akka.stream.scaladsl.Flow"><code>Flow</code></a></span> <code>flow</code> from <code>Foo</code> to <code>Bar</code>, you cannot simply <code>source.via(flow)</code> to arrive at a <span class="group-java"><a href="https://doc.akka.io/japi/akka/2.7/akka/stream/javadsl/SourceWithContext.html" title="akka.stream.javadsl.SourceWithContext"><code>SourceWithContext</code></a></span><span class="group-scala"><a href="https://doc.akka.io/api/akka/2.7/akka/stream/scaladsl/SourceWithContext.html" title="akka.stream.scaladsl.SourceWithContext"><code>SourceWithContext</code></a></span> that produces elements of type <code>Bar</code> with contexts of type <code>Ctx</code>. The reason for this is that <code>flow</code> might reorder the elements flowing through it, making <code>via</code> challenging to implement.</p>
<p>Due to this there is a <code>unsafeDataVia</code> that can be used instead however no protection is offered to prevent reordering or dropping/duplicating elements from stream so use this operation with great care.</p>
<p>There is also a <a href="operators/Flow/asFlowWithContext.html">Flow.asFlowWithContext</a> which can be used when the types used in the inner <span class="group-java"><a href="https://doc.akka.io/japi/akka/2.7/akka/stream/javadsl/Flow.html" title="akka.stream.javadsl.Flow"><code>Flow</code></a></span><span class="group-scala"><a href="https://doc.akka.io/api/akka/2.7/akka/stream/scaladsl/Flow.html" title="akka.stream.scaladsl.Flow"><code>Flow</code></a></span> have room to hold the context. If this is not the case, a better solution is usually to build the flow from the ground up as a <span class="group-java"><a href="https://doc.akka.io/japi/akka/2.7/akka/stream/javadsl/FlowWithContext.html" title="akka.stream.javadsl.FlowWithContext"><code>FlowWithContext</code></a></span><span class="group-scala"><a href="https://doc.akka.io/api/akka/2.7/akka/stream/scaladsl/FlowWithContext.html" title="akka.stream.scaladsl.FlowWithContext"><code>FlowWithContext</code></a></span>, instead of first building a <span class="group-java"><a href="https://doc.akka.io/japi/akka/2.7/akka/stream/javadsl/Flow.html" title="akka.stream.javadsl.Flow"><code>Flow</code></a></span><span class="group-scala"><a href="https://doc.akka.io/api/akka/2.7/akka/stream/scaladsl/Flow.html" title="akka.stream.scaladsl.Flow"><code>Flow</code></a></span> and trying to convert it to <span class="group-java"><a href="https://doc.akka.io/japi/akka/2.7/akka/stream/javadsl/FlowWithContext.html" title="akka.stream.javadsl.FlowWithContext"><code>FlowWithContext</code></a></span><span class="group-scala"><a href="https://doc.akka.io/api/akka/2.7/akka/stream/scaladsl/FlowWithContext.html" title="akka.stream.scaladsl.FlowWithContext"><code>FlowWithContext</code></a></span> after-the-fact.</p>
</div>
</article>
<div class="row">
<div class="small-12 column">
<section class="nav-prev-next row">
<div class="nav-prev small-6 column">
<a href="../stream/stream-rate.html"><i class="icon-prev"></i> <span class="link-prev">Buffers and working with rate</span></a>
</div>
<div class="nav-next small-6 column clearfix">
<a class="float-right" href="../stream/stream-dynamic.html">Dynamic stream handling <i class="icon-next"></i></a>
</div>
</section>
</div>
</div>
<div class="source-github row">
Found an error in this documentation? The source code for this page can be found <a href="https://github.com/akka/akka/tree/v2.7.0-M3/akka-docs/src/main/paradox/stream/stream-context.md">here</a>.
Please feel free to edit and contribute a pull request.
</div>

<footer class="page-footer row clearfix">
<img class="akka-icon float-left show-for-medium" src="../images/akka-icon.svg" />
<section class="copyright">
<div>Akka is available under the <a href="https://www.lightbend.com/akka/license" target="_blank">Business Source License 1.1</a>.</div>
<p class="legal">
&copy; 2011-2022 <a href="https://www.lightbend.com" target="_blank">Lightbend, Inc.</a> |
<a href="https://www.lightbend.com/legal/licenses" target="_blank">Licenses</a> |
<a href="https://www.lightbend.com/legal/terms" target="_blank">Terms</a> |
<a href="https://www.lightbend.com/legal/privacy" target="_blank">Privacy Policy</a> |
<a href="https://akka.io/cookie/" target="_blank">Cookie Listing</a> |
<a class="optanon-toggle-display">Cookie Settings</a>
</p>
</section>

</footer>
</section>
</main>
</div>

<script type="text/javascript" src="../js/scrollsneak.js"></script>
<script type="text/javascript">jQuery(document).foundation();</script>
<script type="text/javascript" src="../js/groups.js"></script>
<script type="text/javascript" src="../js/page.js"></script>
<script type="text/javascript" src="../js/snippets.js"></script>
<script type="text/javascript" src="../js/magellan.js"></script>
<script type="text/javascript" src="../js/metadata-toggle.js"></script>
<script type="text/javascript" src="../js/lbHeader.js"></script>

<style type="text/css">@import "../lib/prettify/prettify.css";</style>
<script type="text/javascript" src="../lib/prettify/prettify.js"></script>
<script type="text/javascript" src="../lib/prettify/lang-scala.js"></script>
<script type="text/javascript">//<![CDATA[
jQuery(function(){window.prettyPrint && prettyPrint()});
//]]></script>
<!-- Algolia docs search -->
<script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.js"></script>
<style>.algolia-autocomplete { display: block !important }</style>
<script type="text/javascript">
docsearch({
apiKey: '543bad5ad786495d9ccd445ed34ed082',
indexName: 'akka_io',
inputSelector: '#search',
algoliaOptions: {
hitsPerPage: 5
}
});

docsearch({
apiKey: '543bad5ad786495d9ccd445ed34ed082',
indexName: 'akka_io',
inputSelector: '#overlay-search',
algoliaOptions: {
hitsPerPage: 5
}
});

// set up "/" as global shortcut for focusing on search
jQuery(document).keypress(function (event) {
if (event.keyCode == 47) {
jQuery("#search").focus();
return false; // swallow key event, otherwise the / char would be input into the search box
}
});
</script>

<script type="text/javascript" src="../assets/js/warnOldDocs.js"></script>
<script type="text/javascript" src="../assets/js/scalafiddle.js"></script>


</body>
</html>
