<!DOCTYPE html>
<html class="no-js" lang="en">

<head>
<title>Cluster &bull; Akka Documentation</title>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<meta name="description" content="Akka is a toolkit for building highly concurrent, distributed, and resilient message-driven applications for Java and Scala."/>
<link rel="canonical" href="https://doc.akka.io/docs/akka/current/cluster-typed.html"/>
<script type="text/javascript" src="lib/jquery/jquery.min.js"></script>
<script type="text/javascript" src="lib/foundation/dist/js/foundation.min.js"></script>
<link rel="stylesheet" type="text/css" href="lib/normalize.css/normalize.css"/>
<link rel="stylesheet" type="text/css" href="lib/foundation/dist/css/foundation.min.css"/>
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.css" />
<link rel="stylesheet" type="text/css" href="css/icons.css"/>
<link rel="stylesheet" type="text/css" href="css/page.css"/>
<link rel="shortcut icon" href="images/favicon.ico" />
<link rel="apple-touch-icon" sizes="180x180" href="images/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="images/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="images/favicon-16x16.png">
<link rel="manifest" href="images/manifest.json">
<meta name="msapplication-TileImage" content="images/mstile-150x150.png">
<meta name="msapplication-TileColor" content="#15a9ce">
<meta name="theme-color" content="#15a9ce">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<!--Google Analytics-->
<script type="text/javascript">
var _gaq = _gaq || [];
_gaq.push(['_setAccount', 'UA-21117439-1']);
_gaq.push(['_setDomainName', 'akka.io']);
_gaq.push(['_trackPageview']);
(function() {
var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})()
</script>
<!--Google Analytics & Marketo-->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-23127719-1', 'lightbend.com', {'allowLinker': true, 'name': 'tsTracker'});
ga('tsTracker.require', 'linker');
ga('tsTracker.linker:autoLink', ['lightbend.com','playframework.com','scala-lang.org','scaladays.org','spray.io','akka.io','scala-sbt.org','scala-ide.org']);
ga('tsTracker.send', 'pageview');
(function() {
var didInit = false;
function initMunchkin() {
if(didInit === false) {
didInit = true;
Munchkin.init('558-NCX-702');
}
}
var s = document.createElement('script');
s.type = 'text/javascript';
s.async = true;
s.src = '//munchkin.marketo.net/munchkin.js';
s.onreadystatechange = function() {
if (this.readyState == 'complete' || this.readyState == 'loaded') {
initMunchkin();
}
};
s.onload = initMunchkin;
document.getElementsByTagName('head')[0].appendChild(s);
})();
</script>

</head>

<body id="underlay" data-toggler="nav-open">

<header class="site-header hide-for-large">
<div class="sticky-header clearfix">
<a href="https://akka.io"><img class="logo" src="images/akka-logo-reverse.svg"></a>

<button class="menu-icon float-right" type="button" data-toggle="underlay overlay"></button>
</div>
<div id="overlay" class="overlay-nav" data-toggler="nav-open">
<header class="nav-header">
<div class="nav-header-title">
<h1><a href="index.html">Akka Documentation</a></h1>
</div>
<div class="nav-header-version">
Version 2.5.9
</div>
<div class="nav-header-groups">
<select class="supergroup" name="Language"><option class="group" value="group-scala">Scala</option><option class="group" value="group-java">Java</option></select>
</div>
<div id="overlay-search-container" class="nav-header-search">
<input id="overlay-search" type="search" class="search" placeholder="Search"/>
</div>
</header>
<nav class="nav-toc">
<ul>
  <li><a href="security/index.html" class="page">Security Announcements</a></li>
  <li><a href="guide/index.html" class="page">Getting Started Guide</a></li>
  <li><a href="general/index.html" class="page">General Concepts</a></li>
  <li><a href="index-actors.html" class="page">Actors</a></li>
  <li><a href="index-typed.html" class="page">Akka Typed</a>
  <ul>
    <li><a href="actors-typed.html" class="page">Actors</a></li>
    <li><a href="coexisting.html" class="page">Coexistence</a></li>
    <li><a href="fault-tolerance-typed.html" class="page">Fault Tolerance</a></li>
    <li><a href="actor-discovery-typed.html" class="page">Actor discovery</a></li>
    <li><a href="cluster-typed.html#cluster" class="active page">Cluster</a>
    <ul>
      <li><a href="cluster-typed.html#cluster-api-extension" class="header">Cluster API extension</a></li>
      <li><a href="cluster-typed.html#serialization" class="header">Serialization</a></li>
    </ul></li>
    <li><a href="cluster-sharding-typed.html" class="page">Sharding</a></li>
    <li><a href="persistence-typed.html" class="page">Persistence</a></li>
    <li><a href="testing-typed.html" class="page">Testing</a></li>
  </ul></li>
  <li><a href="index-cluster.html" class="page">Clustering</a></li>
  <li><a href="stream/index.html" class="page">Streams</a></li>
  <li><a href="index-network.html" class="page">Networking</a></li>
  <li><a href="index-futures.html" class="page">Futures and Agents</a></li>
  <li><a href="index-utilities.html" class="page">Utilities</a></li>
  <li><a href="common/other-modules.html" class="page">Other Akka modules</a></li>
  <li><a href="howto.html" class="page">HowTo: Common Patterns</a></li>
  <li><a href="project/index.html" class="page">Project Information</a></li>
  <li><a href="additional/index.html" class="page">Additional Information</a></li>
</ul>
</nav>
</div>
</header>

<aside class="show-for-large">
<header class="nav-header fixed-sidebar-header">
<div class="nav-header-title">
<h1><a href="index.html">Akka Documentation</a></h1>
</div>
<div class="nav-header-version">
Version 2.5.9
</div>
<div class="nav-header-groups">
<select class="supergroup" name="Language"><option class="group" value="group-scala">Scala</option><option class="group" value="group-java">Java</option></select>
</div>
<div class="nav-header-search">
<input id="search" type="search" class="search" placeholder="Search"/>
</div>
</header>
<nav class="site-nav fixed-sidebar-contents">
<div class="nav-toc">
<ul>
  <li><a href="security/index.html" class="page">Security Announcements</a></li>
  <li><a href="guide/index.html" class="page">Getting Started Guide</a></li>
  <li><a href="general/index.html" class="page">General Concepts</a></li>
  <li><a href="index-actors.html" class="page">Actors</a></li>
  <li><a href="index-typed.html" class="page">Akka Typed</a>
  <ul>
    <li><a href="actors-typed.html" class="page">Actors</a></li>
    <li><a href="coexisting.html" class="page">Coexistence</a></li>
    <li><a href="fault-tolerance-typed.html" class="page">Fault Tolerance</a></li>
    <li><a href="actor-discovery-typed.html" class="page">Actor discovery</a></li>
    <li><a href="cluster-typed.html#cluster" class="active page">Cluster</a>
    <ul>
      <li><a href="cluster-typed.html#cluster-api-extension" class="header">Cluster API extension</a></li>
      <li><a href="cluster-typed.html#serialization" class="header">Serialization</a></li>
    </ul></li>
    <li><a href="cluster-sharding-typed.html" class="page">Sharding</a></li>
    <li><a href="persistence-typed.html" class="page">Persistence</a></li>
    <li><a href="testing-typed.html" class="page">Testing</a></li>
  </ul></li>
  <li><a href="index-cluster.html" class="page">Clustering</a></li>
  <li><a href="stream/index.html" class="page">Streams</a></li>
  <li><a href="index-network.html" class="page">Networking</a></li>
  <li><a href="index-futures.html" class="page">Futures and Agents</a></li>
  <li><a href="index-utilities.html" class="page">Utilities</a></li>
  <li><a href="common/other-modules.html" class="page">Other Akka modules</a></li>
  <li><a href="howto.html" class="page">HowTo: Common Patterns</a></li>
  <li><a href="project/index.html" class="page">Project Information</a></li>
  <li><a href="additional/index.html" class="page">Additional Information</a></li>
</ul>
</div>
</nav>
<footer class="nav-footer fixed-sidebar-footer">
<a href="https://akka.io"><img class="logo" src="images/akka-logo-reverse.svg"></a>

</footer>
</aside>

<main class="fixed-shift-for-large expanded row">
<section class="site-content small-12 column">

<article class="page-content row">
<div class="small-12 large-9 column" id="docs">
<h1><a href="#cluster" name="cluster" class="anchor"><span class="anchor-link"></span></a>Cluster</h1><div class="callout warning "><div class="callout-title">Warning</div>
<p>This module is currently marked as <a href="common/may-change.html">may change</a> in the sense  of being the subject of active research. This means that API or semantics can  change without warning or deprecation period and it is not recommended to use  this module in production just yetâ€”you have been warned.</p></div>
<p>To use the testkit add the following dependency:</p><dl class="dependency"><dt>sbt</dt><dd><pre class="prettyprint"><code class="language-scala">libraryDependencies += "com.typesafe.akka" %% "akka-cluster-typed" % "2.5.9"</code></pre></dd><dt>Maven</dt><dd><pre class="prettyprint"><code class="language-xml">&lt;dependency&gt;
  &lt;groupId&gt;com.typesafe.akka&lt;/groupId&gt;
  &lt;artifactId&gt;akka-cluster-typed_2.12&lt;/artifactId&gt;
  &lt;version&gt;2.5.9&lt;/version&gt;
&lt;/dependency&gt;</code></pre></dd><dt>Gradle</dt><dd><pre class="prettyprint"><code class="language-gradle">dependencies {
  compile group: 'com.typesafe.akka', name: 'akka-cluster-typed_2.12', version: '2.5.9'
}</code></pre></dd></dl>
<p>For an introduction to Akka Cluster concepts see <a href="common/cluster.html">Cluster Specification</a>. This documentation shows how to use the typed Cluster API. All of the examples below assume the following imports:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">import akka.actor.typed._
import akka.actor.typed.scaladsl._
import akka.cluster.ClusterEvent._
import akka.cluster.MemberStatus
import akka.cluster.typed._</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><code class="language-java"><br/>import akka.actor.typed.*;
import akka.actor.typed.javadsl.*;
import akka.cluster.ClusterEvent;
import akka.cluster.typed.*;</code></pre></dd>
</dl>
<p>And the minimum configuration required is to set a host/port for remoting and the <code>cluster</code> </p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><code class="language-java"><br/>import akka.actor.typed.*;
import akka.actor.typed.javadsl.*;
import akka.cluster.ClusterEvent;
import akka.cluster.typed.*;</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><code class="language-java"><br/>import akka.actor.typed.*;
import akka.actor.typed.javadsl.*;
import akka.cluster.ClusterEvent;
import akka.cluster.typed.*;</code></pre></dd>
</dl>
<h2><a href="#cluster-api-extension" name="cluster-api-extension" class="anchor"><span class="anchor-link"></span></a>Cluster API extension</h2>
<p>The typed Cluster extension gives access to management tasks (Joining, Leaving, Downing, â€¦) and subscription of cluster membership events (MemberUp, MemberRemoved, UnreachableMember, etc). Those are exposed as two different actor references, i.e. itâ€™s a message based API. </p>
<p>The references are on the <code>Cluster</code> extension:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">val cluster1 = Cluster(system)</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><code class="language-java">Cluster cluster = Cluster.get(system);</code></pre></dd>
</dl>
<p>The Cluster extensions gives you access to:</p>
<ul>
  <li>manager: An <code>ActorRef[ClusterCommand]</code> where a <code>ClusterCommand</code> is a command such as: <code>Join</code>, <code>Leave</code> and <code>Down</code></li>
  <li>subscriptions: An <code>ActorRef[ClusterStateSubscription]</code> where a <code>ClusterStateSubscription</code> is one of <code>GetCurrentState</code> or <code>Subscribe</code> and <code>Unsubscribe</code> to cluster events like <code>MemberRemoved</code></li>
  <li>state: The current <code>CurrentClusterState</code></li>
</ul>
<h3><a href="#cluster-management" name="cluster-management" class="anchor"><span class="anchor-link"></span></a>Cluster Management</h3>
<p>If not using configuration to specify seeds joining the cluster can be done programmatically via the <code>manager</code>.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">cluster1.manager ! Join(cluster1.selfMember.address)</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><code class="language-java">cluster.manager().tell(Join.create(cluster.selfMember().address()));</code></pre></dd>
</dl>
<p>Leaving and downing are similar e.g.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">cluster2.manager ! Leave(cluster2.selfMember.address)</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><code class="language-java">cluster2.manager().tell(Leave.create(cluster2.selfMember().address()));</code></pre></dd>
</dl>
<h3><a href="#cluster-subscriptions" name="cluster-subscriptions" class="anchor"><span class="anchor-link"></span></a>Cluster subscriptions</h3>
<p>Cluster <code>subscriptions</code> can be used to receive messages when cluster state changes. For example, registering for all <code>MemberEvent</code>s, then using the <code>manager</code> to have a node leave the cluster will result in events for the node going through the lifecycle described in <a href="common/cluster.html">Cluster Specification</a>.</p>
<p>This example subscribes with a <code>TestProbe</code> but in a real application it would be an Actor:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">val testProbe = TestProbe[MemberEvent]()
cluster1.subscriptions ! Subscribe(testProbe.ref, classOf[MemberEvent])</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><code class="language-java">TestProbe&lt;ClusterEvent.MemberEvent&gt; testProbe = new TestProbe&lt;&gt;(system);
cluster.subscriptions().tell(Subscribe.create(testProbe.ref(), ClusterEvent.MemberEvent.class));</code></pre></dd>
</dl>
<p>Then asking a node to leave:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">cluster1.manager ! Leave(cluster2.selfMember.address)
testProbe.expectMsgType[MemberLeft].member.address shouldEqual cluster2.selfMember.address
testProbe.expectMsgType[MemberExited].member.address shouldEqual cluster2.selfMember.address
testProbe.expectMsgType[MemberRemoved].member.address shouldEqual cluster2.selfMember.address</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><code class="language-java">cluster.manager().tell(Leave.create(cluster2.selfMember().address()));
testProbe.expectMsgType(ClusterEvent.MemberLeft.class);
testProbe.expectMsgType(ClusterEvent.MemberExited.class);
testProbe.expectMsgType(ClusterEvent.MemberRemoved.class);</code></pre></dd>
</dl>
<h2><a href="#serialization" name="serialization" class="anchor"><span class="anchor-link"></span></a>Serialization</h2>
<p>See <a href="https://doc.akka.io/docs/akka/current/scala/serialization.html">serialization</a> for how messages are sent between ActorSystems. Actor references are typically included in the messages, since there is no <code>sender</code>. To serialize actor references to/from string representation you will use the <code>ActorRefResolver</code>. For example here&rsquo;s how a serializer could look for the <code>Ping</code> and <code>Pong</code> messages above: </p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">class PingSerializer(system: ExtendedActorSystem) extends SerializerWithStringManifest {
  private val actorRefResolver = ActorRefResolver(system.toTyped)

  private val PingManifest = &quot;a&quot;
  private val PongManifest = &quot;b&quot;

  override def identifier = 41

  override def manifest(msg: AnyRef) = msg match {
    case _: Ping â‡’ PingManifest
    case Pong    â‡’ PongManifest
  }

  override def toBinary(msg: AnyRef) = msg match {
    case Ping(who) â‡’
      ActorRefResolver(system.toTyped).toSerializationFormat(who).getBytes(StandardCharsets.UTF_8)
    case Pong â‡’
      Array.emptyByteArray
  }

  override def fromBinary(bytes: Array[Byte], manifest: String) = {
    manifest match {
      case PingManifest â‡’
        val str = new String(bytes, StandardCharsets.UTF_8)
        val ref = actorRefResolver.resolveActorRef[Pong.type](str)
        Ping(ref)
      case PongManifest â‡’
        Pong
    }
  }
}</code></pre></dd>
</dl>
</div>
</article>

<div class="row">
<div class="small-12 large-9 column">
<section class="nav-prev-next row">
<div class="nav-prev small-6 column">
<a href="actor-discovery-typed.html"><i class="icon-prev"></i> <span class="link-prev">Actor discovery</span></a>
</div>
<div class="nav-next small-6 column clearfix">
<a class="float-right" href="cluster-sharding-typed.html">Sharding <i class="icon-next"></i></a>
</div>
</section>
</div>
</div>

<div class="source-github row">
Found an error in this documentation? The source code for this page can be found <a href="https://github.com/johanandren/akka/tree/master/akka-docs/src/main/paradox/cluster-typed.md">here</a>.
Please feel free to edit and contribute a pull request.
</div>


<footer class="page-footer row clearfix">
<img class="akka-icon float-left show-for-medium" src="images/akka-icon.svg">
<section class="copyright">
<div>&copy; 2011-2018 <a href="https://www.lightbend.com">Lightbend</a></div>
<div>Akka is Open Source and available under the Apache 2 License.</div>
</section>
</footer>

</section>
</main>

<script type="text/javascript" src="js/scrollsneak.js"></script>
<script type="text/javascript">jQuery(document).foundation();</script>
<script type="text/javascript" src="js/groups.js"></script>
<script type="text/javascript" src="js/page.js"></script>
<script type="text/javascript" src="js/magellan.js"></script>

<style type="text/css">@import "lib/prettify/prettify.css";</style>
<script type="text/javascript" src="lib/prettify/prettify.js"></script>
<script type="text/javascript" src="lib/prettify/lang-scala.js"></script>
<script type="text/javascript">jQuery(function(){window.prettyPrint && prettyPrint()});</script>

<!-- Algolia docs search -->
<script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.js"></script>
<style>.algolia-autocomplete { display: block !important }</style>
<script type="text/javascript">
var lang = "scala";
var path = window.location.pathname;
if (path.includes("/java/") || path.includes("java.html")) {
lang = "java";
}

docsearch({
apiKey: '543bad5ad786495d9ccd445ed34ed082',
indexName: 'akka_io',
inputSelector: '#search',
algoliaOptions: {
hitsPerPage: 5,
facetFilters: ["language:" + lang]
}
});

docsearch({
apiKey: '543bad5ad786495d9ccd445ed34ed082',
indexName: 'akka_io',
inputSelector: '#overlay-search',
algoliaOptions: {
hitsPerPage: 5,
facetFilters: ["language:" + lang]
}
});

// set up "/" as global shortcut for focusing on search
jQuery(document).keypress(function (event) {
if (event.keyCode == 47) {
jQuery("#search").focus();
return false; // swallow key event, otherwise the / char would be input into the search box
}
});
</script>


</body>
</html>
