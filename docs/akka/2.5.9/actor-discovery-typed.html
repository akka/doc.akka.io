<!DOCTYPE html>
<html class="no-js" lang="en">

<head>
<title>Actor discovery &bull; Akka Documentation</title>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<meta name="description" content="Akka is a toolkit for building highly concurrent, distributed, and resilient message-driven applications for Java and Scala."/>
<link rel="canonical" href="https://doc.akka.io/docs/akka/current/actor-discovery-typed.html"/>
<script type="text/javascript" src="lib/jquery/jquery.min.js"></script>
<script type="text/javascript" src="lib/foundation/dist/js/foundation.min.js"></script>
<link rel="stylesheet" type="text/css" href="lib/normalize.css/normalize.css"/>
<link rel="stylesheet" type="text/css" href="lib/foundation/dist/css/foundation.min.css"/>
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.css" />
<link rel="stylesheet" type="text/css" href="css/icons.css"/>
<link rel="stylesheet" type="text/css" href="css/page.css"/>
<link rel="shortcut icon" href="images/favicon.ico" />
<link rel="apple-touch-icon" sizes="180x180" href="images/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="images/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="images/favicon-16x16.png">
<link rel="manifest" href="images/manifest.json">
<meta name="msapplication-TileImage" content="images/mstile-150x150.png">
<meta name="msapplication-TileColor" content="#15a9ce">
<meta name="theme-color" content="#15a9ce">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<!--Google Analytics-->
<script type="text/javascript">
var _gaq = _gaq || [];
_gaq.push(['_setAccount', 'UA-21117439-1']);
_gaq.push(['_setDomainName', 'akka.io']);
_gaq.push(['_trackPageview']);
(function() {
var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})()
</script>
<!--Google Analytics & Marketo-->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-23127719-1', 'lightbend.com', {'allowLinker': true, 'name': 'tsTracker'});
ga('tsTracker.require', 'linker');
ga('tsTracker.linker:autoLink', ['lightbend.com','playframework.com','scala-lang.org','scaladays.org','spray.io','akka.io','scala-sbt.org','scala-ide.org']);
ga('tsTracker.send', 'pageview');
(function() {
var didInit = false;
function initMunchkin() {
if(didInit === false) {
didInit = true;
Munchkin.init('558-NCX-702');
}
}
var s = document.createElement('script');
s.type = 'text/javascript';
s.async = true;
s.src = '//munchkin.marketo.net/munchkin.js';
s.onreadystatechange = function() {
if (this.readyState == 'complete' || this.readyState == 'loaded') {
initMunchkin();
}
};
s.onload = initMunchkin;
document.getElementsByTagName('head')[0].appendChild(s);
})();
</script>

</head>

<body id="underlay" data-toggler="nav-open">

<header class="site-header hide-for-large">
<div class="sticky-header clearfix">
<a href="https://akka.io"><img class="logo" src="images/akka-logo-reverse.svg"></a>

<button class="menu-icon float-right" type="button" data-toggle="underlay overlay"></button>
</div>
<div id="overlay" class="overlay-nav" data-toggler="nav-open">
<header class="nav-header">
<div class="nav-header-title">
<h1><a href="index.html">Akka Documentation</a></h1>
</div>
<div class="nav-header-version">
Version 2.5.9
</div>
<div class="nav-header-groups">
<select class="supergroup" name="Language"><option class="group" value="group-scala">Scala</option><option class="group" value="group-java">Java</option></select>
</div>
<div id="overlay-search-container" class="nav-header-search">
<input id="overlay-search" type="search" class="search" placeholder="Search"/>
</div>
</header>
<nav class="nav-toc">
<ul>
  <li><a href="security/index.html" class="page">Security Announcements</a></li>
  <li><a href="guide/index.html" class="page">Getting Started Guide</a></li>
  <li><a href="general/index.html" class="page">General Concepts</a></li>
  <li><a href="index-actors.html" class="page">Actors</a></li>
  <li><a href="index-typed.html" class="page">Akka Typed</a>
  <ul>
    <li><a href="actors-typed.html" class="page">Actors</a></li>
    <li><a href="coexisting.html" class="page">Coexistence</a></li>
    <li><a href="fault-tolerance-typed.html" class="page">Fault Tolerance</a></li>
    <li><a href="actor-discovery-typed.html#actor-discovery" class="active page">Actor discovery</a>
    <ul>
      <li><a href="actor-discovery-typed.html#receptionist" class="header">Receptionist</a></li>
      <li><a href="actor-discovery-typed.html#cluster-receptionist" class="header">Cluster Receptionist</a></li>
    </ul></li>
    <li><a href="cluster-typed.html" class="page">Cluster</a></li>
    <li><a href="cluster-sharding-typed.html" class="page">Sharding</a></li>
    <li><a href="persistence-typed.html" class="page">Persistence</a></li>
    <li><a href="testing-typed.html" class="page">Testing</a></li>
  </ul></li>
  <li><a href="index-cluster.html" class="page">Clustering</a></li>
  <li><a href="stream/index.html" class="page">Streams</a></li>
  <li><a href="index-network.html" class="page">Networking</a></li>
  <li><a href="index-futures.html" class="page">Futures and Agents</a></li>
  <li><a href="index-utilities.html" class="page">Utilities</a></li>
  <li><a href="common/other-modules.html" class="page">Other Akka modules</a></li>
  <li><a href="howto.html" class="page">HowTo: Common Patterns</a></li>
  <li><a href="project/index.html" class="page">Project Information</a></li>
  <li><a href="additional/index.html" class="page">Additional Information</a></li>
</ul>
</nav>
</div>
</header>

<aside class="show-for-large">
<header class="nav-header fixed-sidebar-header">
<div class="nav-header-title">
<h1><a href="index.html">Akka Documentation</a></h1>
</div>
<div class="nav-header-version">
Version 2.5.9
</div>
<div class="nav-header-groups">
<select class="supergroup" name="Language"><option class="group" value="group-scala">Scala</option><option class="group" value="group-java">Java</option></select>
</div>
<div class="nav-header-search">
<input id="search" type="search" class="search" placeholder="Search"/>
</div>
</header>
<nav class="site-nav fixed-sidebar-contents">
<div class="nav-toc">
<ul>
  <li><a href="security/index.html" class="page">Security Announcements</a></li>
  <li><a href="guide/index.html" class="page">Getting Started Guide</a></li>
  <li><a href="general/index.html" class="page">General Concepts</a></li>
  <li><a href="index-actors.html" class="page">Actors</a></li>
  <li><a href="index-typed.html" class="page">Akka Typed</a>
  <ul>
    <li><a href="actors-typed.html" class="page">Actors</a></li>
    <li><a href="coexisting.html" class="page">Coexistence</a></li>
    <li><a href="fault-tolerance-typed.html" class="page">Fault Tolerance</a></li>
    <li><a href="actor-discovery-typed.html#actor-discovery" class="active page">Actor discovery</a>
    <ul>
      <li><a href="actor-discovery-typed.html#receptionist" class="header">Receptionist</a></li>
      <li><a href="actor-discovery-typed.html#cluster-receptionist" class="header">Cluster Receptionist</a></li>
    </ul></li>
    <li><a href="cluster-typed.html" class="page">Cluster</a></li>
    <li><a href="cluster-sharding-typed.html" class="page">Sharding</a></li>
    <li><a href="persistence-typed.html" class="page">Persistence</a></li>
    <li><a href="testing-typed.html" class="page">Testing</a></li>
  </ul></li>
  <li><a href="index-cluster.html" class="page">Clustering</a></li>
  <li><a href="stream/index.html" class="page">Streams</a></li>
  <li><a href="index-network.html" class="page">Networking</a></li>
  <li><a href="index-futures.html" class="page">Futures and Agents</a></li>
  <li><a href="index-utilities.html" class="page">Utilities</a></li>
  <li><a href="common/other-modules.html" class="page">Other Akka modules</a></li>
  <li><a href="howto.html" class="page">HowTo: Common Patterns</a></li>
  <li><a href="project/index.html" class="page">Project Information</a></li>
  <li><a href="additional/index.html" class="page">Additional Information</a></li>
</ul>
</div>
</nav>
<footer class="nav-footer fixed-sidebar-footer">
<a href="https://akka.io"><img class="logo" src="images/akka-logo-reverse.svg"></a>

</footer>
</aside>

<main class="fixed-shift-for-large expanded row">
<section class="site-content small-12 column">

<article class="page-content row">
<div class="small-12 large-9 column" id="docs">
<h1><a href="#actor-discovery" name="actor-discovery" class="anchor"><span class="anchor-link"></span></a>Actor discovery</h1>
<p>With <a href="general/addressing.html">untyped actors</a> you would use <code>ActorSelection</code> to &ldquo;lookup&rdquo; actors. Given an actor path with address information you can get hold of an <code>ActorRef</code> to any actor. <code>ActorSelection</code> does not exist in Akka Typed, so how do you get the actor references? You can send refs in messages but you need something to bootstrap the interaction.</p>
<h2><a href="#receptionist" name="receptionist" class="anchor"><span class="anchor-link"></span></a>Receptionist</h2>
<p>For this purpose there is an actor called the <code>Receptionist</code>. You register the specific actors that should be discoverable from other nodes in the local <code>Receptionist</code> instance. The API of the receptionist is also based on actor messages. This registry of actor references is then automatically distributed to all other nodes in the cluster. You can lookup such actors with the key that was used when they were registered. The reply to such a <code>Find</code> request is a <code>Listing</code>, which contains a <code>Set</code> of actor references that are registered for the key. Note that several actors can be registered to the same key.</p>
<p>The registry is dynamic. New actors can be registered during the lifecycle of the system. Entries are removed when registered actors are stopped or a node is removed from the cluster. To facilitate this dynamic aspect you can also subscribe to changes with the <code>Receptionist.Subscribe</code> message. It will send <code>Listing</code> messages to the subscriber when entries for a key are changed.</p>
<p>The first scenario is an actor running that needs to be discovered by another actor but you are unable to put a reference to it in an incoming message.</p>
<p>First we create a <code>PingService</code> actor and register it with the <code>Receptionist</code> against a <code>ServiceKey</code> that will later be used to lookup the reference:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">val PingServiceKey = ServiceKey[Ping](&quot;pingService&quot;)

final case class Ping(replyTo: ActorRef[Pong.type])
final case object Pong

val pingService: Behavior[Ping] =
  Actor.deferred { ctx ⇒
    ctx.system.receptionist ! Receptionist.Register(PingServiceKey, ctx.self, ctx.system.deadLetters)
    Actor.immutable[Ping] { (_, msg) ⇒
      msg match {
        case Ping(replyTo) ⇒
          replyTo ! Pong
          Actor.stopped
      }
    }
  }</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><code class="language-java">static ServiceKey&lt;Ping&gt; PingServiceKey =
  ServiceKey.create(Ping.class, &quot;pingService&quot;);

public static class Pong {}
public static class Ping {
  private final ActorRef&lt;Pong&gt; replyTo;
  Ping(ActorRef&lt;Pong&gt; replyTo) {
    this.replyTo = replyTo;
  }
}

static Behavior&lt;Ping&gt; pingService() {
  return Actor.deferred((ctx) -&gt; {
    ctx.getSystem().receptionist()
      .tell(new Receptionist.Register&lt;&gt;(PingServiceKey, ctx.getSelf(), ctx.getSystem().deadLetters()));
    return Actor.immutable(Ping.class)
      .onMessage(Ping.class, (c, msg) -&gt; {
        msg.replyTo.tell(new Pong());
        return Actor.same();
      }).build();
  });
}</code></pre></dd>
</dl>
<p>Then we have another actor that requires a <code>PingService</code> to be constructed:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">def pinger(pingService: ActorRef[Ping]) = Actor.deferred[Pong.type] { ctx ⇒
  pingService ! Ping(ctx.self)
  Actor.immutable { (_, msg) ⇒
    println(&quot;I was ponged!!&quot; + msg)
    Actor.same
  }
}</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><code class="language-java">static Behavior&lt;Pong&gt; pinger(ActorRef&lt;Ping&gt; pingService) {
  return Actor.deferred((ctx) -&gt; {
    pingService.tell(new Ping(ctx.getSelf()));
    return Actor.immutable(Pong.class)
      .onMessage(Pong.class, (c, msg) -&gt; {
        System.out.println(&quot;I was ponged! &quot; + msg);
        return Actor.same();
      }).build();
  });
}</code></pre></dd>
</dl>
<p>Finally in the guardian actor we spawn the service as well as subscribing to any actors registering against the <code>ServiceKey</code>. Subscribing means that the guardian actor will be informed of any new registrations via a <code>Listing</code> message:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">val guardian: Behavior[Listing[Ping]] = Actor.deferred { ctx ⇒
  ctx.system.receptionist ! Receptionist.Subscribe(PingServiceKey, ctx.self)
  val ps = ctx.spawnAnonymous(pingService)
  ctx.watch(ps)
  Actor.immutablePartial[Listing[Ping]] {
    case (c, Listing(PingServiceKey, listings)) if listings.nonEmpty ⇒
      listings.foreach(ps ⇒ ctx.spawnAnonymous(pinger(ps)))
      Actor.same
  } onSignal {
    case (_, Terminated(`ps`)) ⇒
      println(&quot;Ping service has shut down&quot;)
      Actor.stopped
  }
}</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><code class="language-java">static Behavior&lt;Receptionist.Listing&lt;Ping&gt;&gt; guardian() {
  return Actor.deferred((ctx) -&gt; {
    ctx.getSystem().receptionist()
      .tell(new Receptionist.Subscribe&lt;&gt;(PingServiceKey, ctx.getSelf()));
    ActorRef&lt;Ping&gt; ps = ctx.spawnAnonymous(pingService());
    ctx.watch(ps);
    return Actor.immutable((c, msg) -&gt; {
      msg.getServiceInstances().forEach(ar -&gt; ctx.spawnAnonymous(pinger(ar)));
      return Actor.same();
    });
  });
}</code></pre></dd>
</dl>
<p>Each time a new (which is just a single time in this example) <code>PingService</code> is registered the guardian actor spawns a pinger to ping it.</p>
<h2><a href="#cluster-receptionist" name="cluster-receptionist" class="anchor"><span class="anchor-link"></span></a>Cluster Receptionist</h2>
<p>The <code>Receptionist</code> also works in a cluster, an actor registered to the receptionist will appear in the receptionist of the other nodes of the cluster.</p>
<p>The state for the receptionist is propagated via <a href="distributed-data.html">distributed data</a> which means that each node will eventually reach the same set of actors per <code>ServiceKey</code>.</p>
<p>One important difference from a local only receptions is the serialisation concerns, all messages sent to and back from an actor on another node must be serializable, see <a href="cluster-typed.html#serialization">clustering</a>.</p>
</div>
</article>

<div class="row">
<div class="small-12 large-9 column">
<section class="nav-prev-next row">
<div class="nav-prev small-6 column">
<a href="fault-tolerance-typed.html"><i class="icon-prev"></i> <span class="link-prev">Fault Tolerance</span></a>
</div>
<div class="nav-next small-6 column clearfix">
<a class="float-right" href="cluster-typed.html">Cluster <i class="icon-next"></i></a>
</div>
</section>
</div>
</div>

<div class="source-github row">
Found an error in this documentation? The source code for this page can be found <a href="https://github.com/akka/akka/tree/master/akka-docs/src/main/paradox/actor-discovery-typed.md">here</a>.
Please feel free to edit and contribute a pull request.
</div>


<footer class="page-footer row clearfix">
<img class="akka-icon float-left show-for-medium" src="images/akka-icon.svg">
<section class="copyright">
<div>&copy; 2011-2018 <a href="https://www.lightbend.com">Lightbend</a></div>
<div>Akka is Open Source and available under the Apache 2 License.</div>
</section>
</footer>

</section>
</main>

<script type="text/javascript" src="js/scrollsneak.js"></script>
<script type="text/javascript">jQuery(document).foundation();</script>
<script type="text/javascript" src="js/groups.js"></script>
<script type="text/javascript" src="js/page.js"></script>
<script type="text/javascript" src="js/magellan.js"></script>

<style type="text/css">@import "lib/prettify/prettify.css";</style>
<script type="text/javascript" src="lib/prettify/prettify.js"></script>
<script type="text/javascript" src="lib/prettify/lang-scala.js"></script>
<script type="text/javascript">jQuery(function(){window.prettyPrint && prettyPrint()});</script>

<!-- Algolia docs search -->
<script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.js"></script>
<style>.algolia-autocomplete { display: block !important }</style>
<script type="text/javascript">
var lang = "scala";
var path = window.location.pathname;
if (path.includes("/java/") || path.includes("java.html")) {
lang = "java";
}

docsearch({
apiKey: '543bad5ad786495d9ccd445ed34ed082',
indexName: 'akka_io',
inputSelector: '#search',
algoliaOptions: {
hitsPerPage: 5,
facetFilters: ["language:" + lang]
}
});

docsearch({
apiKey: '543bad5ad786495d9ccd445ed34ed082',
indexName: 'akka_io',
inputSelector: '#overlay-search',
algoliaOptions: {
hitsPerPage: 5,
facetFilters: ["language:" + lang]
}
});

// set up "/" as global shortcut for focusing on search
jQuery(document).keypress(function (event) {
if (event.keyCode == 47) {
jQuery("#search").focus();
return false; // swallow key event, otherwise the / char would be input into the search box
}
});
</script>


</body>
</html>
