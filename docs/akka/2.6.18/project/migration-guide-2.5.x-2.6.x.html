<!DOCTYPE html>
<html class="no-js" lang="en">

<head>
<title>Migration Guide 2.5.x to 2.6.x &bull; Akka Documentation</title>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<meta name="description" content="Migrating to Akka 2.6."/>
<link rel="canonical" href="https://doc.akka.io/docs/akka/current/project/migration-guide-2.5.x-2.6.x.html"/>
<script type="text/javascript" src="../lib/jquery/jquery.min.js"></script>
<script type="text/javascript" src="../lib/foundation/dist/js/foundation.min.js"></script>
<link rel="stylesheet" type="text/css" href="../lib/normalize.css/normalize.css"/>
<link rel="stylesheet" type="text/css" href="../lib/foundation/dist/css/foundation.min.css"/>
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.css" />
<link rel="stylesheet" type="text/css" href="../css/icons.css"/>
<link rel="stylesheet" type="text/css" href="../css/page-8.css"/>
<link rel="stylesheet" type="text/css" href="../css/banner-2.css"/>
<link rel="shortcut icon" href="../images/favicon.ico" />
<link rel="apple-touch-icon" sizes="180x180" href="../images/apple-touch-icon.png"/>
<link rel="icon" type="image/png" sizes="32x32" href="../images/favicon-32x32.png"/>
<link rel="icon" type="image/png" sizes="16x16" href="../images/favicon-16x16.png"/>
<link rel="manifest" href="../images/manifest.json"/>
<meta name="msapplication-TileImage" content="../images/mstile-150x150.png"/>
<meta name="msapplication-TileColor" content="#15a9ce"/>
<meta name="theme-color" content="#15a9ce"/>
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>
<!-- OneTrust Cookies Consent Notice (Production Standard, akka.io, en-GB) start -->
<script src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js"  type="text/javascript" charset="UTF-8" data-domain-script="28b912e7-09e9-43d5-91e4-3d1897044004" ></script>
<script type="text/javascript">
function OptanonWrapper() { }
</script>
<!-- OneTrust Cookies Consent Notice (Production Standard, akka.io, en-GB) end -->
<!--Google Analytics-->
<script type="text/plain" class="optanon-category-2">
var _gaq = _gaq || [];
_gaq.push(['_setAccount', 'UA-21117439-1']);
_gaq.push(['_setDomainName', 'akka.io']);
_gaq.push(['_trackPageview']);
(function() {
var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})()
</script>
<!-- Google Tag Manager -->
<script type="text/plain" class="optanon-category-2">
(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-KBJGH35');
</script>
<!--Marketo-->
<script type="text/plain" class="optanon-category-3">
(function() {
var didInit = false;
function initMunchkin() {
if(didInit === false) {
didInit = true;
Munchkin.init('558-NCX-702', { 'asyncOnly': true, 'disableClickDelay': true });
}
}
var s = document.createElement('script');
s.type = 'text/javascript';
s.async = true;
s.src = '//munchkin.marketo.net/munchkin.js';
s.onreadystatechange = function() {
if (this.readyState == 'complete' || this.readyState == 'loaded') {
initMunchkin();
}
};
s.onload = initMunchkin;
document.getElementsByTagName('head')[0].appendChild(s);
})();
</script>
</head>

<body id="underlay" data-toggler="nav-open">
<div id="lightbend-banner" class="lightbend-banner akka full-width" data-category="OSS Lightbend Banner Impression" data-label="Akka Banner Impression">
<div class="oss-wrapper">
<div class="oss-brand">
<a class="oss-track-link-label" data-category="OSS Lightbend Banner Clicks" data-label="Lightbend Logo - Akka Banner" href="https://www.lightbend.com">
<img class="lightbend-logo" src="../images/banner-logos/lightbend-reverse.svg" alt="Lightbend" title="Lightbend">
</a>
</div>
<div class="oss-ad no-drop-down">
<nav id="lightbendRotator" class="lightbend-rotator">
<a class="oss-track-link-label" data-category="OSS Lightbend Banner Clicks" data-label="Promo Rotator - Akka Serverless - Keep the data. Lose the database. Try now for free. [Learn More] - Akka Banner" href="https://www.lightbend.com/akka-serverless">
<strong>Akka Serverless</strong> - Keep the data. Lose the database. Try now for free. <span class="akka-btn">Learn More</span>
</a>
<a class="oss-track-link-label" data-category="OSS Lightbend Banner Clicks" data-label="Promo Rotator - Using AWS or GCP? Simplify deployments with Akka Cloud Platform [Learn More] - Akka Banner" href="https://www.lightbend.com/akka-cloud-platform">
<strong>Using AWS or GCP?</strong>&nbsp;&nbsp;Simplify deployments with Akka Cloud Platform. <span class="akka-btn">Learn More</span>
</a>
</nav>
</div>
</div>
</div>

<header class="site-header hide-for-large">
<div class="sticky-header clearfix">
<a href="https://akka.io"><img class="logo" src="../images/akka-logo-reverse.svg"/></a>

<button class="menu-icon float-right" type="button" data-toggle="underlay overlay"></button>
</div>
<div id="overlay" class="overlay-nav" data-toggler="nav-open">
<header class="nav-header">
<div class="nav-header-title">
<h1><a href="../index.html">Akka Documentation</a></h1>
</div>
<div class="nav-header-version">
Version 2.6.18
</div>
<div class="nav-header-groups">
<select class="supergroup" name="Language"><option class="group" value="group-scala">Scala</option><option class="group" value="group-java">Java</option></select>
</div>
<div id="overlay-search-container" class="nav-header-search">
<input id="overlay-search" type="search" class="search" placeholder="Search" />
</div>
</header>
<nav class="nav-toc">
<ul>
  <li><a href="../security/index.html" class="page">Security Announcements</a></li>
  <li><a href="../typed/guide/index.html" class="page">Getting Started Guide</a></li>
  <li><a href="../general/index.html" class="page">General Concepts</a></li>
  <li><a href="../typed/index.html" class="page">Actors</a></li>
  <li><a href="../typed/index-cluster.html" class="page">Cluster</a></li>
  <li><a href="../typed/index-persistence.html" class="page">Persistence (Event Sourcing)</a></li>
  <li><a href="../typed/index-persistence-durable-state.html" class="page">Persistence (Durable State)</a></li>
  <li><a href="../stream/index.html" class="page">Streams</a></li>
  <li><a href="../discovery/index.html" class="page">Discovery</a></li>
  <li><a href="../index-utilities.html" class="page">Utilities</a></li>
  <li><a href="../common/other-modules.html" class="page">Other Akka modules</a></li>
  <li><a href="../additional/deploy.html" class="page">Package, Deploy and Run</a></li>
  <li><a href="../project/index.html" class="page">Project Information</a>
  <ul>
    <li><a href="../common/binary-compatibility-rules.html" class="page">Binary Compatibility Rules</a></li>
    <li><a href="../project/scala3.html" class="page">Scala 3 support</a></li>
    <li><a href="../project/downstream-upgrade-strategy.html" class="page">Downstream upgrade strategy</a></li>
    <li><a href="../common/may-change.html" class="page">Modules marked &ldquo;May Change&rdquo;</a></li>
    <li><a href="../additional/ide.html" class="page">IDE Tips</a></li>
    <li><a href="../project/immutable.html" class="page">Immutability using Lombok</a></li>
    <li><a href="../additional/osgi.html" class="page">Akka in OSGi</a></li>
    <li><a href="../project/migration-guides.html" class="page">Migration Guides</a>
    <ul>
      <li><a href="../project/migration-guide-2.5.x-2.6.x.html#migration-guide-2-5-x-to-2-6-x" class="active page">Migration Guide 2.5.x to 2.6.x</a>
      <ul>
        <li><a href="../project/migration-guide-2.5.x-2.6.x.html#scala-2-11-no-longer-supported" class="header">Scala 2.11 no longer supported</a></li>
        <li><a href="../project/migration-guide-2.5.x-2.6.x.html#auto-downing-removed" class="header">Auto-downing removed</a></li>
        <li><a href="../project/migration-guide-2.5.x-2.6.x.html#removed-features-that-were-deprecated" class="header">Removed features that were deprecated</a></li>
        <li><a href="../project/migration-guide-2.5.x-2.6.x.html#deprecated-features" class="header">Deprecated features</a></li>
        <li><a href="../project/migration-guide-2.5.x-2.6.x.html#remoting" class="header">Remoting</a></li>
        <li><a href="../project/migration-guide-2.5.x-2.6.x.html#java-serialization" class="header">Java Serialization</a></li>
        <li><a href="../project/migration-guide-2.5.x-2.6.x.html#configuration-and-behavior-changes" class="header">Configuration and behavior changes</a></li>
        <li><a href="../project/migration-guide-2.5.x-2.6.x.html#source-incompatibilities" class="header">Source incompatibilities</a></li>
        <li><a href="../project/migration-guide-2.5.x-2.6.x.html#akka-typed" class="header">Akka Typed</a></li>
        <li><a href="../project/migration-guide-2.5.x-2.6.x.html#akka-stream-changes" class="header">Akka Stream changes</a></li>
      </ul></li>
      <li><a href="../project/migration-guide-2.4.x-2.5.x.html" class="page">Migration Guide 2.4.x to 2.5.x</a></li>
      <li><a href="../project/migration-guide-old.html" class="page">Older Migration Guides</a></li>
    </ul></li>
    <li><a href="../project/rolling-update.html" class="page">Rolling Updates and Versions</a></li>
    <li><a href="../project/issue-tracking.html" class="page">Issue Tracking</a></li>
    <li><a href="../project/licenses.html" class="page">Licenses</a></li>
    <li><a href="../additional/faq.html" class="page">Frequently Asked Questions</a></li>
    <li><a href="../additional/books.html" class="page">Books and Videos</a></li>
    <li><a href="../project/examples.html" class="page">Example projects</a></li>
    <li><a href="../project/links.html" class="page">Project</a></li>
  </ul></li>
  <li><a href="../index-classic.html" class="page">Akka Classic</a></li>
</ul>
</nav>
</div>
</header>
<div class="site-content-wrapper">
<aside class="sticky-sidebar show-for-large">
<header class="nav-header sticky-sidebar-header">
<div class="nav-header-title">
<h1><a href="../index.html">Akka Documentation</a></h1>
</div>
<div class="nav-header-version">
Version 2.6.18
</div>
<div class="nav-header-groups">
<select class="supergroup" name="Language"><option class="group" value="group-scala">Scala</option><option class="group" value="group-java">Java</option></select>
</div>
<div class="nav-header-search">
<input id="search" type="search" class="search" placeholder="Search" />
</div>
</header>
<nav class="site-nav sticky-sidebar-contents">
<div class="nav-toc">
<ul>
  <li><a href="../security/index.html" class="page">Security Announcements</a></li>
  <li><a href="../typed/guide/index.html" class="page">Getting Started Guide</a></li>
  <li><a href="../general/index.html" class="page">General Concepts</a></li>
  <li><a href="../typed/index.html" class="page">Actors</a></li>
  <li><a href="../typed/index-cluster.html" class="page">Cluster</a></li>
  <li><a href="../typed/index-persistence.html" class="page">Persistence (Event Sourcing)</a></li>
  <li><a href="../typed/index-persistence-durable-state.html" class="page">Persistence (Durable State)</a></li>
  <li><a href="../stream/index.html" class="page">Streams</a></li>
  <li><a href="../discovery/index.html" class="page">Discovery</a></li>
  <li><a href="../index-utilities.html" class="page">Utilities</a></li>
  <li><a href="../common/other-modules.html" class="page">Other Akka modules</a></li>
  <li><a href="../additional/deploy.html" class="page">Package, Deploy and Run</a></li>
  <li><a href="../project/index.html" class="page">Project Information</a>
  <ul>
    <li><a href="../common/binary-compatibility-rules.html" class="page">Binary Compatibility Rules</a></li>
    <li><a href="../project/scala3.html" class="page">Scala 3 support</a></li>
    <li><a href="../project/downstream-upgrade-strategy.html" class="page">Downstream upgrade strategy</a></li>
    <li><a href="../common/may-change.html" class="page">Modules marked &ldquo;May Change&rdquo;</a></li>
    <li><a href="../additional/ide.html" class="page">IDE Tips</a></li>
    <li><a href="../project/immutable.html" class="page">Immutability using Lombok</a></li>
    <li><a href="../additional/osgi.html" class="page">Akka in OSGi</a></li>
    <li><a href="../project/migration-guides.html" class="page">Migration Guides</a>
    <ul>
      <li><a href="../project/migration-guide-2.5.x-2.6.x.html#migration-guide-2-5-x-to-2-6-x" class="active page">Migration Guide 2.5.x to 2.6.x</a>
      <ul>
        <li><a href="../project/migration-guide-2.5.x-2.6.x.html#scala-2-11-no-longer-supported" class="header">Scala 2.11 no longer supported</a></li>
        <li><a href="../project/migration-guide-2.5.x-2.6.x.html#auto-downing-removed" class="header">Auto-downing removed</a></li>
        <li><a href="../project/migration-guide-2.5.x-2.6.x.html#removed-features-that-were-deprecated" class="header">Removed features that were deprecated</a></li>
        <li><a href="../project/migration-guide-2.5.x-2.6.x.html#deprecated-features" class="header">Deprecated features</a></li>
        <li><a href="../project/migration-guide-2.5.x-2.6.x.html#remoting" class="header">Remoting</a></li>
        <li><a href="../project/migration-guide-2.5.x-2.6.x.html#java-serialization" class="header">Java Serialization</a></li>
        <li><a href="../project/migration-guide-2.5.x-2.6.x.html#configuration-and-behavior-changes" class="header">Configuration and behavior changes</a></li>
        <li><a href="../project/migration-guide-2.5.x-2.6.x.html#source-incompatibilities" class="header">Source incompatibilities</a></li>
        <li><a href="../project/migration-guide-2.5.x-2.6.x.html#akka-typed" class="header">Akka Typed</a></li>
        <li><a href="../project/migration-guide-2.5.x-2.6.x.html#akka-stream-changes" class="header">Akka Stream changes</a></li>
      </ul></li>
      <li><a href="../project/migration-guide-2.4.x-2.5.x.html" class="page">Migration Guide 2.4.x to 2.5.x</a></li>
      <li><a href="../project/migration-guide-old.html" class="page">Older Migration Guides</a></li>
    </ul></li>
    <li><a href="../project/rolling-update.html" class="page">Rolling Updates and Versions</a></li>
    <li><a href="../project/issue-tracking.html" class="page">Issue Tracking</a></li>
    <li><a href="../project/licenses.html" class="page">Licenses</a></li>
    <li><a href="../additional/faq.html" class="page">Frequently Asked Questions</a></li>
    <li><a href="../additional/books.html" class="page">Books and Videos</a></li>
    <li><a href="../project/examples.html" class="page">Example projects</a></li>
    <li><a href="../project/links.html" class="page">Project</a></li>
  </ul></li>
  <li><a href="../index-classic.html" class="page">Akka Classic</a></li>
</ul>
</div>
</nav>
<footer class="nav-footer sticky-sidebar-footer">
<a href="https://akka.io"><img class="logo" src="../images/akka-logo-reverse.svg"/></a>

</footer>
</aside>
<main class="fixed-shift-for-large expanded row">
<section class="site-content small-12 column">
<article class="page-content row">
<div class="small-12 column" id="docs">
<h1><a href="#migration-guide-2-5-x-to-2-6-x" name="migration-guide-2-5-x-to-2-6-x" class="anchor"><span class="anchor-link"></span></a>Migration Guide 2.5.x to 2.6.x</h1>
<p>An overview of the changes in Akka 2.6 is presented in the <a href="https://akka.io/blog/news/2019/12/12/akka-26-intro">What&rsquo;s new in Akka 2.6 video</a> and the <a href="https://akka.io/blog/news/2019/11/06/akka-2.6.0-released">release announcement</a>.</p>
<p>Akka 2.6.x is binary backwards compatible with 2.5.x with the ordinary exceptions listed in the <a href="../common/binary-compatibility-rules.html">Binary Compatibility Rules</a>.</p>
<p>This means that updating an application from Akka 2.5.x to 2.6.x should be a smooth process, and that libraries built for Akka 2.5.x can also be used with Akka 2.6.x. For example Akka HTTP 10.1.10 and Akka Management 1.0.3 can be used with Akka 2.6.0 dependencies. You may have to add explicit dependencies to the new Akka version in your build.</p>
<p>That said, there are some changes to configuration and behavior that should be considered, so reading this migration guide and testing your application thoroughly is recommended.</p>
<p>Rolling updates are possible without shutting down all nodes of the Akka Cluster, but will require configuration adjustments as described in the <a href="migration-guide-2.5.x-2.6.x.html#remoting">Remoting</a> section of this migration guide. Due to the <a href="rolling-update.html#2-6-2-clustermessageserializer-manifests-change">changed serialization of the Cluster messages in Akka 2.6.2</a> a rolling update from 2.5.x must first be made to Akka 2.6.2 and then a second rolling update can change to Akka 2.6.3 or later.</p>
<h2><a href="#scala-2-11-no-longer-supported" name="scala-2-11-no-longer-supported" class="anchor"><span class="anchor-link"></span></a>Scala 2.11 no longer supported</h2>
<p>If you are still using Scala 2.11 then you must upgrade to 2.12 or 2.13</p>
<h2><a href="#auto-downing-removed" name="auto-downing-removed" class="anchor"><span class="anchor-link"></span></a>Auto-downing removed</h2>
<p>Auto-downing of unreachable Cluster members have been removed after warnings and recommendations against using it for many years. It was by default disabled, but could be enabled with configuration <code>akka.cluster.auto-down-unreachable-after</code>.</p>
<p>For alternatives see the <a href="../typed/cluster.html#downing">documentation about Downing</a>.</p>
<p>Auto-downing was a na√Øve approach to remove unreachable nodes from the cluster membership. In a production environment it will eventually break down the cluster. When a network partition occurs, both sides of the partition will see the other side as unreachable and remove it from the cluster. This results in the formation of two separate, disconnected, clusters (known as <em>Split Brain</em>).</p>
<p>This behavior is not limited to network partitions. It can also occur if a node in the cluster is overloaded, or experiences a long GC pause.</p>
<p>When using <a href="../typed/cluster-singleton.html">Cluster Singleton</a> or <a href="../typed/cluster-sharding.html">Cluster Sharding</a> it can break the contract provided by those features. Both provide a guarantee that an actor will be unique in a cluster. With the auto-down feature enabled, it is possible for multiple independent clusters to form (*Split Brain*). When this happens the guaranteed uniqueness will no longer be true resulting in undesirable behavior in the system.</p>
<p>This is even more severe when <a href="../typed/persistence.html">Akka Persistence</a> is used in conjunction with Cluster Sharding. In this case, the lack of unique actors can cause multiple actors to write to the same journal. Akka Persistence operates on a single writer principle. Having multiple writers will corrupt the journal and make it unusable. </p>
<p>Finally, even if you don&rsquo;t use features such as Persistence, Sharding, or Singletons, auto-downing can lead the system to form multiple small clusters. These small clusters will be independent from each other. They will be unable to communicate and as a result you may experience performance degradation. Once this condition occurs, it will require manual intervention in order to reform the cluster.</p>
<p>Because of these issues, auto-downing should <strong>never</strong> be used in a production environment.</p>
<h2><a href="#removed-features-that-were-deprecated" name="removed-features-that-were-deprecated" class="anchor"><span class="anchor-link"></span></a>Removed features that were deprecated</h2>
<p>After being deprecated since 2.5.0, the following have been removed in Akka 2.6.0.</p>
<ul>
  <li>akka-camel module
    <ul>
      <li>As an alternative we recommend <a href="https://doc.akka.io/docs/alpakka/current/">Alpakka</a>.</li>
      <li>This is of course not a drop-in replacement. If there is community interest we are open to setting up akka-camel as a separate community-maintained repository.</li>
    </ul>
  </li>
  <li>akka-agent module
    <ul>
      <li>If there is interest it may be moved to a separate, community-maintained repository.</li>
    </ul>
  </li>
  <li>akka-contrib module
    <ul>
      <li>To migrate, take the components you are using from <a href="https://github.com/akka/akka/tree/release-2.5/akka-contrib">Akka 2.5</a> and include them in your own project or library under your own package name.</li>
    </ul>
  </li>
  <li>Actor DSL
    <ul>
      <li>Actor DSL is a rarely used feature. Use plain <code>system.actorOf</code> instead of the DSL to create Actors if you have been using it.</li>
    </ul>
  </li>
  <li><code>akka.stream.extra.Timing</code> operator
    <ul>
      <li>If you need it you can now find it in <code>akka.stream.contrib.Timed</code> from <a href="https://github.com/akka/akka-stream-contrib/blob/master/src/main/scala/akka/stream/contrib/Timed.scala">Akka Stream Contrib</a>.</li>
    </ul>
  </li>
  <li>Netty UDP (Classic remoting over UDP)
    <ul>
      <li>To continue to use UDP configure <a href="../remoting-artery.html#configuring-ssl-tls-for-akka-remoting">Artery UDP</a> or migrate to Artery TCP.</li>
      <li>A full cluster restart is required to change to Artery.</li>
    </ul>
  </li>
  <li><code>UntypedActor</code>
    <ul>
      <li>Use <code>AbstractActor</code> instead.</li>
    </ul>
  </li>
  <li><code>JavaTestKit</code>
    <ul>
      <li>Use <code>akka.testkit.javadsl.TestKit</code> instead.</li>
    </ul>
  </li>
  <li><code>UntypedPersistentActor</code>
    <ul>
      <li>Use <code>AbstractPersistentActor</code> instead.</li>
    </ul>
  </li>
  <li><code>UntypedPersistentActorWithAtLeastOnceDelivery</code>
    <ul>
      <li>Use <span class="group-scala"><a href="https://doc.akka.io/api/akka/2.6/akka/persistence/AbstractPersistentActorWithAtLeastOnceDelivery.html" title="akka.persistence.AbstractPersistentActorWithAtLeastOnceDelivery"><code>AbstractPersistentActorWithAtLeastOnceDelivery</code></a></span><span class="group-java"><a href="https://doc.akka.io/japi/akka/2.6/akka/persistence/AbstractPersistentActorWithAtLeastOnceDelivery.html" title="akka.persistence.AbstractPersistentActorWithAtLeastOnceDelivery"><code>AbstractPersistentActorWithAtLeastOnceDelivery</code></a></span> instead.</li>
    </ul>
  </li>
  <li><code>akka.stream.actor.ActorSubscriber</code> and <code>akka.stream.actor.ActorPublisher</code>
    <ul>
      <li>Use <code>GraphStage</code> instead.</li>
    </ul>
  </li>
</ul>
<p>After being deprecated since 2.4.0, the following have been removed in Akka 2.6.0.</p>
<ul>
  <li>Secure cookie in Classic Akka Remoting</li>
</ul>
<p>After being deprecated since 2.2, the following have been removed in Akka 2.6.0.</p>
<ul>
  <li><code>actorFor</code>
    <ul>
      <li>Use <code>ActorSelection</code> instead.</li>
    </ul>
  </li>
</ul>
<h3><a href="#removed-methods" name="removed-methods" class="anchor"><span class="anchor-link"></span></a>Removed methods</h3>
<ul>
  <li><code>Logging.getLogger(UntypedActor)</code> <code>UntypedActor</code> has been removed, use <code>AbstractActor</code> instead.</li>
  <li><code>LoggingReceive.create(Receive, ActorContext)</code> use <code>AbstractActor.Receive</code> instead.</li>
  <li><code>ActorMaterialzierSettings.withAutoFusing</code> disabling fusing is no longer possible.</li>
  <li><code>AbstractActor.getChild</code> use <code>findChild</code> instead.</li>
  <li><code>Actor.getRef</code> use <code>Actor.getActorRef</code> instead.</li>
  <li><code>CircuitBreaker.onOpen</code> use <code>CircuitBreaker.addOnOpenListener</code></li>
  <li><code>CircuitBreaker.onHalfOpen</code> use <code>CircuitBreaker.addOnHalfOpenListener</code></li>
  <li><code>CircuitBreaker.onClose</code> use <code>CircuitBreaker.addOnCloseListener</code></li>
  <li><code>Source.actorSubscriber</code>, use <code>Source.fromGraph</code> instead.</li>
  <li><code>Source.actorActorPublisher</code>, use <code>Source.fromGraph</code> instead.</li>
</ul>
<h2><a href="#deprecated-features" name="deprecated-features" class="anchor"><span class="anchor-link"></span></a>Deprecated features</h2>
<h3><a href="#persistentfsm" name="persistentfsm" class="anchor"><span class="anchor-link"></span></a>PersistentFSM</h3>
<p><a href="../persistence-fsm.html">Migration guide to Persistence Typed</a> is in the PersistentFSM documentation.</p>
<h3><a href="#typedactor" name="typedactor" class="anchor"><span class="anchor-link"></span></a>TypedActor</h3>
<p><code>akka.actor.TypedActor</code> has been deprecated as of 2.6.0 in favor of the <code>akka.actor.typed</code> API which should be used instead.</p>
<p>There are several reasons for phasing out the old <code>TypedActor</code>. The primary reason is they use transparent remoting which is not our recommended way of implementing and interacting with actors. Transparent remoting is when you try to make remote method invocations look like local calls. In contrast we believe in location transparency with explicit messaging between actors (same type of messaging for both local and remote actors). They also have limited functionality compared to ordinary actors, and worse performance.</p>
<p>To summarize the fallacy of transparent remoting:</p>
<ul>
  <li>Was used in CORBA, RMI, and DCOM, and all of them failed. Those problems were noted by <a href="http://citeseerx.ist.psu.edu/viewdoc/summary?doi=10.1.1.41.7628">Waldo et al already in 1994</a></li>
  <li>Partial failure is a major problem. Remote calls introduce uncertainty whether the function was invoked or not.  Typically handled by using timeouts but the client can&rsquo;t always know the result of the call.</li>
  <li>Latency of calls over a network are several orders of magnitudes longer than latency of local calls,  which can be more than surprising if encoded as an innocent looking local method call.</li>
  <li>Remote invocations have much lower throughput due to the need of serializing the  data and you can&rsquo;t just pass huge datasets in the same way.</li>
</ul>
<p>Therefore explicit message passing is preferred. It looks different from local method calls (<span class="group-scala"><code>actorRef ! message</code></span><span class="group-java"><code>actorRef.tell(message)</code></span>) and there is no misconception that sending a message will result in it being processed instantaneously. The goal of location transparency is to unify message passing for both local and remote interactions, versus attempting to make remote interactions look like local method calls.</p>
<p>Warnings about <code>TypedActor</code> have been <a href="https://doc.akka.io/docs/akka/2.5/typed-actors.html#when-to-use-typed-actors">mentioned in documentation</a> for many years.</p>
<h3><a href="#cluster-client" name="cluster-client" class="anchor"><span class="anchor-link"></span></a>Cluster Client</h3>
<p>Cluster client has been deprecated as of 2.6.0 in favor of <a href="https://doc.akka.io/docs/akka-grpc/current/index.html">Akka gRPC</a>. It is not advised to build new applications with Cluster client, and existing users <a href="../cluster-client.html#migration-to-akka-grpc">should migrate to Akka gRPC</a>.</p>
<h3><a href="#akka-protobuf" name="akka-protobuf" class="anchor"><span class="anchor-link"></span></a>akka-protobuf</h3>
<p><code>akka-protobuf</code> was never intended to be used by end users but perhaps this was not well-documented. Applications should use standard Protobuf dependency instead of <code>akka-protobuf</code>. The artifact is still published, but the transitive dependency to <code>akka-protobuf</code> has been removed.</p>
<p>Akka is now using Protobuf version 3.9.0 for serialization of messages defined by Akka.</p>
<h3><a href="#bytestring-empty" name="bytestring-empty" class="anchor"><span class="anchor-link"></span></a>ByteString.empty</h3>
<p>It is now recommended to use <span class="group-scala"><a href="https://doc.akka.io/api/akka/2.6/akka/util/ByteString.html" title="akka.util.ByteString"><code>ByteString</code></a></span><span class="group-java"><a href="https://doc.akka.io/japi/akka/2.6/akka/util/ByteString.html" title="akka.util.ByteString"><code>ByteString</code></a></span><code>.emptyByteString()</code> instead of <span class="group-scala"><a href="https://doc.akka.io/api/akka/2.6/akka/util/ByteString.html" title="akka.util.ByteString"><code>ByteString</code></a></span><span class="group-java"><a href="https://doc.akka.io/japi/akka/2.6/akka/util/ByteString.html" title="akka.util.ByteString"><code>ByteString</code></a></span><code>.empty()</code> when using Java because <span class="group-scala"><a href="https://doc.akka.io/api/akka/2.6/akka/util/ByteString.html" title="akka.util.ByteString"><code>ByteString</code></a></span><span class="group-java"><a href="https://doc.akka.io/japi/akka/2.6/akka/util/ByteString.html" title="akka.util.ByteString"><code>ByteString</code></a></span><code>.empty()</code> is <a href="https://github.com/scala/bug/issues/11509">no longer available as a static method</a> in the artifacts built for Scala 2.13.</p>
<h3><a href="#akkasslconfig" name="akkasslconfig" class="anchor"><span class="anchor-link"></span></a>AkkaSslConfig</h3>
<p><code>AkkaSslConfig</code> has been deprecated in favor of setting up TLS with <code>javax.net.ssl.SSLEngine</code> directly.</p>
<p>This also means that methods Akka Streams <code>TLS</code> and <code>Tcp</code> that take <code>SSLContext</code> or <code>AkkaSslConfig</code> have been deprecated and replaced with corresponding methods that takes a factory function for creating the <code>SSLEngine</code>.</p>
<p>See documentation of <a href="../stream/stream-io.html#tls">streaming IO with TLS</a>. </p>
<h3><a href="#javalogger" name="javalogger" class="anchor"><span class="anchor-link"></span></a>JavaLogger</h3>
<p><code>akka.event.jul.JavaLogger</code> for integration with <code>java.util.logging</code> has been deprecated. Use SLF4J instead, which also has support for <code>java.util.logging</code>.</p>
<h3><a href="#akka-main" name="akka-main" class="anchor"><span class="anchor-link"></span></a>akka.Main</h3>
<p><code>akka.Main</code> is deprecated in favour of starting the <code>ActorSystem</code> from a custom main class instead. <code>akka.Main</code> was not adding much value and typically a custom main class is needed anyway.</p>
<h3><a href="#pluggable-dns" name="pluggable-dns" class="anchor"><span class="anchor-link"></span></a>Pluggable DNS</h3>
<p>Plugging in your own DNS implementation is now deprecated and will be removed in <code>2.7.0</code>, it was originally added to support a third party DNS provided that supported SRV records. The built in <code>async-dns</code> now supports SRV records.</p>
<p>The <code>resolve</code> and <code>cached</code> methods on the <code>DNS</code> extension have also been deprecated in favour of ones that take in <code>DnsProtocol.Resolve</code>. These methods return a new types that include SRV records.</p>
<h2><a href="#remoting" name="remoting" class="anchor"><span class="anchor-link"></span></a>Remoting</h2>
<h3><a href="#default-remoting-is-now-artery-tcp" name="default-remoting-is-now-artery-tcp" class="anchor"><span class="anchor-link"></span></a>Default remoting is now Artery TCP</h3>
<p><a href="../remoting-artery.html">Artery TCP</a> is now the default remoting implementation. Classic remoting has been deprecated and will be removed in <code>2.7.0</code>.</p>
<a id="classic-to-artery"></a>
<h4><a href="#migrating-from-classic-remoting-to-artery" name="migrating-from-classic-remoting-to-artery" class="anchor"><span class="anchor-link"></span></a>Migrating from classic remoting to Artery</h4>
<p>Artery has the same functionality as classic remoting and you should normally only have to change the configuration to switch.</p>
<p>To switch a full cluster restart is required and any overrides for classic remoting need to be ported to Artery configuration. Artery has a completely different protocol, which means that a rolling update is not supported.</p>
<p>Artery defaults to TCP (see <a href="../remoting-artery.html#selecting-a-transport">selected transport</a>) which is a good start when migrating from classic remoting.</p>
<p>The protocol part in the Akka <code>Address</code>, for example <code>&quot;akka.tcp://actorSystemName@10.0.0.1:2552/user/actorName&quot;</code> has changed from <code>akka.tcp</code> to <code>akka</code>. If you have configured or hardcoded any such addresses you have to change them to <code>&quot;akka://actorSystemName@10.0.0.1:25520/user/actorName&quot;</code>. <code>akka</code> is used also when TLS is enabled. One typical place where such address is used is in the <code>seed-nodes</code> configuration.</p>
<p>The default port is 25520 instead of 2552 to avoid connections between Artery and classic remoting due to misconfiguration. You can run Artery on 2552 if you prefer that (e.g. existing firewall rules) and then you have to configure the port with:</p>
<pre><code>akka.remote.artery.canonical.port = 2552
</code></pre>
<p>The configuration for Artery is different, so you might have to revisit any custom configuration. See the full <a href="../general/configuration-reference.html#config-akka-remote-artery">reference configuration for Artery</a> and <a href="../general/configuration-reference.html#config-akka-remote">reference configuration for classic remoting</a>.</p>
<p>Configuration that is likely required to be ported:</p>
<ul>
  <li><code>akka.remote.netty.tcp.hostname</code> =&gt; <code>akka.remote.artery.canonical.hostname</code></li>
  <li><code>akka.remote.netty.tcp.port</code>=&gt; <code>akka.remote.artery.canonical.port</code></li>
</ul>
<p>If using SSL then <code>tcp-tls</code> needs to be enabled and setup. See <a href="../remoting-artery.html#configuring-ssl-tls-for-akka-remoting">Artery docs for SSL</a> for how to do this.</p>
<p>The following events that are published to the <code>eventStream</code> have changed:</p>
<ul>
  <li>classic <code>akka.remote.QuarantinedEvent</code> is <code>akka.remote.artery.QuarantinedEvent</code> in Artery</li>
  <li>classic <code>akka.remote.GracefulShutdownQuarantinedEvent</code> is <code>akka.remote.artery.GracefulShutdownQuarantinedEvent</code> in Artery</li>
  <li>classic <code>akka.remote.ThisActorSystemQuarantinedEvent</code> is <code>akka.remote.artery.ThisActorSystemQuarantinedEvent</code> in Artery</li>
</ul>
<h4><a href="#migration-from-2-5-x-artery-to-2-6-x-artery" name="migration-from-2-5-x-artery-to-2-6-x-artery" class="anchor"><span class="anchor-link"></span></a>Migration from 2.5.x Artery to 2.6.x Artery</h4>
<p>The following defaults have changed:</p>
<ul>
  <li><code>akka.remote.artery.transport</code> default has changed from <code>aeron-udp</code> to <code>tcp</code></li>
</ul>
<p>The following properties have moved. If you don&rsquo;t adjust these from their defaults no changes are required:</p>
<p>For Aeron-UDP:</p>
<ul>
  <li><code>akka.remote.artery.log-aeron-counters</code> to <code>akka.remote.artery.advanced.aeron.log-aeron-counters</code></li>
  <li><code>akka.remote.artery.advanced.embedded-media-driver</code> to <code>akka.remote.artery.advanced.aeron.embedded-media-driver</code></li>
  <li><code>akka.remote.artery.advanced.aeron-dir</code> to <code>akka.remote.artery.advanced.aeron.aeron-dir</code></li>
  <li><code>akka.remote.artery.advanced.delete-aeron-dir</code> to <code>akka.remote.artery.advanced.aeron.aeron-delete-dir</code></li>
  <li><code>akka.remote.artery.advanced.idle-cpu-level</code> to <code>akka.remote.artery.advanced.aeron.idle-cpu-level</code></li>
  <li><code>akka.remote.artery.advanced.give-up-message-after</code> to <code>akka.remote.artery.advanced.aeron.give-up-message-after</code></li>
  <li><code>akka.remote.artery.advanced.client-liveness-timeout</code> to <code>akka.remote.artery.advanced.aeron.client-liveness-timeout</code></li>
  <li><code>akka.remote.artery.advanced.image-liveless-timeout</code> to <code>akka.remote.artery.advanced.aeron.image-liveness-timeout</code></li>
  <li><code>akka.remote.artery.advanced.driver-timeout</code> to <code>akka.remote.artery.advanced.aeron.driver-timeout</code></li>
</ul>
<p>For TCP:</p>
<ul>
  <li><code>akka.remote.artery.advanced.connection-timeout</code> to <code>akka.remote.artery.advanced.tcp.connection-timeout</code></li>
</ul>
<h4><a href="#remaining-with-classic-remoting-not-recommended-" name="remaining-with-classic-remoting-not-recommended-" class="anchor"><span class="anchor-link"></span></a>Remaining with Classic remoting (not recommended)</h4>
<p>Classic remoting is deprecated but can be used in 2.6.x Rolling update from Classic remoting to Artery is not supported so if you want to update from Akka 2.5.x with Classic remoting to Akka 2.6.x without a full shut down of the Cluster you have to enable Classic remoting. Later, you can plan for a full shutdown and <a href="migration-guide-2.5.x-2.6.x.html#migrating-from-classic-remoting-to-artery">migrate from classic remoting to Artery</a> as a separate step.</p>
<p>Explicitly disable Artery by setting property <code>akka.remote.artery.enabled</code> to <code>false</code>. Further, any configuration under <code>akka.remote</code> that is specific to classic remoting needs to be moved to <code>akka.remote.classic</code>. To see which configuration options are specific to classic search for them in: <a href="../general/configuration-reference.html#config-akka-remote"><code>akka-remote/reference.conf</code></a>.</p>
<p>If you have a <a href="https://www.lightbend.com/lightbend-subscription">Lightbend Subscription</a> you can use our <a href="https://doc.akka.io/docs/akka-enhancements/current/config-checker.html">Config Checker</a> enhancement to flag any settings that have not been properly migrated.</p>
<h3><a href="#persistent-mode-for-cluster-sharding" name="persistent-mode-for-cluster-sharding" class="anchor"><span class="anchor-link"></span></a>Persistent mode for Cluster Sharding</h3>
<p>Cluster Sharding coordinator and <a href="../cluster-sharding.html#remembering-entities">Remembering Entities</a> state could previously be stored in Distributed Data or via Akka Persistence. The Persistence mode has been deprecated in favour of using the Distributed Data mode for the coordinator state. A replacement for the state for Remembered Entities is tracked in <a href="https://github.com/akka/akka/issues/27763">issue 27763</a>.</p>
<h2><a href="#java-serialization" name="java-serialization" class="anchor"><span class="anchor-link"></span></a>Java Serialization</h2>
<p>Java serialization is known to be slow and <a href="https://community.microfocus.com/cyberres/fortify/f/fortify-discussions/317555/the-perils-of-java-deserialization">prone to attacks</a> of various kinds - it never was designed for high throughput messaging after all. One may think that network bandwidth and latency limit the performance of remote messaging, but serialization is a more typical bottleneck.</p>
<p>From Akka 2.6.0 the Akka serialization with Java serialization is disabled by default and Akka itself doesn&rsquo;t use Java serialization for any of its internal messages.</p>
<p>You have to enable <a href="../serialization.html">serialization</a> to send messages between ActorSystems (nodes) in the Cluster. <a href="../serialization-jackson.html">Serialization with Jackson</a> is a good choice in many cases, and our recommendation if you don&rsquo;t have other preferences or constraints.</p>
<p>For compatibility with older systems that rely on Java serialization it can be enabled with the following configuration:</p>
<pre class="prettyprint"><code class="language-ruby">akka.actor.allow-java-serialization = on
</code></pre>
<p>Akka will still log warning when Java serialization is used and to silent that you may add:</p>
<pre class="prettyprint"><code class="language-ruby">akka.actor.warn-about-java-serializer-usage = off
</code></pre>
<h3><a href="#rolling-update" name="rolling-update" class="anchor"><span class="anchor-link"></span></a>Rolling update</h3>
<p>Please see the <a href="../additional/rolling-updates.html#from-java-serialization-to-jackson">rolling update procedure from Java serialization to Jackson</a>.</p>
<h3><a href="#java-serialization-in-consistent-hashing" name="java-serialization-in-consistent-hashing" class="anchor"><span class="anchor-link"></span></a>Java serialization in consistent hashing</h3>
<p>When using a consistent hashing router keys that were not bytes or a String are serialized. You might have to add a serializer for you hash keys, unless one of the default serializer are not handling that type and it was previously &ldquo;accidentally&rdquo; serialized with Java serialization.</p>
<h2><a href="#configuration-and-behavior-changes" name="configuration-and-behavior-changes" class="anchor"><span class="anchor-link"></span></a>Configuration and behavior changes</h2>
<p>The following documents configuration changes and behavior changes where no action is required. In some cases the old behavior can be restored via configuration.</p>
<h3><a href="#remoting-dependencies-have-been-made-optional" name="remoting-dependencies-have-been-made-optional" class="anchor"><span class="anchor-link"></span></a>Remoting dependencies have been made optional</h3>
<p>Classic remoting depends on Netty and Artery UDP depends on Aeron. These are now both optional dependencies that need to be explicitly added. See <a href="../remoting.html">classic remoting</a> or <a href="../remoting-artery.html">artery remoting</a> for instructions.</p>
<h3><a href="#remote-watch-and-deployment-have-been-disabled-without-cluster-use" name="remote-watch-and-deployment-have-been-disabled-without-cluster-use" class="anchor"><span class="anchor-link"></span></a>Remote watch and deployment have been disabled without Cluster use</h3>
<p>By default, these remoting features are disabled when not using Akka Cluster:</p>
<ul>
  <li>Remote Deployment: falls back to creating a local actor</li>
  <li>Remote Watch: ignores the watch and unwatch request, and <code>Terminated</code> will not be delivered when the remote actor is stopped or if a remote node crashes</li>
</ul>
<p>Watching an actor on a node outside the cluster may have unexpected <a href="../remoting-artery.html#quarantine">consequences</a>, such as quarantining so it has been disabled by default in Akka 2.6.x This is the case if either cluster is not used at all (only plain remoting) or when watching an actor outside of the cluster.</p>
<p>On the other hand, failure detection between nodes of the same cluster do not have that shortcoming. Thus, when remote watching or deployment is used within the same cluster, they are working the same in 2.6.x as before, except that a remote watch attempt before a node has joined will log a warning and be ignored, it must be done after the node has joined.</p>
<p>To optionally enable a watch without Akka Cluster or across a Cluster boundary between Cluster and non Cluster, knowing the consequences, all watchers (cluster as well as remote) need to set:</p>
<pre><code>akka.remote.use-unsafe-remote-features-outside-cluster = on`.
</code></pre>
<p>When enabled</p>
<ul>
  <li>An initial warning is logged on startup of <code>RemoteActorRefProvider</code></li>
  <li>
  <p>A warning will be logged on remote watch attempts, which you can suppress by setting</p>
  <pre><code>akka.remote.warn-unsafe-watch-outside-cluster = off
</code></pre></li>
</ul>
<h3><a href="#schedule-periodically-with-fixed-delay-vs-fixed-rate" name="schedule-periodically-with-fixed-delay-vs-fixed-rate" class="anchor"><span class="anchor-link"></span></a>Schedule periodically with fixed-delay vs. fixed-rate</h3>
<p>The <code>Scheduler.schedule</code> method has been deprecated in favor of selecting <code>scheduleWithFixedDelay</code> or <code>scheduleAtFixedRate</code>.</p>
<p>The <a href="../scheduler.html#schedule-periodically">Scheduler</a> documentation describes the difference between <code>fixed-delay</code> and <code>fixed-rate</code> scheduling. If you are uncertain of which one to use you should pick <code>startTimerWithFixedDelay</code>.</p>
<p>The deprecated <code>schedule</code> method had the same semantics as <code>scheduleAtFixedRate</code>, but since that can result in bursts of scheduled tasks or messages after long garbage collection pauses and in the worst case cause undesired load on the system <code>scheduleWithFixedDelay</code> is often preferred.</p>
<p>For the same reason the following methods have also been deprecated:</p>
<ul>
  <li><code>TimerScheduler.startPeriodicTimer</code>, replaced by <code>startTimerWithFixedDelay</code> or <code>startTimerAtFixedRate</code></li>
  <li><code>FSM.setTimer</code>, replaced by <code>startSingleTimer</code>, <code>startTimerWithFixedDelay</code> or <code>startTimerAtFixedRate</code></li>
  <li><code>PersistentFSM.setTimer</code>, replaced by <code>startSingleTimer</code>, <code>startTimerWithFixedDelay</code> or <code>startTimerAtFixedRate</code></li>
</ul>
<h3><a href="#internal-dispatcher-introduced" name="internal-dispatcher-introduced" class="anchor"><span class="anchor-link"></span></a>Internal dispatcher introduced</h3>
<p>To protect the Akka internals against starvation when user code blocks the default dispatcher (for example by accidental use of blocking APIs from actors) a new internal dispatcher has been added. All of Akka&rsquo;s internal, non-blocking actors now run on the internal dispatcher by default.</p>
<p>The dispatcher can be configured through <code>akka.actor.internal-dispatcher</code>.</p>
<p>For maximum performance, you might want to use a single shared dispatcher for all non-blocking, asynchronous actors, user actors and Akka internal actors. In that case, you can configure the <code>akka.actor.internal-dispatcher</code> with a string value of <code>akka.actor.default-dispatcher</code>. This reinstantiates the behavior from previous Akka versions but also removes the isolation between user and Akka internals. So, use at your own risk!</p>
<p>Several <code>use-dispatcher</code> configuration settings that previously accepted an empty value to fall back to the default dispatcher has now gotten an explicit value of <code>akka.actor.internal-dispatcher</code> and no longer accept an empty string as value. If such an empty value is used in your <code>application.conf</code> the same result is achieved by simply removing that entry completely and having the default apply.</p>
<p>For more details about configuring dispatchers, see the <a href="../dispatchers.html">Dispatchers</a></p>
<h3><a href="#default-dispatcher-size" name="default-dispatcher-size" class="anchor"><span class="anchor-link"></span></a>Default dispatcher size</h3>
<p>Previously the factor for the default dispatcher was set a bit high (<code>3.0</code>) to give some extra threads in case of accidental blocking and protect a bit against starving the internal actors. Since the internal actors are now on a separate dispatcher the default dispatcher has been adjusted down to <code>1.0</code> which means the number of threads will be one per core, but at least <code>8</code> and at most <code>64</code>. This can be tuned using the individual settings in <code>akka.actor.default-dispatcher.fork-join-executor</code>.</p>
<h3><a href="#mixed-version" name="mixed-version" class="anchor"><span class="anchor-link"></span></a>Mixed version</h3>
<p>Startup will fail if mixed versions of a product family (such as Akka) are accidentally used. This was previously only logged as a warning. There is no guarantee mixed modules will work and it&rsquo;s better to fail early than that the application is crashing at a later time than startup. </p>
<h3><a href="#cluster-sharding" name="cluster-sharding" class="anchor"><span class="anchor-link"></span></a>Cluster Sharding</h3>
<h4><a href="#waiting-for-state-timeout-reduced-to-2s" name="waiting-for-state-timeout-reduced-to-2s" class="anchor"><span class="anchor-link"></span></a>waiting-for-state-timeout reduced to 2s</h4>
<p>This has been reduced to speed up ShardCoordinator initialization in smaller clusters. The read from ddata is a ReadMajority. For small clusters (&lt; majority-min-cap) every node needs to respond so it is more likely to timeout if there are nodes restarting, for example when there is a rolling re-deploy happening.</p>
<h4><a href="#passivate-idle-entity" name="passivate-idle-entity" class="anchor"><span class="anchor-link"></span></a>Passivate idle entity</h4>
<p>The configuration <code>akka.cluster.sharding.passivate-idle-entity-after</code> is now enabled by default. Sharding will passivate entities when they have not received any messages after this duration. To disable passivation you can use configuration:</p>
<pre><code>akka.cluster.sharding.passivate-idle-entity-after = off
</code></pre>
<p>It is always disabled if <a href="../cluster-sharding.html#remembering-entities">Remembering Entities</a> is enabled.</p>
<h4><a href="#cluster-sharding-stats" name="cluster-sharding-stats" class="anchor"><span class="anchor-link"></span></a>Cluster Sharding stats</h4>
<p>A new field has been added to the response of a <code>ShardRegion.GetClusterShardingStats</code> command for any shards per region that may have failed or not responded within the new configurable <code>akka.cluster.sharding.shard-region-query-timeout</code>. This is described further in <a href="../cluster-sharding.html#inspecting-cluster-sharding-state">inspecting sharding state</a>.</p>
<h3><a href="#distributed-data" name="distributed-data" class="anchor"><span class="anchor-link"></span></a>Distributed Data</h3>
<h4><a href="#config-for-message-payload-size" name="config-for-message-payload-size" class="anchor"><span class="anchor-link"></span></a>Config for message payload size</h4>
<p>Configuration properties for controlling sizes of <code>Gossip</code> and <code>DeltaPropagation</code> messages in Distributed Data have been reduced. Previous defaults sometimes resulted in messages exceeding max payload size for remote actor messages.</p>
<p>The new configuration properties are:</p>
<pre><code>akka.cluster.distributed-data.max-delta-elements = 500
akka.cluster.distributed-data.delta-crdt.max-delta-size = 50
</code></pre>
<h4><a href="#datadeleted" name="datadeleted" class="anchor"><span class="anchor-link"></span></a>DataDeleted</h4>
<p><code>DataDeleted</code> has been changed in its usage. While it is still a possible response to a Delete request, it is no longer the response when an <code>Update</code> or <code>Get</code> request couldn&rsquo;t be performed because the entry has been deleted. In its place are two new possible responses to a request, <code>UpdateDataDeleted</code> for an <code>Update</code> and <code>GetDataDeleted</code> for a <code>Get</code>.</p>
<p>The reason for this change is that <code>DataDeleted</code> didn&rsquo;t extend the <code>UpdateResponse</code> and <code>GetResponse</code> types and could therefore cause problems when <code>Update</code> and <code>Get</code> were used with <code>ask</code>. This was also a problem for Akka Typed.</p>
<h3><a href="#coordinatedshutdown-is-run-from-actorsystem-terminate" name="coordinatedshutdown-is-run-from-actorsystem-terminate" class="anchor"><span class="anchor-link"></span></a>CoordinatedShutdown is run from ActorSystem.terminate</h3>
<p>No migration is needed but it is mentioned here because it is a change in behavior.</p>
<p>When <code>ActorSystem.terminate()</code> is called, <a href="../coordinated-shutdown.html"><code>CoordinatedShutdown</code></a> will be run in Akka 2.6.x, which wasn&rsquo;t the case in 2.5.x. For example, if using Akka Cluster this means that member will attempt to leave the cluster gracefully.</p>
<p>If this is not desired behavior, for example in tests, you can disable this feature with the following configuration and then it will behave as in Akka 2.5.x:</p>
<pre><code>akka.coordinated-shutdown.run-by-actor-system-terminate = off
</code></pre>
<h3><a href="#scheduler-not-running-tasks-when-shutdown" name="scheduler-not-running-tasks-when-shutdown" class="anchor"><span class="anchor-link"></span></a>Scheduler not running tasks when shutdown</h3>
<p>When the <code>ActorSystem</code> was shutting down and the <code>Scheduler</code> was closed all outstanding scheduled tasks were run, which was needed for some internals in Akka but a surprising behavior for end users. Therefore this behavior has changed in Akka 2.6.x and outstanding tasks are not run when the system is terminated.</p>
<p>Instead, <code>system.registerOnTermination</code> or <code>CoordinatedShutdown</code> can be used for running such tasks when shutting down.</p>
<h3><a href="#iosources-fileio" name="iosources-fileio" class="anchor"><span class="anchor-link"></span></a>IOSources &amp; FileIO</h3>
<p><code>FileIO.toPath</code>, <code>StreamConverters.fromInputStream</code>, and <code>StreamConverters.fromOutputStream</code> now always fail the materialized value in case of failure. It is no longer required to both check the materialized value and the <code>Try[Done]</code> inside the <span class="group-scala"><a href="https://doc.akka.io/api/akka/2.6/akka/stream/IOResult.html" title="akka.stream.IOResult"><code>IOResult</code></a></span><span class="group-java"><a href="https://doc.akka.io/japi/akka/2.6/akka/stream/IOResult.html" title="akka.stream.IOResult"><code>IOResult</code></a></span>. In case of an IO failure the exception will be <span class="group-scala"><a href="https://doc.akka.io/api/akka/2.6/akka/stream/IOOperationIncompleteException.html" title="akka.stream.IOOperationIncompleteException"><code>IOOperationIncompleteException</code></a></span><span class="group-java"><a href="https://doc.akka.io/japi/akka/2.6/akka/stream/IOOperationIncompleteException.html" title="akka.stream.IOOperationIncompleteException"><code>IOOperationIncompleteException</code></a></span> instead of <span class="group-scala"><a href="https://doc.akka.io/api/akka/2.6/akka/stream/AbruptIOTerminationException.html" title="akka.stream.AbruptIOTerminationException"><code>AbruptIOTerminationException</code></a></span><span class="group-java"><a href="https://doc.akka.io/japi/akka/2.6/akka/stream/AbruptIOTerminationException.html" title="akka.stream.AbruptIOTerminationException"><code>AbruptIOTerminationException</code></a></span>.</p>
<p>Additionally when downstream of the IO-sources cancels with a failure, the materialized value is failed with that failure rather than completed successfully.</p>
<h3><a href="#akka-now-uses-fork-join-pool-from-jdk" name="akka-now-uses-fork-join-pool-from-jdk" class="anchor"><span class="anchor-link"></span></a>Akka now uses Fork Join Pool from JDK</h3>
<p>Previously, Akka contained a shaded copy of the ForkJoinPool. In benchmarks, we could not find significant benefits of keeping our own copy, so from Akka 2.6.0 on, the default FJP from the JDK will be used. The Akka FJP copy was removed.</p>
<h3><a href="#logging-of-dead-letters" name="logging-of-dead-letters" class="anchor"><span class="anchor-link"></span></a>Logging of dead letters</h3>
<p>When the number of dead letters have reached configured <code>akka.log-dead-letters</code> value it didn&rsquo;t log more dead letters in Akka 2.5.x. In Akka 2.6.x the count is reset after configured <code>akka.log-dead-letters-suspend-duration</code>.</p>
<p><code>akka.log-dead-letters-during-shutdown</code> default configuration changed from <code>on</code> to <code>off</code>.</p>
<h3><a href="#cluster-failure-detection" name="cluster-failure-detection" class="anchor"><span class="anchor-link"></span></a>Cluster failure detection</h3>
<p>Default number of nodes that each node is observing for failure detection has increased from 5 to 9. The reason is to have better coverage and unreachability information for downing decisions.</p>
<p>Configuration property:</p>
<pre><code>akka.cluster.monitored-by-nr-of-members = 9
</code></pre>
<h3><a href="#testkit" name="testkit" class="anchor"><span class="anchor-link"></span></a>TestKit</h3>
<p><code>expectNoMessage()</code> without timeout parameter is now using a new configuration property <code>akka.test.expect-no-message-default</code> (short timeout) instead of <code>remainingOrDefault</code> (long timeout).</p>
<h3><a href="#config-library-resolution-change" name="config-library-resolution-change" class="anchor"><span class="anchor-link"></span></a>Config library resolution change</h3>
<p>The <a href="https://github.com/lightbend/config">Lightbend Config Library</a> has been updated to load both <code>reference.conf</code> and user config files such as <code>application.conf</code> before substitution of variables used in the <code>reference.conf</code>. This makes it possible to override such variables in <code>reference.conf</code> with user configuration.</p>
<p>For example, the default config for Cluster Sharding, refers to the default config for Distributed Data, in <code>reference.conf</code> like this:</p>
<pre class="prettyprint"><code class="language-ruby">akka.cluster.sharding.distributed-data = ${akka.cluster.distributed-data}
</code></pre>
<p>In Akka 2.5.x this meant that to override default gossip interval for both direct use of Distributed Data and Cluster Sharding in the same application you would have to change two settings:</p>
<pre class="prettyprint"><code class="language-ruby">akka.cluster.distributed-data.gossip-interval = 3s
akka.cluster.sharding.distributed-data = 3s
</code></pre>
<p>In Akka 2.6.0 and forward, changing the default in the <code>akka.cluster.distributed-data</code> config block will be done before the variable in <code>reference.conf</code> is resolved, so that the same change only needs to be done once:</p>
<pre class="prettyprint"><code class="language-ruby">akka.cluster.distributed-data.gossip-interval = 3s
</code></pre>
<p>The following default settings in Akka are using such substitution and may be affected if you are changing the right hand config path in your <code>application.conf</code>:</p>
<pre class="prettyprint"><code class="language-ruby">akka.cluster.sharding.coordinator-singleton = ${akka.cluster.singleton}
akka.cluster.sharding.distributed-data = ${akka.cluster.distributed-data}
akka.cluster.singleton-proxy.singleton-name = ${akka.cluster.singleton.singleton-name}
akka.cluster.typed.receptionist.distributed-data = ${akka.cluster.distributed-data}
akka.remote.classic.netty.ssl = ${akka.remote.classic.netty.tcp}
akka.remote.artery.advanced.materializer = ${akka.stream.materializer}
</code></pre>
<h2><a href="#source-incompatibilities" name="source-incompatibilities" class="anchor"><span class="anchor-link"></span></a>Source incompatibilities</h2>
<h3><a href="#streamrefs" name="streamrefs" class="anchor"><span class="anchor-link"></span></a>StreamRefs</h3>
<p>The materialized value for <code>StreamRefs.sinkRef</code> and <code>StreamRefs.sourceRef</code> is no longer wrapped in <code>Future</code>/<code>CompletionStage</code>. It can be sent as reply to <code>sender()</code> immediately without using the <code>pipe</code> pattern.</p>
<p><code>StreamRefs</code> was marked as <a href="../common/may-change.html">may change</a>.</p>
<h2><a href="#akka-typed" name="akka-typed" class="anchor"><span class="anchor-link"></span></a>Akka Typed</h2>
<h3><a href="#naming-convention-changed" name="naming-convention-changed" class="anchor"><span class="anchor-link"></span></a>Naming convention changed</h3>
<p>In needing a way to distinguish the new APIs in code and docs from the original, Akka used the naming convention <code>untyped</code>. All references of the original have now been changed to <code>classic</code>. The reference of the new APIs as <code>typed</code> is going away as it becomes the primary APIs.</p>
<h3><a href="#receptionist-has-moved" name="receptionist-has-moved" class="anchor"><span class="anchor-link"></span></a>Receptionist has moved</h3>
<p>The receptionist had a name clash with the default Cluster Client Receptionist at <code>/system/receptionist</code> and will now instead either run under <code>/system/localReceptionist</code> or <code>/system/clusterReceptionist</code>.</p>
<p>The path change means that the receptionist information will not be disseminated between 2.5.x and 2.6.x nodes during a rolling update from 2.5.x to 2.6.x if you use Akka Typed. See <a href="../additional/rolling-updates.html#akka-typed-with-receptionist-or-cluster-receptionist">rolling updates with typed Receptionist</a></p>
<h3><a href="#cluster-receptionist-using-own-distributed-data" name="cluster-receptionist-using-own-distributed-data" class="anchor"><span class="anchor-link"></span></a>Cluster Receptionist using own Distributed Data</h3>
<p>In 2.5.x the Cluster Receptionist was using the shared Distributed Data extension but that could result in undesired configuration changes if the application was also using that and changed for example the <code>role</code> configuration.</p>
<p>In 2.6.x the Cluster Receptionist is using its own independent instance of Distributed Data.</p>
<p>This means that the receptionist information will not be disseminated between 2.5.x and 2.6.x nodes during a rolling update from 2.5.x to 2.6.x if you use Akka Typed. See <a href="../additional/rolling-updates.html#akka-typed-with-receptionist-or-cluster-receptionist">rolling updates with typed Cluster Receptionist</a></p>
<h3><a href="#akka-typed-api-changes" name="akka-typed-api-changes" class="anchor"><span class="anchor-link"></span></a>Akka Typed API changes</h3>
<p>Akka Typed APIs were still marked as <a href="../common/may-change.html">may change</a> in Akka 2.5.x and a few changes were made before finalizing the APIs. Compared to Akka 2.5.x the source incompatible changes are:</p>
<ul>
  <li><code>Behaviors.intercept</code> now takes a factory function for the interceptor.</li>
  <li><code>ActorSystem.scheduler</code> previously gave access to the classic <code>akka.actor.Scheduler</code> but now returns a specific <code>akka.actor.typed.Scheduler</code>.  Additionally <code>schedule</code> method has been replaced by <code>scheduleWithFixedDelay</code> and <code>scheduleAtFixedRate</code>. Actors that need to schedule tasks should  prefer <code>Behaviors.withTimers</code>.</li>
  <li><code>TimerScheduler.startPeriodicTimer</code>, replaced by <code>startTimerWithFixedDelay</code> or <code>startTimerAtFixedRate</code></li>
  <li><code>Routers.pool</code> now takes a factory function rather than a <code>Behavior</code> to protect against accidentally sharing same behavior instance and state across routees.</li>
  <li>The <code>request</code> parameter in Distributed Data commands was removed, in favor of using <code>ask</code> with the new <code>ReplicatorMessageAdapter</code>.</li>
  <li>Removed <code>Behavior.same</code>, <code>Behavior.unhandled</code>, <code>Behavior.stopped</code>, <code>Behavior.empty</code>, and <code>Behavior.ignore</code> since  they were redundant with corresponding <span class="group-scala">scaladsl.Behaviors.x</span><span class="group-java">javadsl.Behaviors.x</span>.</li>
  <li><code>ActorContext</code> parameter removed in <code>javadsl.ReceiveBuilder</code> for the functional style in Java. Use <code>Behaviors.setup</code>  to retrieve <code>ActorContext</code>, and use an enclosing class to hold initialization parameters and <code>ActorContext</code>.</li>
  <li>Java <a href="https://doc.akka.io/japi/akka/2.6/akka/cluster/sharding/typed/javadsl/EntityRef.html" title="akka.cluster.sharding.typed.javadsl.EntityRef"><code>EntityRef</code></a> ask timeout now takes a <code>java.time.Duration</code> rather than a <span class="group-scala"><a href="https://doc.akka.io/api/akka/2.6/akka/util/Timeout.html" title="akka.util.Timeout"><code>Timeout</code></a></span><span class="group-java"><a href="https://doc.akka.io/japi/akka/2.6/akka/util/Timeout.html" title="akka.util.Timeout"><code>Timeout</code></a></span></li>
  <li>Changed method signature for <code>EventAdapter.fromJournal</code> and support for <code>manifest</code> in <code>EventAdapter</code>.</li>
  <li>Renamed <span class="group-scala"><code>widen</code></span><span class="group-java"><code>Behaviors.widen</code></span> to <span class="group-scala"><code>transformMessages</code></span><span class="group-java"><code>Behaviors.transformMessages</code></span></li>
  <li><code>BehaviorInterceptor</code>, <code>Behaviors.monitor</code>, <code>Behaviors.withMdc</code> and <span class="group-scala"><code>transformMessages</code></span><span class="group-java"><code>Behaviors.transformMessages</code></span> takes  a <span class="group-scala"><code>ClassTag</code> parameter (probably source compatible)</span><span class="group-java"><code>interceptMessageClass</code> parameter</span>.  <code>interceptMessageType</code> method in <code>BehaviorInterceptor</code> is replaced with this <span class="group-scala"><code>ClassTag</code></span><span class="group-java"><code>Class</code></span> parameter.</li>
  <li><code>Behavior.orElse</code> has been removed because it wasn&rsquo;t safe together with <code>narrow</code>.</li>
  <li><code>StashBuffer</code>s are now created with <code>Behaviors.withStash</code> rather than instantiating directly</li>
  <li>To align with the Akka Typed style guide <code>SpawnProtocol</code> is now created through <span class="group-scala"><code>SpawnProtocol()</code></span><span class="group-java"><code>SpawnProtocol.create()</code></span>, the special <code>Spawn</code> message  factories has been removed and the top level of the actor protocol is now <code>SpawnProtocol.Command</code></li>
  <li><code>Future</code> removed from <code>ActorSystem.systemActorOf</code>.</li>
  <li><code>toUntyped</code> has been renamed to <code>toClassic</code>.</li>
  <li>Akka Typed is now using SLF4J as the logging API. <span class="group-scala"><code>ActorContext.log</code></span><span class="group-java"><code>ActorContext.getLog</code></span> returns  an <code>org.slf4j.Logger</code>. MDC has been changed to only support <code>String</code> values.</li>
  <li><code>setLoggerClass</code> in <code>ActorContext</code> has been renamed to <code>setLoggerName</code>.</li>
  <li><code>GetDataDeleted</code> and <code>UpdateDataDeleted</code> introduced as described in <a href="migration-guide-2.5.x-2.6.x.html#datadeleted">DataDeleted</a>.</li>
  <li><code>SubscribeResponse</code> introduced in <code>Subscribe</code> because the responses can be both <code>Changed</code> and <code>Deleted</code>.</li>
  <li><code>ReplicationDeleteFailure</code> renamed to <code>DeleteFailure</code>.</li>
  <li><code>EventSourcedEntity</code> removed in favor using plain <code>EventSourcedBehavior</code> because the alternative way was  causing more confusion than adding value. Construction of <code>PersistentId</code> for the <code>EventSourcedBehavior</code> is  facilitated by factory methods in <code>PersistenceId</code>.</li>
  <li><code>PersistenceId.apply(String)</code> renamed to <code>PersistenceId.ofUniqueId(String)</code></li>
  <li><code>akka.cluster.sharding.typed.scaladsl.Entity.apply</code> changed to use two parameter lists because the new  <code>EntityContext.entityTypeKey</code> required additional type parameter that is inferred better with a secondary  parameter list.</li>
  <li><code>EventSourcedBehavior.withEnforcedReplies</code> signature changed. Command is not required to extend <code>ExpectingReply</code>  anymore. <code>ExpectingReply</code> has therefore been removed.</li>
  <li><code>ActorContext</code> is now a mandatory constructor parameter in <code>AbstractBehavior</code>. Create via <code>Behaviors.setup</code>.  The reason is to encourage right usage and detect mistakes like not creating a new instance (via <code>setup</code>)  when the behavior is supervised and restarted.</li>
  <li><code>LoggingEventFilter</code> has been renamed to <code>LoggingTestKit</code> and its <code>intercept</code> method renamed to <code>assert</code></li>
  <li>Scala <code>ask</code> from <code>AskPattern</code> now implicitly converts an implicit <code>ActorSystem[_]</code> to <code>Scheduler</code> to eliminate some boilerplate.</li>
</ul>
<h4><a href="#akka-typed-stream-api-changes" name="akka-typed-stream-api-changes" class="anchor"><span class="anchor-link"></span></a>Akka Typed Stream API changes</h4>
<ul>
  <li><code>ActorSource.actorRef</code> relying on <code>PartialFunction</code> has been replaced in the Java API with a variant more suitable to be called by Java.</li>
  <li>Factories for creating a materializer from an <code>akka.actor.typed.ActorSystem</code> have been removed.  A stream can be run with an <code>akka.actor.typed.ActorSystem</code> <span class="group-scala">in implicit scope</span><span class="group-java">parameter</span>  and therefore the need for creating a materializer has been reduced.</li>
  <li><code>actorRefWithAck</code> has been renamed to <code>actorRefWithBackpressure</code></li>
</ul>
<h2><a href="#akka-stream-changes" name="akka-stream-changes" class="anchor"><span class="anchor-link"></span></a>Akka Stream changes</h2>
<h3><a href="#materializer-changes" name="materializer-changes" class="anchor"><span class="anchor-link"></span></a>Materializer changes</h3>
<p>A default materializer is now provided out of the box. For the Java API just pass <code>system</code> when running streams, for Scala an implicit materializer is provided if there is an implicit <code>ActorSystem</code> available. This avoids leaking materializers and simplifies most stream use cases somewhat.</p>
<p>The <code>ActorMaterializer</code> factories has been deprecated and replaced with a few corresponding factories in <code>akka.stream.Materializer</code>. New factories with per-materializer settings has not been provided but should instead be done globally through config or per stream, see below for more details.</p>
<p>Having a default materializer available means that most, if not all, usages of Java <code>ActorMaterializer.create()</code> and Scala <code>implicit val materializer = ActorMaterializer()</code> should be removed.</p>
<p>Details about the stream materializer can be found in <a href="../stream/stream-flows-and-basics.html#actor-materializer-lifecycle">Actor Materializer Lifecycle</a></p>
<p>When using streams from typed the same factories and methods for creating materializers and running streams as from classic can now be used with typed. The <code>akka.stream.typed.scaladsl.ActorMaterializer</code> and <code>akka.stream.typed.javadsl.ActorMaterializerFactory</code> that previously existed in the <code>akka-stream-typed</code> module has been removed.</p>
<h3><a href="#materializer-settings-deprecated" name="materializer-settings-deprecated" class="anchor"><span class="anchor-link"></span></a>Materializer settings deprecated</h3>
<p>The <code>ActorMaterializerSettings</code> class has been deprecated.</p>
<p>All materializer settings are available as configuration to change the system default or through attributes that can be used for individual streams when they are materialized.</p>
<table>
  <thead>
    <tr>
      <th>MaterializerSettings </th>
      <th>Corresponding attribute </th>
      <th>Config </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>initialInputBufferSize</code> </td>
      <td><code>Attributes.inputBuffer(initial, max)</code> </td>
      <td><code>akka.stream.materializer.initial-input-buffer-size</code> </td>
    </tr>
    <tr>
      <td><code>maxInputBufferSize</code> </td>
      <td><code>Attributes.inputBuffer(initial, max)</code> </td>
      <td><code>akka.stream.materializer.max-input-buffer-size</code> </td>
    </tr>
    <tr>
      <td><code>dispatcher</code> </td>
      <td><code>ActorAttributes.dispatcher(name)</code> </td>
      <td><code>akka.stream.materializer.dispatcher</code> </td>
    </tr>
    <tr>
      <td><code>supervisionDecider</code> </td>
      <td><code>ActorAttributes.supervisionStrategy</code> </td>
      <td>na </td>
    </tr>
    <tr>
      <td><code>debugLogging</code> </td>
      <td><code>ActorAttributes.debugLogging</code> </td>
      <td><code>akka.stream.materializer.debug-logging</code> </td>
    </tr>
    <tr>
      <td><code>outputBurstLimit</code> </td>
      <td><code>ActorAttributes.outputBurstLimit</code> </td>
      <td><code>akka.stream.materializer.output-burst-limit</code> </td>
    </tr>
    <tr>
      <td><code>fuzzingMode</code> </td>
      <td><code>ActorAttributes.fuzzingMode</code> </td>
      <td><code>akka.stream.materializer.debug.fuzzing-mode</code> </td>
    </tr>
    <tr>
      <td><code>autoFusing</code> </td>
      <td>no longer used (since 2.5.0) </td>
      <td>na </td>
    </tr>
    <tr>
      <td><code>maxFixedBufferSize</code> </td>
      <td><code>ActorAttributes.maxFixedBufferSize</code> </td>
      <td><code>akka.stream.materializer.max-fixed-buffer-size</code> </td>
    </tr>
    <tr>
      <td><code>syncProcessingLimit</code> </td>
      <td><code>ActorAttributes.syncProcessingLimit</code> </td>
      <td><code>akka.stream.materializer.sync-processing-limit</code> </td>
    </tr>
    <tr>
      <td><code>IOSettings.tcpWriteBufferSize</code> </td>
      <td><code>Tcp.writeBufferSize</code> </td>
      <td><code>akka.stream.materializer.io.tcp.write-buffer-size</code> </td>
    </tr>
    <tr>
      <td><code>blockingIoDispatcher</code> </td>
      <td>na </td>
      <td><code>akka.stream.materializer.blocking-io-dispatcher</code> </td>
    </tr>
  </tbody>
</table>
<table>
  <thead>
    <tr>
      <th>StreamRefSettings </th>
      <th>Corresponding StreamRefAttributes </th>
      <th>Config </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>bufferCapacity</code> </td>
      <td><code>bufferCapacity</code> </td>
      <td><code>akka.stream.materializer.stream-ref.buffer-capacity</code> </td>
    </tr>
    <tr>
      <td><code>demandRedeliveryInterval</code> </td>
      <td><code>demandRedeliveryInterval</code> </td>
      <td><code>akka.stream.materializer.stream-ref.demand-redelivery-interval</code> </td>
    </tr>
    <tr>
      <td><code>subscriptionTimeout</code> </td>
      <td><code>subscriptionTimeout</code> </td>
      <td><code>akka.stream.materializer.stream-ref.subscription-timeout</code> </td>
    </tr>
    <tr>
      <td><code>finalTerminationSignalDeadline</code> </td>
      <td><code>finalTerminationSignalDeadline</code> </td>
      <td><code>akka.stream.materializer.stream-ref.final-termination-signal-deadline</code> </td>
    </tr>
  </tbody>
</table>
<table>
  <thead>
    <tr>
      <th>SubscriptionTimeoutSettings </th>
      <th>Corresponding ActorAttributes </th>
      <th>Config </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>subscriptionTimeoutSettings.mode</code> </td>
      <td><code>streamSubscriptionTimeoutMode</code> </td>
      <td><code>akka.stream.materializer.subscription-timeout.mode</code> </td>
    </tr>
    <tr>
      <td><code>subscriptionTimeoutSettings.timeout</code> </td>
      <td><code>streamSubscriptionTimeout</code> </td>
      <td><code>akka.stream.materializer.subscription-timeout.timeout</code> </td>
    </tr>
  </tbody>
</table>
<p>Setting attributes on individual streams can be done like so:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/akka/tree/v2.6.18/akka-stream-tests/src/test/scala/akka/stream/StreamAttributeDocSpec.scala#L27-L35" target="_blank" title="Go to snippet source">source</a><code class="language-scala">val stream: RunnableGraph[Future[Done]] =
  Source(1 to 10)
    .map(_.toString)
    .toMat(Sink.foreach(println))(Keep.right)
    .withAttributes(Attributes.inputBuffer(4, 4) and
    ActorAttributes.dispatcher(&quot;my-stream-dispatcher&quot;) and
    TcpAttributes.tcpWriteBufferSize(2048))

stream.run()</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/akka/tree/v2.6.18/akka-stream-tests/src/test/java/akka/stream/StreamAttributeDocTest.java#L45-L57" target="_blank" title="Go to snippet source">source</a><code class="language-java">RunnableGraph&lt;CompletionStage&lt;Done&gt;&gt; stream =
    Source.range(1, 10)
        .map(Object::toString)
        .toMat(Sink.foreach(System.out::println), Keep.right())
        .withAttributes(
            Attributes.inputBuffer(4, 4)
                .and(ActorAttributes.dispatcher(&quot;my-stream-dispatcher&quot;))
                .and(TcpAttributes.tcpWriteBufferSize(2048)));

    stream.run(system);</code></pre></dd>
</dl>
<h3><a href="#stream-cancellation-available-upstream" name="stream-cancellation-available-upstream" class="anchor"><span class="anchor-link"></span></a>Stream cancellation available upstream</h3>
<p>Previously an Akka streams stage or operator failed it was impossible to discern this from the stage just cancelling. This has been improved so that when a stream stage fails the cause will be propagated upstream.</p>
<p>The following operators have a slight change in behavior because of this:</p>
<ul>
  <li><code>FileIO.fromPath</code>, <code>FileIO.fromFile</code> and <code>StreamConverters.fromInputStream</code> will fail the materialized future with  an <code>IOOperationIncompleteException</code> when downstream fails</li>
  <li><code>.watchTermination</code> will fail the materialized <code>Future</code> or <code>CompletionStage</code> rather than completing it when downstream fails</li>
  <li><code>StreamRef</code> - <code>SourceRef</code> will cancel with a failure when the receiving node is downed</li>
</ul>
<p>This also means that custom <code>GraphStage</code> implementations should be changed to pass on the cancellation cause when downstream cancels by implementing the <code>OutHandler.onDownstreamFinish</code> signature taking a <code>cause</code> parameter and calling <code>cancelStage(cause)</code> to pass the cause upstream. The old zero-argument <code>onDownstreamFinish</code> method has been deprecated.</p>
<h3><a href="#lazy-and-async-stream-operator-changes" name="lazy-and-async-stream-operator-changes" class="anchor"><span class="anchor-link"></span></a>Lazy and async stream operator changes</h3>
<p>The operators that provide support for lazy and <span class="group-scala"><code>Future</code></span><span class="group-java"><code>CompletionStage</code></span> stream construction were revised to be more consistent.</p>
<p>The materialized value is now no longer wrapped in an <span class="group-scala"><code>Option</code></span><span class="group-java"><code>Optional</code></span>, instead the <span class="group-scala"><code>Future</code></span><span class="group-java"><code>CompletionStage</code></span> is failed with a <code>akka.stream.NeverMaterializedException</code> in the cases that would previously lead to <span class="group-scala"><code>None</code></span><span class="group-java">an empty <code>Optional</code></span> </p>
<p>A deferred creation of the stream based on the initial element like how the deprecated <code>lazyInit</code> worked can be achieved by combining <span class="group-scala"><code>future(Flow|Sink)</code></span> <span class="group-java"><code>completionStage(Flow|Sink)</code></span> with <code>prefixAndTail</code>. See example in <span class="group-scala"><a href="../stream/operators/Flow/futureFlow.html">futureFlow</a></span> <span class="group-java"><a href="../stream/operators/Flow/completionStageFlow.html">completionStageFlow</a></span>. </p>
<h4><a href="#javadsl-flow" name="javadsl-flow" class="anchor"><span class="anchor-link"></span></a>javadsl.Flow</h4>
<table>
  <thead>
    <tr>
      <th>old </th>
      <th>new </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>lazyInit </td>
      <td><a href="../stream/operators/Flow/lazyCompletionStageFlow.html">lazyCompletionStageFlow</a> in combination with <code>prefixAndTail(1)</code> </td>
    </tr>
    <tr>
      <td>lazyInitAsync </td>
      <td><a href="../stream/operators/Flow/lazyCompletionStageFlow.html">lazyCompletionStageFlow</a> </td>
    </tr>
    <tr>
      <td> </td>
      <td><a href="../stream/operators/Flow/completionStageFlow.html">completionStageFlow</a> </td>
    </tr>
    <tr>
      <td> </td>
      <td><a href="../stream/operators/Flow/lazyFlow.html">lazyFlow</a> </td>
    </tr>
  </tbody>
</table>
<h3><a href="#javadsl-sink" name="javadsl-sink" class="anchor"><span class="anchor-link"></span></a>javadsl.Sink</h3>
<table>
  <thead>
    <tr>
      <th>old </th>
      <th>new </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>lazyInit </td>
      <td><a href="../stream/operators/Sink/lazyCompletionStageSink.html">lazyCompletionStageSink</a> in combination with <code>Flow.prefixAndTail(1)</code> </td>
    </tr>
    <tr>
      <td>lazyInitAsync </td>
      <td><a href="../stream/operators/Sink/lazyCompletionStageSink.html">lazyCompletionStageSink</a> </td>
    </tr>
    <tr>
      <td> </td>
      <td><a href="../stream/operators/Sink/completionStageSink.html">completionStageSink</a> </td>
    </tr>
    <tr>
      <td> </td>
      <td><a href="../stream/operators/Sink/lazySink.html">lazySink</a> </td>
    </tr>
  </tbody>
</table>
<h3><a href="#javadsl-source" name="javadsl-source" class="anchor"><span class="anchor-link"></span></a>javadsl.Source</h3>
<table>
  <thead>
    <tr>
      <th>old </th>
      <th>new </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>fromFuture </td>
      <td><a href="../stream/operators/Source/future.html">future</a> </td>
    </tr>
    <tr>
      <td>fromCompletionStage </td>
      <td><a href="../stream/operators/Source/completionStage.html">completionStage</a> </td>
    </tr>
    <tr>
      <td>fromFutureSource </td>
      <td><a href="../stream/operators/Source/futureSource.html">futureSource</a> </td>
    </tr>
    <tr>
      <td>fromSourceCompletionStage </td>
      <td><a href="../stream/operators/Source/completionStageSource.html">completionStageSource</a> </td>
    </tr>
    <tr>
      <td>lazily </td>
      <td><a href="../stream/operators/Source/lazySource.html">lazySource</a> </td>
    </tr>
    <tr>
      <td>lazilyAsync </td>
      <td><a href="../stream/operators/Source/lazyCompletionStage.html">lazyCompletionStage</a> </td>
    </tr>
    <tr>
      <td> </td>
      <td><a href="../stream/operators/Source/lazySingle.html">lazySingle</a> </td>
    </tr>
    <tr>
      <td> </td>
      <td><a href="../stream/operators/Source/lazyCompletionStageSource.html">lazyCompletionStageSource</a> </td>
    </tr>
  </tbody>
</table>
<h3><a href="#scaladsl-flow" name="scaladsl-flow" class="anchor"><span class="anchor-link"></span></a>scaladsl.Flow</h3>
<table>
  <thead>
    <tr>
      <th>old </th>
      <th>new </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>lazyInit </td>
      <td><a href="../stream/operators/Flow/lazyFutureFlow.html">lazyFutureFlow</a> </td>
    </tr>
    <tr>
      <td>lazyInitAsync </td>
      <td><a href="../stream/operators/Flow/lazyFutureFlow.html">lazyFutureFlow</a> </td>
    </tr>
    <tr>
      <td> </td>
      <td><a href="../stream/operators/Flow/futureFlow.html">futureFlow</a> </td>
    </tr>
    <tr>
      <td> </td>
      <td><a href="../stream/operators/Flow/lazyFlow.html">lazyFlow</a> </td>
    </tr>
  </tbody>
</table>
<h3><a href="#scaladsl-sink" name="scaladsl-sink" class="anchor"><span class="anchor-link"></span></a>scaladsl.Sink</h3>
<table>
  <thead>
    <tr>
      <th>old </th>
      <th>new </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>lazyInit </td>
      <td><a href="../stream/operators/Sink/lazyFutureSink.html">lazyFutureSink</a> in combination with <code>Flow.prefixAndTail(1)</code> </td>
    </tr>
    <tr>
      <td>lazyInitAsync </td>
      <td><a href="../stream/operators/Sink/lazyFutureSink.html">lazyFutureSink</a> </td>
    </tr>
    <tr>
      <td> </td>
      <td><a href="../stream/operators/Sink/futureSink.html">futureSink</a> </td>
    </tr>
    <tr>
      <td> </td>
      <td><a href="../stream/operators/Sink/lazySink.html">lazySink</a> </td>
    </tr>
  </tbody>
</table>
<h3><a href="#scaladsl-source" name="scaladsl-source" class="anchor"><span class="anchor-link"></span></a>scaladsl.Source</h3>
<table>
  <thead>
    <tr>
      <th>old </th>
      <th>new </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>fromFuture </td>
      <td><a href="../stream/operators/Source/future.html">future</a> </td>
    </tr>
    <tr>
      <td>fromCompletionStage </td>
      <td><a href="../stream/operators/Source/completionStage.html">completionStage</a> </td>
    </tr>
    <tr>
      <td>fromFutureSource </td>
      <td><a href="../stream/operators/Source/futureSource.html">futureSource</a> </td>
    </tr>
    <tr>
      <td>fromSourceCompletionStage </td>
      <td> </td>
    </tr>
    <tr>
      <td>lazily </td>
      <td><a href="../stream/operators/Source/lazySource.html">lazySource</a> </td>
    </tr>
    <tr>
      <td>lazilyAsync </td>
      <td><a href="../stream/operators/Source/lazyFuture.html">lazyFuture</a> </td>
    </tr>
    <tr>
      <td> </td>
      <td><a href="../stream/operators/Source/lazySingle.html">lazySingle</a> </td>
    </tr>
    <tr>
      <td> </td>
      <td><a href="../stream/operators/Source/lazyFutureSource.html">lazyFutureSource</a> </td>
    </tr>
  </tbody>
</table>
</div>
</article>
<div class="row">
<div class="small-12 column">
<section class="nav-prev-next row">
<div class="nav-prev small-6 column">
<a href="../project/migration-guides.html"><i class="icon-prev"></i> <span class="link-prev">Migration Guides</span></a>
</div>
<div class="nav-next small-6 column clearfix">
<a class="float-right" href="../project/migration-guide-2.4.x-2.5.x.html">Migration Guide 2.4.x to 2.5.x <i class="icon-next"></i></a>
</div>
</section>
</div>
</div>
<div class="source-github row">
Found an error in this documentation? The source code for this page can be found <a href="https://github.com/akka/akka/tree/v2.6.18/akka-docs/src/main/paradox/project/migration-guide-2.5.x-2.6.x.md">here</a>.
Please feel free to edit and contribute a pull request.
</div>

<footer class="page-footer row clearfix">
<img class="akka-icon float-left show-for-medium" src="../images/akka-icon.svg" />
<section class="copyright">
<div>Akka is Open Source and available under the Apache 2 License.</div>
<p class="legal">
&copy; 2011-2021 <a href="https://www.lightbend.com" target="_blank">Lightbend, Inc.</a> |
<a href="https://www.lightbend.com/legal/licenses" target="_blank">Licenses</a> |
<a href="https://www.lightbend.com/legal/terms" target="_blank">Terms</a> |
<a href="https://www.lightbend.com/legal/privacy" target="_blank">Privacy Policy</a> |
<a href="https://akka.io/cookie/" target="_blank">Cookie Listing</a> |
<a class="optanon-toggle-display">Cookie Settings</a>
</p>
</section>

</footer>
</section>
</main>
</div>

<script type="text/javascript" src="../js/scrollsneak.js"></script>
<script type="text/javascript">jQuery(document).foundation();</script>
<script type="text/javascript" src="../js/groups.js"></script>
<script type="text/javascript" src="../js/page.js"></script>
<script type="text/javascript" src="../js/snippets.js"></script>
<script type="text/javascript" src="../js/magellan.js"></script>
<script type="text/javascript" src="../js/metadata-toggle.js"></script>
<script type="text/javascript" src="../js/lbHeader.js"></script>

<style type="text/css">@import "../lib/prettify/prettify.css";</style>
<script type="text/javascript" src="../lib/prettify/prettify.js"></script>
<script type="text/javascript" src="../lib/prettify/lang-scala.js"></script>
<script type="text/javascript">//<![CDATA[
jQuery(function(){window.prettyPrint && prettyPrint()});
//]]></script>
<!-- Algolia docs search -->
<script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.js"></script>
<style>.algolia-autocomplete { display: block !important }</style>
<script type="text/javascript">
docsearch({
apiKey: '543bad5ad786495d9ccd445ed34ed082',
indexName: 'akka_io',
inputSelector: '#search',
algoliaOptions: {
hitsPerPage: 5
}
});

docsearch({
apiKey: '543bad5ad786495d9ccd445ed34ed082',
indexName: 'akka_io',
inputSelector: '#overlay-search',
algoliaOptions: {
hitsPerPage: 5
}
});

// set up "/" as global shortcut for focusing on search
jQuery(document).keypress(function (event) {
if (event.keyCode == 47) {
jQuery("#search").focus();
return false; // swallow key event, otherwise the / char would be input into the search box
}
});
</script>

<script type="text/javascript" src="../assets/js/warnOldDocs.js"></script>
<script type="text/javascript" src="../assets/js/scalafiddle.js"></script>


</body>
</html>
