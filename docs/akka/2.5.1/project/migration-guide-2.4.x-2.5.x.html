

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Migration Guide 2.4.x to 2.5.x &mdash; Akka Documentation</title>
    
    <link rel="stylesheet" href="../_static/style.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/prettify.css" type="text/css" />
    <link rel="stylesheet" href="../_static/base.css" type="text/css" />
    <link rel="stylesheet" href="../_static/docs.css" type="text/css" />
    <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600,700" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '2.5.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/toc.js"></script>
    <script type="text/javascript" src="../_static/prettify.js"></script>
    <script type="text/javascript" src="../_static/highlightCode.js"></script>
    <script type="text/javascript" src="../_static/effects.core.js"></script>
    <script type="text/javascript" src="../_static/effects.highlight.js"></script>
    <script type="text/javascript" src="../_static/scrollTo.js"></script>
    <script type="text/javascript" src="../_static/contentsFix.js"></script>
    <script type="text/javascript" src="../_static/ga.js"></script>
    <script type="text/javascript" src="../_static/warnOldDocs.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="top" title="Akka Documentation" href="../index.html" />
    <link rel="up" title="Migration Guides" href="migration-guides.html" />
    <link rel="next" title="Issue Tracking" href="issue-tracking.html" />
    <link rel="prev" title="Migration Guide Akka Streams 2.0.x to 2.4.x" href="migration-guide-stream-2.0-2.4.html" />
    <!-- Hint to search engines that the "canonical" page is under "current", which will boost it appearing in search results -->
    
      <link rel="canonical" href="https://doc.akka.io/docs/akka/current/project/migration-guide-2.4.x-2.5.x.html" />
    

    <!--Google Analytics-->
    <script type="text/javascript">
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-21117439-1']);
      _gaq.push(['_setDomainName', 'akka.io']);
      _gaq.push(['_trackPageview']);
      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })()
    </script>
    <!--Google Analytics & Marketo-->
    <script type="text/javascript">
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-23127719-1', 'lightbend.com', {'allowLinker': true, 'name': 'tsTracker'});
      ga('tsTracker.require', 'linker');
      ga('tsTracker.linker:autoLink', ['lightbend.com','playframework.com','scala-lang.org','scaladays.org','spray.io','akka.io','scala-sbt.org','scala-ide.org']);
      ga('tsTracker.send', 'pageview');

      (function() {
          var didInit = false;
          function initMunchkin() {
          if(didInit === false) {
            didInit = true;
            Munchkin.init('558-NCX-702');
          }
          }
          var s = document.createElement('script');
          s.type = 'text/javascript';
          s.async = true;
          s.src = '//munchkin.marketo.net/munchkin.js';
          s.onreadystatechange = function() {
          if (this.readyState == 'complete' || this.readyState == 'loaded') {
            initMunchkin();
          }
          };
          s.onload = initMunchkin;
          document.getElementsByTagName('head')[0].appendChild(s);
        })();
    </script>


  </head>
  <body role="document">
  <div class="navbar">
    <div class="navbar-inner">
      <div class="container">
        <div class="navbar-logo">
          <a href="https://akka.io"><img class="svg-logo" src="../_static/akka_full_color.svg" /></a>
        </div>
        <ul class="nav">
          <li><a href="https://akka.io/docs">Documentation</a></li>
          <li><a href="https://doc.akka.io/docs/akka/current/additional/faq.html">FAQ</a></li>
          <li><a href="https://akka.io/downloads">Download</a></li>
          <li><a href="http://groups.google.com/group/akka-user">Mailing List</a></li>
          <li><a href="http://github.com/akka/akka">Code</a></li>
          <li><a href="http://www.lightbend.com/how/subscription">Commercial Support</a></li>
        </ul>
      </div>
    </div>
  </div>
  <div class="main">
    <div class="container">
      <div class="page-title">Migration Guide 2.4.x to 2.5.x - Version 2.5.1</div>
      <div class="pdf-link"><a href="../AkkaScala.pdf" title="Akka Scala Documentation"><img src="../_static/pdf-scala-icon.png" style="height: 40px;" /></a></div>
      <div class="pdf-link"><a href="../AkkaJava.pdf" title="Akka Java Documentation"><img src="../_static/pdf-java-icon.png" style="height: 40px;" /></a></div>
    </div>
    <div class="main-container">
      <div class="container">
        <div class="row">
          <div class="span12">
            <div class="breadcrumb">
              <div style="position: relative">
                <input type="search" id="search" class="form-control" style="position: relative" placeholder="Search in the doc" />
              </div>
              <div>
                <div>
                  <span class="divider">«</span> <a href="migration-guide-stream-2.0-2.4.html">Migration Guide Akka Streams 2.0.x to 2.4.x</a> <span class="divider">|</span>
                </div>
                <div>
                  <a href="../java.html">Java Contents</a> <span class="divider">|</span> <a href="../scala.html">Scala Contents</a>
                </div>
                <div>
                  <span class="divider">|</span> <a href="issue-tracking.html">Issue Tracking</a> <span class="divider">»</span>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="span9">
          </div><div class="span9">
            
  <div class="section" id="migration-guide-2-4-x-to-2-5-x">
<span id="migration-guide-2-4-x-2-5-x"></span><h1>Migration Guide 2.4.x to 2.5.x</h1>
<div class="section" id="actor-java">
<h2>Actor (Java)</h2>
<div class="section" id="abstractactor">
<h3>AbstractActor</h3>
<p><code class="docutils literal"><span class="pre">AbstractActor</span></code> has been promoted from its experimental/may change state and while doing this we
did some small, but important, improvements to the API that will require some mechanical
changes of your source code.</p>
<p>Previously the receive behavior was set with the <code class="docutils literal"><span class="pre">receive</span></code> method, but now an actor has
to define its initial receive behavior by implementing the <code class="docutils literal"><span class="pre">createReceive</span></code> method in
the <code class="docutils literal"><span class="pre">AbstractActor</span></code>. This has the advantages:</p>
<ul class="simple">
<li>It gives a clear entry point of what to implement. The compiler tells you that the
abstract method must be implemented.</li>
<li>It's impossible to forget to set the receive behavior.</li>
<li>It's not possible to define the receive behavior more than once.</li>
</ul>
<p>The return type of <code class="docutils literal"><span class="pre">createReceive</span></code> is <code class="docutils literal"><span class="pre">AbstractActor.Receive</span></code>. It defines which messages
your Actor can handle, along with the implementation of how the messages should be processed.
You can build such behavior with a builder named <code class="docutils literal"><span class="pre">ReceiveBuilder</span></code>.</p>
<p><code class="docutils literal"><span class="pre">AbstractActor.Receive</span></code> can also be used in <code class="docutils literal"><span class="pre">getContext().become</span></code>.</p>
<p>The old <code class="docutils literal"><span class="pre">receive</span></code> method exposed Scala's <code class="docutils literal"><span class="pre">PartialFunction</span></code> and <code class="docutils literal"><span class="pre">BoxedUnit</span></code> in the signature,
which are unnecessary concepts for newcomers to learn. The new <code class="docutils literal"><span class="pre">createReceive</span></code> requires no
additional imports.</p>
<p>Note that The <code class="docutils literal"><span class="pre">Receive</span></code> can still be implemented in other ways than using the <code class="docutils literal"><span class="pre">ReceiveBuilder</span></code>
since it in the end is just a wrapper around a Scala <code class="docutils literal"><span class="pre">PartialFunction</span></code>. For example, one could
implement an adapter to <a class="reference external" href="http://www.javaslang.io/javaslang-docs/#_pattern_matching">Javaslang Pattern Matching DSL</a>.</p>
<p>The mechanical source code change for migration to the new <code class="docutils literal"><span class="pre">AbstractActor</span></code> is to implement the
<code class="docutils literal"><span class="pre">createReceive</span></code> instead of calling <code class="docutils literal"><span class="pre">receive</span></code> (compiler will tell that this is missing).</p>
<p>Old:</p>
<div class="highlight-scala"><div class="highlight"><pre><span class="k">import</span> <span class="nn">akka.actor.AbstractActor</span><span class="o">;</span>
<span class="k">import</span> <span class="nn">akka.japi.pf.ReceiveBuilder</span><span class="o">;</span>
<span class="k">import</span> <span class="nn">scala.PartialFunction</span><span class="o">;</span>
<span class="k">import</span> <span class="nn">scala.runtime.BoxedUnit</span><span class="o">;</span>

<span class="n">public</span> <span class="k">class</span> <span class="nc">SomeActor</span> <span class="k">extends</span> <span class="nc">AbstractActor</span> <span class="o">{</span>
  <span class="n">public</span> <span class="nc">SomeActor</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">receive</span><span class="o">(</span><span class="nc">ReceiveBuilder</span>
      <span class="o">.</span><span class="k">match</span><span class="o">(</span><span class="nc">String</span><span class="o">.</span><span class="n">class</span><span class="o">,</span> <span class="n">s</span> <span class="o">-&gt;</span> <span class="nc">System</span><span class="o">.</span><span class="n">out</span><span class="o">.</span><span class="n">println</span><span class="o">(</span><span class="n">s</span><span class="o">.</span><span class="n">toLowerCase</span><span class="o">())).</span>
      <span class="o">.</span><span class="n">build</span><span class="o">());</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<p>New:</p>
<div class="highlight-scala"><div class="highlight"><pre><span class="k">import</span> <span class="nn">akka.actor.AbstractActor</span><span class="o">;</span>

<span class="n">public</span> <span class="k">class</span> <span class="nc">SomeActor</span> <span class="k">extends</span> <span class="nc">AbstractActor</span> <span class="o">{</span>
  <span class="nd">@Override</span>
  <span class="n">public</span> <span class="nc">Receive</span> <span class="n">createReceive</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">receiveBuilder</span><span class="o">()</span>
      <span class="o">.</span><span class="k">match</span><span class="o">(</span><span class="nc">String</span><span class="o">.</span><span class="n">class</span><span class="o">,</span> <span class="n">s</span> <span class="o">-&gt;</span> <span class="nc">System</span><span class="o">.</span><span class="n">out</span><span class="o">.</span><span class="n">println</span><span class="o">(</span><span class="n">s</span><span class="o">.</span><span class="n">toLowerCase</span><span class="o">()))</span>
      <span class="o">.</span><span class="n">build</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<p>See <a class="reference internal" href="../java/actors.html#actors-receive-java"><span>Receive messages</span></a> documentation for more advice about how to implement
<code class="docutils literal"><span class="pre">createReceive</span></code>.</p>
<p>A few new methods have been added with deprecation of the old. Worth noting is <code class="docutils literal"><span class="pre">preRestart</span></code>.</p>
<p>Old:</p>
<div class="highlight-scala"><div class="highlight"><pre><span class="nd">@Override</span>
<span class="n">public</span> <span class="n">void</span> <span class="n">preRestart</span><span class="o">(</span><span class="nc">Throwable</span> <span class="n">reason</span><span class="o">,</span> <span class="n">scala</span><span class="o">.</span><span class="nc">Option</span><span class="o">&lt;</span><span class="nc">Object</span><span class="o">&gt;</span> <span class="n">message</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">super</span><span class="o">.</span><span class="n">preRestart</span><span class="o">(</span><span class="n">reason</span><span class="o">,</span> <span class="n">message</span><span class="o">);</span>
<span class="o">}</span>
</pre></div>
</div>
<p>New:</p>
<div class="highlight-scala"><div class="highlight"><pre><span class="nd">@Override</span>
<span class="n">public</span> <span class="n">void</span> <span class="n">preRestart</span><span class="o">(</span><span class="nc">Throwable</span> <span class="n">reason</span><span class="o">,</span> <span class="n">java</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="nc">Optional</span><span class="o">&lt;</span><span class="nc">Object</span><span class="o">&gt;</span> <span class="n">message</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">super</span><span class="o">.</span><span class="n">preRestart</span><span class="o">(</span><span class="n">reason</span><span class="o">,</span> <span class="n">message</span><span class="o">);</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="section" id="abstractpersistentactor">
<h3>AbstractPersistentActor</h3>
<p>Similar change as described above for <code class="docutils literal"><span class="pre">AbstractActor</span></code> is needed for <code class="docutils literal"><span class="pre">AbstractPersistentActor</span></code>. Implement <code class="docutils literal"><span class="pre">createReceiveRecover</span></code>
instead of <code class="docutils literal"><span class="pre">receiveRecover</span></code>, and <code class="docutils literal"><span class="pre">createReceive</span></code> instead of <code class="docutils literal"><span class="pre">receiveCommand</span></code>.</p>
<p>Old:</p>
<div class="highlight-scala"><div class="highlight"><pre><span class="nd">@Override</span>
<span class="n">public</span> <span class="nc">PartialFunction</span><span class="o">&lt;</span><span class="nc">Object</span><span class="o">,</span> <span class="nc">BoxedUnit</span><span class="o">&gt;</span> <span class="n">receiveCommand</span><span class="o">()</span> <span class="o">{</span>
  <span class="k">return</span> <span class="nc">ReceiveBuilder</span><span class="o">.</span>
    <span class="k">match</span><span class="o">(</span><span class="nc">String</span><span class="o">.</span><span class="n">class</span><span class="o">,</span> <span class="n">cmd</span> <span class="o">-&gt;</span> <span class="o">{</span><span class="cm">/* ... */</span><span class="o">}).</span><span class="n">build</span><span class="o">();</span>
<span class="o">}</span>

<span class="nd">@Override</span>
<span class="n">public</span> <span class="nc">PartialFunction</span><span class="o">&lt;</span><span class="nc">Object</span><span class="o">,</span> <span class="nc">BoxedUnit</span><span class="o">&gt;</span> <span class="n">receiveRecover</span><span class="o">()</span> <span class="o">{</span>
  <span class="k">return</span> <span class="nc">ReceiveBuilder</span><span class="o">.</span>
      <span class="k">match</span><span class="o">(</span><span class="nc">String</span><span class="o">.</span><span class="n">class</span><span class="o">,</span> <span class="n">evt</span> <span class="o">-&gt;</span> <span class="o">{</span><span class="cm">/* ... */</span><span class="o">}).</span><span class="n">build</span><span class="o">();</span>
<span class="o">}</span>
</pre></div>
</div>
<p>New:</p>
<div class="highlight-scala"><div class="highlight"><pre><span class="nd">@Override</span>
<span class="n">public</span> <span class="nc">Receive</span> <span class="n">createReceive</span><span class="o">()</span> <span class="o">{</span>
  <span class="k">return</span> <span class="n">receiveBuilder</span><span class="o">().</span>
    <span class="k">match</span><span class="o">(</span><span class="nc">String</span><span class="o">.</span><span class="n">class</span><span class="o">,</span> <span class="n">cmd</span> <span class="o">-&gt;</span> <span class="o">{</span><span class="cm">/* ... */</span><span class="o">}).</span><span class="n">build</span><span class="o">();</span>
<span class="o">}</span>

<span class="nd">@Override</span>
<span class="n">public</span> <span class="nc">Receive</span> <span class="n">createReceiveRecover</span><span class="o">()</span> <span class="o">{</span>
  <span class="k">return</span> <span class="n">receiveBuilder</span><span class="o">().</span>
      <span class="k">match</span><span class="o">(</span><span class="nc">String</span><span class="o">.</span><span class="n">class</span><span class="o">,</span> <span class="n">evt</span> <span class="o">-&gt;</span> <span class="o">{</span><span class="cm">/* ... */</span><span class="o">}).</span><span class="n">build</span><span class="o">();</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="section" id="untypedactor">
<h3>UntypedActor</h3>
<p><code class="docutils literal"><span class="pre">UntypedActor</span></code> has been deprecated in favor of <code class="docutils literal"><span class="pre">AbstractActor</span></code>. As a migration path you can extend
<code class="docutils literal"><span class="pre">UntypedAbstractActor</span></code> instead of <code class="docutils literal"><span class="pre">UntypedActor</span></code>.</p>
<p>Old:</p>
<div class="highlight-scala"><div class="highlight"><pre><span class="k">import</span> <span class="nn">akka.actor.UntypedActor</span><span class="o">;</span>

<span class="n">public</span> <span class="k">class</span> <span class="nc">SomeActor</span> <span class="k">extends</span> <span class="nc">UntypedActor</span> <span class="o">{</span>

  <span class="n">public</span> <span class="n">static</span> <span class="k">class</span> <span class="nc">Msg1</span> <span class="o">{}</span>

  <span class="nd">@Override</span>
  <span class="n">public</span> <span class="n">void</span> <span class="n">onReceive</span><span class="o">(</span><span class="nc">Object</span> <span class="n">msg</span><span class="o">)</span> <span class="n">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">msg</span> <span class="n">instanceof</span> <span class="nc">Msg1</span><span class="o">)</span> <span class="o">{</span>
      <span class="nc">Msg1</span> <span class="n">msg1</span> <span class="k">=</span> <span class="o">(</span><span class="nc">Msg1</span><span class="o">)</span> <span class="n">msg</span><span class="o">;</span>
      <span class="c1">// actual work</span>
    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
      <span class="n">unhandled</span><span class="o">(</span><span class="n">msg</span><span class="o">);</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<p>New:</p>
<div class="highlight-scala"><div class="highlight"><pre><span class="k">import</span> <span class="nn">akka.actor.UntypedAbstractActor</span><span class="o">;</span>

<span class="n">public</span> <span class="k">class</span> <span class="nc">SomeActor</span> <span class="k">extends</span> <span class="nc">UntypedAbstractActor</span> <span class="o">{</span>

  <span class="n">public</span> <span class="n">static</span> <span class="k">class</span> <span class="nc">Msg1</span> <span class="o">{}</span>

  <span class="nd">@Override</span>
  <span class="n">public</span> <span class="n">void</span> <span class="n">onReceive</span><span class="o">(</span><span class="nc">Object</span> <span class="n">msg</span><span class="o">)</span> <span class="n">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">msg</span> <span class="n">instanceof</span> <span class="nc">Msg1</span><span class="o">)</span> <span class="o">{</span>
      <span class="nc">Msg1</span> <span class="n">msg1</span> <span class="k">=</span> <span class="o">(</span><span class="nc">Msg1</span><span class="o">)</span> <span class="n">msg</span><span class="o">;</span>
      <span class="c1">// actual work</span>
    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
      <span class="n">unhandled</span><span class="o">(</span><span class="n">msg</span><span class="o">);</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<p>It's recommended to migrate <code class="docutils literal"><span class="pre">UntypedActor</span></code> to <code class="docutils literal"><span class="pre">AbstractActor</span></code> by implementing
<code class="docutils literal"><span class="pre">createReceive</span></code> instead of <code class="docutils literal"><span class="pre">onReceive</span></code>.</p>
<p>Old:</p>
<div class="highlight-scala"><div class="highlight"><pre><span class="k">import</span> <span class="nn">akka.actor.UntypedActor</span><span class="o">;</span>

<span class="n">public</span> <span class="k">class</span> <span class="nc">SomeActor</span> <span class="k">extends</span> <span class="nc">UntypedActor</span> <span class="o">{</span>

  <span class="nd">@Override</span>
  <span class="n">public</span> <span class="n">void</span> <span class="n">onReceive</span><span class="o">(</span><span class="nc">Object</span> <span class="n">msg</span><span class="o">)</span> <span class="n">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">msg</span> <span class="n">instanceof</span> <span class="nc">String</span><span class="o">)</span> <span class="o">{</span>
      <span class="nc">String</span> <span class="n">s</span> <span class="k">=</span> <span class="o">(</span><span class="nc">String</span><span class="o">)</span> <span class="n">msg</span><span class="o">;</span>
      <span class="nc">System</span><span class="o">.</span><span class="n">out</span><span class="o">.</span><span class="n">println</span><span class="o">(</span><span class="n">s</span><span class="o">.</span><span class="n">toLowerCase</span><span class="o">());</span>
    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
      <span class="n">unhandled</span><span class="o">(</span><span class="n">msg</span><span class="o">);</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<p>New:</p>
<div class="highlight-scala"><div class="highlight"><pre><span class="k">import</span> <span class="nn">akka.actor.AbstractActor</span><span class="o">;</span>

<span class="n">public</span> <span class="k">class</span> <span class="nc">SomeActor</span> <span class="k">extends</span> <span class="nc">AbstractActor</span> <span class="o">{</span>
  <span class="nd">@Override</span>
  <span class="n">public</span> <span class="nc">Receive</span> <span class="n">createReceive</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">receiveBuilder</span><span class="o">()</span>
      <span class="o">.</span><span class="k">match</span><span class="o">(</span><span class="nc">String</span><span class="o">.</span><span class="n">class</span><span class="o">,</span> <span class="n">s</span> <span class="o">-&gt;</span> <span class="o">{</span>
        <span class="nc">System</span><span class="o">.</span><span class="n">out</span><span class="o">.</span><span class="n">println</span><span class="o">(</span><span class="n">s</span><span class="o">.</span><span class="n">toLowerCase</span><span class="o">());</span>
      <span class="o">})</span>
      <span class="o">.</span><span class="n">build</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<p>See <a class="reference internal" href="../java/actors.html#actors-receive-java"><span>Receive messages</span></a> documentation for more advice about how to implement
<code class="docutils literal"><span class="pre">createReceive</span></code>.</p>
<p>Similar with <code class="docutils literal"><span class="pre">UntypedActorWithStash</span></code>, <code class="docutils literal"><span class="pre">UntypedPersistentActor</span></code>, and
<code class="docutils literal"><span class="pre">UntypedPersistentActorWithAtLeastOnceDelivery</span></code>.</p>
</div>
</div>
<div class="section" id="actor-scala">
<h2>Actor (Scala)</h2>
<div class="section" id="actor-dsl-deprecation">
<h3>Actor DSL deprecation</h3>
<p>Actor DSL is a rarely used feature and thus will be deprecated and removed.
Use plain <code class="docutils literal"><span class="pre">system.actorOf</span></code> instead of the DSL to create Actors if you have been using it.</p>
</div>
<div class="section" id="extensionkey-deprecation">
<h3>ExtensionKey Deprecation</h3>
<p><code class="docutils literal"><span class="pre">ExtensionKey</span></code> is a shortcut for writing <a class="reference internal" href="../scala/extending-akka.html#extending-akka-scala"><span>Akka Extensions</span></a> but extensions created with it
cannot be used from Java and it does in fact not save many lines of code over directly implementing <code class="docutils literal"><span class="pre">ExtensionId</span></code>.</p>
<p>Old:</p>
<div class="highlight-scala"><div class="highlight"><pre><span class="k">object</span> <span class="nc">MyExtension</span> <span class="k">extends</span> <span class="nc">ExtensionKey</span><span class="o">[</span><span class="kt">MyExtension</span><span class="o">]</span>
</pre></div>
</div>
<p>New:</p>
<div class="highlight-scala"><div class="highlight"><pre><span class="k">object</span> <span class="nc">MyExtension</span> <span class="k">extends</span> <span class="nc">ExtensionId</span><span class="o">[</span><span class="kt">MyExtension</span><span class="o">]</span> <span class="k">with</span> <span class="nc">ExtensionIdProvider</span> <span class="o">{</span>

  <span class="k">override</span> <span class="k">def</span> <span class="n">lookup</span> <span class="k">=</span> <span class="nc">MyExtension</span>

  <span class="k">override</span> <span class="k">def</span> <span class="n">createExtension</span><span class="o">(</span><span class="n">system</span><span class="k">:</span> <span class="kt">ExtendedActorSystem</span><span class="o">)</span><span class="k">:</span> <span class="kt">MyExtension</span> <span class="o">=</span>
    <span class="k">new</span> <span class="nc">MyExtension</span><span class="o">(</span><span class="n">system</span><span class="o">)</span>

  <span class="c1">// needed to get the type right when used from Java</span>
  <span class="k">override</span> <span class="k">def</span> <span class="n">get</span><span class="o">(</span><span class="n">system</span><span class="k">:</span> <span class="kt">ActorSystem</span><span class="o">)</span><span class="k">:</span> <span class="kt">MyExtension</span> <span class="o">=</span> <span class="k">super</span><span class="o">.</span><span class="n">get</span><span class="o">(</span><span class="n">system</span><span class="o">)</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="actor-mailbox">
<h2>Actor Mailbox</h2>
<p>Scala 2.12 is using the standard JDK8 ForkJoinPool, which may cause performance regression for
some Actor messaging scenarios. Therefore we have embedded the ForkJoinPool from Scala 2.11 in
Akka. This breaks binary backwards compatibility for custom <code class="docutils literal"><span class="pre">Mailbox</span></code> implementations that were
compiled with Akka 2.4.</p>
<p>This is only a problem if you are using a library that provides a custom <code class="docutils literal"><span class="pre">Mailbox</span></code> implementation.
The change is source compatible and such library should be recompiled and released for Akka 2.5.</p>
</div>
<div class="section" id="streams">
<h2>Streams</h2>
<div class="section" id="removal-of-statefulstage-pushpullstage">
<h3>Removal of StatefulStage, PushPullStage</h3>
<p><code class="docutils literal"><span class="pre">StatefulStage</span></code> and <code class="docutils literal"><span class="pre">PushPullStage</span></code> were first introduced in Akka Streams 1.0, and later deprecated
and replaced by <code class="docutils literal"><span class="pre">GraphStage</span></code> in 2.0-M2. The <code class="docutils literal"><span class="pre">GraphStage</span></code> API has all features (and even more) as the
previous APIs and is even nicer to use.</p>
<p>Please refer to the GraphStage documentation :ref:` for Scala &lt;graphstage-scala&gt;` or
the documentation <a class="reference internal" href="../scala/stream/stream-customize.html#graphstage-scala"><span>for Java</span></a>, for details on building custom GraphStages.</p>
<p><code class="docutils literal"><span class="pre">StatefulStage</span></code> would be migrated to a simple <code class="docutils literal"><span class="pre">GraphStage</span></code> that contains some mutable state in its <code class="docutils literal"><span class="pre">GraphStageLogic</span></code>,
and <code class="docutils literal"><span class="pre">PushPullStage</span></code> directly translate to graph stages.</p>
</div>
<div class="section" id="removal-of-source-transform-replaced-by-via">
<h3>Removal of <code class="docutils literal"><span class="pre">Source.transform</span></code>, replaced by <code class="docutils literal"><span class="pre">via</span></code></h3>
<p>Along with the removal of <code class="docutils literal"><span class="pre">Stage</span></code> (as described above), the <code class="docutils literal"><span class="pre">transform</span></code> methods creating Flows/Sources/Sinks
from <code class="docutils literal"><span class="pre">Stage</span></code> have been removed. They are replaced by using <code class="docutils literal"><span class="pre">GraphStage</span></code> instances with <code class="docutils literal"><span class="pre">via</span></code>, e.g.:</p>
<div class="highlight-scala"><div class="highlight"><pre><span class="n">exampleFlow</span><span class="o">.</span><span class="n">transform</span><span class="o">(()</span> <span class="k">=&gt;</span> <span class="k">new</span> <span class="nc">MyStage</span><span class="o">())</span>
</pre></div>
</div>
<p>would now be:</p>
<div class="highlight-scala"><div class="highlight"><pre><span class="n">myFlow</span><span class="o">.</span><span class="n">via</span><span class="o">(</span><span class="k">new</span> <span class="nc">MyGraphStage</span><span class="o">)</span>
</pre></div>
</div>
<p>as the <code class="docutils literal"><span class="pre">GraphStage</span></code> itself is a factory of logic instances.</p>
</div>
<div class="section" id="subflow-zip-and-subsource-zip-now-emit-akka-japi-pair-instead-of-scala-s-pair">
<h3>SubFlow.zip and SubSource.zip now emit akka.japi.Pair instead of Scala's Pair</h3>
<p>The the Java API's <code class="docutils literal"><span class="pre">zip</span></code> operator on <code class="docutils literal"><span class="pre">SubFlow</span></code> and <code class="docutils literal"><span class="pre">SubSource</span></code> has been emiting
Scala's <code class="docutils literal"><span class="pre">Pair</span></code> (<code class="docutils literal"><span class="pre">Tuple2</span></code>) instead of <code class="docutils literal"><span class="pre">akka.japi.Pair</span></code>. This is fixed in Akka 2.5 where it emits the proper
Java DSl type.</p>
<p>Please note that the <code class="docutils literal"><span class="pre">zip</span></code> operator on <code class="docutils literal"><span class="pre">Source</span></code> and <code class="docutils literal"><span class="pre">Flow</span></code> has had the correct type,
this change only affects the <code class="docutils literal"><span class="pre">Sub...</span></code> versions of those classes.</p>
</div>
<div class="section" id="deprecation-of-actorsubscriber-and-actorpublisher">
<h3>Deprecation of ActorSubscriber and ActorPublisher</h3>
<p>The classes <code class="docutils literal"><span class="pre">ActorPublisher</span></code> and <code class="docutils literal"><span class="pre">ActorSubscriber</span></code> were the first user-facing Reactive Streams integration
API that we provided for end-users. Akka Streams APIs have evolved and improved a lot since then, and now
there is no need to use these low-level abstractions anymore. It is easy to get things wrong when implementing them,
and one would have to validate each implementation of such Actor using the Reactive Streams Technology Compatibility Kit.</p>
<p>The replacement API is the powerful <code class="docutils literal"><span class="pre">GraphStage</span></code>. It has all features that raw Actors provided for implementing Stream
stages and adds additional protocol and type-safety. You can learn all about it in the documentation:
<a class="reference internal" href="../java/stream/stream-customize.html#stream-customize-java"><span>stream-customize-scala`and :ref:`Custom stream processing in JavaDSL</span></a>.</p>
<p>You should also read the blog post series on the official team blog, starting with <a class="reference external" href="http://blog.akka.io/streams/2016/07/30/mastering-graph-stage-part-1">Mastering GraphStages, part I</a>,
which explains using and implementing GraphStages in more practical terms than the reference documentation.</p>
</div>
<div class="section" id="order-of-attributes-list">
<h3>Order of Attributes List</h3>
<p>Imporant performance improvement could be achieved by reverting the order of the <code class="docutils literal"><span class="pre">attributesList</span></code> in <code class="docutils literal"><span class="pre">Attributes</span></code>.</p>
<p>The <code class="docutils literal"><span class="pre">attributeList</span></code> is ordered with the most specific attribute first, least specific last.
Note that the order was the opposite in Akka 2.4.x (but it was not really documented).</p>
<p>The semantics of the convenience methods, such as <code class="docutils literal"><span class="pre">get</span></code> and <code class="docutils literal"><span class="pre">getFirst</span></code> are the same, but if you use the <code class="docutils literal"><span class="pre">attributesList</span></code>
directly or via <code class="docutils literal"><span class="pre">filtered</span></code> or <code class="docutils literal"><span class="pre">getAttributeList</span></code> you need to take the new order into consideration.</p>
</div>
<div class="section" id="dispatcher-attribute">
<h3>Dispatcher attribute</h3>
<p>The <code class="docutils literal"><span class="pre">ActorAttributes.dispatcher</span></code> attribute is adding an async boundary in 2.5, since that is the typical desired behavior.
In 2.4 an explicit <cite>async</cite> marker (<code class="docutils literal"><span class="pre">AsyncBoundary</span></code> attribute) had to be added. For example, this means that <code class="docutils literal"><span class="pre">Source</span></code> that
defined <code class="docutils literal"><span class="pre">blocking-io-dispatcher</span></code> as default followed by a <code class="docutils literal"><span class="pre">map</span></code> will now be separated by an async boundary, which was not
the case in 2.4.</p>
</div>
<div class="section" id="removal-of-the-auto-fuse-setting">
<h3>Removal of the auto-fuse setting</h3>
<p>In 2.4 fusing stages together into the same actor could be completely disabled with the setting
<code class="docutils literal"><span class="pre">akka.stream.materializer.auto-fusing</span></code>. The new materializer introduced in Akka 2.5 does not support disabling fusing,
so this setting does not have any effect any more and has been deprecated. Running each stage in a stream on a separate
actor can be done by adding explicit async boundaries around every stage. How to add asynchronous boundaries can be seen
in <a class="reference internal" href="../java/stream/stream-flows-and-basics.html#operator-fusion-java"><span>Operator Fusion</span></a> (Java) and <a class="reference internal" href="../scala/stream/stream-flows-and-basics.html#operator-fusion-scala"><span>Operator Fusion</span></a> (Scala).</p>
</div>
</div>
<div class="section" id="remote">
<h2>Remote</h2>
<div class="section" id="mutual-tls-authentication-now-required-by-default-for-netty-based-ssl-transport">
<span id="mig25-mutual"></span><h3>Mutual TLS authentication now required by default for netty-based SSL transport</h3>
<p>Mutual TLS authentication is now required by default for the netty-based SSL transport.</p>
<p>Nodes that are configured with this setting to <code class="docutils literal"><span class="pre">on</span></code> might not be able to receive messages from nodes that run on older
versions of akka-remote. This is because in versions of Akka &lt; 2.4.12 the active side of the remoting
connection will not send over certificates even if asked to.</p>
<dl class="docutils">
<dt>It is still possible to make a rolling upgrade from a version &lt; 2.4.12 by doing the upgrade stepwise:</dt>
<dd><ul class="first last simple">
<li>first, upgrade Akka to the latest version but keep <code class="docutils literal"><span class="pre">akka.remote.netty.ssl.require-mutual-authentication</span></code> at <code class="docutils literal"><span class="pre">off</span></code>
and do a first rolling upgrade</li>
<li>second, turn the setting to <code class="docutils literal"><span class="pre">on</span></code> and do another rolling upgrade</li>
</ul>
</dd>
</dl>
<p>For more information see the documentation for the <code class="docutils literal"><span class="pre">akka.remote.netty.ssl.require-mutual-authentication</span></code> configuration setting
in <a class="reference internal" href="../general/configuration.html#config-akka-remote"><span>akka-remote's reference.conf</span></a>.</p>
</div>
<div class="section" id="additional-serialization-bindings">
<span id="mig25-addser"></span><h3>additional-serialization-bindings</h3>
<p>From Akka 2.5.0 the <code class="docutils literal"><span class="pre">additional-serialization-bindings</span></code> are enabled by default. That defines
serializers that are replacing some Java serialization that were used in 2.4. This setting was disabled
by default in Akka 2.4.16 but can also be enabled in an Akka 2.4 system.</p>
<p>To still be able to support rolling upgrade from a system with this setting disabled, e.g. default for 2.4.16,
it is possible to disable the additional serializers and continue using Java serialization for those messages.</p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="n">akka</span><span class="o">.</span><span class="n">actor</span> <span class="p">{</span>
  <span class="c1"># Set this to off to disable serialization-bindings define in</span>
  <span class="c1"># additional-serialization-bindings. That should only be needed</span>
  <span class="c1"># for backwards compatibility reasons.</span>
  <span class="n">enable</span><span class="o">-</span><span class="n">additional</span><span class="o">-</span><span class="n">serialization</span><span class="o">-</span><span class="n">bindings</span> <span class="o">=</span> <span class="n">off</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Please note that this setting must be the same on all nodes participating in a cluster, otherwise
the mis-aligned serialization configurations will cause deserialization errors on the receiving nodes.</p>
</div>
<div class="section" id="with-serialize-messages-the-deserialized-message-is-actually-sent">
<h3>With serialize-messages the deserialized message is actually sent</h3>
<p>The flag <code class="docutils literal"><span class="pre">akka.actor.serialize-message</span> <span class="pre">=</span> <span class="pre">on</span></code> triggers serialization and deserialization of each message sent in the
<code class="docutils literal"><span class="pre">ActorSystem</span></code>. With this setting enabled the message actually passed on to the actor previously was the original
message instance, this has now changed to be the deserialized message instance.</p>
<p>This may cause tests that rely on messages being the same instance (for example by having mutable messages with attributes
that are asserted in the tests) to not work any more with this setting enabled. For such cases the recommendation is to
either not rely on messages being the same instance or turn the setting off.</p>
</div>
<div class="section" id="wire-protocol-compatibility">
<h3>Wire Protocol Compatibility</h3>
<p>It is possible to use Akka Remoting between nodes running Akka 2.4.16 and 2.5-M1, but some settings have changed so you might need
to adjust some configuration as described in <a class="reference internal" href="#mig25-rolling"><span>Rolling Update</span></a>.</p>
<p>Note however that if using Java serialization it will not be possible to mix nodes using Scala 2.11 and 2.12.</p>
</div>
</div>
<div class="section" id="cluster">
<h2>Cluster</h2>
<div class="section" id="rolling-update">
<span id="mig25-rolling"></span><h3>Rolling Update</h3>
<p>It is possible to do a rolling update from Akka 2.4.16 to 2.5-M1, i.e. running a cluster of 2.4.16 nodes and
join nodes running 2.5-M1 followed by shutting down the old nodes.</p>
<p>You must first update all nodes to 2.4.16. It's not supported to update directly from an older version than
2.4.16 to 2.5-M1. For example, if you are running 2.4.11 you must first do a rolling update to 2.4.16, shut down
all 2.4.11 nodes, and then do the rolling update to 2.5-M1.</p>
<p>For some configuration settings it's important to use the same values on all nodes in the cluster.
Some settings have changed default value in 2.5-M1 and therefore you need to review your configuration
before doing a rolling update to 2.5-M1. Such settings are mentioned elsewhere in this migration guide
and here is a summary of things to consider.</p>
<ul class="simple">
<li><a class="reference internal" href="#mig25-addser"><span>additional-serialization-bindings</span></a></li>
<li><a class="reference internal" href="#mig25-weaklyup"><span>WeaklyUp</span></a></li>
<li><a class="reference internal" href="#mig25-sharding-store"><span>Cluster Sharding state-store-mode</span></a></li>
<li><a class="reference internal" href="#mig25-mutual"><span>Mutual TLS authentication now required by default for netty-based SSL transport</span></a></li>
</ul>
</div>
<div class="section" id="coordinated-shutdown">
<h3>Coordinated Shutdown</h3>
<p>There is a new extension named <code class="docutils literal"><span class="pre">CoordinatedShutdown</span></code> that will stop certain actors and
services in a specific order and perform registered tasks during the shutdown process.</p>
<p>When using Akka Cluster, tasks for graceful leaving of cluster including graceful
shutdown of Cluster Singletons and Cluster Sharding are now performed automatically.</p>
<p>Previously it was documented that things like terminating the <code class="docutils literal"><span class="pre">ActorSystem</span></code> should be
done when the cluster member was removed, but this was very difficult to get right.
That is now taken care of automatically. This might result in changed behavior, hopefully
to the better. It might also be in conflict with your previous shutdown code so please
read the documentation for the Coordinated Shutdown and revisit your own implementations.
Most likely your implementation will not be needed any more or it can be simplified.</p>
<p>More information can be found in the <a class="reference internal" href="../scala/actors.html#coordinated-shutdown-scala"><span>documentation for Scala</span></a> or
<a class="reference internal" href="../java/actors.html#coordinated-shutdown-java"><span>documentation for Java</span></a></p>
<p>For some tests it might be undesired to terminate the <code class="docutils literal"><span class="pre">ActorSystem</span></code> via <code class="docutils literal"><span class="pre">CoordinatedShutdown</span></code>.
You can disable that by adding the following to the configuration of the <code class="docutils literal"><span class="pre">ActorSystem</span></code> that is
used in the test:</p>
<div class="highlight-scala"><div class="highlight"><pre><span class="k">#</span> <span class="nc">Don</span><span class="-Symbol">&#39;t</span> <span class="n">terminate</span> <span class="nc">ActorSystem</span> <span class="n">via</span> <span class="nc">CoordinatedShutdown</span> <span class="n">in</span> <span class="n">tests</span>
<span class="n">akka</span><span class="o">.</span><span class="n">coordinated</span><span class="o">-</span><span class="n">shutdown</span><span class="o">.</span><span class="n">terminate</span><span class="o">-</span><span class="n">actor</span><span class="o">-</span><span class="n">system</span> <span class="k">=</span> <span class="n">off</span>
<span class="n">akka</span><span class="o">.</span><span class="n">coordinated</span><span class="o">-</span><span class="n">shutdown</span><span class="o">.</span><span class="n">run</span><span class="o">-</span><span class="n">by</span><span class="o">-</span><span class="n">jvm</span><span class="o">-</span><span class="n">shutdown</span><span class="o">-</span><span class="n">hook</span> <span class="k">=</span> <span class="n">off</span>
<span class="n">akka</span><span class="o">.</span><span class="n">cluster</span><span class="o">.</span><span class="n">run</span><span class="o">-</span><span class="n">coordinated</span><span class="o">-</span><span class="n">shutdown</span><span class="o">-</span><span class="n">when</span><span class="o">-</span><span class="n">down</span> <span class="k">=</span> <span class="n">off</span>
</pre></div>
</div>
</div>
<div class="section" id="weaklyup">
<span id="mig25-weaklyup"></span><h3>WeaklyUp</h3>
<p><a class="reference internal" href="../scala/cluster-usage.html#weakly-up-scala"><span>WeaklyUp Members</span></a> is now enabled by default, but it can be disabled with configuration option:</p>
<div class="highlight-scala"><div class="highlight"><pre><span class="n">akka</span><span class="o">.</span><span class="n">cluster</span><span class="o">.</span><span class="n">allow</span><span class="o">-</span><span class="n">weakly</span><span class="o">-</span><span class="n">up</span><span class="o">-</span><span class="n">members</span> <span class="k">=</span> <span class="n">off</span>
</pre></div>
</div>
<p>You should not run a cluster with this feature enabled on some nodes and disabled on some. Therefore
you might need to enable/disable it in configuration when performing rolling upgrade from 2.4.x to 2.5.0.</p>
</div>
<div class="section" id="cluster-sharding-state-store-mode">
<span id="mig25-sharding-store"></span><h3>Cluster Sharding state-store-mode</h3>
<p>Distributed Data mode is now the default <code class="docutils literal"><span class="pre">state-store-mode</span></code> for Cluster Sharding. The persistence mode
is also supported. Read more in the documentation <a class="reference internal" href="../scala/cluster-sharding.html#cluster-sharding-mode-scala"><span>for Scala</span></a> or
the documentation <a class="reference internal" href="../java/cluster-sharding.html#cluster-sharding-mode-java"><span>for Java</span></a>.</p>
<p>It's important to use the same mode on all nodes in the cluster, i.e. if you perform a rolling upgrade
from 2.4.16 you might need to change the <code class="docutils literal"><span class="pre">state-store-mode</span></code> to be the same (<code class="docutils literal"><span class="pre">persistence</span></code> is default
in 2.4.x):</p>
<div class="highlight-scala"><div class="highlight"><pre><span class="n">akka</span><span class="o">.</span><span class="n">cluster</span><span class="o">.</span><span class="n">sharding</span><span class="o">.</span><span class="n">state</span><span class="o">-</span><span class="n">store</span><span class="o">-</span><span class="n">mode</span> <span class="k">=</span> <span class="n">persistence</span>
</pre></div>
</div>
<p>Note that the stored <a class="reference internal" href="../java/cluster-sharding.html#cluster-sharding-remembering-java"><span>Remembering Entities</span></a> data with <code class="docutils literal"><span class="pre">persistence</span></code> mode cannot
be migrated to the <code class="docutils literal"><span class="pre">data</span></code> mode. Such entities must be started again in some other way when using
<code class="docutils literal"><span class="pre">ddata</span></code> mode.</p>
</div>
<div class="section" id="cluster-management-command-line-tool">
<h3>Cluster Management Command Line Tool</h3>
<p>There is a new cluster management tool with HTTP API that has the same functionality as the command line tool.
The HTTP API gives you access to cluster membership information as JSON including full reachability status between the nodes.
It supports the ordinary cluster operations such as join, leave, and down.</p>
<p>See documentation of <a class="reference external" href="https://github.com/akka/akka-cluster-management">akka/akka-cluster-management</a>.</p>
<p>The command line script for cluster management has been deprecated and is scheduled for removal
in the next major version. Use the HTTP API with <a class="reference external" href="https://curl.haxx.se/">curl</a> or similar instead.</p>
</div>
</div>
<div class="section" id="distributed-data">
<h2>Distributed Data</h2>
<p>Distributed Data has been promoted to a stable module. This means that we will keep the API stable from this point. As a result
the module name is changed from <cite>akka-distributed-data-experimental</cite> to <cite>akka-distributed-data</cite> and you need to change that in your
build tool (sbt/mvn/...).</p>
<div class="section" id="map-allow-generic-type-for-the-keys">
<h3>Map allow generic type for the keys</h3>
<p>In 2.4 the key of any Distributed Data map always needed to be of type String. In 2.5 you can use any type for the key. This means that
every map (ORMap, LWWMap, PNCounterMap, ORMultiMap) now takes an extra type parameter to specify the key type. To migrate
existing code from 2.4 to 2.5 you simple add String as key type, for example: <cite>ORMultiMap[Foo]</cite> becomes <cite>ORMultiMap[String, Foo]</cite>.
<cite>PNCounterMap</cite> didn't take a type parameter in version 2.4, so <cite>PNCounterMap</cite> in 2.4 becomes <cite>PNCounterMap[String]</cite> in 2.5.
Java developers should use <cite>&lt;&gt;</cite> instead of <cite>[]</cite>, e.g: <cite>PNCounterMap&lt;String&gt;</cite>.</p>
<p><strong>NOTE: Even though the interface is not compatible between 2.4 and 2.5, the binary protocol over the wire is (as long
as you use String as key type). This means that 2.4 nodes can synchronize with 2.5 nodes.</strong></p>
</div>
<div class="section" id="subscribers">
<h3>Subscribers</h3>
<p>When an entity is removed subscribers will not receive <code class="docutils literal"><span class="pre">Replicator.DataDeleted</span></code> any more.
They will receive <code class="docutils literal"><span class="pre">Replicator.Deleted</span></code> instead.</p>
</div>
</div>
<div class="section" id="persistence">
<h2>Persistence</h2>
<div class="section" id="binary-incompatibility-of-persistentactor-and-atleastonedelivery">
<h3>Binary incompatibility of PersistentActor and AtLeastOneDelivery</h3>
<p>To be able to evolve the Java APIs <code class="docutils literal"><span class="pre">AbstractPersistentActor</span></code> and <code class="docutils literal"><span class="pre">AbstractPersistentActorWithAtLeastOnceDelivery</span></code>
to work with Scala 2.12 we could find no other solution but to break the binary compatibility of the Scala versions
(which the Java ones were based on).</p>
<p>This means that the Akka 2.5 artifact cannot be a class path drop in replacement of Akka 2.4 if you use
<code class="docutils literal"><span class="pre">PersistentActor</span></code> or <code class="docutils literal"><span class="pre">AtLeastOnceDelivery</span></code>, to do this upgrade you _must_ recompile your project with the new
version of Akka.</p>
</div>
<div class="section" id="removal-of-persistentview">
<h3>Removal of PersistentView</h3>
<p>After being deprecated for a long time, and replaced by <a class="reference internal" href="../java/persistence-query.html#persistence-query-java"><span>Persistence Query Java</span></a>
(<a class="reference internal" href="../scala/persistence-query.html#persistence-query-scala"><span>Persistence Query Scala</span></a>) <code class="docutils literal"><span class="pre">PersistentView</span></code> has been removed now removed.</p>
<p>The corresponding query type is <code class="docutils literal"><span class="pre">EventsByPersistenceId</span></code>. There are several alternatives for connecting the <code class="docutils literal"><span class="pre">Source</span></code>
to an actor corresponding to a previous <code class="docutils literal"><span class="pre">PersistentView</span></code>. There are several alternatives for connecting the <code class="docutils literal"><span class="pre">Source</span></code>
to an actor corresponding to a previous <code class="docutils literal"><span class="pre">PersistentView</span></code> actor which are documented in <a class="reference internal" href="../scala/stream/stream-integrations.html#stream-integrations-scala"><span>Integration</span></a>
for Scala and <a class="reference internal" href="../java/stream/stream-integrations.html#stream-integrations-java"><span>Java</span></a>.</p>
<p>The consuming actor may be a plain <code class="docutils literal"><span class="pre">Actor</span></code> or an <code class="docutils literal"><span class="pre">PersistentActor</span></code> if it needs to store its own state (e.g. <code class="docutils literal"><span class="pre">fromSequenceNr</span></code> offset).</p>
<p>Please note that Persistence Query is not experimental/may-change anymore in Akka <code class="docutils literal"><span class="pre">2.5.0</span></code>, so you can safely upgrade to it.</p>
</div>
<div class="section" id="persistence-plugin-proxy">
<h3>Persistence Plugin Proxy</h3>
<p>A new <a class="reference internal" href="../scala/persistence.html#persistence-plugin-proxy"><span>persistence plugin proxy</span></a> was added, that allows sharing of an otherwise
non-sharable journal or snapshot store. The proxy is available by setting <code class="docutils literal"><span class="pre">akka.persistence.journal.plugin</span></code> or
<code class="docutils literal"><span class="pre">akka.persistence.snapshot-store.plugin</span></code> to <code class="docutils literal"><span class="pre">akka.persistence.journal.proxy</span></code> or <code class="docutils literal"><span class="pre">akka.persistence.snapshot-store.proxy</span></code>,
respectively. The proxy supplants the <a class="reference internal" href="../scala/persistence.html#shared-leveldb-journal"><span>Shared LevelDB journal</span></a>.</p>
</div>
</div>
<div class="section" id="persistence-query">
<h2>Persistence Query</h2>
<p>Persistence Query has been promoted to a stable module. As a result the module name is changed from <cite>akka-persistence-query-experimental</cite>
to <cite>akka-persistence-query</cite> and you need to change that in your build tool (sbt/mvn/...).
Only slight API changes were made since the module was introduced:</p>
<div class="section" id="query-naming-consistency-improved">
<h3>Query naming consistency improved</h3>
<p>Queries always fall into one of the two categories: infinite or finite (&quot;current&quot;).
The naming convention for these categories of queries was solidified and is now as follows:</p>
<ul class="simple">
<li>&quot;infinite&quot; - e.g. <code class="docutils literal"><span class="pre">eventsByTag</span></code>, <code class="docutils literal"><span class="pre">persistenceIds</span></code> - which will keep emitting events as they are persisted and match the query.</li>
<li>&quot;finite&quot;, also known as &quot;current&quot; - e.g. <code class="docutils literal"><span class="pre">currentEventsByTag</span></code>, <code class="docutils literal"><span class="pre">currentPersistenceIds</span></code> - which will complete the stream once the query completed,
for the journal's definition of &quot;current&quot;. For example in an SQL store it would mean it only queries the database once.</li>
</ul>
<p>Only the <code class="docutils literal"><span class="pre">AllPersistenceIdsQuery</span></code> class and method name changed due to this.
The class is now called <code class="docutils literal"><span class="pre">PersistenceIdsQuery</span></code>, and the method which used to be <code class="docutils literal"><span class="pre">allPersistenceIds</span></code> is now <code class="docutils literal"><span class="pre">persistenceIds</span></code>.</p>
</div>
<div class="section" id="queries-now-use-offset-instead-of-long-for-offsets">
<h3>Queries now use <code class="docutils literal"><span class="pre">Offset</span></code> instead of <code class="docutils literal"><span class="pre">Long</span></code> for offsets</h3>
<p>This change was made to better accomodate the various types of Journals and their understanding what an offset is.
For example, in some journals an offset is always a time, while in others it is a numeric offset (like a sequence id).</p>
<p>Instead of the previous <code class="docutils literal"><span class="pre">Long</span></code> offset you can now use the provided <code class="docutils literal"><span class="pre">Offset</span></code> factories (and types):</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">akka.persistence.query.Offset.sequence(value:</span> <span class="pre">Long)</span></code>,</li>
<li><code class="docutils literal"><span class="pre">akka.persistence.query.Offset.timeBasedUUID(value:</span> <span class="pre">UUID)</span></code></li>
<li>and finally <code class="docutils literal"><span class="pre">NoOffset</span></code> if not offset should be used.</li>
</ul>
<p>Journals are also free to provide their own specific <code class="docutils literal"><span class="pre">Offset</span></code> types. Consult your journal plugin's documentation for details.</p>
</div>
</div>
<div class="section" id="agents">
<h2>Agents</h2>
<div class="section" id="agents-are-now-deprecated">
<h3>Agents are now deprecated</h3>
<p>Akka Agents are a very simple way of containing mutable state and allowing to access it safely from
multiple threads. The abstraction is leaky though, as Agents do not work over the network (unlike Akka Actors).</p>
<p>As users were often confused by &quot;when to use an Actor vs. when to use an Agent?&quot; a decision was made to deprecate
the Agents, as they rarely are really enough and do not fit the Akka spirit of thinking about distribution.
We also anticipate to replace the uses of Agents by the upcoming Akka Typed, so in preparation thereof the Agents have been deprecated in 2.5.</p>
<p>If you use Agents and would like to take over the maintanance thereof, please contact the team on gitter or github.</p>
</div>
</div>
<div class="section" id="camel">
<h2>Camel</h2>
<p><code class="docutils literal"><span class="pre">akka-camel</span></code> has been deprecated in favour of <a class="reference external" href="https://github.com/akka/alpakka">Alpakka</a> ,
the Akka Streams based collection of integrations to various endpoints (including Camel)</p>
<p>We acknowledge that Akka Camel is a very useful and important module. It will not be removed until
Alpakka has reached the needed production quality to be a full replacement. The deprecation of
Akka Camel should be seen as a signal that new development is to be invested in Alpakka instead
of Akka Camel.</p>
</div>
<div class="section" id="contrib">
<h2>Contrib</h2>
<p><code class="docutils literal"><span class="pre">akka-contrib</span></code> has been deprecated and is scheduled for removal in the next major version.
The reason is to reduce the amount of things to maintain in the core Akka projects.
Contributions to the core of Akka or its satellite projects are welcome. Contributions
that don't fit into existing modules can be hosted in new Akka Github repositories in the
<code class="docutils literal"><span class="pre">akka</span></code> Github organization or outside of it depending on what kind of library it is.
Please ask.</p>
<div class="section" id="aggregator">
<h3>Aggregator</h3>
<p><code class="docutils literal"><span class="pre">Aggregator</span></code> has been deprecated. Feel free to copy the source into your project or create a
separate library outside of Akka.</p>
</div>
<div class="section" id="circuitbreakerproxy">
<h3>CircuitBreakerProxy</h3>
<p><code class="docutils literal"><span class="pre">CircuitBreakerProxy</span></code> has been deprecated in favor of <code class="docutils literal"><span class="pre">akka.pattern.CircuitBreaker</span></code> with explicit <code class="docutils literal"><span class="pre">ask</span></code> requests.</p>
</div>
<div class="section" id="javalogger">
<h3>JavaLogger</h3>
<p><code class="docutils literal"><span class="pre">akka.contrib.jul.JavaLogger</span></code> has been deprecated and included in <code class="docutils literal"><span class="pre">akka-actor</span></code> instead as
<code class="docutils literal"><span class="pre">akka.event.jul.JavaLogger</span></code>. See <a class="reference internal" href="../scala/logging.html#jul-scala"><span>documentation</span></a>.</p>
<p>The <code class="docutils literal"><span class="pre">JavaLoggingAdapter</span></code> has also been deprecated, but not included in <code class="docutils literal"><span class="pre">akka-actor</span></code>.
Feel free to copy the source into your project or create a separate library outside of Akka.</p>
</div>
<div class="section" id="peekmailbox">
<h3>PeekMailbox</h3>
<p><code class="docutils literal"><span class="pre">PeekMailbox</span></code> has been deprecated. Use an explicit supervisor or proxy actor instead.</p>
</div>
<div class="section" id="receivepipeline">
<span id="migration-guide-timerbasedthrottler"></span><h3>ReceivePipeline</h3>
<p><code class="docutils literal"><span class="pre">ReceivePipeline</span></code> has been deprecated. Feel free to copy the source into your project or create
a separate library outside of Akka.</p>
</div>
<div class="section" id="reliableproxy">
<h3>ReliableProxy</h3>
<p><code class="docutils literal"><span class="pre">ReliableProxy</span></code> has been deprecated. Use <a class="reference internal" href="../scala/persistence.html#at-least-once-delivery-scala"><span>At-Least-Once Delivery</span></a> instead. <code class="docutils literal"><span class="pre">ReliableProxy</span></code>
was only intended as an example and doesn't have full production quality. If there is demand
for a lightweight (non-durable) at-least once delivery mechanism we are open for a design discussion.</p>
</div>
<div class="section" id="timerbasedthrottler">
<h3>TimerBasedThrottler</h3>
<p><code class="docutils literal"><span class="pre">TimerBasedThrottler</span></code> has been deprecated. Use the <code class="docutils literal"><span class="pre">throttle</span></code> stage in Akka Streams instead.</p>
<p>Example in Scala:</p>
<div class="highlight-scala"><div class="highlight"><pre><span class="k">import</span> <span class="nn">scala.concurrent.duration._</span>
<span class="k">import</span> <span class="nn">akka.NotUsed</span>
<span class="k">import</span> <span class="nn">akka.actor.ActorRef</span>
<span class="k">import</span> <span class="nn">akka.actor.ActorSystem</span>
<span class="k">import</span> <span class="nn">akka.stream.ActorMaterializer</span>
<span class="k">import</span> <span class="nn">akka.stream.OverflowStrategy</span>
<span class="k">import</span> <span class="nn">akka.stream.ThrottleMode</span>
<span class="k">import</span> <span class="nn">akka.stream.scaladsl.Sink</span>
<span class="k">import</span> <span class="nn">akka.stream.scaladsl.Source</span>

<span class="k">val</span> <span class="n">system</span><span class="k">:</span> <span class="kt">ActorSystem</span> <span class="o">=</span> <span class="o">???</span> <span class="c1">// TODO real ActorSystem here</span>
<span class="k">val</span> <span class="n">target</span><span class="k">:</span> <span class="kt">ActorRef</span> <span class="o">=</span> <span class="o">???</span> <span class="c1">// TODO real target ActorRef here</span>
<span class="k">implicit</span> <span class="k">val</span> <span class="n">materializer</span> <span class="k">=</span> <span class="nc">ActorMaterializer</span><span class="o">.</span><span class="n">create</span><span class="o">(</span><span class="n">system</span><span class="o">)</span>

<span class="k">val</span> <span class="n">throttler</span><span class="k">:</span> <span class="kt">ActorRef</span> <span class="o">=</span>
  <span class="nc">Source</span><span class="o">.</span><span class="n">actorRef</span><span class="o">(</span><span class="n">bufferSize</span> <span class="k">=</span> <span class="mi">1000</span><span class="o">,</span> <span class="nc">OverflowStrategy</span><span class="o">.</span><span class="n">dropNew</span><span class="o">)</span>
    <span class="o">.</span><span class="n">throttle</span><span class="o">(</span><span class="mi">100</span><span class="o">,</span> <span class="mf">1.</span><span class="n">second</span><span class="o">,</span> <span class="mi">10</span><span class="o">,</span> <span class="nc">ThrottleMode</span><span class="o">.</span><span class="nc">Shaping</span><span class="o">)</span>
    <span class="o">.</span><span class="n">to</span><span class="o">(</span><span class="nc">Sink</span><span class="o">.</span><span class="n">actorRef</span><span class="o">(</span><span class="n">target</span><span class="o">,</span> <span class="nc">NotUsed</span><span class="o">))</span>
    <span class="o">.</span><span class="n">run</span><span class="o">()</span>
</pre></div>
</div>
<p>Example in Java:</p>
<div class="highlight-scala"><div class="highlight"><pre><span class="k">import</span> <span class="nn">java.util.concurrent.TimeUnit</span><span class="o">;</span>
<span class="k">import</span> <span class="nn">scala.concurrent.duration.FiniteDuration</span><span class="o">;</span>
<span class="k">import</span> <span class="nn">akka.NotUsed</span><span class="o">;</span>
<span class="k">import</span> <span class="nn">akka.actor.ActorRef</span><span class="o">;</span>
<span class="k">import</span> <span class="nn">akka.actor.ActorSystem</span><span class="o">;</span>
<span class="k">import</span> <span class="nn">akka.stream.ActorMaterializer</span><span class="o">;</span>
<span class="k">import</span> <span class="nn">akka.stream.Materializer</span><span class="o">;</span>
<span class="k">import</span> <span class="nn">akka.stream.OverflowStrategy</span><span class="o">;</span>
<span class="k">import</span> <span class="nn">akka.stream.ThrottleMode</span><span class="o">;</span>
<span class="k">import</span> <span class="nn">akka.stream.javadsl.Sink</span><span class="o">;</span>
<span class="k">import</span> <span class="nn">akka.stream.javadsl.Source</span><span class="o">;</span>

<span class="k">final</span> <span class="nc">ActorSystem</span> <span class="n">system</span> <span class="k">=</span> <span class="kc">null</span><span class="o">;</span> <span class="c1">// TODO real ActorSystem here</span>
<span class="k">final</span> <span class="nc">ActorRef</span> <span class="n">target</span> <span class="k">=</span> <span class="kc">null</span><span class="o">;</span> <span class="c1">// TODO real target ActorRef here</span>
<span class="k">final</span> <span class="nc">Materializer</span> <span class="n">materializer</span> <span class="k">=</span> <span class="nc">ActorMaterializer</span><span class="o">.</span><span class="n">create</span><span class="o">(</span><span class="n">system</span><span class="o">);</span>

<span class="k">final</span> <span class="nc">ActorRef</span> <span class="n">throttler</span> <span class="k">=</span>
  <span class="nc">Source</span><span class="o">.</span><span class="n">actorRef</span><span class="o">(</span><span class="mi">1000</span><span class="o">,</span> <span class="nc">OverflowStrategy</span><span class="o">.</span><span class="n">dropNew</span><span class="o">())</span>
    <span class="o">.</span><span class="n">throttle</span><span class="o">(</span><span class="mi">100</span><span class="o">,</span>  <span class="nc">FiniteDuration</span><span class="o">.</span><span class="n">create</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="nc">TimeUnit</span><span class="o">.</span><span class="nc">SECONDS</span><span class="o">),</span> <span class="mi">10</span><span class="o">,</span> <span class="nc">ThrottleMode</span><span class="o">.</span><span class="n">shaping</span><span class="o">())</span>
    <span class="o">.</span><span class="n">to</span><span class="o">(</span><span class="nc">Sink</span><span class="o">.</span><span class="n">actorRef</span><span class="o">(</span><span class="n">target</span><span class="o">,</span> <span class="nc">NotUsed</span><span class="o">.</span><span class="n">getInstance</span><span class="o">()))</span>
    <span class="o">.</span><span class="n">run</span><span class="o">(</span><span class="n">materializer</span><span class="o">);</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="akka-typed">
<h2>Akka Typed</h2>
<p>With the new term <a class="reference internal" href="../common/may-change.html#may-change"><span>may change</span></a> we will no longer have a different artifact for modules that are not
stable, and <code class="docutils literal"><span class="pre">akka-typed-experimental</span></code> has therefore been renamed to <code class="docutils literal"><span class="pre">akka-typed</span></code>. Note that it is still not
promoted to a stable module.</p>
</div>
<div class="section" id="experimental-modules">
<h2>Experimental modules</h2>
<p>We have previously marked modules that we did not want to freeze the APIs of a <strong>experimental</strong>, such modules will
instead be marked as <a class="reference internal" href="../common/may-change.html#may-change"><span>may change</span></a> from now on.</p>
</div>
<div class="section" id="testkit">
<h2>Testkit</h2>
<p><code class="docutils literal"><span class="pre">JavaTestKit</span></code> has been deprecated since it does all kinds of tricks to achieve what Scala testkit does.
Use <code class="docutils literal"><span class="pre">akka.testkit.javadsl.TestKit</span></code> instead which introduces nicer APIs.</p>
<p>Old:</p>
<div class="highlight-scala"><div class="highlight"><pre><span class="k">new</span> <span class="nc">JavaTestKit</span><span class="o">(</span><span class="n">system</span><span class="o">)</span> <span class="o">{{</span>
  <span class="k">final</span> <span class="nc">JavaTestKit</span> <span class="n">probe</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">JavaTestKit</span><span class="o">(</span><span class="n">system</span><span class="o">);</span>
  <span class="k">new</span> <span class="nc">Within</span><span class="o">(</span><span class="n">duration</span><span class="o">(</span><span class="s">&quot;1 second&quot;</span><span class="o">))</span> <span class="o">{</span>
    <span class="n">public</span> <span class="n">void</span> <span class="n">run</span><span class="o">()</span> <span class="o">{</span>
      <span class="n">probe</span><span class="o">.</span><span class="n">expectMsgEquals</span><span class="o">(</span><span class="s">&quot;hello&quot;</span><span class="o">);</span>
    <span class="o">}</span>
  <span class="o">};</span>
<span class="o">}};</span>
</pre></div>
</div>
<p>New:</p>
<div class="highlight-scala"><div class="highlight"><pre><span class="k">new</span> <span class="nc">TestKit</span><span class="o">(</span><span class="n">system</span><span class="o">)</span> <span class="o">{{</span>
  <span class="k">final</span> <span class="nc">TestKit</span> <span class="n">probe</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">TestKit</span><span class="o">(</span><span class="n">system</span><span class="o">);</span>
  <span class="n">within</span><span class="o">(</span><span class="n">duration</span><span class="o">(</span><span class="s">&quot;1 second&quot;</span><span class="o">),</span> <span class="o">()</span> <span class="o">-&gt;</span> <span class="n">probe</span><span class="o">.</span><span class="n">expectMsgEquals</span><span class="o">(</span><span class="s">&quot;hello&quot;</span><span class="o">));</span>
<span class="o">}};</span>
</pre></div>
</div>
</div>
</div>


          </div>
          <div class="span3"><p class="contents-title">Contents</p>
              <div id="scroller-anchor">
                <div id="scroller">
                  <div id="toc"></div>
                </div>
              </div></div>
        </div>
      </div>
    </div>
  </div>
  <div class="footer">
  <div class="container">
    <ul>
      <li><h5>Akka</h5></li>
      <li><a href="https://akka.io/docs">Documentation</a></li>
      <li><a href="https://doc.akka.io/docs/akka/current/additional/faq.html">FAQ</a></li>
      <li><a href="https://akka.io/downloads">Downloads</a></li>
      <li><a href="https://akka.io/news">News</a></li>
      <li><a href="http://letitcrash.com">Blog</a></li>
    </ul>
    <ul>
      <li><h5>Contribute</h5></li>
      <li><a href="https://akka.io/community">Community Projects</a></li>
      <li><a href="http://github.com/akka/akka">Source Code</a></li>
      <li><a href="http://groups.google.com/group/akka-user">Mailing List</a></li>
      <li><a href="https://doc.akka.io/docs/akka/current/project/issue-tracking.html">Report a Bug</a></li>
    </ul>
    <ul>
      <li><h5>Company</h5></li>
      <li><a href="http://www.lightbend.com/how/subscription">Commercial Support</a></li>
      <li><a href="https://akka.io/team">Team</a></li>
      <li><a href="mailto:info@lightbend.com">Contact</a></li>
    </ul>
    <ul>
      <li><img src="../_static/akka_icon_reverse.svg" align="center"/></li>
    </ul>
  </div>
  <div class="container copyright">
    <p style="float: left;">
      © 2015 <a href="http://www.lightbend.com/">Lightbend Inc.</a> <span class="license">Akka is Open Source and available under the Apache 2 License.</span>
    </p>
    <p style="float: right; font-size: 12px;">
      Last updated: May 02, 2017
    </p>
  </div>
</div>
<script type="text/javascript">
  var $toc = $('#toc');
  $toc.toc();

  // show clickable section sign when section header hovered:
  $('.section h2,.section h3,.section h4,.section h5').each(function(i, el) {
      var $el = $(el);
      $el.prepend($("<a class='section-marker' href='#" + $el.attr("id") + "'>&sect;</a>"))
  });
</script>

<!-- Algolia docs search -->
<script type="text/javascript">
  var version = DOCUMENTATION_OPTIONS.VERSION;

  var lang = "scala";
  var path = window.location.pathname;
  if (path.includes("/java/") || path.includes("java.html")) lang = "java";

  console.log("Search configured for:", lang, "@", version);

  docsearch({
    apiKey: '543bad5ad786495d9ccd445ed34ed082',
    indexName: 'akka_io',
    inputSelector: '#search',
    algoliaOptions: {
      hitsPerPage: 5,
      facetFilters: '[' + '["language:' + lang + '","language:general"]' + ',"version:' + version + '"]'
    }
  });

  // set up "/" as global shortcut for focusing on search
  $(document).keypress(function (event) {
    if (event.keyCode == 47) {
      $("#q").focus();
      return false; // swallow key event, otherwise the / char would be input into the search box
    }
  });
</script>

  

  </body>
</html>