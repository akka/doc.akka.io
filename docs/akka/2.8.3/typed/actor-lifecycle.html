<!DOCTYPE html>
<html class="no-js" lang="en">

<head>
<title>Actor lifecycle &bull; Akka Documentation</title>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<meta name="description" content="The Akka Actor lifecycle."/>
<link rel="canonical" href="https://doc.akka.io/docs/akka/current/typed/actor-lifecycle.html"/>
<script type="text/javascript" src="../lib/jquery/jquery.min.js"></script>
<script type="text/javascript" src="../lib/foundation/dist/js/foundation.min.js"></script>
<link rel="stylesheet" type="text/css" href="../lib/normalize.css/normalize.css"/>
<link rel="stylesheet" type="text/css" href="../lib/foundation/dist/css/foundation.min.css"/>
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.css" />
<link rel="stylesheet" type="text/css" href="../css/icons.css"/>
<link rel="stylesheet" type="text/css" href="../css/page-8.css"/>
<link rel="stylesheet" type="text/css" href="../css/banner-2.css"/>
<link rel="shortcut icon" href="../images/favicon.ico" />
<link rel="apple-touch-icon" sizes="180x180" href="../images/apple-touch-icon.png"/>
<link rel="icon" type="image/png" sizes="32x32" href="../images/favicon-32x32.png"/>
<link rel="icon" type="image/png" sizes="16x16" href="../images/favicon-16x16.png"/>
<link rel="manifest" href="../images/manifest.json"/>
<meta name="msapplication-TileImage" content="../images/mstile-150x150.png"/>
<meta name="msapplication-TileColor" content="#15a9ce"/>
<meta name="theme-color" content="#15a9ce"/>
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>
<!-- OneTrust Cookies Consent Notice (Production Standard, akka.io, en-GB) start -->
<script src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js"  type="text/javascript" charset="UTF-8" data-domain-script="28b912e7-09e9-43d5-91e4-3d1897044004" ></script>
<script type="text/javascript">
function OptanonWrapper() { }
</script>
<!-- OneTrust Cookies Consent Notice (Production Standard, akka.io, en-GB) end -->
<!--Google Analytics NOTE this will stop processing data July 1st 2023. At which point this embed code can be removed-->
<script type="text/plain" class="optanon-category-2">
var _gaq = _gaq || [];
_gaq.push(['_setAccount', 'UA-21117439-1']);
_gaq.push(['_setDomainName', 'akka.io']);
_gaq.push(['_trackPageview']);
(function() {
var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})()
</script>

<!-- Google Tag Manager: Updated May 17th 2023 - Cookie Compliance checks have been moved into Google Tag Manager -->
<script type="text/javascript">
(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-KBJGH35');
</script>

</head>

<body id="underlay" data-toggler="nav-open">
<div id="lightbend-banner" class="lightbend-banner akka full-width" data-category="OSS Lightbend Banner Impression" data-label="Akka Banner Impression">
<div class="oss-wrapper">
<div class="oss-brand">
<a class="oss-track-link-label" data-category="OSS Lightbend Banner Clicks" data-label="Lightbend Logo - Akka Banner" href="https://www.lightbend.com">
<img class="lightbend-logo" src="../images/banner-logos/lightbend-reverse.svg" alt="Lightbend" title="Lightbend">
</a>
</div>
<div class="oss-ad no-drop-down">
<nav id="lightbendRotator" class="lightbend-rotator">
<a class="oss-track-link-label" data-category="OSS Lightbend Banner Clicks" data-label="Promo Rotator - Lightbend Changed its Software Licensing Model for Akka Technology. [License FAQ] - Akka Banner" href="https://www.lightbend.com/akka/license-faq">
<strong>Lightbend</strong> Changed its Software Licensing Model for Akka Technology. <span class="akka-btn">License FAQ</span>
</a>
</nav>
</div>
</div>
</div>

<header class="site-header hide-for-large">
<div class="sticky-header clearfix">
<a href="https://akka.io"><img class="logo" src="../images/akka-logo-reverse.svg"/></a>

<button class="menu-icon float-right" type="button" data-toggle="underlay overlay"></button>
</div>
<div id="overlay" class="overlay-nav" data-toggler="nav-open">
<header class="nav-header">
<div class="nav-header-title">
<h1><a href="../index.html">Akka Documentation</a></h1>
</div>
<div class="nav-header-version">
Version 2.8.3
</div>
<div class="nav-header-groups">
<select class="supergroup" name="Language"><option class="group" value="group-scala">Scala</option><option class="group" value="group-java">Java</option></select>
</div>
<div id="overlay-search-container" class="nav-header-search">
<input id="overlay-search" type="search" class="search" placeholder="Search" />
</div>
</header>
<nav class="nav-toc">
<ul>
  <li><a href="../security/index.html" class="page">Security Announcements</a></li>
  <li><a href="../typed/guide/index.html" class="page">Getting Started Guide</a></li>
  <li><a href="../general/index.html" class="page">General Concepts</a></li>
  <li><a href="../typed/index.html" class="page">Actors</a>
  <ul>
    <li><a href="../typed/actors.html" class="page">Introduction to Actors</a></li>
    <li><a href="../typed/actor-lifecycle.html#actor-lifecycle" class="active page">Actor lifecycle</a>
    <ul>
      <li><a href="../typed/actor-lifecycle.html#dependency" class="header">Dependency</a></li>
      <li><a href="../typed/actor-lifecycle.html#introduction" class="header">Introduction</a></li>
      <li><a href="../typed/actor-lifecycle.html#creating-actors" class="header">Creating Actors</a></li>
      <li><a href="../typed/actor-lifecycle.html#stopping-actors" class="header">Stopping Actors</a></li>
      <li><a href="../typed/actor-lifecycle.html#watching-actors" class="header">Watching Actors</a></li>
    </ul></li>
    <li><a href="../typed/interaction-patterns.html" class="page">Interaction Patterns</a></li>
    <li><a href="../typed/fault-tolerance.html" class="page">Fault Tolerance</a></li>
    <li><a href="../typed/actor-discovery.html" class="page">Actor discovery</a></li>
    <li><a href="../typed/routers.html" class="page">Routers</a></li>
    <li><a href="../typed/stash.html" class="page">Stash</a></li>
    <li><a href="../typed/fsm.html" class="page">Behaviors as finite state machines</a></li>
    <li><a href="../coordinated-shutdown.html" class="page">Coordinated Shutdown</a></li>
    <li><a href="../typed/dispatchers.html" class="page">Dispatchers</a></li>
    <li><a href="../typed/mailboxes.html" class="page">Mailboxes</a></li>
    <li><a href="../typed/testing.html" class="page">Testing</a></li>
    <li><a href="../typed/coexisting.html" class="page">Coexistence</a></li>
    <li><a href="../typed/style-guide.html" class="page">Style guide</a></li>
    <li><a href="../typed/from-classic.html" class="page">Learning Akka Typed from Classic</a></li>
  </ul></li>
  <li><a href="../typed/index-cluster.html" class="page">Cluster</a></li>
  <li><a href="../typed/index-persistence.html" class="page">Persistence (Event Sourcing)</a></li>
  <li><a href="../typed/index-persistence-durable-state.html" class="page">Persistence (Durable State)</a></li>
  <li><a href="../stream/index.html" class="page">Streams</a></li>
  <li><a href="../discovery/index.html" class="page">Discovery</a></li>
  <li><a href="../index-utilities.html" class="page">Utilities</a></li>
  <li><a href="../common/other-modules.html" class="page">Other Akka modules</a></li>
  <li><a href="../additional/deploy.html" class="page">Package, Deploy and Run</a></li>
  <li><a href="../project/index.html" class="page">Project Information</a></li>
  <li><a href="../index-classic.html" class="page">Akka Classic</a></li>
</ul>
</nav>
</div>
</header>
<div class="site-content-wrapper">
<aside class="sticky-sidebar show-for-large">
<header class="nav-header sticky-sidebar-header">
<div class="nav-header-title">
<h1><a href="../index.html">Akka Documentation</a></h1>
</div>
<div class="nav-header-version">
Version 2.8.3
</div>
<div class="nav-header-groups">
<select class="supergroup" name="Language"><option class="group" value="group-scala">Scala</option><option class="group" value="group-java">Java</option></select>
</div>
<div class="nav-header-search">
<input id="search" type="search" class="search" placeholder="Search" />
</div>
</header>
<nav class="site-nav sticky-sidebar-contents">
<div class="nav-toc">
<ul>
  <li><a href="../security/index.html" class="page">Security Announcements</a></li>
  <li><a href="../typed/guide/index.html" class="page">Getting Started Guide</a></li>
  <li><a href="../general/index.html" class="page">General Concepts</a></li>
  <li><a href="../typed/index.html" class="page">Actors</a>
  <ul>
    <li><a href="../typed/actors.html" class="page">Introduction to Actors</a></li>
    <li><a href="../typed/actor-lifecycle.html#actor-lifecycle" class="active page">Actor lifecycle</a>
    <ul>
      <li><a href="../typed/actor-lifecycle.html#dependency" class="header">Dependency</a></li>
      <li><a href="../typed/actor-lifecycle.html#introduction" class="header">Introduction</a></li>
      <li><a href="../typed/actor-lifecycle.html#creating-actors" class="header">Creating Actors</a></li>
      <li><a href="../typed/actor-lifecycle.html#stopping-actors" class="header">Stopping Actors</a></li>
      <li><a href="../typed/actor-lifecycle.html#watching-actors" class="header">Watching Actors</a></li>
    </ul></li>
    <li><a href="../typed/interaction-patterns.html" class="page">Interaction Patterns</a></li>
    <li><a href="../typed/fault-tolerance.html" class="page">Fault Tolerance</a></li>
    <li><a href="../typed/actor-discovery.html" class="page">Actor discovery</a></li>
    <li><a href="../typed/routers.html" class="page">Routers</a></li>
    <li><a href="../typed/stash.html" class="page">Stash</a></li>
    <li><a href="../typed/fsm.html" class="page">Behaviors as finite state machines</a></li>
    <li><a href="../coordinated-shutdown.html" class="page">Coordinated Shutdown</a></li>
    <li><a href="../typed/dispatchers.html" class="page">Dispatchers</a></li>
    <li><a href="../typed/mailboxes.html" class="page">Mailboxes</a></li>
    <li><a href="../typed/testing.html" class="page">Testing</a></li>
    <li><a href="../typed/coexisting.html" class="page">Coexistence</a></li>
    <li><a href="../typed/style-guide.html" class="page">Style guide</a></li>
    <li><a href="../typed/from-classic.html" class="page">Learning Akka Typed from Classic</a></li>
  </ul></li>
  <li><a href="../typed/index-cluster.html" class="page">Cluster</a></li>
  <li><a href="../typed/index-persistence.html" class="page">Persistence (Event Sourcing)</a></li>
  <li><a href="../typed/index-persistence-durable-state.html" class="page">Persistence (Durable State)</a></li>
  <li><a href="../stream/index.html" class="page">Streams</a></li>
  <li><a href="../discovery/index.html" class="page">Discovery</a></li>
  <li><a href="../index-utilities.html" class="page">Utilities</a></li>
  <li><a href="../common/other-modules.html" class="page">Other Akka modules</a></li>
  <li><a href="../additional/deploy.html" class="page">Package, Deploy and Run</a></li>
  <li><a href="../project/index.html" class="page">Project Information</a></li>
  <li><a href="../index-classic.html" class="page">Akka Classic</a></li>
</ul>
</div>
</nav>
<footer class="nav-footer sticky-sidebar-footer">
<a href="https://akka.io"><img class="logo" src="../images/akka-logo-reverse.svg"/></a>

</footer>
</aside>
<main class="fixed-shift-for-large expanded row">
<section class="site-content small-12 column">
<article class="page-content row">
<div class="small-12 column" id="docs">
<h1><a href="#actor-lifecycle" name="actor-lifecycle" class="anchor"><span class="anchor-link"></span></a>Actor lifecycle</h1>
<p>You are viewing the documentation for the new actor APIs, to view the Akka Classic documentation, see <a href="../actors.html">Classic Actors</a>.</p>
<h2><a href="#dependency" name="dependency" class="anchor"><span class="anchor-link"></span></a>Dependency</h2>
<p>The Akka dependencies are available from Akka&rsquo;s library repository. To access them there, you need to configure the URL for this repository.</p><dl class="repository"><dt>sbt</dt><dd><pre class="prettyprint"><code class="language-scala">resolvers += "Akka library repository".at("https://repo.akka.io/maven")
</code></pre></dd><dt>Maven</dt><dd><pre class="prettyprint"><code class="language-xml">&lt;project&gt
  ...
  &lt;repositories&gt;
    &lt;repository&gt;
      &lt;id&gt;akka-repository&lt;/id&gt;
      &lt;name>Akka library repository&lt;/name&gt;
      &lt;url>https://repo.akka.io/maven&lt;/url&gt;
    &lt;/repository&gt;
  &lt;/repositories&gt
&lt;/project&gt;
</code></pre></dd><dt>Gradle</dt><dd><pre class="prettyprint"><code class="language-gradle">repositories {
    mavenCentral()
    maven {
        url "https://repo.akka.io/maven"
    }
}
</code></pre></dd></dl>
<p>To use Akka Actor Typed, you must add the following dependency in your project:</p><dl class="dependency"><dt>sbt</dt><dd><pre class="prettyprint"><code class="language-scala">val AkkaVersion = "2.8.3"
libraryDependencies += "com.typesafe.akka" %% "akka-actor-typed" % AkkaVersion</code></pre></dd><dt>Maven</dt><dd><pre class="prettyprint"><code class="language-xml">&lt;properties&gt;
  &lt;scala.binary.version&gt;2.13&lt;/scala.binary.version&gt;
&lt;/properties&gt;
&lt;dependencyManagement&gt;
  &lt;dependencies&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;com.typesafe.akka&lt;/groupId&gt;
      &lt;artifactId&gt;akka-bom_${scala.binary.version}&lt;/artifactId&gt;
      &lt;version&gt;2.8.3&lt;/version&gt;
      &lt;type&gt;pom&lt;/type&gt;
      &lt;scope&gt;import&lt;/scope&gt;
    &lt;/dependency&gt
  &lt;/dependencies&gt;
&lt;/dependencyManagement&gt;
&lt;dependencies&gt
  &lt;dependency&gt;
    &lt;groupId&gt;com.typesafe.akka&lt;/groupId&gt;
    &lt;artifactId&gt;akka-actor-typed_${scala.binary.version}&lt;/artifactId&gt;
  &lt;/dependency&gt
&lt;/dependencies&gt;</code></pre></dd><dt>Gradle</dt><dd><pre class="prettyprint"><code class="language-gradle">def versions = [
  ScalaBinary: "2.13"
]
dependencies {
  implementation platform("com.typesafe.akka:akka-bom_${versions.ScalaBinary}:2.8.3")

  implementation "com.typesafe.akka:akka-actor-typed_${versions.ScalaBinary}"
}</code></pre></dd></dl>
<h2><a href="#introduction" name="introduction" class="anchor"><span class="anchor-link"></span></a>Introduction</h2>
<p>An actor is a stateful resource that has to be explicitly started and stopped.</p>
<p>It is important to note that actors do not stop automatically when no longer referenced, every Actor that is created must also explicitly be destroyed. The only simplification is that stopping a parent Actor will also recursively stop all the child Actors that this parent has created. All actors are also stopped automatically when the <span class="group-scala"><a href="https://doc.akka.io/api/akka/2.8/akka/actor/typed/ActorSystem.html" title="akka.actor.typed.ActorSystem"><code>ActorSystem</code></a></span><span class="group-java"><a href="https://doc.akka.io/japi/akka/2.8/akka/actor/typed/ActorSystem.html" title="akka.actor.typed.ActorSystem"><code>ActorSystem</code></a></span> is shut down.</p><div class="callout note "><div class="callout-title">Note</div>
<p>An <code>ActorSystem</code> is a heavyweight structure that will allocate threads, so create one per logical application. Typically one <code>ActorSystem</code> per JVM process.</p></div>
<h2><a href="#creating-actors" name="creating-actors" class="anchor"><span class="anchor-link"></span></a>Creating Actors</h2>
<p>An actor can create, or <em>spawn</em>, an arbitrary number of child actors, which in turn can spawn children of their own, thus forming an actor hierarchy. <span class="group-scala"><a href="https://doc.akka.io/api/akka/2.8/akka/actor/typed/ActorSystem.html" title="akka.actor.typed.ActorSystem"><code>ActorSystem</code></a></span><span class="group-java"><a href="https://doc.akka.io/japi/akka/2.8/akka/actor/typed/ActorSystem.html" title="akka.actor.typed.ActorSystem"><code>ActorSystem</code></a></span> hosts the hierarchy and there can be only one <em>root actor</em>, an actor at the top of the hierarchy of the <code>ActorSystem</code>. The lifecycle of a child actor is tied to the parent &ndash; a child can stop itself or be stopped at any time but it can never outlive its parent.</p>
<h3><a href="#the-actorcontext" name="the-actorcontext" class="anchor"><span class="anchor-link"></span></a>The ActorContext</h3>
<p>The <span class="group-java"><a href="https://doc.akka.io/japi/akka/2.8/akka/actor/typed/javadsl/ActorContext.html" title="akka.actor.typed.javadsl.ActorContext"><code>ActorContext</code></a></span><span class="group-scala"><a href="https://doc.akka.io/api/akka/2.8/akka/actor/typed/scaladsl/ActorContext.html" title="akka.actor.typed.scaladsl.ActorContext"><code>ActorContext</code></a></span> can be accessed for many purposes such as:</p>
<ul>
  <li>Spawning child actors and supervision</li>
  <li>Watching other actors to receive a <span class="group-scala"><a href="https://doc.akka.io/api/akka/2.8/akka/actor/typed/Terminated.html" title="akka.actor.typed.Terminated"><code>Terminated(otherActor)</code></a></span><span class="group-java"><a href="https://doc.akka.io/japi/akka/2.8/akka/actor/typed/Terminated.html" title="akka.actor.typed.Terminated"><code>Terminated(otherActor)</code></a></span> event should the watched actor stop permanently</li>
  <li>Logging</li>
  <li>Creating message adapters</li>
  <li>Request-response interactions (ask) with another actor</li>
  <li>Access to the <span class="group-scala"><a href="https://doc.akka.io/api/akka/2.8/akka/actor/typed/scaladsl/ActorContext.html#self:akka.actor.typed.ActorRef[T]" title="akka.actor.typed.scaladsl.ActorContext"><code>self</code></a></span><span class="group-java"><a href="https://doc.akka.io/japi/akka/2.8/akka/actor/typed/javadsl/ActorContext.html#getSelf()" title="akka.actor.typed.javadsl.ActorContext"><code>getSelf()</code></a></span> ActorRef</li>
</ul>
<p>If a behavior needs to use the <code>ActorContext</code>, for example to spawn child actors, or use <span class="group-scala"><code>context.self</code></span><span class="group-java"><code>context.getSelf()</code></span>, it can be obtained by wrapping construction with <span class="group-java"><a href="https://doc.akka.io/japi/akka/2.8/akka/actor/typed/javadsl/Behaviors.html#setup(akka.japi.function.Function)" title="akka.actor.typed.javadsl.Behaviors"><code>Behaviors.setup</code></a></span><span class="group-scala"><a href="https://doc.akka.io/api/akka/2.8/akka/actor/typed/scaladsl/Behaviors$.html#setup[T](factory:akka.actor.typed.scaladsl.ActorContext[T]=%3Eakka.actor.typed.Behavior[T]):akka.actor.typed.Behavior[T]" title="akka.actor.typed.scaladsl.Behaviors"><code>Behaviors.setup</code></a></span>:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/akka/tree/v2.8.3/akka-actor-typed-tests/src/test/scala/docs/akka/typed/IntroSpec.scala#L75-L99" target="_blank" title="Go to snippet source">source</a><code class="language-scala">object HelloWorldMain {

  final case class SayHello(name: String)

  def apply(): Behavior[SayHello] =
    Behaviors.setup { context =&gt;
      val greeter = context.spawn(HelloWorld(), &quot;greeter&quot;)

      Behaviors.receiveMessage { message =&gt;
        val replyTo = context.spawn(HelloWorldBot(max = 3), message.name)
        greeter ! HelloWorld.Greet(message.name, replyTo)
        Behaviors.same
      }
    }

}</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/akka/tree/v2.8.3/akka-actor-typed-tests/src/test/java/jdocs/akka/typed/IntroTest.java#L109-L145" target="_blank" title="Go to snippet source">source</a><code class="language-java">public class HelloWorldMain extends AbstractBehavior&lt;HelloWorldMain.SayHello&gt; {
  public static Behavior&lt;SayHello&gt; create() {
    return Behaviors.setup(HelloWorldMain::new);
  }

  private final ActorRef&lt;HelloWorld.Greet&gt; greeter;

  private HelloWorldMain(ActorContext&lt;SayHello&gt; context) {
    super(context);
    greeter = context.spawn(HelloWorld.create(), &quot;greeter&quot;);
  }
}</code></pre></dd>
</dl>
<h4><a href="#actorcontext-thread-safety" name="actorcontext-thread-safety" class="anchor"><span class="anchor-link"></span></a>ActorContext Thread Safety</h4>
<p>Many of the methods in <span class="group-java"><a href="https://doc.akka.io/japi/akka/2.8/akka/actor/typed/javadsl/ActorContext.html" title="akka.actor.typed.javadsl.ActorContext"><code>ActorContext</code></a></span><span class="group-scala"><a href="https://doc.akka.io/api/akka/2.8/akka/actor/typed/scaladsl/ActorContext.html" title="akka.actor.typed.scaladsl.ActorContext"><code>ActorContext</code></a></span> are not thread-safe and</p>
<ul>
  <li>Must not be accessed by threads from <span class="group-scala"><a href="http://www.scala-lang.org/api/2.13.11/scala/concurrent/Future.html" title="scala.concurrent.Future"><code>scala.concurrent.Future</code></a></span><span class="group-java"><a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/util/concurrent/CompletionStage.html" title="java.util.concurrent.CompletionStage"><code>java.util.concurrent.CompletionStage</code></a></span> callbacks</li>
  <li>Must not be shared between several actor instances</li>
  <li>Must only be used in the ordinary actor message processing thread</li>
</ul>
<h3><a href="#the-guardian-actor" name="the-guardian-actor" class="anchor"><span class="anchor-link"></span></a>The Guardian Actor</h3>
<p>The top level actor, also called the user guardian actor, is created along with the <span class="group-scala"><a href="https://doc.akka.io/api/akka/2.8/akka/actor/typed/ActorSystem.html" title="akka.actor.typed.ActorSystem"><code>ActorSystem</code></a></span><span class="group-java"><a href="https://doc.akka.io/japi/akka/2.8/akka/actor/typed/ActorSystem.html" title="akka.actor.typed.ActorSystem"><code>ActorSystem</code></a></span>. Messages sent to the actor system are directed to the root actor. The root actor is defined by the behavior used to create the <code>ActorSystem</code>, named <code>HelloWorldMain</code> in the example below:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/akka/tree/v2.8.3/akka-actor-typed-tests/src/test/scala/docs/akka/typed/IntroSpec.scala#L248-L254" target="_blank" title="Go to snippet source">source</a><code class="language-scala"><br/>val system: ActorSystem[HelloWorldMain.SayHello] =
  ActorSystem(HelloWorldMain(), &quot;hello&quot;)

system ! HelloWorldMain.SayHello(&quot;World&quot;)
system ! HelloWorldMain.SayHello(&quot;Akka&quot;)
</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/akka/tree/v2.8.3/akka-actor-typed-tests/src/test/java/jdocs/akka/typed/IntroTest.java#L191-L195" target="_blank" title="Go to snippet source">source</a><code class="language-java">final ActorSystem&lt;HelloWorldMain.SayHello&gt; system =
    ActorSystem.create(HelloWorldMain.create(), &quot;hello&quot;);

system.tell(new HelloWorldMain.SayHello(&quot;World&quot;));
system.tell(new HelloWorldMain.SayHello(&quot;Akka&quot;));</code></pre></dd>
</dl>
<p>For very simple applications the guardian may contain the actual application logic and handle messages. As soon as the application handles more than one concern the guardian should instead just bootstrap the application, spawn the various subsystems as children and monitor their lifecycles.</p>
<p>When the guardian actor stops this will stop the <code>ActorSystem</code>.</p>
<p>When <span class="group-scala"><a href="https://doc.akka.io/api/akka/2.8/akka/actor/typed/ActorSystem.html#terminate():Unit" title="akka.actor.typed.ActorSystem"><code>ActorSystem.terminate</code></a></span><span class="group-java"><a href="https://doc.akka.io/japi/akka/2.8/akka/actor/typed/ActorSystem.html#terminate()" title="akka.actor.typed.ActorSystem"><code>ActorSystem.terminate</code></a></span> is invoked the <a href="../coordinated-shutdown.html">Coordinated Shutdown</a> process will stop actors and services in a specific order.</p>
<h3><a href="#spawning-children" name="spawning-children" class="anchor"><span class="anchor-link"></span></a>Spawning Children</h3>
<p>Child actors are created and started with <code>ActorContext</code>&rsquo;s <span class="group-java"><a href="https://doc.akka.io/japi/akka/2.8/akka/actor/typed/javadsl/ActorContext.html#spawn(akka.actor.typed.Behavior,java.lang.String)" title="akka.actor.typed.javadsl.ActorContext"><code>spawn</code></a></span><span class="group-scala"><a href="https://doc.akka.io/api/akka/2.8/akka/actor/typed/scaladsl/ActorContext.html#spawn[U](behavior:akka.actor.typed.Behavior[U],name:String,props:akka.actor.typed.Props):akka.actor.typed.ActorRef[U]" title="akka.actor.typed.scaladsl.ActorContext"><code>spawn</code></a></span>. In the example below, when the root actor is started, it spawns a child actor described by the <code>HelloWorld</code> behavior. Additionally, when the root actor receives a <code>SayHello</code> message, it creates a child actor defined by the behavior <code>HelloWorldBot</code>:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/akka/tree/v2.8.3/akka-actor-typed-tests/src/test/scala/docs/akka/typed/IntroSpec.scala#L75-L99" target="_blank" title="Go to snippet source">source</a><code class="language-scala">object HelloWorldMain {

  final case class SayHello(name: String)

  def apply(): Behavior[SayHello] =
    Behaviors.setup { context =&gt;
      val greeter = context.spawn(HelloWorld(), &quot;greeter&quot;)

      Behaviors.receiveMessage { message =&gt;
        val replyTo = context.spawn(HelloWorldBot(max = 3), message.name)
        greeter ! HelloWorld.Greet(message.name, replyTo)
        Behaviors.same
      }
    }

}</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/akka/tree/v2.8.3/akka-actor-typed-tests/src/test/java/jdocs/akka/typed/IntroTest.java#L109-L145" target="_blank" title="Go to snippet source">source</a><code class="language-java">public class HelloWorldMain extends AbstractBehavior&lt;HelloWorldMain.SayHello&gt; {

  public static class SayHello {
    public final String name;

    public SayHello(String name) {
      this.name = name;
    }
  }

  public static Behavior&lt;SayHello&gt; create() {
    return Behaviors.setup(HelloWorldMain::new);
  }

  private final ActorRef&lt;HelloWorld.Greet&gt; greeter;

  private HelloWorldMain(ActorContext&lt;SayHello&gt; context) {
    super(context);
    greeter = context.spawn(HelloWorld.create(), &quot;greeter&quot;);
  }

  @Override
  public Receive&lt;SayHello&gt; createReceive() {
    return newReceiveBuilder().onMessage(SayHello.class, this::onStart).build();
  }

  private Behavior&lt;SayHello&gt; onStart(SayHello command) {
    ActorRef&lt;HelloWorld.Greeted&gt; replyTo =
        getContext().spawn(HelloWorldBot.create(3), command.name);
    greeter.tell(new HelloWorld.Greet(command.name, replyTo));
    return this;
  }
}</code></pre></dd>
</dl>
<p>To specify a dispatcher when spawning an actor use <span class="group-scala"><a href="https://doc.akka.io/api/akka/2.8/akka/actor/typed/DispatcherSelector.html" title="akka.actor.typed.DispatcherSelector"><code>DispatcherSelector</code></a></span><span class="group-java"><a href="https://doc.akka.io/japi/akka/2.8/akka/actor/typed/DispatcherSelector.html" title="akka.actor.typed.DispatcherSelector"><code>DispatcherSelector</code></a></span>. If not specified, the actor will use the default dispatcher, see <a href="dispatchers.html#default-dispatcher">Default dispatcher</a> for details.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/akka/tree/v2.8.3/akka-actor-typed-tests/src/test/scala/docs/akka/typed/IntroSpec.scala#L113-L126" target="_blank" title="Go to snippet source">source</a><code class="language-scala">def apply(): Behavior[SayHello] =
  Behaviors.setup { context =&gt;
    val dispatcherPath = &quot;akka.actor.default-blocking-io-dispatcher&quot;

    val props = DispatcherSelector.fromConfig(dispatcherPath)
    val greeter = context.spawn(HelloWorld(), &quot;greeter&quot;, props)

    Behaviors.receiveMessage { message =&gt;
      val replyTo = context.spawn(HelloWorldBot(max = 3), message.name)

      greeter ! HelloWorld.Greet(message.name, replyTo)
      Behaviors.same
    }
  }</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/akka/tree/v2.8.3/akka-actor-typed-tests/src/test/java/jdocs/akka/typed/IntroTest.java#L151-L185" target="_blank" title="Go to snippet source">source</a><code class="language-java">public class HelloWorldMain extends AbstractBehavior&lt;HelloWorldMain.SayHello&gt; {

  // Start message...

  public static Behavior&lt;SayHello&gt; create() {
    return Behaviors.setup(HelloWorldMain::new);
  }

  private final ActorRef&lt;HelloWorld.Greet&gt; greeter;

  private HelloWorldMain(ActorContext&lt;SayHello&gt; context) {
    super(context);

    final String dispatcherPath = &quot;akka.actor.default-blocking-io-dispatcher&quot;;
    Props greeterProps = DispatcherSelector.fromConfig(dispatcherPath);
    greeter = getContext().spawn(HelloWorld.create(), &quot;greeter&quot;, greeterProps);
  }

  // createReceive ...
}</code></pre></dd>
</dl>
<p>Refer to <a href="actors.html#first-example">Actors</a> for a walk-through of the above examples.</p>
<h3><a href="#spawnprotocol" name="spawnprotocol" class="anchor"><span class="anchor-link"></span></a>SpawnProtocol</h3>
<p>The guardian actor should be responsible for initialization of tasks and create the initial actors of the application, but sometimes you might want to spawn new actors from the outside of the guardian actor. For example creating one actor per HTTP request.</p>
<p>That is not difficult to implement in your behavior, but since this is a common pattern there is a predefined message protocol and implementation of a behavior for this. It can be used as the guardian actor of the <span class="group-scala"><a href="https://doc.akka.io/api/akka/2.8/akka/actor/typed/ActorSystem.html" title="akka.actor.typed.ActorSystem"><code>ActorSystem</code></a></span><span class="group-java"><a href="https://doc.akka.io/japi/akka/2.8/akka/actor/typed/ActorSystem.html" title="akka.actor.typed.ActorSystem"><code>ActorSystem</code></a></span>, possibly combined with <span class="group-java"><a href="https://doc.akka.io/japi/akka/2.8/akka/actor/typed/javadsl/Behaviors.html#setup(akka.japi.function.Function)" title="akka.actor.typed.javadsl.Behaviors"><code>Behaviors.setup</code></a></span><span class="group-scala"><a href="https://doc.akka.io/api/akka/2.8/akka/actor/typed/scaladsl/Behaviors$.html#setup[T](factory:akka.actor.typed.scaladsl.ActorContext[T]=%3Eakka.actor.typed.Behavior[T]):akka.actor.typed.Behavior[T]" title="akka.actor.typed.scaladsl.Behaviors"><code>Behaviors.setup</code></a></span> to start some initial tasks or actors. Child actors can then be started from the outside by <span class="group-scala"><a href="https://doc.akka.io/api/akka/2.8/akka/actor/typed/ActorRef.html#tell(msg:T):Unit" title="akka.actor.typed.ActorRef"><code>tell</code></a></span><span class="group-java"><a href="https://doc.akka.io/japi/akka/2.8/akka/actor/typed/ActorRef.html#tell(T)" title="akka.actor.typed.ActorRef"><code>tell</code></a></span>ing or <span class="group-scala"><a href="https://doc.akka.io/api/akka/2.8/akka/actor/typed/scaladsl/AskPattern$$Askable.html#ask[Res](replyTo:akka.actor.typed.ActorRef[Res]=%3EReq)(implicittimeout:akka.util.Timeout,implicitscheduler:akka.actor.typed.Scheduler):scala.concurrent.Future[Res]" title="akka.actor.typed.scaladsl.AskPattern.Askable"><code>ask</code></a></span><span class="group-java"><a href="https://doc.akka.io/japi/akka/2.8/akka/actor/typed/javadsl/AskPattern.html#ask(akka.actor.typed.RecipientRef,akka.japi.function.Function,java.time.Duration,akka.actor.typed.Scheduler)" title="akka.actor.typed.javadsl.AskPattern"><code>ask</code></a></span>ing <span class="group-scala"><a href="https://doc.akka.io/api/akka/2.8/akka/actor/typed/SpawnProtocol$$Spawn.html" title="akka.actor.typed.SpawnProtocol.Spawn"><code>SpawnProtocol.Spawn</code></a></span><span class="group-java"><a href="https://doc.akka.io/japi/akka/2.8/akka/actor/typed/SpawnProtocol.Spawn.html" title="akka.actor.typed.SpawnProtocol.Spawn"><code>SpawnProtocol.Spawn</code></a></span> to the actor reference of the system. Using <code>ask</code> is similar to how <code>ActorSystem.actorOf</code> can be used in classic actors with the difference that a <span class="group-scala"><a href="http://www.scala-lang.org/api/2.13.11/scala/concurrent/Future.html" title="scala.concurrent.Future"><code>Future</code></a></span><span class="group-java"><a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/util/concurrent/CompletionStage.html" title="java.util.concurrent.CompletionStage"><code>CompletionStage</code></a></span> of the <span class="group-scala"><a href="https://doc.akka.io/api/akka/2.8/akka/actor/typed/ActorRef.html" title="akka.actor.typed.ActorRef"><code>ActorRef</code></a></span><span class="group-java"><a href="https://doc.akka.io/japi/akka/2.8/akka/actor/typed/ActorRef.html" title="akka.actor.typed.ActorRef"><code>ActorRef</code></a></span> is returned.</p>
<p>The guardian behavior can be defined as:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/akka/tree/v2.8.3/akka-actor-typed-tests/src/test/scala/docs/akka/typed/SpawnProtocolDocSpec.scala#L18-L22" target="_blank" title="Go to snippet source">source</a><code class="language-scala">import akka.actor.typed.Behavior
import akka.actor.typed.SpawnProtocol
import akka.actor.typed.scaladsl.Behaviors
import akka.actor.typed.scaladsl.LoggerOps

object HelloWorldMain {
  def apply(): Behavior[SpawnProtocol.Command] =
    Behaviors.setup { context =&gt;
      // Start initial tasks
      // context.spawn(...)

      SpawnProtocol()
    }
}</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/akka/tree/v2.8.3/akka-actor-typed-tests/src/test/java/jdocs/akka/typed/SpawnProtocolDocTest.java#L13-L16" target="_blank" title="Go to snippet source">source</a><code class="language-java">import akka.actor.typed.Behavior;
import akka.actor.typed.SpawnProtocol;
import akka.actor.typed.javadsl.Behaviors;

public abstract class HelloWorldMain {
  private HelloWorldMain() {}

  public static Behavior&lt;SpawnProtocol.Command&gt; create() {
    return Behaviors.setup(
        context -&gt; {
          // Start initial tasks
          // context.spawn(...)

          return SpawnProtocol.create();
        });
  }
}</code></pre></dd>
</dl>
<p>and the <span class="group-scala"><a href="https://doc.akka.io/api/akka/2.8/akka/actor/typed/ActorSystem.html" title="akka.actor.typed.ActorSystem"><code>ActorSystem</code></a></span><span class="group-java"><a href="https://doc.akka.io/japi/akka/2.8/akka/actor/typed/ActorSystem.html" title="akka.actor.typed.ActorSystem"><code>ActorSystem</code></a></span> can be created with that <code>main</code> behavior and asked to spawn other actors:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/akka/tree/v2.8.3/akka-actor-typed-tests/src/test/scala/docs/akka/typed/SpawnProtocolDocSpec.scala#L26-L30" target="_blank" title="Go to snippet source">source</a><code class="language-scala">import akka.actor.typed.ActorRef
import akka.actor.typed.ActorSystem
import akka.actor.typed.Props
import akka.util.Timeout


implicit val system: ActorSystem[SpawnProtocol.Command] =
  ActorSystem(HelloWorldMain(), &quot;hello&quot;)

// needed in implicit scope for ask (?)
import akka.actor.typed.scaladsl.AskPattern._
implicit val ec: ExecutionContext = system.executionContext
implicit val timeout: Timeout = Timeout(3.seconds)

val greeter: Future[ActorRef[HelloWorld.Greet]] =
  system.ask(SpawnProtocol.Spawn(behavior = HelloWorld(), name = &quot;greeter&quot;, props = Props.empty, _))

val greetedBehavior = Behaviors.receive[HelloWorld.Greeted] { (context, message) =&gt;
  context.log.info2(&quot;Greeting for {} from {}&quot;, message.whom, message.from)
  Behaviors.stopped
}

val greetedReplyTo: Future[ActorRef[HelloWorld.Greeted]] =
  system.ask(SpawnProtocol.Spawn(greetedBehavior, name = &quot;&quot;, props = Props.empty, _))

for (greeterRef &lt;- greeter; replyToRef &lt;- greetedReplyTo) {
  greeterRef ! HelloWorld.Greet(&quot;Akka&quot;, replyToRef)
}
</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/akka/tree/v2.8.3/akka-actor-typed-tests/src/test/java/jdocs/akka/typed/SpawnProtocolDocTest.java#L20-L24" target="_blank" title="Go to snippet source">source</a><code class="language-java">import akka.actor.typed.ActorRef;
import akka.actor.typed.ActorSystem;
import akka.actor.typed.Props;
import akka.actor.typed.javadsl.AskPattern;

final ActorSystem&lt;SpawnProtocol.Command&gt; system =
    ActorSystem.create(HelloWorldMain.create(), &quot;hello&quot;);
final Duration timeout = Duration.ofSeconds(3);

CompletionStage&lt;ActorRef&lt;HelloWorld.Greet&gt;&gt; greeter =
    AskPattern.ask(
        system,
        replyTo -&gt;
            new SpawnProtocol.Spawn&lt;&gt;(HelloWorld.create(), &quot;greeter&quot;, Props.empty(), replyTo),
        timeout,
        system.scheduler());

Behavior&lt;HelloWorld.Greeted&gt; greetedBehavior =
    Behaviors.receive(
        (context, message) -&gt; {
          context.getLog().info(&quot;Greeting for {} from {}&quot;, message.whom, message.from);
          return Behaviors.stopped();
        });

CompletionStage&lt;ActorRef&lt;HelloWorld.Greeted&gt;&gt; greetedReplyTo =
    AskPattern.ask(
        system,
        replyTo -&gt; new SpawnProtocol.Spawn&lt;&gt;(greetedBehavior, &quot;&quot;, Props.empty(), replyTo),
        timeout,
        system.scheduler());

greeter.whenComplete(
    (greeterRef, exc) -&gt; {
      if (exc == null) {
        greetedReplyTo.whenComplete(
            (greetedReplyToRef, exc2) -&gt; {
              if (exc2 == null) {
                greeterRef.tell(new HelloWorld.Greet(&quot;Akka&quot;, greetedReplyToRef));
              }
            });
      }
    });
</code></pre></dd>
</dl>
<p>The <span class="group-scala"><a href="https://doc.akka.io/api/akka/2.8/akka/actor/typed/SpawnProtocol$.html" title="akka.actor.typed.SpawnProtocol"><code>SpawnProtocol</code></a></span><span class="group-java"><a href="https://doc.akka.io/japi/akka/2.8/akka/actor/typed/SpawnProtocol.html" title="akka.actor.typed.SpawnProtocol"><code>SpawnProtocol</code></a></span> can also be used at other places in the actor hierarchy. It doesn&rsquo;t have to be the root guardian actor.</p>
<p>A way to find running actors is described in <a href="actor-discovery.html">Actor discovery</a>.</p>
<h2><a href="#stopping-actors" name="stopping-actors" class="anchor"><span class="anchor-link"></span></a>Stopping Actors</h2>
<p>An actor can stop itself by returning <span class="group-java"><a href="https://doc.akka.io/japi/akka/2.8/akka/actor/typed/javadsl/Behaviors.html#stopped()" title="akka.actor.typed.javadsl.Behaviors"><code>Behaviors.stopped</code></a></span><span class="group-scala"><a href="https://doc.akka.io/api/akka/2.8/akka/actor/typed/scaladsl/Behaviors$.html#stopped[T]:akka.actor.typed.Behavior[T]" title="akka.actor.typed.scaladsl.Behaviors"><code>Behaviors.stopped</code></a></span> as the next behavior.</p>
<p>A child actor can be forced to stop after it finishes processing its current message by using the <span class="group-java"><a href="https://doc.akka.io/japi/akka/2.8/akka/actor/typed/javadsl/ActorContext.html#stop(akka.actor.typed.ActorRef)" title="akka.actor.typed.javadsl.ActorContext"><code>stop</code></a></span><span class="group-scala"><a href="https://doc.akka.io/api/akka/2.8/akka/actor/typed/scaladsl/ActorContext.html#stop[U](child:akka.actor.typed.ActorRef[U]):Unit" title="akka.actor.typed.scaladsl.ActorContext"><code>stop</code></a></span> method of the <code>ActorContext</code> from the parent actor. Only child actors can be stopped in that way.</p>
<p>All child actors will be stopped when their parent is stopped.</p>
<p>When an actor is stopped, it receives the <span class="group-scala"><a href="https://doc.akka.io/api/akka/2.8/akka/actor/typed/PostStop.html" title="akka.actor.typed.PostStop"><code>PostStop</code></a></span><span class="group-java"><a href="https://doc.akka.io/japi/akka/2.8/akka/actor/typed/PostStop.html" title="akka.actor.typed.PostStop"><code>PostStop</code></a></span> signal that can be used for cleaning up resources.</p>
<p>Here is an illustrating example:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/akka/tree/v2.8.3/akka-actor-typed-tests/src/test/scala/docs/akka/typed/GracefulStopDocSpec.scala#L8-L11" target="_blank" title="Go to snippet source">source</a><code class="language-scala">import akka.actor.typed.Behavior
import akka.actor.typed.scaladsl.Behaviors
import akka.actor.typed.{ ActorSystem, PostStop }


object MasterControlProgram {
  sealed trait Command
  final case class SpawnJob(name: String) extends Command
  case object GracefulShutdown extends Command

  def apply(): Behavior[Command] = {
    Behaviors
      .receive[Command] { (context, message) =&gt;
        message match {
          case SpawnJob(jobName) =&gt;
            context.log.info(&quot;Spawning job {}!&quot;, jobName)
            context.spawn(Job(jobName), name = jobName)
            Behaviors.same
          case GracefulShutdown =&gt;
            context.log.info(&quot;Initiating graceful shutdown...&quot;)
            // Here it can perform graceful stop (possibly asynchronous) and when completed
            // return `Behaviors.stopped` here or after receiving another message.
            Behaviors.stopped
        }
      }
      .receiveSignal {
        case (context, PostStop) =&gt;
          context.log.info(&quot;Master Control Program stopped&quot;)
          Behaviors.same
      }
  }
}

object Job {
  sealed trait Command

  def apply(name: String): Behavior[Command] = {
    Behaviors.receiveSignal[Command] {
      case (context, PostStop) =&gt;
        context.log.info(&quot;Worker {} stopped&quot;, name)
        Behaviors.same
    }
  }
}</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/akka/tree/v2.8.3/akka-actor-typed-tests/src/test/java/jdocs/akka/typed/GracefulStopDocTest.java#L8-L18" target="_blank" title="Go to snippet source">source</a><code class="language-java"><br/>import java.util.concurrent.TimeUnit;

import akka.actor.typed.ActorSystem;
import akka.actor.typed.Behavior;
import akka.actor.typed.PostStop;
import akka.actor.typed.javadsl.AbstractBehavior;
import akka.actor.typed.javadsl.ActorContext;
import akka.actor.typed.javadsl.Behaviors;
import akka.actor.typed.javadsl.Receive;


public class MasterControlProgram extends AbstractBehavior&lt;MasterControlProgram.Command&gt; {

  interface Command {}

  public static final class SpawnJob implements Command {
    public final String name;

    public SpawnJob(String name) {
      this.name = name;
    }
  }

  public enum GracefulShutdown implements Command {
    INSTANCE
  }

  public static Behavior&lt;Command&gt; create() {
    return Behaviors.setup(MasterControlProgram::new);
  }

  public MasterControlProgram(ActorContext&lt;Command&gt; context) {
    super(context);
  }

  @Override
  public Receive&lt;Command&gt; createReceive() {
    return newReceiveBuilder()
        .onMessage(SpawnJob.class, this::onSpawnJob)
        .onMessage(GracefulShutdown.class, message -&gt; onGracefulShutdown())
        .onSignal(PostStop.class, signal -&gt; onPostStop())
        .build();
  }

  private Behavior&lt;Command&gt; onSpawnJob(SpawnJob message) {
    getContext().getSystem().log().info(&quot;Spawning job {}!&quot;, message.name);
    getContext().spawn(Job.create(message.name), message.name);
    return this;
  }

  private Behavior&lt;Command&gt; onGracefulShutdown() {
    getContext().getSystem().log().info(&quot;Initiating graceful shutdown...&quot;);

    // Here it can perform graceful stop (possibly asynchronous) and when completed
    // return `Behaviors.stopped()` here or after receiving another message.
    return Behaviors.stopped();
  }

  private Behavior&lt;Command&gt; onPostStop() {
    getContext().getSystem().log().info(&quot;Master Control Program stopped&quot;);
    return this;
  }
}

public class Job extends AbstractBehavior&lt;Job.Command&gt; {

  interface Command {}

  public static Behavior&lt;Command&gt; create(String name) {
    return Behaviors.setup(context -&gt; new Job(context, name));
  }

  private final String name;

  public Job(ActorContext&lt;Command&gt; context, String name) {
    super(context);
    this.name = name;
  }

  @Override
  public Receive&lt;Job.Command&gt; createReceive() {
    return newReceiveBuilder().onSignal(PostStop.class, postStop -&gt; onPostStop()).build();
  }

  private Behavior&lt;Command&gt; onPostStop() {
    getContext().getSystem().log().info(&quot;Worker {} stopped&quot;, name);
    return this;
  }
}</code></pre></dd>
</dl>
<p>When cleaning up resources from <code>PostStop</code> you should also consider doing the same for the <span class="group-scala"><a href="https://doc.akka.io/api/akka/2.8/akka/actor/typed/PreRestart.html" title="akka.actor.typed.PreRestart"><code>PreRestart</code></a></span><span class="group-java"><a href="https://doc.akka.io/japi/akka/2.8/akka/actor/typed/PreRestart.html" title="akka.actor.typed.PreRestart"><code>PreRestart</code></a></span> signal, which is emitted when the <a href="fault-tolerance.html#the-prerestart-signal">actor is restarted</a>. Note that <code>PostStop</code> is not emitted for a restart. </p>
<h2><a href="#watching-actors" name="watching-actors" class="anchor"><span class="anchor-link"></span></a>Watching Actors</h2>
<p>In order to be notified when another actor terminates (i.e. stops permanently, not temporary failure and restart), an actor can <span class="group-java"><a href="https://doc.akka.io/japi/akka/2.8/akka/actor/typed/javadsl/ActorContext.html#watch(akka.actor.typed.ActorRef)" title="akka.actor.typed.javadsl.ActorContext"><code>watch</code></a></span><span class="group-scala"><a href="https://doc.akka.io/api/akka/2.8/akka/actor/typed/scaladsl/ActorContext.html#watch[U](other:akka.actor.typed.ActorRef[U]):Unit" title="akka.actor.typed.scaladsl.ActorContext"><code>watch</code></a></span> another actor. It will receive the <span class="group-scala"><a href="https://doc.akka.io/api/akka/2.8/akka/actor/typed/Terminated.html" title="akka.actor.typed.Terminated"><code>Terminated</code></a></span><span class="group-java"><a href="https://doc.akka.io/japi/akka/2.8/akka/actor/typed/Terminated.html" title="akka.actor.typed.Terminated"><code>Terminated</code></a></span> signal upon termination (see <a href="actor-lifecycle.html#stopping-actors">Stopping Actors</a>) of the watched actor.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/akka/tree/v2.8.3/akka-actor-typed-tests/src/test/scala/docs/akka/typed/GracefulStopDocSpec.scala#L73-L95" target="_blank" title="Go to snippet source">source</a><code class="language-scala"><br/>object MasterControlProgram {
  sealed trait Command
  final case class SpawnJob(name: String) extends Command

  def apply(): Behavior[Command] = {
    Behaviors
      .receive[Command] { (context, message) =&gt;
        message match {
          case SpawnJob(jobName) =&gt;
            context.log.info(&quot;Spawning job {}!&quot;, jobName)
            val job = context.spawn(Job(jobName), name = jobName)
            context.watch(job)
            Behaviors.same
        }
      }
      .receiveSignal {
        case (context, Terminated(ref)) =&gt;
          context.log.info(&quot;Job stopped: {}&quot;, ref.path.name)
          Behaviors.same
      }
  }
}</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/akka/tree/v2.8.3/akka-actor-typed-tests/src/test/java/jdocs/akka/typed/GracefulStopDocTest.java#L128-L167" target="_blank" title="Go to snippet source">source</a><code class="language-java">public class MasterControlProgram extends AbstractBehavior&lt;MasterControlProgram.Command&gt; {

  interface Command {}

  public static final class SpawnJob implements Command {
    public final String name;

    public SpawnJob(String name) {
      this.name = name;
    }
  }

  public static Behavior&lt;Command&gt; create() {
    return Behaviors.setup(MasterControlProgram::new);
  }

  public MasterControlProgram(ActorContext&lt;Command&gt; context) {
    super(context);
  }

  @Override
  public Receive&lt;Command&gt; createReceive() {
    return newReceiveBuilder()
        .onMessage(SpawnJob.class, this::onSpawnJob)
        .onSignal(Terminated.class, this::onTerminated)
        .build();
  }

  private Behavior&lt;Command&gt; onSpawnJob(SpawnJob message) {
    getContext().getSystem().log().info(&quot;Spawning job {}!&quot;, message.name);
    ActorRef&lt;Job.Command&gt; job = getContext().spawn(Job.create(message.name), message.name);
    getContext().watch(job);
    return this;
  }

  private Behavior&lt;Command&gt; onTerminated(Terminated terminated) {
    getContext().getSystem().log().info(&quot;Job stopped: {}&quot;, terminated.getRef().path().name());
    return this;
  }
}</code></pre></dd>
</dl>
<p>An alternative to <span class="group-java"><a href="https://doc.akka.io/japi/akka/2.8/akka/actor/typed/javadsl/ActorContext.html#watch(akka.actor.typed.ActorRef)" title="akka.actor.typed.javadsl.ActorContext"><code>watch</code></a></span><span class="group-scala"><a href="https://doc.akka.io/api/akka/2.8/akka/actor/typed/scaladsl/ActorContext.html#watch[U](other:akka.actor.typed.ActorRef[U]):Unit" title="akka.actor.typed.scaladsl.ActorContext"><code>watch</code></a></span> is <span class="group-java"><a href="https://doc.akka.io/japi/akka/2.8/akka/actor/typed/javadsl/ActorContext.html#watchWith(akka.actor.typed.ActorRef,T)" title="akka.actor.typed.javadsl.ActorContext"><code>watchWith</code></a></span><span class="group-scala"><a href="https://doc.akka.io/api/akka/2.8/akka/actor/typed/scaladsl/ActorContext.html#watchWith[U](other:akka.actor.typed.ActorRef[U],msg:T):Unit" title="akka.actor.typed.scaladsl.ActorContext"><code>watchWith</code></a></span>, which allows specifying a custom message instead of the <code>Terminated</code>. This is often preferred over using <code>watch</code> and the <code>Terminated</code> signal because additional information can be included in the message that can be used later when receiving it.</p>
<p>Similar example as above, but using <code>watchWith</code> and replies to the original requestor when the job has finished.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/akka/tree/v2.8.3/akka-actor-typed-tests/src/test/scala/docs/akka/typed/GracefulStopDocSpec.scala#L101-L123" target="_blank" title="Go to snippet source">source</a><code class="language-scala"><br/>object MasterControlProgram {
  sealed trait Command
  final case class SpawnJob(name: String, replyToWhenDone: ActorRef[JobDone]) extends Command
  final case class JobDone(name: String)
  private final case class JobTerminated(name: String, replyToWhenDone: ActorRef[JobDone]) extends Command

  def apply(): Behavior[Command] = {
    Behaviors.receive { (context, message) =&gt;
      message match {
        case SpawnJob(jobName, replyToWhenDone) =&gt;
          context.log.info(&quot;Spawning job {}!&quot;, jobName)
          val job = context.spawn(Job(jobName), name = jobName)
          context.watchWith(job, JobTerminated(jobName, replyToWhenDone))
          Behaviors.same
        case JobTerminated(jobName, replyToWhenDone) =&gt;
          context.log.info(&quot;Job stopped: {}&quot;, jobName)
          replyToWhenDone ! JobDone(jobName)
          Behaviors.same
      }
    }
  }
}</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/akka/tree/v2.8.3/akka-actor-typed-tests/src/test/java/jdocs/akka/typed/GracefulStopDocTest.java#L173-L233" target="_blank" title="Go to snippet source">source</a><code class="language-java">public class MasterControlProgram extends AbstractBehavior&lt;MasterControlProgram.Command&gt; {

  interface Command {}

  public static final class SpawnJob implements Command {
    public final String name;
    public final ActorRef&lt;JobDone&gt; replyToWhenDone;

    public SpawnJob(String name, ActorRef&lt;JobDone&gt; replyToWhenDone) {
      this.name = name;
      this.replyToWhenDone = replyToWhenDone;
    }
  }

  public static final class JobDone {
    public final String name;

    public JobDone(String name) {
      this.name = name;
    }
  }

  private static final class JobTerminated implements Command {
    final String name;
    final ActorRef&lt;JobDone&gt; replyToWhenDone;

    JobTerminated(String name, ActorRef&lt;JobDone&gt; replyToWhenDone) {
      this.name = name;
      this.replyToWhenDone = replyToWhenDone;
    }
  }

  public static Behavior&lt;Command&gt; create() {
    return Behaviors.setup(MasterControlProgram::new);
  }

  public MasterControlProgram(ActorContext&lt;Command&gt; context) {
    super(context);
  }

  @Override
  public Receive&lt;Command&gt; createReceive() {
    return newReceiveBuilder()
        .onMessage(SpawnJob.class, this::onSpawnJob)
        .onMessage(JobTerminated.class, this::onJobTerminated)
        .build();
  }

  private Behavior&lt;Command&gt; onSpawnJob(SpawnJob message) {
    getContext().getSystem().log().info(&quot;Spawning job {}!&quot;, message.name);
    ActorRef&lt;Job.Command&gt; job = getContext().spawn(Job.create(message.name), message.name);
    getContext().watchWith(job, new JobTerminated(message.name, message.replyToWhenDone));
    return this;
  }

  private Behavior&lt;Command&gt; onJobTerminated(JobTerminated terminated) {
    getContext().getSystem().log().info(&quot;Job stopped: {}&quot;, terminated.name);
    terminated.replyToWhenDone.tell(new JobDone(terminated.name));
    return this;
  }
}</code></pre></dd>
</dl>
<p>Note how the <code>replyToWhenDone</code> is included in the <code>watchWith</code> message and then used later when receiving the <code>JobTerminated</code> message. </p>
<p>The watched actor can be any <span class="group-scala"><a href="https://doc.akka.io/api/akka/2.8/akka/actor/typed/ActorRef.html" title="akka.actor.typed.ActorRef"><code>ActorRef</code></a></span><span class="group-java"><a href="https://doc.akka.io/japi/akka/2.8/akka/actor/typed/ActorRef.html" title="akka.actor.typed.ActorRef"><code>ActorRef</code></a></span>, it doesn&rsquo;t have to be a child actor as in the above example.</p>
<p>It should be noted that the terminated message is generated independent of the order in which registration and termination occur. In particular, the watching actor will receive a terminated message even if the watched actor has already been terminated at the time of registration.</p>
<p>Registering multiple times does not necessarily lead to multiple messages being generated, but there is no guarantee that only exactly one such message is received: if termination of the watched actor has generated and queued the message, and another registration is done before this message has been processed, then a second message will be queued, because registering for monitoring of an already terminated actor leads to the immediate generation of the terminated message.</p>
<p>It is also possible to deregister from watching another actors liveliness using <span class="group-java"><a href="https://doc.akka.io/japi/akka/2.8/akka/actor/typed/javadsl/ActorContext.html#unwatch(akka.actor.typed.ActorRef)" title="akka.actor.typed.javadsl.ActorContext"><code>context.unwatch(target)</code></a></span><span class="group-scala"><a href="https://doc.akka.io/api/akka/2.8/akka/actor/typed/scaladsl/ActorContext.html#unwatch[U](other:akka.actor.typed.ActorRef[U]):Unit" title="akka.actor.typed.scaladsl.ActorContext"><code>context.unwatch(target)</code></a></span>. This works even if the terminated message has already been enqueued in the mailbox; after calling <code>unwatch</code> no terminated message for that actor will be processed anymore.</p>
<p>The terminated message is also sent when the watched actor is on a node that has been removed from the <a href="cluster.html">Cluster</a>.</p>
</div>
</article>
<div class="row">
<div class="small-12 column">
<section class="nav-prev-next row">
<div class="nav-prev small-6 column">
<a href="../typed/actors.html"><i class="icon-prev"></i> <span class="link-prev">Introduction to Actors</span></a>
</div>
<div class="nav-next small-6 column clearfix">
<a class="float-right" href="../typed/interaction-patterns.html">Interaction Patterns <i class="icon-next"></i></a>
</div>
</section>
</div>
</div>
<div class="source-github row">
Found an error in this documentation? The source code for this page can be found <a href="https://github.com/akka/akka/tree/v2.8.3/akka-docs/src/main/paradox/typed/actor-lifecycle.md">here</a>.
Please feel free to edit and contribute a pull request.
</div>

<footer class="page-footer row clearfix">
<img class="akka-icon float-left show-for-medium" src="../images/akka-icon.svg" />
<section class="copyright">
<div>Akka is available under the <a href="https://www.lightbend.com/akka/license" target="_blank">Business Source License 1.1</a>.</div>
<p class="legal">
&copy; 2011-2023 <a href="https://www.lightbend.com" target="_blank">Lightbend, Inc.</a> |
<a href="https://www.lightbend.com/legal/licenses" target="_blank">Licenses</a> |
<a href="https://www.lightbend.com/legal/terms" target="_blank">Terms</a> |
<a href="https://www.lightbend.com/legal/privacy" target="_blank">Privacy Policy</a> |
<a href="https://akka.io/cookie/" target="_blank">Cookie Listing</a> |
<a class="optanon-toggle-display">Cookie Settings</a>
</p>
</section>

</footer>
</section>
</main>
</div>

<script type="text/javascript" src="../js/scrollsneak.js"></script>
<script type="text/javascript">jQuery(document).foundation();</script>
<script type="text/javascript" src="../js/groups.js"></script>
<script type="text/javascript" src="../js/page.js"></script>
<script type="text/javascript" src="../js/snippets.js"></script>
<script type="text/javascript" src="../js/magellan.js"></script>
<script type="text/javascript" src="../js/metadata-toggle.js"></script>
<script type="text/javascript" src="../js/lbHeader.js"></script>

<style type="text/css">@import "../lib/prettify/prettify.css";</style>
<script type="text/javascript" src="../lib/prettify/prettify.js"></script>
<script type="text/javascript" src="../lib/prettify/lang-scala.js"></script>
<script type="text/javascript">//<![CDATA[
jQuery(function(){window.prettyPrint && prettyPrint()});
//]]></script>
<!-- Algolia docs search -->
<script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.js"></script>
<style>.algolia-autocomplete { display: block !important }</style>
<script type="text/javascript">
docsearch({
appId: 'XUXZ6LW9B1',
apiKey: '5b6260148e92f7c5e38338fcf7eaa3e0',
indexName: 'akka_docs',
inputSelector: '#search',
algoliaOptions: {
hitsPerPage: 5
}
});

docsearch({
appId: 'XUXZ6LW9B1',
apiKey: '5b6260148e92f7c5e38338fcf7eaa3e0',
indexName: 'akka_docs',
inputSelector: '#overlay-search',
algoliaOptions: {
hitsPerPage: 5
}
});

// set up "/" as global shortcut for focusing on search
jQuery(document).keypress(function (event) {
if (event.keyCode == 47) {
jQuery("#search").focus();
return false; // swallow key event, otherwise the / char would be input into the search box
}
});
</script>

<script type="text/javascript" src="../assets/js/warnOldDocs.js"></script>
<script type="text/javascript" src="../assets/js/scalafiddle.js"></script>


</body>
</html>
