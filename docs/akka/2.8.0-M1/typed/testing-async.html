<!DOCTYPE html>
<html class="no-js" lang="en">

<head>
<title>Asynchronous testing &bull; Akka Documentation</title>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<meta name="description" content="Akka is a toolkit for building highly concurrent, distributed, and resilient message-driven applications for Java and Scala."/>
<link rel="canonical" href="https://doc.akka.io/docs/akka/current/typed/testing-async.html"/>
<script type="text/javascript" src="../lib/jquery/jquery.min.js"></script>
<script type="text/javascript" src="../lib/foundation/dist/js/foundation.min.js"></script>
<link rel="stylesheet" type="text/css" href="../lib/normalize.css/normalize.css"/>
<link rel="stylesheet" type="text/css" href="../lib/foundation/dist/css/foundation.min.css"/>
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.css" />
<link rel="stylesheet" type="text/css" href="../css/icons.css"/>
<link rel="stylesheet" type="text/css" href="../css/page-8.css"/>
<link rel="stylesheet" type="text/css" href="../css/banner-2.css"/>
<link rel="shortcut icon" href="../images/favicon.ico" />
<link rel="apple-touch-icon" sizes="180x180" href="../images/apple-touch-icon.png"/>
<link rel="icon" type="image/png" sizes="32x32" href="../images/favicon-32x32.png"/>
<link rel="icon" type="image/png" sizes="16x16" href="../images/favicon-16x16.png"/>
<link rel="manifest" href="../images/manifest.json"/>
<meta name="msapplication-TileImage" content="../images/mstile-150x150.png"/>
<meta name="msapplication-TileColor" content="#15a9ce"/>
<meta name="theme-color" content="#15a9ce"/>
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>
<!-- OneTrust Cookies Consent Notice (Production Standard, akka.io, en-GB) start -->
<script src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js"  type="text/javascript" charset="UTF-8" data-domain-script="28b912e7-09e9-43d5-91e4-3d1897044004" ></script>
<script type="text/javascript">
function OptanonWrapper() { }
</script>
<!-- OneTrust Cookies Consent Notice (Production Standard, akka.io, en-GB) end -->
<!--Google Analytics-->
<script type="text/plain" class="optanon-category-2">
var _gaq = _gaq || [];
_gaq.push(['_setAccount', 'UA-21117439-1']);
_gaq.push(['_setDomainName', 'akka.io']);
_gaq.push(['_trackPageview']);
(function() {
var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})()
</script>
<!-- Google Tag Manager -->
<script type="text/plain" class="optanon-category-2">
(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-KBJGH35');
</script>
<!--Marketo-->
<script type="text/plain" class="optanon-category-3">
(function() {
var didInit = false;
function initMunchkin() {
if(didInit === false) {
didInit = true;
Munchkin.init('558-NCX-702', { 'asyncOnly': true, 'disableClickDelay': true });
}
}
var s = document.createElement('script');
s.type = 'text/javascript';
s.async = true;
s.src = '//munchkin.marketo.net/munchkin.js';
s.onreadystatechange = function() {
if (this.readyState == 'complete' || this.readyState == 'loaded') {
initMunchkin();
}
};
s.onload = initMunchkin;
document.getElementsByTagName('head')[0].appendChild(s);
})();
</script>
</head>

<body id="underlay" data-toggler="nav-open">
<div id="lightbend-banner" class="lightbend-banner akka full-width" data-category="OSS Lightbend Banner Impression" data-label="Akka Banner Impression">
<div class="oss-wrapper">
<div class="oss-brand">
<a class="oss-track-link-label" data-category="OSS Lightbend Banner Clicks" data-label="Lightbend Logo - Akka Banner" href="https://www.lightbend.com">
<img class="lightbend-logo" src="../images/banner-logos/lightbend-reverse.svg" alt="Lightbend" title="Lightbend">
</a>
</div>
<div class="oss-ad no-drop-down">
<nav id="lightbendRotator" class="lightbend-rotator">
<a class="oss-track-link-label" data-category="OSS Lightbend Banner Clicks" data-label="Promo Rotator - Lightbend is Changing its Software Licensing Model for Akka Technology. [License FAQ] - Akka Banner" href="https://www.lightbend.com/akka/license-faq">
<strong>Lightbend</strong> is Changing its Software Licensing Model for Akka Technology. <span class="akka-btn">License FAQ</span>
</a>
</nav>
</div>
</div>
</div>

<header class="site-header hide-for-large">
<div class="sticky-header clearfix">
<a href="https://akka.io"><img class="logo" src="../images/akka-logo-reverse.svg"/></a>

<button class="menu-icon float-right" type="button" data-toggle="underlay overlay"></button>
</div>
<div id="overlay" class="overlay-nav" data-toggler="nav-open">
<header class="nav-header">
<div class="nav-header-title">
<h1><a href="../index.html">Akka Documentation</a></h1>
</div>
<div class="nav-header-version">
Version 2.8.0-M1
</div>
<div class="nav-header-groups">
<select class="supergroup" name="Language"><option class="group" value="group-scala">Scala</option><option class="group" value="group-java">Java</option></select>
</div>
<div id="overlay-search-container" class="nav-header-search">
<input id="overlay-search" type="search" class="search" placeholder="Search" />
</div>
</header>
<nav class="nav-toc">
<ul>
  <li><a href="../security/index.html" class="page">Security Announcements</a></li>
  <li><a href="../typed/guide/index.html" class="page">Getting Started Guide</a></li>
  <li><a href="../general/index.html" class="page">General Concepts</a></li>
  <li><a href="../typed/index.html" class="page">Actors</a>
  <ul>
    <li><a href="../typed/actors.html" class="page">Introduction to Actors</a></li>
    <li><a href="../typed/actor-lifecycle.html" class="page">Actor lifecycle</a></li>
    <li><a href="../typed/interaction-patterns.html" class="page">Interaction Patterns</a></li>
    <li><a href="../typed/fault-tolerance.html" class="page">Fault Tolerance</a></li>
    <li><a href="../typed/actor-discovery.html" class="page">Actor discovery</a></li>
    <li><a href="../typed/routers.html" class="page">Routers</a></li>
    <li><a href="../typed/stash.html" class="page">Stash</a></li>
    <li><a href="../typed/fsm.html" class="page">Behaviors as finite state machines</a></li>
    <li><a href="../coordinated-shutdown.html" class="page">Coordinated Shutdown</a></li>
    <li><a href="../typed/dispatchers.html" class="page">Dispatchers</a></li>
    <li><a href="../typed/mailboxes.html" class="page">Mailboxes</a></li>
    <li><a href="../typed/testing.html" class="page">Testing</a>
    <ul>
      <li><a href="../typed/testing.html#module-info" class="header">Module info</a></li>
      <li><a href="../typed/testing.html#introduction" class="header">Introduction</a></li>
      <li><a href="../typed/testing-async.html#asynchronous-testing" class="active page">Asynchronous testing</a>
      <ul>
        <li><a href="../typed/testing-async.html#basic-example" class="header">Basic example</a></li>
        <li><a href="../typed/testing-async.html#observing-mocked-behavior" class="header">Observing mocked behavior</a></li>
        <li><a href="../typed/testing-async.html#test-framework-integration" class="header">Test framework integration</a></li>
        <li><a href="../typed/testing-async.html#configuration" class="header">Configuration</a></li>
        <li><a href="../typed/testing-async.html#controlling-the-scheduler" class="header">Controlling the scheduler</a></li>
        <li><a href="../typed/testing-async.html#test-of-logging" class="header">Test of logging</a></li>
        <li><a href="../typed/testing-async.html#silence-logging-output-from-tests" class="header">Silence logging output from tests</a></li>
      </ul></li>
      <li><a href="../typed/testing-sync.html" class="page">Synchronous behavior testing</a></li>
    </ul></li>
    <li><a href="../typed/coexisting.html" class="page">Coexistence</a></li>
    <li><a href="../typed/style-guide.html" class="page">Style guide</a></li>
    <li><a href="../typed/from-classic.html" class="page">Learning Akka Typed from Classic</a></li>
  </ul></li>
  <li><a href="../typed/index-cluster.html" class="page">Cluster</a></li>
  <li><a href="../typed/index-persistence.html" class="page">Persistence (Event Sourcing)</a></li>
  <li><a href="../typed/index-persistence-durable-state.html" class="page">Persistence (Durable State)</a></li>
  <li><a href="../stream/index.html" class="page">Streams</a></li>
  <li><a href="../discovery/index.html" class="page">Discovery</a></li>
  <li><a href="../index-utilities.html" class="page">Utilities</a></li>
  <li><a href="../common/other-modules.html" class="page">Other Akka modules</a></li>
  <li><a href="../additional/deploy.html" class="page">Package, Deploy and Run</a></li>
  <li><a href="../project/index.html" class="page">Project Information</a></li>
  <li><a href="../index-classic.html" class="page">Akka Classic</a></li>
</ul>
</nav>
</div>
</header>
<div class="site-content-wrapper">
<aside class="sticky-sidebar show-for-large">
<header class="nav-header sticky-sidebar-header">
<div class="nav-header-title">
<h1><a href="../index.html">Akka Documentation</a></h1>
</div>
<div class="nav-header-version">
Version 2.8.0-M1
</div>
<div class="nav-header-groups">
<select class="supergroup" name="Language"><option class="group" value="group-scala">Scala</option><option class="group" value="group-java">Java</option></select>
</div>
<div class="nav-header-search">
<input id="search" type="search" class="search" placeholder="Search" />
</div>
</header>
<nav class="site-nav sticky-sidebar-contents">
<div class="nav-toc">
<ul>
  <li><a href="../security/index.html" class="page">Security Announcements</a></li>
  <li><a href="../typed/guide/index.html" class="page">Getting Started Guide</a></li>
  <li><a href="../general/index.html" class="page">General Concepts</a></li>
  <li><a href="../typed/index.html" class="page">Actors</a>
  <ul>
    <li><a href="../typed/actors.html" class="page">Introduction to Actors</a></li>
    <li><a href="../typed/actor-lifecycle.html" class="page">Actor lifecycle</a></li>
    <li><a href="../typed/interaction-patterns.html" class="page">Interaction Patterns</a></li>
    <li><a href="../typed/fault-tolerance.html" class="page">Fault Tolerance</a></li>
    <li><a href="../typed/actor-discovery.html" class="page">Actor discovery</a></li>
    <li><a href="../typed/routers.html" class="page">Routers</a></li>
    <li><a href="../typed/stash.html" class="page">Stash</a></li>
    <li><a href="../typed/fsm.html" class="page">Behaviors as finite state machines</a></li>
    <li><a href="../coordinated-shutdown.html" class="page">Coordinated Shutdown</a></li>
    <li><a href="../typed/dispatchers.html" class="page">Dispatchers</a></li>
    <li><a href="../typed/mailboxes.html" class="page">Mailboxes</a></li>
    <li><a href="../typed/testing.html" class="page">Testing</a>
    <ul>
      <li><a href="../typed/testing.html#module-info" class="header">Module info</a></li>
      <li><a href="../typed/testing.html#introduction" class="header">Introduction</a></li>
      <li><a href="../typed/testing-async.html#asynchronous-testing" class="active page">Asynchronous testing</a>
      <ul>
        <li><a href="../typed/testing-async.html#basic-example" class="header">Basic example</a></li>
        <li><a href="../typed/testing-async.html#observing-mocked-behavior" class="header">Observing mocked behavior</a></li>
        <li><a href="../typed/testing-async.html#test-framework-integration" class="header">Test framework integration</a></li>
        <li><a href="../typed/testing-async.html#configuration" class="header">Configuration</a></li>
        <li><a href="../typed/testing-async.html#controlling-the-scheduler" class="header">Controlling the scheduler</a></li>
        <li><a href="../typed/testing-async.html#test-of-logging" class="header">Test of logging</a></li>
        <li><a href="../typed/testing-async.html#silence-logging-output-from-tests" class="header">Silence logging output from tests</a></li>
      </ul></li>
      <li><a href="../typed/testing-sync.html" class="page">Synchronous behavior testing</a></li>
    </ul></li>
    <li><a href="../typed/coexisting.html" class="page">Coexistence</a></li>
    <li><a href="../typed/style-guide.html" class="page">Style guide</a></li>
    <li><a href="../typed/from-classic.html" class="page">Learning Akka Typed from Classic</a></li>
  </ul></li>
  <li><a href="../typed/index-cluster.html" class="page">Cluster</a></li>
  <li><a href="../typed/index-persistence.html" class="page">Persistence (Event Sourcing)</a></li>
  <li><a href="../typed/index-persistence-durable-state.html" class="page">Persistence (Durable State)</a></li>
  <li><a href="../stream/index.html" class="page">Streams</a></li>
  <li><a href="../discovery/index.html" class="page">Discovery</a></li>
  <li><a href="../index-utilities.html" class="page">Utilities</a></li>
  <li><a href="../common/other-modules.html" class="page">Other Akka modules</a></li>
  <li><a href="../additional/deploy.html" class="page">Package, Deploy and Run</a></li>
  <li><a href="../project/index.html" class="page">Project Information</a></li>
  <li><a href="../index-classic.html" class="page">Akka Classic</a></li>
</ul>
</div>
</nav>
<footer class="nav-footer sticky-sidebar-footer">
<a href="https://akka.io"><img class="logo" src="../images/akka-logo-reverse.svg"/></a>

</footer>
</aside>
<main class="fixed-shift-for-large expanded row">
<section class="site-content small-12 column">
<article class="page-content row">
<div class="small-12 column" id="docs">
<h2><a href="#asynchronous-testing" name="asynchronous-testing" class="anchor"><span class="anchor-link"></span></a>Asynchronous testing</h2>
<p>You are viewing the documentation for the new actor APIs, to view the Akka Classic documentation, see <a href="../testing.html">Classic Testing</a>.</p>
<p>Asynchronous testing uses a real <span class="group-scala"><a href="https://doc.akka.io/api/akka/2.8/akka/actor/typed/ActorSystem.html" title="akka.actor.typed.ActorSystem"><code>ActorSystem</code></a></span><span class="group-java"><a href="https://doc.akka.io/japi/akka/2.8/akka/actor/typed/ActorSystem.html" title="akka.actor.typed.ActorSystem"><code>ActorSystem</code></a></span> that allows you to test your Actors in a more realistic environment.</p>
<p>The minimal setup consists of the test procedure, which provides the desired stimuli, the actor under test, and an actor receiving replies. Bigger systems replace the actor under test with a network of actors, apply stimuli at varying injection points and arrange results to be sent from different emission points, but the basic principle stays the same in that a single procedure drives the test.</p>
<h3><a href="#basic-example" name="basic-example" class="anchor"><span class="anchor-link"></span></a>Basic example</h3>
<p>Actor under test:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/akka/tree/v2.8.0-M1/akka-actor-testkit-typed/src/test/scala/docs/akka/actor/testkit/typed/scaladsl/AsyncTestingExampleSpec.scala#L31-L40" target="_blank" title="Go to snippet source">source</a><code class="language-scala">object Echo {
  case class Ping(message: String, response: ActorRef[Pong])
  case class Pong(message: String)

  def apply(): Behavior[Ping] = Behaviors.receiveMessage {
    case Ping(m, replyTo) =&gt;
      replyTo ! Pong(m)
      Behaviors.same
  }
}</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/akka/tree/v2.8.0-M1/akka-actor-testkit-typed/src/test/java/jdocs/akka/actor/testkit/typed/javadsl/AsyncTestingExampleTest.java#L39-L81" target="_blank" title="Go to snippet source">source</a><code class="language-java">public static class Echo {
  public static class Ping {
    public final String message;
    public final ActorRef&lt;Pong&gt; replyTo;

    public Ping(String message, ActorRef&lt;Pong&gt; replyTo) {
      this.message = message;
      this.replyTo = replyTo;
    }
  }

  public static class Pong {
    public final String message;

    public Pong(String message) {
      this.message = message;
    }

    @Override
    public boolean equals(Object o) {
      if (this == o) return true;
      if (!(o instanceof Pong)) return false;
      Pong pong = (Pong) o;
      return message.equals(pong.message);
    }

    @Override
    public int hashCode() {
      return Objects.hash(message);
    }
  }

  public static Behavior&lt;Ping&gt; create() {
    return Behaviors.receive(Ping.class)
        .onMessage(
            Ping.class,
            ping -&gt; {
              ping.replyTo.tell(new Pong(ping.message));
              return Behaviors.same();
            })
        .build();
  }
}</code></pre></dd>
</dl>
<p>Tests create an instance of <span class="group-java"><a href="https://doc.akka.io/japi/akka/2.8/akka/actor/testkit/typed/javadsl/ActorTestKit.html" title="akka.actor.testkit.typed.javadsl.ActorTestKit"><code>ActorTestKit</code></a></span><span class="group-scala"><a href="https://doc.akka.io/api/akka/2.8/akka/actor/testkit/typed/scaladsl/ActorTestKit.html" title="akka.actor.testkit.typed.scaladsl.ActorTestKit"><code>ActorTestKit</code></a></span>. This provides access to:</p>
<ul>
  <li>An ActorSystem</li>
  <li>Methods for spawning Actors. These are created under the special testkit user guardian</li>
  <li>A method to shut down the ActorSystem from the test suite</li>
</ul>
<p>This first example is using the &ldquo;raw&rdquo; <code>ActorTestKit</code> but if you are using <span class="group-scala">ScalaTest</span><span class="group-java">JUnit</span> you can simplify the tests by using the <a href="testing-async.html#test-framework-integration">Test framework integration</a>. It&rsquo;s still good to read this section to understand how it works.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/akka/tree/v2.8.0-M1/akka-actor-testkit-typed/src/test/scala/docs/akka/actor/testkit/typed/scaladsl/AsyncTestingExampleSpec.scala#L10-L141" target="_blank" title="Go to snippet source">source</a><code class="language-scala">import akka.actor.testkit.typed.scaladsl.ActorTestKit

import org.scalatest.BeforeAndAfterAll
import org.scalatest.matchers.should.Matchers
import org.scalatest.wordspec.AnyWordSpec

class AsyncTestingExampleSpec
    extends AnyWordSpec
    with BeforeAndAfterAll
    with Matchers {
  val testKit = ActorTestKit()
}</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/akka/tree/v2.8.0-M1/akka-actor-testkit-typed/src/test/java/jdocs/akka/actor/testkit/typed/javadsl/AsyncTestingExampleTest.java#L13-L198" target="_blank" title="Go to snippet source">source</a><code class="language-java">import akka.actor.testkit.typed.javadsl.ActorTestKit;

public class AsyncTestingExampleTest
{
  static final ActorTestKit testKit = ActorTestKit.create();
}</code></pre></dd>
</dl>
<p>Your test is responsible for shutting down the <span class="group-scala"><a href="https://doc.akka.io/api/akka/2.8/akka/actor/typed/ActorSystem.html" title="akka.actor.typed.ActorSystem"><code>ActorSystem</code></a></span><span class="group-java"><a href="https://doc.akka.io/japi/akka/2.8/akka/actor/typed/ActorSystem.html" title="akka.actor.typed.ActorSystem"><code>ActorSystem</code></a></span> e.g. using <span class="group-scala"><code>BeforeAndAfterAll</code> when using ScalaTest</span><span class="group-java"><code>@AfterClass</code> when using JUnit</span>.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/akka/tree/v2.8.0-M1/akka-actor-testkit-typed/src/test/scala/docs/akka/actor/testkit/typed/scaladsl/AsyncTestingExampleSpec.scala#L138" target="_blank" title="Go to snippet source">source</a><code class="language-scala">override def afterAll(): Unit = testKit.shutdownTestKit()</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/akka/tree/v2.8.0-M1/akka-actor-testkit-typed/src/test/java/jdocs/akka/actor/testkit/typed/javadsl/AsyncTestingExampleTest.java#L121-L124" target="_blank" title="Go to snippet source">source</a><code class="language-java">@AfterClass
public static void cleanup() {
  testKit.shutdownTestKit();
}</code></pre></dd>
</dl>
<p>The following demonstrates:</p>
<ul>
  <li>Creating an actor from the <code>TestKit</code>&rsquo;s system using <code>spawn</code></li>
  <li>Creating a <code>TestProbe</code></li>
  <li>Verifying that the actor under test responds via the <code>TestProbe</code></li>
</ul>
<p>Note that it is possible to use a <code>TestProbe</code> directly as a <span class="group-scala"><a href="https://doc.akka.io/api/akka/2.8/akka/actor/typed/RecipientRef.html" title="akka.actor.typed.RecipientRef"><code>RecipientRef</code></a></span><span class="group-java"><a href="https://doc.akka.io/japi/akka/2.8/akka/actor/typed/RecipientRef.html" title="akka.actor.typed.RecipientRef"><code>RecipientRef</code></a></span> (a common supertype of <code>ActorRef</code> and <a href="cluster-sharding.html">Cluster Sharding</a> <code>EntityRef</code>), in cases where a message protocol uses <code>RecipientRef</code> instead of specifying <code>ActorRef</code> or <code>EntityRef</code>.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/akka/tree/v2.8.0-M1/akka-actor-testkit-typed/src/test/scala/docs/akka/actor/testkit/typed/scaladsl/AsyncTestingExampleSpec.scala#L77-L80" target="_blank" title="Go to snippet source">source</a><code class="language-scala">val pinger = testKit.spawn(Echo(), &quot;ping&quot;)
val probe = testKit.createTestProbe[Echo.Pong]()
pinger ! Echo.Ping(&quot;hello&quot;, probe.ref)
probe.expectMessage(Echo.Pong(&quot;hello&quot;))</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/akka/tree/v2.8.0-M1/akka-actor-testkit-typed/src/test/java/jdocs/akka/actor/testkit/typed/javadsl/AsyncTestingExampleTest.java#L130-L133" target="_blank" title="Go to snippet source">source</a><code class="language-java">ActorRef&lt;Echo.Ping&gt; pinger = testKit.spawn(Echo.create(), &quot;ping&quot;);
TestProbe&lt;Echo.Pong&gt; probe = testKit.createTestProbe();
pinger.tell(new Echo.Ping(&quot;hello&quot;, probe.ref()));
probe.expectMessage(new Echo.Pong(&quot;hello&quot;));</code></pre></dd>
</dl>
<p>Actors can also be spawned anonymously:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/akka/tree/v2.8.0-M1/akka-actor-testkit-typed/src/test/scala/docs/akka/actor/testkit/typed/scaladsl/AsyncTestingExampleSpec.scala#L86" target="_blank" title="Go to snippet source">source</a><code class="language-scala">val pinger = testKit.spawn(Echo())</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/akka/tree/v2.8.0-M1/akka-actor-testkit-typed/src/test/java/jdocs/akka/actor/testkit/typed/javadsl/AsyncTestingExampleTest.java#L140" target="_blank" title="Go to snippet source">source</a><code class="language-java">ActorRef&lt;Echo.Ping&gt; pinger = testKit.spawn(Echo.create());</code></pre></dd>
</dl>
<p>Note that you can add <code>import testKit._</code> to get access to the <code>spawn</code> and <code>createTestProbe</code> methods at the top level without prefixing them with <code>testKit</code>.</p>
<h4><a href="#stopping-actors" name="stopping-actors" class="anchor"><span class="anchor-link"></span></a>Stopping actors</h4>
<p>The method will wait until the actor stops or throw an assertion error in case of a timeout.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/akka/tree/v2.8.0-M1/akka-actor-testkit-typed/src/test/scala/docs/akka/actor/testkit/typed/scaladsl/AsyncTestingExampleSpec.scala#L97-L106" target="_blank" title="Go to snippet source">source</a><code class="language-scala">val pinger1 = testKit.spawn(Echo(), &quot;pinger&quot;)
pinger1 ! Echo.Ping(&quot;hello&quot;, probe.ref)
probe.expectMessage(Echo.Pong(&quot;hello&quot;))
testKit.stop(pinger1) // Uses default timeout

// Immediately creating an actor with the same name
val pinger2 = testKit.spawn(Echo(), &quot;pinger&quot;)
pinger2 ! Echo.Ping(&quot;hello&quot;, probe.ref)
probe.expectMessage(Echo.Pong(&quot;hello&quot;))
testKit.stop(pinger2, 10.seconds) // Custom timeout</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/akka/tree/v2.8.0-M1/akka-actor-testkit-typed/src/test/java/jdocs/akka/actor/testkit/typed/javadsl/AsyncTestingExampleTest.java#L151-L160" target="_blank" title="Go to snippet source">source</a><code class="language-java">ActorRef&lt;Echo.Ping&gt; pinger1 = testKit.spawn(Echo.create(), &quot;pinger&quot;);
pinger1.tell(new Echo.Ping(&quot;hello&quot;, probe.ref()));
probe.expectMessage(new Echo.Pong(&quot;hello&quot;));
testKit.stop(pinger1);

// Immediately creating an actor with the same name
ActorRef&lt;Echo.Ping&gt; pinger2 = testKit.spawn(Echo.create(), &quot;pinger&quot;);
pinger2.tell(new Echo.Ping(&quot;hello&quot;, probe.ref()));
probe.expectMessage(new Echo.Pong(&quot;hello&quot;));
testKit.stop(pinger2, Duration.ofSeconds(10));</code></pre></dd>
</dl>
<p>The <code>stop</code> method can only be used for actors that were spawned by the same <span class="group-java"><a href="https://doc.akka.io/japi/akka/2.8/akka/actor/testkit/typed/javadsl/ActorTestKit.html" title="akka.actor.testkit.typed.javadsl.ActorTestKit"><code>ActorTestKit</code></a></span><span class="group-scala"><a href="https://doc.akka.io/api/akka/2.8/akka/actor/testkit/typed/scaladsl/ActorTestKit.html" title="akka.actor.testkit.typed.scaladsl.ActorTestKit"><code>ActorTestKit</code></a></span>. Other actors will not be stopped by that method.</p>
<h3><a href="#observing-mocked-behavior" name="observing-mocked-behavior" class="anchor"><span class="anchor-link"></span></a>Observing mocked behavior</h3>
<p>When testing a component (which may be an actor or not) that interacts with other actors it can be useful to not have to run the other actors it depends on. Instead, you might want to create mock behaviors that accept and possibly respond to messages in the same way the other actor would do but without executing any actual logic. In addition to this it can also be useful to observe those interactions to assert that the component under test did send the expected messages. This allows the same kinds of tests as classic <code>TestActor</code>/<code>Autopilot</code>.</p>
<p>As an example, let&rsquo;s assume we&rsquo;d like to test the following component:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/akka/tree/v2.8.0-M1/akka-actor-testkit-typed/src/test/scala/docs/akka/actor/testkit/typed/scaladsl/AsyncTestingExampleSpec.scala#L44-L56" target="_blank" title="Go to snippet source">source</a><code class="language-scala">case class Message(i: Int, replyTo: ActorRef[Try[Int]])

class Producer(publisher: ActorRef[Message])(implicit scheduler: Scheduler) {

  def produce(messages: Int)(implicit timeout: Timeout): Unit = {
    (0 until messages).foreach(publish)
  }

  private def publish(i: Int)(implicit timeout: Timeout): Future[Try[Int]] = {
    publisher.ask(ref =&gt; Message(i, ref))
  }

}</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/akka/tree/v2.8.0-M1/akka-actor-testkit-typed/src/test/java/jdocs/akka/actor/testkit/typed/javadsl/AsyncTestingExampleTest.java#L85-L117" target="_blank" title="Go to snippet source">source</a><code class="language-java"><br/>static class Message {
  int i;
  ActorRef&lt;Integer&gt; replyTo;

  Message(int i, ActorRef&lt;Integer&gt; replyTo) {
    this.i = i;
    this.replyTo = replyTo;
  }
}

public static class Producer {

  private Scheduler scheduler;
  private ActorRef&lt;Message&gt; publisher;

  Producer(Scheduler scheduler, ActorRef&lt;Message&gt; publisher) {
    this.scheduler = scheduler;
    this.publisher = publisher;
  }

  public void produce(int messages) {
    IntStream.range(0, messages).forEach(this::publish);
  }

  private CompletionStage&lt;Integer&gt; publish(int i) {
    return AskPattern.ask(
        publisher,
        (ActorRef&lt;Integer&gt; ref) -&gt; new Message(i, ref),
        Duration.ofSeconds(3),
        scheduler);
  }
}</code></pre></dd>
</dl>
<p>In our test, we create a mocked <code>publisher</code> actor. Additionally we use <code>Behaviors.monitor</code> with a <code>TestProbe</code> in order to be able to verify the interaction of the <code>producer</code> with the <code>publisher</code>:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/akka/tree/v2.8.0-M1/akka-actor-testkit-typed/src/test/scala/docs/akka/actor/testkit/typed/scaladsl/AsyncTestingExampleSpec.scala#L113-L132" target="_blank" title="Go to snippet source">source</a><code class="language-scala">import testKit._

// simulate the happy path
val mockedBehavior = Behaviors.receiveMessage[Message] { msg =&gt;
  msg.replyTo ! Success(msg.i)
  Behaviors.same
}
val probe = testKit.createTestProbe[Message]()
val mockedPublisher = testKit.spawn(Behaviors.monitor(probe.ref, mockedBehavior))

// test our component
val producer = new Producer(mockedPublisher)
val messages = 3
producer.produce(messages)

// verify expected behavior
for (i &lt;- 0 until messages) {
  val msg = probe.expectMessageType[Message]
  msg.i shouldBe i
}</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/akka/tree/v2.8.0-M1/akka-actor-testkit-typed/src/test/java/jdocs/akka/actor/testkit/typed/javadsl/AsyncTestingExampleTest.java#L167-L189" target="_blank" title="Go to snippet source">source</a><code class="language-java">// simulate the happy path
Behavior&lt;Message&gt; mockedBehavior =
    Behaviors.receiveMessage(
        message -&gt; {
          message.replyTo.tell(message.i);
          return Behaviors.same();
        });
TestProbe&lt;Message&gt; probe = testKit.createTestProbe();
ActorRef&lt;Message&gt; mockedPublisher =
    testKit.spawn(Behaviors.monitor(Message.class, probe.ref(), mockedBehavior));

// test our component
Producer producer = new Producer(testKit.scheduler(), mockedPublisher);
int messages = 3;
producer.produce(messages);

// verify expected behavior
IntStream.range(0, messages)
    .forEach(
        i -&gt; {
          Message msg = probe.expectMessageClass(Message.class);
          assertEquals(i, msg.i);
        });</code></pre></dd>
</dl>
<h3><a href="#test-framework-integration" name="test-framework-integration" class="anchor"><span class="anchor-link"></span></a>Test framework integration</h3><div class="group-java">
<p>If you are using JUnit you can use <a href="https://doc.akka.io/japi/akka/2.8/akka/actor/testkit/typed/javadsl/TestKitJunitResource.html" title="akka.actor.testkit.typed.javadsl.TestKitJunitResource"><code>TestKitJunitResource</code></a> to have the async test kit automatically shutdown when the test is complete.</p>
<p>Note that the dependency on JUnit is marked as optional from the test kit module, so your project must explicitly include a dependency on JUnit to use this.</p></div><div class="group-scala">
<p>If you are using ScalaTest you can extend <a href="https://doc.akka.io/api/akka/2.8/akka/actor/testkit/typed/scaladsl/ScalaTestWithActorTestKit.html" title="akka.actor.testkit.typed.scaladsl.ScalaTestWithActorTestKit"><code>ScalaTestWithActorTestKit</code></a> to have the async test kit automatically shutdown when the test is complete. This is done in <code>afterAll</code> from the <code>BeforeAndAfterAll</code> trait. If you override that method you should call <code>super.afterAll</code> to shutdown the test kit.</p>
<p>Note that the dependency on ScalaTest is marked as optional from the test kit module, so your project must explicitly include a dependency on ScalaTest to use this.</p></div>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/akka/tree/v2.8.0-M1/akka-actor-testkit-typed/src/test/scala/docs/akka/actor/testkit/typed/scaladsl/ScalaTestIntegrationExampleSpec.scala#L13-L31" target="_blank" title="Go to snippet source">source</a><code class="language-scala">import akka.actor.testkit.typed.scaladsl.ScalaTestWithActorTestKit
import org.scalatest.wordspec.AnyWordSpecLike

class ScalaTestIntegrationExampleSpec extends ScalaTestWithActorTestKit with AnyWordSpecLike {

  &quot;Something&quot; must {
    &quot;behave correctly&quot; in {
      val pinger = testKit.spawn(Echo(), &quot;ping&quot;)
      val probe = testKit.createTestProbe[Echo.Pong]()
      pinger ! Echo.Ping(&quot;hello&quot;, probe.ref)
      probe.expectMessage(Echo.Pong(&quot;hello&quot;))
    }
  }
}</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/akka/tree/v2.8.0-M1/akka-actor-testkit-typed/src/test/java/jdocs/akka/actor/testkit/typed/javadsl/JunitIntegrationExampleTest.java#L13-L35" target="_blank" title="Go to snippet source">source</a><code class="language-java">import akka.actor.testkit.typed.javadsl.TestKitJunitResource;
import akka.actor.testkit.typed.javadsl.TestProbe;
import akka.actor.typed.ActorRef;
import org.junit.ClassRule;
import org.junit.Test;

public class JunitIntegrationExampleTest {

  @ClassRule public static final TestKitJunitResource testKit = new TestKitJunitResource();


  @Test
  public void testSomething() {
    ActorRef&lt;Echo.Ping&gt; pinger = testKit.spawn(Echo.create(), &quot;ping&quot;);
    TestProbe&lt;Echo.Pong&gt; probe = testKit.createTestProbe();
    pinger.tell(new Echo.Ping(&quot;hello&quot;, probe.ref()));
    probe.expectMessage(new Echo.Pong(&quot;hello&quot;));
  }
}</code></pre></dd>
</dl>
<h3><a href="#configuration" name="configuration" class="anchor"><span class="anchor-link"></span></a>Configuration</h3>
<p>By default the <code>ActorTestKit</code> loads configuration from <code>application-test.conf</code> if that exists, otherwise it is using default configuration from the reference.conf resources that ship with the Akka libraries. The application.conf of your project is not used in this case. A specific configuration can be given as parameter when creating the TestKit.</p>
<p>If you prefer to use <code>application.conf</code> you can pass that as the configuration parameter to the TestKit. It&rsquo;s loaded with:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/akka/tree/v2.8.0-M1/akka-actor-testkit-typed/src/test/scala/docs/akka/actor/testkit/typed/scaladsl/TestConfigExample.scala#L12-L14" target="_blank" title="Go to snippet source">source</a><code class="language-scala">import com.typesafe.config.ConfigFactory

ConfigFactory.load()</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/akka/tree/v2.8.0-M1/akka-actor-testkit-typed/src/test/java/jdocs/akka/actor/testkit/typed/javadsl/TestConfigExample.java#L8-L17" target="_blank" title="Go to snippet source">source</a><code class="language-java">import com.typesafe.config.ConfigFactory;

ConfigFactory.load()</code></pre></dd>
</dl>
<p>It&rsquo;s often convenient to define configuration for a specific test as a <code>String</code> in the test itself and use that as the configuration parameter to the TestKit. <code>ConfigFactory.parseString</code> can be used for that:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/akka/tree/v2.8.0-M1/akka-actor-testkit-typed/src/test/scala/docs/akka/actor/testkit/typed/scaladsl/TestConfigExample.scala#L18-L21" target="_blank" title="Go to snippet source">source</a><code class="language-scala">ConfigFactory.parseString(&quot;&quot;&quot;
  akka.loglevel = DEBUG
  akka.log-config-on-start = on
  &quot;&quot;&quot;)</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/akka/tree/v2.8.0-M1/akka-actor-testkit-typed/src/test/java/jdocs/akka/actor/testkit/typed/javadsl/TestConfigExample.java#L22" target="_blank" title="Go to snippet source">source</a><code class="language-java">ConfigFactory.parseString(&quot;akka.loglevel = DEBUG \n&quot; + &quot;akka.log-config-on-start = on \n&quot;)</code></pre></dd>
</dl>
<p>Combining those approaches using <code>withFallback</code>:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/akka/tree/v2.8.0-M1/akka-actor-testkit-typed/src/test/scala/docs/akka/actor/testkit/typed/scaladsl/TestConfigExample.scala#L25-L28" target="_blank" title="Go to snippet source">source</a><code class="language-scala">ConfigFactory.parseString(&quot;&quot;&quot;
  akka.loglevel = DEBUG
  akka.log-config-on-start = on
  &quot;&quot;&quot;).withFallback(ConfigFactory.load())</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/akka/tree/v2.8.0-M1/akka-actor-testkit-typed/src/test/java/jdocs/akka/actor/testkit/typed/javadsl/TestConfigExample.java#L27-L28" target="_blank" title="Go to snippet source">source</a><code class="language-java">ConfigFactory.parseString(&quot;akka.loglevel = DEBUG \n&quot; + &quot;akka.log-config-on-start = on \n&quot;)
    .withFallback(ConfigFactory.load())</code></pre></dd>
</dl>
<p>More information can be found in the <a href="https://github.com/lightbend/config#using-the-library">documentation of the configuration library</a>.</p><div class="callout note "><div class="callout-title">Note</div>
<p>Note that <code>reference.conf</code> files are intended for libraries to define default values and shouldn&rsquo;t be used in an application. It&rsquo;s not supported to override a config property owned by one library in a <code>reference.conf</code> of another library.</p></div>
<h3><a href="#controlling-the-scheduler" name="controlling-the-scheduler" class="anchor"><span class="anchor-link"></span></a>Controlling the scheduler</h3>
<p>It can be hard to reliably unit test specific scenario&rsquo;s when your actor relies on timing: especially when running many tests in parallel it can be hard to get the timing just right. Making such tests more reliable by using generous timeouts make the tests take a long time to run.</p>
<p>For such situations, we provide a scheduler where you can manually, explicitly advance the clock.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/akka/tree/v2.8.0-M1/akka-actor-testkit-typed/src/test/scala/docs/akka/actor/testkit/typed/scaladsl/ManualTimerExampleSpec.scala#L8-L118" target="_blank" title="Go to snippet source">source</a><code class="language-scala">import scala.concurrent.duration._
import akka.actor.testkit.typed.scaladsl.ScalaTestWithActorTestKit
import akka.actor.testkit.typed.scaladsl.ManualTime
import akka.actor.testkit.typed.scaladsl.TestProbe
import akka.actor.testkit.typed.scaladsl.LogCapturing
import akka.actor.typed.scaladsl.Behaviors
import org.scalatest.wordspec.AnyWordSpecLike

class ManualTimerExampleSpec
    extends ScalaTestWithActorTestKit(ManualTime.config)
    with AnyWordSpecLike
    with LogCapturing {

  val manualTime: ManualTime = ManualTime()

  &quot;A timer&quot; must {
    &quot;schedule non-repeated ticks&quot; in {
      case object Tick
      case object Tock

      val probe = TestProbe[Tock.type]()
      val behavior = Behaviors.withTimers[Tick.type] { timer =&gt;
        timer.startSingleTimer(Tick, 10.millis)
        Behaviors.receiveMessage { _ =&gt;
          probe.ref ! Tock
          Behaviors.same
        }
      }

      spawn(behavior)

      manualTime.expectNoMessageFor(9.millis, probe)

      manualTime.timePasses(2.millis)
      probe.expectMessage(Tock)

      manualTime.expectNoMessageFor(10.seconds, probe)
    }
  }
}</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/akka/tree/v2.8.0-M1/akka-actor-testkit-typed/src/test/java/jdocs/akka/actor/testkit/typed/javadsl/ManualTimerExampleTest.java#L8-L64" target="_blank" title="Go to snippet source">source</a><code class="language-java"><br/>import akka.actor.testkit.typed.javadsl.LogCapturing;
import akka.actor.typed.Behavior;
import akka.actor.testkit.typed.javadsl.ManualTime;
import akka.actor.testkit.typed.javadsl.TestKitJunitResource;
import org.junit.ClassRule;
import org.junit.Rule;
import org.scalatestplus.junit.JUnitSuite;
import java.time.Duration;

import akka.actor.typed.javadsl.Behaviors;

import org.junit.Test;

import akka.actor.testkit.typed.javadsl.TestProbe;

public class ManualTimerExampleTest extends JUnitSuite {

  @ClassRule
  public static final TestKitJunitResource testKit = new TestKitJunitResource(ManualTime.config());

  @Rule public final LogCapturing logCapturing = new LogCapturing();

  private final ManualTime manualTime = ManualTime.get(testKit.system());

  static final class Tick {
    private Tick() {}

    static final Tick INSTANCE = new Tick();
  }

  static final class Tock {}

  @Test
  public void testScheduleNonRepeatedTicks() {
    TestProbe&lt;Tock&gt; probe = testKit.createTestProbe();
    Behavior&lt;Tick&gt; behavior =
        Behaviors.withTimers(
            timer -&gt; {
              timer.startSingleTimer(Tick.INSTANCE, Duration.ofMillis(10));
              return Behaviors.receiveMessage(
                  tick -&gt; {
                    probe.ref().tell(new Tock());
                    return Behaviors.same();
                  });
            });

    testKit.spawn(behavior);

    manualTime.expectNoMessageFor(Duration.ofMillis(9), probe);

    manualTime.timePasses(Duration.ofMillis(2));
    probe.expectMessageClass(Tock.class);

    manualTime.expectNoMessageFor(Duration.ofSeconds(10), probe);
  }
}</code></pre></dd>
</dl>
<h3><a href="#test-of-logging" name="test-of-logging" class="anchor"><span class="anchor-link"></span></a>Test of logging</h3>
<p>To verify that certain <a href="logging.html">logging</a> events are emitted there is a utility called <span class="group-java"><a href="https://doc.akka.io/japi/akka/2.8/akka/actor/testkit/typed/javadsl/LoggingTestKit.html" title="akka.actor.testkit.typed.javadsl.LoggingTestKit"><code>LoggingTestKit</code></a></span><span class="group-scala"><a href="https://doc.akka.io/api/akka/2.8/akka/actor/testkit/typed/scaladsl/LoggingTestKit.html" title="akka.actor.testkit.typed.scaladsl.LoggingTestKit"><code>LoggingTestKit</code></a></span> . You define a criteria of the expected logging events and it will assert that the given number of occurrences of matching logging events are emitted within a block of code.</p><div class="callout note "><div class="callout-title">Note</div>
<p>The <span class="group-java"><a href="https://doc.akka.io/japi/akka/2.8/akka/actor/testkit/typed/javadsl/LoggingTestKit.html" title="akka.actor.testkit.typed.javadsl.LoggingTestKit"><code>LoggingTestKit</code></a></span><span class="group-scala"><a href="https://doc.akka.io/api/akka/2.8/akka/actor/testkit/typed/scaladsl/LoggingTestKit.html" title="akka.actor.testkit.typed.scaladsl.LoggingTestKit"><code>LoggingTestKit</code></a></span> implementation <a href="logging.html#logback">requires Logback dependency</a>.</p></div>
<p>For example, a criteria that verifies that an <code>INFO</code> level event with a message containing &ldquo;Received message&rdquo; is logged:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/akka/tree/v2.8.0-M1/akka-actor-typed-tests/src/test/scala/docs/akka/typed/LoggingDocExamples.scala#L116-L123" target="_blank" title="Go to snippet source">source</a><code class="language-scala">import akka.actor.testkit.typed.scaladsl.LoggingTestKit

// implicit ActorSystem is needed, but that is given by ScalaTestWithActorTestKit
//implicit val system: ActorSystem[_]

LoggingTestKit.info(&quot;Received message&quot;).expect {
  ref ! Message(&quot;hello&quot;)
}</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/akka/tree/v2.8.0-M1/akka-actor-typed-tests/src/test/java/jdocs/akka/typed/LoggingDocExamples.java#L25-L167" target="_blank" title="Go to snippet source">source</a><code class="language-java">import akka.actor.testkit.typed.javadsl.LoggingTestKit;

LoggingTestKit.info(&quot;Received message&quot;)
    .expect(
        system,
        () -&gt; {
          ref.tell(new Message(&quot;hello&quot;));
          return null;
        });</code></pre></dd>
</dl>
<p>More advanced criteria can be built by chaining conditions that all must be satisfied for a matching event.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/akka/tree/v2.8.0-M1/akka-actor-typed-tests/src/test/scala/docs/akka/typed/LoggingDocExamples.scala#L127-L140" target="_blank" title="Go to snippet source">source</a><code class="language-scala">LoggingTestKit
  .error[IllegalArgumentException]
  .withMessageRegex(&quot;.*was rejected.*expecting ascii input.*&quot;)
  .withCustom { event =&gt;
    event.marker match {
      case Some(m) =&gt; m.getName == &quot;validation&quot;
      case None    =&gt; false
    }
  }
  .withOccurrences(2)
  .expect {
    ref ! Message(&quot;hellö&quot;)
    ref ! Message(&quot;hejdå&quot;)
  }</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/akka/tree/v2.8.0-M1/akka-actor-typed-tests/src/test/java/jdocs/akka/typed/LoggingDocExamples.java#L171-L184" target="_blank" title="Go to snippet source">source</a><code class="language-java">LoggingTestKit.error(IllegalArgumentException.class)
    .withMessageRegex(&quot;.*was rejected.*expecting ascii input.*&quot;)
    .withCustom(
        event -&gt;
            event.getMarker().isPresent()
                &amp;&amp; event.getMarker().get().getName().equals(&quot;validation&quot;))
    .withOccurrences(2)
    .expect(
        system,
        () -&gt; {
          ref.tell(new Message(&quot;hellö&quot;));
          ref.tell(new Message(&quot;hejdå&quot;));
          return null;
        });</code></pre></dd>
</dl>
<p>See <span class="group-java"><a href="https://doc.akka.io/japi/akka/2.8/akka/actor/testkit/typed/javadsl/LoggingTestKit.html" title="akka.actor.testkit.typed.javadsl.LoggingTestKit"><code>LoggingTestKit</code></a></span><span class="group-scala"><a href="https://doc.akka.io/api/akka/2.8/akka/actor/testkit/typed/scaladsl/LoggingTestKit.html" title="akka.actor.testkit.typed.scaladsl.LoggingTestKit"><code>LoggingTestKit</code></a></span> for more details.</p>
<h3><a href="#silence-logging-output-from-tests" name="silence-logging-output-from-tests" class="anchor"><span class="anchor-link"></span></a>Silence logging output from tests</h3>
<p>When running tests, it&rsquo;s typically preferred to have the output to standard out, together with the output from the testing framework (<span class="group-scala">ScalaTest</span><span class="group-java">JUnit</span>). On one hand you want the output to be clean without logging noise, but on the other hand you want as much information as possible if there is a test failure (for example in CI builds).</p>
<p>The Akka TestKit provides a <code>LogCapturing</code> utility to support this with ScalaTest or JUnit. It will buffer log events instead of emitting them to the <code>ConsoleAppender</code> immediately (or whatever Logback appender that is configured). When there is a test failure the buffered events are flushed to the target appenders, typically a <code>ConsoleAppender</code>.</p><div class="callout note "><div class="callout-title">Note</div>
<p>The <code>LogCapturing</code> utility <a href="logging.html#logback">requires Logback dependency</a>.</p></div>
<p><span class="group-scala">Mix <code>LogCapturing</code> trait into the ScalaTest</span><span class="group-java">Add a <code>LogCapturing</code> <code>@Rule</code> in the JUnit test</span> like this:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/akka/tree/v2.8.0-M1/akka-actor-testkit-typed/src/test/scala/docs/akka/actor/testkit/typed/scaladsl/ScalaTestIntegrationExampleSpec.scala#L11-L45" target="_blank" title="Go to snippet source">source</a><code class="language-scala">import akka.actor.testkit.typed.scaladsl.LogCapturing
import akka.actor.testkit.typed.scaladsl.ScalaTestWithActorTestKit
import org.scalatest.wordspec.AnyWordSpecLike

class LogCapturingExampleSpec extends ScalaTestWithActorTestKit with AnyWordSpecLike with LogCapturing {

  &quot;Something&quot; must {
    &quot;behave correctly&quot; in {
      val pinger = testKit.spawn(Echo(), &quot;ping&quot;)
      val probe = testKit.createTestProbe[Echo.Pong]()
      pinger ! Echo.Ping(&quot;hello&quot;, probe.ref)
      probe.expectMessage(Echo.Pong(&quot;hello&quot;))
    }
  }
}</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/akka/tree/v2.8.0-M1/akka-actor-testkit-typed/src/test/java/jdocs/akka/actor/testkit/typed/javadsl/LogCapturingExampleTest.java#L10-L31" target="_blank" title="Go to snippet source">source</a><code class="language-java">import akka.actor.testkit.typed.javadsl.LogCapturing;
import akka.actor.testkit.typed.javadsl.TestKitJunitResource;
import akka.actor.testkit.typed.javadsl.TestProbe;
import akka.actor.typed.ActorRef;
import org.junit.ClassRule;
import org.junit.Rule;
import org.junit.Test;

public class LogCapturingExampleTest {

  @ClassRule public static final TestKitJunitResource testKit = new TestKitJunitResource();

  @Rule public final LogCapturing logCapturing = new LogCapturing();

  @Test
  public void testSomething() {
    ActorRef&lt;Echo.Ping&gt; pinger = testKit.spawn(Echo.create(), &quot;ping&quot;);
    TestProbe&lt;Echo.Pong&gt; probe = testKit.createTestProbe();
    pinger.tell(new Echo.Ping(&quot;hello&quot;, probe.ref()));
    probe.expectMessage(new Echo.Pong(&quot;hello&quot;));
  }
}</code></pre></dd>
</dl>
<p>Then you also need to configure the <code>CapturingAppender</code> and <code>CapturingAppenderDelegate</code> in <code>src/test/resources/logback-test.xml</code>:</p>
<pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/akka/tree/v2.8.0-M1/akka-actor-typed-tests/src/test/resources/logback-doc-test.xml" target="_blank" title="Go to snippet source">source</a><code class="language-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;configuration&gt;

    &lt;appender name=&quot;STDOUT&quot; class=&quot;ch.qos.logback.core.ConsoleAppender&quot;&gt;
        &lt;filter class=&quot;ch.qos.logback.classic.filter.ThresholdFilter&quot;&gt;
            &lt;level&gt;INFO&lt;/level&gt;
        &lt;/filter&gt;
        &lt;encoder&gt;
            &lt;pattern&gt;[%date{ISO8601}] [%level] [%logger] [%marker] [%thread] - %msg MDC: {%mdc}%n&lt;/pattern&gt;
        &lt;/encoder&gt;
    &lt;/appender&gt;

    &lt;!--
    Logging from tests are silenced by this appender. When there is a test failure
    the captured logging events are flushed to the appenders defined for the
    akka.actor.testkit.typed.internal.CapturingAppenderDelegate logger.
    --&gt;
    &lt;appender name=&quot;CapturingAppender&quot; class=&quot;akka.actor.testkit.typed.internal.CapturingAppender&quot; /&gt;

    &lt;!--
    The appenders defined for this CapturingAppenderDelegate logger are used
    when there is a test failure and all logging events from the test are
    flushed to these appenders.
    --&gt;
    &lt;logger name=&quot;akka.actor.testkit.typed.internal.CapturingAppenderDelegate&quot; &gt;
      &lt;appender-ref ref=&quot;STDOUT&quot;/&gt;
    &lt;/logger&gt;

    &lt;root level=&quot;DEBUG&quot;&gt;
        &lt;appender-ref ref=&quot;CapturingAppender&quot;/&gt;
    &lt;/root&gt;
&lt;/configuration&gt;</code></pre>
</div>
</article>
<div class="row">
<div class="small-12 column">
<section class="nav-prev-next row">
<div class="nav-prev small-6 column">
<a href="../typed/testing.html"><i class="icon-prev"></i> <span class="link-prev">Testing</span></a>
</div>
<div class="nav-next small-6 column clearfix">
<a class="float-right" href="../typed/testing-sync.html">Synchronous behavior testing <i class="icon-next"></i></a>
</div>
</section>
</div>
</div>
<div class="source-github row">
Found an error in this documentation? The source code for this page can be found <a href="https://github.com/akka/akka/tree/v2.8.0-M1/akka-docs/src/main/paradox/typed/testing-async.md">here</a>.
Please feel free to edit and contribute a pull request.
</div>

<footer class="page-footer row clearfix">
<img class="akka-icon float-left show-for-medium" src="../images/akka-icon.svg" />
<section class="copyright">
<div>Akka is available under the <a href="https://www.lightbend.com/akka/license" target="_blank">Business Source License 1.1</a>.</div>
<p class="legal">
&copy; 2011-2022 <a href="https://www.lightbend.com" target="_blank">Lightbend, Inc.</a> |
<a href="https://www.lightbend.com/legal/licenses" target="_blank">Licenses</a> |
<a href="https://www.lightbend.com/legal/terms" target="_blank">Terms</a> |
<a href="https://www.lightbend.com/legal/privacy" target="_blank">Privacy Policy</a> |
<a href="https://akka.io/cookie/" target="_blank">Cookie Listing</a> |
<a class="optanon-toggle-display">Cookie Settings</a>
</p>
</section>

</footer>
</section>
</main>
</div>

<script type="text/javascript" src="../js/scrollsneak.js"></script>
<script type="text/javascript">jQuery(document).foundation();</script>
<script type="text/javascript" src="../js/groups.js"></script>
<script type="text/javascript" src="../js/page.js"></script>
<script type="text/javascript" src="../js/snippets.js"></script>
<script type="text/javascript" src="../js/magellan.js"></script>
<script type="text/javascript" src="../js/metadata-toggle.js"></script>
<script type="text/javascript" src="../js/lbHeader.js"></script>

<style type="text/css">@import "../lib/prettify/prettify.css";</style>
<script type="text/javascript" src="../lib/prettify/prettify.js"></script>
<script type="text/javascript" src="../lib/prettify/lang-scala.js"></script>
<script type="text/javascript">//<![CDATA[
jQuery(function(){window.prettyPrint && prettyPrint()});
//]]></script>
<!-- Algolia docs search -->
<script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.js"></script>
<style>.algolia-autocomplete { display: block !important }</style>
<script type="text/javascript">
docsearch({
apiKey: '543bad5ad786495d9ccd445ed34ed082',
indexName: 'akka_io',
inputSelector: '#search',
algoliaOptions: {
hitsPerPage: 5
}
});

docsearch({
apiKey: '543bad5ad786495d9ccd445ed34ed082',
indexName: 'akka_io',
inputSelector: '#overlay-search',
algoliaOptions: {
hitsPerPage: 5
}
});

// set up "/" as global shortcut for focusing on search
jQuery(document).keypress(function (event) {
if (event.keyCode == 47) {
jQuery("#search").focus();
return false; // swallow key event, otherwise the / char would be input into the search box
}
});
</script>

<script type="text/javascript" src="../assets/js/warnOldDocs.js"></script>
<script type="text/javascript" src="../assets/js/scalafiddle.js"></script>


</body>
</html>
