<!DOCTYPE html>
<html class="no-js" lang="en">

<head>
<title>EventStream &bull; Akka Documentation</title>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<meta name="description" content="Akka is a toolkit for building highly concurrent, distributed, and resilient message-driven applications for Java and Scala."/>
<link rel="canonical" href="https://doc.akka.io/docs/akka/current/typed/event-stream.html"/>
<script type="text/javascript" src="../lib/jquery/jquery.min.js"></script>
<script type="text/javascript" src="../lib/foundation/dist/js/foundation.min.js"></script>
<link rel="stylesheet" type="text/css" href="../lib/normalize.css/normalize.css"/>
<link rel="stylesheet" type="text/css" href="../lib/foundation/dist/css/foundation.min.css"/>
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.css" />
<link rel="stylesheet" type="text/css" href="../css/icons.css"/>
<link rel="stylesheet" type="text/css" href="../css/page-8.css"/>
<link rel="stylesheet" type="text/css" href="../css/banner-2.css"/>
<link rel="shortcut icon" href="../images/favicon.ico" />
<link rel="apple-touch-icon" sizes="180x180" href="../images/apple-touch-icon.png"/>
<link rel="icon" type="image/png" sizes="32x32" href="../images/favicon-32x32.png"/>
<link rel="icon" type="image/png" sizes="16x16" href="../images/favicon-16x16.png"/>
<link rel="manifest" href="../images/manifest.json"/>
<meta name="msapplication-TileImage" content="../images/mstile-150x150.png"/>
<meta name="msapplication-TileColor" content="#15a9ce"/>
<meta name="theme-color" content="#15a9ce"/>
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>
<!-- OneTrust Cookies Consent Notice (Production Standard, akka.io, en-GB) start -->
<script src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js"  type="text/javascript" charset="UTF-8" data-domain-script="28b912e7-09e9-43d5-91e4-3d1897044004" ></script>
<script type="text/javascript">
function OptanonWrapper() { }
</script>
<!-- OneTrust Cookies Consent Notice (Production Standard, akka.io, en-GB) end -->
<!-- Google Tag Manager now loads Google Analytics and any other tracking scripts. GTM also performs respects a users cookie choices-->
<script type="text/javascript">
(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-KBJGH35');
</script>

</head>

<body id="underlay" data-toggler="nav-open">
<div id="lightbend-banner" class="lightbend-banner akka full-width" data-category="OSS Lightbend Banner Impression" data-label="Akka Banner Impression">
<div class="oss-wrapper">
<div class="oss-brand">
<a class="oss-track-link-label" data-category="OSS Lightbend Banner Clicks" data-label="Lightbend Logo - Akka Banner" href="https://www.lightbend.com">
<img class="lightbend-logo" src="../images/banner-logos/lightbend-reverse.svg" alt="Lightbend" title="Lightbend">
</a>
</div>
<div class="oss-ad no-drop-down">
<nav id="lightbendRotator" class="lightbend-rotator">
<a class="oss-track-link-label" data-category="OSS Lightbend Banner Clicks" data-label="Promo Rotator - Introducing Akka Cloud to Edge Continuum. Build once for the Cloud. Seamlessly deploy to the Edge. [Learn more] - Akka Banner" href="https://www.lightbend.com/blog/akka-edge-unifying-the-cloud-and-edge">
Introducing Akka Cloud to Edge Continuum. Build once for the Cloud. Seamlessly deploy to the Edge. <span class="akka-btn">Learn more</span>
</a>
</nav>
</div>
</div>
</div>

<header class="site-header hide-for-large">
<div class="sticky-header clearfix">
<a href="https://akka.io"><img class="logo" src="../images/akka-logo-reverse.svg"/></a>

<button class="menu-icon float-right" type="button" data-toggle="underlay overlay"></button>
</div>
<div id="overlay" class="overlay-nav" data-toggler="nav-open">
<header class="nav-header">
<div class="nav-header-title">
<h1><a href="../index.html">Akka Documentation</a></h1>
</div>
<div class="nav-header-version">
Version 2.9.1
</div>
<div class="nav-header-groups">
<select class="supergroup" name="Language"><option class="group" value="group-scala">Scala</option><option class="group" value="group-java">Java</option></select>
<select class="supergroup" name="BuildTool"><option class="group" value="group-sbt">sbt</option><option class="group" value="group-maven">Maven</option><option class="group" value="group-gradle">Gradle</option></select>
</div>
<div id="overlay-search-container" class="nav-header-search">
<input id="overlay-search" type="search" class="search" placeholder="Search" />
</div>
</header>
<nav class="nav-toc">
<ul>
  <li><a href="../security/index.html" class="page">Security Announcements</a></li>
  <li><a href="../typed/guide/index.html" class="page">Getting Started Guide</a></li>
  <li><a href="../general/index.html" class="page">General Concepts</a></li>
  <li><a href="../typed/index.html" class="page">Actors</a></li>
  <li><a href="../typed/index-cluster.html" class="page">Cluster</a></li>
  <li><a href="../typed/index-persistence.html" class="page">Persistence (Event Sourcing)</a></li>
  <li><a href="../typed/index-persistence-durable-state.html" class="page">Persistence (Durable State)</a></li>
  <li><a href="../stream/index.html" class="page">Streams</a></li>
  <li><a href="../discovery/index.html" class="page">Discovery</a></li>
  <li><a href="../index-utilities.html" class="page">Utilities</a>
  <ul>
    <li><a href="../typed/event-stream.html#eventstream" class="active page">EventStream</a>
    <ul>
      <li><a href="../typed/event-stream.html#dependency" class="header">Dependency</a></li>
      <li><a href="../typed/event-stream.html#introduction" class="header">Introduction</a></li>
      <li><a href="../typed/event-stream.html#how-to-use" class="header">How to use</a></li>
      <li><a href="../typed/event-stream.html#eventbus" class="header">EventBus</a></li>
      <li><a href="../typed/event-stream.html#classifiers" class="header">Classifiers</a></li>
    </ul></li>
    <li><a href="../typed/logging.html" class="page">Logging</a></li>
    <li><a href="../common/circuitbreaker.html" class="page">Circuit Breaker</a></li>
    <li><a href="../futures.html" class="page">Futures patterns</a></li>
    <li><a href="../typed/extending.html" class="page">Extending Akka</a></li>
  </ul></li>
  <li><a href="../common/other-modules.html" class="page">Other Akka modules</a></li>
  <li><a href="../additional/deploy.html" class="page">Package, Deploy and Run</a></li>
  <li><a href="../project/index.html" class="page">Project Information</a></li>
  <li><a href="../index-classic.html" class="page">Akka Classic</a></li>
</ul>
</nav>
</div>
</header>
<div class="site-content-wrapper">
<aside class="sticky-sidebar show-for-large">
<header class="nav-header sticky-sidebar-header">
<div class="nav-header-title">
<h1><a href="../index.html">Akka Documentation</a></h1>
</div>
<div class="nav-header-version">
Version 2.9.1
</div>
<div class="nav-header-groups">
<select class="supergroup" name="Language"><option class="group" value="group-scala">Scala</option><option class="group" value="group-java">Java</option></select>
<select class="supergroup" name="BuildTool"><option class="group" value="group-sbt">sbt</option><option class="group" value="group-maven">Maven</option><option class="group" value="group-gradle">Gradle</option></select>
</div>
<div class="nav-header-search">
<input id="search" type="search" class="search" placeholder="Search" />
</div>
</header>
<nav class="site-nav sticky-sidebar-contents">
<div class="nav-toc">
<ul>
  <li><a href="../security/index.html" class="page">Security Announcements</a></li>
  <li><a href="../typed/guide/index.html" class="page">Getting Started Guide</a></li>
  <li><a href="../general/index.html" class="page">General Concepts</a></li>
  <li><a href="../typed/index.html" class="page">Actors</a></li>
  <li><a href="../typed/index-cluster.html" class="page">Cluster</a></li>
  <li><a href="../typed/index-persistence.html" class="page">Persistence (Event Sourcing)</a></li>
  <li><a href="../typed/index-persistence-durable-state.html" class="page">Persistence (Durable State)</a></li>
  <li><a href="../stream/index.html" class="page">Streams</a></li>
  <li><a href="../discovery/index.html" class="page">Discovery</a></li>
  <li><a href="../index-utilities.html" class="page">Utilities</a>
  <ul>
    <li><a href="../typed/event-stream.html#eventstream" class="active page">EventStream</a>
    <ul>
      <li><a href="../typed/event-stream.html#dependency" class="header">Dependency</a></li>
      <li><a href="../typed/event-stream.html#introduction" class="header">Introduction</a></li>
      <li><a href="../typed/event-stream.html#how-to-use" class="header">How to use</a></li>
      <li><a href="../typed/event-stream.html#eventbus" class="header">EventBus</a></li>
      <li><a href="../typed/event-stream.html#classifiers" class="header">Classifiers</a></li>
    </ul></li>
    <li><a href="../typed/logging.html" class="page">Logging</a></li>
    <li><a href="../common/circuitbreaker.html" class="page">Circuit Breaker</a></li>
    <li><a href="../futures.html" class="page">Futures patterns</a></li>
    <li><a href="../typed/extending.html" class="page">Extending Akka</a></li>
  </ul></li>
  <li><a href="../common/other-modules.html" class="page">Other Akka modules</a></li>
  <li><a href="../additional/deploy.html" class="page">Package, Deploy and Run</a></li>
  <li><a href="../project/index.html" class="page">Project Information</a></li>
  <li><a href="../index-classic.html" class="page">Akka Classic</a></li>
</ul>
</div>
</nav>
<footer class="nav-footer sticky-sidebar-footer">
<a href="https://akka.io"><img class="logo" src="../images/akka-logo-reverse.svg"/></a>

</footer>
</aside>
<main class="fixed-shift-for-large expanded row">
<section class="site-content small-12 column">
<article class="page-content row">
<div class="small-12 column" id="docs">
<h1><a href="#eventstream" name="eventstream" class="anchor"><span class="anchor-link"></span></a>EventStream</h1>
<p>You are viewing the documentation for the new actor APIs, to view the Akka Classic documentation, see <a href="../event-bus.html#event-stream">Classic Event Stream</a>.</p>
<h2><a href="#dependency" name="dependency" class="anchor"><span class="anchor-link"></span></a>Dependency</h2>
<!--- #dependency --->
<p>The Akka dependencies are available from Akka&rsquo;s library repository. To access them there, you need to configure the URL for this repository.</p><dl class="repository"><dt>sbt</dt><dd><pre class="prettyprint"><code class="language-scala">resolvers += "Akka library repository".at("https://repo.akka.io/maven")
</code></pre></dd><dt>Maven</dt><dd><pre class="prettyprint"><code class="language-xml">&lt;project&gt
  ...
  &lt;repositories&gt;
    &lt;repository&gt;
      &lt;id&gt;akka-repository&lt;/id&gt;
      &lt;name>Akka library repository&lt;/name&gt;
      &lt;url>https://repo.akka.io/maven&lt;/url&gt;
    &lt;/repository&gt;
  &lt;/repositories&gt
&lt;/project&gt;
</code></pre></dd><dt>Gradle</dt><dd><pre class="prettyprint"><code class="language-gradle">repositories {
    mavenCentral()
    maven {
        url "https://repo.akka.io/maven"
    }
}
</code></pre></dd></dl>
<p>To use Akka Actor Typed, you must add the following dependency in your project:</p><dl class="dependency"><dt>sbt</dt><dd><pre class="prettyprint"><code class="language-scala">val AkkaVersion = "2.9.1"
libraryDependencies += "com.typesafe.akka" %% "akka-actor-typed" % AkkaVersion</code></pre></dd><dt>Maven</dt><dd><pre class="prettyprint"><code class="language-xml">&lt;properties&gt;
  &lt;scala.binary.version&gt;2.13&lt;/scala.binary.version&gt;
&lt;/properties&gt;
&lt;dependencyManagement&gt;
  &lt;dependencies&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;com.typesafe.akka&lt;/groupId&gt;
      &lt;artifactId&gt;akka-bom_${scala.binary.version}&lt;/artifactId&gt;
      &lt;version&gt;2.9.1&lt;/version&gt;
      &lt;type&gt;pom&lt;/type&gt;
      &lt;scope&gt;import&lt;/scope&gt;
    &lt;/dependency&gt
  &lt;/dependencies&gt;
&lt;/dependencyManagement&gt;
&lt;dependencies&gt
  &lt;dependency&gt;
    &lt;groupId&gt;com.typesafe.akka&lt;/groupId&gt;
    &lt;artifactId&gt;akka-actor-typed_${scala.binary.version}&lt;/artifactId&gt;
  &lt;/dependency&gt
&lt;/dependencies&gt;</code></pre></dd><dt>Gradle</dt><dd><pre class="prettyprint"><code class="language-gradle">def versions = [
  ScalaBinary: "2.13"
]
dependencies {
  implementation platform("com.typesafe.akka:akka-bom_${versions.ScalaBinary}:2.9.1")

  implementation "com.typesafe.akka:akka-actor-typed_${versions.ScalaBinary}"
}</code></pre></dd></dl>
<!--- #dependency --->
<h2><a href="#introduction" name="introduction" class="anchor"><span class="anchor-link"></span></a>Introduction</h2>
<p>The event stream is the main <a href="event-stream.html#eventbus">Event Bus</a> of each actor system: it is used for carrying <a href="logging.html">log messages</a> and <a href="event-stream.html#dead-letters">Dead Letters</a> and may be used by the user code for other purposes as well. </p>
<p>It uses <a href="event-stream.html#subchannel-classification">Subchannel Classification</a> which enables registering to related sets of channels.</p>
<h2><a href="#how-to-use" name="how-to-use" class="anchor"><span class="anchor-link"></span></a>How to use</h2>
<p>The following example demonstrates how a subscription works. Given an actor:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/akka/tree/v2.9.1/akka-actor-typed-tests/src/test/scala/akka/actor/typed/eventstream/LoggingDocSpec.scala#L27-L79" target="_blank" title="Go to snippet source">source</a><code class="language-scala">import akka.actor.typed.Behavior
import akka.actor.typed.eventstream.EventStream.Subscribe
import akka.actor.typed.scaladsl.Behaviors

object DeadLetterListener {

  def apply(): Behavior[String] = Behaviors.setup { context =&gt;
    // subscribe DeadLetter at startup.
    val adapter = context.messageAdapter[DeadLetter](d =&gt; d.message.toString)
    context.system.eventStream ! Subscribe(adapter)

    Behaviors.receiveMessage {
      case msg: String =&gt;
        println(msg)
        Behaviors.same
    }
  }
}
  ActorSystem(Behaviors.setup[Void] { context =&gt;
    context.spawn(DeadLetterListener(), &quot;DeadLetterListener&quot;, Props.empty)
    Behaviors.empty
  }, &quot;System&quot;)</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/akka/tree/v2.9.1/akka-actor-typed-tests/src/test/java/akka/actor/typed/eventstream/LoggingDocTest.java#L29-L31" target="_blank" title="Go to snippet source">source</a><code class="language-java">import akka.actor.DeadLetter;
import akka.actor.typed.ActorRef;
import akka.actor.typed.ActorSystem;</code></pre></dd>
</dl><div class="group-java">
<p>the actor definition like this:</p>
<pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/akka/tree/v2.9.1/akka-actor-typed-tests/src/test/java/akka/actor/typed/eventstream/LoggingDocTest.java#L47-L70" target="_blank" title="Go to snippet source">source</a><code class="language-java">static class DeadLetterActor extends AbstractBehavior&lt;String&gt; {

    public static Behavior&lt;String&gt; create() {
        return Behaviors.setup(DeadLetterActor::new);
    }

    public DeadLetterActor(ActorContext&lt;String&gt; context) {
        super(context);
        ActorRef&lt;DeadLetter&gt; messageAdapter = context.messageAdapter(
            DeadLetter.class,
            d -&gt; d.message().toString()
        );
        context.getSystem().eventStream()
            .tell(new Subscribe&lt;&gt;(DeadLetter.class, messageAdapter));
    }

    @Override
    public Receive&lt;String&gt; createReceive() {
        return newReceiveBuilder().onMessage(String.class, msg -&gt; {
            System.out.println(msg);
            return Behaviors.same();
        }).build();
    }
}</code></pre>
<p>it can be subscribed like this:</p>
<pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/akka/tree/v2.9.1/akka-actor-typed-tests/src/test/java/akka/actor/typed/eventstream/LoggingDocTest.java#L39-L40" target="_blank" title="Go to snippet source">source</a><code class="language-java">ActorSystem&lt;DeadLetter&gt; system = ActorSystem.create(Behaviors.empty(), &quot;DeadLetters&quot;);
system.eventStream().tell(new Subscribe&lt;&gt;(DeadLetter.class, system));</code></pre></div>
<p>It is also worth pointing out that thanks to the way the subchannel classification is implemented in the event stream, it is possible to subscribe to a group of events, by subscribing to their common superclass as demonstrated in the following example:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/akka/tree/v2.9.1/akka-actor-typed-tests/src/test/scala/akka/actor/typed/eventstream/LoggingDocSpec.scala#L48-L104" target="_blank" title="Go to snippet source">source</a><code class="language-scala">object ListenerActor {
  abstract class AllKindsOfMusic { def artist: String }
  case class Jazz(artist: String) extends AllKindsOfMusic
  case class Electronic(artist: String) extends AllKindsOfMusic

  def apply(): Behavior[ListenerActor.AllKindsOfMusic] = Behaviors.receive { (context, msg) =&gt;
    msg match {
      case m: Jazz =&gt;
        println(s&quot;${context.self.path.name} is listening to: ${m.artist}&quot;)
        Behaviors.same
      case m: Electronic =&gt;
        println(s&quot;${context.self.path.name} is listening to: ${m.artist}&quot;)
        Behaviors.same
      case _ =&gt;
        Behaviors.same
    }
  }
}

  implicit val system: ActorSystem[SpawnProtocol.Command] = ActorSystem(SpawnProtocol(), &quot;SpawnProtocol&quot;)
  implicit val ec: ExecutionContext = system.executionContext

  val jazzListener: Future[ActorRef[Jazz]] =
    system.ask(Spawn(behavior = ListenerActor(), name = &quot;jazz&quot;, props = Props.empty, _))
  val musicListener: Future[ActorRef[AllKindsOfMusic]] =
    system.ask(Spawn(behavior = ListenerActor(), name = &quot;music&quot;, props = Props.empty, _))

  for (jazzListenerRef &lt;- jazzListener; musicListenerRef &lt;- musicListener) {
    system.eventStream ! Subscribe(jazzListenerRef)
    system.eventStream ! Subscribe(musicListenerRef)
  }

  // only musicListener gets this message, since it listens to *all* kinds of music:
  system.eventStream ! Publish(Electronic(&quot;Parov Stelar&quot;))

  // jazzListener and musicListener will be notified about Jazz:
  system.eventStream ! Publish(Jazz(&quot;Sonny Rollins&quot;))</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/akka/tree/v2.9.1/akka-actor-typed-tests/src/test/scala/akka/actor/typed/eventstream/LoggingDocSpec.scala#L48-L104" target="_blank" title="Go to snippet source">source</a><code class="language-scala">object ListenerActor {
  abstract class AllKindsOfMusic { def artist: String }
  case class Jazz(artist: String) extends AllKindsOfMusic
  case class Electronic(artist: String) extends AllKindsOfMusic

  def apply(): Behavior[ListenerActor.AllKindsOfMusic] = Behaviors.receive { (context, msg) =&gt;
    msg match {
      case m: Jazz =&gt;
        println(s&quot;${context.self.path.name} is listening to: ${m.artist}&quot;)
        Behaviors.same
      case m: Electronic =&gt;
        println(s&quot;${context.self.path.name} is listening to: ${m.artist}&quot;)
        Behaviors.same
      case _ =&gt;
        Behaviors.same
    }
  }
}

  implicit val system: ActorSystem[SpawnProtocol.Command] = ActorSystem(SpawnProtocol(), &quot;SpawnProtocol&quot;)
  implicit val ec: ExecutionContext = system.executionContext

  val jazzListener: Future[ActorRef[Jazz]] =
    system.ask(Spawn(behavior = ListenerActor(), name = &quot;jazz&quot;, props = Props.empty, _))
  val musicListener: Future[ActorRef[AllKindsOfMusic]] =
    system.ask(Spawn(behavior = ListenerActor(), name = &quot;music&quot;, props = Props.empty, _))

  for (jazzListenerRef &lt;- jazzListener; musicListenerRef &lt;- musicListener) {
    system.eventStream ! Subscribe(jazzListenerRef)
    system.eventStream ! Subscribe(musicListenerRef)
  }

  // only musicListener gets this message, since it listens to *all* kinds of music:
  system.eventStream ! Publish(Electronic(&quot;Parov Stelar&quot;))

  // jazzListener and musicListener will be notified about Jazz:
  system.eventStream ! Publish(Jazz(&quot;Sonny Rollins&quot;))</code></pre></dd>
</dl>
<p>Similarly to <a href="event-stream.html#actor-classification">Actor Classification</a>, <span class="group-scala"><a href="https://doc.akka.io/api/akka/2.8/akka/event/EventStream.html" title="akka.event.EventStream"><code>EventStream</code></a></span><span class="group-java"><a href="https://doc.akka.io/japi/akka/2.8/akka/event/EventStream.html" title="akka.event.EventStream"><code>EventStream</code></a></span> will automatically remove subscribers when they terminate.</p><div class="callout note "><div class="callout-title">Note</div>
<p>The event stream is a <em>local facility</em>, meaning that it will <em>not</em> distribute events to other nodes in a clustered environment (unless you subscribe a Remote Actor to the stream explicitly). If you need to broadcast events in an Akka cluster, <em>without</em> knowing your recipients explicitly (i.e. obtaining their ActorRefs), you may want to look into: <a href="actor-discovery.html#receptionist">The Receptionist</a>, <a href="routers.html#group-router">Group Routers</a> or <a href="distributed-pub-sub.html">Distributed Publish Subscribe in Cluster</a>.</p></div>
<h3><a href="#dead-letters" name="dead-letters" class="anchor"><span class="anchor-link"></span></a>Dead Letters</h3>
<p>As described at <a href="actor-lifecycle.html#stopping-actors">Stopping actors</a>, messages queued when an actor terminates or sent after its death are re-routed to the dead letter mailbox, which by default will publish the messages wrapped in <span class="group-scala"><a href="https://doc.akka.io/api/akka/2.8/akka/actor/DeadLetter.html" title="akka.actor.DeadLetter"><code>DeadLetter</code></a></span><span class="group-java"><a href="https://doc.akka.io/japi/akka/2.8/akka/actor/DeadLetter.html" title="akka.actor.DeadLetter"><code>DeadLetter</code></a></span>. This wrapper holds the original sender, receiver and message of the envelope which was redirected.</p>
<p>Some internal messages (marked with the <span class="group-scala"><a href="https://doc.akka.io/api/akka/2.8/akka/actor/DeadLetterSuppression.html" title="akka.actor.DeadLetterSuppression"><code>DeadLetterSuppression</code></a></span><span class="group-java"><a href="https://doc.akka.io/japi/akka/2.8/akka/actor/DeadLetterSuppression.html" title="akka.actor.DeadLetterSuppression"><code>DeadLetterSuppression</code></a></span> <span class="group-scala">trait</span><span class="group-java">interface</span>) will not end up as dead letters like normal messages. These are by design safe and expected to sometimes arrive at a terminated actor and since they are nothing to worry about, they are suppressed from the default dead letters logging mechanism.</p>
<p>However, in case you find yourself in need of debugging these kinds of low level suppressed dead letters, it&rsquo;s still possible to subscribe to them explicitly:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/akka/tree/v2.9.1/akka-actor-typed-tests/src/test/scala/akka/actor/typed/eventstream/LoggingDocSpec.scala#L112-L113" target="_blank" title="Go to snippet source">source</a><code class="language-scala">import akka.actor.SuppressedDeadLetter
system.eventStream ! Subscribe[SuppressedDeadLetter](listener)</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/akka/tree/v2.9.1/akka-actor-typed-tests/src/test/java/akka/actor/typed/eventstream/LoggingDocTest.java#L169" target="_blank" title="Go to snippet source">source</a><code class="language-java">system.eventStream().tell(new Subscribe&lt;&gt;(SuppressedDeadLetter.class, actor));</code></pre></dd>
</dl>
<p>or all dead letters (including the suppressed ones):</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/akka/tree/v2.9.1/akka-actor-typed-tests/src/test/scala/akka/actor/typed/eventstream/LoggingDocSpec.scala#L117-L118" target="_blank" title="Go to snippet source">source</a><code class="language-scala">import akka.actor.AllDeadLetters
system.eventStream ! Subscribe[AllDeadLetters](listener)</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/akka/tree/v2.9.1/akka-actor-typed-tests/src/test/java/akka/actor/typed/eventstream/LoggingDocTest.java#L181" target="_blank" title="Go to snippet source">source</a><code class="language-java">system.eventStream().tell(new Subscribe&lt;&gt;(AllDeadLetters.class, actor));</code></pre></dd>
</dl>
<h3><a href="#other-uses" name="other-uses" class="anchor"><span class="anchor-link"></span></a>Other Uses</h3>
<p>The event stream is always there and ready to be used, you can publish your own events (it accepts <span class="group-scala"><a href="http://www.scala-lang.org/api/2.13.12/scala/AnyRef.html" title="scala.AnyRef"><code>AnyRef</code></a></span><span class="group-java"><a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Object.html" title="java.lang.Object"><code>Object</code></a></span>) and subscribe listeners to the corresponding JVM classes.</p>
<h2><a href="#eventbus" name="eventbus" class="anchor"><span class="anchor-link"></span></a>EventBus</h2>
<!--- #introduction-start --->
<p>Originally conceived as a way to send messages to groups of actors, the <span class="group-scala"><a href="https://doc.akka.io/api/akka/2.8/akka/event/EventBus.html" title="akka.event.EventBus"><code>EventBus</code></a></span><span class="group-java"><a href="https://doc.akka.io/japi/akka/2.8/akka/event/japi/EventBus.html" title="akka.event.japi.EventBus"><code>EventBus</code></a></span> has been generalized into a set of <span class="group-scala">composable traits</span> <span class="group-java">abstract base classes</span> implementing a simple interface: <!--- #introduction-start ---></p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/akka/tree/v2.9.1/akka-actor/src/main/scala/akka/event/EventBus.scala#L29-L51" target="_blank" title="Go to snippet source">source</a><code class="language-scala">/**
 * Attempts to register the subscriber to the specified Classifier
 * @return true if successful and false if not (because it was already
 *   subscribed to that Classifier, or otherwise)
 */
def subscribe(subscriber: Subscriber, to: Classifier): Boolean

/**
 * Attempts to deregister the subscriber from the specified Classifier
 * @return true if successful and false if not (because it wasn&#39;t subscribed
 *   to that Classifier, or otherwise)
 */
def unsubscribe(subscriber: Subscriber, from: Classifier): Boolean

/**
 * Attempts to deregister the subscriber from all Classifiers it may be subscribed to
 */
def unsubscribe(subscriber: Subscriber): Unit

/**
 * Publishes the specified Event to this bus
 */
def publish(event: Event): Unit</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/akka/tree/v2.9.1/akka-docs/src/test/java/jdocs/event/EventBusDocTest.java#L53-L86" target="_blank" title="Go to snippet source">source</a><code class="language-java">/**
 * Attempts to register the subscriber to the specified Classifier
 *
 * @return true if successful and false if not (because it was already subscribed to that
 *     Classifier, or otherwise)
 */
public boolean subscribe(Subscriber subscriber, Classifier to);

/**
 * Attempts to deregister the subscriber from the specified Classifier
 *
 * @return true if successful and false if not (because it wasn&#39;t subscribed to that Classifier,
 *     or otherwise)
 */
public boolean unsubscribe(Subscriber subscriber, Classifier from);

/** Attempts to deregister the subscriber from all Classifiers it may be subscribed to */
public void unsubscribe(Subscriber subscriber);

/** Publishes the specified Event to this bus */
public void publish(Event event);
</code></pre></dd>
</dl>
<!--- #introduction-end ---><div class="callout note "><div class="callout-title">Note</div>
<p>Please note that the EventBus does not preserve the sender of the published messages. If you need a reference to the original sender you have to provide it inside the message.</p></div>
<p>This mechanism is used in different places within Akka, e.g. the EventStream. Implementations can make use of the specific building blocks presented below.</p>
<p>An event bus must define the following three <span class="group-scala">abstract types</span><span class="group-java">type parameters</span>:</p>
<ul>
  <li><code>Event</code> is the type of all events published on that bus</li>
  <li><code>Subscriber</code> is the type of subscribers allowed to register on that event bus</li>
  <li><code>Classifier</code> defines the classifier to be used in selecting  subscribers for dispatching events</li>
</ul>
<p>The traits below are still generic in these types, but they need to be defined for any concrete implementation. <!--- #introduction-end ---></p>
<h2><a href="#classifiers" name="classifiers" class="anchor"><span class="anchor-link"></span></a>Classifiers</h2>
<!--- #classifiers-intro --->
<p>The classifiers presented here are part of the Akka distribution, but rolling your own in case you do not find a perfect match is not difficult, check the implementation of the existing ones on <a href="https://github.com/akka/akka/tree/v2.9.1/akka-actor/src/main/scala/akka/event/EventBus.scala">github</a> <!--- #classifiers-intro ---></p>
<h3><a href="#lookup-classification" name="lookup-classification" class="anchor"><span class="anchor-link"></span></a>Lookup Classification</h3>
<!--- #lookup-classification-start --->
<p>The simplest classification is just to extract an arbitrary classifier from each event and maintaining a set of subscribers for each possible classifier. This can be compared to tuning in on a radio station. The <span class="group-scala">trait <a href="https://doc.akka.io/api/akka/2.8/akka/event/LookupClassification.html" title="akka.event.LookupClassification"><code>LookupClassification</code></a></span><span class="group-java">abstract class <a href="https://doc.akka.io/api/akka/2.8/akka/event/japi/LookupEventBus.html" title="akka.event.japi.LookupEventBus"><code>LookupEventBus</code></a></span> is still generic in that it abstracts over how to compare subscribers and how exactly to classify them.</p>
<p>The necessary methods to be implemented are illustrated with the following example: <!--- #lookup-classification-start ---></p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/akka/tree/v2.9.1/akka-docs/src/test/scala/docs/event/EventBusDocSpec.scala#L15-L48" target="_blank" title="Go to snippet source">source</a><code class="language-scala">import akka.event.EventBus
import akka.event.LookupClassification

final case class MsgEnvelope(topic: String, payload: Any)

/**
 * Publishes the payload of the MsgEnvelope when the topic of the
 * MsgEnvelope equals the String specified when subscribing.
 */
class LookupBusImpl extends EventBus with LookupClassification {
  type Event = MsgEnvelope
  type Classifier = String
  type Subscriber = ActorRef

  // is used for extracting the classifier from the incoming events
  override protected def classify(event: Event): Classifier = event.topic

  // will be invoked for each event for all subscribers which registered themselves
  // for the event’s classifier
  override protected def publish(event: Event, subscriber: Subscriber): Unit = {
    subscriber ! event.payload
  }

  // must define a full order over the subscribers, expressed as expected from
  // `java.lang.Comparable.compare`
  override protected def compareSubscribers(a: Subscriber, b: Subscriber): Int =
    a.compareTo(b)

  // determines the initial size of the index data structure
  // used internally (i.e. the expected number of different classifiers)
  override protected def mapSize(): Int = 128

}
</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/akka/tree/v2.9.1/akka-docs/src/test/java/jdocs/event/EventBusDocTest.java#L22-L138" target="_blank" title="Go to snippet source">source</a><code class="language-java">import akka.event.japi.LookupEventBus;

static class MsgEnvelope {
  public final String topic;
  public final Object payload;

  public MsgEnvelope(String topic, Object payload) {
    this.topic = topic;
    this.payload = payload;
  }
}

/**
 * Publishes the payload of the MsgEnvelope when the topic of the MsgEnvelope equals the String
 * specified when subscribing.
 */
static class LookupBusImpl extends LookupEventBus&lt;MsgEnvelope, ActorRef, String&gt; {

  // is used for extracting the classifier from the incoming events
  @Override
  public String classify(MsgEnvelope event) {
    return event.topic;
  }

  // will be invoked for each event for all subscribers which registered themselves
  // for the event’s classifier
  @Override
  public void publish(MsgEnvelope event, ActorRef subscriber) {
    subscriber.tell(event.payload, ActorRef.noSender());
  }

  // must define a full order over the subscribers, expressed as expected from
  // `java.lang.Comparable.compare`
  @Override
  public int compareSubscribers(ActorRef a, ActorRef b) {
    return a.compareTo(b);
  }

  // determines the initial size of the index data structure
  // used internally (i.e. the expected number of different classifiers)
  @Override
  public int mapSize() {
    return 128;
  }
}</code></pre></dd>
</dl>
<p>A test for this implementation may look like this:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/akka/tree/v2.9.1/akka-docs/src/test/scala/docs/event/EventBusDocSpec.scala#L152-L156" target="_blank" title="Go to snippet source">source</a><code class="language-scala">val lookupBus = new LookupBusImpl
lookupBus.subscribe(testActor, &quot;greetings&quot;)
lookupBus.publish(MsgEnvelope(&quot;time&quot;, System.currentTimeMillis()))
lookupBus.publish(MsgEnvelope(&quot;greetings&quot;, &quot;hello&quot;))
expectMsg(&quot;hello&quot;)</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/akka/tree/v2.9.1/akka-docs/src/test/java/jdocs/event/EventBusDocTest.java#L273-L277" target="_blank" title="Go to snippet source">source</a><code class="language-java">LookupBusImpl lookupBus = new LookupBusImpl();
lookupBus.subscribe(getTestActor(), &quot;greetings&quot;);
lookupBus.publish(new MsgEnvelope(&quot;time&quot;, System.currentTimeMillis()));
lookupBus.publish(new MsgEnvelope(&quot;greetings&quot;, &quot;hello&quot;));
expectMsgEquals(&quot;hello&quot;);</code></pre></dd>
</dl>
<!--- #lookup-classification-end --->
<p>This classifier is efficient in case no subscribers exist for a particular event. <!--- #lookup-classification-end ---></p>
<h3><a href="#subchannel-classification" name="subchannel-classification" class="anchor"><span class="anchor-link"></span></a>Subchannel Classification</h3>
<!--- #subchannel-classification-start --->
<p>If classifiers form a hierarchy and it is desired that subscription be possible not only at the leaf nodes, this classification may be just the right one. It can be compared to tuning in on (possibly multiple) radio channels by genre. This classification has been developed for the case where the classifier is just the JVM class of the event and subscribers may be interested in subscribing to all subclasses of a certain class, but it may be used with any classifier hierarchy.</p>
<p>The necessary methods to be implemented are illustrated with the following example: <!--- #subchannel-classification-start ---></p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/akka/tree/v2.9.1/akka-docs/src/test/scala/docs/event/EventBusDocSpec.scala#L52-L86" target="_blank" title="Go to snippet source">source</a><code class="language-scala">import akka.util.Subclassification

class StartsWithSubclassification extends Subclassification[String] {
  override def isEqual(x: String, y: String): Boolean =
    x == y

  override def isSubclass(x: String, y: String): Boolean =
    x.startsWith(y)
}

import akka.event.SubchannelClassification

/**
 * Publishes the payload of the MsgEnvelope when the topic of the
 * MsgEnvelope starts with the String specified when subscribing.
 */
class SubchannelBusImpl extends EventBus with SubchannelClassification {
  type Event = MsgEnvelope
  type Classifier = String
  type Subscriber = ActorRef

  // Subclassification is an object providing `isEqual` and `isSubclass`
  // to be consumed by the other methods of this classifier
  override protected val subclassification: Subclassification[Classifier] =
    new StartsWithSubclassification

  // is used for extracting the classifier from the incoming events
  override protected def classify(event: Event): Classifier = event.topic

  // will be invoked for each event for all subscribers which registered
  // themselves for the event’s classifier
  override protected def publish(event: Event, subscriber: Subscriber): Unit = {
    subscriber ! event.payload
  }
}</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/akka/tree/v2.9.1/akka-docs/src/test/java/jdocs/event/EventBusDocTest.java#L27-L184" target="_blank" title="Go to snippet source">source</a><code class="language-java">import akka.event.japi.SubchannelEventBus;

static class StartsWithSubclassification implements Subclassification&lt;String&gt; {
  @Override
  public boolean isEqual(String x, String y) {
    return x.equals(y);
  }

  @Override
  public boolean isSubclass(String x, String y) {
    return x.startsWith(y);
  }
}

/**
 * Publishes the payload of the MsgEnvelope when the topic of the MsgEnvelope starts with the
 * String specified when subscribing.
 */
static class SubchannelBusImpl extends SubchannelEventBus&lt;MsgEnvelope, ActorRef, String&gt; {

  // Subclassification is an object providing `isEqual` and `isSubclass`
  // to be consumed by the other methods of this classifier
  @Override
  public Subclassification&lt;String&gt; subclassification() {
    return new StartsWithSubclassification();
  }

  // is used for extracting the classifier from the incoming events
  @Override
  public String classify(MsgEnvelope event) {
    return event.topic;
  }

  // will be invoked for each event for all subscribers which registered themselves
  // for the event’s classifier
  @Override
  public void publish(MsgEnvelope event, ActorRef subscriber) {
    subscriber.tell(event.payload, ActorRef.noSender());
  }
}</code></pre></dd>
</dl>
<p>A test for this implementation may look like this:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/akka/tree/v2.9.1/akka-docs/src/test/scala/docs/event/EventBusDocSpec.scala#L162-L169" target="_blank" title="Go to snippet source">source</a><code class="language-scala">val subchannelBus = new SubchannelBusImpl
subchannelBus.subscribe(testActor, &quot;abc&quot;)
subchannelBus.publish(MsgEnvelope(&quot;xyzabc&quot;, &quot;x&quot;))
subchannelBus.publish(MsgEnvelope(&quot;bcdef&quot;, &quot;b&quot;))
subchannelBus.publish(MsgEnvelope(&quot;abc&quot;, &quot;c&quot;))
expectMsg(&quot;c&quot;)
subchannelBus.publish(MsgEnvelope(&quot;abcdef&quot;, &quot;d&quot;))
expectMsg(&quot;d&quot;)</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/akka/tree/v2.9.1/akka-docs/src/test/java/jdocs/event/EventBusDocTest.java#L288-L295" target="_blank" title="Go to snippet source">source</a><code class="language-java">SubchannelBusImpl subchannelBus = new SubchannelBusImpl();
subchannelBus.subscribe(getTestActor(), &quot;abc&quot;);
subchannelBus.publish(new MsgEnvelope(&quot;xyzabc&quot;, &quot;x&quot;));
subchannelBus.publish(new MsgEnvelope(&quot;bcdef&quot;, &quot;b&quot;));
subchannelBus.publish(new MsgEnvelope(&quot;abc&quot;, &quot;c&quot;));
expectMsgEquals(&quot;c&quot;);
subchannelBus.publish(new MsgEnvelope(&quot;abcdef&quot;, &quot;d&quot;));
expectMsgEquals(&quot;d&quot;);</code></pre></dd>
</dl>
<!--- #subchannel-classification-end --->
<p>This classifier is also efficient in case no subscribers are found for an event, but it uses conventional locking to synchronize an internal classifier cache, hence it is not well-suited to use cases in which subscriptions change with very high frequency (keep in mind that “opening” a classifier by sending the first message will also have to re-check all previous subscriptions). <!--- #subchannel-classification-end ---></p>
<h3><a href="#scanning-classification" name="scanning-classification" class="anchor"><span class="anchor-link"></span></a>Scanning Classification</h3>
<!--- #scanning-classification-start --->
<p>The previous classifier was built for multi-classifier subscriptions which are strictly hierarchical, this classifier is useful if there are overlapping classifiers which cover various parts of the event space without forming a hierarchy. It can be compared to tuning in on (possibly multiple) radio stations by geographical reachability (for old-school radio-wave transmission).</p>
<p>The necessary methods to be implemented are illustrated with the following example: <!--- #scanning-classification-start ---></p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/akka/tree/v2.9.1/akka-docs/src/test/scala/docs/event/EventBusDocSpec.scala#L90-L120" target="_blank" title="Go to snippet source">source</a><code class="language-scala">import akka.event.ScanningClassification

/**
 * Publishes String messages with length less than or equal to the length
 * specified when subscribing.
 */
class ScanningBusImpl extends EventBus with ScanningClassification {
  type Event = String
  type Classifier = Int
  type Subscriber = ActorRef

  // is needed for determining matching classifiers and storing them in an
  // ordered collection
  override protected def compareClassifiers(a: Classifier, b: Classifier): Int =
    if (a &lt; b) -1 else if (a == b) 0 else 1

  // is needed for storing subscribers in an ordered collection
  override protected def compareSubscribers(a: Subscriber, b: Subscriber): Int =
    a.compareTo(b)

  // determines whether a given classifier shall match a given event; it is invoked
  // for each subscription for all received events, hence the name of the classifier
  override protected def matches(classifier: Classifier, event: Event): Boolean =
    event.length &lt;= classifier

  // will be invoked for each event for all subscribers which registered themselves
  // for a classifier matching this event
  override protected def publish(event: Event, subscriber: Subscriber): Unit = {
    subscriber ! event
  }
}</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/akka/tree/v2.9.1/akka-docs/src/test/java/jdocs/event/EventBusDocTest.java#L32-L221" target="_blank" title="Go to snippet source">source</a><code class="language-java">import akka.event.japi.ScanningEventBus;

/**
 * Publishes String messages with length less than or equal to the length specified when
 * subscribing.
 */
static class ScanningBusImpl extends ScanningEventBus&lt;String, ActorRef, Integer&gt; {

  // is needed for determining matching classifiers and storing them in an
  // ordered collection
  @Override
  public int compareClassifiers(Integer a, Integer b) {
    return a.compareTo(b);
  }

  // is needed for storing subscribers in an ordered collection
  @Override
  public int compareSubscribers(ActorRef a, ActorRef b) {
    return a.compareTo(b);
  }

  // determines whether a given classifier shall match a given event; it is invoked
  // for each subscription for all received events, hence the name of the classifier
  @Override
  public boolean matches(Integer classifier, String event) {
    return event.length() &lt;= classifier;
  }

  // will be invoked for each event for all subscribers which registered themselves
  // for the event’s classifier
  @Override
  public void publish(String event, ActorRef subscriber) {
    subscriber.tell(event, ActorRef.noSender());
  }
}</code></pre></dd>
</dl>
<p>A test for this implementation may look like this:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/akka/tree/v2.9.1/akka-docs/src/test/scala/docs/event/EventBusDocSpec.scala#L175-L181" target="_blank" title="Go to snippet source">source</a><code class="language-scala">val scanningBus = new ScanningBusImpl
scanningBus.subscribe(testActor, 3)
scanningBus.publish(&quot;xyzabc&quot;)
scanningBus.publish(&quot;ab&quot;)
expectMsg(&quot;ab&quot;)
scanningBus.publish(&quot;abc&quot;)
expectMsg(&quot;abc&quot;)</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/akka/tree/v2.9.1/akka-docs/src/test/java/jdocs/event/EventBusDocTest.java#L306-L312" target="_blank" title="Go to snippet source">source</a><code class="language-java">ScanningBusImpl scanningBus = new ScanningBusImpl();
scanningBus.subscribe(getTestActor(), 3);
scanningBus.publish(&quot;xyzabc&quot;);
scanningBus.publish(&quot;ab&quot;);
expectMsgEquals(&quot;ab&quot;);
scanningBus.publish(&quot;abc&quot;);
expectMsgEquals(&quot;abc&quot;);</code></pre></dd>
</dl>
<!--- #scanning-classification-end --->
<p>This classifier takes always a time which is proportional to the number of subscriptions, independent of how many actually match. <!--- #scanning-classification-end ---></p>
<h3><a href="#actor-classification" name="actor-classification" class="anchor"><span class="anchor-link"></span></a>Actor Classification</h3>
<p>This classification was originally developed specifically for implementing <a href="../actors.html#lifecycle-monitoring-aka-deathwatch">DeathWatch</a>: subscribers as well as classifiers are of type <span class="group-scala"><a href="https://doc.akka.io/api/akka/2.8/akka/actor/ActorRef.html" title="akka.actor.ActorRef"><code>ActorRef</code></a></span><span class="group-java"><a href="https://doc.akka.io/japi/akka/2.8/akka/actor/ActorRef.html" title="akka.actor.ActorRef"><code>ActorRef</code></a></span>.</p>
<!--- #actor-classification-start --->
<p>This classification requires an <span class="group-scala"><a href="https://doc.akka.io/api/akka/2.8/akka/actor/ActorSystem.html" title="akka.actor.ActorSystem"><code>ActorSystem</code></a></span><span class="group-java"><a href="https://doc.akka.io/japi/akka/2.8/akka/actor/ActorSystem.html" title="akka.actor.ActorSystem"><code>ActorSystem</code></a></span> in order to perform book-keeping operations related to the subscribers being Actors, which can terminate without first unsubscribing from the EventBus. ManagedActorClassification maintains a system Actor which takes care of unsubscribing terminated actors automatically.</p>
<p>The necessary methods to be implemented are illustrated with the following example: <!--- #actor-classification-start ---></p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/akka/tree/v2.9.1/akka-docs/src/test/scala/docs/event/EventBusDocSpec.scala#L124-L142" target="_blank" title="Go to snippet source">source</a><code class="language-scala">import akka.event.ActorEventBus
import akka.event.ManagedActorClassification
import akka.event.ActorClassifier

final case class Notification(ref: ActorRef, id: Int)

class ActorBusImpl(val system: ActorSystem)
    extends ActorEventBus
    with ActorClassifier
    with ManagedActorClassification {
  type Event = Notification

  // is used for extracting the classifier from the incoming events
  override protected def classify(event: Event): ActorRef = event.ref

  // determines the initial size of the index data structure
  // used internally (i.e. the expected number of different classifiers)
  override protected def mapSize: Int = 128
}</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/akka/tree/v2.9.1/akka-docs/src/test/java/jdocs/event/EventBusDocTest.java#L37-L259" target="_blank" title="Go to snippet source">source</a><code class="language-java">import akka.event.japi.ManagedActorEventBus;

static class Notification {
  public final ActorRef ref;
  public final int id;

  public Notification(ActorRef ref, int id) {
    this.ref = ref;
    this.id = id;
  }
}

static class ActorBusImpl extends ManagedActorEventBus&lt;Notification&gt; {

  // the ActorSystem will be used for book-keeping operations, such as subscribers terminating
  public ActorBusImpl(ActorSystem system) {
    super(system);
  }

  // is used for extracting the classifier from the incoming events
  @Override
  public ActorRef classify(Notification event) {
    return event.ref;
  }

  // determines the initial size of the index data structure
  // used internally (i.e. the expected number of different classifiers)
  @Override
  public int mapSize() {
    return 128;
  }
}</code></pre></dd>
</dl>
<p>A test for this implementation may look like this:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/akka/tree/v2.9.1/akka-docs/src/test/scala/docs/event/EventBusDocSpec.scala#L187-L202" target="_blank" title="Go to snippet source">source</a><code class="language-scala">val observer1 = TestProbe().ref
val observer2 = TestProbe().ref
val probe1 = TestProbe()
val probe2 = TestProbe()
val subscriber1 = probe1.ref
val subscriber2 = probe2.ref
val actorBus = new ActorBusImpl(system)
actorBus.subscribe(subscriber1, observer1)
actorBus.subscribe(subscriber2, observer1)
actorBus.subscribe(subscriber2, observer2)
actorBus.publish(Notification(observer1, 100))
probe1.expectMsg(Notification(observer1, 100))
probe2.expectMsg(Notification(observer1, 100))
actorBus.publish(Notification(observer2, 101))
probe2.expectMsg(Notification(observer2, 101))
probe1.expectNoMessage(500.millis)</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/akka/akka/tree/v2.9.1/akka-docs/src/test/java/jdocs/event/EventBusDocTest.java#L321-L338" target="_blank" title="Go to snippet source">source</a><code class="language-java">ActorRef observer1 = new TestKit(system).getRef();
ActorRef observer2 = new TestKit(system).getRef();
TestKit probe1 = new TestKit(system);
TestKit probe2 = new TestKit(system);
ActorRef subscriber1 = probe1.getRef();
ActorRef subscriber2 = probe2.getRef();
ActorBusImpl actorBus = new ActorBusImpl(system);
actorBus.subscribe(subscriber1, observer1);
actorBus.subscribe(subscriber2, observer1);
actorBus.subscribe(subscriber2, observer2);
Notification n1 = new Notification(observer1, 100);
actorBus.publish(n1);
probe1.expectMsgEquals(n1);
probe2.expectMsgEquals(n1);
Notification n2 = new Notification(observer2, 101);
actorBus.publish(n2);
probe2.expectMsgEquals(n2);
probe1.expectNoMessage(Duration.ofMillis(500));</code></pre></dd>
</dl>
<!--- #actor-classification-end --->
<p>This classifier is still is generic in the event type, and it is efficient for all use cases. <!--- #actor-classification-end ---></p>
</div>
</article>
<div class="row">
<div class="small-12 column">
<section class="nav-prev-next row">
<div class="nav-prev small-6 column">
<a href="../index-utilities.html"><i class="icon-prev"></i> <span class="link-prev">Utilities</span></a>
</div>
<div class="nav-next small-6 column clearfix">
<a class="float-right" href="../typed/logging.html">Logging <i class="icon-next"></i></a>
</div>
</section>
</div>
</div>
<div class="source-github row">
Found an error in this documentation? The source code for this page can be found <a href="https://github.com/akka/akka/tree/v2.9.1/akka-docs/src/main/paradox/typed/event-stream.md">here</a>.
Please feel free to edit and contribute a pull request.
</div>

<footer class="page-footer row clearfix">
<img class="akka-icon float-left show-for-medium" src="../images/akka-icon.svg" />
<section class="copyright">
<div>Akka is available under the <a href="https://www.lightbend.com/akka/license" target="_blank">Business Source License 1.1</a>.</div>
<p class="legal">
&copy; 2011-2023 <a href="https://www.lightbend.com" target="_blank">Lightbend, Inc.</a> |
<a href="https://www.lightbend.com/legal/licenses" target="_blank">Licenses</a> |
<a href="https://www.lightbend.com/legal/terms" target="_blank">Terms</a> |
<a href="https://www.lightbend.com/legal/privacy" target="_blank">Privacy Policy</a> |
<a href="https://akka.io/cookie/" target="_blank">Cookie Listing</a> |
<a class="optanon-toggle-display">Cookie Settings</a>
</p>
</section>

</footer>
</section>
</main>
</div>

<script type="text/javascript" src="../js/scrollsneak.js"></script>
<script type="text/javascript">jQuery(document).foundation();</script>
<script type="text/javascript" src="../js/groups.js"></script>
<script type="text/javascript" src="../js/page.js"></script>
<script type="text/javascript" src="../js/snippets.js"></script>
<script type="text/javascript" src="../js/magellan.js"></script>
<script type="text/javascript" src="../js/metadata-toggle.js"></script>
<script type="text/javascript" src="../js/lbHeader.js"></script>

<style type="text/css">@import "../lib/prettify/prettify.css";</style>
<script type="text/javascript" src="../lib/prettify/prettify.js"></script>
<script type="text/javascript" src="../lib/prettify/lang-scala.js"></script>
<script type="text/javascript">//<![CDATA[
jQuery(function(){window.prettyPrint && prettyPrint()});
//]]></script>
<!-- Algolia docs search -->
<script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.js"></script>
<style>.algolia-autocomplete { display: block !important }</style>
<script type="text/javascript">
docsearch({
appId: 'XUXZ6LW9B1',
apiKey: '5b6260148e92f7c5e38338fcf7eaa3e0',
indexName: 'akka_docs',
inputSelector: '#search',
algoliaOptions: {
hitsPerPage: 5
}
});

docsearch({
appId: 'XUXZ6LW9B1',
apiKey: '5b6260148e92f7c5e38338fcf7eaa3e0',
indexName: 'akka_docs',
inputSelector: '#overlay-search',
algoliaOptions: {
hitsPerPage: 5
}
});

// set up "/" as global shortcut for focusing on search
jQuery(document).keypress(function (event) {
if (event.keyCode == 47) {
jQuery("#search").focus();
return false; // swallow key event, otherwise the / char would be input into the search box
}
});
</script>

<script type="text/javascript" src="../assets/js/warnOldVersion.js"></script>
<script type="text/javascript">//<![CDATA[
jQuery(function(jq){initOldVersionWarnings(jq, '2.9.1', 'https://akka.io/')});
//]]></script>


</body>
</html>
